(self.webpackChunkgosh_esp=self.webpackChunkgosh_esp||[]).push([[2293],{64335:function(dr,X,G){"use strict";var Me=G(67294),ve=(0,Me.createContext)({});X.Z=ve},21349:function(dr,X,G){"use strict";var Me=G(84305),ve=G(69224),v=G(17781),be=G.n(v),Z=G(67294),se=G(94184),me=G.n(se),ae=G(64335),fe=function(we){var Oe=(0,Z.useContext)(ae.Z),M=we.children,Jt=we.contentWidth,Gt=we.className,Dt=we.style,Ut=(0,Z.useContext)(ve.ZP.ConfigContext),ct=Ut.getPrefixCls,dt=we.prefixCls||ct("pro"),Mr=Jt||Oe.contentWidth,cr="".concat(dt,"-grid-content");return Z.createElement("div",{className:me()(cr,Gt,{wide:Mr==="Fixed"}),style:Dt},Z.createElement("div",{className:"".concat(dt,"-grid-content-children")},M))};X.Z=fe},69682:function(dr,X,G){"use strict";G.d(X,{zP:function(){return bC},JE:function(){return bE},ns:function(){return xC}});var Me={};G.r(Me),G.d(Me,{add:function(){return Nc},adjoint:function(){return yf},clone:function(){return qf},copy:function(){return Kf},create:function(){return vu},determinant:function(){return Ru},equals:function(){return ul},exactEquals:function(){return bf},frob:function(){return Ni},fromQuat:function(){return lc},fromQuat2:function(){return _f},fromRotation:function(){return Di},fromRotationTranslation:function(){return gf},fromRotationTranslationScale:function(){return Ao},fromRotationTranslationScaleOrigin:function(){return Bc},fromScaling:function(){return Qf},fromTranslation:function(){return sc},fromValues:function(){return $f},fromXRotation:function(){return Sp},fromYRotation:function(){return uc},fromZRotation:function(){return ep},frustum:function(){return _u},getRotation:function(){return Du},getScaling:function(){return gu},getTranslation:function(){return ca},identity:function(){return Rl},invert:function(){return Yi},lookAt:function(){return $s},mul:function(){return Fl},multiply:function(){return Da},multiplyScalar:function(){return Dl},multiplyScalarAndAdd:function(){return rp},ortho:function(){return Fs},perspective:function(){return Ks},perspectiveFromFieldOfView:function(){return cc},rotate:function(){return mu},rotateX:function(){return Ko},rotateY:function(){return yu},rotateZ:function(){return To},scale:function(){return Co},set:function(){return oc},str:function(){return sl},sub:function(){return Fu},subtract:function(){return tp},targetTo:function(){return xf},translate:function(){return Ds},transpose:function(){return Jf}});var ve=G(67294),v=(0,ve.createContext)({});function be(){return(0,ve.useContext)(v)}var Z=G(28660),se=G(26729),me=G.n(se),ae=G(86700),fe=G(84879),Q={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},we=G(6610),Oe=G(5991),M=G(96156);function Jt(e){var n=131,r=137,i=0;e+="x";for(var o=Math.floor(9007199254740991/r),c=0;c<e.length;c++)i>o&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(c);return i}function Gt(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var Dt=G(28481),Ut=window.document.documentElement.style;function ct(e){var n=e;return typeof e=="string"&&(n=document.getElementById(e)),n}function dt(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Mr(e){return dt(e).split(/\s+/)}function cr(e){if(!Ut)return e[0];for(var n in e)if(e[n]&&e[n]in Ut)return e[n];return e[0]}function Ft(e,n,r){var i=document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function st(e){var n=e.parentNode;n&&n.removeChild(e)}function He(e,n){if(e.classList!==void 0)for(var r=Mr(n),i=0,o=r.length;i<o;i++)e.classList.add(r[i]);else if(!Ye(e,n)){var c=ur(e);kt(e,(c?c+" ":"")+n)}}function ut(e,n){e.classList!==void 0?e.classList.remove(n):kt(e,dt((" "+ur(e)+" ").replace(" "+n+" "," ")))}function Ye(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=ur(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function kt(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function ur(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Or(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Gr=cr(["transform","WebkitTransform"]);function Ee(e,n){e.style[Gr]=n}function Ve(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function ke(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function vt(){var e,n=document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(o){var c=o.split("="),d=(0,Dt.Z)(c,2),y=d[0],_=d[1];return y==="initial-scale"});return i?i.split("=")[1]*1:1}var qe=vt()<1?1:window.devicePixelRatio,H=G(63349),Je=G(10379),Et=G(46070),gt=G(77608),qr=G(14665);function Si(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var On=G(51814);function An(e,n,r){return(0,On.Z)()?An=Reflect.construct:An=function(o,c,d){var y=[null];y.push.apply(y,c);var _=Function.bind.apply(o,y),b=new _;return d&&(0,qr.Z)(b,d.prototype),b},An.apply(null,arguments)}function gn(e){var n=typeof Map=="function"?new Map:void 0;return gn=function(i){if(i===null||!Si(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,o)}function o(){return An(i,arguments,(0,gt.Z)(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,qr.Z)(o,i)},gn(e)}function Cn(e){var n=un();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function un(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oi=function(e){(0,Je.Z)(r,e);var n=Cn(r);function r(i,o,c){var d;return(0,we.Z)(this,r),d=n.call(this,i),(0,M.Z)((0,H.Z)(d),"status",void 0),(0,M.Z)((0,H.Z)(d),"url",void 0),d.status=o,d.url=c,d.name=d.constructor.name,d.message=i,d}return(0,Oe.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(gn(Error));function Ei(e){var n=new XMLHttpRequest;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var da=function(n,r){var i=Ei(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var o;try{o=JSON.parse(i.response)}catch(c){return r(c)}r(null,o)}else i.status===401?r(new Oi("".concat(i.statusText),i.status,n.url)):r(new Oi(i.statusText,i.status,n.url))},i.send(),i},sa=function(n,r){var i=Ei(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var o=i.response;if(o.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:o,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new Oi(i.statusText,i.status,n.url))},i.send(),i};function Ti(e){var n=window.document.createElement("a");return n.href=e,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}var lo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Mi=function(n,r){return sa(n,function(i,o){if(i)r(i);else if(o){var c=new window.Image;c.crossOrigin="anonymous";var d=window.URL||window.webkitURL;c.onload=function(){r(null,c),d.revokeObjectURL(c.src)};var y=new window.Blob([new Uint8Array(o.data)],{type:"image/png"});c.src=o.data.byteLength?d.createObjectURL(y):lo}})},Pi=63710088e-1,bo={centimeters:Pi*100,centimetres:Pi*100,degrees:Pi/111325,feet:Pi*3.28084,inches:Pi*39.37,kilometers:Pi/1e3,kilometres:Pi/1e3,meters:Pi,metres:Pi,miles:Pi/1609.344,millimeters:Pi*1e3,millimetres:Pi*1e3,nauticalmiles:Pi/1852,radians:1,yards:Pi*1.0936},le={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Pi,yards:1.0936133},Ha={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ki(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function Wo(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return cu(n).geometry;case"LineString":return Xt(n).geometry;case"Polygon":return as(n).geometry;case"MultiPoint":return ui(n).geometry;case"MultiLineString":return dn(n).geometry;case"MultiPolygon":return Rn(n).geometry;default:throw new Error(e+" is invalid")}}function cu(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!U(e[0])||!U(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return ki(i,n,r)}function is(e,n,r){return r===void 0&&(r={}),Ur(e.map(function(i){return cu(i,n)}),r)}function as(e,n,r){r===void 0&&(r={});for(var i=0,o=e;i<o.length;i++){var c=o[i];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return ki(y,n,r)}function bt(e,n,r){return r===void 0&&(r={}),Ur(e.map(function(i){return as(i,n)}),r)}function Xt(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return ki(i,n,r)}function Tr(e,n,r){return r===void 0&&(r={}),Ur(e.map(function(i){return Xt(i,n)}),r)}function Ur(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function dn(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return ki(i,n,r)}function ui(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return ki(i,n,r)}function Rn(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return ki(i,n,r)}function $n(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return ki(i,n,r)}function Mn(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function di(e,n){n===void 0&&(n="kilometers");var r=bo[n];if(!r)throw new Error(n+" units is invalid");return e*r}function ni(e,n){n===void 0&&(n="kilometers");var r=bo[n];if(!r)throw new Error(n+" units is invalid");return e/r}function to(e,n){return fu(ni(e,n))}function wo(e){var n=e%360;return n<0&&(n+=360),n}function fu(e){var n=e%(2*Math.PI);return n*180/Math.PI}function Rs(e){var n=e%360;return n*Math.PI/180}function Ji(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return di(ni(e,n),r)}function B(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=Ha[n];if(!i)throw new Error("invalid original units");var o=Ha[r];if(!o)throw new Error("invalid final units");return e/i*o}function U(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Y(e){return!!e&&e.constructor===Object}function oe(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!U(n))throw new Error("bbox must only contain numbers")})}function Te(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}var Ze=2*Math.PI*6378137/2;function We(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;te(n,i)}),n}function te(e,n){return Array.isArray(n[0])?n.forEach(function(r){te(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function Pe(e,n){return nt(e,n)}function nt(e,n){return Array.isArray(e[0])?e.map(function(r){return nt(r,n)}):n(e)}function $t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Wr(e,n);var i=e[0],o=e[1],c=i*Ze/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*Ze/180,r.enable&&(c=Number(c.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[c,d,e[2]]:[c,d]}function lr(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],o=r/Ze*180,c=i/Ze*180;return c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2),n!=null&&(o=Number(o.toFixed(n)),c=Number(c.toFixed(n))),e.length===3?[o,c,e[2]]:[o,c]}function pt(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function er(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Wr(e,n){if(n===!1)return e;var r=pt(e[0]),i=er(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Rr(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,o=Math.PI/180,c=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var y=.5/Math.PI,_=.5,b=-.5/Math.PI;return o=.5,c=i*(y*c+_),d=i*(b*d+o),[Math.floor(c),Math.floor(d)]}function Rt(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,o=.5,c=256<<20,d=_slicedToArray(e,2),y=d[0],_=d[1];y=(y/c-r)/n,_=(_/c-o)/i,_=(Math.atan(Math.pow(Math.E,_))-Math.PI/4)*2,o=Math.PI/180;var b=_/o,T=y/o;return[T,b]}function Dr(e,n,r){var i=Rs(n[1]-e[1]),o=Rs(n[0]-e[0]),c=Rs(e[1]),d=Rs(n[1]),y=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(c)*Math.cos(d);return di(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),r="meters")}function Ir(e){var n=Math.PI/180,r=85.0511287798,i=6378137,o=Math.max(Math.min(r,e[1]),-r),c=Math.sin(o*n),d=i*e[0]*n,y=i*Math.log((1+c)/(1-c))/2;return[d,y]}function Pr(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function Bn(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function Lr(e){return[[e[0],e[1]],[e[2],e[3]]]}var Un=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,we.Z)(this,e),(0,M.Z)(this,"limit",void 0),(0,M.Z)(this,"cache",void 0),(0,M.Z)(this,"destroy",void 0),(0,M.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Oe.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(o){return o===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function li(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var Nn=G(2650);function Pn(e){var n=Nn.ZP(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function jn(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],o=n+r*256+i*65536-1;return o}function Ea(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function mi(e){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=null,c=e.positions[0],d=e.positions[e.positions.length-1],y=0;y<e.colors.length;++y){var _=(e.positions[y]-c)/(d-c);i.addColorStop(_,e.colors[y])}return r.fillStyle=i,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),new ImageData(o,256,1)}var Li;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Li||(Li={}));var Wn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zn(e,n,r){var i=e.classList;for(var o in Wn)Wn.hasOwnProperty(o)&&i.remove("l7-".concat(r,"-anchor-").concat(o));i.add("l7-".concat(r,"-anchor-").concat(n))}function Jn(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function Qi(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function ys(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function Bi(e){if(e.length===0)throw new Error("mean requires at least one data point");return ys(e)/e.length}function ea(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,o=1,c=1;c<e.length+1;c++)e[c]!==n?(o>i&&(i=o,r=n),o=1,n=e[c]):o++;return r*1}var ku={min:Qi,max:Jn,mean:Bi,sum:ys,mode:ea};function qs(e,n){return e.map(function(r){return r[n]})}function ji(e,n){return ku[e](n)}var Wa=G(49296),Ca=G.n(Wa);function ua(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ua(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ua(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wi(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=mo(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function mo(e,n){if(!!e){if(typeof e=="string")return Xa(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xa(e,n)}}function Xa(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var So=30;function Xo(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,o=e.buffer,c=e.maxCanvasWidth,d=e.mapping,y=d===void 0?{}:d,_=e.xOffset,b=_===void 0?0:_,T=e.yOffset,A=T===void 0?0:T,O=0,F=b;Array.from(n).forEach(function(J,ue){if(!y[J]){var Ie=r(J,ue);F+So>c&&(F=0,O++),y[J]={x:F,y:A+O*So,width:So,height:So,advance:Ie},F+=So}});var W=i+o*2;return{mapping:y,xOffset:F,yOffset:A+O*W,canvasHeight:Ta(A+(O+1)*W)}}function Lc(e,n,r){var i=0,o=0,c=0,d=[],y={},_=wi(e),b;try{for(_.s();!(b=_.n()).done;){var T=b.value;if(!y[T.id]){var A=T.size;i+A+n>r&&(Yo(y,d,o),i=0,o=c+o+n,c=0,d=[]),d.push({icon:T,xOffset:i}),i=i+A+n,c=Math.max(c,A)}}}catch(F){_.e(F)}finally{_.f()}d.length>0&&Yo(y,d,o);var O=Ta(c+o+n);return{mapping:y,canvasHeight:O}}function Yo(e,n,r){var i=wi(n),o;try{for(i.s();!(o=i.n()).done;){var c=o.value,d=c.icon,y=c.xOffset;e[d.id]=vo(vo({},d),{},{x:y,y:r,image:d.image,width:d.width,height:d.height})}}catch(_){i.e(_)}finally{i.f()}}function Ta(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var va,Ri;function K(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=he(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function he(e,n){if(!!e){if(typeof e=="string")return je(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(e,n)}}function je(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function It(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function xr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?It(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var an=ol(),yi="sans-serif",ma="normal",Ya=24,Aa=3,qo=.25,ac=8,vf=1024,Rc=1,os=1,Lu=3,ss=null;function ol(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function pu(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function gs(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var kl=(va=(0,ae.b2)(),va(Ri=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"fontAtlas",void 0),(0,M.Z)(this,"iconFontMap",void 0),(0,M.Z)(this,"iconFontGlyphs",{}),(0,M.Z)(this,"fontOptions",void 0),(0,M.Z)(this,"key",void 0),(0,M.Z)(this,"cache",new Un(Lu))}return(0,Oe.Z)(e,[{key:"scale",get:function(){return os}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:yi,fontWeight:ma,characterSet:an,fontSize:Ya,buffer:Aa,sdf:!0,cutoff:qo,radius:ac,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=xr(xr({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var c=this.generateFontAtlas(this.key,i,o);this.fontAtlas=c,this.cache.set(this.key,c)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,o){var c=this.fontOptions,d=c.fontFamily,y=c.fontWeight,_=c.fontSize,b=c.buffer,T=c.sdf,A=c.radius,O=c.cutoff,F=c.iconfont,W=o&&o.data;W||(W=document.createElement("canvas"),W.width=vf);var J=W.getContext("2d");pu(J,d,_,y);var ue=Xo(xr({getFontWidth:function(Ys){return J.measureText(Ys).width},fontHeight:_*os,buffer:b,characterSet:i,maxCanvasWidth:vf},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Ie=ue.mapping,rt=ue.canvasHeight,lt=ue.xOffset,Tt=ue.yOffset,Ot=J.getImageData(0,0,W.width,W.height);if(W.height=rt,J.putImageData(Ot,0,0),pu(J,d,_,y),T){var Zt=new(Ca())(_,b,A,O,d,y),Vt=J.getImageData(0,0,Zt.size,Zt.size),_r=K(i),Zr;try{for(_r.s();!(Zr=_r.n()).done;){var Yr=Zr.value;if(F){var Cr=String.fromCharCode(parseInt(Yr.replace("&#x","").replace(";",""),16)),sn=Zt.draw(Cr);gs(sn,Vt)}else gs(Zt.draw(Yr),Vt);J.putImageData(Vt,Ie[Yr].x,Ie[Yr].y)}}catch(Ls){_r.e(Ls)}finally{_r.f()}}else{var Ln=K(i),Hn;try{for(Ln.s();!(Hn=Ln.n()).done;){var Ga=Hn.value;J.fillText(Ga,Ie[Ga].x,Ie[Ga].y+_*Rc)}}catch(Ls){Ln.e(Ls)}finally{Ln.f()}}return{xOffset:lt,yOffset:Tt,mapping:Ie,data:W,width:W.width,height:W.height}}},{key:"getKey",value:function(){return"key";var r,i,o,c,d,y,_,b}},{key:"getNewChars",value:function(r,i){var o=this.cache.get(r);if(!o)return i;var c=[],d=o.mapping,y=new Set(Object.keys(d)),_=new Set(i);return _.forEach(function(b){y.has(b)||c.push(b)}),c}}]),e}())||Ri),Eo,la;function Ll(e){var n=Dc();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mf=3,hu=1024,du=64,Fc=(Eo=(0,ae.b2)(),Eo(la=function(e){(0,Je.Z)(r,e);var n=Ll(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"canvasHeight",128),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"canvas",void 0),(0,M.Z)((0,H.Z)(i),"iconData",void 0),(0,M.Z)((0,H.Z)(i),"iconMap",void 0),(0,M.Z)((0,H.Z)(i),"ctx",void 0),(0,M.Z)((0,H.Z)(i),"loadingImageCount",0),i}return(0,Oe.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,c){var d=this,y=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:du}),this.updateIconMap(),this.loadImage(c).then(function(_){y=_;var b=d.iconData.find(function(T){return T.id===o});b&&(b.image=y,b.width=y.width,b.height=y.height),d.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(c){return c.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=hu,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(c){var d=o.iconMap[c],y=d.x,_=d.y,b=d.image,T=d.width,A=T===void 0?64:T,O=d.height,F=O===void 0?64:O,W=Math.max(A,F),J=W/du,ue=F/J,Ie=A/J;b&&o.ctx.drawImage(b,y+(du-Ie)/2,_+(du-ue)/2,Ie,ue)})}},{key:"updateIconMap",value:function(){var o=Lc(this.iconData,mf,hu),c=o.mapping,d=o.canvasHeight;this.iconMap=c,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(c,d){if(o instanceof HTMLImageElement){c(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){c(y)},y.onerror=function(){d(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(se.EventEmitter))||la),Ii=G(49685);function vu(){var e=new Ii.WT(16);return Ii.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function qf(e){var n=new Ii.WT(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Kf(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function $f(e,n,r,i,o,c,d,y,_,b,T,A,O,F,W,J){var ue=new Ii.WT(16);return ue[0]=e,ue[1]=n,ue[2]=r,ue[3]=i,ue[4]=o,ue[5]=c,ue[6]=d,ue[7]=y,ue[8]=_,ue[9]=b,ue[10]=T,ue[11]=A,ue[12]=O,ue[13]=F,ue[14]=W,ue[15]=J,ue}function oc(e,n,r,i,o,c,d,y,_,b,T,A,O,F,W,J,ue){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e[4]=c,e[5]=d,e[6]=y,e[7]=_,e[8]=b,e[9]=T,e[10]=A,e[11]=O,e[12]=F,e[13]=W,e[14]=J,e[15]=ue,e}function Rl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Jf(e,n){if(e===n){var r=n[1],i=n[2],o=n[3],c=n[6],d=n[7],y=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=c,e[11]=n[14],e[12]=o,e[13]=d,e[14]=y}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function Yi(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=n[4],y=n[5],_=n[6],b=n[7],T=n[8],A=n[9],O=n[10],F=n[11],W=n[12],J=n[13],ue=n[14],Ie=n[15],rt=r*y-i*d,lt=r*_-o*d,Tt=r*b-c*d,Ot=i*_-o*y,Zt=i*b-c*y,Vt=o*b-c*_,_r=T*J-A*W,Zr=T*ue-O*W,Yr=T*Ie-F*W,Cr=A*ue-O*J,sn=A*Ie-F*J,Ln=O*Ie-F*ue,Hn=rt*Ln-lt*sn+Tt*Cr+Ot*Yr-Zt*Zr+Vt*_r;return Hn?(Hn=1/Hn,e[0]=(y*Ln-_*sn+b*Cr)*Hn,e[1]=(o*sn-i*Ln-c*Cr)*Hn,e[2]=(J*Vt-ue*Zt+Ie*Ot)*Hn,e[3]=(O*Zt-A*Vt-F*Ot)*Hn,e[4]=(_*Yr-d*Ln-b*Zr)*Hn,e[5]=(r*Ln-o*Yr+c*Zr)*Hn,e[6]=(ue*Tt-W*Vt-Ie*lt)*Hn,e[7]=(T*Vt-O*Tt+F*lt)*Hn,e[8]=(d*sn-y*Yr+b*_r)*Hn,e[9]=(i*Yr-r*sn-c*_r)*Hn,e[10]=(W*Zt-J*Tt+Ie*rt)*Hn,e[11]=(A*Tt-T*Zt-F*rt)*Hn,e[12]=(y*Zr-d*Cr-_*_r)*Hn,e[13]=(r*Cr-i*Zr+o*_r)*Hn,e[14]=(J*lt-W*Ot-ue*rt)*Hn,e[15]=(T*Ot-A*lt+O*rt)*Hn,e):null}function yf(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=n[4],y=n[5],_=n[6],b=n[7],T=n[8],A=n[9],O=n[10],F=n[11],W=n[12],J=n[13],ue=n[14],Ie=n[15];return e[0]=y*(O*Ie-F*ue)-A*(_*Ie-b*ue)+J*(_*F-b*O),e[1]=-(i*(O*Ie-F*ue)-A*(o*Ie-c*ue)+J*(o*F-c*O)),e[2]=i*(_*Ie-b*ue)-y*(o*Ie-c*ue)+J*(o*b-c*_),e[3]=-(i*(_*F-b*O)-y*(o*F-c*O)+A*(o*b-c*_)),e[4]=-(d*(O*Ie-F*ue)-T*(_*Ie-b*ue)+W*(_*F-b*O)),e[5]=r*(O*Ie-F*ue)-T*(o*Ie-c*ue)+W*(o*F-c*O),e[6]=-(r*(_*Ie-b*ue)-d*(o*Ie-c*ue)+W*(o*b-c*_)),e[7]=r*(_*F-b*O)-d*(o*F-c*O)+T*(o*b-c*_),e[8]=d*(A*Ie-F*J)-T*(y*Ie-b*J)+W*(y*F-b*A),e[9]=-(r*(A*Ie-F*J)-T*(i*Ie-c*J)+W*(i*F-c*A)),e[10]=r*(y*Ie-b*J)-d*(i*Ie-c*J)+W*(i*b-c*y),e[11]=-(r*(y*F-b*A)-d*(i*F-c*A)+T*(i*b-c*y)),e[12]=-(d*(A*ue-O*J)-T*(y*ue-_*J)+W*(y*O-_*A)),e[13]=r*(A*ue-O*J)-T*(i*ue-o*J)+W*(i*O-o*A),e[14]=-(r*(y*ue-_*J)-d*(i*ue-o*J)+W*(i*_-o*y)),e[15]=r*(y*O-_*A)-d*(i*O-o*A)+T*(i*_-o*y),e}function Ru(e){var n=e[0],r=e[1],i=e[2],o=e[3],c=e[4],d=e[5],y=e[6],_=e[7],b=e[8],T=e[9],A=e[10],O=e[11],F=e[12],W=e[13],J=e[14],ue=e[15],Ie=n*d-r*c,rt=n*y-i*c,lt=n*_-o*c,Tt=r*y-i*d,Ot=r*_-o*d,Zt=i*_-o*y,Vt=b*W-T*F,_r=b*J-A*F,Zr=b*ue-O*F,Yr=T*J-A*W,Cr=T*ue-O*W,sn=A*ue-O*J;return Ie*sn-rt*Cr+lt*Yr+Tt*Zr-Ot*_r+Zt*Vt}function Da(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3],y=n[4],_=n[5],b=n[6],T=n[7],A=n[8],O=n[9],F=n[10],W=n[11],J=n[12],ue=n[13],Ie=n[14],rt=n[15],lt=r[0],Tt=r[1],Ot=r[2],Zt=r[3];return e[0]=lt*i+Tt*y+Ot*A+Zt*J,e[1]=lt*o+Tt*_+Ot*O+Zt*ue,e[2]=lt*c+Tt*b+Ot*F+Zt*Ie,e[3]=lt*d+Tt*T+Ot*W+Zt*rt,lt=r[4],Tt=r[5],Ot=r[6],Zt=r[7],e[4]=lt*i+Tt*y+Ot*A+Zt*J,e[5]=lt*o+Tt*_+Ot*O+Zt*ue,e[6]=lt*c+Tt*b+Ot*F+Zt*Ie,e[7]=lt*d+Tt*T+Ot*W+Zt*rt,lt=r[8],Tt=r[9],Ot=r[10],Zt=r[11],e[8]=lt*i+Tt*y+Ot*A+Zt*J,e[9]=lt*o+Tt*_+Ot*O+Zt*ue,e[10]=lt*c+Tt*b+Ot*F+Zt*Ie,e[11]=lt*d+Tt*T+Ot*W+Zt*rt,lt=r[12],Tt=r[13],Ot=r[14],Zt=r[15],e[12]=lt*i+Tt*y+Ot*A+Zt*J,e[13]=lt*o+Tt*_+Ot*O+Zt*ue,e[14]=lt*c+Tt*b+Ot*F+Zt*Ie,e[15]=lt*d+Tt*T+Ot*W+Zt*rt,e}function Ds(e,n,r){var i=r[0],o=r[1],c=r[2],d,y,_,b,T,A,O,F,W,J,ue,Ie;return n===e?(e[12]=n[0]*i+n[4]*o+n[8]*c+n[12],e[13]=n[1]*i+n[5]*o+n[9]*c+n[13],e[14]=n[2]*i+n[6]*o+n[10]*c+n[14],e[15]=n[3]*i+n[7]*o+n[11]*c+n[15]):(d=n[0],y=n[1],_=n[2],b=n[3],T=n[4],A=n[5],O=n[6],F=n[7],W=n[8],J=n[9],ue=n[10],Ie=n[11],e[0]=d,e[1]=y,e[2]=_,e[3]=b,e[4]=T,e[5]=A,e[6]=O,e[7]=F,e[8]=W,e[9]=J,e[10]=ue,e[11]=Ie,e[12]=d*i+T*o+W*c+n[12],e[13]=y*i+A*o+J*c+n[13],e[14]=_*i+O*o+ue*c+n[14],e[15]=b*i+F*o+Ie*c+n[15]),e}function Co(e,n,r){var i=r[0],o=r[1],c=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=n[7]*o,e[8]=n[8]*c,e[9]=n[9]*c,e[10]=n[10]*c,e[11]=n[11]*c,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function mu(e,n,r,i){var o=i[0],c=i[1],d=i[2],y=Math.hypot(o,c,d),_,b,T,A,O,F,W,J,ue,Ie,rt,lt,Tt,Ot,Zt,Vt,_r,Zr,Yr,Cr,sn,Ln,Hn,Ga;return y<Ii.Ib?null:(y=1/y,o*=y,c*=y,d*=y,_=Math.sin(r),b=Math.cos(r),T=1-b,A=n[0],O=n[1],F=n[2],W=n[3],J=n[4],ue=n[5],Ie=n[6],rt=n[7],lt=n[8],Tt=n[9],Ot=n[10],Zt=n[11],Vt=o*o*T+b,_r=c*o*T+d*_,Zr=d*o*T-c*_,Yr=o*c*T-d*_,Cr=c*c*T+b,sn=d*c*T+o*_,Ln=o*d*T+c*_,Hn=c*d*T-o*_,Ga=d*d*T+b,e[0]=A*Vt+J*_r+lt*Zr,e[1]=O*Vt+ue*_r+Tt*Zr,e[2]=F*Vt+Ie*_r+Ot*Zr,e[3]=W*Vt+rt*_r+Zt*Zr,e[4]=A*Yr+J*Cr+lt*sn,e[5]=O*Yr+ue*Cr+Tt*sn,e[6]=F*Yr+Ie*Cr+Ot*sn,e[7]=W*Yr+rt*Cr+Zt*sn,e[8]=A*Ln+J*Hn+lt*Ga,e[9]=O*Ln+ue*Hn+Tt*Ga,e[10]=F*Ln+Ie*Hn+Ot*Ga,e[11]=W*Ln+rt*Hn+Zt*Ga,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Ko(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[4],d=n[5],y=n[6],_=n[7],b=n[8],T=n[9],A=n[10],O=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=c*o+b*i,e[5]=d*o+T*i,e[6]=y*o+A*i,e[7]=_*o+O*i,e[8]=b*o-c*i,e[9]=T*o-d*i,e[10]=A*o-y*i,e[11]=O*o-_*i,e}function yu(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[0],d=n[1],y=n[2],_=n[3],b=n[8],T=n[9],A=n[10],O=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=c*o-b*i,e[1]=d*o-T*i,e[2]=y*o-A*i,e[3]=_*o-O*i,e[8]=c*i+b*o,e[9]=d*i+T*o,e[10]=y*i+A*o,e[11]=_*i+O*o,e}function To(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[0],d=n[1],y=n[2],_=n[3],b=n[4],T=n[5],A=n[6],O=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=c*o+b*i,e[1]=d*o+T*i,e[2]=y*o+A*i,e[3]=_*o+O*i,e[4]=b*o-c*i,e[5]=T*o-d*i,e[6]=A*o-y*i,e[7]=O*o-_*i,e}function sc(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Qf(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Di(e,n,r){var i=r[0],o=r[1],c=r[2],d=Math.hypot(i,o,c),y,_,b;return d<Ii.Ib?null:(d=1/d,i*=d,o*=d,c*=d,y=Math.sin(n),_=Math.cos(n),b=1-_,e[0]=i*i*b+_,e[1]=o*i*b+c*y,e[2]=c*i*b-o*y,e[3]=0,e[4]=i*o*b-c*y,e[5]=o*o*b+_,e[6]=c*o*b+i*y,e[7]=0,e[8]=i*c*b+o*y,e[9]=o*c*b-i*y,e[10]=c*c*b+_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Sp(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function uc(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ep(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gf(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3],y=i+i,_=o+o,b=c+c,T=i*y,A=i*_,O=i*b,F=o*_,W=o*b,J=c*b,ue=d*y,Ie=d*_,rt=d*b;return e[0]=1-(F+J),e[1]=A+rt,e[2]=O-Ie,e[3]=0,e[4]=A-rt,e[5]=1-(T+J),e[6]=W+ue,e[7]=0,e[8]=O+Ie,e[9]=W-ue,e[10]=1-(T+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function _f(e,n){var r=new Ii.WT(3),i=-n[0],o=-n[1],c=-n[2],d=n[3],y=n[4],_=n[5],b=n[6],T=n[7],A=i*i+o*o+c*c+d*d;return A>0?(r[0]=(y*d+T*i+_*c-b*o)*2/A,r[1]=(_*d+T*o+b*i-y*c)*2/A,r[2]=(b*d+T*c+y*o-_*i)*2/A):(r[0]=(y*d+T*i+_*c-b*o)*2,r[1]=(_*d+T*o+b*i-y*c)*2,r[2]=(b*d+T*c+y*o-_*i)*2),gf(e,n,r),e}function ca(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function gu(e,n){var r=n[0],i=n[1],o=n[2],c=n[4],d=n[5],y=n[6],_=n[8],b=n[9],T=n[10];return e[0]=Math.hypot(r,i,o),e[1]=Math.hypot(c,d,y),e[2]=Math.hypot(_,b,T),e}function Du(e,n){var r=new Ii.WT(3);gu(r,n);var i=1/r[0],o=1/r[1],c=1/r[2],d=n[0]*i,y=n[1]*o,_=n[2]*c,b=n[4]*i,T=n[5]*o,A=n[6]*c,O=n[8]*i,F=n[9]*o,W=n[10]*c,J=d+T+W,ue=0;return J>0?(ue=Math.sqrt(J+1)*2,e[3]=.25*ue,e[0]=(A-F)/ue,e[1]=(O-_)/ue,e[2]=(y-b)/ue):d>T&&d>W?(ue=Math.sqrt(1+d-T-W)*2,e[3]=(A-F)/ue,e[0]=.25*ue,e[1]=(y+b)/ue,e[2]=(O+_)/ue):T>W?(ue=Math.sqrt(1+T-d-W)*2,e[3]=(O-_)/ue,e[0]=(y+b)/ue,e[1]=.25*ue,e[2]=(A+F)/ue):(ue=Math.sqrt(1+W-d-T)*2,e[3]=(y-b)/ue,e[0]=(O+_)/ue,e[1]=(A+F)/ue,e[2]=.25*ue),e}function Ao(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=n[3],_=o+o,b=c+c,T=d+d,A=o*_,O=o*b,F=o*T,W=c*b,J=c*T,ue=d*T,Ie=y*_,rt=y*b,lt=y*T,Tt=i[0],Ot=i[1],Zt=i[2];return e[0]=(1-(W+ue))*Tt,e[1]=(O+lt)*Tt,e[2]=(F-rt)*Tt,e[3]=0,e[4]=(O-lt)*Ot,e[5]=(1-(A+ue))*Ot,e[6]=(J+Ie)*Ot,e[7]=0,e[8]=(F+rt)*Zt,e[9]=(J-Ie)*Zt,e[10]=(1-(A+W))*Zt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Bc(e,n,r,i,o){var c=n[0],d=n[1],y=n[2],_=n[3],b=c+c,T=d+d,A=y+y,O=c*b,F=c*T,W=c*A,J=d*T,ue=d*A,Ie=y*A,rt=_*b,lt=_*T,Tt=_*A,Ot=i[0],Zt=i[1],Vt=i[2],_r=o[0],Zr=o[1],Yr=o[2],Cr=(1-(J+Ie))*Ot,sn=(F+Tt)*Ot,Ln=(W-lt)*Ot,Hn=(F-Tt)*Zt,Ga=(1-(O+Ie))*Zt,Ls=(ue+rt)*Zt,Ys=(W+lt)*Vt,Yf=(ue-rt)*Vt,il=(1-(O+J))*Vt;return e[0]=Cr,e[1]=sn,e[2]=Ln,e[3]=0,e[4]=Hn,e[5]=Ga,e[6]=Ls,e[7]=0,e[8]=Ys,e[9]=Yf,e[10]=il,e[11]=0,e[12]=r[0]+_r-(Cr*_r+Hn*Zr+Ys*Yr),e[13]=r[1]+Zr-(sn*_r+Ga*Zr+Yf*Yr),e[14]=r[2]+Yr-(Ln*_r+Ls*Zr+il*Yr),e[15]=1,e}function lc(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=r+r,y=i+i,_=o+o,b=r*d,T=i*d,A=i*y,O=o*d,F=o*y,W=o*_,J=c*d,ue=c*y,Ie=c*_;return e[0]=1-A-W,e[1]=T+Ie,e[2]=O-ue,e[3]=0,e[4]=T-Ie,e[5]=1-b-W,e[6]=F+J,e[7]=0,e[8]=O+ue,e[9]=F-J,e[10]=1-b-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _u(e,n,r,i,o,c,d){var y=1/(r-n),_=1/(o-i),b=1/(c-d);return e[0]=c*2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c*2*_,e[6]=0,e[7]=0,e[8]=(r+n)*y,e[9]=(o+i)*_,e[10]=(d+c)*b,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*c*2*b,e[15]=0,e}function Ks(e,n,r,i,o){var c=1/Math.tan(n/2),d;return e[0]=c/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=(o+i)*d,e[14]=2*o*i*d):(e[10]=-1,e[14]=-2*i),e}function cc(e,n,r,i){var o=Math.tan(n.upDegrees*Math.PI/180),c=Math.tan(n.downDegrees*Math.PI/180),d=Math.tan(n.leftDegrees*Math.PI/180),y=Math.tan(n.rightDegrees*Math.PI/180),_=2/(d+y),b=2/(o+c);return e[0]=_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=b,e[6]=0,e[7]=0,e[8]=-((d-y)*_*.5),e[9]=(o-c)*b*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Fs(e,n,r,i,o,c,d){var y=1/(n-r),_=1/(i-o),b=1/(c-d);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*b,e[11]=0,e[12]=(n+r)*y,e[13]=(o+i)*_,e[14]=(d+c)*b,e[15]=1,e}function $s(e,n,r,i){var o,c,d,y,_,b,T,A,O,F,W=n[0],J=n[1],ue=n[2],Ie=i[0],rt=i[1],lt=i[2],Tt=r[0],Ot=r[1],Zt=r[2];return Math.abs(W-Tt)<Ii.Ib&&Math.abs(J-Ot)<Ii.Ib&&Math.abs(ue-Zt)<Ii.Ib?Rl(e):(T=W-Tt,A=J-Ot,O=ue-Zt,F=1/Math.hypot(T,A,O),T*=F,A*=F,O*=F,o=rt*O-lt*A,c=lt*T-Ie*O,d=Ie*A-rt*T,F=Math.hypot(o,c,d),F?(F=1/F,o*=F,c*=F,d*=F):(o=0,c=0,d=0),y=A*d-O*c,_=O*o-T*d,b=T*c-A*o,F=Math.hypot(y,_,b),F?(F=1/F,y*=F,_*=F,b*=F):(y=0,_=0,b=0),e[0]=o,e[1]=y,e[2]=T,e[3]=0,e[4]=c,e[5]=_,e[6]=A,e[7]=0,e[8]=d,e[9]=b,e[10]=O,e[11]=0,e[12]=-(o*W+c*J+d*ue),e[13]=-(y*W+_*J+b*ue),e[14]=-(T*W+A*J+O*ue),e[15]=1,e)}function xf(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=i[0],_=i[1],b=i[2],T=o-r[0],A=c-r[1],O=d-r[2],F=T*T+A*A+O*O;F>0&&(F=1/Math.sqrt(F),T*=F,A*=F,O*=F);var W=_*O-b*A,J=b*T-y*O,ue=y*A-_*T;return F=W*W+J*J+ue*ue,F>0&&(F=1/Math.sqrt(F),W*=F,J*=F,ue*=F),e[0]=W,e[1]=J,e[2]=ue,e[3]=0,e[4]=A*ue-O*J,e[5]=O*W-T*ue,e[6]=T*J-A*W,e[7]=0,e[8]=T,e[9]=A,e[10]=O,e[11]=0,e[12]=o,e[13]=c,e[14]=d,e[15]=1,e}function sl(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ni(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Nc(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function tp(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function Dl(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function rp(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function bf(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function ul(e,n){var r=e[0],i=e[1],o=e[2],c=e[3],d=e[4],y=e[5],_=e[6],b=e[7],T=e[8],A=e[9],O=e[10],F=e[11],W=e[12],J=e[13],ue=e[14],Ie=e[15],rt=n[0],lt=n[1],Tt=n[2],Ot=n[3],Zt=n[4],Vt=n[5],_r=n[6],Zr=n[7],Yr=n[8],Cr=n[9],sn=n[10],Ln=n[11],Hn=n[12],Ga=n[13],Ls=n[14],Ys=n[15];return Math.abs(r-rt)<=Ii.Ib*Math.max(1,Math.abs(r),Math.abs(rt))&&Math.abs(i-lt)<=Ii.Ib*Math.max(1,Math.abs(i),Math.abs(lt))&&Math.abs(o-Tt)<=Ii.Ib*Math.max(1,Math.abs(o),Math.abs(Tt))&&Math.abs(c-Ot)<=Ii.Ib*Math.max(1,Math.abs(c),Math.abs(Ot))&&Math.abs(d-Zt)<=Ii.Ib*Math.max(1,Math.abs(d),Math.abs(Zt))&&Math.abs(y-Vt)<=Ii.Ib*Math.max(1,Math.abs(y),Math.abs(Vt))&&Math.abs(_-_r)<=Ii.Ib*Math.max(1,Math.abs(_),Math.abs(_r))&&Math.abs(b-Zr)<=Ii.Ib*Math.max(1,Math.abs(b),Math.abs(Zr))&&Math.abs(T-Yr)<=Ii.Ib*Math.max(1,Math.abs(T),Math.abs(Yr))&&Math.abs(A-Cr)<=Ii.Ib*Math.max(1,Math.abs(A),Math.abs(Cr))&&Math.abs(O-sn)<=Ii.Ib*Math.max(1,Math.abs(O),Math.abs(sn))&&Math.abs(F-Ln)<=Ii.Ib*Math.max(1,Math.abs(F),Math.abs(Ln))&&Math.abs(W-Hn)<=Ii.Ib*Math.max(1,Math.abs(W),Math.abs(Hn))&&Math.abs(J-Ga)<=Ii.Ib*Math.max(1,Math.abs(J),Math.abs(Ga))&&Math.abs(ue-Ls)<=Ii.Ib*Math.max(1,Math.abs(ue),Math.abs(Ls))&&Math.abs(Ie-Ys)<=Ii.Ib*Math.max(1,Math.abs(Ie),Math.abs(Ys))}var Fl=Da,Fu=tp,Bs,ll,cl=(Bs=(0,ae.b2)(),Bs(ll=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"viewport",void 0),(0,M.Z)(this,"overridedViewProjectionMatrix",void 0),(0,M.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,M.Z)(this,"jitteredProjectionMatrix",void 0),(0,M.Z)(this,"viewMatrixInverse",void 0),(0,M.Z)(this,"cameraPosition",void 0)}return(0,Oe.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=vu(),Yi(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,Dt.Z)(r,2),o=i[0],c=i[1];return[o,c]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var o=sc(vu(),[r,i,0]);this.jitteredProjectionMatrix=Da(vu(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Da(vu(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ll),xu,fc;function fl(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_s(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function _s(e,n){if(!!e){if(typeof e=="string")return zc(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zc(e,n)}}function zc(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var wf=(xu=(0,ae.b2)(),xu(fc=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"container",void 0),(0,M.Z)(this,"controlCorners",void 0),(0,M.Z)(this,"controlContainer",void 0),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"controls",[]),(0,M.Z)(this,"unAddControls",[])}return(0,Oe.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get(Q.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var o=i.get(Q.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=fl(this.controls),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;o.remove()}}catch(c){r.e(c)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",o=this.controlContainer=Ft("div",i+"control-container",this.container);function c(d,y){var _=i+d+" "+i+y;r[d+y]=Ft("div",_,o)}c("top","left"),c("top","right"),c("bottom","left"),c("bottom","right")}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&st(this.controlCorners[r]);this.controlContainer&&st(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||fc),Zc,bu,Bl=(Zc=(0,ae.b2)(),Zc(bu=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"container",void 0),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"markers",[]),(0,M.Z)(this,"markerLayers",[]),(0,M.Z)(this,"unAddMarkers",[]),(0,M.Z)(this,"unAddMarkerLayers",[])}return(0,Oe.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Q.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||bu),Nl,wu,zl=(Nl=(0,ae.b2)(),Nl(wu=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"popup",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"unAddPopup",void 0)}return(0,Oe.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Q.IMapService)}}]),e}())||wu),Sf=G(82492),Su=G.n(Sf),Ef={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},np=Ef,Cf,pl;function Uc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function pc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Uc(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Tf={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},hl={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ip=(Cf=(0,ae.b2)(),Cf(pl=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"sceneConfigCache",{}),(0,M.Z)(this,"layerConfigCache",{})}return(0,Oe.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return np[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=pc(pc({},Tf),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,o){this.layerConfigCache[i]=pc({},Su()({},this.sceneConfigCache[r],hl,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||pl);function Tn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function $r(e,n,r,i,o){var c={};return Object.keys(i).forEach(function(d){c[d]=i[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=r.slice().reverse().reduce(function(d,y){return y(e,n,d)||d},c),o&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(o):void 0,c.initializer=void 0),c.initializer===void 0&&(Object.defineProperty(e,n,c),c=null),c}function Zl(){var e=new Ii.WT(4);return Ii.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Bu(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Nu(e,n,r,i){var o=new Ii.WT(4);return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o}function ii(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Vi(e,n,r,i,o){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e}function xs(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function jc(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function hc(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function Vc(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function oh(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function sh(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function dc(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function zu(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function Zu(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function fa(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function Fo(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function Ul(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],c=n[3]-e[3];return Math.hypot(r,i,o,c)}function Ma(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],c=n[3]-e[3];return r*r+i*i+o*o+c*c}function Hr(e){var n=e[0],r=e[1],i=e[2],o=e[3];return Math.hypot(n,r,i,o)}function us(e){var n=e[0],r=e[1],i=e[2],o=e[3];return n*n+r*r+i*i+o*o}function Gc(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function jl(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function Ns(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=r*r+i*i+o*o+c*c;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=i*d,e[2]=o*d,e[3]=c*d,e}function ls(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function dl(e,n,r,i){var o=r[0]*i[1]-r[1]*i[0],c=r[0]*i[2]-r[2]*i[0],d=r[0]*i[3]-r[3]*i[0],y=r[1]*i[2]-r[2]*i[1],_=r[1]*i[3]-r[3]*i[1],b=r[2]*i[3]-r[3]*i[2],T=n[0],A=n[1],O=n[2],F=n[3];return e[0]=A*b-O*_+F*y,e[1]=-(T*b)+O*d-F*c,e[2]=T*_-A*d+F*o,e[3]=-(T*y)+A*c-O*o,e}function hr(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=n[3];return e[0]=o+i*(r[0]-o),e[1]=c+i*(r[1]-c),e[2]=d+i*(r[2]-d),e[3]=y+i*(r[3]-y),e}function Af(e,n){n=n||1;var r,i,o,c,d,y;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,d=r*r+i*i;while(d>=1);do o=glMatrix.RANDOM()*2-1,c=glMatrix.RANDOM()*2-1,y=o*o+c*c;while(y>=1);var _=Math.sqrt((1-d)/y);return e[0]=n*r,e[1]=n*i,e[2]=n*o*_,e[3]=n*c*_,e}function vl(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3];return e[0]=r[0]*i+r[4]*o+r[8]*c+r[12]*d,e[1]=r[1]*i+r[5]*o+r[9]*c+r[13]*d,e[2]=r[2]*i+r[6]*o+r[10]*c+r[14]*d,e[3]=r[3]*i+r[7]*o+r[11]*c+r[15]*d,e}function Uu(e,n,r){var i=n[0],o=n[1],c=n[2],d=r[0],y=r[1],_=r[2],b=r[3],T=b*i+y*c-_*o,A=b*o+_*i-d*c,O=b*c+d*o-y*i,F=-d*i-y*o-_*c;return e[0]=T*b+F*-d+A*-_-O*-y,e[1]=A*b+F*-y+O*-d-T*-_,e[2]=O*b+F*-_+T*-y-A*-d,e[3]=n[3],e}function bs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function $o(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Mf(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function Pf(e,n){var r=e[0],i=e[1],o=e[2],c=e[3],d=n[0],y=n[1],_=n[2],b=n[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}var cs=null,ju=null,If=null,vc=null,ap=null,Of=null,Js=null,ws=function(){var e=Zl();return function(n,r,i,o,c,d){var y,_;for(r||(r=4),i||(i=0),o?_=Math.min(o*r+i,n.length):_=n.length,y=i;y<_;y+=r)e[0]=n[y],e[1]=n[y+1],e[2]=n[y+2],e[3]=n[y+3],c(e,e,d),n[y]=e[0],n[y+1]=e[1],n[y+2]=e[2],n[y+3]=e[3];return n}}(),Xn=Math.PI/180,Qs=512,ro=4003e4;function Pa(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,o=i===void 0?0:i,c=e.scale,d=e.highPrecision,y=d===void 0?!1:d,_=e.flipY,b=_===void 0?!1:_;c=c!==void 0?c:Math.pow(2,o);var T={},A=Qs*c,O=Math.cos(r*Xn),F=A/360,W=F/O,J=A/ro/O;if(T.pixelsPerMeter=[J,-J,J],T.metersPerPixel=[1/J,-1/J,1/J],T.pixelsPerDegree=[F,-W,J],T.degreesPerPixel=[1/F,-1/W,1/J],y){var ue=Xn*Math.tan(r*Xn)/O,Ie=F*ue/2,rt=A/ro*ue,lt=rt/W*J;T.pixelsPerDegree2=[0,-Ie,rt],T.pixelsPerMeter2=[lt,0,lt],b&&(T.pixelsPerDegree2[1]=-T.pixelsPerDegree2[1],T.pixelsPerMeter2[1]=-T.pixelsPerMeter2[1])}return b&&(T.pixelsPerMeter[1]=-T.pixelsPerMeter[1],T.metersPerPixel[1]=-T.metersPerPixel[1],T.pixelsPerDegree[1]=-T.pixelsPerDegree[1],T.degreesPerPixel[1]=-T.degreesPerPixel[1]),T}var Bo;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Bo||(Bo={}));var No={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},fs,co,ml,on,Xr,mc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],yo=(fs=(0,ae.b2)(),co=(0,ae.f3)(Q.ICameraService),fs(ml=(on=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"needRefresh",!0),Tn(this,"cameraService",Xr,this),(0,M.Z)(this,"coordinateSystem",void 0),(0,M.Z)(this,"viewportCenter",void 0),(0,M.Z)(this,"viewportCenterProjection",void 0),(0,M.Z)(this,"pixelsPerDegree",void 0),(0,M.Z)(this,"pixelsPerDegree2",void 0),(0,M.Z)(this,"pixelsPerMeter",void 0)}return(0,Oe.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),c=Pa({latitude:o[1],zoom:r}),d=c.pixelsPerMeter,y=c.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=y,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Bo.LNGLAT||this.coordinateSystem===Bo.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Bo.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Bo.P20_OFFSET&&this.calculateLnglatOffset(o,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,o,c){var d=Pa({latitude:r[1],zoom:i,scale:o,flipY:c,highPrecision:!0}),y=d.pixelsPerMeter,_=d.pixelsPerDegree,b=d.pixelsPerDegree2,T=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),O=Da([],A,T),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=vl([],[F[0],F[1],0,1],O),T=this.cameraService.getViewMatrixUncentered()||T,O=Da([],A,T),O=Da([],O,mc),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=y,this.pixelsPerDegree=_,this.pixelsPerDegree2=b}}]),e}(),Xr=$r(on.prototype,"cameraService",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on))||ml),Fa=G(50840),ya=G.n(Fa),ta;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ta||(ta={}));var Ss,yl,pi,pa,Hc;function Vu(e){var n=Wc();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Wc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eu={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},zo=(Ss=(0,ae.b2)(),yl=(0,ae.f3)(Q.IMapService),Ss(pi=(pa=function(e){(0,Je.Z)(r,e);var n=Vu(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),Tn((0,H.Z)(i),"mapService",Hc,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"hammertime",void 0),(0,M.Z)((0,H.Z)(i),"lastClickTime",0),(0,M.Z)((0,H.Z)(i),"lastClickXY",[-1,-1]),(0,M.Z)((0,H.Z)(i),"clickTimer",void 0),(0,M.Z)((0,H.Z)(i),"$containter",void 0),(0,M.Z)((0,H.Z)(i),"onDrag",function(y){var _=i.interactionEvent(y);_.type=eu[_.type],i.emit(ta.Drag,_)}),(0,M.Z)((0,H.Z)(i),"onHammer",function(y){y.srcEvent.stopPropagation();var _=i.interactionEvent(y);i.emit(ta.Hover,_)}),(0,M.Z)((0,H.Z)(i),"onTouch",function(y){var _=y.touches[0];i.onHover({x:_.pageX,y:_.pageY,type:"touch"})}),(0,M.Z)((0,H.Z)(i),"onHover",function(y){var _=y.clientX,b=y.clientY,T=_,A=b,O=y.type,F=i.mapService.getMapContainer();if(F){var W=F.getBoundingClientRect(),J=W.top,ue=W.left;T=T-ue-F.clientLeft,A=A-J-F.clientTop}var Ie=i.mapService.containerToLngLat([T,A]);if(O==="click"){if("ontouchstart"in document.documentElement)return;i.isDoubleTap(T,A,Ie);return}if(O==="touch"){i.isDoubleTap(T,A,Ie);return}O!=="click"&&O!=="dblclick"&&i.emit(ta.Hover,{x:T,y:A,lngLat:Ie,type:O,target:y})}),i}return(0,Oe.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ta.Hover)}},{key:"triggerHover",value:function(o){var c=o.x,d=o.y;this.emit(ta.Hover,{x:c,y:d})}},{key:"triggerSelect",value:function(o){this.emit(ta.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(ta.Active,{featureId:o})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o){var c=new(ya()).Manager(o);c.add(new(ya()).Tap({event:"dblclick",taps:2})),c.add(new(ya()).Tap({event:"click"})),c.add(new(ya()).Pan({threshold:0,pointers:0})),c.add(new(ya()).Press({})),c.on("dblclick click",this.onHammer),c.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=c}}},{key:"removeEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(o){var c=o.type,d=o.pointerType,y,_;d==="touch"?(_=Math.floor(o.pointers[0].clientY),y=Math.floor(o.pointers[0].clientX)):(_=Math.floor(o.srcEvent.y),y=Math.floor(o.srcEvent.x));var b=this.mapService.getMapContainer();if(b){var T=b.getBoundingClientRect(),A=T.top,O=T.left;y-=O,_-=A}var F=this.mapService.containerToLngLat([y,_]);return{x:y,y:_,lngLat:F,type:c,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,c,d){var y=this,_=new Date().getTime(),b="click";_-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-c)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),b="dblclick",this.emit(ta.Hover,{x:o,y:c,lngLat:d,type:b})):(this.lastClickTime=_,this.lastClickXY=[o,c],this.clickTimer=setTimeout(function(){b="click",y.emit(ta.Hover,{x:o,y:c,lngLat:d,type:b})},400))}}]),r}(me()),Hc=$r(pa.prototype,"mapService",[yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa))||pi),Zo=G(92137),tu=G(87757),ga=G.n(tu),re;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(re||(re={}));var Vl,Xc,gl,Eu,yc,Cu,ps,_l,Es,hs,Yc;function Gl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function qc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gl(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Kc=(Vl=(0,ae.b2)(),Xc=(0,ae.f3)(Q.IRendererService),gl=(0,ae.f3)(Q.IGlobalConfigService),Eu=(0,ae.f3)(Q.IInteractionService),yc=(0,ae.f3)(Q.ILayerService),Vl(Cu=(ps=function(){function e(){var n=this;(0,we.Z)(this,e),Tn(this,"rendererService",_l,this),Tn(this,"configService",Es,this),Tn(this,"interactionService",hs,this),Tn(this,"layerService",Yc,this),(0,M.Z)(this,"pickingFBO",void 0),(0,M.Z)(this,"width",0),(0,M.Z)(this,"height",0),(0,M.Z)(this,"alreadyInPicking",!1),(0,M.Z)(this,"pickBufferScale",1),(0,M.Z)(this,"pickFromPickingFBO",function(r,i){var o,c=i.x,d=i.y,y=i.lngLat,_=i.type,b=i.target,T=!1,A=n.rendererService,O=A.getViewportSize,F=A.readPixels,W=A.getContainer,J=W().getBoundingClientRect(),ue=J.width,Ie=J.height;ue*=qe,Ie*=qe;var rt=r.getLayerConfig(),lt=rt.enableHighlight,Tt=rt.enableSelect,Ot=c*qe,Zt=d*qe;if(Ot>ue-1*qe||Ot<0||Zt>Ie-1*qe||Zt<0)return!1;var Vt;if(Vt=F({x:Math.floor(Ot/n.pickBufferScale),y:Math.floor((Ie-(d+1)*qe)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Vt[0]!==0||Vt[1]!==0||Vt[2]!==0){var _r=jn(Vt),Zr=r.getSource().getFeatureById(_r);_r!==r.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");var Yr={x:c,y:d,type:_,lngLat:y,featureId:_r,feature:Zr,target:b};Zr&&(T=!0,r.setCurrentPickId(_r),n.triggerHoverOnLayer(r,Yr))}else{var Cr={x:c,y:d,lngLat:y,type:r.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:b,feature:null};n.triggerHoverOnLayer(r,qc(qc({},Cr),{},{type:"unpick"})),n.triggerHoverOnLayer(r,Cr),r.setCurrentPickId(null)}if(lt&&n.highlightPickedFeature(r,Vt),Tt&&_==="click"&&((o=Vt)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var sn=jn(Vt);r.getCurrentSelectedId()===null||sn!==r.getCurrentSelectedId()?(n.selectFeature(r,Vt),r.setCurrentSelectedId(sn)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return T})}return(0,Oe.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,o=i.createTexture2D,c=i.createFramebuffer,d=i.getViewportSize,y=i.getContainer,_=y().getBoundingClientRect(),b=_.width,T=_.height;b*=qe,T*=qe,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=c({color:o({width:Math.round(b/this.pickBufferScale),height:Math.round(T/this.pickBufferScale),wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.interactionService.on(ta.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o,c,d){var y=this,_,b,T,A;return ga().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:_=this.rendererService,b=_.useFramebuffer,T=_.clear,A=_.getContainer,this.resizePickingFBO(),b(this.pickingFBO,function(){T({framebuffer:y.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var W=y.pickBox(o,c);d(W)});case 3:case"end":return F.stop()}},i,this)}));function r(i,o,c){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var o=this,c=i.map(function(Cr){var sn=Cr<0?0:Cr;return Math.floor(sn*qe/o.pickBufferScale)}),d=(0,Dt.Z)(c,4),y=d[0],_=d[1],b=d[2],T=d[3],A=this.rendererService,O=A.getViewportSize,F=A.readPixels,W=A.getContainer,J=W().getBoundingClientRect(),ue=J.width,Ie=J.height;if(ue*=qe,Ie*=qe,y>(ue-1)*qe/this.pickBufferScale||b<0||_>(Ie-1)*qe/this.pickBufferScale||T<0)return[];var rt,lt=Math.min(ue/this.pickBufferScale,b)-y,Tt=Math.min(Ie/this.pickBufferScale,T)-_;rt=F({x:y,y:Math.floor(Ie/this.pickBufferScale-(T+1)),width:lt,height:Tt,data:new Uint8Array(lt*Tt*4),framebuffer:this.pickingFBO});for(var Ot=[],Zt={},Vt=0;Vt<rt.length/4;Vt=Vt+1){var _r=rt.slice(Vt*4,Vt*4+4),Zr=jn(_r);if(Zr!==-1&&!Zt[Zr]){var Yr=r.getSource().getFeatureById(Zr);Ot.push(Yr),Zt[Zr]=!0}}return Ot}},{key:"pickingAllLayer",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){return ga().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){d.next=2;break}return d.abrupt("return");case 2:return this.alreadyInPicking=!0,d.next=5,this.pickingLayers(o);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return d.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=r().getBoundingClientRect(),o=i.width,c=i.height;o*=qe,c*=qe,(this.width!==o||this.height!==c)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(c/this.pickBufferScale)}),this.width=o,this.height=c)}},{key:"pickingLayers",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){var c=this,d,y,_,b,T;return ga().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:d=this.rendererService,y=d.getViewportSize,_=d.useFramebuffer,b=d.clear,T=d.getContainer,this.resizePickingFBO(),_(this.pickingFBO,function(){var F=c.layerService.getLayers();F.filter(function(W){return W.needPick(o.type)}).reverse().some(function(W){b({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),W.hooks.beforePickingEncode.call(),W.renderModels(),W.hooks.afterPickingEncode.call();var J=c.pickFromPickingFBO(W,o);return J&&!W.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){r.emit(i.type,i)}},{key:"isEventCrash",value:function(r){var i=!0;return r.target.path.map(function(o){o.classList&&o.classList.forEach(function(c){(c==="l7-marker"||c==="l7-popup")&&(i=!1)})}),i}},{key:"highlightPickedFeature",value:function(r,i){var o=(0,Dt.Z)(i,3),c=o[0],d=o[1],y=o[2];r.hooks.beforeHighlight.call([c,d,y])}},{key:"selectFeature",value:function(r,i){var o=(0,Dt.Z)(i,3),c=o[0],d=o[1],y=o[2];r.hooks.beforeSelect.call([c,d,y])}}]),e}(),_l=$r(ps.prototype,"rendererService",[Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es=$r(ps.prototype,"configService",[gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hs=$r(ps.prototype,"interactionService",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=$r(ps.prototype,"layerService",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps))||Cu),u=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,we.Z)(this,e),(0,M.Z)(this,"autoStart",void 0),(0,M.Z)(this,"startTime",0),(0,M.Z)(this,"oldTime",0),(0,M.Z)(this,"running",!1),(0,M.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,Oe.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),f,l,h,x,S,E,P,R=(f=(0,ae.b2)(),l=(0,ae.f3)(Q.IRendererService),h=(0,ae.f3)(Q.IGlobalConfigService),f(x=(S=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"clock",new u),(0,M.Z)(this,"alreadyInRendering",!1),(0,M.Z)(this,"layers",[]),(0,M.Z)(this,"layerRenderID",void 0),(0,M.Z)(this,"sceneInited",!1),(0,M.Z)(this,"animateInstanceCount",0),Tn(this,"renderService",E,this),Tn(this,"configService",P,this)}return(0,Oe.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"remove",value:function(r){var i=this.layers.indexOf(r);i>-1&&this.layers.splice(i,1),r.emit("remove",null),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(r){return r.inited}).filter(function(r){return r.isVisible()}).forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(r,i){return r.zIndex-i.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),e}(),E=$r(S.prototype,"renderService",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=$r(S.prototype,"configService",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S))||x),z=G(81253),j=G(85061),ee=G(14293),ne=G.n(ee),Ae=function(){function e(n){var r=this;(0,we.Z)(this,e),(0,M.Z)(this,"name",void 0),(0,M.Z)(this,"type",void 0),(0,M.Z)(this,"scale",void 0),(0,M.Z)(this,"descriptor",void 0),(0,M.Z)(this,"featureBufferLayout",[]),(0,M.Z)(this,"needRescale",!1),(0,M.Z)(this,"needRemapping",!1),(0,M.Z)(this,"needRegenerateVertices",!1),(0,M.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,M.Z)(this,"vertexAttribute",void 0),(0,M.Z)(this,"defaultCallback",function(i){if(i.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return i.map(function(c,d){var y,_=(y=r.scale)===null||y===void 0?void 0:y.scalers[d].func,b=_(c);return b})}),this.setProps(n)}return(0,Oe.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var o,c=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,j.Z)(r));if(!ne()(c))return[c]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Se=["buffer","update","name"],De,ge,Fe,Ge,at,Ct;function wt(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function At(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?wt(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Yt(e){return new Promise(function(n){return setTimeout(n,e)})}var br=(De={},(0,M.Z)(De,re.FLOAT,4),(0,M.Z)(De,re.UNSIGNED_BYTE,1),(0,M.Z)(De,re.UNSIGNED_SHORT,2),De),pr=(ge=(0,ae.b2)(),Fe=(0,ae.f3)(Q.IRendererService),ge(Ge=(at=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"attributesAndIndices",void 0),Tn(this,"rendererService",Ct,this),(0,M.Z)(this,"attributes",[]),(0,M.Z)(this,"triangulation",void 0),(0,M.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Oe.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new Ae(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,o){var c=this.getLayerStyleAttribute(r);c||(c=this.registerStyleAttribute(At(At({},i),{},{name:r})));var d=i.scale;d&&c&&(c.scale=d,c.needRescale=!0,c.needRemapping=!0,c.needRegenerateVertices=!0,o&&o.featureRange&&(c.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,o=this.getLayerStyleAttribute(r),c=o==null||(i=o.scale)===null||i===void 0?void 0:i.scalers;return c&&c[0]?c[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(Tt){return Tt.name===r});if(d&&d.descriptor){var y=d.descriptor,_=y.update,b=y.buffer,T=y.size,A=T===void 0?0:T,O=br[b.type||re.FLOAT];if(_){var F=this.featureLayout,W=F.elements,J=F.sizePerElement,ue=W.slice(o,c);if(!ue.length)return;var Ie=ue[0].offset,rt=Ie*A*O,lt=ue.map(function(Tt,Ot){for(var Zt=Tt.featureIdx,Vt=Tt.vertices,_r=Tt.normals,Zr=Vt.length/J,Yr=[],Cr=0;Cr<Zr;Cr++){var sn=_r?_r.slice(Cr*3,Cr*3+3):[];Yr.push.apply(Yr,(0,j.Z)(_(i[Zt],Zt,Vt.slice(Cr*J,Cr*J+J),Ot,sn)))}return Yr}).reduce(function(Tt,Ot){return Tt.push.apply(Tt,(0,j.Z)(Ot)),Tt},[]);d.vertexAttribute.updateBuffer({data:lt,offset:rt})}}}},{key:"createAttributesAndIndices",value:function(r,i){var o=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var c=this.attributes.map(function(Ie){return Ie.resetDescriptor(),Ie.descriptor}),d=0,y=[],_=[],b=[],T=3;r.forEach(function(Ie,rt){var lt=o.triangulation(Ie),Tt=lt.indices,Ot=lt.vertices,Zt=lt.normals,Vt=lt.size;Tt.forEach(function(Cr){_.push(Cr+d)}),T=Vt;var _r=Ot.length/Vt;o.featureLayout.sizePerElement=T,o.featureLayout.elements.push({featureIdx:rt,vertices:Ot,normals:Zt,offset:d}),d+=_r;for(var Zr=function(sn){var Ln=(Zt==null?void 0:Zt.slice(sn*3,sn*3+3))||[],Hn=Ot.slice(sn*Vt,sn*Vt+Vt);c.forEach(function(Ga,Ls){if(Ga&&Ga.update){var Ys;(Ys=Ga.buffer.data).push.apply(Ys,(0,j.Z)(Ga.update(Ie,rt,Hn,sn,Ln)))}})},Yr=0;Yr<_r;Yr++)Zr(Yr)});var A=this.rendererService,O=A.createAttribute,F=A.createBuffer,W=A.createElements,J={};c.forEach(function(Ie,rt){if(Ie){var lt=Ie.buffer,Tt=Ie.update,Ot=Ie.name,Zt=(0,z.Z)(Ie,Se),Vt=O(At({buffer:F(lt)},Zt));J[Ie.name||""]=Vt,o.attributes[rt].vertexAttribute=Vt}});var ue=W({data:_,type:re.UNSIGNED_INT,count:_.length});return this.attributesAndIndices={attributes:J,elements:ue},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ct=$r(at.prototype,"rendererService",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at))||Ge),Fr=G(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function rn(e,n,r,i){function o(c){return c instanceof r?c:new r(function(d){d(c)})}return new(r||(r=Promise))(function(c,d){function y(T){try{b(i.next(T))}catch(A){d(A)}}function _(T){try{b(i.throw(T))}catch(A){d(A)}}function b(T){T.done?c(T.value):o(T.value).then(y,_)}b((i=i.apply(e,n||[])).next())})}function fn(e,n){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},i,o,c,d;return d={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function y(b){return function(T){return _([b,T])}}function _(b){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(c=b[0]&2?o.return:b[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,b[1])).done)return c;switch(o=0,c&&(b=[b[0]&2,c.value]),b[0]){case 0:case 1:c=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,o=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!c||b[1]>c[0]&&b[1]<c[3])){r.label=b[1];break}if(b[0]===6&&r.label<c[1]){r.label=c[1],c=b;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(b);break}c[2]&&r.ops.pop(),r.trys.pop();continue}b=n.call(e,r)}catch(T){b=[6,T],o=0}finally{i=c=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function cn(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),o,c=[],d;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)c.push(o.value)}catch(y){d={error:y}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(d)throw d.error}}return c}function hi(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(cn(arguments[n]));return e}function gr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Jr(e,n){return n={exports:{}},e(n,n.exports),n.exports}var kn=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});gr(kn);var wn=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];var c=i.pop();return r.call(this,i,c)}},e.exports=n.default});gr(wn);var vn=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=o,n.wrap=c;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof Fr=="object"&&typeof Fr.nextTick=="function";function o(y){setTimeout(y,0)}function c(y){return function(_){for(var b=[],T=arguments.length-1;T-- >0;)b[T]=arguments[T+1];return y(function(){return _.apply(void 0,b)})}}var d;r?d=setImmediate:i?d=Fr.nextTick:d=o,n.default=c(d)});gr(vn);var Zn=vn.fallback,Sn=vn.wrap,_n=vn.hasSetImmediate,Ba=vn.hasNextTick,Wi=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(wn),i=o(vn);function o(_){return _&&_.__esModule?_:{default:_}}function c(_){return(0,Gi.isAsync)(_)?function(){for(var b=[],T=arguments.length;T--;)b[T]=arguments[T];var A=b.pop(),O=_.apply(this,b);return d(O,A)}:(0,r.default)(function(b,T){var A;try{A=_.apply(this,b)}catch(O){return T(O)}if(A&&typeof A.then=="function")return d(A,T);T(null,A)})}function d(_,b){return _.then(function(T){y(b,null,T)},function(T){y(b,T&&T.message?T:new Error(T))})}function y(_,b,T){try{_(b,T)}catch(A){(0,i.default)(function(O){throw O},A)}}e.exports=n.default});gr(Wi);var Gi=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(Wi);function i(_){return _&&_.__esModule?_:{default:_}}function o(_){return _[Symbol.toStringTag]==="AsyncFunction"}function c(_){return _[Symbol.toStringTag]==="AsyncGenerator"}function d(_){return typeof _[Symbol.asyncIterator]=="function"}function y(_){if(typeof _!="function")throw new Error("expected a function");return o(_)?(0,r.default)(_):_}n.default=y,n.isAsync=o,n.isAsyncGenerator=c,n.isAsyncIterable=d});gr(Gi);var no=Gi.isAsyncIterable,ra=Gi.isAsyncGenerator,_a=Gi.isAsync,Na=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,o){if(o===void 0&&(o=i.length),!o)throw new Error("arity is undefined");function c(){for(var d=this,y=[],_=arguments.length;_--;)y[_]=arguments[_];return typeof y[o-1]=="function"?i.apply(this,y):new Promise(function(b,T){y[o-1]=function(A){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(A)return T(A);b(O.length>1?O:O[0])},i.apply(d,y)})}return Object.defineProperty(c,"name",{configurable:!0,value:"awaitable("+i.name+")"}),c}e.exports=n.default});gr(Na);var io=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=c(kn),i=c(Gi),o=c(Na);function c(d){return d&&d.__esModule?d:{default:d}}n.default=(0,o.default)(function(d,y,_){var b=(0,r.default)(y)?[]:{};d(y,function(T,A,O){(0,i.default)(T)(function(F){for(var W,J=[],ue=arguments.length-1;ue-- >0;)J[ue]=arguments[ue+1];J.length<2&&(W=J,J=W[0]),b[A]=J,O(F)})},function(T){return _(T,b)})},3),e.exports=n.default});gr(io);var Cs=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function o(){for(var c=[],d=arguments.length;d--;)c[d]=arguments[d];if(i!==null){var y=i;i=null,y.apply(this,c)}}return Object.assign(o,i),o}e.exports=n.default});gr(Cs);var fo=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});gr(fo);var Jo=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=_;var r=o(kn),i=o(fo);function o(b){return b&&b.__esModule?b:{default:b}}function c(b){var T=-1,A=b.length;return function(){return++T<A?{value:b[T],key:T}:null}}function d(b){var T=-1;return function(){var O=b.next();return O.done?null:(T++,{value:O.value,key:T})}}function y(b){var T=b?Object.keys(b):[],A=-1,O=T.length;return function(){var W=T[++A];return A<O?{value:b[W],key:W}:null}}function _(b){if((0,r.default)(b))return c(b);var T=(0,i.default)(b);return T?d(T):y(b)}e.exports=n.default});gr(Jo);var Mo=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var o=[],c=arguments.length;c--;)o[c]=arguments[c];if(i===null)throw new Error("Callback was already called.");var d=i;i=null,d.apply(this,o)}}e.exports=n.default});gr(Mo);var ru=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});gr(ru);var Gu=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var r=i(ru);function i(c){return c&&c.__esModule?c:{default:c}}function o(c,d,y,_){var b=!1,T=!1,A=!1,O=0,F=0;function W(){O>=d||A||b||(A=!0,c.next().then(function(Ie){var rt=Ie.value,lt=Ie.done;if(!(T||b)){if(A=!1,lt){b=!0,O<=0&&_(null);return}O++,y(rt,F,J),F++,W()}}).catch(ue))}function J(Ie,rt){if(O-=1,!T){if(Ie)return ue(Ie);if(Ie===!1){b=!0,T=!0;return}if(rt===r.default||b&&O<=0)return b=!0,_(null);W()}}function ue(Ie){T||(A=!1,b=!0,_(Ie))}W()}e.exports=n.default});gr(Gu);var nu=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=y(Cs),i=y(Jo),o=y(Mo),c=y(Gu),d=y(ru);function y(_){return _&&_.__esModule?_:{default:_}}n.default=function(_){return function(b,T,A){if(A=(0,r.default)(A),_<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!b)return A(null);if((0,Gi.isAsyncGenerator)(b))return(0,c.default)(b,_,T,A);if((0,Gi.isAsyncIterable)(b))return(0,c.default)(b[Symbol.asyncIterator](),_,T,A);var O=(0,i.default)(b),F=!1,W=!1,J=0,ue=!1;function Ie(lt,Tt){if(!W)if(J-=1,lt)F=!0,A(lt);else if(lt===!1)F=!0,W=!0;else{if(Tt===d.default||F&&J<=0)return F=!0,A(null);ue||rt()}}function rt(){for(ue=!0;J<_&&!F;){var lt=O();if(lt===null){F=!0,J<=0&&A(null);return}J+=1,T(lt.value,lt.key,(0,o.default)(Ie))}ue=!1}rt()}},e.exports=n.default});gr(nu);var iu=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=c(nu),i=c(Gi),o=c(Na);function c(y){return y&&y.__esModule?y:{default:y}}function d(y,_,b,T){return(0,r.default)(_)(y,(0,i.default)(b),T)}n.default=(0,o.default)(d,4),e.exports=n.default});gr(iu);var xl=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=o(iu),i=o(Na);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y,_){return(0,r.default)(d,1,y,_)}n.default=(0,i.default)(c,3),e.exports=n.default});gr(xl);var zs=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(io),i=o(xl);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y){return(0,r.default)(i.default,d,y)}e.exports=n.default}),Hu=gr(zs),za=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,Hu(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(o){r.apply(void 0,hi(i.args)),o(null,n)})},e}(),na=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=b(kn),i=b(ru),o=b(iu),c=b(Cs),d=b(Mo),y=b(Gi),_=b(Na);function b(F){return F&&F.__esModule?F:{default:F}}function T(F,W,J){J=(0,c.default)(J);var ue=0,Ie=0,rt=F.length,lt=!1;rt===0&&J(null);function Tt(Ot,Zt){Ot===!1&&(lt=!0),lt!==!0&&(Ot?J(Ot):(++Ie===rt||Zt===i.default)&&J(null))}for(;ue<rt;ue++)W(F[ue],ue,(0,d.default)(Tt))}function A(F,W,J){return(0,o.default)(F,Infinity,W,J)}function O(F,W,J){var ue=(0,r.default)(F)?T:A;return ue(F,(0,y.default)(W),J)}n.default=(0,_.default)(O,3),e.exports=n.default});gr(na);var au=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(na),i=o(io);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y){return(0,i.default)(r.default,d,y)}e.exports=n.default}),Zs=gr(au),Uo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Zs(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(o){return rn(i,void 0,void 0,function(){return fn(this,function(c){switch(c.label){case 0:return[4,r()];case 1:return c.sent(),o(null,n),[2]}})})})},e}(),vi=Jr(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=d(Cs),i=d(Mo),o=d(Gi),c=d(Na);function d(_){return _&&_.__esModule?_:{default:_}}function y(_,b){if(b=(0,r.default)(b),!Array.isArray(_))return b(new Error("First argument to waterfall must be an array of functions"));if(!_.length)return b();var T=0;function A(F){var W=(0,o.default)(_[T++]);W.apply(void 0,F.concat([(0,i.default)(O)]))}function O(F){for(var W=[],J=arguments.length-1;J-- >0;)W[J]=arguments[J+1];if(F!==!1){if(F||T===_.length)return b.apply(void 0,[F].concat(W));A(W)}}A([])}n.default=(0,c.default)(y),e.exports=n.default}),ao=gr(vi),oo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return ao(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var o=r();i(o?null:!1,o)}):this.tasks.push(function(i,o){var c=r();o(c?null:!1,n)})},e}(),ds=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Hu(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var o=r();i(o,n)})},e}(),Wu=G(67709),ou=G.n(Wu),Hl=window.document.documentElement.style,Xu=0;function gc(e){var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Xu++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}var Us,bl,$c,js,qa,uh,Ep,Cp,Tp,Ap,lh,wl,ch,kf,Mp,Yu,Jc,jo,fh,ph,hh,dh,vh,mh,op,yh,Sl,Lf,ia,Wl,Rf,Xl,Yl;function ql(e){var n=sp();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Df=(Us=(0,ae.b2)(),bl=(0,ae.f3)(Q.SceneID),$c=(0,ae.f3)(Q.IIconService),js=(0,ae.f3)(Q.IFontService),qa=(0,ae.f3)(Q.IControlService),uh=(0,ae.f3)(Q.IGlobalConfigService),Ep=(0,ae.f3)(Q.IMapService),Cp=(0,ae.f3)(Q.ICoordinateSystemService),Tp=(0,ae.f3)(Q.IRendererService),Ap=(0,ae.f3)(Q.ILayerService),lh=(0,ae.f3)(Q.ICameraService),wl=(0,ae.f3)(Q.IInteractionService),ch=(0,ae.f3)(Q.IPickingService),kf=(0,ae.f3)(Q.IShaderModuleService),Mp=(0,ae.f3)(Q.IMarkerService),Yu=(0,ae.f3)(Q.IPopupService),Us(Jc=(jo=function(e){(0,Je.Z)(r,e);var n=ql(r);function r(){var i;return(0,we.Z)(this,r),i=n.call(this),(0,M.Z)((0,H.Z)(i),"destroyed",!1),(0,M.Z)((0,H.Z)(i),"loaded",!1),(0,M.Z)((0,H.Z)(i),"loadFont",!1),(0,M.Z)((0,H.Z)(i),"fontFamily",""),Tn((0,H.Z)(i),"id",fh,(0,H.Z)(i)),Tn((0,H.Z)(i),"iconService",ph,(0,H.Z)(i)),Tn((0,H.Z)(i),"fontService",hh,(0,H.Z)(i)),Tn((0,H.Z)(i),"controlService",dh,(0,H.Z)(i)),Tn((0,H.Z)(i),"configService",vh,(0,H.Z)(i)),Tn((0,H.Z)(i),"map",mh,(0,H.Z)(i)),Tn((0,H.Z)(i),"coordinateSystemService",op,(0,H.Z)(i)),Tn((0,H.Z)(i),"rendererService",yh,(0,H.Z)(i)),Tn((0,H.Z)(i),"layerService",Sl,(0,H.Z)(i)),Tn((0,H.Z)(i),"cameraService",Lf,(0,H.Z)(i)),Tn((0,H.Z)(i),"interactionService",ia,(0,H.Z)(i)),Tn((0,H.Z)(i),"pickingService",Wl,(0,H.Z)(i)),Tn((0,H.Z)(i),"shaderModuleService",Rf,(0,H.Z)(i)),Tn((0,H.Z)(i),"markerService",Xl,(0,H.Z)(i)),Tn((0,H.Z)(i),"popupService",Yl,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"inited",!1),(0,M.Z)((0,H.Z)(i),"initPromise",void 0),(0,M.Z)((0,H.Z)(i),"rendering",!1),(0,M.Z)((0,H.Z)(i),"$container",void 0),(0,M.Z)((0,H.Z)(i),"canvas",void 0),(0,M.Z)((0,H.Z)(i),"markerContainer",void 0),(0,M.Z)((0,H.Z)(i),"hooks",void 0),(0,M.Z)((0,H.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),Ve(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,M.Z)((0,H.Z)(i),"handleMapCameraChanged",function(o){i.cameraService.update(o),i.render()}),i.hooks={init:new Uo},i}return(0,Oe.Z)(r,[{key:"init",value:function(o){var c=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Zo.Z)(ga().mark(function d(){return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(b){c.map.onCameraChanged(function(T){c.cameraService.init(),c.cameraService.update(T),c.map.version!=="GAODE2.x"&&b()}),c.map.version!=="GAODE2.x"?c.map.init():b()});case 2:if(!(c.map.version==="GAODE2.x"&&c.map.initViewPort)){_.next=6;break}return _.next=5,c.map.init();case 5:c.map.initViewPort();case 6:c.map.onCameraChanged(c.handleMapCameraChanged),c.map.addMarkerContainer(),c.markerService.addMarkers(),c.markerService.addMarkerLayers(),c.popupService.initPopup(),c.interactionService.init(),c.interactionService.on(ta.Drag,c.addSceneEvent.bind(c));case 13:case"end":return _.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,Zo.Z)(ga().mark(function d(){var y;return ga().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(y=gc(c.configService.getSceneConfig(c.id).id||""),c.$container=y,!y){b.next=11;break}return c.canvas=Ft("canvas","",y),c.setCanvas(),b.next=7,c.rendererService.init(c.canvas,c.configService.getSceneConfig(c.id));case 7:ou()(c.$container,c.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(c.handleWindowResized),b.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:c.pickingService.init(c.id);case 13:case"end":return b.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.add(o),this.render()}},{key:"render",value:function(){var i=(0,Zo.Z)(ga().mark(function c(){return ga().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.rendering||this.destroyed)){y.next=2;break}return y.abrupt("return");case 2:if(this.rendering=!0,this.inited){y.next=15;break}return y.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){y.next=10;break}return y.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return y.stop()}},c,this)}));function o(){return i.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,c){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(c,`') format('woff2'),
            url('`).concat(c,`') format('woff'),
            url('`).concat(c,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var c,d=(c=this.$container)===null||c===void 0?void 0:c.getElementsByTagName("canvas")[0];this.render();var y=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return y}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=Ft("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,Wu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var o,c,d=qe,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((c=this.$container)===null||c===void 0?void 0:c.clientHeight)||300,b=this.canvas;b&&(b.width=y*d,b.height=_*d,b.style.width="".concat(y,"px"),b.style.height="".concat(_,"px")),this.rendererService.viewport({x:0,y:0,width:d*y,height:d*_})}},{key:"setCanvas",value:function(){var o,c,d=qe,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((c=this.$container)===null||c===void 0?void 0:c.clientHeight)||300,b=this.canvas;b.width=y*d,b.height=_*d,b.style.width="".concat(y,"px"),b.style.height="".concat(_,"px")}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(se.EventEmitter),fh=$r(jo.prototype,"id",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=$r(jo.prototype,"iconService",[$c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=$r(jo.prototype,"fontService",[js],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=$r(jo.prototype,"controlService",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=$r(jo.prototype,"configService",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=$r(jo.prototype,"map",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op=$r(jo.prototype,"coordinateSystemService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=$r(jo.prototype,"rendererService",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=$r(jo.prototype,"layerService",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf=$r(jo.prototype,"cameraService",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ia=$r(jo.prototype,"interactionService",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=$r(jo.prototype,"pickingService",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=$r(jo.prototype,"shaderModuleService",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=$r(jo.prototype,"markerService",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yl=$r(jo.prototype,"popupService",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jo))||Jc),Kl=G(44908),_c=G.n(Kl);function xc(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var Ff=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function qu(e){var n={};return e=e.replace(Ff,function(r,i,o){var c=o.split(":"),d=c[0].trim(),y="";switch(c.length>1&&(y=c[1].trim()),i){case"bool":y=y==="true";break;case"float":case"int":y=Number(y);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":y?y=y.replace("[","").replace("]","").split(",").reduce(function(_,b){return _.push(Number(b.trim())),_},[]):y=new Array(xc(i)).fill(0);break;default:}return n[d]=y,"uniform ".concat(i," ").concat(d,`;
`)}),{content:e,uniforms:n}}var Qc,$l;function Pp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Tu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Pp(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Ku="#define PI 3.14159265359",su=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Ip=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,$h=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Jh=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Qh=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,El=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,bc=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,gh=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,_h=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,xh=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Op=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,ed=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,$u=/precision\s+(high|low|medium)p\s+float/,wc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,ef=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Ju=(Qc=(0,ae.b2)(),Qc($l=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"moduleCache",{}),(0,M.Z)(this,"rawContentCache",{})}return(0,Oe.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ku,fs:Ku}),this.registerModule("decode",{vs:su,fs:""}),this.registerModule("projection",{vs:bc,fs:""}),this.registerModule("project",{vs:El,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:gh}),this.registerModule("lighting",{vs:$h,fs:""}),this.registerModule("light",{vs:Ip,fs:""}),this.registerModule("picking",{vs:Qh,fs:Jh}),this.registerModule("styleMapping",{vs:_h,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:xh,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Op,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:ed,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var o=i.vs,c=i.fs,d=i.uniforms,y=qu(o),_=y.content,b=y.uniforms,T=qu(c),A=T.content,O=T.uniforms;this.rawContentCache[r]={fs:A,uniforms:Tu(Tu(Tu({},b),O),d),vs:_}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,c=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),y=d.content,_=d.includeList,b=this.processModule(c,[],"fs"),T=b.content,A=b.includeList,O=T,F=_c()(_.concat(A).concat(r)).reduce(function(W,J){return Tu(Tu({},W),i.rawContentCache[J].uniforms)},{});return $u.test(T)||(O=wc+T),this.moduleCache[r]={fs:O.trim(),uniforms:F,vs:y.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,o){var c=this,d=r.replace(ef,function(y,_){var b=_.split(" "),T=b[0].replace(/"/g,"");if(i.indexOf(T)>-1)return"";var A=c.rawContentCache[T][o];i.push(T);var O=c.processModule(A,i,o),F=O.content;return F});return{content:d,includeList:i}}}]),e}())||$l);function tf(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&(e=(0,gt.Z)(e),e!==null););return e}function go(e,n,r){return typeof Reflect!="undefined"&&Reflect.get?go=Reflect.get:go=function(o,c,d){var y=tf(o,c);if(!!y){var _=Object.getOwnPropertyDescriptor(y,c);return _.get?_.get.call(d):_.value}},go(e,n,r||e)}var Au;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Au||(Au={}));var kp,Qo,Vs,xa,vs,Bf=(kp=(0,ae.b2)(),Qo=(0,ae.f3)(Q.IShaderModuleService),kp(Vs=(xa=function(){function e(){(0,we.Z)(this,e),Tn(this,"shaderModuleService",vs,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"cameraService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"interactionService",void 0),(0,M.Z)(this,"layerService",void 0),(0,M.Z)(this,"config",void 0)}return(0,Oe.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Au.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Q.IRendererService),this.cameraService=r.getContainer().get(Q.ICameraService),this.mapService=r.getContainer().get(Q.IMapService),this.interactionService=r.getContainer().get(Q.IInteractionService),this.layerService=r.getContainer().get(Q.ILayerService)}},{key:"render",value:function(r){}}]),e}(),vs=$r(xa.prototype,"shaderModuleService",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa))||Vs),bh,wh;function Sh(e){var n=Vo();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Vo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eh=(bh=(0,ae.b2)(),bh(wh=function(e){(0,Je.Z)(r,e);var n=Sh(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,c){go((0,gt.Z)(r.prototype),"init",this).call(this,o,c)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Bf))||wh),Lp,Rp,Ch,up,Th;function Ah(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mh(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Mh(e,n){if(!!e){if(typeof e=="string")return lp(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lp(e,n)}}function lp(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var td=(Lp=(0,ae.b2)(),Rp=(0,ae.f3)(Q.IPostProcessor),Lp(Ch=(up=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"passes",[]),Tn(this,"postProcessor",Th,this),(0,M.Z)(this,"layer",void 0),(0,M.Z)(this,"renderFlag",void 0),(0,M.Z)(this,"width",0),(0,M.Z)(this,"height",0)}return(0,Oe.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,Zo.Z)(ga().mark(function i(){var o,c,d;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=Ah(this.passes),_.prev=1,o.s();case 3:if((c=o.n()).done){_.next=9;break}return d=c.value,_.next=7,d.render(this.layer);case 7:_.next=3;break;case 9:_.next=14;break;case 11:_.prev=11,_.t0=_.catch(1),o.e(_.t0);case 14:return _.prev=14,o.f(),_.finish(14);case 17:this.layer.renderModels();case 18:case"end":return _.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===Au.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,o){r.init(this.layer,i),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Th=$r(up.prototype,"postProcessor",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up))||Ch),Ph,Sc;function Dp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function k(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Dp(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ie(e){var n=ye();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ye(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _t=(Ph=(0,ae.b2)(),Ph(Sc=function(e){(0,Je.Z)(r,e);var n=ie(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"pickingFBO",void 0),(0,M.Z)((0,H.Z)(i),"layer",void 0),(0,M.Z)((0,H.Z)(i),"width",0),(0,M.Z)((0,H.Z)(i),"height",0),(0,M.Z)((0,H.Z)(i),"alreadyInRendering",!1),(0,M.Z)((0,H.Z)(i),"pickFromPickingFBO",function(y){var _=y.x,b=y.y,T=y.lngLat,A=y.type;if(!(!i.layer.isVisible()||!i.layer.needPick(A))){var O=i.rendererService,F=O.getViewportSize,W=O.readPixels,J=O.useFramebuffer,ue=F(),Ie=ue.width,rt=ue.height,lt=i.layer.getLayerConfig(),Tt=lt.enableHighlight,Ot=lt.enableSelect,Zt=_*qe,Vt=b*qe;if(!(Zt>Ie||Zt<0||Vt>rt||Vt<0)){var _r;J(i.pickingFBO,function(){var Zr;if(_r=W({x:Math.round(Zt),y:Math.round(rt-(b+1)*qe),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),_r[0]!==0||_r[1]!==0||_r[2]!==0){var Yr=jn(_r),Cr=i.layer.getSource().getFeatureById(Yr),sn={x:_,y:b,type:A,lngLat:T,featureId:Yr,feature:Cr};Cr&&(i.layer.setCurrentPickId(Yr),i.triggerHoverOnLayer(sn))}else{var Ln={x:_,y:b,lngLat:T,type:i.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(k(k({},Ln),{},{type:"unpick"})),i.triggerHoverOnLayer(Ln),i.layer.setCurrentPickId(null)}Tt&&i.highlightPickedFeature(_r),Ot&&A==="click"&&((Zr=_r)===null||Zr===void 0?void 0:Zr.toString())!==[0,0,0,0].toString()&&i.selectFeature(_r)})}}}),i}return(0,Oe.Z)(r,[{key:"getType",value:function(){return Au.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,c){go((0,gt.Z)(r.prototype),"init",this).call(this,o,c),this.layer=o;var d=this.rendererService,y=d.createTexture2D,_=d.createFramebuffer,b=d.getViewportSize,T=b(),A=T.width,O=T.height;this.pickingFBO=_({color:y({width:A,height:O,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.interactionService.on(ta.Hover,this.pickFromPickingFBO),this.interactionService.on(ta.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ta.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var c=this;if(!this.alreadyInRendering){var d=this.rendererService,y=d.getViewportSize,_=d.useFramebuffer,b=d.clear,T=y(),A=T.width,O=T.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==O)&&(this.pickingFBO.resize({width:A,height:O}),this.width=A,this.height=O),_(this.pickingFBO,function(){b({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=c.layer.multiPassRenderer.getRenderFlag();c.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),c.layer.multiPassRenderer.setRenderFlag(F),c.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var c=(0,Dt.Z)(o,3),d=c[0],y=c[1],_=c[2];this.layer.hooks.beforeHighlight.call([d,y,_]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var c=(0,Dt.Z)(o,3),d=c[0],y=c[1],_=c[2];this.layer.hooks.beforeSelect.call([d,y,_]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var c=o.featureId,d=Ea(c);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var c=o.featureId,d=Ea(c);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(Bf))||Sc),Bt=G(11700),ht=G.n(Bt),Mt=G(68929),nr=G.n(Mt),ar,fr,or,mr,Ar;function rr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?rr(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var tt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xt=(ar=(0,ae.b2)(),fr=(0,ae.f3)(Q.IShaderModuleService),ar(or=(mr=function(){function e(){(0,we.Z)(this,e),Tn(this,"shaderModuleService",Ar,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"config",void 0),(0,M.Z)(this,"quad",tt),(0,M.Z)(this,"enabled",!0),(0,M.Z)(this,"renderToScreen",!1),(0,M.Z)(this,"model",void 0),(0,M.Z)(this,"name",void 0),(0,M.Z)(this,"optionsToUpdate",{})}return(0,Oe.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Au.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(Q.IRendererService);var o=this.rendererService,c=o.createAttribute,d=o.createBuffer,y=o.createModel,_=this.setupShaders(),b=_.vs,T=_.fs,A=_.uniforms;this.model=y({vs:b,fs:T,attributes:{a_Position:c({buffer:d({data:[-4,-4,4,-4,0,4],type:re.FLOAT}),size:2})},uniforms:vr(vr({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,o=r.multiPassRenderer.getPostProcessor(),c=this.rendererService,d=c.useFramebuffer,y=c.getViewportSize,_=c.clear,b=y(),T=b.width,A=b.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){_({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:vr({u_Texture:o.getReadFBO(),u_ViewportSize:[T,A]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=vr(vr({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(o){ne()(r[o])||(i["u_".concat(ht()(nr()(o)))]=r[o])}),i}}]),e}(),Ar=$r(mr.prototype,"shaderModuleService",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mr))||or),ir,kr;function Ht(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Nr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ht(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ht(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Qt(e){var n=Er();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Er(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,yr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ln=(ir=(0,ae.b2)(),ir(kr=function(e){(0,Je.Z)(r,e);var n=Qt(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:yr,fs:Wt});var o=this.shaderModuleService.getModule("blur-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:Nr(Nr({},y),{},{u_ViewportSize:[b,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var c={};return ne()(o.blurRadius)||(c.u_BlurDir=[o.blurRadius,0]),c}}]),r}(xt))||kr),pn,wr;function qt(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function jt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?qt(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qt(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xn(e){var n=yn();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function yn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Qn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Dn=(pn=(0,ae.b2)(),pn(wr=function(e){(0,Je.Z)(r,e);var n=xn(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Qn,fs:Kr});var o=this.shaderModuleService.getModule("blur-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:jt(jt({},y),{},{u_ViewportSize:[b,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var c={};return ne()(o.blurRadius)||(c.u_BlurDir=[0,o.blurRadius]),c}}]),r}(xt))||wr),Yn,gi;function ba(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function so(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ba(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ba(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ai(e){var n=ha();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hi=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Za=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ka=(Yn=(0,ae.b2)(),Yn(gi=function(e){(0,Je.Z)(r,e);var n=ai(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Za,fs:Hi});var o=this.shaderModuleService.getModule("colorhalftone-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:so(so({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(xt))||gi),$a,uo;function _o(e){var n=Ia();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Po=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ai=($a=(0,ae.b2)(),$a(uo=function(e){(0,Je.Z)(r,e);var n=_o(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Po,fs:Vn}),this.shaderModuleService.getModule("copy-pass")}}]),r}(xt))||uo),mn,ei;function ci(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function wa(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ci(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ci(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gs(e){var n=Qu();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Qu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _e=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,yt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ft=(mn=(0,ae.b2)(),mn(ei=function(e){(0,Je.Z)(r,e);var n=Gs(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:yt,fs:_e});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:wa(wa({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(xt))||ei),Vr,ti;function pe(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function $(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?pe(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Be(e){var n=Qe();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var et=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ue=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ne=(Vr=(0,ae.b2)(),Vr(ti=function(e){(0,Je.Z)(r,e);var n=Be(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ue,fs:et});var o=this.shaderModuleService.getModule("ink-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:$($({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(xt))||ti),Xe,de;function Re(e){var n=ce();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ce(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ke=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,it=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nt=(Xe=(0,ae.b2)(),Xe(de=function(e){(0,Je.Z)(r,e);var n=Re(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:it,fs:Ke}),this.shaderModuleService.getModule("noise-pass")}}]),r}(xt))||de),mt,Lt;function sr(e){var n=tn();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function tn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,bn=(mt=(0,ae.b2)(),mt(Lt=function(e){(0,Je.Z)(r,e);var n=sr(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:qn,fs:Qr}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(xt))||Lt),Fn,xi,Sa,es,Cl,Ts,Fp=(Fn=(0,ae.b2)(),xi=(0,ae.f3)(Q.IRendererService),Sa=(0,ae.zY)(),Fn(es=(Cl=function(){function e(){(0,we.Z)(this,e),Tn(this,"rendererService",Ts,this),(0,M.Z)(this,"passes",[]),(0,M.Z)(this,"readFBO",void 0),(0,M.Z)(this,"writeFBO",void 0)}return(0,Oe.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){var c,d;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:c=0;case 1:if(!(c<this.passes.length)){_.next=10;break}return d=this.passes[c],d.setRenderToScreen(this.isLastEnabledPass(c)),_.next=6,d.render(o);case 6:c!==this.passes.length-1&&this.swap();case 7:c++,_.next=1;break;case 10:case"end":return _.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,o){r.init(i,o),this.passes.push(r)}},{key:"insert",value:function(r,i,o,c){r.init(o,c),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Ts=$r(Cl.prototype,"rendererService",[xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$r(Cl.prototype,"init",[Sa],Object.getOwnPropertyDescriptor(Cl.prototype,"init"),Cl.prototype),Cl))||es),Hs,rf;function Nf(e){var n=rd();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function rd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cp=(Hs=(0,ae.b2)(),Hs(rf=function(e){(0,Je.Z)(r,e);var n=Nf(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getType",value:function(){return Au.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,c){go((0,gt.Z)(r.prototype),"init",this).call(this,o,c)}},{key:"render",value:function(o){var c=this.rendererService,d=c.useFramebuffer,y=c.clear;d(null,function(){y({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Bf))||rf),nd,Ja,qi,Ih,id;function ad(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function od(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ad(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ad(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Bd(e){var n=sd();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zf=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,nf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Nd=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Qa(e,n){for(var r=0,i=1/n,o=e;o>0;)r=r+i*(o%n),o=Math.floor(o/n),i=i/n;return r}var Bp=1,Ec=(nd=(0,ae.b2)(),Ja=(0,ae.f3)(Q.IShaderModuleService),nd(qi=(Ih=function(e){(0,Je.Z)(r,e);var n=Bd(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),Tn((0,H.Z)(i),"shaderModuleService",id,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"haltonSequence",[]),(0,M.Z)((0,H.Z)(i),"accumulatingId",0),(0,M.Z)((0,H.Z)(i),"frame",0),(0,M.Z)((0,H.Z)(i),"timer",void 0),(0,M.Z)((0,H.Z)(i),"sampleRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"prevRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"outputRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"copyRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"blendModel",void 0),(0,M.Z)((0,H.Z)(i),"outputModel",void 0),(0,M.Z)((0,H.Z)(i),"copyModel",void 0),i}return(0,Oe.Z)(r,[{key:"getType",value:function(){return Au.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,c){go((0,gt.Z)(r.prototype),"init",this).call(this,o,c);var d=this.rendererService,y=d.createFramebuffer,_=d.createTexture2D;this.sampleRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.prevRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.outputRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.copyRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})});for(var b=0;b<30;b++)this.haltonSequence.push([Qa(b,2),Qa(b,3)]);this.blendModel=this.createTriangleModel("blend-pass",zf),this.outputModel=this.createTriangleModel("copy-pass",nf,{blend:{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE_MINUS_SRC_ALPHA,srcAlpha:re.ONE,dstAlpha:re.ONE_MINUS_SRC_ALPHA},equation:{rgb:re.FUNC_ADD,alpha:re.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",nf)}},{key:"render",value:function(o){var c=this,d=this.rendererService,y=d.clear,_=d.getViewportSize,b=d.useFramebuffer,T=_(),A=T.width,O=T.height;this.sampleRenderTarget.resize({width:A,height:O}),this.prevRenderTarget.resize({width:A,height:O}),this.outputRenderTarget.resize({width:A,height:O}),this.copyRenderTarget.resize({width:A,height:O}),this.resetFrame(),this.stopAccumulating();var F=o.multiPassRenderer.getPostProcessor().getReadFBO();b(F,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var W=function J(ue){!c.accumulatingId||ue!==c.accumulatingId||c.isFinished()||(c.doRender(o),requestAnimationFrame(function(){J(ue)}))};this.accumulatingId=Bp++,this.timer=window.setTimeout(function(){W(c.accumulatingId)},50)}},{key:"doRender",value:function(o){var c=this,d=this.rendererService,y=d.clear,_=d.getViewportSize,b=d.useFramebuffer,T=_(),A=T.width,O=T.height,F=o.getLayerConfig(),W=F.jitterScale,J=W===void 0?1:W,ue=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ue[0]*2-1)/A*J,(ue[1]*2-1)/O*J),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),b(this.sampleRenderTarget,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Ie=o.getLayerConfig();b(this.outputRenderTarget,function(){c.blendModel.draw({uniforms:{u_opacity:Ie.opacity||1,u_MixRatio:c.frame===0?1:.9,u_Diffuse1:c.sampleRenderTarget,u_Diffuse2:c.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():c.prevRenderTarget}})}),this.frame===0&&y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(b(this.copyRenderTarget,function(){c.outputModel.draw({uniforms:{u_Texture:c.outputRenderTarget}})}),b(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){c.copyModel.draw({uniforms:{u_Texture:c.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var rt=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=rt,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,c,d){this.shaderModuleService.registerModule(o,{vs:Nd,fs:c});var y=this.shaderModuleService.getModule(o),_=y.vs,b=y.fs,T=y.uniforms,A=this.rendererService,O=A.createAttribute,F=A.createBuffer,W=A.createModel;return W(od({vs:_,fs:b,attributes:{a_Position:O({buffer:F({data:[-4,-4,4,-4,0,4],type:re.FLOAT}),size:2})},uniforms:od({},T),depth:{enable:!1},count:3},d))}}]),r}(Bf),id=$r(Ih.prototype,"shaderModuleService",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih))||qi),Cc=new ae.W2;Cc.bind(Q.IGlobalConfigService).to(ip).inSingletonScope(),Cc.bind(Q.IShaderModuleService).to(Ju).inSingletonScope(),(0,ae.GW)((0,ae.b2)(),se.EventEmitter),Cc.bind(Q.IEventEmitter).to(se.EventEmitter);var Np=(0,fe.Z)(Cc,!1),Zf=function(n){var r=Np.lazyInject(n);return function(i,o,c){r.call(this,i,o),c&&(c.initializer=function(){return i[o]})}},zp=function(n){var r=Np.lazyMultiInject(n);return function(i,o,c){r.call(this,i,o),c&&(c.initializer=function(){return i[o]})}},xo=Cc,zd=0;function Zd(){var e=new ae.W2;return e.parent=Cc,e.bind(Q.SceneID).toConstantValue("".concat(zd++)),e.bind(Q.ILayerService).to(R).inSingletonScope(),e.bind(Q.ISceneService).to(Df).inSingletonScope(),e.bind(Q.ICameraService).to(cl).inSingletonScope(),e.bind(Q.ICoordinateSystemService).to(yo).inSingletonScope(),e.bind(Q.IInteractionService).to(zo).inSingletonScope(),e.bind(Q.IPickingService).to(Kc).inSingletonScope(),e.bind(Q.IControlService).to(wf).inSingletonScope(),e.bind(Q.IMarkerService).to(Bl).inSingletonScope(),e.bind(Q.IIconService).to(Fc).inSingletonScope(),e.bind(Q.IFontService).to(kl).inSingletonScope(),e.bind(Q.IPopupService).to(zl).inSingletonScope(),e.bind(Q.INormalPass).to(Eh).whenTargetNamed("clear"),e.bind(Q.INormalPass).to(_t).whenTargetNamed("pixelPicking"),e.bind(Q.INormalPass).to(cp).whenTargetNamed("render"),e.bind(Q.INormalPass).to(Ec).whenTargetNamed("taa"),e.bind(Q.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed(Q.INormalPass,r)}}),e.bind(Q.IPostProcessingPass).to(Ai).whenTargetNamed("copy"),e.bind(Q.IPostProcessingPass).to(ln).whenTargetNamed("blurH"),e.bind(Q.IPostProcessingPass).to(Dn).whenTargetNamed("blurV"),e.bind(Q.IPostProcessingPass).to(Nt).whenTargetNamed("noise"),e.bind(Q.IPostProcessingPass).to(bn).whenTargetNamed("sepia"),e.bind(Q.IPostProcessingPass).to(Ka).whenTargetNamed("colorHalftone"),e.bind(Q.IPostProcessingPass).to(ft).whenTargetNamed("hexagonalPixelate"),e.bind(Q.IPostProcessingPass).to(Ne).whenTargetNamed("ink"),e.bind(Q.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed(Q.IPostProcessingPass,r);return i.setName(r),i}}),e}function Fv(e){var n=new ae.W2;return n.parent=e,n.bind(Q.IStyleAttributeService).to(pr).inSingletonScope(),n.bind(Q.IMultiPassRenderer).to(td).inSingletonScope(),n.bind(Q.IPostProcessor).to(Fp).inSingletonScope(),n}var Io=G(74691),af=null;function Bv(e){return af.indexOf(e)}var t=2,a=4,s=64,p=128,m=256,g=512,w=8192,C=16384,I=32768,L=null,D=131072,N=262144,V=524288,q=1048576,xe=2097152,Ce=4194304,ze=8388608,Le=16777216,$e=null;function ot(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function St(e){var n=e.color,r=e.radius,i=e.tileX,o=e.tileY,c=e.shape,d=e.opacity,y=e.stroke,_=e.strokeWidth,b=e.strokeOpacity,T=[],A=[],O=[],F=[ot(n[0],n[1]),ot(n[2],n[3])],W=[ot(y[0],y[1]),ot(y[2],y[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(J){var ue=_slicedToArray(J,2),Ie=ue[0],rt=ue[1];T.push([].concat(F,[(Ie+1)*ze+(rt+1)*xe+getShapeIndex(c)*D+r,(i+512)*V+(o+512)*s])),A.push([].concat(W,[_,b])),O.push([d,0,0,0])}),{packedBuffer:T,packedBuffer2:A,packedBuffer3:O}}function Pt(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*$e+r*Le+i*D+r*L+i*g+r*m+i*t+r}var zt;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(zt||(zt={}));var Kt;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(Kt||(Kt={}));var Sr;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Sr||(Sr={}));var tr;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(tr||(tr={}));var zr=["mapload"],nn={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Br=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Kn;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"})(Kn||(Kn={}));function En(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function en(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?En(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):En(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function oi(e){var n=Gn();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Gn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var si;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"})(si||(si={}));var hn=0,_i=function(e){(0,Je.Z)(r,e);var n=oi(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"controlOption",void 0),(0,M.Z)((0,H.Z)(o),"container",void 0),(0,M.Z)((0,H.Z)(o),"sceneContainer",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"renderService",void 0),(0,M.Z)((0,H.Z)(o),"layerService",void 0),(0,M.Z)((0,H.Z)(o),"controlService",void 0),(0,M.Z)((0,H.Z)(o),"isShow",void 0),o.controlOption=en(en({},o.getDefault()),i||{}),o}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{position:si.TOPRIGHT,name:"".concat(hn++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",c=this.controlService;return c&&c.removeControl(this),this.controlOption.position=o,c&&c.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Q.IMapService),this.renderService=o.get(Q.IRendererService),this.layerService=o.get(Q.ILayerService),this.controlService=o.get(Q.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var c=this.container,d=this.controlOption.position,y=this.controlService.controlCorners[d];return He(c,"l7-control"),d.indexOf("bottom")!==-1?y.insertBefore(c,y.firstChild):y.appendChild(c),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;He(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ut(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;st(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var c=this.mapsService.getContainer();c!==null&&c.focus()}}}]),r}(se.EventEmitter);function aa(e){var n=Oa();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ka=function(e){(0,Je.Z)(r,e);var n=aa(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"layerControlInputs",void 0),(0,M.Z)((0,H.Z)(o),"layers",void 0),(0,M.Z)((0,H.Z)(o),"lastZIndex",void 0),(0,M.Z)((0,H.Z)(o),"handlingClick",void 0),(0,M.Z)((0,H.Z)(o),"layersLink",void 0),(0,M.Z)((0,H.Z)(o),"baseLayersList",void 0),(0,M.Z)((0,H.Z)(o),"separator",void 0),(0,M.Z)((0,H.Z)(o),"overlaysList",void 0),(0,M.Z)((0,H.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),li(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,H.Z)(o)),o}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Kn.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(c){c.layer.on("remove",o.onLayerChange),c.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,c){return this.addLayer(o,c,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),c=o.height;He(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=c-(this.container.offsetTop+50);return d<this.form.clientHeight?(He(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):ut(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ut(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(c){c.layer.off("remove",o.onLayerChange),c.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",c=this.container=Ft("div",o),d=this.controlOption.collapsed;c.setAttribute("aria-haspopup","true");var y=this.form=Ft("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),c.addEventListener("mouseenter",this.expand),c.addEventListener("mouseleave",this.collapse)),this.layersLink=Ft("a",o+"-toggle",c);var _=this.layersLink;_.title="Layers",d||this.expand(),this.baseLayersList=Ft("div",o+"-base",y),this.separator=Ft("div",o+"-separator",y),this.overlaysList=Ft("div",o+"-overlays",y),c.appendChild(y)}},{key:"initLayers",value:function(){var o=this,c=this.controlOption,d=c.baseLayers,y=d===void 0?{}:d,_=c.overlayers,b=_===void 0?{}:_;Object.keys(y).forEach(function(T,A){o.addLayer(y[T],T,!1)}),Object.keys(b).forEach(function(T,A){o.addLayer(b[T],T,!0)})}},{key:"update",value:function(){if(!this.container)return this;Or(this.baseLayersList),Or(this.overlaysList),this.layerControlInputs=[];var o,c,d,y,_=0;for(d=0;d<this.layers.length;d++)y=this.layers[d],this.addItem(y),c=c||y.overlay,o=o||!y.overlay,_+=y.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&_>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=c&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,c,d,y=this.mapsService.getZoom(),_=o.length-1;_>=0;_--)if(c=o[_],d=this.layerService.getLayer(c.layerId),d&&d.inited){var b=d.getMinZoom(),T=d.getMaxZoom();c.disabled=y<b||y>T}}},{key:"addLayer",value:function(o,c,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:c,overlay:d});var y=this.controlOption,_=y.sortLayers,b=y.sortFunction,T=y.autoZIndex;_&&this.layers.sort(function(A,O){return b(A.layer,O.layer,A.name,O.name)}),T&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var c=this.layerService.getLayer(o.target.layerId),d=c!=null&&c.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,c)}},{key:"createRadioElement",value:function(o,c){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(c?' checked="checked"':"")+"/>",y=document.createElement("div");return y.innerHTML=d,y.firstChild}},{key:"addItem",value:function(o){var c=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),y=d&&d.inited&&o.layer.isVisible(),_;o.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="l7-control-layers-selector",_.defaultChecked=y):_=this.createRadioElement("l7-base-layers",y),this.layerControlInputs.push(_),_.layerId=o.layer.id,_.addEventListener("click",this.onInputClick);var b=document.createElement("span");b.innerHTML=" "+o.name;var T=document.createElement("div");c.appendChild(T),T.appendChild(_),T.appendChild(b);var A=o.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(c),this.checkDisabledLayers(),c}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,c,d,y=[],_=[];this.handlingClick=!0;for(var b=o.length-1;b>=0;b--)c=o[b],d=this.layerService.getLayer(c.layerId),c.checked?y.push(d):c.checked||_.push(d);_.forEach(function(T){T.hide()}),y.forEach(function(T){T.show()}),this.handlingClick=!1}}]),r}(_i);function oa(e){var n=La();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function La(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var po=function(e){(0,Je.Z)(r,e);var n=oa(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{position:si.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",c=Ft("div",o),d=Ft("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),c.appendChild(d),c}},{key:"onRemove",value:function(){return null}}]),r}(_i);function ho(e){var n=ts();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oo=function(e){(0,Je.Z)(r,e);var n=ho(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"mScale",void 0),(0,M.Z)((0,H.Z)(o),"iScale",void 0),li(["update"],(0,H.Z)(o)),o}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{position:si.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",c=Ft("div",o);this.addScales(o+"-line",c);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),c}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,c=this.controlOption.maxWidth,d=o.getSize()[1]/2,y=o.containerToLngLat([0,d]),_=o.containerToLngLat([c,d]),b=Dr([y.lng,y.lat],[_.lng,_.lat]);this.updateScales(b)}},{key:"updateScales",value:function(o){var c=this.controlOption,d=c.metric,y=c.imperial;d&&o&&this.updateMetric(o),y&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var c=this.getRoundNum(o),d=c<1e3?c+" m":c/1e3+" km";this.updateScale(this.mScale,d,c/o)}},{key:"updateImperial",value:function(o){var c=o*3.2808399,d,y,_;c>5280?(d=c/5280,y=this.getRoundNum(d),this.updateScale(this.iScale,y+" mi",y/d)):(_=this.getRoundNum(c),this.updateScale(this.iScale,_+" ft",_/c))}},{key:"updateScale",value:function(o,c,d){var y=this.controlOption.maxWidth;o.style.width=Math.round(y*d)+"px",o.innerHTML=c}},{key:"getRoundNum",value:function(o){var c=Math.pow(10,(Math.floor(o)+"").length-1),d=o/c;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,c*d}},{key:"addScales",value:function(o,c){var d=this.controlOption,y=d.metric,_=d.imperial;y&&(this.mScale=Ft("div",o,c)),_&&(this.iScale=Ft("div",o,c))}}]),r}(_i);function rs(e){var n=Ua();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Ua(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ko=function(e){(0,Je.Z)(r,e);var n=rs(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"disabled",void 0),(0,M.Z)((0,H.Z)(o),"zoomInButton",void 0),(0,M.Z)((0,H.Z)(o),"zoomOutButton",void 0),li(["updateDisabled","zoomIn","zoomOut"],(0,H.Z)(o)),o}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{position:si.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",c=Ft("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",c,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",c,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),c}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,c,d,y,_){var b=Ft("a",d,y);return b.innerHTML=o,b.title=c,b.href="javascript:void(0)",b.addEventListener("click",_),b}},{key:"updateDisabled",value:function(){var o=this.mapsService,c="l7-disabled";ut(this.zoomInButton,c),ut(this.zoomOutButton,c),(this.disabled||o.getZoom()<=o.getMinZoom())&&He(this.zoomOutButton,c),(this.disabled||o.getZoom()>=o.getMaxZoom())&&He(this.zoomInButton,c)}}]),r}(_i);function fi(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function zi(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?fi(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fi(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Fi(e){var n=bi();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function bi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ns=function(e){(0,Je.Z)(r,e);var n=Fi(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"markerOption",void 0),(0,M.Z)((0,H.Z)(o),"defaultMarker",void 0),(0,M.Z)((0,H.Z)(o),"popup",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"sceneSerive",void 0),(0,M.Z)((0,H.Z)(o),"lngLat",void 0),(0,M.Z)((0,H.Z)(o),"scene",void 0),(0,M.Z)((0,H.Z)(o),"added",!1),(0,M.Z)((0,H.Z)(o),"eventHandle",function(c){o.emit(c.type,{target:c,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=zi(zi({},o.getDefault()),i),li(["update","onMove","onUp","addDragHandler","onMapClick"],(0,H.Z)(o)),o.init(),o}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Li.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Q.IMapService),this.sceneSerive=o.get(Q.ISceneService);var c=this.markerOption,d=c.element,y=c.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&st(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var c=this;if(!this.added)return this.once("added",function(){c.setElement(o)}),this;var d=this.markerOption.element;return d&&st(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var c=this.popup;return c?(c.isOpen()||c.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var c=this.popup;return c&&c.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,c=o.element,d=o.anchor;this.updatePosition(),Ee(c,"".concat(Wn[d]))}}},{key:"onMapClick",value:function(o){var c=this.markerOption.element;this.popup&&c&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,c=o.element,d=o.offsets,y=this.lngLat,_=y.lng,b=y.lat,T=this.mapsService.getBounds(),A=this.mapsService.lngLatToContainer([_,b]);if(c){c.style.display="block";var O=this.mapsService.getContainer(),F=0,W=0;if(O&&(F=O.scrollWidth,W=O.scrollHeight),Math.abs(T[0][0])>180||Math.abs(T[1][0])>180){if(A.x>F){var J=this.mapsService.lngLatToContainer([_-360,b]);A.x=J.x}if(A.x<0){var ue=this.mapsService.lngLatToContainer([_+360,b]);A.x=ue.x}}(A.x>F||A.x<0||A.y>W||A.y<0)&&(c.style.display="none"),c.style.left=A.x+d[0]+"px",c.style.top=A.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,c=this.markerOption.element,d=this.markerOption,y=d.color,_=d.anchor;if(!c){this.defaultMarker=!0,c=Ft("div"),this.markerOption.element=c;var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","48px"),b.setAttributeNS(null,"width","48px"),b.setAttributeNS(null,"viewBox","0 0 1024 1024");var T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),T.setAttributeNS(null,"fill",y),b.appendChild(T),c.appendChild(b)}He(c,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var O,F,W=((O=o.markerOption)===null||O===void 0?void 0:O.style)&&((F=o.markerOption)===null||F===void 0?void 0:F.style[A]);c&&(c.style[A]=W)}),c.addEventListener("click",function(A){o.onMapClick(A)}),c.addEventListener("click",this.eventHandle),zn(c,_,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(se.EventEmitter),Go=G(69848),Xi=G.n(Go);function ja(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Lo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ja(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ja(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ci(e){var n=Jl();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mu=function(e){(0,Je.Z)(r,e);var n=Ci(r);function r(i){var o,c;return(0,we.Z)(this,r),c=n.call(this),(0,M.Z)((0,H.Z)(c),"markers",[]),(0,M.Z)((0,H.Z)(c),"markerLayerOption",void 0),(0,M.Z)((0,H.Z)(c),"clusterIndex",void 0),(0,M.Z)((0,H.Z)(c),"points",[]),(0,M.Z)((0,H.Z)(c),"clusterMarkers",[]),(0,M.Z)((0,H.Z)(c),"mapsService",void 0),(0,M.Z)((0,H.Z)(c),"scene",void 0),(0,M.Z)((0,H.Z)(c),"zoom",void 0),(0,M.Z)((0,H.Z)(c),"bbox",void 0),c.markerLayerOption=Su()(c.getDefault(),i),li(["update"],(0,H.Z)(c)),c.zoom=((o=c.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,c}return(0,Oe.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Q.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var c=this.markerLayerOption.cluster;c&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var c=this.markers.indexOf(o);c>-1&&this.markers.splice(c,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(c){c.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,c){var d=o.getLnglat(),y=d.lng,_=d.lat,b={geometry:{type:"Point",coordinates:[y,_]},properties:Lo(Lo({},o.getExtData()),{},{marker_id:c})};this.points.push(b)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,c=o.radius,d=o.minZoom,y=d===void 0?0:d,_=o.maxZoom;this.clusterIndex=new(Xi())({radius:c,minZoom:y,maxZoom:_}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,c){var d=this,y=o[0].concat(o[1]),_=this.clusterIndex.getClusters(y,c);this.clusterMarkers.forEach(function(b){b.remove()}),this.clusterMarkers=[],_.forEach(function(b){var T,A=d.markerLayerOption.clusterOption,O=A.field,F=A.method;if(b.properties&&(T=b.properties)!==null&&T!==void 0&&T.cluster_id){var W,J=d.getLeaves((W=b.properties)===null||W===void 0?void 0:W.cluster_id);if(b.properties.clusterData=J,O&&F){var ue=J==null?void 0:J.map(function(Ot){var Zt=(0,M.Z)({},O,Ot.properties[O]);return Zt}),Ie=qs(ue,O),rt=ji(F,Ie),lt="point_"+F;b.properties[lt]=rt.toFixed(2)}}var Tt=d.clusterMarker(b);d.clusterMarkers.push(Tt),Tt.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,c,d):null}},{key:"clusterMarker",value:function(o){var c=this.markerLayerOption.clusterOption,d=c,y=d.element,_=y===void 0?this.generateElement.bind(this):y,b=new ns({element:_(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return b}},{key:"normalMarker",value:function(o){var c=o.properties.marker_id;return this.markers[c]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),c=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!Bn(this.bbox,c))&&(this.bbox=Pr(c,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var c=Ft("div","l7-marker-cluster"),d=Ft("div","",c),y=Ft("span","",d),_=this.markerLayerOption.clusterOption,b=_.field,T=_.method;o.properties.point_count=o.properties.point_count||1;var A=b&&T?o.properties["point_"+T]||o.properties[b]:o.properties.point_count;return y.textContent=A,c}}]),r}(se.EventEmitter);function Tl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ra(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Tl(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ql(e){var n=el();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function el(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uf=function(e){(0,Je.Z)(r,e);var n=Ql(r);function r(i){var o;return(0,we.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"popupOption",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"sceneSerive",void 0),(0,M.Z)((0,H.Z)(o),"lngLat",void 0),(0,M.Z)((0,H.Z)(o),"content",void 0),(0,M.Z)((0,H.Z)(o),"closeButton",void 0),(0,M.Z)((0,H.Z)(o),"timeoutInstance",void 0),(0,M.Z)((0,H.Z)(o),"container",void 0),(0,M.Z)((0,H.Z)(o),"tip",void 0),(0,M.Z)((0,H.Z)(o),"scene",void 0),o.popupOption=Ra(Ra({},o.getdefault()),i),li(["update","onClickClose","remove"],(0,H.Z)(o)),o}return(0,Oe.Z)(r,[{key:"addTo",value:function(o){var c=this;return this.mapsService=o.get(Q.IMapService),this.sceneSerive=o.get(Q.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){c.mapsService.on("click",c.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var c=window.document.createDocumentFragment(),d=window.document.createElement("body"),y;for(d.innerHTML=o;y=d.firstChild,!!y;)c.appendChild(y);return this.setDOMContent(c)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&st(this.content),this.content=Ft("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ft("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,c,d){var y=window.document.createElement(o);return c!==void 0&&(y.className=c),d&&d.appendChild(y),y}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Li.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,c=this.lngLat,d=this.popupOption,y=d.className,_=d.maxWidth,b=d.anchor;if(!(!this.mapsService||!c||!this.content)){var T=this.mapsService.getMarkerContainer();if(!this.container&&T){this.container=this.creatDom("div","l7-popup",T),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),y&&y.split(" ").forEach(function(O){return o.container.classList.add(O)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){o.container.addEventListener(O,function(F){F.stopPropagation()})})}_&&this.container.style.maxWidth!==_&&(this.container.style.maxWidth=_),this.updatePosition(),Ee(this.container,"".concat(Wn[b])),zn(this.container,b,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,c=o.lng,d=o.lat,y=this.popupOption.offsets,_=this.mapsService.lngLatToContainer([c,d]);this.container.style.left=_.x+y[0]+"px",this.container.style.top=_.y-y[1]+"px"}}}]),r}(se.EventEmitter);function jf(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}jf(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var fp=G(81550),Tc=G.n(fp),pp=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"attribute",void 0),(0,M.Z)(this,"buffer",void 0);var i=r.buffer,o=r.offset,c=r.stride,d=r.normalized,y=r.size,_=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:c||0,normalized:d||!1,divisor:_||0},y&&(this.attribute.size=y)}return(0,Oe.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),tl,ec,Pu,Ws,of,As,Ac,Mc,ms,rl,Ro,Iu,uu,sf,Oh=(tl={},(0,M.Z)(tl,re.POINTS,"points"),(0,M.Z)(tl,re.LINES,"lines"),(0,M.Z)(tl,re.LINE_LOOP,"line loop"),(0,M.Z)(tl,re.LINE_STRIP,"line strip"),(0,M.Z)(tl,re.TRIANGLES,"triangles"),(0,M.Z)(tl,re.TRIANGLE_FAN,"triangle fan"),(0,M.Z)(tl,re.TRIANGLE_STRIP,"triangle strip"),tl),hp=(ec={},(0,M.Z)(ec,re.STATIC_DRAW,"static"),(0,M.Z)(ec,re.DYNAMIC_DRAW,"dynamic"),(0,M.Z)(ec,re.STREAM_DRAW,"stream"),ec),Vf=(Pu={},(0,M.Z)(Pu,re.BYTE,"int8"),(0,M.Z)(Pu,re.UNSIGNED_INT,"int16"),(0,M.Z)(Pu,re.INT,"int32"),(0,M.Z)(Pu,re.UNSIGNED_BYTE,"uint8"),(0,M.Z)(Pu,re.UNSIGNED_SHORT,"uint16"),(0,M.Z)(Pu,re.UNSIGNED_INT,"uint32"),(0,M.Z)(Pu,re.FLOAT,"float"),Pu),Zp=(Ws={},(0,M.Z)(Ws,re.ALPHA,"alpha"),(0,M.Z)(Ws,re.LUMINANCE,"luminance"),(0,M.Z)(Ws,re.LUMINANCE_ALPHA,"luminance alpha"),(0,M.Z)(Ws,re.RGB,"rgb"),(0,M.Z)(Ws,re.RGBA,"rgba"),(0,M.Z)(Ws,re.RGBA4,"rgba4"),(0,M.Z)(Ws,re.RGB5_A1,"rgb5 a1"),(0,M.Z)(Ws,re.RGB565,"rgb565"),(0,M.Z)(Ws,re.DEPTH_COMPONENT,"depth"),(0,M.Z)(Ws,re.DEPTH_STENCIL,"depth stencil"),Ws),kh=(of={},(0,M.Z)(of,re.DONT_CARE,"dont care"),(0,M.Z)(of,re.NICEST,"nice"),(0,M.Z)(of,re.FASTEST,"fast"),of),Gf=(As={},(0,M.Z)(As,re.NEAREST,"nearest"),(0,M.Z)(As,re.LINEAR,"linear"),(0,M.Z)(As,re.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,M.Z)(As,re.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,M.Z)(As,re.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,M.Z)(As,re.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),As),Up=(Ac={},(0,M.Z)(Ac,re.REPEAT,"repeat"),(0,M.Z)(Ac,re.CLAMP_TO_EDGE,"clamp"),(0,M.Z)(Ac,re.MIRRORED_REPEAT,"mirror"),Ac),dp=(Mc={},(0,M.Z)(Mc,re.NONE,"none"),(0,M.Z)(Mc,re.BROWSER_DEFAULT_WEBGL,"browser"),Mc),jp=(ms={},(0,M.Z)(ms,re.NEVER,"never"),(0,M.Z)(ms,re.ALWAYS,"always"),(0,M.Z)(ms,re.LESS,"less"),(0,M.Z)(ms,re.LEQUAL,"lequal"),(0,M.Z)(ms,re.GREATER,"greater"),(0,M.Z)(ms,re.GEQUAL,"gequal"),(0,M.Z)(ms,re.EQUAL,"equal"),(0,M.Z)(ms,re.NOTEQUAL,"notequal"),ms),uf=(rl={},(0,M.Z)(rl,re.FUNC_ADD,"add"),(0,M.Z)(rl,re.MIN_EXT,"min"),(0,M.Z)(rl,re.MAX_EXT,"max"),(0,M.Z)(rl,re.FUNC_SUBTRACT,"subtract"),(0,M.Z)(rl,re.FUNC_REVERSE_SUBTRACT,"reverse subtract"),rl),lf=(Ro={},(0,M.Z)(Ro,re.ZERO,"zero"),(0,M.Z)(Ro,re.ONE,"one"),(0,M.Z)(Ro,re.SRC_COLOR,"src color"),(0,M.Z)(Ro,re.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,M.Z)(Ro,re.SRC_ALPHA,"src alpha"),(0,M.Z)(Ro,re.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,M.Z)(Ro,re.DST_COLOR,"dst color"),(0,M.Z)(Ro,re.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,M.Z)(Ro,re.DST_ALPHA,"dst alpha"),(0,M.Z)(Ro,re.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,M.Z)(Ro,re.CONSTANT_COLOR,"constant color"),(0,M.Z)(Ro,re.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,M.Z)(Ro,re.CONSTANT_ALPHA,"constant alpha"),(0,M.Z)(Ro,re.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,M.Z)(Ro,re.SRC_ALPHA_SATURATE,"src alpha saturate"),Ro),vp=(Iu={},(0,M.Z)(Iu,re.NEVER,"never"),(0,M.Z)(Iu,re.ALWAYS,"always"),(0,M.Z)(Iu,re.LESS,"less"),(0,M.Z)(Iu,re.LEQUAL,"lequal"),(0,M.Z)(Iu,re.GREATER,"greater"),(0,M.Z)(Iu,re.GEQUAL,"gequal"),(0,M.Z)(Iu,re.EQUAL,"equal"),(0,M.Z)(Iu,re.NOTEQUAL,"notequal"),Iu),cf=(uu={},(0,M.Z)(uu,re.ZERO,"zero"),(0,M.Z)(uu,re.KEEP,"keep"),(0,M.Z)(uu,re.REPLACE,"replace"),(0,M.Z)(uu,re.INVERT,"invert"),(0,M.Z)(uu,re.INCR,"increment"),(0,M.Z)(uu,re.DECR,"decrement"),(0,M.Z)(uu,re.INCR_WRAP,"increment wrap"),(0,M.Z)(uu,re.DECR_WRAP,"decrement wrap"),uu),Ud=(sf={},(0,M.Z)(sf,re.FRONT,"front"),(0,M.Z)(sf,re.BACK,"back"),sf),ud=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"buffer",void 0);var i=r.data,o=r.usage,c=r.type;this.buffer=n.buffer({data:i,usage:hp[o||re.STATIC_DRAW],type:Vf[c||re.UNSIGNED_BYTE]})}return(0,Oe.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,o=r.offset;this.buffer.subdata(i,o)}}]),e}(),jd=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"elements",void 0);var i=r.data,o=r.usage,c=r.type,d=r.count;this.elements=n.elements({data:i,usage:hp[o||re.STATIC_DRAW],type:Vf[c||re.UNSIGNED_BYTE],count:d})}return(0,Oe.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),ld=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"framebuffer",void 0);var i=r.width,o=r.height,c=r.color,d=r.colors,y=r.depth,_=r.stencil,b={width:i,height:o};Array.isArray(d)&&(b.colors=d.map(function(T){return T.get()})),c&&typeof c!="boolean"&&(b.color=c.get()),this.framebuffer=n.framebuffer(b)}return(0,Oe.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.framebuffer.resize(i,o)}}]),e}(),Nv=G(90484),Vp=G(36719),Va=G.n(Vp),Al=G(68630),zv=G.n(Al);function Pc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ff(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Pc(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Vd=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"reGl",void 0),(0,M.Z)(this,"destroyed",!1),(0,M.Z)(this,"drawCommand",void 0),(0,M.Z)(this,"drawParams",void 0),(0,M.Z)(this,"options",void 0),(0,M.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,c=r.attributes,d=r.uniforms,y=r.primitive,_=r.count,b=r.elements,T=r.depth,A=r.blend,O=r.stencil,F=r.cull,W=r.instances,J={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(rt){J[rt]=n.prop(rt)}));var ue={};Object.keys(c).forEach(function(rt){ue[rt]=c[rt].get()});var Ie={attributes:ue,frag:o,uniforms:J,vert:i,primitive:Oh[y===void 0?re.TRIANGLES:y]};W&&(Ie.instances=W),_&&(Ie.count=_),b&&(Ie.elements=b.get()),this.initDepthDrawParams({depth:T},Ie),this.initBlendDrawParams({blend:A},Ie),this.initStencilDrawParams({stencil:O},Ie),this.initCullDrawParams({cull:F},Ie),this.drawCommand=n(Ie),this.drawParams=Ie}return(0,Oe.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=ff(ff({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=ff(ff({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(i).forEach(function(c){var d=(0,Nv.Z)(i[c]);d==="boolean"||d==="number"||Array.isArray(i[c])||i[c].BYTES_PER_ELEMENT?o[c]=i[c]:o[c]=i[c].get()}),this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var o=r.depth;o&&(i.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:jp[o.func||re.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var o=r.blend;if(o){var c=o.enable,d=o.func,y=o.equation,_=o.color,b=_===void 0?[0,0,0,0]:_;i.blend={enable:!!c,func:{srcRGB:lf[d&&d.srcRGB||re.SRC_ALPHA],srcAlpha:lf[d&&d.srcAlpha||re.SRC_ALPHA],dstRGB:lf[d&&d.dstRGB||re.ONE_MINUS_SRC_ALPHA],dstAlpha:lf[d&&d.dstAlpha||re.ONE_MINUS_SRC_ALPHA]},equation:{rgb:uf[y&&y.rgb||re.FUNC_ADD],alpha:uf[y&&y.alpha||re.FUNC_ADD]},color:b}}}},{key:"initStencilDrawParams",value:function(r,i){var o=r.stencil;if(o){var c=o.enable,d=o.mask,y=d===void 0?-1:d,_=o.func,b=_===void 0?{cmp:re.ALWAYS,ref:0,mask:-1}:_,T=o.opFront,A=T===void 0?{fail:re.KEEP,zfail:re.KEEP,zpass:re.KEEP}:T,O=o.opBack,F=O===void 0?{fail:re.KEEP,zfail:re.KEEP,zpass:re.KEEP}:O;i.stencil={enable:!!c,mask:y,func:ff(ff({},b),{},{cmp:vp[b.cmp]}),opFront:{fail:cf[A.fail],zfail:cf[A.zfail],zpass:cf[A.zpass]},opBack:{fail:cf[F.fail],zfail:cf[F.zfail],zpass:cf[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var o=r.cull;if(o){var c=o.enable,d=o.face,y=d===void 0?re.BACK:d;i.cull={enable:!!c,face:Ud[y]}}}},{key:"extractUniforms",value:function(r){var i=this,o={};return Object.keys(r).forEach(function(c){i.extractUniformsRecursively(c,r[c],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,i,o,c){var d=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||Va()(i)||i===""||"resize"in i){o["".concat(c&&c+".").concat(r)]=i;return}zv()(i)&&Object.keys(i).forEach(function(y){d.extractUniformsRecursively(y,i[y],o,"".concat(c&&c+".").concat(r))}),Array.isArray(i)&&i.forEach(function(y,_){Object.keys(y).forEach(function(b){d.extractUniformsRecursively(b,y[b],o,"".concat(c&&c+".").concat(r,"[").concat(_,"]"))})})}}]),e}(),Lh=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"texture",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0);var i=r.data,o=r.type,c=o===void 0?re.UNSIGNED_BYTE:o,d=r.width,y=r.height,_=r.flipY,b=_===void 0?!1:_,T=r.format,A=T===void 0?re.RGBA:T,O=r.mipmap,F=O===void 0?!1:O,W=r.wrapS,J=W===void 0?re.CLAMP_TO_EDGE:W,ue=r.wrapT,Ie=ue===void 0?re.CLAMP_TO_EDGE:ue,rt=r.aniso,lt=rt===void 0?0:rt,Tt=r.alignment,Ot=Tt===void 0?1:Tt,Zt=r.premultiplyAlpha,Vt=Zt===void 0?!1:Zt,_r=r.mag,Zr=_r===void 0?re.NEAREST:_r,Yr=r.min,Cr=Yr===void 0?re.NEAREST:Yr,sn=r.colorSpace,Ln=sn===void 0?re.BROWSER_DEFAULT_WEBGL:sn;this.width=d,this.height=y;var Hn={width:d,height:y,type:Vf[c],format:Zp[A],wrapS:Up[J],wrapT:Up[Ie],mag:Gf[Zr],min:Gf[Cr],alignment:Ot,flipY:b,colorSpace:dp[Ln],premultiplyAlpha:Vt,aniso:lt};i&&(Hn.data=i),typeof F=="number"?Hn.mipmap=kh[F]:typeof F=="boolean"&&(Hn.mipmap=F),this.texture=n.texture(Hn)}return(0,Oe.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.texture.resize(i,o),this.width=i,this.height=o}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),Ml,Gp,Hp=(Ml=(0,ae.b2)(),Ml(Gp=function(){function e(){var n=this;(0,we.Z)(this,e),(0,M.Z)(this,"extensionObject",void 0),(0,M.Z)(this,"gl",void 0),(0,M.Z)(this,"$container",void 0),(0,M.Z)(this,"canvas",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"isDirty",void 0),(0,M.Z)(this,"createModel",function(r){return new Vd(n.gl,r)}),(0,M.Z)(this,"createAttribute",function(r){return new pp(n.gl,r)}),(0,M.Z)(this,"createBuffer",function(r){return new ud(n.gl,r)}),(0,M.Z)(this,"createElements",function(r){return new jd(n.gl,r)}),(0,M.Z)(this,"createTexture2D",function(r){return new Lh(n.gl,r)}),(0,M.Z)(this,"createFramebuffer",function(r){return new ld(n.gl,r)}),(0,M.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,M.Z)(this,"clear",function(r){var i=r.color,o=r.depth,c=r.stencil,d=r.framebuffer,y=d===void 0?null:d,_={color:i,depth:o,stencil:c};_.framebuffer=y===null?y:y.get(),n.gl.clear(_)}),(0,M.Z)(this,"viewport",function(r){var i=r.x,o=r.y,c=r.width,d=r.height;n.gl._gl.viewport(i,o,c,d),n.width=c,n.height=d,n.gl._refresh()}),(0,M.Z)(this,"readPixels",function(r){var i=r.framebuffer,o=r.x,c=r.y,d=r.width,y=r.height,_={x:o,y:c,width:d,height:y};return i&&(_.framebuffer=i.get()),n.gl.read(_)}),(0,M.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,M.Z)(this,"getContainer",function(){var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,M.Z)(this,"getCanvas",function(){return n.canvas}),(0,M.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,M.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,Oe.Z)(e,[{key:"init",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o,c){var d=this;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.canvas=o,_.next=3,new Promise(function(b,T){Tc()({canvas:d.canvas,attributes:{alpha:!0,antialias:c.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:c.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,F){(O||!F)&&T(O),b(F)}})});case 3:this.gl=_.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return _.stop()}},i,this)}));function r(i,o){return n.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Gp);function Wp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Xp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Wp(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var cd=function(){function e(n){(0,we.Z)(this,e),(0,M.Z)(this,"sceneService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"controlService",void 0),(0,M.Z)(this,"layerService",void 0),(0,M.Z)(this,"iconService",void 0),(0,M.Z)(this,"markerService",void 0),(0,M.Z)(this,"popupService",void 0),(0,M.Z)(this,"fontService",void 0),(0,M.Z)(this,"interactionService",void 0),(0,M.Z)(this,"container",void 0);var r=n.id,i=n.map,o=Zd();this.container=o,i.setContainer(o,r),o.bind(Q.IRendererService).to(Hp).inSingletonScope(),this.sceneService=o.get(Q.ISceneService),this.mapService=o.get(Q.IMapService),this.iconService=o.get(Q.IIconService),this.fontService=o.get(Q.IFontService),this.controlService=o.get(Q.IControlService),this.layerService=o.get(Q.ILayerService),this.markerService=o.get(Q.IMarkerService),this.interactionService=o.get(Q.IInteractionService),this.popupService=o.get(Q.IPopupService),this.initComponent(r),this.sceneService.init(n),this.initControl()}return(0,Oe.Z)(e,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var c=new r(i);c.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(r){var i=Fv(this.container);r.setContainer(i),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r){this.layerService.remove(r)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(o){var c=(0,Dt.Z)(o,2),d=c[0],y=c[1];i.fontService.addIconFont(d,y)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){Br.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){Br.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){Br.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r){this.mapService.panBy(r)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var o=this.sceneService.getSceneConfig(),c=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,i||Xp(Xp({},c),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind(Q.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"initComponent",value:function(r){this.controlService.init({container:ct(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,o=r.logoPosition;i&&this.addControl(new po({position:o}))}}]),e}(),Gd=G(13218),Ms=G.n(Gd),Hd=G(23560),pf=G.n(Hd),fd,pd,hd,Ps,Yp;function Wd(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var tc=(fd=(0,ae.b2)(),pd=(0,ae.f3)(Q.IGlobalConfigService),fd(hd=(Ps=function(){function e(){(0,we.Z)(this,e),Tn(this,"configService",Yp,this),(0,M.Z)(this,"enabled",void 0)}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.rendererService,d=i.postProcessingPassFactory,y=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var _=r.getLayerConfig(),b=_.enableMultiPassRenderer,T=_.passes,A=T===void 0?[]:T;o.enabled=!!b&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,A,d,y),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,o,c){var d=r.multiPassRenderer,y=r.getLayerConfig(),_=y.enablePicking,b=y.enableTAA;return _&&d.add(c("pixelPicking")),d}}]),e}(),Yp=$r(Ps.prototype,"configService",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ps))||hd),hf,dd=(hf={},(0,M.Z)(hf,zt.additive,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE,srcAlpha:1,dstAlpha:1}}),(0,M.Z)(hf,zt.none,{enable:!1}),(0,M.Z)(hf,zt.normal,{enable:!0,func:{srcRGB:re.SRC_ALPHA,dstRGB:re.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,M.Z)(hf,zt.subtractive,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE,srcAlpha:re.ZERO,dstAlpha:re.ONE_MINUS_SRC_COLOR},equation:{rgb:re.FUNC_SUBTRACT,alpha:re.FUNC_SUBTRACT}}),(0,M.Z)(hf,zt.max,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE},equation:{rgb:re.MAX_EXT}}),(0,M.Z)(hf,zt.min,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE},equation:{rgb:re.MIN_EXT}}),hf),Hf=G(47037),Is=G.n(Hf),mp=G(81763),Ui=G.n(mp),yp=G(1469),df=G.n(yp),Zv=1024;function Os(e,n,r,i,o){n.updateStyleAttribute(e,r,i,o)}function Xd(e,n){e.opacity&&qp("opacity",n,e.opacity),e.strokeWidth&&qp("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&qp("strokeOpacity",n,e.strokeOpacity),e.stroke&&Ic("stroke",n,e.stroke),e.offsets&&Rh("offsets",n,e.offsets),e.textOffset&&Rh("textOffset",n,e.textOffset)}function qp(e,n,r){Is()(r)?Os(e,n,r,function(i){return i}):Ui()(r)?Os(e,n,[r],void 0):df()(r)&&r.length===2?Is()(r[0])&&pf()(r[1])||Is()(r[0])&&df()(r[1])&&Ui()(r[1][0])&&Ui()(r[1][1])?Os(e,n,r[0],r[1]):Os(e,n,[1],void 0):Os(e,n,[1],void 0)}function Rh(e,n,r){Is()(r)?Os(e,n,r,function(i){return i}):df()(r)&&r.length===2&&Is()(r[0])&&pf()(r[1])?Os(e,n,r[0],r[1]):df()(r)&&r.length===2&&Ui()(r[0])&&Ui()(r[1])?Os(e,n,r,void 0):Os(e,n,[0,0],void 0)}function Ic(e,n,r){Is()(r)?Os(e,n,r,void 0):df()(r)&&r.length===2&&(Is()(r[0])&&pf()(r[1])||Is()(r[0])&&df()(r[1])&&r[1].length>0)?Os(e,n,r[0],r[1]):Os(e,n,"#fff",void 0)}var Yd=["passes"],vd=["moduleName","vertexShader","fragmentShader","triangulation"],Dh,md,gp,yd,gd;function _d(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qd(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function qd(e,n){if(!!e){if(typeof e=="string")return _p(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _p(e,n)}}function _p(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function xd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ho(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?xd(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Uv(e){var n=Kd();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Kd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $d=0,Wf=(Dh=Zf(Q.IGlobalConfigService),md=Zf(Q.IShaderModuleService),gp=function(e){(0,Je.Z)(r,e);var n=Uv(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,we.Z)(this,r),i=n.call(this),(0,M.Z)((0,H.Z)(i),"id","".concat($d++)),(0,M.Z)((0,H.Z)(i),"name","".concat($d)),(0,M.Z)((0,H.Z)(i),"type",void 0),(0,M.Z)((0,H.Z)(i),"visible",!0),(0,M.Z)((0,H.Z)(i),"zIndex",0),(0,M.Z)((0,H.Z)(i),"minZoom",void 0),(0,M.Z)((0,H.Z)(i),"maxZoom",void 0),(0,M.Z)((0,H.Z)(i),"inited",!1),(0,M.Z)((0,H.Z)(i),"layerModelNeedUpdate",!1),(0,M.Z)((0,H.Z)(i),"pickedFeatureID",null),(0,M.Z)((0,H.Z)(i),"selectedFeatureID",null),(0,M.Z)((0,H.Z)(i),"styleNeedUpdate",!1),(0,M.Z)((0,H.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,M.Z)((0,H.Z)(i),"hooks",{init:new ds,afterInit:new ds,beforeRender:new ds,beforeRenderData:new oo,afterRender:new za,beforePickingEncode:new za,afterPickingEncode:new za,beforeHighlight:new za(["pickedColor"]),afterHighlight:new za,beforeSelect:new za(["pickedColor"]),afterSelect:new za,beforeDestroy:new za,afterDestroy:new za}),(0,M.Z)((0,H.Z)(i),"models",[]),(0,M.Z)((0,H.Z)(i),"multiPassRenderer",void 0),(0,M.Z)((0,H.Z)(i),"plugins",void 0),(0,M.Z)((0,H.Z)(i),"sourceOption",void 0),(0,M.Z)((0,H.Z)(i),"layerModel",void 0),Tn((0,H.Z)(i),"configService",yd,(0,H.Z)(i)),Tn((0,H.Z)(i),"shaderModuleService",gd,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"cameraService",void 0),(0,M.Z)((0,H.Z)(i),"coordinateService",void 0),(0,M.Z)((0,H.Z)(i),"iconService",void 0),(0,M.Z)((0,H.Z)(i),"fontService",void 0),(0,M.Z)((0,H.Z)(i),"pickingService",void 0),(0,M.Z)((0,H.Z)(i),"rendererService",void 0),(0,M.Z)((0,H.Z)(i),"layerService",void 0),(0,M.Z)((0,H.Z)(i),"interactionService",void 0),(0,M.Z)((0,H.Z)(i),"mapService",void 0),(0,M.Z)((0,H.Z)(i),"styleAttributeService",void 0),(0,M.Z)((0,H.Z)(i),"layerSource",void 0),(0,M.Z)((0,H.Z)(i),"postProcessingPassFactory",void 0),(0,M.Z)((0,H.Z)(i),"normalPassFactory",void 0),(0,M.Z)((0,H.Z)(i),"animateOptions",{enable:!1}),(0,M.Z)((0,H.Z)(i),"container",void 0),(0,M.Z)((0,H.Z)(i),"encodedData",void 0),(0,M.Z)((0,H.Z)(i),"configSchema",void 0),(0,M.Z)((0,H.Z)(i),"currentPickId",null),(0,M.Z)((0,H.Z)(i),"rawConfig",void 0),(0,M.Z)((0,H.Z)(i),"needUpdateConfig",void 0),(0,M.Z)((0,H.Z)(i),"pendingStyleAttributes",[]),(0,M.Z)((0,H.Z)(i),"scaleOptions",{}),(0,M.Z)((0,H.Z)(i),"animateStartTime",void 0),(0,M.Z)((0,H.Z)(i),"aniamateStatus",!1),(0,M.Z)((0,H.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var c=i.getLayerConfig(),d=c.autoFit,y=c.fitBoundsOptions;d&&i.fitBounds(y),i.emit("dataUpdate"),i.reRender()}),i.name=o.name||i.id,i.zIndex=o.zIndex||0,i.rawConfig=o,i}return(0,Oe.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Ho(Ho({},this.needUpdateConfig),o);else{var c=this.container.get(Q.SceneID);Xd(o,this),this.configService.setLayerConfig(c,this.id,Ho(Ho(Ho({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o){this.container=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,c=this.container.get(Q.SceneID),d=this.rawConfig.enableMultiPassRenderer,y=d===void 0?!1:d;this.configService.setLayerConfig(c,this.id,{enableMultiPassRenderer:y}),this.iconService=this.container.get(Q.IIconService),this.fontService=this.container.get(Q.IFontService),this.rendererService=this.container.get(Q.IRendererService),this.layerService=this.container.get(Q.ILayerService),this.interactionService=this.container.get(Q.IInteractionService),this.pickingService=this.container.get(Q.IPickingService),this.mapService=this.container.get(Q.IMapService),this.cameraService=this.container.get(Q.ICameraService),this.coordinateService=this.container.get(Q.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(Q.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Q.IFactoryNormalPass),this.styleAttributeService=this.container.get(Q.IStyleAttributeService),this.multiPassRenderer=this.container.get(Q.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(A){var O=A.attributeName,F=A.attributeField,W=A.attributeValues,J=A.updateOptions;o.styleAttributeService.updateStyleAttribute(O,{scale:Ho({field:F},o.splitValuesAndCallbackInAttribute(W,o.getLayerConfig()[O]))},J)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Q.ILayerPlugin);var _=_d(this.plugins),b;try{for(_.s();!(b=_.n()).done;){var T=b.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(A){_.e(A)}finally{_.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Ho(Ho({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),c=o.animateOption;c!=null&&c.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,c,d){return this.updateStyleAttribute("color",o,c,d),this}},{key:"texture",value:function(o,c,d){return this.updateStyleAttribute("texture",o,c,d),this}},{key:"rotate",value:function(o,c,d){return this.updateStyleAttribute("rotate",o,c,d),this}},{key:"size",value:function(o,c,d){return this.updateStyleAttribute("size",o,c,d),this}},{key:"filter",value:function(o,c,d){return this.updateStyleAttribute("filter",o,c,d),this}},{key:"shape",value:function(o,c,d){return this.updateStyleAttribute("shape",o,c,d),this}},{key:"label",value:function(o,c,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:c,updateOptions:d}),this}},{key:"animate",value:function(o){var c={};return Ms()(o)?(c.enable=!0,c=Ho(Ho({},c),o)):c.enable=o,this.updateLayerConfig({animateOption:c}),this}},{key:"source",value:function(o,c){return this.sourceOption={data:o,options:c},this}},{key:"setData",value:function(o,c){var d=this;return this.inited?this.layerSource.setData(o,c):this.on("inited",function(){d.layerSource.setData(o,c)}),this}},{key:"style",value:function(o){var c=this,d=o.passes,y=(0,z.Z)(o,Yd);return d&&Wd(d).forEach(function(_){var b=c.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(_[0]);b&&b.updateOptions(_[1])}),this.rawConfig=Ho(Ho({},this.rawConfig),y),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,c){return Ms()(o)?this.scaleOptions=Ho(Ho({},this.scaleOptions),o):this.scaleOptions[o]=c,this}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var c={};return c.enableHighlight=Ms()(o)?!0:o,Ms()(o)?(c.enableHighlight=!0,o.color&&(c.highlightColor=o.color)):c.enableHighlight=!!o,this.updateLayerConfig(c),this}},{key:"setActive",value:function(o,c){var d=this;if(Ms()(o)){var y=o.x,_=y===void 0?0:y,b=o.y,T=b===void 0?0:b;this.updateLayerConfig({highlightColor:Ms()(c)?c.color:this.getLayerConfig().highlightColor}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Ms()(c)?c.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Ea(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var c={};return c.enableSelect=Ms()(o)?!0:o,Ms()(o)?(c.enableSelect=!0,o.color&&(c.selectColor=o.color)):c.enableSelect=!!o,this.updateLayerConfig(c),this}},{key:"setSelect",value:function(o,c){var d=this;if(Ms()(o)){var y=o.x,_=y===void 0?0:y,b=o.y,T=b===void 0?0:b;this.updateLayerConfig({selectColor:Ms()(c)?c.color:this.getLayerConfig().selectColor}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Ms()(c)?c.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Ea(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),c=this.getLayerConfig(),d=c.visible,y=c.minZoom,_=y===void 0?-Infinity:y,b=c.maxZoom,T=b===void 0?Infinity:b;return!!d&&o>=_&&o<=T}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),c=o.minZoom;return c}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),c=o.maxZoom;return c}},{key:"get",value:function(o){var c=this.getLayerConfig();return c[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var c=this.getSource(),d=c.extent,y=d.some(function(_){return Math.abs(_)===Infinity});return y?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var c=this.mapService.getZoom();this.layerSource.updateClusterData(c)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var c=this.styleAttributeService.getLayerAttributeScale(o);if(c){if(c.ticks){var d=c.ticks().map(function(_){return(0,M.Z)({value:_},o,c(_))});return d}else if(c.invertExtent){var y=c.range().map(function(_){return(0,M.Z)({value:c.invertExtent(_)},o,_)});return y}}else return[]}},{key:"pick",value:function(o){var c=o.x,d=o.y;this.interactionService.triggerHover({x:c,y:d})}},{key:"boxSelect",value:function(o,c){this.pickingService.boxPickLayer(this,o,c)}},{key:"buildLayerModel",value:function(o){var c=o.moduleName,d=o.vertexShader,y=o.fragmentShader,_=o.triangulation,b=(0,z.Z)(o,vd);this.shaderModuleService.registerModule(c,{vs:d,fs:y});var T=this.shaderModuleService.getModule(c),A=T.vs,O=T.fs,F=T.uniforms,W=this.rendererService.createModel,J=this.styleAttributeService.createAttributesAndIndices(this.encodedData,_),ue=J.attributes,Ie=J.elements;return W(Ho({attributes:ue,uniforms:F,fs:O,vs:A,elements:Ie,blend:dd[zt.normal]},b))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var c=this.getLayerConfig(),d=c.enableHighlight,y=d===void 0?!0:d,_=c.enableSelect,b=_===void 0?!0:_,T=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&b&&(T=!0),o==="mousemove"&&(y||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(T=!0),this.isVisible()&&T}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var o=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(c){c.draw({uniforms:o.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(o,c,d,y){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Ho({field:c},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[c]))},y):this.pendingStyleAttributes.push({attributeName:o,attributeField:c,attributeValues:d,updateOptions:y})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(o,c){return{values:pf()(o)?void 0:o||c,callback:pf()(o)?o:void 0}}}]),r}(se.EventEmitter),yd=$r(gp.prototype,"configService",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd=$r(gp.prototype,"shaderModuleService",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp),jv=G(60442),Kp=G.n(jv),Jd,Qd,Fh,ev,Pl;function Bh(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=tv(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function tv(e,n){if(!!e){if(typeof e=="string")return xp(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xp(e,n)}}function xp(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Do=(Jd=Zf(Q.IGlobalConfigService),Qd=Zf(Q.IShaderModuleService),Fh=function(){function e(n){(0,we.Z)(this,e),(0,M.Z)(this,"triangulation",void 0),(0,M.Z)(this,"createTexture2D",void 0),(0,M.Z)(this,"layer",void 0),(0,M.Z)(this,"dataTexture",void 0),(0,M.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,M.Z)(this,"rowCount",void 0),(0,M.Z)(this,"cacheStyleProperties",void 0),(0,M.Z)(this,"cellLength",void 0),(0,M.Z)(this,"cellProperties",void 0),(0,M.Z)(this,"cellTypeLayout",void 0),(0,M.Z)(this,"stylePropertyesExist",void 0),(0,M.Z)(this,"dataTextureTest",void 0),Tn(this,"configService",ev,this),Tn(this,"shaderModuleService",Pl,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"iconService",void 0),(0,M.Z)(this,"fontService",void 0),(0,M.Z)(this,"styleAttributeService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"cameraService",void 0),(0,M.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(Q.IRendererService),this.styleAttributeService=n.getContainer().get(Q.IStyleAttributeService),this.mapService=n.getContainer().get(Q.IMapService),this.iconService=n.getContainer().get(Q.IIconService),this.fontService=n.getContainer().get(Q.IFontService),this.cameraService=n.getContainer().get(Q.ICameraService),this.layerService=n.getContainer().get(Q.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:re.NEAREST,min:re.NEAREST,width:1,height:1}))}return(0,Oe.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return Kp()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),Kp()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Kp()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Kp()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),Kp()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Ui()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Ui()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Ui()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(r){return Is()(r)?!!(0,Nn.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=Pn(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(df()(r)&&r.length===2&&Ui()(r[0])&&Ui()(r[1]))}},{key:"patchMod",value:function(r,i){for(var o=0;o<i;o++)r.push(-1)}},{key:"patchData",value:function(r,i,o){var c=Bh(o),d;try{for(c.s();!(d=c.n()).done;){var y=d.value,_=y.attr,b=y.count,T=i[_];T?_==="stroke"?r.push.apply(r,(0,j.Z)(Pn(T))):_==="offsets"?this.isOffsetStatic(T)?r.push(-T[0],T[1]):r.push(0,0):r.push(Ui()(T)?T:1):this.patchMod(r,b)}}catch(A){c.e(A)}finally{c.f()}}},{key:"calDataFrame",value:function(r,i,o){for(var c=i.length,d=Math.ceil(c*r/this.DATA_TEXTURE_WIDTH),y=d*this.DATA_TEXTURE_WIDTH,_=[],b=0;b<c;b++){var T=i[b];this.patchData(_,T,o)}for(var A=_.length;A<y;A++)_.push(-1);return{data:_,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,o=i===void 0?"normal":i;return dd[zt[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),ev=$r(Fh.prototype,"configService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pl=$r(Fh.prototype,"shaderModuleService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh),M_=G(9187),bp=G.n(M_),ri=G(31437),rv=ri.create(),WC=ri.create(),lu=ri.create(),Nh=ri.create(),nv=ri.create();function Em(e,n,r,i,o){ri.add(e,r,i),ri.normalize(e,e),n=ri.fromValues(-e[1],e[0]);var c=ri.fromValues(-r[1],r[0]);return[o/ri.dot(n,c),n]}function zh(e,n){return ri.set(e,-n[1],n[0])}function iv(e,n,r){return ri.sub(e,n,r),ri.normalize(e,e),e}function Cm(e,n){return e[0]===n[0]&&e[1]===n[1]}function XC(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var P_=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,we.Z)(this,e),(0,M.Z)(this,"complex",void 0),(0,M.Z)(this,"join",void 0),(0,M.Z)(this,"cap",void 0),(0,M.Z)(this,"miterLimit",void 0),(0,M.Z)(this,"thickness",void 0),(0,M.Z)(this,"normal",void 0),(0,M.Z)(this,"lastFlip",-1),(0,M.Z)(this,"miter",ri.fromValues(0,0)),(0,M.Z)(this,"started",!1),(0,M.Z)(this,"dash",!1),(0,M.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Oe.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var c=r.length,d=o.startIndex,y=1;y<c;y++){var _=r[y-1],b=i[y-1],T=r[y],A=i[y],O=y<r.length-1?r[y+1]:null,F=y<i.length-1?i[y+1]:null,W=this.segment_gaode2(o,d,_,T,O,b,A,F);d+=W}if(this.dash)for(var J=0;J<o.positions.length/6;J++)o.positions[J*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,c=i.startIndex,d=1;d<o;d++){var y=r[d-1],_=r[d],b=d<r.length-1?r[d+1]:null,T=this.segment(i,c,y,_,b);c+=T}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,o,c,d,y,_,b){var T=0,A=r.indices,O=r.positions,F=r.normals,W=this.cap==="square",J=this.join==="bevel",ue=Rr([_[0],_[1]]),Ie=Rr([y[0],y[1]]);iv(lu,c,o);var rt=0;if(this.dash&&(rt=this.lineSegmentDistance(ue,Ie),this.totalDistance+=rt),this.normal||(this.normal=ri.create(),zh(this.normal,lu)),!this.started)if(this.started=!0,W){var lt=ri.create(),Tt=ri.create();ri.add(lt,this.normal,lu),ri.add(Tt,this.normal,lu),F.push(Tt[0],Tt[1],0),F.push(lt[0],lt[1],0),O.push(o[0],o[1],0,this.totalDistance-rt,-this.thickness,0),O.push(o[0],o[1],0,this.totalDistance-rt,this.thickness,0)}else this.extrusions(O,F,o,this.normal,this.thickness,this.totalDistance-rt);if(A.push(i+0,i+1,i+2),d){Cm(c,d)&&ri.add(d,c,ri.normalize(d,ri.subtract(d,c,o))),iv(Nh,d,c);var Vt=Em(nv,ri.create(),lu,Nh,this.thickness),_r=(0,Dt.Z)(Vt,2),Zr=_r[0],Yr=_r[1],Cr=ri.dot(nv,this.normal)<0?-1:1,sn=J;if(!sn&&this.join==="miter"){var Ln=Zr;Ln>this.miterLimit&&(sn=!0)}sn?(F.push(this.normal[0],this.normal[1],0),F.push(Yr[0],Yr[1],0),O.push(c[0],c[1],0,this.totalDistance,-this.thickness*Cr,0),O.push(c[0],c[1],0,this.totalDistance,this.thickness*Cr,0),A.push.apply(A,(0,j.Z)(this.lastFlip!==-Cr?[i,i+2,i+3]:[i+2,i+1,i+3])),A.push(i+2,i+3,i+4),zh(rv,Nh),ri.copy(this.normal,rv),F.push(this.normal[0],this.normal[1],0),O.push(c[0],c[1],0,this.totalDistance,-this.thickness*Cr,0),T+=3):(this.extrusions(O,F,c,Yr,Zr,this.totalDistance),A.push.apply(A,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Cr=-1,ri.copy(this.normal,Yr),T+=2),this.lastFlip=Cr}else{if(zh(this.normal,lu),W){var Ot=ri.create(),Zt=ri.create();ri.sub(Zt,lu,this.normal),ri.add(Ot,lu,this.normal),F.push(Zt[0],Zt[1],0),F.push(Ot[0],Ot[1],0),O.push(c[0],c[1],0,this.totalDistance,this.thickness,0),O.push(c[0],c[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(O,F,c,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),T+=2}return T}},{key:"segment",value:function(r,i,o,c,d){var y=0,_=r.indices,b=r.positions,T=r.normals,A=this.cap==="square",O=this.join==="bevel",F=Rr([c[0],c[1]]),W=Rr([o[0],o[1]]);iv(lu,F,W);var J=0;if(this.dash&&(J=this.lineSegmentDistance(F,W),this.totalDistance+=J),this.normal||(this.normal=ri.create(),zh(this.normal,lu)),!this.started)if(this.started=!0,A){var ue=ri.create(),Ie=ri.create();ri.add(ue,this.normal,lu),ri.add(Ie,this.normal,lu),T.push(Ie[0],Ie[1],0),T.push(ue[0],ue[1],0),b.push(o[0],o[1],0,this.totalDistance-J,-this.thickness,0),b.push(o[0],o[1],0,this.totalDistance-J,this.thickness,0)}else this.extrusions(b,T,o,this.normal,this.thickness,this.totalDistance-J);if(_.push(i+0,i+1,i+2),d){var Tt=Rr([d[0],d[1]]);Cm(F,Tt)&&ri.add(Tt,F,ri.normalize(Tt,ri.subtract(Tt,F,W))),iv(Nh,Tt,F);var Ot=Em(nv,ri.create(),lu,Nh,this.thickness),Zt=(0,Dt.Z)(Ot,2),Vt=Zt[0],_r=Zt[1],Zr=ri.dot(nv,this.normal)<0?-1:1,Yr=O;if(!Yr&&this.join==="miter"){var Cr=Vt;Cr>this.miterLimit&&(Yr=!0)}Yr?(T.push(this.normal[0],this.normal[1],0),T.push(_r[0],_r[1],0),b.push(c[0],c[1],0,this.totalDistance,-this.thickness*Zr,0),b.push(c[0],c[1],0,this.totalDistance,this.thickness*Zr,0),_.push.apply(_,(0,j.Z)(this.lastFlip!==-Zr?[i,i+2,i+3]:[i+2,i+1,i+3])),_.push(i+2,i+3,i+4),zh(rv,Nh),ri.copy(this.normal,rv),T.push(this.normal[0],this.normal[1],0),b.push(c[0],c[1],0,this.totalDistance,-this.thickness*Zr,0),y+=3):(this.extrusions(b,T,c,_r,Vt,this.totalDistance),_.push.apply(_,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Zr=-1,ri.copy(this.normal,_r),y+=2),this.lastFlip=Zr}else{if(zh(this.normal,lu),A){var rt=ri.create(),lt=ri.create();ri.sub(lt,lu,this.normal),ri.add(rt,lu,this.normal),T.push(lt[0],lt[1],0),T.push(rt[0],rt[1],0),b.push(c[0],c[1],0,this.totalDistance,this.thickness,0),b.push(c[0],c[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(b,T,c,this.normal,this.thickness,this.totalDistance);_.push.apply(_,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),y+=2}return y}},{key:"extrusions",value:function(r,i,o,c,d,y){i.push(c[0],c[1],0),i.push(c[0],c[1],0),r.push(o[0],o[1],0,y,-d,0),r.push(o[0],o[1],0,y,d,0)}},{key:"lineSegmentDistance",value:function(r,i){var o=i[0]-r[0],c=i[1]-r[1];return Math.sqrt(o*o+c*c)}}]),e}();function Zh(e){if(Ui()(e[0]))return e;if(Ui()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ui()(e[0][0][0])){var n=e,r=0,i=0,o=0;return n.forEach(function(c){c.forEach(function(d){r+=d[0],i+=d[1],o++})}),[r/o,i/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Xs=G(77160);function I_(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=bp().flatten(e),c=o.vertices,d=o.dimensions,y=[],_=[],b=0;b<c.length/d;b++)d===2?y.push(c[b*2],c[b*2+1],1):y.push(c[b*3],c[b*3+1],1);var T=bp()(o.vertices,o.holes,o.dimensions);_.push.apply(_,(0,j.Z)(T));for(var A=function(W){var J=o.vertices.slice(W*d,(W+1)*d),ue=o.vertices.slice((W+1)*d,(W+2)*d);ue.length===0&&(ue=o.vertices.slice(0,d));var Ie=y.length/3;y.push(J[0],J[1],1,ue[0],ue[1],1,J[0],J[1],0,ue[0],ue[1],0),_.push.apply(_,(0,j.Z)([0,2,1,2,3,1].map(function(rt){return rt+Ie})))},O=0;O<i;O++)A(O);return{positions:y,index:_}}function O_(e){var n=bp().flatten(e),r=bp()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function Tm(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,c=bp().flatten(e),d=c.vertices,y=c.dimensions,_=[],b=[],T=[],A=0;A<d.length/y;A++)y===2?_.push(d[A*2],d[A*2+1],1,-1,-1):_.push(d[A*3],d[A*3+1],1,-1,-1),T.push(0,0,1);var O=bp()(c.vertices,c.holes,c.dimensions);b.push.apply(b,(0,j.Z)(O));for(var F=function(ue){var Ie=c.vertices.slice(ue*y,(ue+1)*y),rt=c.vertices.slice((ue+1)*y,(ue+2)*y);rt.length===0&&(rt=c.vertices.slice(0,y));var lt=_.length/5;_.push(Ie[0],Ie[1],1,0,0,rt[0],rt[1],1,.1,0,Ie[0],Ie[1],0,0,.8,rt[0],rt[1],0,.1,.8);var Tt=k_([rt[0],rt[1],1],[Ie[0],Ie[1],0],[Ie[0],Ie[1],1],n);T.push.apply(T,(0,j.Z)(Tt).concat((0,j.Z)(Tt),(0,j.Z)(Tt),(0,j.Z)(Tt))),b.push.apply(b,(0,j.Z)([1,2,0,3,2,1].map(function(Ot){return Ot+lt})))},W=0;W<o;W++)F(W);return{positions:_,index:b,normals:T}}function k_(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Xs.create(),c=Xs.create(),d=Xs.create();i&&(e=$t(e),n=$t(n),r=$t(r));var y=Xs.fromValues.apply(Xs,(0,j.Z)(e)),_=Xs.fromValues.apply(Xs,(0,j.Z)(n)),b=Xs.fromValues.apply(Xs,(0,j.Z)(r));Xs.sub(o,b,_),Xs.sub(c,y,_),Xs.cross(d,o,c);var T=Xs.create();return Xs.normalize(T,d),T}var rc,$p;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})($p||($p={}));var Jp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Jp||(Jp={}));function bd(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],o=0;o<e;o++)i.push(r*o+n*Math.PI/12);var c=i.map(function(d){var y=Math.sin(d+Math.PI/4),_=Math.cos(d+Math.PI/4);return[y,_,0]});return c}function Am(){return bd(30)}function Mm(){return bd(4)}function Pm(){return bd(3)}function Im(){return bd(6,1)}function Om(){return bd(5)}var Uh=(rc={},(0,M.Z)(rc,Jp.CIRCLE,Am),(0,M.Z)(rc,Jp.HEXAGON,Im),(0,M.Z)(rc,Jp.TRIANGLE,Pm),(0,M.Z)(rc,Jp.SQUARE,Mm),(0,M.Z)(rc,Jp.PENTAGON,Om),(0,M.Z)(rc,$p.CYLINDER,Am),(0,M.Z)(rc,$p.HEXAGONCOLUMN,Im),(0,M.Z)(rc,$p.TRIANGLECOLUMN,Pm),(0,M.Z)(rc,$p.SQUARECOLUMN,Mm),(0,M.Z)(rc,$p.PENTAGONCOLUMN,Om),rc),av={};function km(e){var n=Zh(e.coordinates);return{vertices:[].concat((0,j.Z)(n),(0,j.Z)(n),(0,j.Z)(n),(0,j.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function Lm(e){var n=e.shape,r=F_(n,!1),i=r.positions,o=r.index,c=r.normals;return{vertices:i,indices:o,normals:c,size:5}}function Rm(e){var n=Zh(e.coordinates);return{vertices:(0,j.Z)(n),indices:[0],size:n.length}}function L_(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,o=new P_({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var c=n;Array.isArray(c[0][0])||(c=[n]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var y=0;y<c.length;y++){var _=c[y],b=d[y];o.extrude_gaode2(_,b)}}else{var T=n;Array.isArray(T[0][0])||(T=[n]),T.forEach(function(O){o.extrude(O)})}var A=o.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,size:6}}function R_(e){var n=e.coordinates,r=bp().flatten(n),i=r.vertices,o=r.dimensions,c=r.holes;return{indices:bp()(i,c,o),vertices:i,size:o}}function Dm(e){var n=e.coordinates,r=Tm(n,!0),i=r.positions,o=r.index,c=r.normals;return{vertices:i,indices:o,normals:c,size:5}}function Fm(e){var n=e.shape,r=N_(n),i=r.positions,o=r.index;return{vertices:i,indices:o,size:3}}function Bm(e){var n=e.coordinates,r=[].concat((0,j.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,j.Z)(n[1]),[0,1,0],(0,j.Z)(n[0]),[0,0,1],(0,j.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function Vv(e){for(var n=30,r=e.coordinates,i=[],o=[],c=function(_){i.push(_,1,_,r[0][0],r[0][1],r[1][0],r[1][1],_,-1,_,r[0][0],r[0][1],r[1][0],r[1][1]),_!==n-1&&o.push.apply(o,(0,j.Z)([0,1,2,1,3,2].map(function(b){return _*2+b})))},d=0;d<n;d++)c(d);return{vertices:i,indices:o,size:7}}function D_(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=ov(-1,1),o=ov(1,1),c=ov(-1,-1),d=ov(1,-1),y=[].concat((0,j.Z)(n),(0,j.Z)(i),(0,j.Z)(n),(0,j.Z)(c),(0,j.Z)(n),(0,j.Z)(d),(0,j.Z)(n),(0,j.Z)(o)),_=[0,1,2,3,0,2];return{vertices:y,indices:_,size:5}}function F_(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(av&&av[e])return av[e];var r=Uh[e]?Uh[e]():Uh.cylinder(),i=Tm([r],n);return av[e]=i,i}function YC(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),c,d,y,_=vec3.create(),b=vec3.create(),T=vec3.create(),A=0,O=n.length;A<O;A+=3){c=n[A+0]*3,d=n[A+1]*3,y=n[A+2]*3;var F=[e[c],e[c+1]],W=[e[d],e[d+1]],J=[e[y],e[y+1]];i&&(F=lngLatToMeters(F),W=lngLatToMeters(W),J=lngLatToMeters(J));var ue=F,Ie=_slicedToArray(ue,2),rt=Ie[0],lt=Ie[1],Tt=vec3.fromValues(rt,lt,e[c+2]),Ot=W,Zt=_slicedToArray(Ot,2),Vt=Zt[0],_r=Zt[1],Zr=vec3.fromValues(Vt,_r,e[d+2]),Yr=J,Cr=_slicedToArray(Yr,2),sn=Cr[0],Ln=Cr[1],Hn=vec3.fromValues(sn,Ln,e[y+2]);vec3.sub(_,Hn,Zr),vec3.sub(b,Tt,Zr),vec3.cross(T,_,b),o[c]+=_[0],o[c+1]+=_[1],o[c+2]+=_[2],o[d]+=_[0],o[d+1]+=_[1],o[d+2]+=_[2],o[y]+=_[0],o[y+1]+=_[1],o[y+2]+=_[2]}return B_(o),o}function B_(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),o=vec3.create();vec3.normalize(o,i),e.set(o,n)}}function qC(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function N_(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Uh[e]?Uh[e]():Uh.circle(),i=n.indexOf(e)===-1?O_([r]):I_([r]);return i}function ov(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function z_(e){var n=Z_();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Z_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U_=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,j_=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,V_=function(e){(0,Je.Z)(r,e);var n=z_(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.baseColor,_=y===void 0?"rgb(16,16,16)":y,b=o.brightColor,T=b===void 0?"rgb(255,176,38)":b,A=o.windowColor,O=A===void 0?"rgb(30,60,89)":A,F=o.time,W=F===void 0?0:F;return{u_opacity:d,u_baseColor:Pn(_),u_brightColor:Pn(T),u_windowColor:Pn(O),u_time:this.layer.getLayerAnimateTime()||W}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:j_,fragmentShader:U_,triangulation:Dm})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:tr.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?10:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){var b=c.size;return[y[3],y[4]]}}})}}]),r}(Do);function G_(e){var n=H_();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function H_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W_=function(e){(0,Je.Z)(r,e);var n=G_(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PolygonLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new V_(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Wf);function X_(e){var n=Y_();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Y_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q_=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,K_=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$_=function(e){(0,Je.Z)(r,e);var n=X_(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:q_,fragmentShader:K_,triangulation:Fm,depth:{enable:!1},primitive:re.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:tr.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(Do);function J_(e){var n=Q_();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Q_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e1=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,t1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,r1=function(e){(0,Je.Z)(r,e);var n=J_(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||1,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:e1,fragmentShader:t1,triangulation:Lm,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:tr.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:tr.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(Do);function n1(e,n){for(var r=[],i=[],o=[],c=e+1,d=n+1,y=e/2,_=n/2,b=0;b<d;b++)for(var T=b-_,A=0;A<c;A++){var O=A-y;i.push(O/y,-T/_,0),o.push(A/e),o.push(1-b/n)}for(var F=0;F<n;F++)for(var W=0;W<e;W++){var J=W+c*F,ue=W+c*(F+1),Ie=W+1+c*(F+1),rt=W+1+c*F;r.push(J,ue,rt),r.push(ue,Ie,rt)}return{vertices:i,indices:r,uvs:o}}var Nm,zm;function Zm(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Um(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zm(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zm(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function i1(e){var n=a1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function a1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o1=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,s1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,u1=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,l1=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,c1=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,f1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,jm=(Nm=(0,ae.b2)(),Nm(zm=function(e){(0,Je.Z)(r,e);var n=i1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"colorTexture",void 0),(0,M.Z)((0,H.Z)(i),"heatmapFramerBuffer",void 0),(0,M.Z)((0,H.Z)(i),"intensityModel",void 0),(0,M.Z)((0,H.Z)(i),"colorModel",void 0),(0,M.Z)((0,H.Z)(i),"shapeType",void 0),i}return(0,Oe.Z)(r,[{key:"render",value:function(){var o=this,c=this.rendererService,d=c.clear,y=c.useFramebuffer;y(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,c=this.rendererService,d=c.createFramebuffer,y=c.clear,_=c.getViewportSize,b=c.createTexture2D,T=c.useFramebuffer,A=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(A==null||(o=A.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=this.layer.getLayerConfig(),W=F.rampColors,J=mi(W),ue=_(),Ie=ue.width,rt=ue.height;return this.heatmapFramerBuffer=d({color:b({width:Math.floor(Ie/4),height:Math.floor(rt/4),wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE,min:re.LINEAR,mag:re.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:tr.Attribute,descriptor:{name:"a_Dir",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?1:b;return[T]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:c1,fragmentShader:l1,triangulation:D_,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:re.ONE,srcAlpha:1,dstRGB:re.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:f1,fs:u1});var o=this.shaderModuleService.getModule("heatmapColor"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService,b=_.createAttribute,T=_.createElements,A=_.createBuffer,O=_.createModel;return O({vs:c,fs:d,attributes:{a_Position:b({buffer:A({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:re.FLOAT}),size:3}),a_Uv:b({buffer:A({data:[0,1,1,1,0,0,1,0],type:re.FLOAT}),size:2})},uniforms:Um({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:T({data:[0,2,1,2,3,1],type:re.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.intensity,y=d===void 0?10:d,_=o.radius,b=_===void 0?5:_;this.intensityModel.draw({uniforms:{u_opacity:c||1,u_radius:b,u_intensity:y}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;this.colorModel.draw({uniforms:{u_opacity:c||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=vu();Yi(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:c||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,j.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,c=o(),d=c.width,y=c.height,_=n1(d/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:s1,fs:o1});var b=this.shaderModuleService.getModule("heatmap3dColor"),T=b.vs,A=b.fs,O=b.uniforms,F=this.rendererService,W=F.createAttribute,J=F.createElements,ue=F.createBuffer,Ie=F.createModel;return Ie({vs:T,fs:A,attributes:{a_Position:W({buffer:ue({data:_.vertices,type:re.FLOAT}),size:3}),a_Uv:W({buffer:ue({data:_.uvs,type:re.FLOAT}),size:2})},primitive:re.TRIANGLES,uniforms:Um({},O),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:re.SRC_ALPHA,srcAlpha:1,dstRGB:re.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:J({data:_.indices,type:re.UNSIGNED_INT,count:_.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var c=this.layer.getLayerConfig(),d=c.rampColors,y=mi(d);this.colorTexture=o({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE,min:re.NEAREST,mag:re.NEAREST,flipY:!1})}}]),r}(Do))||zm);function p1(e){var n=h1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function h1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,v1=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,m1=function(e){(0,Je.Z)(r,e);var n=p1(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:v1,fragmentShader:d1,triangulation:Fm,depth:{enable:!1},primitive:re.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:tr.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(Do),y1={heatmap:jm,heatmap3d:jm,grid:$_,grid3d:r1,hexagon:m1},g1=y1;function _1(e){var n=x1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function x1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b1=function(e){(0,Je.Z)(r,e);var n=_1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","HeatMapLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new g1[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,c=this.getModelType();return c==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),y=d.shape3d,_=this.getSource(),b=_.data.type,T=(c==null||(o=c.scale)===null||o===void 0?void 0:o.field)||"heatmap";return T==="heatmap"||T==="heatmap3d"?"heatmap":b==="hexagon"?(y==null?void 0:y.indexOf(T))===-1?"hexagon":"grid3d":b==="grid"?(y==null?void 0:y.indexOf(T))===-1?"grid":"grid3d":"heatmap"}}]),r}(Wf);function w1(e){var n=S1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function S1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E1=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,C1=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,T1=function(e){(0,Je.Z)(r,e);var n=w1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;return{u_opacity:c||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,c=this.layer.getSource(),d=this.rendererService.createTexture2D;return this.texture=d({height:0,width:0}),c.data.images.then(function(y){o.texture=d({data:y[0],width:y[0].width,height:y[0].height}),o.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:C1,fragmentShader:E1,triangulation:Bm,primitive:re.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}}]),r}(Do),A1={image:T1},M1=A1;function P1(e){var n=I1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function I1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O1=function(e){(0,Je.Z)(r,e);var n=P1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","ImageLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new M1[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={image:{}};return c[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Wf);function k1(e){var n=L1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function L1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,D1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,F1={solid:0,dash:1},B1=function(e){(0,Je.Z)(r,e);var n=k1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.forward,J=W===void 0?!0:W,ue=o.lineTexture,Ie=ue===void 0?!1:ue,rt=o.iconStep,lt=rt===void 0?100:rt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Tt=this.layer.getEncodedData(),Ot=this.calDataFrame(this.cellLength,Tt,this.cellProperties),Zt=Ot.data,Vt=Ot.width,_r=Ot.height;this.rowCount=_r,this.dataTexture=this.cellLength>0&&Zt.length>0?this.createTexture2D({flipY:!0,data:Zt,format:re.LUMINANCE,type:re.FLOAT,width:Vt,height:_r}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Zr=0,Yr=[0,0,0,0],Cr=[0,0,0,0];return d&&y&&(Yr=Pn(d),Cr=Pn(y),Zr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:F1[A||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:J?1:-1,u_texture:this.texture,u_line_texture:Ie?1:0,u_icon_step:lt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:Yr,u_targetColor:Cr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:D1,fragmentShader:R1,triangulation:Vv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:tr.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(Do);function N1(e){var n=z1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function z1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,U1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,j1={solid:0,dash:1},V1=function(e){(0,Je.Z)(r,e);var n=N1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.lineTexture,J=W===void 0?!1:W,ue=o.iconStep,Ie=ue===void 0?100:ue;F.length===2&&F.push(0,0);var rt=0,lt=[0,0,0,0],Tt=[0,0,0,0];if(d&&y&&(lt=Pn(d),Tt=Pn(y),rt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Zt=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Vt=Zt.data,_r=Zt.width,Zr=Zt.height;this.rowCount=Zr,this.dataTexture=this.cellLength>0&&Vt.length>0?this.createTexture2D({flipY:!0,data:Vt,format:re.LUMINANCE,type:re.FLOAT,width:_r,height:Zr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:j1[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Ie,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:Tt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:U1,fragmentShader:Z1,triangulation:Vv,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:tr.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(Do);function G1(e){var n=H1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function H1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,X1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Y1={solid:0,dash:1},q1=function(e){(0,Je.Z)(r,e);var n=G1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.lineTexture,J=W===void 0?!1:W,ue=o.iconStep,Ie=ue===void 0?100:ue;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var rt=0,lt=[0,0,0,0],Tt=[0,0,0,0];if(d&&y&&(lt=Pn(d),Tt=Pn(y),rt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Zt=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Vt=Zt.data,_r=Zt.width,Zr=Zt.height;this.rowCount=Zr,this.dataTexture=this.cellLength>0&&Vt.length>0?this.createTexture2D({flipY:!0,data:Vt,format:re.LUMINANCE,type:re.FLOAT,width:_r,height:Zr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:Y1[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Ie,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:Tt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:X1,fragmentShader:W1,triangulation:Vv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:tr.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(Do);function K1(e){var n=$1();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function $1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Q1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,ex={solid:0,dash:1},Vm=function(e){(0,Je.Z)(r,e);var n=K1(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5,0,0]:O,W=o.lineTexture,J=W===void 0?!1:W,ue=o.iconStep,Ie=ue===void 0?100:ue;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var rt=0,lt=[0,0,0,0],Tt=[0,0,0,0];if(d&&y&&(lt=Pn(d),Tt=Pn(y),rt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Zt=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Vt=Zt.data,_r=Zt.width,Zr=Zt.height;this.rowCount=Zr,this.dataTexture=this.cellLength>0&&Vt.length>0?this.createTexture2D({flipY:!0,data:Vt,format:re.LUMINANCE,type:re.FLOAT,width:_r,height:Zr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,u_line_type:ex[A],u_dash_array:F,u_texture:this.texture,u_line_texture:J?1:0,u_icon_step:Ie,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:Tt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Q1,fragmentShader:J1,triangulation:L_,primitive:re.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.lineType,y=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:tr.Attribute,descriptor:{name:"a_Distance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:tr.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(b,T,A,O){var F=b.size,W=F===void 0?1:F;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:tr.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(b,T,A,O,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:tr.Attribute,descriptor:{name:"a_Miter",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(b,T,A,O){var F=o.iconService.getIconMap(),W=b.texture,J=F[W]||{x:0,y:0},ue=J.x,Ie=J.y;return[ue,Ie]}}})}},{key:"loadImage",value:function(o){return new Promise(function(c,d){if(o instanceof HTMLImageElement){c(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){c(y)},y.onerror=function(){d(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Do),tx={arc:B1,arc3d:V1,greatcircle:q1,line:Vm},rx=tx;function nx(e){var n=ix();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ix(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ax=function(e){(0,Je.Z)(r,e);var n=nx(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","LineLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new rx[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return c[o]}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=c==null||(o=c.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Wf);function ox(e){var n=sx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ux=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,lx=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Gm=function(e){(0,Je.Z)(r,e);var n=ox(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:lx,fragmentShader:ux,triangulation:Lm,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_){var b=c.size;if(b){var T=[];return Array.isArray(b)&&(T=b.length===2?[b[0],b[0],b[1]]:b),Array.isArray(b)||(T=[b]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:tr.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:tr.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=Zh(c.coordinates);return[y[0],y[1],0]}}})}}]),r}(Do);function cx(e){var n=fx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function fx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var px=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,hx=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Hm=function(e){(0,Je.Z)(r,e);var n=cx(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.strokeOpacity,_=y===void 0?1:y,b=o.strokeWidth,T=b===void 0?0:b,A=o.stroke,O=A===void 0?"rgba(0,0,0,0)":A,F=o.offsets,W=F===void 0?[0,0]:F;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:_,strokeWidth:T,stroke:O,offsets:W})){this.judgeStyleAttributes({opacity:d,strokeOpacity:_,strokeWidth:T,stroke:O,offsets:W});var J=this.layer.getEncodedData(),ue=this.calDataFrame(this.cellLength,J,this.cellProperties),Ie=ue.data,rt=ue.width,lt=ue.height;this.rowCount=lt,this.dataTexture=this.cellLength>0&&Ie.length>0?this.createTexture2D({flipY:!0,data:Ie,format:re.LUMINANCE,type:re.FLOAT,width:rt,height:lt}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_stroke_opacity:Ui()(_)?_:1,u_stroke_width:Ui()(T)?T:0,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(W)?W:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),km)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:hx,fragmentShader:px,triangulation:km,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:tr.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=[1,1,-1,1,-1,-1,1,-1],A=b%4*2;return[T[A],T[A+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?5:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:tr.Attribute,descriptor:{name:"a_Shape",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.shape,A=T===void 0?2:T,O=o.layer.getLayerConfig().shape2d,F=O.indexOf(A);return[F]}}})}}]),r}(Do);function dx(e){var n=vx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function vx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mx=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,yx=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,gx=function(e){(0,Je.Z)(r,e);var n=dx(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;return{u_opacity:c||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:yx,fragmentShader:mx,triangulation:Rm,primitive:re.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.fontService.mapping,A=d.shape,O=o.fontService.getGlyph(A),F=T[O],W=F.x,J=F.y;return[W,J]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,c=this.fontService.canvas;this.texture=o({data:c,mag:re.LINEAR,min:re.LINEAR,width:c.width,height:c.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.fontWeight,y=d===void 0?"normal":d,_=c.fontFamily,b=_===void 0?"sans-serif":_,T=this.layer.getEncodedData(),A=[];T.forEach(function(O){var F=O.shape,W=F===void 0?"":F;W=W.toString();var J=o.fontService.getGlyph(W);A.indexOf(J)===-1&&A.push(J)}),this.fontService.setFontOptions({characterSet:A,fontWeight:y,fontFamily:b,fontSize:48})}}]),r}(Do);function _x(e){var n=xx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function xx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bx=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,wx=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Wm=function(e){(0,Je.Z)(r,e);var n=_x(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.offsets,y=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c,offsets:y})){this.judgeStyleAttributes({opacity:c,offsets:y});var _=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,_,this.cellProperties),T=b.data,A=b.width,O=b.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:re.LUMINANCE,type:re.FLOAT,width:A,height:O}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Ui()(c)?c:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:wx,fragmentShader:bx,triangulation:Rm,primitive:re.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?5:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.shape,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(Do);function Sx(e){var n=Ex();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Ex(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cx=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Tx=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ax(e){var n=e.coordinates;return{vertices:(0,j.Z)(n),indices:[0],size:n.length}}var Xm=function(e){(0,Je.Z)(r,e);var n=Sx(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.offsets,_=y===void 0?[0,0]:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:_})){this.judgeStyleAttributes({opacity:d,offsets:_});var b=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,b,this.cellProperties),A=T.data,O=T.width,F=T.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:re.LUMINANCE,type:re.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Tx,fragmentShader:Cx,triangulation:Ax,depth:{enable:!1},primitive:re.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?1:b;return Array.isArray(T)?[T[0]]:[T]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:zt.additive}}}]),r}(Do);function Mx(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Px(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Px(e,n){if(!!e){if(typeof e=="string")return Ym(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ym(e,n)}}function Ym(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Ix=function(){function e(n,r,i){(0,we.Z)(this,e),(0,M.Z)(this,"boxCells",[]),(0,M.Z)(this,"xCellCount",void 0),(0,M.Z)(this,"yCellCount",void 0),(0,M.Z)(this,"boxKeys",void 0),(0,M.Z)(this,"bboxes",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"xScale",void 0),(0,M.Z)(this,"yScale",void 0),(0,M.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var c=0;c<this.xCellCount*this.yCellCount;c++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Oe.Z)(e,[{key:"insert",value:function(r,i,o,c,d){this.forEachCell(i,o,c,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}},{key:"query",value:function(r,i,o,c,d){return this.queryHitTest(r,i,o,c,!1,d)}},{key:"hitTest",value:function(r,i,o,c,d){return this.queryHitTest(r,i,o,c,!0,d)}},{key:"insertBoxCell",value:function(r,i,o,c,d,y){this.boxCells[d].push(y)}},{key:"queryHitTest",value:function(r,i,o,c,d,y){if(o<0||r>this.width||c<0||i>this.height)return d?!1:[];var _=[];if(r<=0&&i<=0&&this.width<=o&&this.height<=c){if(d)return!0;for(var b=0;b<this.boxKeys.length;b++)_.push({key:this.boxKeys[b],x1:this.bboxes[b*4],y1:this.bboxes[b*4+1],x2:this.bboxes[b*4+2],y2:this.bboxes[b*4+3]});return y?_.filter(y):_}var T={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,o,c,this.queryCell,_,T,y),d?_.length>0:_}},{key:"queryCell",value:function(r,i,o,c,d,y,_,b){var T=_.seenUids,A=this.boxCells[d];if(A!==null){var O=this.bboxes,F=Mx(A),W;try{for(F.s();!(W=F.n()).done;){var J=W.value;if(!T.box[J]){T.box[J]=!0;var ue=J*4;if(r<=O[ue+2]&&i<=O[ue+3]&&o>=O[ue+0]&&c>=O[ue+1]&&(!b||b(this.boxKeys[J]))){if(_.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[J],x1:O[ue],y1:O[ue+1],x2:O[ue+2],y2:O[ue+3]})}}}}catch(Ie){F.e(Ie)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,i,o,c,d,y,_,b){for(var T=this.convertToXCellCoord(r),A=this.convertToYCellCoord(i),O=this.convertToXCellCoord(o),F=this.convertToYCellCoord(c),W=T;W<=O;W++)for(var J=A;J<=F;J++){var ue=this.xCellCount*J+W;if(d.call(this,r,i,o,c,ue,y,_,b))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),Ox=Ix,kx=function(){function e(n,r){(0,we.Z)(this,e),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"grid",void 0),(0,M.Z)(this,"viewportPadding",100),(0,M.Z)(this,"screenRightBoundary",void 0),(0,M.Z)(this,"screenBottomBoundary",void 0),(0,M.Z)(this,"gridRightBoundary",void 0),(0,M.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new Ox(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Oe.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,c=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,o,c,d)||this.grid.hitTest(i,o,c,d)?{box:[]}:{box:[i,o,c,d]}}},{key:"insertCollisionBox",value:function(r,i){var o={featureIndex:i};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,o){var c=Nu(i,o,0,1),d=Zl(),y=$f.apply(Me,(0,j.Z)(r));return vl(d,c,y),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,o,c){return o>=0&&r<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}}]),e}();function qm(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Lx(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Lx(e,n){if(!!e){if(typeof e=="string")return Km(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Km(e,n)}}function Km(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function $m(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Jm(e,n,r,i,o){if(!!o){var c=e[i],d=c.glyph;if(d)for(var y=n[d].advance*c.scale,_=(e[i].x+y)*o,b=r;b<=i;b++)e[b].x-=_}}function Qm(e,n,r,i,o,c,d){var y=(n-r)*o,_=(-i*d+.5)*c,b=qm(e),T;try{for(b.s();!(T=b.n()).done;){var A=T.value;A.x+=y,A.y+=_}}catch(O){b.e(O)}finally{b.f()}}function Rx(e,n,r,i,o,c,d){var y=-8,_=0,b=y,T=0,A=e.positionedGlyphs,O=c==="right"?1:c==="left"?0:.5,F=A.length;r.forEach(function(rt){if(rt.split("").forEach(function(Tt){var Ot=n[Tt],Zt=0;Ot&&(A.push({glyph:Tt,x:_,y:b+Zt,vertical:!1,scale:1,metrics:Ot}),_+=Ot.advance+d)}),A.length!==F){var lt=_-d;T=Math.max(lt,T),Jm(A,n,F,A.length-1,O)}_=0,b+=i});var W=$m(o),J=W.horizontalAlign,ue=W.verticalAlign;Qm(A,O,J,ue,T,i,r.length);var Ie=b-y;e.top+=-ue*Ie,e.bottom=e.top+Ie,e.left+=-J*T,e.right=e.left+T}function Dx(e,n,r,i,o,c,d){var y=-8,_=0,b=y,T=0,A=e.positionedGlyphs,O=c==="right"?1:c==="left"?0:.5,F=A.length;r.forEach(function(rt){var lt=n[rt],Tt=0;if(lt&&(A.push({glyph:rt,x:_,y:b+Tt,vertical:!1,scale:1,metrics:lt}),_+=lt.advance+d),A.length!==F){var Ot=_-d;T=Math.max(Ot,T),Jm(A,n,F,A.length-1,O)}_=0,b+=i});var W=$m(o),J=W.horizontalAlign,ue=W.verticalAlign;Qm(A,O,J,ue,T,i,r.length);var Ie=b-y;e.top+=-ue*Ie,e.bottom=e.top+Ie,e.left+=-J*T,e.right=e.left+T}function Fx(e,n,r,i,o,c){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],y=arguments.length>7?arguments[7]:void 0,_=e.split(`
`),b=[],T={positionedGlyphs:b,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:_.length,text:e};return y?Dx(T,n,_,r,i,o,c):Rx(T,n,_,r,i,o,c),b.length?T:!1}function Bx(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=i===void 0?[]:i,c=[],d=qm(o),y;try{for(d.s();!(y=d.n()).done;){var _=y.value,b=_.metrics,T=4,A=b.advance*_.scale/2,O=r?[_.x+A,_.y]:[0,0],F=r?[0,0]:[_.x+A+n[0],_.y+n[1]],W=(0-T)*_.scale-A+F[0],J=(0-T)*_.scale+F[1],ue=W+b.width*_.scale,Ie=J+b.height*_.scale,rt={x:W,y:J},lt={x:ue,y:J},Tt={x:W,y:Ie},Ot={x:ue,y:Ie};c.push({tl:rt,tr:lt,bl:Tt,br:Ot,tex:b,glyphOffset:O})}}catch(Zt){d.e(Zt)}finally{d.f()}return c}function Nx(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=zx(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function zx(e,n){if(!!e){if(typeof e=="string")return ey(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,n)}}function ey(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Zx(e){var n=Ux();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Ux(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ry=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ny(e){var n=this,r=e.id,i=[],o=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var c=n.glyphInfoMap[r].centroid,d=c.length===2?[c[0],c[1],0]:c;return n.glyphInfoMap[r].glyphQuads.forEach(function(y,_){i.push.apply(i,(0,j.Z)(d).concat([y.tex.x,y.tex.y+y.tex.height,y.tl.x,y.tl.y],(0,j.Z)(d),[y.tex.x+y.tex.width,y.tex.y+y.tex.height,y.tr.x,y.tr.y],(0,j.Z)(d),[y.tex.x+y.tex.width,y.tex.y,y.br.x,y.br.y],(0,j.Z)(d),[y.tex.x,y.tex.y,y.bl.x,y.bl.y])),o.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:i,indices:o,size:7}}var iy=function(e){(0,Je.Z)(r,e);var n=Zx(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"glyphInfo",void 0),(0,M.Z)((0,H.Z)(i),"glyphInfoMap",{}),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"currentZoom",-1),(0,M.Z)((0,H.Z)(i),"extent",void 0),(0,M.Z)((0,H.Z)(i),"textureHeight",0),(0,M.Z)((0,H.Z)(i),"textCount",0),(0,M.Z)((0,H.Z)(i),"preTextStyle",{}),(0,M.Z)((0,H.Z)(i),"buildModels",function(){return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind((0,H.Z)(i)),depth:{enable:!1},blend:i.getBlend()})]}),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.stroke,_=y===void 0?"#fff":y,b=o.strokeWidth,T=b===void 0?0:b,A=o.textAnchor,O=A===void 0?"center":A,F=o.textAllowOverlap,W=F===void 0?!1:F,J=o.halo,ue=J===void 0?.5:J,Ie=o.gamma,rt=Ie===void 0?2:Ie,lt=this.fontService,Tt=lt.canvas,Ot=lt.mapping;if(Object.keys(Ot).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:O,textAllowOverlap:W},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:T,stroke:_})){this.judgeStyleAttributes({opacity:d,strokeWidth:T,stroke:_});var Zt=this.layer.getEncodedData(),Vt=this.calDataFrame(this.cellLength,Zt,this.cellProperties),_r=Vt.data,Zr=Vt.width,Yr=Vt.height;this.rowCount=Yr,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:re.LUMINANCE,type:re.FLOAT,width:Zr,height:Yr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_stroke_width:Ui()(T)?T:0,u_stroke_color:this.getStrokeColor(_),u_sdf_map:this.texture,u_halo_blur:ue,u_gamma_scale:rt,u_sdf_map_size:[Tt.width,Tt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),c=o.textAnchor,d=c===void 0?"center":c,y=o.textAllowOverlap,_=y===void 0?!0:y;return this.preTextStyle={textAnchor:d,textAllowOverlap:_},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),c=o.textAllowOverlap,d=c===void 0?!1:c,y=this.mapService.getZoom(),_=this.mapService.getBounds(),b=Bn(this.extent,_);return!d&&(Math.abs(this.currentZoom-y)>1||!b)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:tr.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.rotate,T=b===void 0?0:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:tr.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?12:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:tr.Attribute,descriptor:{name:"a_tex",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Pr(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),c=o.fontWeight,d=c===void 0?"400":c,y=o.fontFamily,_=y===void 0?"sans-serif":y,b=this.layer.getEncodedData(),T=[];b.forEach(function(A){var O=A.shape,F=O===void 0?"":O;F=F.toString();var W=Nx(F),J;try{for(W.s();!(J=W.n()).done;){var ue=J.value;T.indexOf(ue)===-1&&T.push(ue)}}catch(Ie){W.e(Ie)}finally{W.f()}}),this.fontService.setFontOptions({characterSet:T,fontWeight:d,fontFamily:_,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),c=o.fontWeight,d=c===void 0?"400":c,y=o.fontFamily,_=y===void 0?"sans-serif":y,b=this.layer.getEncodedData(),T=[];b.forEach(function(A){var O=A.shape,F=O===void 0?"":O;F=F.toString(),T.indexOf(F)===-1&&T.push(F)}),this.fontService.setFontOptions({characterSet:T,fontWeight:d,fontFamily:_,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var c=this,d=this.fontService.mapping,y=this.layer.getLayerConfig(),_=y.spacing,b=_===void 0?2:_,T=y.textAnchor,A=T===void 0?"center":T,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var W=F.shape,J=W===void 0?"":W,ue=F.id,Ie=F.size,rt=Ie===void 0?1:Ie,lt=F.textOffset,Tt=lt===void 0?[0,0]:lt,Ot=Fx(J.toString(),d,rt,A,"center",b,Tt,o),Zt=Bx(Ot,Tt,!1);return F.shaping=Ot,F.glyphQuads=Zt,F.centroid=Zh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Zh(F.originCoordinates):F.originCentroid=F.centroid,c.glyphInfoMap[ue]={shaping:Ot,glyphQuads:Zt,centroid:Zh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.padding,y=d===void 0?[4,4]:d,_=c.textAllowOverlap,b=_===void 0?!1:_;if(!b){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var T=this.rendererService.getViewportSize(),A=T.width,O=T.height,F=new kx(A,O),W=this.glyphInfo.filter(function(J){var ue=J.shaping,Ie=J.id,rt=Ie===void 0?0:Ie,lt=J.version==="GAODE2.x"?J.originCentroid:J.centroid,Tt=J.size,Ot=Tt/24,Zt=o.mapService.lngLatToContainer(lt),Vt=F.placeCollisionBox({x1:ue.left*Ot-y[0],x2:ue.right*Ot+y[0],y1:ue.top*Ot-y[1],y2:ue.bottom*Ot+y[1],anchorPointX:Zt.x,anchorPointY:Zt.y}),_r=Vt.box;return _r&&_r.length?(F.insertCollisionBox(_r,rt),!0):!1});W.forEach(function(J){o.glyphInfoMap[J.id]=J})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),c=o.iconfont,d=c===void 0?!1:c;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,c=this.fontService.canvas;this.textureHeight=c.height,this.texture&&this.texture.destroy(),this.texture=o({data:c,mag:re.LINEAR,min:re.LINEAR,width:c.width,height:c.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Do),jx={fill:Hm,image:Wm,normal:Xm,extrude:Gm,text:iy,icon:gx},Vx=jx;function Gx(e){var n=Hx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Hx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wx=function(e){(0,Je.Z)(r,e);var n=Gx(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PointLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new Vx[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return c[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),c=this.getLayerConfig(),d=c.shape2d,y=c.shape3d,_=this.iconService.getIconMap(),b=o.find(function(A){return A.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"normal":(d==null?void 0:d.indexOf(T))!==-1?"fill":(y==null?void 0:y.indexOf(T))!==-1?"extrude":_.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return"normal"}}]),r}(Wf);function Xx(e){var n=Yx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Yx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qx=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Kx=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,$x=function(e){(0,Je.Z)(r,e);var n=Xx(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Kx,fragmentShader:qx,triangulation:Dm})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:tr.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:tr.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?10:b;return Array.isArray(T)?[T[0]]:[T]}}})}}]),r}(Do);function Jx(e){var n=Qx();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Qx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eb=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tb=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,rb=function(e){(0,Je.Z)(r,e);var n=Jx(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:tb,fragmentShader:eb,triangulation:R_,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(Do),nb={fill:rb,line:Vm,extrude:$x,text:iy,point_fill:Hm,point_image:Wm,point_normal:Xm,point_extrude:Gm},ib=nb;function ab(e){var n=ob();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Je.Z)(r,e);var n=ab(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PolygonLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new ib[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=c==null||(o=c.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),c=this.getLayerConfig(),d=c.shape2d,y=c.shape3d,_=this.iconService.getIconMap(),b=o.find(function(A){return A.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"point_normal":(d==null?void 0:d.indexOf(T))!==-1?"point_fill":(y==null?void 0:y.indexOf(T))!==-1?"point_extrude":_.hasOwnProperty(T)?"point_image":"text"}else return"fill"}}]),r}(Wf);function sb(e){var n=ub();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,cb=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Je.Z)(r,e);var n=sb(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"colorTexture",void 0),i}return(0,Oe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.clampLow,_=y===void 0?!0:y,b=o.clampHigh,T=b===void 0?!0:b,A=o.noDataValue,O=A===void 0?-9999999:A,F=o.domain,W=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:W,u_clampLow:_,u_clampHigh:typeof T!="undefined"?T:_,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),c=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=c({data:d.data,width:d.width,height:d.height,format:re.LUMINANCE,type:re.FLOAT});var y=this.layer.getLayerConfig(),_=y.rampColors,b=mi(_);return this.colorTexture=c({data:b.data,width:b.width,height:b.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:cb,fragmentShader:lb,triangulation:Bm,primitive:re.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:tr.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,c=this.layer.getLayerConfig(),d=c.rampColors,y=mi(d);this.colorTexture=o({data:y.data,width:y.width,height:y.height,flipY:!1})}}]),r}(Do),fb={raster:oy,raster3d:oy},pb=fb;function hb(e){var n=db();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vb=function(e){(0,Je.Z)(r,e);var n=hb(r);function r(){var i;(0,we.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","RasterLayer"),i}return(0,Oe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new pb[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={raster:{},raster3d:{}};return c[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Wf),mb=G(50361),Gv=G.n(mb),sy,uy,ly,cy,fy,wd,py,hy,dy;function vy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function yb(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var gb=(sy=(0,ae.b2)(),uy=(0,ae.f3)(Q.IGlobalConfigService),ly=(0,ae.f3)(Q.IMapService),cy=(0,ae.f3)(Q.IFontService),sy(fy=(wd=function(){function e(){(0,we.Z)(this,e),Tn(this,"configService",py,this),Tn(this,"mapService",hy,this),Tn(this,"fontService",dy,this)}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:c})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:c}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=c.getLayerStyleAttributes()||[],y=c.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,b=d.filter(function(A){return A.needRemapping}),T=_;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(T=_.filter(function(A){return o.applyAttributeMapping(y,A)[0]})),b.length&&(y!=null&&y.needRemapping?(r.setEncodedData(o.mapping(d,T)),y.needRemapping=!1):r.setEncodedData(o.mapping(b,T,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var o=this,c=i.styleAttributeService,d=c.getLayerStyleAttributes()||[],y=c.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,b=_;y!=null&&y.scale&&(b=_.filter(function(T){return o.applyAttributeMapping(y,T)[0]})),r.setEncodedData(this.mapping(d,b))}},{key:"mapping",value:function(r,i,o){var c=this,d=i.map(function(y,_){var b=o?o[_]:{},T=yb({id:y._id,coordinates:y.coordinates},b);return r.filter(function(A){return A.scale!==void 0}).forEach(function(A){var O=c.applyAttributeMapping(A,y);A.needRemapping=!1,A.name==="color"&&(O=O.map(function(F){return Pn(F)})),T[A.name]=Array.isArray(O)&&O.length===1?O[0]:O,A.name==="shape"&&(T.shape=c.fontService.getIconFontKey(T[A.name]))}),T});return d.length>0&&this.mapService.version==="GAODE2.x"&&(typeof d[0].coordinates[0]=="number"?d.map(function(y){y.version="GAODE2.x",y.originCoordinates=Gv()(y.coordinates),y.coordinates=c.mapService.lngLatToCoord(y.coordinates)}):d.map(function(y){y.version="GAODE2.x",y.originCoordinates=Gv()(y.coordinates),y.coordinates=c.mapService.lngLatToCoords(y.coordinates)})),d}},{key:"applyAttributeMapping",value:function(r,i){var o;if(!r.scale)return[];var c=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],d=[];return c.forEach(function(y){var _,b=y.field;(i.hasOwnProperty(b)||((_=r.scale)===null||_===void 0?void 0:_.type)==="variable")&&d.push(i[b])}),r.mapping?r.mapping(d):[]}}]),e}(),py=$r(wd.prototype,"configService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hy=$r(wd.prototype,"mapService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=$r(wd.prototype,"fontService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||fy),my={},yy={},gy=function(n){return yy[n]},Sd=function(n,r){yy[n]=r},_b=function(n){return my[n]},jh=function(n,r){my[n]=r},_y={},Hv={},Wv=34,Ed=10,Xv=13;function xy(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function xb(e,n){var r=xy(e);return function(i,o){return n(r(i),o,e)}}function by(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var o in i)o in n||r.push(n[o]=o)}),r}function nl(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function bb(e){return e<0?"-"+nl(-e,6):e>9999?"+"+nl(e,6):nl(e,4)}function wb(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":bb(e.getUTCFullYear(),4)+"-"+nl(e.getUTCMonth()+1,2)+"-"+nl(e.getUTCDate(),2)+(o?"T"+nl(n,2)+":"+nl(r,2)+":"+nl(i,2)+"."+nl(o,3)+"Z":i?"T"+nl(n,2)+":"+nl(r,2)+":"+nl(i,2)+"Z":r||n?"T"+nl(n,2)+":"+nl(r,2)+"Z":"")}function Sb(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(A,O){var F,W,J=o(A,function(ue,Ie){if(F)return F(ue,Ie-1);W=ue,F=O?xb(ue,O):xy(ue)});return J.columns=W||[],J}function o(A,O){var F=[],W=A.length,J=0,ue=0,Ie,rt=W<=0,lt=!1;A.charCodeAt(W-1)===Ed&&--W,A.charCodeAt(W-1)===Xv&&--W;function Tt(){if(rt)return Hv;if(lt)return lt=!1,_y;var Zt,Vt=J,_r;if(A.charCodeAt(Vt)===Wv){for(;J++<W&&A.charCodeAt(J)!==Wv||A.charCodeAt(++J)===Wv;);return(Zt=J)>=W?rt=!0:(_r=A.charCodeAt(J++))===Ed?lt=!0:_r===Xv&&(lt=!0,A.charCodeAt(J)===Ed&&++J),A.slice(Vt+1,Zt-1).replace(/""/g,'"')}for(;J<W;){if((_r=A.charCodeAt(Zt=J++))===Ed)lt=!0;else if(_r===Xv)lt=!0,A.charCodeAt(J)===Ed&&++J;else if(_r!==r)continue;return A.slice(Vt,Zt)}return rt=!0,A.slice(Vt,W)}for(;(Ie=Tt())!==Hv;){for(var Ot=[];Ie!==_y&&Ie!==Hv;)Ot.push(Ie),Ie=Tt();O&&(Ot=O(Ot,ue++))==null||F.push(Ot)}return F}function c(A,O){return A.map(function(F){return O.map(function(W){return T(F[W])}).join(e)})}function d(A,O){return O==null&&(O=by(A)),[O.map(T).join(e)].concat(c(A,O)).join(`
`)}function y(A,O){return O==null&&(O=by(A)),c(A,O).join(`
`)}function _(A){return A.map(b).join(`
`)}function b(A){return A.map(T).join(e)}function T(A){return A==null?"":A instanceof Date?wb(A):n.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:i,parseRows:o,format:d,formatBody:y,formatRows:_,formatRow:b,formatValue:T}}var Qp=Sb(","),Eb=Qp.parse,KC=Qp.parseRows,$C=Qp.format,JC=Qp.formatBody,QC=Qp.formatRows,eT=Qp.formatRow,tT=Qp.formatValue,Cb=G(6563),wy=G.n(Cb);function Sy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ey(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Sy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Cy(e,n){var r=n.x,i=n.y,o=n.x1,c=n.y1,d=n.coordinates,y=[];return e.forEach(function(_,b){var T=[];if(r&&i&&(T=[parseFloat(_[r]),parseFloat(_[i])]),r&&i&&o&&c){var A=[parseFloat(_[r]),parseFloat(_[i])],O=[parseFloat(_[o]),parseFloat(_[c])];T=[A,O]}if(d){var F="Polygon";Array.isArray(d[0])||(F="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(F="LineString");var W={type:F,coordinates:(0,j.Z)(_[d])};wy()(W,!0),T=W.coordinates}var J=Ey(Ey({},_),{},{_id:b,coordinates:T});y.push(J)}),{dataArray:y}}function Tb(e,n){var r=Eb(e);return Cy(r,n)}function rT(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ab(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mb(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Mb(e[0]);throw new Error("coordinates must only contain numbers")}function nT(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function iT(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function aT(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var c=o[i];if(!c||c.type!=="Feature"||!c.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!c.geometry||c.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+c.geometry.type)}}function oT(e){return e.type==="Feature"?e.geometry:e}function sT(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function sv(e,n,r){if(e!==null)for(var i,o,c,d,y,_,b,T=0,A=0,O,F=e.type,W=F==="FeatureCollection",J=F==="Feature",ue=W?e.features.length:1,Ie=0;Ie<ue;Ie++){b=W?e.features[Ie].geometry:J?e.geometry:e,O=b?b.type==="GeometryCollection":!1,y=O?b.geometries.length:1;for(var rt=0;rt<y;rt++){var lt=0,Tt=0;if(d=O?b.geometries[rt]:b,d!==null){_=d.coordinates;var Ot=d.type;switch(T=r&&(Ot==="Polygon"||Ot==="MultiPolygon")?1:0,Ot){case null:break;case"Point":if(n(_,A,Ie,lt,Tt)===!1)return!1;A++,lt++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(n(_[i],A,Ie,lt,Tt)===!1)return!1;A++,Ot==="MultiPoint"&&lt++}Ot==="LineString"&&lt++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(o=0;o<_[i].length-T;o++){if(n(_[i][o],A,Ie,lt,Tt)===!1)return!1;A++}Ot==="MultiLineString"&&lt++,Ot==="Polygon"&&Tt++}Ot==="Polygon"&&lt++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(Tt=0,o=0;o<_[i].length;o++){for(c=0;c<_[i][o].length-T;c++){if(n(_[i][o][c],A,Ie,lt,Tt)===!1)return!1;A++}Tt++}lt++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(sv(d.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function uT(e,n,r,i){var o=r;return sv(e,function(c,d,y,_,b){d===0&&r===void 0?o=c:o=n(o,c,d,y,_,b)},i),o}function Pb(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function lT(e,n,r){var i=r;return Pb(e,function(o,c){c===0&&r===void 0?i=o:i=n(i,o,c)}),i}function Ib(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function cT(e,n,r){var i=r;return Ib(e,function(o,c){c===0&&r===void 0?i=o:i=n(i,o,c)}),i}function fT(e){var n=[];return sv(e,function(r){n.push(r)}),n}function Ty(e,n){var r,i,o,c,d,y,_,b,T,A,O=0,F=e.type==="FeatureCollection",W=e.type==="Feature",J=F?e.features.length:1;for(r=0;r<J;r++){for(y=F?e.features[r].geometry:W?e.geometry:e,b=F?e.features[r].properties:W?e.properties:{},T=F?e.features[r].bbox:W?e.bbox:void 0,A=F?e.features[r].id:W?e.id:void 0,_=y?y.type==="GeometryCollection":!1,d=_?y.geometries.length:1,o=0;o<d;o++){if(c=_?y.geometries[o]:y,c===null){if(n(null,O,b,T,A)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(c,O,b,T,A)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<c.geometries.length;i++)if(n(c.geometries[i],O,b,T,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function pT(e,n,r){var i=r;return Ty(e,function(o,c,d,y,_){c===0&&r===void 0?i=o:i=n(i,o,c,d,y,_)}),i}function uv(e,n){Ty(e,function(r,i,o,c,d){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return n(ki(r,o,{bbox:c,id:d}),i,0)===!1?!1:void 0}var _;switch(y){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var b=0;b<r.coordinates.length;b++){var T=r.coordinates[b],A={type:_,coordinates:T};if(n(ki(A,o),i,b)===!1)return!1}})}function hT(e,n,r){var i=r;return uv(e,function(o,c,d){c===0&&d===0&&r===void 0?i=o:i=n(i,o,c,d)}),i}function Ob(e,n){uv(e,function(r,i,o){var c=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var y,_=0,b=0,T=0;if(sv(r,function(A,O,F,W,J){if(y===void 0||i>_||W>b||J>T){y=A,_=i,b=W,T=J,c=0;return}var ue=lineString([y,A],r.properties);if(n(ue,i,o,J,c)===!1)return!1;c++,y=A})===!1)return!1}}})}function dT(e,n,r){var i=r,o=!1;return Ob(e,function(c,d,y,_,b){o===!1&&r===void 0?i=c:i=n(i,c,d,y,_,b),o=!0}),i}function kb(e,n){if(!e)throw new Error("geojson is required");uv(e,function(r,i,o){if(r.geometry!==null){var c=r.geometry.type,d=r.geometry.coordinates;switch(c){case"LineString":if(n(r,i,o,0,0)===!1)return!1;break;case"Polygon":for(var y=0;y<d.length;y++)if(n(lineString(d[y],r.properties),i,o,y)===!1)return!1;break}}})}function vT(e,n,r){var i=r;return kb(e,function(o,c,d,y){c===0&&r===void 0?i=o:i=n(i,o,c,d,y)}),i}function mT(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,c=n.segmentIndex||0,d=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":d=d||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":case"MultiPoint":return null;case"LineString":return c<0&&(c=_.length+c-1),lineString([_[c],_[c+1]],d,n);case"Polygon":return o<0&&(o=_.length+o),c<0&&(c=_[o].length+c-1),lineString([_[o][c],_[o][c+1]],d,n);case"MultiLineString":return i<0&&(i=_.length+i),c<0&&(c=_[i].length+c-1),lineString([_[i][c],_[i][c+1]],d,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),c<0&&(c=_[i][o].length-c-1),lineString([_[i][o][c],_[i][o][c+1]],d,n)}throw new Error("geojson is invalid")}function yT(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,c=n.coordIndex||0,d=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":d=d||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":return point(_,d,n);case"MultiPoint":return i<0&&(i=_.length+i),point(_[i],d,n);case"LineString":return c<0&&(c=_.length+c),point(_[c],d,n);case"Polygon":return o<0&&(o=_.length+o),c<0&&(c=_[o].length+c),point(_[o][c],d,n);case"MultiLineString":return i<0&&(i=_.length+i),c<0&&(c=_[i].length+c),point(_[i][c],d,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),c<0&&(c=_[i][o].length-c),point(_[i][o][c],d,n)}throw new Error("geojson is invalid")}function Ay(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function My(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ay(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ay(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Lb(e,n){var r=[],i={};if(e.features=e.features.filter(function(c){var d=c.geometry;return c!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),wy()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var o=0;return uv(e,function(c,d){var y=Ab(c),_=d,b=My(My({},c.properties),{},{coordinates:y,_id:_});r.push(b)}),{dataArray:r,featureKeys:i}}function Py(e,n){var r=n.extent,i=new Promise(function(c){Rb(e,function(d){c(d)})}),o={images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return o}function Rb(e,n){var r=e,i=[];if(typeof r=="string")Mi({url:r},function(d,y){i.push(y),n(i)});else{var o=r.length,c=0;r.forEach(function(d){Mi({url:d},function(y,_){c++,i.push(_),c===o&&n(i)})})}return Py}function Db(e,n){var r=n.extent,i=n.width,o=n.height,c=n.min,d=n.max,y={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:o,min:c,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return y}var Fb=G(30236),Bb=G.n(Fb);function Iy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Oy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Iy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ky(e,n){var r=n.radius,i=r===void 0?40:r,o=n.maxZoom,c=o===void 0?18:o,d=n.minZoom,y=d===void 0?0:d,_=n.zoom,b=_===void 0?2:_;if(e.pointIndex){var T=e.pointIndex.getClusters(e.extent,Math.floor(b));return e.dataArray=Nb(T),e}var A=new(Xi())({radius:i,minZoom:y,maxZoom:c}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:Oy({},F)}}),A.load(O.features),A}function Nb(e){return e.map(function(n,r){return Oy({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function zb(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function Zb(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function Ly(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,o=1;o<e.length;o++)i=n+e[o]*1,Math.abs(n)>=Math.abs(e[o])?r+=n-i+e[o]:r+=e[o]-i+n,n=i;return n+r*1}function Ub(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ly(e)/e.length}var jb={min:Zb,max:zb,mean:Ub,sum:Ly};function Vb(e,n){return e.map(function(r){return r[n]*1})}function Ry(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Dy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ry(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ry(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gb(e){var n=Hb();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Wb(e,n){if(Array.isArray(n))return n}var Xb=function(e){(0,Je.Z)(r,e);var n=Gb(r);function r(i,o){var c;return(0,we.Z)(this,r),c=n.call(this),(0,M.Z)((0,H.Z)(c),"data",void 0),(0,M.Z)((0,H.Z)(c),"extent",void 0),(0,M.Z)((0,H.Z)(c),"hooks",{init:new za}),(0,M.Z)((0,H.Z)(c),"parser",{type:"geojson"}),(0,M.Z)((0,H.Z)(c),"transforms",[]),(0,M.Z)((0,H.Z)(c),"cluster",!1),(0,M.Z)((0,H.Z)(c),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,M.Z)((0,H.Z)(c),"mapService",void 0),(0,M.Z)((0,H.Z)(c),"invalidExtent",!1),(0,M.Z)((0,H.Z)(c),"originData",void 0),(0,M.Z)((0,H.Z)(c),"rawData",void 0),(0,M.Z)((0,H.Z)(c),"cfg",{}),(0,M.Z)((0,H.Z)(c),"clusterIndex",void 0),c.originData=i,c.initCfg(o),c.hooks.init.tap("parser",function(){c.excuteParser()}),c.hooks.init.tap("cluster",function(){c.initCluster()}),c.hooks.init.tap("transform",function(){c.executeTrans()}),c.init(),c}return(0,Oe.Z)(r,[{key:"setData",value:function(o,c){this.rawData=o,this.originData=o,this.initCfg(c),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var c=this,d=this.clusterOptions,y=d.method,_=y===void 0?"sum":y,b=d.field,T=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,T.forEach(function(A){A.id||(A.properties.point_count=1)}),(b||pf()(_))&&(T=T.map(function(A){var O=A.id;if(O){var F=c.clusterIndex.getLeaves(O,Infinity),W=F.map(function(Ie){return Ie.properties}),J;if(Is()(_)&&b){var ue=Vb(W,b);J=jb[_](ue)}pf()(_)&&(J=_(W)),A.properties.stat=J}else A.properties.point_count=1;return A})),this.data=gy("geojson")({type:"FeatureCollection",features:T}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var c=this.parser.type,d=c===void 0?"geojson":c;if(d==="geojson"&&!this.cluster){var y=o<this.originData.features.length?this.originData.features[o]:"null",_=Gv()(y);if(this.transforms.length!==0){var b=this.data.dataArray.find(function(T){return T._id===o});_.properties=b}return _}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,c){var d=this.data.dataArray.find(function(y){return y[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var c=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(c=Pr(Lr(this.extent),o)),c[0].concat(c[1])}},{key:"initCfg",value:function(o){this.cfg=Bb()(this.cfg,o,Wb);var c=this.cfg;c&&(c.parser&&(this.parser=c.parser),c.transforms&&(this.transforms=c.transforms),this.cluster=c.cluster||!1,c.clusterOptions&&(this.cluster=!0,this.clusterOptions=Dy(Dy({},this.clusterOptions),c.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,c=o.type||"geojson",d=gy(c);this.data=d(this.originData,o),this.extent=We(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,c=this.transforms;c.forEach(function(d){var y=d.type,_=_b(y)(o.data,d);Object.assign(o.data,_)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=ky(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(se.EventEmitter);function Yb(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Fy(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qb(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function qb(e,n){if(!!e){if(typeof e=="string")return By(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return By(e,n)}}function By(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Yv=6378e3;function Kb(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,c=o/(2*Math.PI*Yv)*(256<<20)/2,d=$b(r,o),y=d.gridHash,_=d.gridOffset,b=t2(y,_,n);return{yOffset:c,xOffset:c,radius:c,type:"grid",dataArray:b}}function $b(e,n){var r=Infinity,i=-Infinity,o,c=Fy(e),d;try{for(c.s();!(d=c.n()).done;){var y=d.value;o=y.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,i=o>i?o:i)}}catch(lt){c.e(lt)}finally{c.f()}var _=(r+i)/2,b=Jb(n,_);if(b.xOffset<=0||b.yOffset<=0)return{gridHash:{},gridOffset:b};var T={},A=Fy(e),O;try{for(A.s();!(O=A.n()).done;){var F=O.value,W=F.coordinates[1],J=F.coordinates[0];if(Number.isFinite(W)&&Number.isFinite(J)){var ue=Math.floor((W+90)/b.yOffset),Ie=Math.floor((J+180)/b.xOffset),rt="".concat(ue,"-").concat(Ie);T[rt]=T[rt]||{count:0,points:[]},T[rt].count+=1,T[rt].points.push(F)}}}catch(lt){A.e(lt)}finally{A.f()}return{gridHash:T,gridOffset:b}}function Jb(e,n){var r=Qb(e),i=e2(n,e);return{yOffset:r,xOffset:i}}function Qb(e){return e/Yv*(180/Math.PI)}function e2(e,n){return n/Yv*(180/Math.PI)/Math.cos(e*Math.PI/180)}function t2(e,n,r){return Object.keys(e).reduce(function(i,o,c){var d=o.split("-"),y=parseInt(d[0],10),_=parseInt(d[1],10),b={};if(r.field&&r.method){var T=qs(e[o].points,r.field);b[r.method]=ku[r.method](T)}return Object.assign(b,{_id:c,coordinates:Rr([-180+n.xOffset*(_+.5),-90+n.yOffset*(y+.5)]),rawData:e[o].points,count:e[o].count}),i.push(b),i},[])}var Vh=Math.PI/3,r2=[0,Vh,2*Vh,3*Vh,4*Vh,5*Vh];function n2(e){return e[0]}function i2(e){return e[1]}function a2(){var e=0,n=0,r=1,i=1,o=n2,c=i2,d,y,_;function b(A){var O={},F=[],W,J=A.length;for(W=0;W<J;++W)if(!(isNaN(Ie=+o.call(null,ue=A[W],W,A))||isNaN(rt=+c.call(null,ue,W,A)))){var ue,Ie,rt,lt=Math.round(rt=rt/_),Tt=Math.round(Ie=Ie/y-(lt&1)/2),Ot=rt-lt;if(Math.abs(Ot)*3>1){var Zt=Ie-Tt,Vt=Tt+(Ie<Tt?-1:1)/2,_r=lt+(rt<lt?-1:1),Zr=Ie-Vt,Yr=rt-_r;Zt*Zt+Ot*Ot>Zr*Zr+Yr*Yr&&(Tt=Vt+(lt&1?1:-1)/2,lt=_r)}var Cr=Tt+"-"+lt,sn=O[Cr];sn?sn.push(ue):(F.push(sn=O[Cr]=[ue]),sn.x=(Tt+(lt&1)/2)*y,sn.y=lt*_)}return F}function T(A){var O=0,F=0;return r2.map(function(W){var J=Math.sin(W)*A,ue=-Math.cos(W)*A,Ie=J-O,rt=ue-F;return O=J,F=ue,[Ie,rt]})}return b.hexagon=function(A){return"m"+T(A==null?d:+A).join("l")+"z"},b.centers=function(){for(var A=[],O=Math.round(n/_),F=Math.round(e/y),W=O*_;W<i+d;W+=_,++O)for(var J=F*y+(O&1)*y/2;J<r+y/2;J+=y)A.push([J,W]);return A},b.mesh=function(){var A=T(d).slice(0,4).join("l");return b.centers().map(function(O){return"M"+O+"m"+A}).join("")},b.x=function(A){return arguments.length?(o=A,b):o},b.y=function(A){return arguments.length?(c=A,b):c},b.radius=function(A){return arguments.length?(d=+A,y=d*2*Math.sin(Vh),_=d*1.5,b):d},b.size=function(A){return arguments.length?(e=n=0,r=+A[0],i=+A[1],b):[r-e,i-n]},b.extent=function(A){return arguments.length?(e=+A[0][0],n=+A[0][1],r=+A[1][0],i=+A[1][1],b):[[e,n],[r,i]]},b.radius(1)}function Ny(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function zy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ny(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ny(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var o2=6378e3;function s2(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,c=n.method,d=c===void 0?"sum":c,y=o/(2*Math.PI*o2)*(256<<20)/2,_=r.map(function(O){var F=Rr(O.coordinates),W=(0,Dt.Z)(F,2),J=W[0],ue=W[1];return zy(zy({},O),{},{coordinates:[J,ue]})}),b=a2().radius(y).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),T=b(_),A={dataArray:T.map(function(O,F){var W;if(n.field&&d){var J=qs(O,n.field);O[d]=ku[d](J)}return W={},(0,M.Z)(W,n.method,O[d]),(0,M.Z)(W,"count",O.length),(0,M.Z)(W,"rawData",O),(0,M.Z)(W,"coordinates",[O.x,O.y]),(0,M.Z)(W,"_id",F),W}),radius:y,xOffset:y,yOffset:y,type:"hexagon"};return A}function Zy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Uy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function u2(e,n){var r=n.sourceField,i=n.targetField,o=n.data,c={};return o.forEach(function(d){c[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var y=d[i];return Uy(Uy({},d),c[y])}),e}function l2(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var c2=Xb;Sd("geojson",Lb),Sd("image",Py),Sd("csv",Tb),Sd("json",Cy),Sd("raster",Db),jh("cluster",ky),jh("filter",Yb),jh("join",u2),jh("map",l2),jh("grid",Kb),jh("hexagon",s2);var jy,Vy,f2=(jy=(0,ae.b2)(),jy(Vy=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"mapService",void 0)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get(Q.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var c=r.sourceOption,d=c.data,y=c.options;r.setSource(new c2(d,y))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=i.updateClusterData(r),c=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||c})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),o=i.cluster,c=i.clusterOptions,d=c.zoom,y=d===void 0?0:d,_=c.maxZoom,b=_===void 0?16:_,T=this.mapService.getZoom()-1,A=r.dataState.dataSourceNeedUpdate;return o&&(A||Math.abs(y-T)>1)&&b>y?(i.updateClusterData(Math.floor(T)),!0):!1}}]),e}())||Vy);function qv(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function Gy(e){return e.length===1&&(e=p2(e)),{left:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var c=i+o>>>1;e(n[c],r)<0?i=c+1:o=c}return i},right:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var c=i+o>>>1;e(n[c],r)>0?o=c:i=c+1}return i}}}function p2(e){return function(n,r){return qv(e(n),r)}}var Hy=Gy(qv),h2=Hy.right,gT=Hy.left,lv=h2;function d2(e,n){var r=e.length,i=-1,o,c,d;if(n==null){for(;++i<r;)if((o=e[i])!=null&&o>=o)for(c=d=o;++i<r;)(o=e[i])!=null&&(c>o&&(c=o),d<o&&(d=o))}else for(;++i<r;)if((o=n(e[i],i,e))!=null&&o>=o)for(c=d=o;++i<r;)(o=n(e[i],i,e))!=null&&(c>o&&(c=o),d<o&&(d=o));return[c,d]}var Wy=Array.prototype,_T=Wy.slice,xT=Wy.map,Kv=Math.sqrt(50),$v=Math.sqrt(10),Jv=Math.sqrt(2);function Xy(e,n,r){var i,o=-1,c,d,y;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(c=e,e=n,n=c),(y=cv(e,n,r))===0||!isFinite(y))return[];if(y>0)for(e=Math.ceil(e/y),n=Math.floor(n/y),d=new Array(c=Math.ceil(n-e+1));++o<c;)d[o]=(e+o)*y;else for(e=Math.floor(e*y),n=Math.ceil(n*y),d=new Array(c=Math.ceil(e-n+1));++o<c;)d[o]=(e-o)/y;return i&&d.reverse(),d}function cv(e,n,r){var i=(n-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),c=i/Math.pow(10,o);return o>=0?(c>=Kv?10:c>=$v?5:c>=Jv?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(c>=Kv?10:c>=$v?5:c>=Jv?2:1)}function Qv(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),c=i/o;return c>=Kv?o*=10:c>=$v?o*=5:c>=Jv&&(o*=2),n<e?-o:o}function bT(){var e=identity,n=extent,r=sturges;function i(o){var c,d=o.length,y,_=new Array(d);for(c=0;c<d;++c)_[c]=e(o[c],c,o);var b=n(_),T=b[0],A=b[1],O=r(_,T,A);Array.isArray(O)||(O=tickStep(T,A,O),O=range(Math.ceil(T/O)*O,A,O));for(var F=O.length;O[0]<=T;)O.shift(),--F;for(;O[F-1]>A;)O.pop(),--F;var W=new Array(F+1),J;for(c=0;c<=F;++c)J=W[c]=[],J.x0=c>0?O[c-1]:T,J.x1=c<F?O[c]:A;for(c=0;c<d;++c)y=_[c],T<=y&&y<=A&&W[bisect(O,y,0,F)].push(o[c]);return W}return i.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),i):e},i.domain=function(o){return arguments.length?(n=typeof o=="function"?o:constant([o[0],o[1]]),i):n},i.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),i):r},i}function wT(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function v2(e){return e===null?NaN:+e}function m2(e,n,r){if(r==null&&(r=v2),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,o=(i-1)*n,c=Math.floor(o),d=+r(e[c],c,e),y=+r(e[c+1],c+1,e);return d+(y-d)*(o-c)}}var nc="$";function fv(){}fv.prototype=Yy.prototype={constructor:fv,has:function(e){return nc+e in this},get:function(e){return this[nc+e]},set:function(e,n){return this[nc+e]=n,this},remove:function(e){var n=nc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===nc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===nc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===nc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===nc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===nc&&++e;return e},empty:function(){for(var e in this)if(e[0]===nc)return!1;return!0},each:function(e){for(var n in this)n[0]===nc&&e(this[n],n.slice(1),this)}};function Yy(e,n){var r=new fv;if(e instanceof fv)e.each(function(y,_){r.set(_,y)});else if(Array.isArray(e)){var i=-1,o=e.length,c;if(n==null)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(n(c=e[i],i,e),c)}else if(e)for(var d in e)r.set(d,e[d]);return r}var em=Yy;function ST(){var e=[],n=[],r,i,o;function c(y,_,b,T){if(_>=e.length)return r!=null&&y.sort(r),i!=null?i(y):y;for(var A=-1,O=y.length,F=e[_++],W,J,ue=map(),Ie,rt=b();++A<O;)(Ie=ue.get(W=F(J=y[A])+""))?Ie.push(J):ue.set(W,[J]);return ue.each(function(lt,Tt){T(rt,Tt,c(lt,_,b,T))}),rt}function d(y,_){if(++_>e.length)return y;var b,T=n[_-1];return i!=null&&_>=e.length?b=y.entries():(b=[],y.each(function(A,O){b.push({key:O,values:d(A,_)})})),T!=null?b.sort(function(A,O){return T(A.key,O.key)}):b}return o={object:function(y){return c(y,0,y2,g2)},map:function(y){return c(y,0,qy,Ky)},entries:function(y){return d(c(y,0,qy,Ky),0)},key:function(y){return e.push(y),o},sortKeys:function(y){return n[e.length-1]=y,o},sortValues:function(y){return r=y,o},rollup:function(y){return i=y,o}}}function y2(){return{}}function g2(e,n,r){e[n]=r}function qy(){return map()}function Ky(e,n,r){e.set(n,r)}function pv(){}var eh=em.prototype;pv.prototype=_2.prototype={constructor:pv,has:eh.has,add:function(e){return e+="",this[nc+e]=e,this},remove:eh.remove,clear:eh.clear,values:eh.keys,size:eh.size,empty:eh.empty,each:eh.each};function _2(e,n){var r=new pv;if(e instanceof pv)e.each(function(c){r.add(c)});else if(e){var i=-1,o=e.length;if(n==null)for(;++i<o;)r.add(e[i]);else for(;++i<o;)r.add(n(e[i],i,e))}return r}var ET=null,$y=Array.prototype,hv=$y.map,th=$y.slice;function wp(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function CT(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var Jy={name:"implicit"};function dv(){var e=em(),n=[],r=[],i=Jy;function o(c){var d=c+"",y=e.get(d);if(!y){if(i!==Jy)return i;e.set(d,y=n.push(c))}return r[(y-1)%r.length]}return o.domain=function(c){if(!arguments.length)return n.slice();n=[],e=em();for(var d=-1,y=c.length,_,b;++d<y;)e.has(b=(_=c[d])+"")||e.set(b,n.push(_));return o},o.range=function(c){return arguments.length?(r=th.call(c),o):r.slice()},o.unknown=function(c){return arguments.length?(i=c,o):i},o.copy=function(){return dv(n,r).unknown(i)},wp.apply(o,arguments),o}function Qy(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],o,c,d=!1,y=0,_=0,b=.5;delete e.unknown;function T(){var A=n().length,O=i[1]<i[0],F=i[O-0],W=i[1-O];o=(W-F)/Math.max(1,A-y+_*2),d&&(o=Math.floor(o)),F+=(W-F-o*(A-y))*b,c=o*(1-y),d&&(F=Math.round(F),c=Math.round(c));var J=sequence(A).map(function(ue){return F+o*ue});return r(O?J.reverse():J)}return e.domain=function(A){return arguments.length?(n(A),T()):n()},e.range=function(A){return arguments.length?(i=[+A[0],+A[1]],T()):i.slice()},e.rangeRound=function(A){return i=[+A[0],+A[1]],d=!0,T()},e.bandwidth=function(){return c},e.step=function(){return o},e.round=function(A){return arguments.length?(d=!!A,T()):d},e.padding=function(A){return arguments.length?(y=Math.min(1,_=+A),T()):y},e.paddingInner=function(A){return arguments.length?(y=Math.min(1,A),T()):y},e.paddingOuter=function(A){return arguments.length?(_=+A,T()):_},e.align=function(A){return arguments.length?(b=Math.max(0,Math.min(1,A)),T()):b},e.copy=function(){return Qy(n(),i).round(d).paddingInner(y).paddingOuter(_).align(b)},initRange.apply(T(),arguments)}function eg(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return eg(n())},e}function TT(){return eg(Qy.apply(null,arguments).paddingInner(1))}var x2=G(26257),b2=G(73626);function w2(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function S2(e){return function(){return e}}function tm(e){return+e}var tg=[0,1];function ic(e){return e}function rm(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:S2(isNaN(n)?NaN:.5)}function rg(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(o){return Math.max(n,Math.min(r,o))}}function E2(e,n,r){var i=e[0],o=e[1],c=n[0],d=n[1];return o<i?(i=rm(o,i),c=r(d,c)):(i=rm(i,o),c=r(c,d)),function(y){return c(i(y))}}function C2(e,n,r){var i=Math.min(e.length,n.length)-1,o=new Array(i),c=new Array(i),d=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++d<i;)o[d]=rm(e[d],e[d+1]),c[d]=r(n[d],n[d+1]);return function(y){var _=lv(e,y,1,i)-1;return c[_](o[_](y))}}function vv(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function nm(){var e=tg,n=tg,r=x2.Z,i,o,c,d=ic,y,_,b;function T(){return y=Math.min(e.length,n.length)>2?C2:E2,_=b=null,A}function A(O){return isNaN(O=+O)?c:(_||(_=y(e.map(i),n,r)))(i(d(O)))}return A.invert=function(O){return d(o((b||(b=y(n,e.map(i),b2.Z)))(O)))},A.domain=function(O){return arguments.length?(e=hv.call(O,tm),d===ic||(d=rg(e)),T()):e.slice()},A.range=function(O){return arguments.length?(n=th.call(O),T()):n.slice()},A.rangeRound=function(O){return n=th.call(O),r=w2,T()},A.clamp=function(O){return arguments.length?(d=O?rg(e):ic,A):d!==ic},A.interpolate=function(O){return arguments.length?(r=O,T()):r},A.unknown=function(O){return arguments.length?(c=O,A):c},function(O,F){return i=O,o=F,T()}}function ng(e,n){return nm()(e,n)}var T2=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mv(e){if(!(n=T2.exec(e)))throw new Error("invalid format: "+e);var n;return new im({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}mv.prototype=im.prototype;function im(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}im.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function A2(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function yv(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function Gh(e){return e=yv(Math.abs(e)),e?e[1]:NaN}function M2(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Gh(n)/3)))*3-Gh(Math.abs(e)))}function P2(e,n){return function(r,i){for(var o=r.length,c=[],d=0,y=e[0],_=0;o>0&&y>0&&(_+y+1>i&&(y=Math.max(1,i-_)),c.push(r.substring(o-=y,o+y)),!((_+=y+1)>i));)y=e[d=(d+1)%e.length];return c.reverse().join(n)}}function I2(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function O2(e){e:for(var n=e.length,r=1,i=-1,o;r<n;++r)switch(e[r]){case".":i=o=r;break;case"0":i===0&&(i=r),o=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(o+1):e}var ig;function k2(e,n){var r=yv(e,n);if(!r)return e+"";var i=r[0],o=r[1],c=o-(ig=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=i.length;return c===d?i:c>d?i+new Array(c-d+1).join("0"):c>0?i.slice(0,c)+"."+i.slice(c):"0."+new Array(1-c).join("0")+yv(e,Math.max(0,n+c-1))[0]}function ag(e,n){var r=yv(e,n);if(!r)return e+"";var i=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}var og={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:A2,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return ag(e*100,n)},r:ag,s:k2,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function sg(e){return e}var ug=Array.prototype.map,lg=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function L2(e){var n=e.grouping===void 0||e.thousands===void 0?sg:P2(ug.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",c=e.numerals===void 0?sg:I2(ug.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function b(A){A=mv(A);var O=A.fill,F=A.align,W=A.sign,J=A.symbol,ue=A.zero,Ie=A.width,rt=A.comma,lt=A.precision,Tt=A.trim,Ot=A.type;Ot==="n"?(rt=!0,Ot="g"):og[Ot]||(lt===void 0&&(lt=12),Tt=!0,Ot="g"),(ue||O==="0"&&F==="=")&&(ue=!0,O="0",F="=");var Zt=J==="$"?r:J==="#"&&/[boxX]/.test(Ot)?"0"+Ot.toLowerCase():"",Vt=J==="$"?i:/[%p]/.test(Ot)?d:"",_r=og[Ot],Zr=/[defgprs%]/.test(Ot);lt=lt===void 0?6:/[gprs]/.test(Ot)?Math.max(1,Math.min(21,lt)):Math.max(0,Math.min(20,lt));function Yr(Cr){var sn=Zt,Ln=Vt,Hn,Ga,Ls;if(Ot==="c")Ln=_r(Cr)+Ln,Cr="";else{Cr=+Cr;var Ys=Cr<0||1/Cr<0;if(Cr=isNaN(Cr)?_:_r(Math.abs(Cr),lt),Tt&&(Cr=O2(Cr)),Ys&&+Cr==0&&W!=="+"&&(Ys=!1),sn=(Ys?W==="("?W:y:W==="-"||W==="("?"":W)+sn,Ln=(Ot==="s"?lg[8+ig/3]:"")+Ln+(Ys&&W==="("?")":""),Zr){for(Hn=-1,Ga=Cr.length;++Hn<Ga;)if(Ls=Cr.charCodeAt(Hn),48>Ls||Ls>57){Ln=(Ls===46?o+Cr.slice(Hn+1):Cr.slice(Hn))+Ln,Cr=Cr.slice(0,Hn);break}}}rt&&!ue&&(Cr=n(Cr,Infinity));var Yf=sn.length+Cr.length+Ln.length,il=Yf<Ie?new Array(Ie-Yf+1).join(O):"";switch(rt&&ue&&(Cr=n(il+Cr,il.length?Ie-Ln.length:Infinity),il=""),F){case"<":Cr=sn+Cr+Ln+il;break;case"=":Cr=sn+il+Cr+Ln;break;case"^":Cr=il.slice(0,Yf=il.length>>1)+sn+Cr+Ln+il.slice(Yf);break;default:Cr=il+sn+Cr+Ln;break}return c(Cr)}return Yr.toString=function(){return A+""},Yr}function T(A,O){var F=b((A=mv(A),A.type="f",A)),W=Math.max(-8,Math.min(8,Math.floor(Gh(O)/3)))*3,J=Math.pow(10,-W),ue=lg[8+W/3];return function(Ie){return F(J*Ie)+ue}}return{format:b,formatPrefix:T}}var gv,am,cg;R2({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function R2(e){return gv=L2(e),am=gv.format,cg=gv.formatPrefix,gv}function D2(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,Gh(n)-Gh(e))+1}function F2(e){return Math.max(0,-Gh(Math.abs(e)))}function B2(e,n,r,i){var o=Qv(e,n,r),c;switch(i=mv(i==null?",f":i),i.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(c=M2(o,d))&&(i.precision=c),cg(i,d)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(c=D2(o,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=c-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(c=F2(o))&&(i.precision=c-(i.type==="%")*2);break}}return am(i)}function _v(e){var n=e.domain;return e.ticks=function(r){var i=n();return Xy(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var o=n();return B2(o[0],o[o.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),o=0,c=i.length-1,d=i[o],y=i[c],_;return y<d&&(_=d,d=y,y=_,_=o,o=c,c=_),_=cv(d,y,r),_>0?(d=Math.floor(d/_)*_,y=Math.ceil(y/_)*_,_=cv(d,y,r)):_<0&&(d=Math.ceil(d*_)/_,y=Math.floor(y*_)/_,_=cv(d,y,r)),_>0?(i[o]=Math.floor(d/_)*_,i[c]=Math.ceil(y/_)*_,n(i)):_<0&&(i[o]=Math.ceil(d*_)/_,i[c]=Math.floor(y*_)/_,n(i)),e},e}function fg(){var e=ng(ic,ic);return e.copy=function(){return vv(e,fg())},wp.apply(e,arguments),_v(e)}function pg(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=hv.call(i,tm),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return pg(e).unknown(n)},e=arguments.length?hv.call(e,tm):[0,1],_v(r)}function hg(e,n){e=e.slice();var r=0,i=e.length-1,o=e[r],c=e[i],d;return c<o&&(d=r,r=i,i=d,d=o,o=c,c=d),e[r]=n.floor(o),e[i]=n.ceil(c),e}function dg(e){return Math.log(e)}function vg(e){return Math.exp(e)}function N2(e){return-Math.log(-e)}function z2(e){return-Math.exp(-e)}function Z2(e){return isFinite(e)?+("1e"+e):e<0?0:e}function U2(e){return e===10?Z2:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function j2(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function mg(e){return function(n){return-e(-n)}}function V2(e){var n=e(dg,vg),r=n.domain,i=10,o,c;function d(){return o=j2(i),c=U2(i),r()[0]<0?(o=mg(o),c=mg(c),e(N2,z2)):e(dg,vg),n}return n.base=function(y){return arguments.length?(i=+y,d()):i},n.domain=function(y){return arguments.length?(r(y),d()):r()},n.ticks=function(y){var _=r(),b=_[0],T=_[_.length-1],A;(A=T<b)&&(O=b,b=T,T=O);var O=o(b),F=o(T),W,J,ue,Ie=y==null?10:+y,rt=[];if(!(i%1)&&F-O<Ie){if(O=Math.round(O)-1,F=Math.round(F)+1,b>0){for(;O<F;++O)for(J=1,W=c(O);J<i;++J)if(ue=W*J,!(ue<b)){if(ue>T)break;rt.push(ue)}}else for(;O<F;++O)for(J=i-1,W=c(O);J>=1;--J)if(ue=W*J,!(ue<b)){if(ue>T)break;rt.push(ue)}}else rt=Xy(O,F,Math.min(F-O,Ie)).map(c);return A?rt.reverse():rt},n.tickFormat=function(y,_){if(_==null&&(_=i===10?".0e":","),typeof _!="function"&&(_=am(_)),y===Infinity)return _;y==null&&(y=10);var b=Math.max(1,i*y/n.ticks().length);return function(T){var A=T/c(Math.round(o(T)));return A*i<i-.5&&(A*=i),A<=b?_(T):""}},n.nice=function(){return r(hg(r(),{floor:function(y){return c(Math.floor(o(y)))},ceil:function(y){return c(Math.ceil(o(y)))}}))},n}function yg(){var e=V2(nm()).domain([1,10]);return e.copy=function(){return vv(e,yg()).base(e.base())},wp.apply(e,arguments),e}function gg(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function _g(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function G2(e){var n=1,r=e(gg(n),_g(n));return r.constant=function(i){return arguments.length?e(gg(n=+i),_g(n)):n},linearish(r)}function H2(){var e=G2(transformer());return e.copy=function(){return copy(e,H2()).constant(e.constant())},initRange.apply(e,arguments)}function xg(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function W2(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function X2(e){return e<0?-e*e:e*e}function Y2(e){var n=e(ic,ic),r=1;function i(){return r===1?e(ic,ic):r===.5?e(W2,X2):e(xg(r),xg(1/r))}return n.exponent=function(o){return arguments.length?(r=+o,i()):r},_v(n)}function om(){var e=Y2(nm());return e.copy=function(){return vv(e,om()).exponent(e.exponent())},wp.apply(e,arguments),e}function AT(){return om.apply(null,arguments).exponent(.5)}function bg(){var e=[],n=[],r=[],i;function o(){var d=0,y=Math.max(1,n.length);for(r=new Array(y-1);++d<y;)r[d-1]=m2(e,d/y);return c}function c(d){return isNaN(d=+d)?i:n[lv(r,d)]}return c.invertExtent=function(d){var y=n.indexOf(d);return y<0?[NaN,NaN]:[y>0?r[y-1]:e[0],y<r.length?r[y]:e[e.length-1]]},c.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var y=0,_=d.length,b;y<_;++y)b=d[y],b!=null&&!isNaN(b=+b)&&e.push(b);return e.sort(qv),o()},c.range=function(d){return arguments.length?(n=th.call(d),o()):n.slice()},c.unknown=function(d){return arguments.length?(i=d,c):i},c.quantiles=function(){return r.slice()},c.copy=function(){return bg().domain(e).range(n).unknown(i)},wp.apply(c,arguments)}function wg(){var e=0,n=1,r=1,i=[.5],o=[0,1],c;function d(_){return _<=_?o[lv(i,_,0,r)]:c}function y(){var _=-1;for(i=new Array(r);++_<r;)i[_]=((_+1)*n-(_-r)*e)/(r+1);return d}return d.domain=function(_){return arguments.length?(e=+_[0],n=+_[1],y()):[e,n]},d.range=function(_){return arguments.length?(r=(o=th.call(_)).length-1,y()):o.slice()},d.invertExtent=function(_){var b=o.indexOf(_);return b<0?[NaN,NaN]:b<1?[e,i[0]]:b>=r?[i[r-1],n]:[i[b-1],i[b]]},d.unknown=function(_){return arguments.length&&(c=_),d},d.thresholds=function(){return i.slice()},d.copy=function(){return wg().domain([e,n]).range(o).unknown(c)},wp.apply(_v(d),arguments)}function Sg(){var e=[.5],n=[0,1],r,i=1;function o(c){return c<=c?n[lv(e,c,0,i)]:r}return o.domain=function(c){return arguments.length?(e=th.call(c),i=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(c){return arguments.length?(n=th.call(c),i=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(c){var d=n.indexOf(c);return[e[d-1],e[d]]},o.unknown=function(c){return arguments.length?(r=c,o):r},o.copy=function(){return Sg().domain(e).range(n).unknown(r)},wp.apply(o,arguments)}var sm=new Date,um=new Date;function Ou(e,n,r,i){function o(c){return e(c=arguments.length===0?new Date:new Date(+c)),c}return o.floor=function(c){return e(c=new Date(+c)),c},o.ceil=function(c){return e(c=new Date(c-1)),n(c,1),e(c),c},o.round=function(c){var d=o(c),y=o.ceil(c);return c-d<y-c?d:y},o.offset=function(c,d){return n(c=new Date(+c),d==null?1:Math.floor(d)),c},o.range=function(c,d,y){var _=[],b;if(c=o.ceil(c),y=y==null?1:Math.floor(y),!(c<d)||!(y>0))return _;do _.push(b=new Date(+c)),n(c,y),e(c);while(b<c&&c<d);return _},o.filter=function(c){return Ou(function(d){if(d>=d)for(;e(d),!c(d);)d.setTime(d-1)},function(d,y){if(d>=d)if(y<0)for(;++y<=0;)for(;n(d,-1),!c(d););else for(;--y>=0;)for(;n(d,1),!c(d););})},r&&(o.count=function(c,d){return sm.setTime(+c),um.setTime(+d),e(sm),e(um),Math.floor(r(sm,um))},o.every=function(c){return c=Math.floor(c),!isFinite(c)||!(c>0)?null:c>1?o.filter(i?function(d){return i(d)%c==0}:function(d){return o.count(0,d)%c==0}):o}),o}var lm=Ou(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});lm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ou(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var Hh=lm,MT=lm.range,Eg=Ou(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),q2=Eg,PT=Eg.range,xv=1e3,Cd=6e4,Cg=36e5,Tg=864e5,Ag=6048e5;function rh(e){return Ou(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*Cd)/Ag})}var cm=rh(0),bv=rh(1),K2=rh(2),$2=rh(3),Wh=rh(4),J2=rh(5),Q2=rh(6),IT=cm.range,OT=bv.range,kT=K2.range,LT=$2.range,RT=Wh.range,DT=J2.range,FT=Q2.range,Mg=Ou(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Cd)/Tg},function(e){return e.getDate()-1}),fm=Mg,BT=Mg.range,Pg=Ou(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*xv-e.getMinutes()*Cd)},function(e,n){e.setTime(+e+n*Cg)},function(e,n){return(n-e)/Cg},function(e){return e.getHours()}),ew=Pg,NT=Pg.range,Ig=Ou(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*xv)},function(e,n){e.setTime(+e+n*Cd)},function(e,n){return(n-e)/Cd},function(e){return e.getMinutes()}),tw=Ig,zT=Ig.range,Og=Ou(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*xv)},function(e,n){return(n-e)/xv},function(e){return e.getUTCSeconds()}),rw=Og,ZT=Og.range,wv=Ou(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});wv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ou(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):wv};var nw=wv,UT=wv.range;function nh(e){return Ou(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/Ag})}var kg=nh(0),Sv=nh(1),iw=nh(2),aw=nh(3),Xh=nh(4),ow=nh(5),sw=nh(6),jT=kg.range,VT=Sv.range,GT=iw.range,HT=aw.range,WT=Xh.range,XT=ow.range,YT=sw.range,Lg=Ou(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/Tg},function(e){return e.getUTCDate()-1}),Rg=Lg,qT=Lg.range,pm=Ou(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});pm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ou(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var Td=pm,KT=pm.range;function hm(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function dm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ad(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function uw(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,c=e.days,d=e.shortDays,y=e.months,_=e.shortMonths,b=Md(o),T=Pd(o),A=Md(c),O=Pd(c),F=Md(d),W=Pd(d),J=Md(y),ue=Pd(y),Ie=Md(_),rt=Pd(_),lt={a:Ys,A:Yf,b:il,B:BC,c:null,d:Zg,e:Zg,f:Ow,g:Uw,G:Vw,H:Mw,I:Pw,j:Iw,L:Ug,m:kw,M:Lw,p:NC,q:zC,Q:Xg,s:Yg,S:Rw,u:Dw,U:Fw,V:Bw,w:Nw,W:zw,x:null,X:null,y:Zw,Y:jw,Z:Gw,"%":Wg},Tt={a:ZC,A:UC,b:jC,B:VC,c:null,d:Vg,e:Vg,f:Yw,g:iS,G:oS,H:Hw,I:Ww,j:Xw,L:Gg,m:qw,M:Kw,p:GC,q:HC,Q:Xg,s:Yg,S:$w,u:Jw,U:Qw,V:eS,w:tS,W:rS,x:null,X:null,y:nS,Y:aS,Z:sS,"%":Wg},Ot={a:Yr,A:Cr,b:sn,B:Ln,c:Hn,d:Ng,e:Ng,f:Ew,g:Bg,G:Fg,H:zg,I:zg,j:xw,L:Sw,m:_w,M:bw,p:Zr,q:gw,Q:Tw,s:Aw,S:ww,u:hw,U:dw,V:vw,w:pw,W:mw,x:Ga,X:Ls,y:Bg,Y:Fg,Z:yw,"%":Cw};lt.x=Zt(r,lt),lt.X=Zt(i,lt),lt.c=Zt(n,lt),Tt.x=Zt(r,Tt),Tt.X=Zt(i,Tt),Tt.c=Zt(n,Tt);function Zt(In,Zi){return function($i){var jr=[],al=-1,eo=0,Il=In.length,Ol,ah,A_;for($i instanceof Date||($i=new Date(+$i));++al<Il;)In.charCodeAt(al)===37&&(jr.push(In.slice(eo,al)),(ah=Dg[Ol=In.charAt(++al)])!=null?Ol=In.charAt(++al):ah=Ol==="e"?" ":"0",(A_=Zi[Ol])&&(Ol=A_($i,ah)),jr.push(Ol),eo=al+1);return jr.push(In.slice(eo,al)),jr.join("")}}function Vt(In,Zi){return function($i){var jr=Ad(1900,void 0,1),al=_r(jr,In,$i+="",0),eo,Il;if(al!=$i.length)return null;if("Q"in jr)return new Date(jr.Q);if("s"in jr)return new Date(jr.s*1e3+("L"in jr?jr.L:0));if(Zi&&!("Z"in jr)&&(jr.Z=0),"p"in jr&&(jr.H=jr.H%12+jr.p*12),jr.m===void 0&&(jr.m="q"in jr?jr.q:0),"V"in jr){if(jr.V<1||jr.V>53)return null;"w"in jr||(jr.w=1),"Z"in jr?(eo=dm(Ad(jr.y,0,1)),Il=eo.getUTCDay(),eo=Il>4||Il===0?Sv.ceil(eo):Sv(eo),eo=Rg.offset(eo,(jr.V-1)*7),jr.y=eo.getUTCFullYear(),jr.m=eo.getUTCMonth(),jr.d=eo.getUTCDate()+(jr.w+6)%7):(eo=hm(Ad(jr.y,0,1)),Il=eo.getDay(),eo=Il>4||Il===0?bv.ceil(eo):bv(eo),eo=fm.offset(eo,(jr.V-1)*7),jr.y=eo.getFullYear(),jr.m=eo.getMonth(),jr.d=eo.getDate()+(jr.w+6)%7)}else("W"in jr||"U"in jr)&&("w"in jr||(jr.w="u"in jr?jr.u%7:"W"in jr?1:0),Il="Z"in jr?dm(Ad(jr.y,0,1)).getUTCDay():hm(Ad(jr.y,0,1)).getDay(),jr.m=0,jr.d="W"in jr?(jr.w+6)%7+jr.W*7-(Il+5)%7:jr.w+jr.U*7-(Il+6)%7);return"Z"in jr?(jr.H+=jr.Z/100|0,jr.M+=jr.Z%100,dm(jr)):hm(jr)}}function _r(In,Zi,$i,jr){for(var al=0,eo=Zi.length,Il=$i.length,Ol,ah;al<eo;){if(jr>=Il)return-1;if(Ol=Zi.charCodeAt(al++),Ol===37){if(Ol=Zi.charAt(al++),ah=Ot[Ol in Dg?Zi.charAt(al++):Ol],!ah||(jr=ah(In,$i,jr))<0)return-1}else if(Ol!=$i.charCodeAt(jr++))return-1}return jr}function Zr(In,Zi,$i){var jr=b.exec(Zi.slice($i));return jr?(In.p=T[jr[0].toLowerCase()],$i+jr[0].length):-1}function Yr(In,Zi,$i){var jr=F.exec(Zi.slice($i));return jr?(In.w=W[jr[0].toLowerCase()],$i+jr[0].length):-1}function Cr(In,Zi,$i){var jr=A.exec(Zi.slice($i));return jr?(In.w=O[jr[0].toLowerCase()],$i+jr[0].length):-1}function sn(In,Zi,$i){var jr=Ie.exec(Zi.slice($i));return jr?(In.m=rt[jr[0].toLowerCase()],$i+jr[0].length):-1}function Ln(In,Zi,$i){var jr=J.exec(Zi.slice($i));return jr?(In.m=ue[jr[0].toLowerCase()],$i+jr[0].length):-1}function Hn(In,Zi,$i){return _r(In,n,Zi,$i)}function Ga(In,Zi,$i){return _r(In,r,Zi,$i)}function Ls(In,Zi,$i){return _r(In,i,Zi,$i)}function Ys(In){return d[In.getDay()]}function Yf(In){return c[In.getDay()]}function il(In){return _[In.getMonth()]}function BC(In){return y[In.getMonth()]}function NC(In){return o[+(In.getHours()>=12)]}function zC(In){return 1+~~(In.getMonth()/3)}function ZC(In){return d[In.getUTCDay()]}function UC(In){return c[In.getUTCDay()]}function jC(In){return _[In.getUTCMonth()]}function VC(In){return y[In.getUTCMonth()]}function GC(In){return o[+(In.getUTCHours()>=12)]}function HC(In){return 1+~~(In.getUTCMonth()/3)}return{format:function(In){var Zi=Zt(In+="",lt);return Zi.toString=function(){return In},Zi},parse:function(In){var Zi=Vt(In+="",!1);return Zi.toString=function(){return In},Zi},utcFormat:function(In){var Zi=Zt(In+="",Tt);return Zi.toString=function(){return In},Zi},utcParse:function(In){var Zi=Vt(In+="",!0);return Zi.toString=function(){return In},Zi}}}var Dg={"-":"",_:" ","0":"0"},ks=/^\s*\d+/,lw=/^%/,cw=/[\\^$*+?|[\]().{}]/g;function Ki(e,n,r){var i=e<0?"-":"",o=(i?-e:e)+"",c=o.length;return i+(c<r?new Array(r-c+1).join(n)+o:o)}function fw(e){return e.replace(cw,"\\$&")}function Md(e){return new RegExp("^(?:"+e.map(fw).join("|")+")","i")}function Pd(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function pw(e,n,r){var i=ks.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function hw(e,n,r){var i=ks.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function dw(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function vw(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function mw(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function Fg(e,n,r){var i=ks.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function Bg(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function yw(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function gw(e,n,r){var i=ks.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function _w(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function Ng(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function xw(e,n,r){var i=ks.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function zg(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function bw(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function ww(e,n,r){var i=ks.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function Sw(e,n,r){var i=ks.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function Ew(e,n,r){var i=ks.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function Cw(e,n,r){var i=lw.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function Tw(e,n,r){var i=ks.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function Aw(e,n,r){var i=ks.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function Zg(e,n){return Ki(e.getDate(),n,2)}function Mw(e,n){return Ki(e.getHours(),n,2)}function Pw(e,n){return Ki(e.getHours()%12||12,n,2)}function Iw(e,n){return Ki(1+fm.count(Hh(e),e),n,3)}function Ug(e,n){return Ki(e.getMilliseconds(),n,3)}function Ow(e,n){return Ug(e,n)+"000"}function kw(e,n){return Ki(e.getMonth()+1,n,2)}function Lw(e,n){return Ki(e.getMinutes(),n,2)}function Rw(e,n){return Ki(e.getSeconds(),n,2)}function Dw(e){var n=e.getDay();return n===0?7:n}function Fw(e,n){return Ki(cm.count(Hh(e)-1,e),n,2)}function jg(e){var n=e.getDay();return n>=4||n===0?Wh(e):Wh.ceil(e)}function Bw(e,n){return e=jg(e),Ki(Wh.count(Hh(e),e)+(Hh(e).getDay()===4),n,2)}function Nw(e){return e.getDay()}function zw(e,n){return Ki(bv.count(Hh(e)-1,e),n,2)}function Zw(e,n){return Ki(e.getFullYear()%100,n,2)}function Uw(e,n){return e=jg(e),Ki(e.getFullYear()%100,n,2)}function jw(e,n){return Ki(e.getFullYear()%1e4,n,4)}function Vw(e,n){var r=e.getDay();return e=r>=4||r===0?Wh(e):Wh.ceil(e),Ki(e.getFullYear()%1e4,n,4)}function Gw(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Ki(n/60|0,"0",2)+Ki(n%60,"0",2)}function Vg(e,n){return Ki(e.getUTCDate(),n,2)}function Hw(e,n){return Ki(e.getUTCHours(),n,2)}function Ww(e,n){return Ki(e.getUTCHours()%12||12,n,2)}function Xw(e,n){return Ki(1+Rg.count(Td(e),e),n,3)}function Gg(e,n){return Ki(e.getUTCMilliseconds(),n,3)}function Yw(e,n){return Gg(e,n)+"000"}function qw(e,n){return Ki(e.getUTCMonth()+1,n,2)}function Kw(e,n){return Ki(e.getUTCMinutes(),n,2)}function $w(e,n){return Ki(e.getUTCSeconds(),n,2)}function Jw(e){var n=e.getUTCDay();return n===0?7:n}function Qw(e,n){return Ki(kg.count(Td(e)-1,e),n,2)}function Hg(e){var n=e.getUTCDay();return n>=4||n===0?Xh(e):Xh.ceil(e)}function eS(e,n){return e=Hg(e),Ki(Xh.count(Td(e),e)+(Td(e).getUTCDay()===4),n,2)}function tS(e){return e.getUTCDay()}function rS(e,n){return Ki(Sv.count(Td(e)-1,e),n,2)}function nS(e,n){return Ki(e.getUTCFullYear()%100,n,2)}function iS(e,n){return e=Hg(e),Ki(e.getUTCFullYear()%100,n,2)}function aS(e,n){return Ki(e.getUTCFullYear()%1e4,n,4)}function oS(e,n){var r=e.getUTCDay();return e=r>=4||r===0?Xh(e):Xh.ceil(e),Ki(e.getUTCFullYear()%1e4,n,4)}function sS(){return"+0000"}function Wg(){return"%"}function Xg(e){return+e}function Yg(e){return Math.floor(+e/1e3)}var Yh,qg,uS,lS,cS;fS({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function fS(e){return Yh=uw(e),qg=Yh.format,uS=Yh.parse,lS=Yh.utcFormat,cS=Yh.utcParse,Yh}var Id=1e3,Od=Id*60,kd=Od*60,Ld=kd*24,pS=Ld*7,Kg=Ld*30,vm=Ld*365;function hS(e){return new Date(e)}function dS(e){return e instanceof Date?+e:+new Date(+e)}function $g(e,n,r,i,o,c,d,y,_){var b=ng(ic,ic),T=b.invert,A=b.domain,O=_(".%L"),F=_(":%S"),W=_("%I:%M"),J=_("%I %p"),ue=_("%a %d"),Ie=_("%b %d"),rt=_("%B"),lt=_("%Y"),Tt=[[d,1,Id],[d,5,5*Id],[d,15,15*Id],[d,30,30*Id],[c,1,Od],[c,5,5*Od],[c,15,15*Od],[c,30,30*Od],[o,1,kd],[o,3,3*kd],[o,6,6*kd],[o,12,12*kd],[i,1,Ld],[i,2,2*Ld],[r,1,pS],[n,1,Kg],[n,3,3*Kg],[e,1,vm]];function Ot(Vt){return(d(Vt)<Vt?O:c(Vt)<Vt?F:o(Vt)<Vt?W:i(Vt)<Vt?J:n(Vt)<Vt?r(Vt)<Vt?ue:Ie:e(Vt)<Vt?rt:lt)(Vt)}function Zt(Vt,_r,Zr,Yr){if(Vt==null&&(Vt=10),typeof Vt=="number"){var Cr=Math.abs(Zr-_r)/Vt,sn=Gy(function(Ln){return Ln[2]}).right(Tt,Cr);sn===Tt.length?(Yr=Qv(_r/vm,Zr/vm,Vt),Vt=e):sn?(sn=Tt[Cr/Tt[sn-1][2]<Tt[sn][2]/Cr?sn-1:sn],Yr=sn[1],Vt=sn[0]):(Yr=Math.max(Qv(_r,Zr,Vt),1),Vt=y)}return Yr==null?Vt:Vt.every(Yr)}return b.invert=function(Vt){return new Date(T(Vt))},b.domain=function(Vt){return arguments.length?A(hv.call(Vt,dS)):A().map(hS)},b.ticks=function(Vt,_r){var Zr=A(),Yr=Zr[0],Cr=Zr[Zr.length-1],sn=Cr<Yr,Ln;return sn&&(Ln=Yr,Yr=Cr,Cr=Ln),Ln=Zt(Vt,Yr,Cr,_r),Ln=Ln?Ln.range(Yr,Cr+1):[],sn?Ln.reverse():Ln},b.tickFormat=function(Vt,_r){return _r==null?Ot:_(_r)},b.nice=function(Vt,_r){var Zr=A();return(Vt=Zt(Vt,Zr[0],Zr[Zr.length-1],_r))?A(hg(Zr,Vt)):b},b.copy=function(){return vv(b,$g(e,n,r,i,o,c,d,y,_))},b}function vS(){return wp.apply($g(Hh,q2,cm,fm,ew,tw,rw,nw,qg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function $T(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Ev(){var e=0,n=1,r,i,o,c,d=identity,y=!1,_;function b(T){return isNaN(T=+T)?_:d(o===0?.5:(T=(c(T)-r)*o,y?Math.max(0,Math.min(1,T)):T))}return b.domain=function(T){return arguments.length?(r=c(e=+T[0]),i=c(n=+T[1]),o=r===i?0:1/(i-r),b):[e,n]},b.clamp=function(T){return arguments.length?(y=!!T,b):y},b.interpolator=function(T){return arguments.length?(d=T,b):d},b.unknown=function(T){return arguments.length?(_=T,b):_},function(T){return c=T,r=T(e),i=T(n),o=r===i?0:1/(i-r),b}}function Cv(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function mS(){var e=linearish(Ev()(identity));return e.copy=function(){return Cv(e,mS())},initInterpolator.apply(e,arguments)}function yS(){var e=loggish(Ev()).domain([1,10]);return e.copy=function(){return Cv(e,yS()).base(e.base())},initInterpolator.apply(e,arguments)}function gS(){var e=symlogish(Ev());return e.copy=function(){return Cv(e,gS()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Jg(){var e=powish(Ev());return e.copy=function(){return Cv(e,Jg()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function JT(){return Jg.apply(null,arguments).exponent(.5)}function _S(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var o=0,c=i.length,d;o<c;++o)d=i[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return _S(n).domain(e)},initInterpolator.apply(r,arguments)}function Tv(){var e=0,n=.5,r=1,i,o,c,d,y,_=identity,b,T=!1,A;function O(F){return isNaN(F=+F)?A:(F=.5+((F=+b(F))-o)*(F<o?d:y),_(T?Math.max(0,Math.min(1,F)):F))}return O.domain=function(F){return arguments.length?(i=b(e=+F[0]),o=b(n=+F[1]),c=b(r=+F[2]),d=i===o?0:.5/(o-i),y=o===c?0:.5/(c-o),O):[e,n,r]},O.clamp=function(F){return arguments.length?(T=!!F,O):T},O.interpolator=function(F){return arguments.length?(_=F,O):_},O.unknown=function(F){return arguments.length?(A=F,O):A},function(F){return b=F,i=F(e),o=F(n),c=F(r),d=i===o?0:.5/(o-i),y=o===c?0:.5/(c-o),O}}function xS(){var e=linearish(Tv()(identity));return e.copy=function(){return copy(e,xS())},initInterpolator.apply(e,arguments)}function bS(){var e=loggish(Tv()).domain([.1,1,10]);return e.copy=function(){return copy(e,bS()).base(e.base())},initInterpolator.apply(e,arguments)}function wS(){var e=symlogish(Tv());return e.copy=function(){return copy(e,wS()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Qg(){var e=powish(Tv());return e.copy=function(){return copy(e,Qg()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function QT(){return Qg.apply(null,arguments).exponent(.5)}var Oc,e0,t0,r0,mm,n0,SS=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ES=(Oc={},(0,M.Z)(Oc,Kt.LINEAR,fg),(0,M.Z)(Oc,Kt.POWER,om),(0,M.Z)(Oc,Kt.LOG,yg),(0,M.Z)(Oc,Kt.IDENTITY,pg),(0,M.Z)(Oc,Kt.TIME,vS),(0,M.Z)(Oc,Kt.QUANTILE,bg),(0,M.Z)(Oc,Kt.QUANTIZE,wg),(0,M.Z)(Oc,Kt.THRESHOLD,Sg),(0,M.Z)(Oc,Kt.CAT,dv),Oc),CS=(e0=(0,ae.b2)(),t0=(0,ae.f3)(Q.IGlobalConfigService),e0(r0=(mm=function(){function e(){(0,we.Z)(this,e),Tn(this,"configService",n0,this),(0,M.Z)(this,"scaleCache",{}),(0,M.Z)(this,"scaleOptions",{})}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes(),y=r.getSource().data.dataArray;y.length!==0&&o.caculateScalesForAttributes(d||[],y)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes(),y=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],y),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes();if(d){var y=r.getSource().data.dataArray;if(y.length===0)return;var _=d.filter(function(b){return b.needRescale});_.length&&o.caculateScalesForAttributes(_,y)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var o=this;this.scaleCache={},r.forEach(function(c){if(c.scale){var d=c.scale,y=c.name;d.names=o.parseFields(c.scale.field||[]);var _=[];d.names.forEach(function(b){_.push(o.getOrCreateScale(b,c,i))}),_.some(function(b){return b.type===Sr.VARIABLE})?(d.type=Sr.VARIABLE,_.forEach(function(b){if(!d.callback){var T;if(d.values&&d.values!=="text"){var A;if(((A=b.option)===null||A===void 0?void 0:A.type)==="linear"&&d.values.length>2){var O=b.scale.ticks(d.values.length);y==="color"&&b.scale.domain(O)}b.scale.range(d.values)}else((T=b.option)===null||T===void 0?void 0:T.type)==="cat"&&b.scale.range(b.option.domain)}})):(d.type=Sr.CONSTANT,d.defaultValues=_.map(function(b,T){return b.scale(d.names[T])})),d.scalers=_.map(function(b){return{field:b.field,func:b.scale,option:b.option}}),c.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,o){var c,d=[r,i.name].join("_"),y=(c=i.scale)===null||c===void 0?void 0:c.values,_=this.createScale(r,i.name,y,o);return _}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Is()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,o,c){var d,y,_=this.scaleOptions[i]&&((d=this.scaleOptions[i])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[i]:this.scaleOptions[r],b={field:r,scale:void 0,type:Sr.VARIABLE,option:_};if(!c||!c.length)return _&&_.type?b.scale=this.createDefaultScale(_):(b.scale=dv([r]),b.type=Sr.CONSTANT),b;var T=(y=c.find(function(F){return!ne()(F[r])}))===null||y===void 0?void 0:y[r];if(this.isNumber(r)||ne()(T)&&!_)b.scale=dv([r]),b.type=Sr.CONSTANT;else{var A=_&&_.type||this.getDefaultType(T);o==="text"&&(A=Kt.CAT);var O=this.createDefaultScaleConfig(A,r,c);Object.assign(O,_),b.scale=this.createDefaultScale(O),b.option=O}return b}},{key:"getDefaultType",value:function(r){var i=Kt.LINEAR;return typeof r=="string"&&(i=SS.test(r)?Kt.TIME:Kt.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,o){var c={type:r},d=(o==null?void 0:o.map(function(y){return y[i]}))||[];return r!==Kt.CAT&&r!==Kt.QUANTILE?c.domain=d2(d):r===Kt.CAT?c.domain=_c()(d):r===Kt.QUANTILE&&(c.domain=d),c}},{key:"createDefaultScale",value:function(r){var i=r.type,o=r.domain,c=ES[i]();return o&&c.domain(o),c}}]),e}(),n0=$r(mm.prototype,"configService",[t0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm))||r0),i0,a0,o0,s0,Av,u0,l0;function c0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function TS(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?c0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var AS=(i0=(0,ae.b2)(),a0=(0,ae.f3)(Q.ICameraService),o0=(0,ae.f3)(Q.IRendererService),i0(s0=(Av=function(){function e(){(0,we.Z)(this,e),Tn(this,"cameraService",u0,this),Tn(this,"rendererService",l0,this)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(TS({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),u0=$r(Av.prototype,"cameraService",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l0=$r(Av.prototype,"rendererService",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av))||s0),f0,p0,MS=(f0=(0,ae.b2)(),f0(p0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||p0),h0,d0,PS=(h0=(0,ae.b2)(),h0(d0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),o=i.autoFit,c=i.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(c)},100)})}}]),e}())||d0),v0,m0,IS=["type"];function y0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Rd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?y0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var g0={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},OS={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},kS={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},LS={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},eA=null;function RS(e){var n={u_DirectionalLights:new Array(3).fill(Rd({},kS)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Rd({},LS)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[OS]),e.forEach(function(r,i){var o=r.type,c=o===void 0?"directional":o,d=(0,z.Z)(r,IS),y=g0[c].lights,_=g0[c].num,b=n[_];n[y][b]=Rd(Rd({},n[y][b]),d),n[_]++}),n}var DS=(v0=(0,ae.b2)(),v0(m0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),o=i.enableLighting;o&&r.models.forEach(function(c){return c.addUniforms(Rd({},RS()))})})}}]),e}())||m0),_0,x0,Mv={NONE:0,ENCODE:1,HIGHLIGHT:2},FS=(_0=(0,ae.b2)(),_0(x0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=i.rendererService,c=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;c.registerStyleAttribute({name:"pickingColor",type:tr.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:re.FLOAT},size:3,update:function(b,T){var A=b.id;return y?Ea(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:Mv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:Mv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var y=r.getLayerConfig(),_=y.highlightColor,b=typeof _=="string"?Pn(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:jn(new Uint8Array(d))}),r.models.forEach(function(T){return T.addUniforms({u_PickingStage:Mv.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:b.map(function(A){return A*255})})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var y=r.getLayerConfig(),_=y.selectColor,b=typeof _=="string"?Pn(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:jn(new Uint8Array(d))}),r.models.forEach(function(T){return T.addUniforms({u_PickingStage:Mv.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:b.map(function(A){return A*255})})})})}}]),e}())||x0),b0,w0,BS=(b0=(0,ae.b2)(),b0(w0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(c)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:tr.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:re.FLOAT},size:3,update:function(o,c,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:tr.Attribute,descriptor:{name:"filter",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(o,c){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:tr.Attribute,descriptor:{name:"a_Color",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(o,c){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:tr.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(o,c,d,y){return[c]}}})}}]),e}())||w0),S0,E0,C0,T0,A0,M0,qh,P0,I0,O0,k0,NS=(S0=(0,ae.b2)(),E0=(0,ae.f3)(Q.ICameraService),C0=(0,ae.f3)(Q.ICoordinateSystemService),T0=(0,ae.f3)(Q.IRendererService),A0=(0,ae.f3)(Q.IMapService),S0(M0=(qh=function(){function e(){(0,we.Z)(this,e),Tn(this,"cameraService",P0,this),Tn(this,"coordinateSystemService",I0,this),Tn(this,"rendererService",O0,this),Tn(this,"mapService",k0,this)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){var i=this,o=this.mapService.version,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),o==="GAODE2.x"&&(c=i.mapService.map.customCoords.getMVPMatrix(),d=i.mapService.getCustomCoordCenter());var y=i.rendererService.getViewportSize(),_=y.width,b=y.height;r.models.forEach(function(T){var A;T.addUniforms((A={},(0,M.Z)(A,nn.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,M.Z)(A,nn.ViewMatrix,i.cameraService.getViewMatrix()),(0,M.Z)(A,nn.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,M.Z)(A,nn.Zoom,i.cameraService.getZoom()),(0,M.Z)(A,nn.ZoomScale,i.cameraService.getZoomScale()),(0,M.Z)(A,nn.FocalDistance,i.cameraService.getFocalDistance()),(0,M.Z)(A,nn.CameraPosition,i.cameraService.getCameraPosition()),(0,M.Z)(A,No.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,M.Z)(A,No.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,M.Z)(A,No.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,M.Z)(A,No.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,M.Z)(A,No.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,M.Z)(A,No.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,M.Z)(A,No.Mvp,c),(0,M.Z)(A,"u_SceneCenterMKT",d),(0,M.Z)(A,"u_ViewportSize",[_,b]),(0,M.Z)(A,"u_DevicePixelRatio",window.devicePixelRatio),(0,M.Z)(A,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,M.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),A))})})}}]),e}(),P0=$r(qh.prototype,"cameraService",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0=$r(qh.prototype,"coordinateSystemService",[C0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0=$r(qh.prototype,"rendererService",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0=$r(qh.prototype,"mapService",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh))||M0),L0,R0,zS=(L0=(0,ae.b2)(),L0(R0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||R0),D0,F0,ZS=(D0=(0,ae.b2)(),D0(F0=function(){function e(){(0,we.Z)(this,e)}return(0,Oe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:c})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:c})})}},{key:"updateStyleAtrribute",value:function(r,i){var o=i.styleAttributeService,c=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),y=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices||y&&y.needRegenerateVertices){r.layerModelNeedUpdate=!0,c.forEach(function(_){return _.needRegenerateVertices=!1});return}c.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){o.updateAttributeByFeatureRange(_.name,r.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var o=i.styleAttributeService,c=o.getLayerStyleAttributes()||[];c.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||F0);xo.bind(Q.ILayerPlugin).to(f2).inRequestScope(),xo.bind(Q.ILayerPlugin).to(BS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(CS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(gb).inRequestScope(),xo.bind(Q.ILayerPlugin).to(PS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(ZS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(zS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(tc).inRequestScope(),xo.bind(Q.ILayerPlugin).to(NS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(AS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(DS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(FS).inRequestScope(),xo.bind(Q.ILayerPlugin).to(MS).inRequestScope();var tA="2.5.7";function B0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function rA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?B0(Object(r),!0).forEach(function(i){US(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function US(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function nA(e,n){return HS(e)||GS(e,n)||VS(e,n)||jS()}function jS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VS(e,n){if(!!e){if(typeof e=="string")return N0(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N0(e,n)}}function N0(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function GS(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function HS(e){if(Array.isArray(e))return e}var iA=null,aA=null,z0,ym,Z0;function U0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function j0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var WS=(z0=Zf(Q.IGlobalConfigService),ym=function(){function e(n){(0,we.Z)(this,e),Tn(this,"configService",Z0,this),(0,M.Z)(this,"config",void 0),this.config=n}return(0,Oe.Z)(e,[{key:"setContainer",value:function(r,i){r.bind(Q.MapConfig).toConstantValue(j0(j0({},this.config),{},{id:i})),r.bind(Q.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Z0=$r(ym.prototype,"configService",[z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym),XS=G(6158),YS=G.n(XS),gm;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP"})(gm||(gm={}));function Dd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pv(e,n){var r=vl([],n,e);return fa(r,r,1/r[3]),r}function oA(e,n){var r=e%n;return r<0?n+r:r}function sA(e,n,r){return r*n+(1-r)*e}function ih(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var kc=Math.PI,V0=kc/4,Xf=kc/180,G0=180/kc,_m=512,xm=4003e4,qS=1.5;function H0(e){return Math.pow(2,e)}function KS(e){return Math.log2(e)}function Iv(e,n){var r=(0,Dt.Z)(e,2),i=r[0],o=r[1];ih(Number.isFinite(i)&&Number.isFinite(n)),ih(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),n*=_m;var c=i*Xf,d=o*Xf,y=n*(c+kc)/(2*kc),_=n*(kc-Math.log(Math.tan(V0+d*.5)))/(2*kc);return[y,_]}function bm(e,n){var r=(0,Dt.Z)(e,2),i=r[0],o=r[1];n*=_m;var c=i/n*(2*kc)-kc,d=2*(Math.atan(Math.exp(kc-o/n*(2*kc)))-V0);return[c*G0,d*G0]}function uA(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*Xf);return KS(xm*r)-9}function W0(e){var n=e.latitude,r=e.longitude,i=e.zoom,o=e.scale,c=e.highPrecision,d=c===void 0?!1:c;o=o!==void 0?o:H0(i),ih(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o));var y={},_=_m*o,b=Math.cos(n*Xf),T=_/360,A=T/b,O=_/xm/b;if(y.pixelsPerMeter=[O,-O,O],y.metersPerPixel=[1/O,-1/O,1/O],y.pixelsPerDegree=[T,-A,O],y.degreesPerPixel=[1/T,-1/A,1/O],d){var F=Xf*Math.tan(n*Xf)/b,W=T*F/2,J=_/xm*F,ue=J/A*O;y.pixelsPerDegree2=[0,-W,J],y.pixelsPerMeter2=[ue,0,ue]}return y}function lA(e,n){var r=_slicedToArray(e,3),i=r[0],o=r[1],c=r[2],d=_slicedToArray(n,3),y=d[0],_=d[1],b=d[2],T=1,A=W0({longitude:i,latitude:o,scale:T,highPrecision:!0}),O=A.pixelsPerMeter,F=A.pixelsPerMeter2,W=Iv(e,T);W[0]+=y*(O[0]+F[0]*_),W[1]+=_*(O[1]+F[1]*_);var J=bm(W,T),ue=(c||0)+(b||0);return Number.isFinite(c)||Number.isFinite(b)?[J[0],J[1],ue]:J}function $S(e){var n=e.height,r=e.pitch,i=e.bearing,o=e.altitude,c=e.center,d=c===void 0?null:c,y=e.flipY,_=y===void 0?!1:y,b=Dd();return Ds(b,b,[0,0,-o]),Co(b,b,[1,1,1/n]),Ko(b,b,-r*Xf),To(b,b,i*Xf),_&&Co(b,b,[1,-1,1]),d&&Ds(b,b,Xs.negate([],d)),b}function JS(e){var n=e.width,r=e.height,i=e.altitude,o=i===void 0?qS:i,c=e.pitch,d=c===void 0?0:c,y=e.nearZMultiplier,_=y===void 0?1:y,b=e.farZMultiplier,T=b===void 0?1:b,A=d*Xf,O=Math.atan(.5/o),F=Math.sin(O)*o/Math.sin(Math.PI/2-A-O),W=Math.cos(Math.PI/2-A)*F+o;return{fov:2*Math.atan(r/2/o),aspect:n/r,focalDistance:o,near:_,far:W*T}}function QS(e){var n=e.width,r=e.height,i=e.pitch,o=e.altitude,c=e.nearZMultiplier,d=e.farZMultiplier,y=JS({width:n,height:r,altitude:o,pitch:i,nearZMultiplier:c,farZMultiplier:d}),_=y.fov,b=y.aspect,T=y.near,A=y.far,O=Ks([],_,b,T,A);return O}function eE(e,n){var r=(0,Dt.Z)(e,3),i=r[0],o=r[1],c=r[2],d=c===void 0?0:c;return ih(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(d)),Pv(n,[i,o,d,1])}function X0(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Dt.Z)(e,3),o=i[0],c=i[1],d=i[2];if(ih(Number.isFinite(o)&&Number.isFinite(c),"invalid pixel coordinate"),Number.isFinite(d)){var y=Pv(n,[o,c,d,1]);return y}var _=Pv(n,[o,c,0,1]),b=Pv(n,[o,c,1,1]),T=_[2],A=b[2],O=T===A?0:((r||0)-T)/(A-T);return ri.lerp([],_,b,O)}var Y0=Dd(),tE=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,o=n.viewMatrix,c=o===void 0?Y0:o,d=n.projectionMatrix,y=d===void 0?Y0:d;(0,we.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=c,this.projectionMatrix=y;var _=Dd();Da(_,_,this.projectionMatrix),Da(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var b=Dd();Co(b,b,[this.width/2,-this.height/2,1]),Ds(b,b,[1,-1,0]),Da(b,b,this.viewProjectionMatrix);var T=Yi(Dd(),b);if(!T)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=T,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Oe.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ul(r.projectionMatrix,this.projectionMatrix)&&ul(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,c=o===void 0?!0:o,d=this.projectPosition(r),y=eE(d,this.pixelProjectionMatrix),_=(0,Dt.Z)(y,2),b=_[0],T=_[1],A=c?T:this.height-T;return r.length===2?[b,A]:[b,A,y[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,c=o===void 0?!0:o,d=i.targetZ,y=(0,Dt.Z)(r,3),_=y[0],b=y[1],T=y[2],A=c?b:this.height-b,O=d&&d*this.pixelsPerMeter,F=X0([_,A,T],this.pixelUnprojectionMatrix,O),W=this.unprojectPosition(F),J=(0,Dt.Z)(W,3),ue=J[0],Ie=J[1],rt=J[2];return Number.isFinite(T)?[ue,Ie,rt]:Number.isFinite(d)?[ue,Ie,d]:[ue,Ie]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),o=(0,Dt.Z)(i,2),c=o[0],d=o[1],y=(r[2]||0)*this.pixelsPerMeter;return[c,d,y]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),o=(0,Dt.Z)(i,2),c=o[0],d=o[1],y=(r[2]||0)/this.pixelsPerMeter;return[c,d,y]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function rE(e){var n=e.width,r=e.height,i=e.bounds,o=e.minExtent,c=o===void 0?0:o,d=e.maxZoom,y=d===void 0?24:d,_=e.padding,b=_===void 0?0:_,T=e.offset,A=T===void 0?[0,0]:T,O=(0,Dt.Z)(i,2),F=(0,Dt.Z)(O[0],2),W=F[0],J=F[1],ue=(0,Dt.Z)(O[1],2),Ie=ue[0],rt=ue[1];if(Number.isFinite(b)){var lt=b;b={top:lt,bottom:lt,left:lt,right:lt}}else ih(Number.isFinite(b.top)&&Number.isFinite(b.bottom)&&Number.isFinite(b.left)&&Number.isFinite(b.right));var Tt=new q0({width:n,height:r,longitude:0,latitude:0,zoom:0}),Ot=Tt.project([W,rt]),Zt=Tt.project([Ie,J]),Vt=[Math.max(Math.abs(Zt[0]-Ot[0]),c),Math.max(Math.abs(Zt[1]-Ot[1]),c)],_r=[n-b.left-b.right-Math.abs(A[0])*2,r-b.top-b.bottom-Math.abs(A[1])*2];ih(_r[0]>0&&_r[1]>0);var Zr=_r[0]/Vt[0],Yr=_r[1]/Vt[1],Cr=(b.right-b.left)/2/Zr,sn=(b.bottom-b.top)/2/Yr,Ln=[(Zt[0]+Ot[0])/2+Cr,(Zt[1]+Ot[1])/2+sn],Hn=Tt.unproject(Ln),Ga=Tt.zoom+Math.log2(Math.abs(Math.min(Zr,Yr)));return{longitude:Hn[0],latitude:Hn[1],zoom:Math.min(Ga,y)}}var q0=function(e){(0,Je.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.width,c=i.height,d=i.latitude,y=d===void 0?0:d,_=i.longitude,b=_===void 0?0:_,T=i.zoom,A=T===void 0?0:T,O=i.pitch,F=O===void 0?0:O,W=i.bearing,J=W===void 0?0:W,ue=i.altitude,Ie=ue===void 0?1.5:ue,rt=i.nearZMultiplier,lt=i.farZMultiplier;(0,we.Z)(this,n),o=o||1,c=c||1;var Tt=H0(A);Ie=Math.max(.75,Ie);var Ot=Iv([b,y],Tt);Ot[2]=0;var Zt=QS({width:o,height:c,pitch:F,bearing:J,altitude:Ie,nearZMultiplier:rt||1/c,farZMultiplier:lt||1.01}),Vt=$S({height:c,center:Ot,pitch:F,bearing:J,altitude:Ie,flipY:!0});return r=(0,Et.Z)(this,(0,gt.Z)(n).call(this,{width:o,height:c,viewMatrix:Vt,projectionMatrix:Zt})),r.latitude=y,r.longitude=b,r.zoom=A,r.pitch=F,r.bearing=J,r.altitude=Ie,r.scale=Tt,r.center=Ot,r.pixelsPerMeter=W0((0,H.Z)((0,H.Z)(r))).pixelsPerMeter[2],Object.freeze((0,H.Z)((0,H.Z)(r))),r}return(0,Oe.Z)(n,[{key:"projectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Iv(i,o)}},{key:"unprojectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return bm(i,o)}},{key:"getMapCenterByLngLatPosition",value:function(i){var o=i.lngLat,c=i.pos,d=X0(c,this.pixelUnprojectionMatrix),y=Iv(o,this.scale),_=ri.add([],y,ri.negate([],d)),b=ri.add([],this.center,_);return bm(b,this.scale)}},{key:"getLocationAtPoint",value:function(i){var o=i.lngLat,c=i.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:c})}},{key:"fitBounds",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=this.width,d=this.height,y=rE(Object.assign({width:c,height:d,bounds:i},o)),_=y.longitude,b=y.latitude,T=y.zoom;return new n({width:c,height:d,longitude:_,latitude:b,zoom:T})}}]),n}(tE),nE=function(){function e(){(0,we.Z)(this,e),(0,M.Z)(this,"viewport",void 0)}return(0,Oe.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,o=r.zoom,c=r.pitch,d=r.bearing,y=r.viewportHeight,_=r.viewportWidth;this.viewport=new q0({width:_,height:y,longitude:i&&i[0],latitude:i&&i[1],zoom:o,pitch:c,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),K0={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},iE=["id","attributionControl","style","token","rotation","mapInstance"],$0,J0,Q0,e_,t_,r_,Kh,n_,i_,a_,o_;function s_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function aE(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?s_(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function oE(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}oE(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=YS();var u_={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},sE=0,uE=12,l_="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",lE=($0=(0,ae.b2)(),J0=(0,ae.f3)(Q.MapConfig),Q0=(0,ae.f3)(Q.IGlobalConfigService),e_=(0,ae.f3)(Q.ICoordinateSystemService),t_=(0,ae.f3)(Q.IEventEmitter),$0(r_=(Kh=function(){function e(){var n=this;(0,we.Z)(this,e),(0,M.Z)(this,"version",gm.MAPBOX),(0,M.Z)(this,"map",void 0),Tn(this,"config",n_,this),Tn(this,"configService",i_,this),Tn(this,"coordinateSystemService",a_,this),Tn(this,"eventEmitter",o_,this),(0,M.Z)(this,"viewport",void 0),(0,M.Z)(this,"markerContainer",void 0),(0,M.Z)(this,"cameraChangedCallback",void 0),(0,M.Z)(this,"$mapContainer",void 0),(0,M.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,o=r.lng;n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[o,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var c=n.config.offsetZoom,d=c===void 0?uE:c;n.viewport.getZoom()>d?n.coordinateSystemService.setCoordinateSystem(Bo.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(Bo.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,Oe.Z)(e,[{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Ft("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){zr.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(u_[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(u_[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r){this.panTo(r)}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToMercator",value:function(r,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),c=o.x,d=c===void 0?0:c,y=o.y,_=y===void 0?0:y,b=o.z,T=b===void 0?0:b;return{x:d,y:_,z:T}}},{key:"getModelMatrix",value:function(r,i,o){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},y=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),_=y.meterInMercatorCoordinateUnits(),b=vu();return Ds(b,b,Xs.fromValues(y.x-d.x,y.y-d.y,y.z||0-d.z)),Co(b,b,Xs.fromValues(_*c[0],-_*c[1],_*c[2])),Ko(b,b,o[0]),yu(b,b,o[1]),To(b,b,o[2]),b}},{key:"init",value:function(){var n=(0,Zo.Z)(ga().mark(function i(){var o,c,d,y,_,b,T,A,O,F,W,J,ue;return ga().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:o=this.config,c=o.id,d=c===void 0?"map":c,y=o.attributionControl,_=y===void 0?!1:y,b=o.style,T=b===void 0?"light":b,A=o.token,O=A===void 0?l_:A,F=o.rotation,W=F===void 0?0:F,J=o.mapInstance,ue=(0,z.Z)(o,iE),this.viewport=new nE,!J&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===l_&&T!=="blank"&&!window.mapboxgl.accessToken&&!J&&console.warn(this.configService.getSceneWarninfo("MapToken")),!J&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),J?(this.map=J,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(d),this.map=new window.mapboxgl.Map(aE({container:this.$mapContainer,style:this.getMapStyle(T),attributionControl:_,bearing:W},ue))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return rt.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];(i=this.eventEmitter).emit.apply(i,[r].concat(c))}},{key:"once",value:function(r){for(var i,o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];(i=this.eventEmitter).once.apply(i,[r].concat(c))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),o=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+sE++,i.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:K0[r]?K0[r]:r}}]),e}(),n_=$r(Kh.prototype,"config",[J0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=$r(Kh.prototype,"configService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=$r(Kh.prototype,"coordinateSystemService",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=$r(Kh.prototype,"eventEmitter",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kh))||r_);function cE(e){var n=fE();return function(){var i=(0,gt.Z)(e),o;if(n){var c=(0,gt.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function fE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function pE(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}pE(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var hE=function(e){(0,Je.Z)(r,e);var n=cE(r);function r(){return(0,we.Z)(this,r),n.apply(this,arguments)}return(0,Oe.Z)(r,[{key:"getServiceConstructor",value:function(){return lE}}]),r}(WS);function c_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function f_(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?c_(Object(r),!0).forEach(function(i){dE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function dE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function vE(e,n){return _E(e)||gE(e,n)||yE(e,n)||mE()}function mE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yE(e,n){if(!!e){if(typeof e=="string")return p_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p_(e,n)}}function p_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function gE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function _E(e){if(Array.isArray(e))return e}var xE=ve.memo(function(e){var n=e.style,r=e.className,i=e.map,o=e.option,c=e.onSceneLoaded,d=(0,ve.createRef)(),y=(0,ve.useState)(),_=vE(y,2),b=_[0],T=_[1];return(0,ve.useEffect)(function(){var A=new cd(f_(f_({id:d.current},o),{},{map:new hE(i)}));return A.on("loaded",function(){T(A),c&&c(A)}),function(){A.destroy()}},[]),(0,ve.useEffect)(function(){b&&i.style&&b.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,ve.useEffect)(function(){b&&i.zoom&&b.setZoom(i.zoom)},[i.zoom]),(0,ve.useEffect)(function(){b&&i.center&&b.setCenter(i.center)},[JSON.stringify(i.center)]),(0,ve.useEffect)(function(){b&&i.pitch!==void 0&&b.setPitch(i.pitch||0)},[i.pitch]),(0,ve.useEffect)(function(){b&&i.rotation&&b.setRotation(i.rotation)},[i.rotation]),ve.createElement(v.Provider,{value:b},(0,ve.createElement)("div",{ref:d,style:n,className:r},b&&e.children))}),bE=xE;function h_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function cA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?h_(Object(r),!0).forEach(function(i){wE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function fA(e,n){return TE(e)||CE(e,n)||EE(e,n)||SE()}function SE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EE(e,n){if(!!e){if(typeof e=="string")return d_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d_(e,n)}}function d_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function CE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function TE(e){if(Array.isArray(e))return e}var pA=null,hA=null;function v_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function dA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?v_(Object(r),!0).forEach(function(i){AE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function AE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function vA(e,n){return OE(e)||IE(e,n)||PE(e,n)||ME()}function ME(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PE(e,n){if(!!e){if(typeof e=="string")return m_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m_(e,n)}}function m_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function IE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function OE(e){if(Array.isArray(e))return e}var mA=null,yA=null;function gA(e,n){return DE(e)||RE(e,n)||LE(e,n)||kE()}function kE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LE(e,n){if(!!e){if(typeof e=="string")return y_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y_(e,n)}}function y_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function RE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function DE(e){if(Array.isArray(e))return e}var _A=null,xA=null;function g_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function bA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?g_(Object(r),!0).forEach(function(i){FE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function FE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function wA(e,n){if(e==null)return{};var r=BE(e,n),i,o;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)i=c[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function BE(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,c;for(c=0;c<i.length;c++)o=i[c],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var SA=null,__=G(73935);function NE(e,n){return jE(e)||UE(e,n)||ZE(e,n)||zE()}function zE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZE(e,n){if(!!e){if(typeof e=="string")return x_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x_(e,n)}}function x_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function UE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function jE(e){if(Array.isArray(e))return e}var VE=ve.useEffect,GE=ve.useState;function EA(e){var n=e.className,r=e.style,i=e.children,o=e.position,c=useSceneValue(),d=GE(function(){return document.createElement("div")}),y=NE(d,1),_=y[0];return VE(function(){var b=new Control({position:o});return b.onAdd=function(){if(n&&(_.className=n),r){var T=Object.keys(r).map(function(A){return"".concat(A,":").concat(r[A])}).join(";");_.style.cssText=T}return _},c.addControl(b),function(){c.removeControl(b)}},[]),createPortal(i,_)}var b_=(0,ve.createContext)({});function CA(){return useContext(b_)}var HE=ve.useEffect,WE=ve.memo(function(n){var r=n.layer,i=n.active;return HE(function(){r.active(i.option)},[JSON.stringify(i)]),null}),XE=ve.useEffect,YE=ve.memo(function(n){var r=n.layer,i=n.animate;return XE(function(){r.animate(i)},[JSON.stringify(i)]),null}),qE=ve.useEffect,KE=ve.memo(function(n){var r=n.layer,i=n.color;return qE(function(){i.field?r.color(i.field,i.values):r.color(i.values)},[i.field,i.scale,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),$E=ve.useEffect,JE=ve.memo(function(n){var r=n.layer,i=n.filter;return $E(function(){i.field&&r.filter(i.field,i.values)},[i.field,i.values,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),QE=ve.useEffect,eC=ve.memo(function(n){var r=n.layer,i=n.scale;return QE(function(){r.scale(i.values)},[i.values]),null}),tC=ve.useEffect,rC=ve.memo(function(n){var r=n.layer,i=n.select;return tC(function(){r.select(i.option)},[JSON.stringify(i)]),null}),nC=ve.useEffect,iC=ve.memo(function(n){var r=n.layer,i=n.shape;return nC(function(){i.field?r.shape(i.field,i.values):r.shape(i.values)},[i.field,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),aC=ve.useEffect,oC=ve.memo(function(n){var r=n.layer,i=n.size;return aC(function(){i.field?r.size(i.field,i.values):r.size(i.values)},[i.field,i.scale,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),sC=["data"];function uC(e,n){if(e==null)return{};var r=lC(e,n),i,o;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)i=c[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function lC(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,c;for(c=0;c<i.length;c++)o=i[c],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var cC=ve.useEffect,fC=ve.memo(function(n){var r=n.layer,i=n.source,o=i.data,c=uC(i,sC);return cC(function(){r.inited?r.setData(o,c):r.source(o,c),c.autoFit&&r.fitBounds(c&&c.fitBoundsOptions)},[o,JSON.stringify(c)]),null}),pC=ve.useEffect,hC=ve.memo(function(n){var r=n.layer,i=n.style;return pC(function(){r.style(i)},Object.keys(i).map(function(o){return i[o]})),null});function dC(e,n){return gC(e)||yC(e,n)||mC(e,n)||vC()}function vC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mC(e,n){if(!!e){if(typeof e=="string")return w_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w_(e,n)}}function w_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function yC(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function gC(e){if(Array.isArray(e))return e}var Fd=ve.useEffect,_C=ve.useState;function S_(e,n){var r=n.source,i=n.color,o=n.shape,c=n.style,d=n.size,y=n.scale,_=n.active,b=n.select,T=n.filter,A=n.animate,O=n.options,F=n.onLayerLoaded,W=be(),J=_C(function(){var rt;switch(e){case"polygonLayer":rt=new ay(O);break;case"lineLayer":rt=new ax(O);break;case"pointLayer":rt=new Wx(O);break;case"heatmapLayer":rt=new b1(O);break;case"rasterLayer":rt=new vb(O);break;case"imageLayer":rt=new O1(O);break;case"citybuildingLayer":rt=new W_(O);break;default:rt=new ay(O)}return rt.on("inited",function(){F&&F(rt,W)}),rt}),ue=dC(J,1),Ie=ue[0];return Fd(function(){return W.addLayer(Ie),function(){W.removeLayer(Ie)}},[]),Fd(function(){Ie.inited&&O&&Ie.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Fd(function(){Ie.inited&&(O==null?void 0:O.zIndex)&&Ie.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Fd(function(){Ie.inited&&(O==null?void 0:O.blend)&&Ie.setBlend(O.blend)},[O==null?void 0:O.blend]),Fd(function(){W.render()}),ve.createElement(b_.Provider,{value:Ie},ve.createElement(fC,{layer:Ie,source:r}),y&&ve.createElement(eC,{layer:Ie,scale:y}),i&&ve.createElement(KE,{layer:Ie,color:i}),d&&ve.createElement(oC,{layer:Ie,size:d}),o&&ve.createElement(iC,{layer:Ie,shape:o}),c&&ve.createElement(hC,{layer:Ie,style:c}),_&&ve.createElement(WE,{layer:Ie,active:_}),b&&ve.createElement(rC,{layer:Ie,select:b}),T&&ve.createElement(JE,{layer:Ie,filter:T}),A&&ve.createElement(YE,{layer:Ie,animate:A}),n.children)}var TA=null,AA=null,xC=ve.memo(function(n){return S_("pointLayer",n)}),bC=ve.memo(function(n){return S_("heatmapLayer",n)}),MA=null,PA=null,IA=null,OA=ve.useEffect,kA=null,LA=null;function Ov(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ov=function(r){return typeof r}:Ov=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ov(e)}function E_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function kv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?E_(Object(r),!0).forEach(function(i){wC(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wC(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function SC(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function C_(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function EC(e,n,r){return n&&C_(e.prototype,n),r&&C_(e,r),e}function CC(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&wm(e,n)}function wm(e,n){return wm=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},wm(e,n)}function TC(e){var n=PC();return function(){var i=Lv(e),o;if(n){var c=Lv(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return AC(this,o)}}function AC(e,n){return n&&(Ov(n)==="object"||typeof n=="function")?n:MC(e)}function MC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lv(e){return Lv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Lv(e)}var RA=function(e){CC(r,e);var n=TC(r);function r(i){var o;return SC(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return EC(r,[{key:"componentDidMount",value:function(){var o,c=this.props,d=c.lnglat,y=c.children,_=c.option,b=c.lngLat,T=new Uf(kv(kv({},_),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&T.setLnglat(d),b&&T.setLnglat(b),y&&T.setDOMContent(this.el),this.popup=T,this.scene.addPopup(T)}},{key:"componentDidUpdate",value:function(o){var c,d,y,_,b,T,A=Array.isArray(o.lnglat)?o.lnglat:[o==null||(c=o.lnglat)===null||c===void 0?void 0:c.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(y=this.props)===null||y===void 0||(_=y.lnglat)===null||_===void 0?void 0:_.lng,(b=this.props)===null||b===void 0||(T=b.lnglat)===null||T===void 0?void 0:T.lat],F=A.toString()!==O.toString();if(F){var W;this.popup.remove(),this.popup=new Uf(kv(kv({},this.props.option),{},{stopPropagation:(W=this.props.option)===null||W===void 0?void 0:W.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return ve.createElement(v.Consumer,{},function(c){return c&&(o.scene=c),(0,__.createPortal)(o.props.children,o.el)})}}]),r}(ve.PureComponent);function Rv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Rv=function(r){return typeof r}:Rv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Rv(e)}function IC(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function T_(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function OC(e,n,r){return n&&T_(e.prototype,n),r&&T_(e,r),e}function kC(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&Sm(e,n)}function Sm(e,n){return Sm=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},Sm(e,n)}function LC(e){var n=FC();return function(){var i=Dv(e),o;if(n){var c=Dv(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return RC(this,o)}}function RC(e,n){return n&&(Rv(n)==="object"||typeof n=="function")?n:DC(e)}function DC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Dv(e){return Dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Dv(e)}var DA=function(e){kC(r,e);var n=LC(r);function r(i){var o;return IC(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return OC(r,[{key:"componentDidMount",value:function(){var o=this.props,c=o.lnglat,d=o.children,y=o.option,_=o.onMarkerLoaded,b=new ns(y);c&&b.setLnglat(c),d&&b.setElement(this.el),this.marker=b,_&&_(b),this.scene.addMarker(b)}},{key:"componentDidUpdate",value:function(o){var c,d=(o==null?void 0:o.lnglat.toString())!==((c=this.props)===null||c===void 0?void 0:c.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return ve.createElement(v.Consumer,{},function(c){return c&&(o.scene=c),(0,__.createPortal)(o.props.children,o.el)})}}]),r}(ve.PureComponent),FA=ve.useEffect,BA=null,NA=null,zA=ve.useEffect,ZA=null},6563:function(dr,X,G){var Me=G(31795);dr.exports=ve;function ve(ae,fe){switch(ae&&ae.type||null){case"FeatureCollection":return ae.features=ae.features.map(v(ve,fe)),ae;case"GeometryCollection":return ae.geometries=ae.geometries.map(v(ve,fe)),ae;case"Feature":return ae.geometry=ve(ae.geometry,fe),ae;case"Polygon":case"MultiPolygon":return be(ae,fe);default:return ae}}function v(ae,fe){return function(Q){return ae(Q,fe)}}function be(ae,fe){return ae.type==="Polygon"?ae.coordinates=Z(ae.coordinates,fe):ae.type==="MultiPolygon"&&(ae.coordinates=ae.coordinates.map(v(Z,fe))),ae}function Z(ae,fe){fe=!!fe,ae[0]=se(ae[0],fe);for(var Q=1;Q<ae.length;Q++)ae[Q]=se(ae[Q],!fe);return ae}function se(ae,fe){return me(ae)===fe?ae:ae.reverse()}function me(ae){return Me.ring(ae)>=0}},31795:function(dr,X,G){var Me=G(75752);dr.exports.geometry=ve,dr.exports.ring=be;function ve(se){var me=0,ae;switch(se.type){case"Polygon":return v(se.coordinates);case"MultiPolygon":for(ae=0;ae<se.coordinates.length;ae++)me+=v(se.coordinates[ae]);return me;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ae=0;ae<se.geometries.length;ae++)me+=ve(se.geometries[ae]);return me}}function v(se){var me=0;if(se&&se.length>0){me+=Math.abs(be(se[0]));for(var ae=1;ae<se.length;ae++)me-=Math.abs(be(se[ae]))}return me}function be(se){var me,ae,fe,Q,we,Oe,M,Jt=0,Gt=se.length;if(Gt>2){for(M=0;M<Gt;M++)M===Gt-2?(Q=Gt-2,we=Gt-1,Oe=0):M===Gt-1?(Q=Gt-1,we=0,Oe=1):(Q=M,we=M+1,Oe=M+2),me=se[Q],ae=se[we],fe=se[Oe],Jt+=(Z(fe[0])-Z(me[0]))*Math.sin(Z(ae[1]));Jt=Jt*Me.RADIUS*Me.RADIUS/2}return Jt}function Z(se){return se*Math.PI/180}},49296:function(dr){"use strict";dr.exports=G,dr.exports.default=G;var X=1e20;function G(Z,se,me,ae,fe,Q){this.fontSize=Z||24,this.buffer=se===void 0?3:se,this.cutoff=ae||.25,this.fontFamily=fe||"sans-serif",this.fontWeight=Q||"normal",this.radius=me||8;var we=this.size=this.fontSize+this.buffer*2,Oe=we+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=we,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Oe*Oe),this.gridInner=new Float64Array(Oe*Oe),this.f=new Float64Array(Oe),this.z=new Float64Array(Oe+1),this.v=new Uint16Array(Oe),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(we/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Me(Z,se,me,ae,fe,Q,we){Q.fill(X,0,se*me),we.fill(0,0,se*me);for(var Oe=(se-ae)/2,M=0;M<fe;M++)for(var Jt=0;Jt<ae;Jt++){var Gt=(M+Oe)*se+Jt+Oe,Dt=Z.data[4*(M*ae+Jt)+3]/255;if(Dt===1)Q[Gt]=0,we[Gt]=X;else if(Dt===0)Q[Gt]=X,we[Gt]=0;else{var Ut=Math.max(0,.5-Dt),ct=Math.max(0,Dt-.5);Q[Gt]=Ut*Ut,we[Gt]=ct*ct}}}function ve(Z,se,me,ae,fe,Q,we){for(var Oe=0;Oe<se*me;Oe++){var M=Math.sqrt(ae[Oe])-Math.sqrt(fe[Oe]);Z[Oe]=Math.round(255-255*(M/Q+we))}}G.prototype._draw=function(Z,se){var me=this.ctx.measureText(Z),ae=me.width,fe=2*this.buffer,Q,we,Oe,M,Jt,Gt,Dt,Ut;se&&this.useMetrics?(Jt=Math.floor(me.actualBoundingBoxAscent),Ut=this.buffer+Math.ceil(me.actualBoundingBoxAscent),Gt=this.buffer,Dt=this.buffer,we=Math.min(this.size,Math.ceil(me.actualBoundingBoxRight-me.actualBoundingBoxLeft)),M=Math.min(this.size-Gt,Math.ceil(me.actualBoundingBoxAscent+me.actualBoundingBoxDescent)),Q=we+fe,Oe=M+fe,this.ctx.textBaseline="alphabetic"):(Q=we=this.size,Oe=M=this.size,Jt=19*this.fontSize/24,Gt=Dt=0,Ut=this.middle,this.ctx.textBaseline="middle");var ct;we&&M&&(this.ctx.clearRect(Dt,Gt,we,M),this.ctx.fillText(Z,this.buffer,Ut),ct=this.ctx.getImageData(Dt,Gt,we,M));var dt=new Uint8ClampedArray(Q*Oe);return Me(ct,Q,Oe,we,M,this.gridOuter,this.gridInner),v(this.gridOuter,Q,Oe,this.f,this.v,this.z),v(this.gridInner,Q,Oe,this.f,this.v,this.z),ve(dt,Q,Oe,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:we,height:M,sdfWidth:Q,sdfHeight:Oe,top:Jt,left:0,advance:ae}}},G.prototype.draw=function(Z){return this._draw(Z,!1).data},G.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function v(Z,se,me,ae,fe,Q){for(var we=0;we<se;we++)be(Z,we,se,me,ae,fe,Q);for(var Oe=0;Oe<me;Oe++)be(Z,Oe*se,1,se,ae,fe,Q)}function be(Z,se,me,ae,fe,Q,we){var Oe,M,Jt,Gt;for(Q[0]=0,we[0]=-X,we[1]=X,Oe=0;Oe<ae;Oe++)fe[Oe]=Z[se+Oe*me];for(Oe=1,M=0,Jt=0;Oe<ae;Oe++){do Gt=Q[M],Jt=(fe[Oe]-fe[Gt]+Oe*Oe-Gt*Gt)/(Oe-Gt)/2;while(Jt<=we[M]&&--M>-1);M++,Q[M]=Oe,we[M]=Jt,we[M+1]=X}for(Oe=0,M=0;Oe<ae;Oe++){for(;we[M+1]<Oe;)M++;Gt=Q[M],Z[se+Oe*me]=fe[Gt]+(Oe-Gt)*(Oe-Gt)}}},17781:function(){},9187:function(dr){"use strict";dr.exports=X,dr.exports.default=X;function X(Ee,Ve,ke){ke=ke||2;var vt=Ve&&Ve.length,qe=vt?Ve[0]*ke:Ee.length,H=G(Ee,0,qe,ke,!0),Je=[];if(!H||H.next===H.prev)return Je;var Et,gt,qr,Si,On,An,gn;if(vt&&(H=me(Ee,Ve,H,ke)),Ee.length>80*ke){Et=qr=Ee[0],gt=Si=Ee[1];for(var Cn=ke;Cn<qe;Cn+=ke)On=Ee[Cn],An=Ee[Cn+1],On<Et&&(Et=On),An<gt&&(gt=An),On>qr&&(qr=On),An>Si&&(Si=An);gn=Math.max(qr-Et,Si-gt),gn=gn!==0?1/gn:0}return ve(H,Je,ke,Et,gt,gn),Je}function G(Ee,Ve,ke,vt,qe){var H,Je;if(qe===Gr(Ee,Ve,ke,vt)>0)for(H=Ve;H<ke;H+=vt)Je=kt(H,Ee[H],Ee[H+1],Je);else for(H=ke-vt;H>=Ve;H-=vt)Je=kt(H,Ee[H],Ee[H+1],Je);return Je&&dt(Je,Je.next)&&(ur(Je),Je=Je.next),Je}function Me(Ee,Ve){if(!Ee)return Ee;Ve||(Ve=Ee);var ke=Ee,vt;do if(vt=!1,!ke.steiner&&(dt(ke,ke.next)||ct(ke.prev,ke,ke.next)===0)){if(ur(ke),ke=Ve=ke.prev,ke===ke.next)break;vt=!0}else ke=ke.next;while(vt||ke!==Ve);return Ve}function ve(Ee,Ve,ke,vt,qe,H,Je){if(!!Ee){!Je&&H&&Oe(Ee,vt,qe,H);for(var Et=Ee,gt,qr;Ee.prev!==Ee.next;){if(gt=Ee.prev,qr=Ee.next,H?be(Ee,vt,qe,H):v(Ee)){Ve.push(gt.i/ke),Ve.push(Ee.i/ke),Ve.push(qr.i/ke),ur(Ee),Ee=qr.next,Et=qr.next;continue}if(Ee=qr,Ee===Et){Je?Je===1?(Ee=Z(Me(Ee),Ve,ke),ve(Ee,Ve,ke,vt,qe,H,2)):Je===2&&se(Ee,Ve,ke,vt,qe,H):ve(Me(Ee),Ve,ke,vt,qe,H,1);break}}}}function v(Ee){var Ve=Ee.prev,ke=Ee,vt=Ee.next;if(ct(Ve,ke,vt)>=0)return!1;for(var qe=Ee.next.next;qe!==Ee.prev;){if(Dt(Ve.x,Ve.y,ke.x,ke.y,vt.x,vt.y,qe.x,qe.y)&&ct(qe.prev,qe,qe.next)>=0)return!1;qe=qe.next}return!0}function be(Ee,Ve,ke,vt){var qe=Ee.prev,H=Ee,Je=Ee.next;if(ct(qe,H,Je)>=0)return!1;for(var Et=qe.x<H.x?qe.x<Je.x?qe.x:Je.x:H.x<Je.x?H.x:Je.x,gt=qe.y<H.y?qe.y<Je.y?qe.y:Je.y:H.y<Je.y?H.y:Je.y,qr=qe.x>H.x?qe.x>Je.x?qe.x:Je.x:H.x>Je.x?H.x:Je.x,Si=qe.y>H.y?qe.y>Je.y?qe.y:Je.y:H.y>Je.y?H.y:Je.y,On=Jt(Et,gt,Ve,ke,vt),An=Jt(qr,Si,Ve,ke,vt),gn=Ee.prevZ,Cn=Ee.nextZ;gn&&gn.z>=On&&Cn&&Cn.z<=An;){if(gn!==Ee.prev&&gn!==Ee.next&&Dt(qe.x,qe.y,H.x,H.y,Je.x,Je.y,gn.x,gn.y)&&ct(gn.prev,gn,gn.next)>=0||(gn=gn.prevZ,Cn!==Ee.prev&&Cn!==Ee.next&&Dt(qe.x,qe.y,H.x,H.y,Je.x,Je.y,Cn.x,Cn.y)&&ct(Cn.prev,Cn,Cn.next)>=0))return!1;Cn=Cn.nextZ}for(;gn&&gn.z>=On;){if(gn!==Ee.prev&&gn!==Ee.next&&Dt(qe.x,qe.y,H.x,H.y,Je.x,Je.y,gn.x,gn.y)&&ct(gn.prev,gn,gn.next)>=0)return!1;gn=gn.prevZ}for(;Cn&&Cn.z<=An;){if(Cn!==Ee.prev&&Cn!==Ee.next&&Dt(qe.x,qe.y,H.x,H.y,Je.x,Je.y,Cn.x,Cn.y)&&ct(Cn.prev,Cn,Cn.next)>=0)return!1;Cn=Cn.nextZ}return!0}function Z(Ee,Ve,ke){var vt=Ee;do{var qe=vt.prev,H=vt.next.next;!dt(qe,H)&&Mr(qe,vt,vt.next,H)&&He(qe,H)&&He(H,qe)&&(Ve.push(qe.i/ke),Ve.push(vt.i/ke),Ve.push(H.i/ke),ur(vt),ur(vt.next),vt=Ee=H),vt=vt.next}while(vt!==Ee);return Me(vt)}function se(Ee,Ve,ke,vt,qe,H){var Je=Ee;do{for(var Et=Je.next.next;Et!==Je.prev;){if(Je.i!==Et.i&&Ut(Je,Et)){var gt=Ye(Je,Et);Je=Me(Je,Je.next),gt=Me(gt,gt.next),ve(Je,Ve,ke,vt,qe,H),ve(gt,Ve,ke,vt,qe,H);return}Et=Et.next}Je=Je.next}while(Je!==Ee)}function me(Ee,Ve,ke,vt){var qe=[],H,Je,Et,gt,qr;for(H=0,Je=Ve.length;H<Je;H++)Et=Ve[H]*vt,gt=H<Je-1?Ve[H+1]*vt:Ee.length,qr=G(Ee,Et,gt,vt,!1),qr===qr.next&&(qr.steiner=!0),qe.push(Gt(qr));for(qe.sort(ae),H=0;H<qe.length;H++)ke=fe(qe[H],ke),ke=Me(ke,ke.next);return ke}function ae(Ee,Ve){return Ee.x-Ve.x}function fe(Ee,Ve){var ke=Q(Ee,Ve);if(!ke)return Ve;var vt=Ye(ke,Ee),qe=Me(ke,ke.next);return Me(vt,vt.next),Ve===ke?qe:Ve}function Q(Ee,Ve){var ke=Ve,vt=Ee.x,qe=Ee.y,H=-Infinity,Je;do{if(qe<=ke.y&&qe>=ke.next.y&&ke.next.y!==ke.y){var Et=ke.x+(qe-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Et<=vt&&Et>H){if(H=Et,Et===vt){if(qe===ke.y)return ke;if(qe===ke.next.y)return ke.next}Je=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Ve);if(!Je)return null;if(vt===H)return Je;var gt=Je,qr=Je.x,Si=Je.y,On=Infinity,An;ke=Je;do vt>=ke.x&&ke.x>=qr&&vt!==ke.x&&Dt(qe<Si?vt:H,qe,qr,Si,qe<Si?H:vt,qe,ke.x,ke.y)&&(An=Math.abs(qe-ke.y)/(vt-ke.x),He(ke,Ee)&&(An<On||An===On&&(ke.x>Je.x||ke.x===Je.x&&we(Je,ke)))&&(Je=ke,On=An)),ke=ke.next;while(ke!==gt);return Je}function we(Ee,Ve){return ct(Ee.prev,Ee,Ve.prev)<0&&ct(Ve.next,Ee,Ee.next)<0}function Oe(Ee,Ve,ke,vt){var qe=Ee;do qe.z===null&&(qe.z=Jt(qe.x,qe.y,Ve,ke,vt)),qe.prevZ=qe.prev,qe.nextZ=qe.next,qe=qe.next;while(qe!==Ee);qe.prevZ.nextZ=null,qe.prevZ=null,M(qe)}function M(Ee){var Ve,ke,vt,qe,H,Je,Et,gt,qr=1;do{for(ke=Ee,Ee=null,H=null,Je=0;ke;){for(Je++,vt=ke,Et=0,Ve=0;Ve<qr&&(Et++,vt=vt.nextZ,!!vt);Ve++);for(gt=qr;Et>0||gt>0&&vt;)Et!==0&&(gt===0||!vt||ke.z<=vt.z)?(qe=ke,ke=ke.nextZ,Et--):(qe=vt,vt=vt.nextZ,gt--),H?H.nextZ=qe:Ee=qe,qe.prevZ=H,H=qe;ke=vt}H.nextZ=null,qr*=2}while(Je>1);return Ee}function Jt(Ee,Ve,ke,vt,qe){return Ee=32767*(Ee-ke)*qe,Ve=32767*(Ve-vt)*qe,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,Ve=(Ve|Ve<<8)&16711935,Ve=(Ve|Ve<<4)&252645135,Ve=(Ve|Ve<<2)&858993459,Ve=(Ve|Ve<<1)&1431655765,Ee|Ve<<1}function Gt(Ee){var Ve=Ee,ke=Ee;do(Ve.x<ke.x||Ve.x===ke.x&&Ve.y<ke.y)&&(ke=Ve),Ve=Ve.next;while(Ve!==Ee);return ke}function Dt(Ee,Ve,ke,vt,qe,H,Je,Et){return(qe-Je)*(Ve-Et)-(Ee-Je)*(H-Et)>=0&&(Ee-Je)*(vt-Et)-(ke-Je)*(Ve-Et)>=0&&(ke-Je)*(H-Et)-(qe-Je)*(vt-Et)>=0}function Ut(Ee,Ve){return Ee.next.i!==Ve.i&&Ee.prev.i!==Ve.i&&!st(Ee,Ve)&&(He(Ee,Ve)&&He(Ve,Ee)&&ut(Ee,Ve)&&(ct(Ee.prev,Ee,Ve.prev)||ct(Ee,Ve.prev,Ve))||dt(Ee,Ve)&&ct(Ee.prev,Ee,Ee.next)>0&&ct(Ve.prev,Ve,Ve.next)>0)}function ct(Ee,Ve,ke){return(Ve.y-Ee.y)*(ke.x-Ve.x)-(Ve.x-Ee.x)*(ke.y-Ve.y)}function dt(Ee,Ve){return Ee.x===Ve.x&&Ee.y===Ve.y}function Mr(Ee,Ve,ke,vt){var qe=Ft(ct(Ee,Ve,ke)),H=Ft(ct(Ee,Ve,vt)),Je=Ft(ct(ke,vt,Ee)),Et=Ft(ct(ke,vt,Ve));return!!(qe!==H&&Je!==Et||qe===0&&cr(Ee,ke,Ve)||H===0&&cr(Ee,vt,Ve)||Je===0&&cr(ke,Ee,vt)||Et===0&&cr(ke,Ve,vt))}function cr(Ee,Ve,ke){return Ve.x<=Math.max(Ee.x,ke.x)&&Ve.x>=Math.min(Ee.x,ke.x)&&Ve.y<=Math.max(Ee.y,ke.y)&&Ve.y>=Math.min(Ee.y,ke.y)}function Ft(Ee){return Ee>0?1:Ee<0?-1:0}function st(Ee,Ve){var ke=Ee;do{if(ke.i!==Ee.i&&ke.next.i!==Ee.i&&ke.i!==Ve.i&&ke.next.i!==Ve.i&&Mr(ke,ke.next,Ee,Ve))return!0;ke=ke.next}while(ke!==Ee);return!1}function He(Ee,Ve){return ct(Ee.prev,Ee,Ee.next)<0?ct(Ee,Ve,Ee.next)>=0&&ct(Ee,Ee.prev,Ve)>=0:ct(Ee,Ve,Ee.prev)<0||ct(Ee,Ee.next,Ve)<0}function ut(Ee,Ve){var ke=Ee,vt=!1,qe=(Ee.x+Ve.x)/2,H=(Ee.y+Ve.y)/2;do ke.y>H!=ke.next.y>H&&ke.next.y!==ke.y&&qe<(ke.next.x-ke.x)*(H-ke.y)/(ke.next.y-ke.y)+ke.x&&(vt=!vt),ke=ke.next;while(ke!==Ee);return vt}function Ye(Ee,Ve){var ke=new Or(Ee.i,Ee.x,Ee.y),vt=new Or(Ve.i,Ve.x,Ve.y),qe=Ee.next,H=Ve.prev;return Ee.next=Ve,Ve.prev=Ee,ke.next=qe,qe.prev=ke,vt.next=ke,ke.prev=vt,H.next=vt,vt.prev=H,vt}function kt(Ee,Ve,ke,vt){var qe=new Or(Ee,Ve,ke);return vt?(qe.next=vt.next,qe.prev=vt,vt.next.prev=qe,vt.next=qe):(qe.prev=qe,qe.next=qe),qe}function ur(Ee){Ee.next.prev=Ee.prev,Ee.prev.next=Ee.next,Ee.prevZ&&(Ee.prevZ.nextZ=Ee.nextZ),Ee.nextZ&&(Ee.nextZ.prevZ=Ee.prevZ)}function Or(Ee,Ve,ke){this.i=Ee,this.x=Ve,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}X.deviation=function(Ee,Ve,ke,vt){var qe=Ve&&Ve.length,H=qe?Ve[0]*ke:Ee.length,Je=Math.abs(Gr(Ee,0,H,ke));if(qe)for(var Et=0,gt=Ve.length;Et<gt;Et++){var qr=Ve[Et]*ke,Si=Et<gt-1?Ve[Et+1]*ke:Ee.length;Je-=Math.abs(Gr(Ee,qr,Si,ke))}var On=0;for(Et=0;Et<vt.length;Et+=3){var An=vt[Et]*ke,gn=vt[Et+1]*ke,Cn=vt[Et+2]*ke;On+=Math.abs((Ee[An]-Ee[Cn])*(Ee[gn+1]-Ee[An+1])-(Ee[An]-Ee[gn])*(Ee[Cn+1]-Ee[An+1]))}return Je===0&&On===0?0:Math.abs((On-Je)/Je)};function Gr(Ee,Ve,ke,vt){for(var qe=0,H=Ve,Je=ke-vt;H<ke;H+=vt)qe+=(Ee[Je]-Ee[H])*(Ee[H+1]+Ee[Je+1]),Je=H;return qe}X.flatten=function(Ee){for(var Ve=Ee[0][0].length,ke={vertices:[],holes:[],dimensions:Ve},vt=0,qe=0;qe<Ee.length;qe++){for(var H=0;H<Ee[qe].length;H++)for(var Je=0;Je<Ve;Je++)ke.vertices.push(Ee[qe][H][Je]);qe>0&&(vt+=Ee[qe-1].length,ke.holes.push(vt))}return ke}},67709:function(dr){function X(Me){var ve=Me.target||Me.srcElement;ve.__resizeRAF__&&cancelAnimationFrame(ve.__resizeRAF__),ve.__resizeRAF__=requestAnimationFrame(function(){var v=ve.__resizeTrigger__,be=v&&v.__resizeListeners__;be&&be.forEach(function(Z){Z.call(v,Me)})})}var G=function(ve,v){var be=this,Z=be.document,se,me=Z.attachEvent;typeof navigator!="undefined"&&(se=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ae(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",X)}if(!ve.__resizeListeners__)if(ve.__resizeListeners__=[],me)ve.__resizeTrigger__=ve,ve.attachEvent("onresize",X);else{getComputedStyle(ve).position==="static"&&(ve.style.position="relative");var fe=ve.__resizeTrigger__=Z.createElement("object");fe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),fe.setAttribute("class","resize-sensor"),fe.setAttribute("tabindex","-1"),fe.setAttribute("title",""),fe.__resizeElement__=ve,fe.onload=ae,fe.type="text/html",se&&ve.appendChild(fe),fe.data="about:blank",se||ve.appendChild(fe)}ve.__resizeListeners__.push(v)};dr.exports=typeof window=="undefined"?G:G.bind(window),dr.exports.unbind=function(Me,ve){var v=document.attachEvent,be=Me.__resizeListeners__||[];if(ve){var Z=be.indexOf(ve);Z!==-1&&be.splice(Z,1)}else be=Me.__resizeListeners__=[];if(!be.length){if(v)Me.detachEvent("onresize",X);else if(Me.__resizeTrigger__){var se=Me.__resizeTrigger__.contentDocument,me=se&&se.defaultView;me&&(me.removeEventListener("resize",X),delete me.__resizeTrigger__),Me.__resizeTrigger__=!Me.removeChild(Me.__resizeTrigger__)}delete Me.__resizeListeners__}}},26729:function(dr){"use strict";var X=Object.prototype.hasOwnProperty,G="~";function Me(){}Object.create&&(Me.prototype=Object.create(null),new Me().__proto__||(G=!1));function ve(se,me,ae){this.fn=se,this.context=me,this.once=ae||!1}function v(se,me,ae,fe,Q){if(typeof ae!="function")throw new TypeError("The listener must be a function");var we=new ve(ae,fe||se,Q),Oe=G?G+me:me;return se._events[Oe]?se._events[Oe].fn?se._events[Oe]=[se._events[Oe],we]:se._events[Oe].push(we):(se._events[Oe]=we,se._eventsCount++),se}function be(se,me){--se._eventsCount==0?se._events=new Me:delete se._events[me]}function Z(){this._events=new Me,this._eventsCount=0}Z.prototype.eventNames=function(){var me=[],ae,fe;if(this._eventsCount===0)return me;for(fe in ae=this._events)X.call(ae,fe)&&me.push(G?fe.slice(1):fe);return Object.getOwnPropertySymbols?me.concat(Object.getOwnPropertySymbols(ae)):me},Z.prototype.listeners=function(me){var ae=G?G+me:me,fe=this._events[ae];if(!fe)return[];if(fe.fn)return[fe.fn];for(var Q=0,we=fe.length,Oe=new Array(we);Q<we;Q++)Oe[Q]=fe[Q].fn;return Oe},Z.prototype.listenerCount=function(me){var ae=G?G+me:me,fe=this._events[ae];return fe?fe.fn?1:fe.length:0},Z.prototype.emit=function(me,ae,fe,Q,we,Oe){var M=G?G+me:me;if(!this._events[M])return!1;var Jt=this._events[M],Gt=arguments.length,Dt,Ut;if(Jt.fn){switch(Jt.once&&this.removeListener(me,Jt.fn,void 0,!0),Gt){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,ae),!0;case 3:return Jt.fn.call(Jt.context,ae,fe),!0;case 4:return Jt.fn.call(Jt.context,ae,fe,Q),!0;case 5:return Jt.fn.call(Jt.context,ae,fe,Q,we),!0;case 6:return Jt.fn.call(Jt.context,ae,fe,Q,we,Oe),!0}for(Ut=1,Dt=new Array(Gt-1);Ut<Gt;Ut++)Dt[Ut-1]=arguments[Ut];Jt.fn.apply(Jt.context,Dt)}else{var ct=Jt.length,dt;for(Ut=0;Ut<ct;Ut++)switch(Jt[Ut].once&&this.removeListener(me,Jt[Ut].fn,void 0,!0),Gt){case 1:Jt[Ut].fn.call(Jt[Ut].context);break;case 2:Jt[Ut].fn.call(Jt[Ut].context,ae);break;case 3:Jt[Ut].fn.call(Jt[Ut].context,ae,fe);break;case 4:Jt[Ut].fn.call(Jt[Ut].context,ae,fe,Q);break;default:if(!Dt)for(dt=1,Dt=new Array(Gt-1);dt<Gt;dt++)Dt[dt-1]=arguments[dt];Jt[Ut].fn.apply(Jt[Ut].context,Dt)}}return!0},Z.prototype.on=function(me,ae,fe){return v(this,me,ae,fe,!1)},Z.prototype.once=function(me,ae,fe){return v(this,me,ae,fe,!0)},Z.prototype.removeListener=function(me,ae,fe,Q){var we=G?G+me:me;if(!this._events[we])return this;if(!ae)return be(this,we),this;var Oe=this._events[we];if(Oe.fn)Oe.fn===ae&&(!Q||Oe.once)&&(!fe||Oe.context===fe)&&be(this,we);else{for(var M=0,Jt=[],Gt=Oe.length;M<Gt;M++)(Oe[M].fn!==ae||Q&&!Oe[M].once||fe&&Oe[M].context!==fe)&&Jt.push(Oe[M]);Jt.length?this._events[we]=Jt.length===1?Jt[0]:Jt:be(this,we)}return this},Z.prototype.removeAllListeners=function(me){var ae;return me?(ae=G?G+me:me,this._events[ae]&&be(this,ae)):(this._events=new Me,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=G,Z.EventEmitter=Z,dr.exports=Z},50840:function(dr,X,G){var Me;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ve,v,be,Z){"use strict";var se=["","webkit","Moz","MS","ms","o"],me=v.createElement("div"),ae="function",fe=Math.round,Q=Math.abs,we=Date.now;function Oe(K,he,je){return setTimeout(Mr(K,je),he)}function M(K,he,je){return Array.isArray(K)?(Jt(K,je[he],je),!0):!1}function Jt(K,he,je){var It;if(!!K)if(K.forEach)K.forEach(he,je);else if(K.length!==Z)for(It=0;It<K.length;)he.call(je,K[It],It,K),It++;else for(It in K)K.hasOwnProperty(It)&&he.call(je,K[It],It,K)}function Gt(K,he,je){var It="DEPRECATED METHOD: "+he+`
`+je+` AT 
`;return function(){var xr=new Error("get-stack-trace"),an=xr&&xr.stack?xr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",yi=ve.console&&(ve.console.warn||ve.console.log);return yi&&yi.call(ve.console,It,an),K.apply(this,arguments)}}var Dt;typeof Object.assign!="function"?Dt=function(he){if(he===Z||he===null)throw new TypeError("Cannot convert undefined or null to object");for(var je=Object(he),It=1;It<arguments.length;It++){var xr=arguments[It];if(xr!==Z&&xr!==null)for(var an in xr)xr.hasOwnProperty(an)&&(je[an]=xr[an])}return je}:Dt=Object.assign;var Ut=Gt(function(he,je,It){for(var xr=Object.keys(je),an=0;an<xr.length;)(!It||It&&he[xr[an]]===Z)&&(he[xr[an]]=je[xr[an]]),an++;return he},"extend","Use `assign`."),ct=Gt(function(he,je){return Ut(he,je,!0)},"merge","Use `assign`.");function dt(K,he,je){var It=he.prototype,xr;xr=K.prototype=Object.create(It),xr.constructor=K,xr._super=It,je&&Dt(xr,je)}function Mr(K,he){return function(){return K.apply(he,arguments)}}function cr(K,he){return typeof K==ae?K.apply(he&&he[0]||Z,he):K}function Ft(K,he){return K===Z?he:K}function st(K,he,je){Jt(kt(he),function(It){K.addEventListener(It,je,!1)})}function He(K,he,je){Jt(kt(he),function(It){K.removeEventListener(It,je,!1)})}function ut(K,he){for(;K;){if(K==he)return!0;K=K.parentNode}return!1}function Ye(K,he){return K.indexOf(he)>-1}function kt(K){return K.trim().split(/\s+/g)}function ur(K,he,je){if(K.indexOf&&!je)return K.indexOf(he);for(var It=0;It<K.length;){if(je&&K[It][je]==he||!je&&K[It]===he)return It;It++}return-1}function Or(K){return Array.prototype.slice.call(K,0)}function Gr(K,he,je){for(var It=[],xr=[],an=0;an<K.length;){var yi=he?K[an][he]:K[an];ur(xr,yi)<0&&It.push(K[an]),xr[an]=yi,an++}return je&&(he?It=It.sort(function(Ya,Aa){return Ya[he]>Aa[he]}):It=It.sort()),It}function Ee(K,he){for(var je,It,xr=he[0].toUpperCase()+he.slice(1),an=0;an<se.length;){if(je=se[an],It=je?je+xr:he,It in K)return It;an++}return Z}var Ve=1;function ke(){return Ve++}function vt(K){var he=K.ownerDocument||K;return he.defaultView||he.parentWindow||ve}var qe=/mobile|tablet|ip(ad|hone|od)|android/i,H="ontouchstart"in ve,Je=Ee(ve,"PointerEvent")!==Z,Et=H&&qe.test(navigator.userAgent),gt="touch",qr="pen",Si="mouse",On="kinect",An=25,gn=1,Cn=2,un=4,Oi=8,Ei=1,da=2,sa=4,Ti=8,lo=16,Mi=da|sa,Pi=Ti|lo,bo=Mi|Pi,le=["x","y"],Ha=["clientX","clientY"];function ki(K,he){var je=this;this.manager=K,this.callback=he,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(It){cr(K.options.enable,[K])&&je.handler(It)},this.init()}ki.prototype={handler:function(){},init:function(){this.evEl&&st(this.element,this.evEl,this.domHandler),this.evTarget&&st(this.target,this.evTarget,this.domHandler),this.evWin&&st(vt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&He(this.element,this.evEl,this.domHandler),this.evTarget&&He(this.target,this.evTarget,this.domHandler),this.evWin&&He(vt(this.element),this.evWin,this.domHandler)}};function Wo(K){var he,je=K.options.inputClass;return je?he=je:Je?he=U:Et?he=nt:H?he=er:he=wo,new he(K,cu)}function cu(K,he,je){var It=je.pointers.length,xr=je.changedPointers.length,an=he&gn&&It-xr==0,yi=he&(un|Oi)&&It-xr==0;je.isFirst=!!an,je.isFinal=!!yi,an&&(K.session={}),je.eventType=he,is(K,je),K.emit("hammer.input",je),K.recognize(je),K.session.prevInput=je}function is(K,he){var je=K.session,It=he.pointers,xr=It.length;je.firstInput||(je.firstInput=Xt(he)),xr>1&&!je.firstMultiple?je.firstMultiple=Xt(he):xr===1&&(je.firstMultiple=!1);var an=je.firstInput,yi=je.firstMultiple,ma=yi?yi.center:an.center,Ya=he.center=Tr(It);he.timeStamp=we(),he.deltaTime=he.timeStamp-an.timeStamp,he.angle=Rn(ma,Ya),he.distance=ui(ma,Ya),as(je,he),he.offsetDirection=dn(he.deltaX,he.deltaY);var Aa=Ur(he.deltaTime,he.deltaX,he.deltaY);he.overallVelocityX=Aa.x,he.overallVelocityY=Aa.y,he.overallVelocity=Q(Aa.x)>Q(Aa.y)?Aa.x:Aa.y,he.scale=yi?Mn(yi.pointers,It):1,he.rotation=yi?$n(yi.pointers,It):0,he.maxPointers=je.prevInput?he.pointers.length>je.prevInput.maxPointers?he.pointers.length:je.prevInput.maxPointers:he.pointers.length,bt(je,he);var qo=K.element;ut(he.srcEvent.target,qo)&&(qo=he.srcEvent.target),he.target=qo}function as(K,he){var je=he.center,It=K.offsetDelta||{},xr=K.prevDelta||{},an=K.prevInput||{};(he.eventType===gn||an.eventType===un)&&(xr=K.prevDelta={x:an.deltaX||0,y:an.deltaY||0},It=K.offsetDelta={x:je.x,y:je.y}),he.deltaX=xr.x+(je.x-It.x),he.deltaY=xr.y+(je.y-It.y)}function bt(K,he){var je=K.lastInterval||he,It=he.timeStamp-je.timeStamp,xr,an,yi,ma;if(he.eventType!=Oi&&(It>An||je.velocity===Z)){var Ya=he.deltaX-je.deltaX,Aa=he.deltaY-je.deltaY,qo=Ur(It,Ya,Aa);an=qo.x,yi=qo.y,xr=Q(qo.x)>Q(qo.y)?qo.x:qo.y,ma=dn(Ya,Aa),K.lastInterval=he}else xr=je.velocity,an=je.velocityX,yi=je.velocityY,ma=je.direction;he.velocity=xr,he.velocityX=an,he.velocityY=yi,he.direction=ma}function Xt(K){for(var he=[],je=0;je<K.pointers.length;)he[je]={clientX:fe(K.pointers[je].clientX),clientY:fe(K.pointers[je].clientY)},je++;return{timeStamp:we(),pointers:he,center:Tr(he),deltaX:K.deltaX,deltaY:K.deltaY}}function Tr(K){var he=K.length;if(he===1)return{x:fe(K[0].clientX),y:fe(K[0].clientY)};for(var je=0,It=0,xr=0;xr<he;)je+=K[xr].clientX,It+=K[xr].clientY,xr++;return{x:fe(je/he),y:fe(It/he)}}function Ur(K,he,je){return{x:he/K||0,y:je/K||0}}function dn(K,he){return K===he?Ei:Q(K)>=Q(he)?K<0?da:sa:he<0?Ti:lo}function ui(K,he,je){je||(je=le);var It=he[je[0]]-K[je[0]],xr=he[je[1]]-K[je[1]];return Math.sqrt(It*It+xr*xr)}function Rn(K,he,je){je||(je=le);var It=he[je[0]]-K[je[0]],xr=he[je[1]]-K[je[1]];return Math.atan2(xr,It)*180/Math.PI}function $n(K,he){return Rn(he[1],he[0],Ha)+Rn(K[1],K[0],Ha)}function Mn(K,he){return ui(he[0],he[1],Ha)/ui(K[0],K[1],Ha)}var di={mousedown:gn,mousemove:Cn,mouseup:un},ni="mousedown",to="mousemove mouseup";function wo(){this.evEl=ni,this.evWin=to,this.pressed=!1,ki.apply(this,arguments)}dt(wo,ki,{handler:function(he){var je=di[he.type];je&gn&&he.button===0&&(this.pressed=!0),je&Cn&&he.which!==1&&(je=un),!!this.pressed&&(je&un&&(this.pressed=!1),this.callback(this.manager,je,{pointers:[he],changedPointers:[he],pointerType:Si,srcEvent:he}))}});var fu={pointerdown:gn,pointermove:Cn,pointerup:un,pointercancel:Oi,pointerout:Oi},Rs={2:gt,3:qr,4:Si,5:On},Ji="pointerdown",B="pointermove pointerup pointercancel";ve.MSPointerEvent&&!ve.PointerEvent&&(Ji="MSPointerDown",B="MSPointerMove MSPointerUp MSPointerCancel");function U(){this.evEl=Ji,this.evWin=B,ki.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}dt(U,ki,{handler:function(he){var je=this.store,It=!1,xr=he.type.toLowerCase().replace("ms",""),an=fu[xr],yi=Rs[he.pointerType]||he.pointerType,ma=yi==gt,Ya=ur(je,he.pointerId,"pointerId");an&gn&&(he.button===0||ma)?Ya<0&&(je.push(he),Ya=je.length-1):an&(un|Oi)&&(It=!0),!(Ya<0)&&(je[Ya]=he,this.callback(this.manager,an,{pointers:je,changedPointers:[he],pointerType:yi,srcEvent:he}),It&&je.splice(Ya,1))}});var Y={touchstart:gn,touchmove:Cn,touchend:un,touchcancel:Oi},oe="touchstart",Te="touchstart touchmove touchend touchcancel";function Ze(){this.evTarget=oe,this.evWin=Te,this.started=!1,ki.apply(this,arguments)}dt(Ze,ki,{handler:function(he){var je=Y[he.type];if(je===gn&&(this.started=!0),!!this.started){var It=We.call(this,he,je);je&(un|Oi)&&It[0].length-It[1].length==0&&(this.started=!1),this.callback(this.manager,je,{pointers:It[0],changedPointers:It[1],pointerType:gt,srcEvent:he})}}});function We(K,he){var je=Or(K.touches),It=Or(K.changedTouches);return he&(un|Oi)&&(je=Gr(je.concat(It),"identifier",!0)),[je,It]}var te={touchstart:gn,touchmove:Cn,touchend:un,touchcancel:Oi},Pe="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=Pe,this.targetIds={},ki.apply(this,arguments)}dt(nt,ki,{handler:function(he){var je=te[he.type],It=$t.call(this,he,je);!It||this.callback(this.manager,je,{pointers:It[0],changedPointers:It[1],pointerType:gt,srcEvent:he})}});function $t(K,he){var je=Or(K.touches),It=this.targetIds;if(he&(gn|Cn)&&je.length===1)return It[je[0].identifier]=!0,[je,je];var xr,an,yi=Or(K.changedTouches),ma=[],Ya=this.target;if(an=je.filter(function(Aa){return ut(Aa.target,Ya)}),he===gn)for(xr=0;xr<an.length;)It[an[xr].identifier]=!0,xr++;for(xr=0;xr<yi.length;)It[yi[xr].identifier]&&ma.push(yi[xr]),he&(un|Oi)&&delete It[yi[xr].identifier],xr++;if(!!ma.length)return[Gr(an.concat(ma),"identifier",!0),ma]}var lr=2500,pt=25;function er(){ki.apply(this,arguments);var K=Mr(this.handler,this);this.touch=new nt(this.manager,K),this.mouse=new wo(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}dt(er,ki,{handler:function(he,je,It){var xr=It.pointerType==gt,an=It.pointerType==Si;if(!(an&&It.sourceCapabilities&&It.sourceCapabilities.firesTouchEvents)){if(xr)Wr.call(this,je,It);else if(an&&Rt.call(this,It))return;this.callback(he,je,It)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Wr(K,he){K&gn?(this.primaryTouch=he.changedPointers[0].identifier,Rr.call(this,he)):K&(un|Oi)&&Rr.call(this,he)}function Rr(K){var he=K.changedPointers[0];if(he.identifier===this.primaryTouch){var je={x:he.clientX,y:he.clientY};this.lastTouches.push(je);var It=this.lastTouches,xr=function(){var an=It.indexOf(je);an>-1&&It.splice(an,1)};setTimeout(xr,lr)}}function Rt(K){for(var he=K.srcEvent.clientX,je=K.srcEvent.clientY,It=0;It<this.lastTouches.length;It++){var xr=this.lastTouches[It],an=Math.abs(he-xr.x),yi=Math.abs(je-xr.y);if(an<=pt&&yi<=pt)return!0}return!1}var Dr=Ee(me.style,"touchAction"),Ir=Dr!==Z,Pr="compute",Bn="auto",Lr="manipulation",Un="none",li="pan-x",Nn="pan-y",Pn=mi();function jn(K,he){this.manager=K,this.set(he)}jn.prototype={set:function(K){K==Pr&&(K=this.compute()),Ir&&this.manager.element.style&&Pn[K]&&(this.manager.element.style[Dr]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return Jt(this.manager.recognizers,function(he){cr(he.options.enable,[he])&&(K=K.concat(he.getTouchAction()))}),Ea(K.join(" "))},preventDefaults:function(K){var he=K.srcEvent,je=K.offsetDirection;if(this.manager.session.prevented){he.preventDefault();return}var It=this.actions,xr=Ye(It,Un)&&!Pn[Un],an=Ye(It,Nn)&&!Pn[Nn],yi=Ye(It,li)&&!Pn[li];if(xr){var ma=K.pointers.length===1,Ya=K.distance<2,Aa=K.deltaTime<250;if(ma&&Ya&&Aa)return}if(!(yi&&an)&&(xr||an&&je&Mi||yi&&je&Pi))return this.preventSrc(he)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function Ea(K){if(Ye(K,Un))return Un;var he=Ye(K,li),je=Ye(K,Nn);return he&&je?Un:he||je?he?li:Nn:Ye(K,Lr)?Lr:Bn}function mi(){if(!Ir)return!1;var K={},he=ve.CSS&&ve.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(je){K[je]=he?ve.CSS.supports("touch-action",je):!0}),K}var Li=1,Wn=2,zn=4,Jn=8,Qi=Jn,ys=16,Bi=32;function ea(K){this.options=Dt({},this.defaults,K||{}),this.id=ke(),this.manager=null,this.options.enable=Ft(this.options.enable,!0),this.state=Li,this.simultaneous={},this.requireFail=[]}ea.prototype={defaults:{},set:function(K){return Dt(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(M(K,"recognizeWith",this))return this;var he=this.simultaneous;return K=ji(K,this),he[K.id]||(he[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return M(K,"dropRecognizeWith",this)?this:(K=ji(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(M(K,"requireFailure",this))return this;var he=this.requireFail;return K=ji(K,this),ur(he,K)===-1&&(he.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(M(K,"dropRequireFailure",this))return this;K=ji(K,this);var he=ur(this.requireFail,K);return he>-1&&this.requireFail.splice(he,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var he=this,je=this.state;function It(xr){he.manager.emit(xr,K)}je<Jn&&It(he.options.event+ku(je)),It(he.options.event),K.additionalEvent&&It(K.additionalEvent),je>=Jn&&It(he.options.event+ku(je))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=Bi},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(Bi|Li)))return!1;K++}return!0},recognize:function(K){var he=Dt({},K);if(!cr(this.options.enable,[this,he])){this.reset(),this.state=Bi;return}this.state&(Qi|ys|Bi)&&(this.state=Li),this.state=this.process(he),this.state&(Wn|zn|Jn|ys)&&this.tryEmit(he)},process:function(K){},getTouchAction:function(){},reset:function(){}};function ku(K){return K&ys?"cancel":K&Jn?"end":K&zn?"move":K&Wn?"start":""}function qs(K){return K==lo?"down":K==Ti?"up":K==da?"left":K==sa?"right":""}function ji(K,he){var je=he.manager;return je?je.get(K):K}function Wa(){ea.apply(this,arguments)}dt(Wa,ea,{defaults:{pointers:1},attrTest:function(K){var he=this.options.pointers;return he===0||K.pointers.length===he},process:function(K){var he=this.state,je=K.eventType,It=he&(Wn|zn),xr=this.attrTest(K);return It&&(je&Oi||!xr)?he|ys:It||xr?je&un?he|Jn:he&Wn?he|zn:Wn:Bi}});function Ca(){Wa.apply(this,arguments),this.pX=null,this.pY=null}dt(Ca,Wa,{defaults:{event:"pan",threshold:10,pointers:1,direction:bo},getTouchAction:function(){var K=this.options.direction,he=[];return K&Mi&&he.push(Nn),K&Pi&&he.push(li),he},directionTest:function(K){var he=this.options,je=!0,It=K.distance,xr=K.direction,an=K.deltaX,yi=K.deltaY;return xr&he.direction||(he.direction&Mi?(xr=an===0?Ei:an<0?da:sa,je=an!=this.pX,It=Math.abs(K.deltaX)):(xr=yi===0?Ei:yi<0?Ti:lo,je=yi!=this.pY,It=Math.abs(K.deltaY))),K.direction=xr,je&&It>he.threshold&&xr&he.direction},attrTest:function(K){return Wa.prototype.attrTest.call(this,K)&&(this.state&Wn||!(this.state&Wn)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var he=qs(K.direction);he&&(K.additionalEvent=this.options.event+he),this._super.emit.call(this,K)}});function ua(){Wa.apply(this,arguments)}dt(ua,Wa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Un]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&Wn)},emit:function(K){if(K.scale!==1){var he=K.scale<1?"in":"out";K.additionalEvent=this.options.event+he}this._super.emit.call(this,K)}});function vo(){ea.apply(this,arguments),this._timer=null,this._input=null}dt(vo,ea,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Bn]},process:function(K){var he=this.options,je=K.pointers.length===he.pointers,It=K.distance<he.threshold,xr=K.deltaTime>he.time;if(this._input=K,!It||!je||K.eventType&(un|Oi)&&!xr)this.reset();else if(K.eventType&gn)this.reset(),this._timer=Oe(function(){this.state=Qi,this.tryEmit()},he.time,this);else if(K.eventType&un)return Qi;return Bi},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===Qi&&(K&&K.eventType&un?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=we(),this.manager.emit(this.options.event,this._input)))}});function wi(){Wa.apply(this,arguments)}dt(wi,Wa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Un]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&Wn)}});function mo(){Wa.apply(this,arguments)}dt(mo,Wa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mi|Pi,pointers:1},getTouchAction:function(){return Ca.prototype.getTouchAction.call(this)},attrTest:function(K){var he=this.options.direction,je;return he&(Mi|Pi)?je=K.overallVelocity:he&Mi?je=K.overallVelocityX:he&Pi&&(je=K.overallVelocityY),this._super.attrTest.call(this,K)&&he&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&Q(je)>this.options.velocity&&K.eventType&un},emit:function(K){var he=qs(K.offsetDirection);he&&this.manager.emit(this.options.event+he,K),this.manager.emit(this.options.event,K)}});function Xa(){ea.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}dt(Xa,ea,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Lr]},process:function(K){var he=this.options,je=K.pointers.length===he.pointers,It=K.distance<he.threshold,xr=K.deltaTime<he.time;if(this.reset(),K.eventType&gn&&this.count===0)return this.failTimeout();if(It&&xr&&je){if(K.eventType!=un)return this.failTimeout();var an=this.pTime?K.timeStamp-this.pTime<he.interval:!0,yi=!this.pCenter||ui(this.pCenter,K.center)<he.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!yi||!an?this.count=1:this.count+=1,this._input=K;var ma=this.count%he.taps;if(ma===0)return this.hasRequireFailures()?(this._timer=Oe(function(){this.state=Qi,this.tryEmit()},he.interval,this),Wn):Qi}return Bi},failTimeout:function(){return this._timer=Oe(function(){this.state=Bi},this.options.interval,this),Bi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Qi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function So(K,he){return he=he||{},he.recognizers=Ft(he.recognizers,So.defaults.preset),new Yo(K,he)}So.VERSION="2.0.7",So.defaults={domEvents:!1,touchAction:Pr,enable:!0,inputTarget:null,inputClass:null,preset:[[wi,{enable:!1}],[ua,{enable:!1},["rotate"]],[mo,{direction:Mi}],[Ca,{direction:Mi},["swipe"]],[Xa],[Xa,{event:"doubletap",taps:2},["tap"]],[vo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xo=1,Lc=2;function Yo(K,he){this.options=Dt({},So.defaults,he||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=Wo(this),this.touchAction=new jn(this,this.options.touchAction),Ta(this,!0),Jt(this.options.recognizers,function(je){var It=this.add(new je[0](je[1]));je[2]&&It.recognizeWith(je[2]),je[3]&&It.requireFailure(je[3])},this)}Yo.prototype={set:function(K){return Dt(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?Lc:Xo},recognize:function(K){var he=this.session;if(!he.stopped){this.touchAction.preventDefaults(K);var je,It=this.recognizers,xr=he.curRecognizer;(!xr||xr&&xr.state&Qi)&&(xr=he.curRecognizer=null);for(var an=0;an<It.length;)je=It[an],he.stopped!==Lc&&(!xr||je==xr||je.canRecognizeWith(xr))?je.recognize(K):je.reset(),!xr&&je.state&(Wn|zn|Jn)&&(xr=he.curRecognizer=je),an++}},get:function(K){if(K instanceof ea)return K;for(var he=this.recognizers,je=0;je<he.length;je++)if(he[je].options.event==K)return he[je];return null},add:function(K){if(M(K,"add",this))return this;var he=this.get(K.options.event);return he&&this.remove(he),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(M(K,"remove",this))return this;if(K=this.get(K),K){var he=this.recognizers,je=ur(he,K);je!==-1&&(he.splice(je,1),this.touchAction.update())}return this},on:function(K,he){if(K!==Z&&he!==Z){var je=this.handlers;return Jt(kt(K),function(It){je[It]=je[It]||[],je[It].push(he)}),this}},off:function(K,he){if(K!==Z){var je=this.handlers;return Jt(kt(K),function(It){he?je[It]&&je[It].splice(ur(je[It],he),1):delete je[It]}),this}},emit:function(K,he){this.options.domEvents&&va(K,he);var je=this.handlers[K]&&this.handlers[K].slice();if(!(!je||!je.length)){he.type=K,he.preventDefault=function(){he.srcEvent.preventDefault()};for(var It=0;It<je.length;)je[It](he),It++}},destroy:function(){this.element&&Ta(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ta(K,he){var je=K.element;if(!!je.style){var It;Jt(K.options.cssProps,function(xr,an){It=Ee(je.style,an),he?(K.oldCssProps[It]=je.style[It],je.style[It]=xr):je.style[It]=K.oldCssProps[It]||""}),he||(K.oldCssProps={})}}function va(K,he){var je=v.createEvent("Event");je.initEvent(K,!0,!0),je.gesture=he,he.target.dispatchEvent(je)}Dt(So,{INPUT_START:gn,INPUT_MOVE:Cn,INPUT_END:un,INPUT_CANCEL:Oi,STATE_POSSIBLE:Li,STATE_BEGAN:Wn,STATE_CHANGED:zn,STATE_ENDED:Jn,STATE_RECOGNIZED:Qi,STATE_CANCELLED:ys,STATE_FAILED:Bi,DIRECTION_NONE:Ei,DIRECTION_LEFT:da,DIRECTION_RIGHT:sa,DIRECTION_UP:Ti,DIRECTION_DOWN:lo,DIRECTION_HORIZONTAL:Mi,DIRECTION_VERTICAL:Pi,DIRECTION_ALL:bo,Manager:Yo,Input:ki,TouchAction:jn,TouchInput:nt,MouseInput:wo,PointerEventInput:U,TouchMouseInput:er,SingleTouchInput:Ze,Recognizer:ea,AttrRecognizer:Wa,Tap:Xa,Pan:Ca,Swipe:mo,Pinch:ua,Rotate:wi,Press:vo,on:st,off:He,each:Jt,merge:ct,extend:Ut,assign:Dt,inherit:dt,bindFn:Mr,prefixed:Ee});var Ri=typeof ve!="undefined"?ve:typeof self!="undefined"?self:{};Ri.Hammer=So,Me=function(){return So}.call(X,G,X,dr),Me!==Z&&(dr.exports=Me)})(window,document,"Hammer")},7375:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0});var G=Symbol.for("INJECTION");function Me(se,me,ae,fe){function Q(){return fe&&!Reflect.hasMetadata(G,this,me)&&Reflect.defineMetadata(G,ae(),this,me),Reflect.hasMetadata(G,this,me)?Reflect.getMetadata(G,this,me):ae()}function we(Oe){Reflect.defineMetadata(G,Oe,this,me)}Object.defineProperty(se,me,{configurable:!0,enumerable:!0,get:Q,set:we})}function ve(se,me){return function(ae){return function(fe,Q){var we=function(){return se.get(ae)};Me(fe,Q,we,me)}}}X.makePropertyInjectDecorator=ve;function v(se,me){return function(ae,fe){return function(Q,we){var Oe=function(){return se.getNamed(ae,fe)};Me(Q,we,Oe,me)}}}X.makePropertyInjectNamedDecorator=v;function be(se,me){return function(ae,fe,Q){return function(we,Oe){var M=function(){return se.getTagged(ae,fe,Q)};Me(we,Oe,M,me)}}}X.makePropertyInjectTaggedDecorator=be;function Z(se,me){return function(ae){return function(fe,Q){var we=function(){return se.getAll(ae)};Me(fe,Q,we,me)}}}X.makePropertyMultiInjectDecorator=Z},84879:function(dr,X,G){"use strict";var Me;Me={value:!0};var ve=G(7375);function v(be,Z){Z===void 0&&(Z=!0);var se=ve.makePropertyInjectDecorator(be,Z),me=ve.makePropertyInjectNamedDecorator(be,Z),ae=ve.makePropertyInjectTaggedDecorator(be,Z),fe=ve.makePropertyMultiInjectDecorator(be,Z);return{lazyInject:se,lazyInjectNamed:me,lazyInjectTagged:ae,lazyMultiInject:fe}}X.Z=v},99934:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.tagProperty=X.tagParameter=X.decorate=void 0;var Me=G(16674),ve=G(6867);function v(fe,Q,we,Oe){var M=ve.TAGGED;Z(M,fe,Q,Oe,we)}X.tagParameter=v;function be(fe,Q,we){var Oe=ve.TAGGED_PROP;Z(Oe,fe.constructor,Q,we)}X.tagProperty=be;function Z(fe,Q,we,Oe,M){var Jt={},Gt=typeof M=="number",Dt=M!==void 0&&Gt?M.toString():we;if(Gt&&we!==void 0)throw new Error(Me.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(fe,Q)&&(Jt=Reflect.getMetadata(fe,Q));var Ut=Jt[Dt];if(!Array.isArray(Ut))Ut=[];else for(var ct=0,dt=Ut;ct<dt.length;ct++){var Mr=dt[ct];if(Mr.key===Oe.key)throw new Error(Me.DUPLICATED_METADATA+" "+Mr.key.toString())}Ut.push(Oe),Jt[Dt]=Ut,Reflect.defineMetadata(fe,Jt,Q)}function se(fe,Q){Reflect.decorate(fe,Q)}function me(fe,Q){return function(we,Oe){Q(we,Oe,fe)}}function ae(fe,Q,we){typeof we=="number"?se([me(we,fe)],Q):typeof we=="string"?Reflect.decorate([fe],Q,we):se([fe],Q)}X.decorate=ae},5744:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.inject=X.LazyServiceIdentifer=void 0;var Me=G(16674),ve=G(6867),v=G(47738),be=G(99934),Z=function(){function me(ae){this._cb=ae}return me.prototype.unwrap=function(){return this._cb()},me}();X.LazyServiceIdentifer=Z;function se(me){return function(ae,fe,Q){if(me===void 0)throw new Error(Me.UNDEFINED_INJECT_ANNOTATION(ae.name));var we=new v.Metadata(ve.INJECT_TAG,me);typeof Q=="number"?be.tagParameter(ae,fe,Q,we):be.tagProperty(ae,fe,we)}}X.inject=se},64315:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.injectable=void 0;var Me=G(16674),ve=G(6867);function v(){return function(be){if(Reflect.hasOwnMetadata(ve.PARAM_TYPES,be))throw new Error(Me.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(ve.DESIGN_PARAM_TYPES,be)||[];return Reflect.defineMetadata(ve.PARAM_TYPES,Z,be),be}}X.injectable=v},71693:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.multiInject=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function be(Z){return function(se,me,ae){var fe=new ve.Metadata(Me.MULTI_INJECT_TAG,Z);typeof ae=="number"?v.tagParameter(se,me,ae,fe):v.tagProperty(se,me,fe)}}X.multiInject=be},38085:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.named=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function be(Z){return function(se,me,ae){var fe=new ve.Metadata(Me.NAMED_TAG,Z);typeof ae=="number"?v.tagParameter(se,me,ae,fe):v.tagProperty(se,me,fe)}}X.named=be},6515:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.optional=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function be(){return function(Z,se,me){var ae=new ve.Metadata(Me.OPTIONAL_TAG,!0);typeof me=="number"?v.tagParameter(Z,se,me,ae):v.tagProperty(Z,se,ae)}}X.optional=be},7014:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.postConstruct=void 0;var Me=G(16674),ve=G(6867),v=G(47738);function be(){return function(Z,se,me){var ae=new v.Metadata(ve.POST_CONSTRUCT,se);if(Reflect.hasOwnMetadata(ve.POST_CONSTRUCT,Z.constructor))throw new Error(Me.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ve.POST_CONSTRUCT,ae,Z.constructor)}}X.postConstruct=be},32052:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.tagged=void 0;var Me=G(47738),ve=G(99934);function v(be,Z){return function(se,me,ae){var fe=new Me.Metadata(be,Z);typeof ae=="number"?ve.tagParameter(se,me,ae,fe):ve.tagProperty(se,me,fe)}}X.tagged=v},55638:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.targetName=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function be(Z){return function(se,me,ae){var fe=new ve.Metadata(Me.NAME_TAG,Z);v.tagParameter(se,me,ae,fe)}}X.targetName=be},86757:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.unmanaged=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function be(){return function(Z,se,me){var ae=new ve.Metadata(Me.UNMANAGED_TAG,!0);v.tagParameter(Z,se,me,ae)}}X.unmanaged=be},44290:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Binding=void 0;var Me=G(28421),ve=G(37791),v=function(){function be(Z,se){this.id=ve.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=se,this.type=Me.BindingTypeEnum.Invalid,this.constraint=function(me){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return be.prototype.clone=function(){var Z=new be(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===Me.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},be}();X.Binding=v},23184:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingCount=void 0;var G={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};X.BindingCount=G},16674:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.STACK_OVERFLOW=X.CIRCULAR_DEPENDENCY_IN_FACTORY=X.POST_CONSTRUCT_ERROR=X.MULTIPLE_POST_CONSTRUCT_METHODS=X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=X.ARGUMENTS_LENGTH_MISMATCH=X.INVALID_DECORATOR_OPERATION=X.INVALID_TO_SELF_VALUE=X.INVALID_FUNCTION_BINDING=X.INVALID_MIDDLEWARE_RETURN=X.NO_MORE_SNAPSHOTS_AVAILABLE=X.INVALID_BINDING_TYPE=X.NOT_IMPLEMENTED=X.CIRCULAR_DEPENDENCY=X.UNDEFINED_INJECT_ANNOTATION=X.MISSING_INJECT_ANNOTATION=X.MISSING_INJECTABLE_ANNOTATION=X.NOT_REGISTERED=X.CANNOT_UNBIND=X.AMBIGUOUS_MATCH=X.KEY_NOT_FOUND=X.NULL_ARGUMENT=X.DUPLICATED_METADATA=X.DUPLICATED_INJECTABLE_DECORATOR=void 0,X.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",X.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",X.NULL_ARGUMENT="NULL argument",X.KEY_NOT_FOUND="Key Not Found",X.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",X.CANNOT_UNBIND="Could not unbind serviceIdentifier:",X.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",X.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",X.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var G=function(be){return"@inject called with undefined this could mean that the class "+be+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};X.UNDEFINED_INJECT_ANNOTATION=G,X.CIRCULAR_DEPENDENCY="Circular dependency found:",X.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",X.INVALID_BINDING_TYPE="Invalid binding type:",X.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",X.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",X.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",X.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",X.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Me=function(){for(var be=[],Z=0;Z<arguments.length;Z++)be[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(be[0]+" must be >= than the number of constructor arguments of its base class.")};X.ARGUMENTS_LENGTH_MISMATCH=Me,X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",X.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ve=function(){for(var be=[],Z=0;Z<arguments.length;Z++)be[Z]=arguments[Z];return"@postConstruct error in class "+be[0]+": "+be[1]};X.POST_CONSTRUCT_ERROR=ve;var v=function(){for(var be=[],Z=0;Z<arguments.length;Z++)be[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+be[0]+"' bindings. Please investigate bindings with")+("service identifier '"+be[1]+"'.")};X.CIRCULAR_DEPENDENCY_IN_FACTORY=v,X.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.TargetTypeEnum=X.BindingTypeEnum=X.BindingScopeEnum=void 0;var G={Request:"Request",Singleton:"Singleton",Transient:"Transient"};X.BindingScopeEnum=G;var Me={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};X.BindingTypeEnum=Me;var ve={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};X.TargetTypeEnum=ve},6867:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NON_CUSTOM_TAG_KEYS=X.POST_CONSTRUCT=X.DESIGN_PARAM_TYPES=X.PARAM_TYPES=X.TAGGED_PROP=X.TAGGED=X.MULTI_INJECT_TAG=X.INJECT_TAG=X.OPTIONAL_TAG=X.UNMANAGED_TAG=X.NAME_TAG=X.NAMED_TAG=void 0,X.NAMED_TAG="named",X.NAME_TAG="name",X.UNMANAGED_TAG="unmanaged",X.OPTIONAL_TAG="optional",X.INJECT_TAG="inject",X.MULTI_INJECT_TAG="multi_inject",X.TAGGED="inversify:tagged",X.TAGGED_PROP="inversify:tagged_props",X.PARAM_TYPES="inversify:paramtypes",X.DESIGN_PARAM_TYPES="design:paramtypes",X.POST_CONSTRUCT="post_construct";function G(){return[X.INJECT_TAG,X.MULTI_INJECT_TAG,X.NAME_TAG,X.UNMANAGED_TAG,X.NAMED_TAG,X.OPTIONAL_TAG]}X.NON_CUSTOM_TAG_KEYS=G()},51389:function(dr,X,G){"use strict";var Me=this&&this.__awaiter||function(Ut,ct,dt,Mr){function cr(Ft){return Ft instanceof dt?Ft:new dt(function(st){st(Ft)})}return new(dt||(dt=Promise))(function(Ft,st){function He(kt){try{Ye(Mr.next(kt))}catch(ur){st(ur)}}function ut(kt){try{Ye(Mr.throw(kt))}catch(ur){st(ur)}}function Ye(kt){kt.done?Ft(kt.value):cr(kt.value).then(He,ut)}Ye((Mr=Mr.apply(Ut,ct||[])).next())})},ve=this&&this.__generator||function(Ut,ct){var dt={label:0,sent:function(){if(Ft[0]&1)throw Ft[1];return Ft[1]},trys:[],ops:[]},Mr,cr,Ft,st;return st={next:He(0),throw:He(1),return:He(2)},typeof Symbol=="function"&&(st[Symbol.iterator]=function(){return this}),st;function He(Ye){return function(kt){return ut([Ye,kt])}}function ut(Ye){if(Mr)throw new TypeError("Generator is already executing.");for(;dt;)try{if(Mr=1,cr&&(Ft=Ye[0]&2?cr.return:Ye[0]?cr.throw||((Ft=cr.return)&&Ft.call(cr),0):cr.next)&&!(Ft=Ft.call(cr,Ye[1])).done)return Ft;switch(cr=0,Ft&&(Ye=[Ye[0]&2,Ft.value]),Ye[0]){case 0:case 1:Ft=Ye;break;case 4:return dt.label++,{value:Ye[1],done:!1};case 5:dt.label++,cr=Ye[1],Ye=[0];continue;case 7:Ye=dt.ops.pop(),dt.trys.pop();continue;default:if(Ft=dt.trys,!(Ft=Ft.length>0&&Ft[Ft.length-1])&&(Ye[0]===6||Ye[0]===2)){dt=0;continue}if(Ye[0]===3&&(!Ft||Ye[1]>Ft[0]&&Ye[1]<Ft[3])){dt.label=Ye[1];break}if(Ye[0]===6&&dt.label<Ft[1]){dt.label=Ft[1],Ft=Ye;break}if(Ft&&dt.label<Ft[2]){dt.label=Ft[2],dt.ops.push(Ye);break}Ft[2]&&dt.ops.pop(),dt.trys.pop();continue}Ye=ct.call(Ut,dt)}catch(kt){Ye=[6,kt],cr=0}finally{Mr=Ft=0}if(Ye[0]&5)throw Ye[1];return{value:Ye[0]?Ye[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(Ut,ct){for(var dt=0,Mr=ct.length,cr=Ut.length;dt<Mr;dt++,cr++)Ut[cr]=ct[dt];return Ut};Object.defineProperty(X,"__esModule",{value:!0}),X.Container=void 0;var be=G(44290),Z=G(16674),se=G(28421),me=G(6867),ae=G(51377),fe=G(86311),Q=G(31927),we=G(15451),Oe=G(37791),M=G(55800),Jt=G(85700),Gt=G(80175),Dt=function(){function Ut(ct){this._appliedMiddleware=[];var dt=ct||{};if(typeof dt!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=se.BindingScopeEnum.Transient;else if(dt.defaultScope!==se.BindingScopeEnum.Singleton&&dt.defaultScope!==se.BindingScopeEnum.Transient&&dt.defaultScope!==se.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=Oe.id(),this._bindingDictionary=new Gt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ae.MetadataReader}return Ut.merge=function(ct,dt){for(var Mr=[],cr=2;cr<arguments.length;cr++)Mr[cr-2]=arguments[cr];var Ft=new Ut,st=v([ct,dt],Mr).map(function(Ye){return fe.getBindingDictionary(Ye)}),He=fe.getBindingDictionary(Ft);function ut(Ye,kt){Ye.traverse(function(ur,Or){Or.forEach(function(Gr){kt.add(Gr.serviceIdentifier,Gr.clone())})})}return st.forEach(function(Ye){ut(Ye,He)}),Ft},Ut.prototype.load=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];for(var Mr=this._getContainerModuleHelpersFactory(),cr=0,Ft=ct;cr<Ft.length;cr++){var st=Ft[cr],He=Mr(st.id);st.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)}},Ut.prototype.loadAsync=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];return Me(this,void 0,void 0,function(){var Mr,cr,Ft,st,He;return ve(this,function(ut){switch(ut.label){case 0:Mr=this._getContainerModuleHelpersFactory(),cr=0,Ft=ct,ut.label=1;case 1:return cr<Ft.length?(st=Ft[cr],He=Mr(st.id),[4,st.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)]):[3,4];case 2:ut.sent(),ut.label=3;case 3:return cr++,[3,1];case 4:return[2]}})})},Ut.prototype.unload=function(){for(var ct=this,dt=[],Mr=0;Mr<arguments.length;Mr++)dt[Mr]=arguments[Mr];var cr=function(Ft){return function(st){return st.moduleId===Ft}};dt.forEach(function(Ft){var st=cr(Ft.id);ct._bindingDictionary.removeByCondition(st)})},Ut.prototype.bind=function(ct){var dt=this.options.defaultScope||se.BindingScopeEnum.Transient,Mr=new be.Binding(ct,dt);return this._bindingDictionary.add(ct,Mr),new we.BindingToSyntax(Mr)},Ut.prototype.rebind=function(ct){return this.unbind(ct),this.bind(ct)},Ut.prototype.unbind=function(ct){try{this._bindingDictionary.remove(ct)}catch(dt){throw new Error(Z.CANNOT_UNBIND+" "+M.getServiceIdentifierAsString(ct))}},Ut.prototype.unbindAll=function(){this._bindingDictionary=new Gt.Lookup},Ut.prototype.isBound=function(ct){var dt=this._bindingDictionary.hasKey(ct);return!dt&&this.parent&&(dt=this.parent.isBound(ct)),dt},Ut.prototype.isBoundNamed=function(ct,dt){return this.isBoundTagged(ct,me.NAMED_TAG,dt)},Ut.prototype.isBoundTagged=function(ct,dt,Mr){var cr=!1;if(this._bindingDictionary.hasKey(ct)){var Ft=this._bindingDictionary.get(ct),st=fe.createMockRequest(this,ct,dt,Mr);cr=Ft.some(function(He){return He.constraint(st)})}return!cr&&this.parent&&(cr=this.parent.isBoundTagged(ct,dt,Mr)),cr},Ut.prototype.snapshot=function(){this._snapshots.push(Jt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ut.prototype.restore=function(){var ct=this._snapshots.pop();if(ct===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ct.bindings,this._middleware=ct.middleware},Ut.prototype.createChild=function(ct){var dt=new Ut(ct||this.options);return dt.parent=this,dt},Ut.prototype.applyMiddleware=function(){for(var ct=[],dt=0;dt<arguments.length;dt++)ct[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(ct);var Mr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ct.reduce(function(cr,Ft){return Ft(cr)},Mr)},Ut.prototype.applyCustomMetadataReader=function(ct){this._metadataReader=ct},Ut.prototype.get=function(ct){return this._get(!1,!1,se.TargetTypeEnum.Variable,ct)},Ut.prototype.getTagged=function(ct,dt,Mr){return this._get(!1,!1,se.TargetTypeEnum.Variable,ct,dt,Mr)},Ut.prototype.getNamed=function(ct,dt){return this.getTagged(ct,me.NAMED_TAG,dt)},Ut.prototype.getAll=function(ct){return this._get(!0,!0,se.TargetTypeEnum.Variable,ct)},Ut.prototype.getAllTagged=function(ct,dt,Mr){return this._get(!1,!0,se.TargetTypeEnum.Variable,ct,dt,Mr)},Ut.prototype.getAllNamed=function(ct,dt){return this.getAllTagged(ct,me.NAMED_TAG,dt)},Ut.prototype.resolve=function(ct){var dt=this.createChild();return dt.bind(ct).toSelf(),this._appliedMiddleware.forEach(function(Mr){dt.applyMiddleware(Mr)}),dt.get(ct)},Ut.prototype._getContainerModuleHelpersFactory=function(){var ct=this,dt=function(He,ut){He._binding.moduleId=ut},Mr=function(He){return function(ut){var Ye=ct.bind.bind(ct),kt=Ye(ut);return dt(kt,He),kt}},cr=function(He){return function(ut){var Ye=ct.unbind.bind(ct);Ye(ut)}},Ft=function(He){return function(ut){var Ye=ct.isBound.bind(ct);return Ye(ut)}},st=function(He){return function(ut){var Ye=ct.rebind.bind(ct),kt=Ye(ut);return dt(kt,He),kt}};return function(He){return{bindFunction:Mr(He),isboundFunction:Ft(He),rebindFunction:st(He),unbindFunction:cr(He)}}},Ut.prototype._get=function(ct,dt,Mr,cr,Ft,st){var He=null,ut={avoidConstraints:ct,contextInterceptor:function(Ye){return Ye},isMultiInject:dt,key:Ft,serviceIdentifier:cr,targetType:Mr,value:st};if(this._middleware){if(He=this._middleware(ut),He==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else He=this._planAndResolve()(ut);return He},Ut.prototype._planAndResolve=function(){var ct=this;return function(dt){var Mr=fe.plan(ct._metadataReader,ct,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);Mr=dt.contextInterceptor(Mr);var cr=Q.resolve(Mr);return cr}},Ut}();X.Container=Dt},33244:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.AsyncContainerModule=X.ContainerModule=void 0;var Me=G(37791),ve=function(){function be(Z){this.id=Me.id(),this.registry=Z}return be}();X.ContainerModule=ve;var v=function(){function be(Z){this.id=Me.id(),this.registry=Z}return be}();X.AsyncContainerModule=v},85700:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ContainerSnapshot=void 0;var G=function(){function Me(){}return Me.of=function(ve,v){var be=new Me;return be.bindings=ve,be.middleware=v,be},Me}();X.ContainerSnapshot=G},80175:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Lookup=void 0;var Me=G(16674),ve=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(be,Z){if(be==null)throw new Error(Me.NULL_ARGUMENT);if(Z==null)throw new Error(Me.NULL_ARGUMENT);var se=this._map.get(be);se!==void 0?(se.push(Z),this._map.set(be,se)):this._map.set(be,[Z])},v.prototype.get=function(be){if(be==null)throw new Error(Me.NULL_ARGUMENT);var Z=this._map.get(be);if(Z!==void 0)return Z;throw new Error(Me.KEY_NOT_FOUND)},v.prototype.remove=function(be){if(be==null)throw new Error(Me.NULL_ARGUMENT);if(!this._map.delete(be))throw new Error(Me.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(be){var Z=this;this._map.forEach(function(se,me){var ae=se.filter(function(fe){return!be(fe)});ae.length>0?Z._map.set(me,ae):Z._map.delete(me)})},v.prototype.hasKey=function(be){if(be==null)throw new Error(Me.NULL_ARGUMENT);return this._map.has(be)},v.prototype.clone=function(){var be=new v;return this._map.forEach(function(Z,se){Z.forEach(function(me){return be.add(se,me.clone())})}),be},v.prototype.traverse=function(be){this._map.forEach(function(Z,se){be(se,Z)})},v}();X.Lookup=ve},86700:function(dr,X,G){"use strict";var Me;Me={value:!0},Me=Me=Me=Me=Me=Me=X.GW=Me=Me=X.zY=Me=Me=Me=Me=Me=X.f3=Me=Me=X.b2=Me=Me=Me=Me=Me=X.W2=Me=void 0;var ve=G(6867);Me=ve;var v=G(51389);Object.defineProperty(X,"W2",{enumerable:!0,get:function(){return v.Container}});var be=G(28421);Me={enumerable:!0,get:function(){return be.BindingScopeEnum}},Me={enumerable:!0,get:function(){return be.BindingTypeEnum}},Me={enumerable:!0,get:function(){return be.TargetTypeEnum}};var Z=G(33244);Me={enumerable:!0,get:function(){return Z.AsyncContainerModule}},Me={enumerable:!0,get:function(){return Z.ContainerModule}};var se=G(64315);Object.defineProperty(X,"b2",{enumerable:!0,get:function(){return se.injectable}});var me=G(32052);Me={enumerable:!0,get:function(){return me.tagged}};var ae=G(38085);Me={enumerable:!0,get:function(){return ae.named}};var fe=G(5744);Object.defineProperty(X,"f3",{enumerable:!0,get:function(){return fe.inject}}),Me={enumerable:!0,get:function(){return fe.LazyServiceIdentifer}};var Q=G(6515);Me={enumerable:!0,get:function(){return Q.optional}};var we=G(86757);Me={enumerable:!0,get:function(){return we.unmanaged}};var Oe=G(71693);Me={enumerable:!0,get:function(){return Oe.multiInject}};var M=G(55638);Me={enumerable:!0,get:function(){return M.targetName}};var Jt=G(7014);Object.defineProperty(X,"zY",{enumerable:!0,get:function(){return Jt.postConstruct}});var Gt=G(51377);Me={enumerable:!0,get:function(){return Gt.MetadataReader}};var Dt=G(37791);Me={enumerable:!0,get:function(){return Dt.id}};var Ut=G(99934);Object.defineProperty(X,"GW",{enumerable:!0,get:function(){return Ut.decorate}});var ct=G(80758);Me={enumerable:!0,get:function(){return ct.traverseAncerstors}},Me={enumerable:!0,get:function(){return ct.taggedConstraint}},Me={enumerable:!0,get:function(){return ct.namedConstraint}},Me={enumerable:!0,get:function(){return ct.typeConstraint}};var dt=G(55800);Me={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var Mr=G(70600);Me={enumerable:!0,get:function(){return Mr.multiBindToService}}},95228:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Context=void 0;var Me=G(37791),ve=function(){function v(be){this.id=Me.id(),this.container=be}return v.prototype.addPlan=function(be){this.plan=be},v.prototype.setCurrentRequest=function(be){this.currentRequest=be},v}();X.Context=ve},47738:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Metadata=void 0;var Me=G(6867),ve=function(){function v(be,Z){this.key=be,this.value=Z}return v.prototype.toString=function(){return this.key===Me.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();X.Metadata=ve},51377:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.MetadataReader=void 0;var Me=G(6867),ve=function(){function v(){}return v.prototype.getConstructorMetadata=function(be){var Z=Reflect.getMetadata(Me.PARAM_TYPES,be),se=Reflect.getMetadata(Me.TAGGED,be);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:se||{}}},v.prototype.getPropertiesMetadata=function(be){var Z=Reflect.getMetadata(Me.TAGGED_PROP,be)||[];return Z},v}();X.MetadataReader=ve},55314:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Plan=void 0;var G=function(){function Me(ve,v){this.parentContext=ve,this.rootRequest=v}return Me}();X.Plan=G},86311:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getBindingDictionary=X.createMockRequest=X.plan=void 0;var Me=G(23184),ve=G(16674),v=G(28421),be=G(6867),Z=G(85265),se=G(55800),me=G(95228),ae=G(47738),fe=G(55314),Q=G(6e3),we=G(6748),Oe=G(18924);function M(cr){return cr._bindingDictionary}X.getBindingDictionary=M;function Jt(cr,Ft,st,He,ut,Ye){var kt=cr?be.MULTI_INJECT_TAG:be.INJECT_TAG,ur=new ae.Metadata(kt,st),Or=new Oe.Target(Ft,He,st,ur);if(ut!==void 0){var Gr=new ae.Metadata(ut,Ye);Or.metadata.push(Gr)}return Or}function Gt(cr,Ft,st,He,ut){var Ye=ct(st.container,ut.serviceIdentifier),kt=[];return Ye.length===Me.BindingCount.NoBindingsAvailable&&st.container.options.autoBindInjectable&&typeof ut.serviceIdentifier=="function"&&cr.getConstructorMetadata(ut.serviceIdentifier).compilerGeneratedMetadata&&(st.container.bind(ut.serviceIdentifier).toSelf(),Ye=ct(st.container,ut.serviceIdentifier)),Ft?kt=Ye:kt=Ye.filter(function(ur){var Or=new we.Request(ur.serviceIdentifier,st,He,ur,ut);return ur.constraint(Or)}),Dt(ut.serviceIdentifier,kt,ut,st.container),kt}function Dt(cr,Ft,st,He){switch(Ft.length){case Me.BindingCount.NoBindingsAvailable:if(st.isOptional())return Ft;var ut=se.getServiceIdentifierAsString(cr),Ye=ve.NOT_REGISTERED;throw Ye+=se.listMetadataForTarget(ut,st),Ye+=se.listRegisteredBindingsForServiceIdentifier(He,ut,ct),new Error(Ye);case Me.BindingCount.OnlyOneBindingAvailable:if(!st.isArray())return Ft;case Me.BindingCount.MultipleBindingsAvailable:default:if(st.isArray())return Ft;var ut=se.getServiceIdentifierAsString(cr),Ye=ve.AMBIGUOUS_MATCH+" "+ut;throw Ye+=se.listRegisteredBindingsForServiceIdentifier(He,ut,ct),new Error(Ye)}}function Ut(cr,Ft,st,He,ut,Ye){var kt,ur;if(ut===null){kt=Gt(cr,Ft,He,null,Ye),ur=new we.Request(st,He,null,kt,Ye);var Or=new fe.Plan(He,ur);He.addPlan(Or)}else kt=Gt(cr,Ft,He,ut,Ye),ur=ut.addChildRequest(Ye.serviceIdentifier,kt,Ye);kt.forEach(function(Gr){var Ee=null;if(Ye.isArray())Ee=ur.addChildRequest(Gr.serviceIdentifier,Gr,Ye);else{if(Gr.cache)return;Ee=ur}if(Gr.type===v.BindingTypeEnum.Instance&&Gr.implementationType!==null){var Ve=Q.getDependencies(cr,Gr.implementationType);if(!He.container.options.skipBaseClassChecks){var ke=Q.getBaseClassDependencyCount(cr,Gr.implementationType);if(Ve.length<ke){var vt=ve.ARGUMENTS_LENGTH_MISMATCH(Q.getFunctionName(Gr.implementationType));throw new Error(vt)}}Ve.forEach(function(qe){Ut(cr,!1,qe.serviceIdentifier,He,Ee,qe)})}})}function ct(cr,Ft){var st=[],He=M(cr);return He.hasKey(Ft)?st=He.get(Ft):cr.parent!==null&&(st=ct(cr.parent,Ft)),st}function dt(cr,Ft,st,He,ut,Ye,kt,ur){ur===void 0&&(ur=!1);var Or=new me.Context(Ft),Gr=Jt(st,He,ut,"",Ye,kt);try{return Ut(cr,ur,ut,Or,null,Gr),Or}catch(Ee){throw Z.isStackOverflowExeption(Ee)&&Or.plan&&se.circularDependencyToException(Or.plan.rootRequest),Ee}}X.plan=dt;function Mr(cr,Ft,st,He){var ut=new Oe.Target(v.TargetTypeEnum.Variable,"",Ft,new ae.Metadata(st,He)),Ye=new me.Context(cr),kt=new we.Request(Ft,Ye,null,[],ut);return kt}X.createMockRequest=Mr},88460:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.QueryableString=void 0;var G=function(){function Me(ve){this.str=ve}return Me.prototype.startsWith=function(ve){return this.str.indexOf(ve)===0},Me.prototype.endsWith=function(ve){var v="",be=ve.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},be)},Me.prototype.contains=function(ve){return this.str.indexOf(ve)!==-1},Me.prototype.equals=function(ve){return this.str===ve},Me.prototype.value=function(){return this.str},Me}();X.QueryableString=G},6e3:function(dr,X,G){"use strict";var Me=this&&this.__spreadArray||function(Gt,Dt){for(var Ut=0,ct=Dt.length,dt=Gt.length;Ut<ct;Ut++,dt++)Gt[dt]=Dt[Ut];return Gt};Object.defineProperty(X,"__esModule",{value:!0}),X.getFunctionName=X.getBaseClassDependencyCount=X.getDependencies=void 0;var ve=G(5744),v=G(16674),be=G(28421),Z=G(6867),se=G(55800);Object.defineProperty(X,"getFunctionName",{enumerable:!0,get:function(){return se.getFunctionName}});var me=G(18924);function ae(Gt,Dt){var Ut=se.getFunctionName(Dt),ct=fe(Gt,Ut,Dt,!1);return ct}X.getDependencies=ae;function fe(Gt,Dt,Ut,ct){var dt=Gt.getConstructorMetadata(Ut),Mr=dt.compilerGeneratedMetadata;if(Mr===void 0){var cr=v.MISSING_INJECTABLE_ANNOTATION+" "+Dt+".";throw new Error(cr)}var Ft=dt.userGeneratedMetadata,st=Object.keys(Ft),He=Ut.length===0&&st.length>0,ut=st.length>Ut.length,Ye=He||ut?st.length:Ut.length,kt=we(ct,Dt,Mr,Ft,Ye),ur=Oe(Gt,Ut),Or=Me(Me([],kt),ur);return Or}function Q(Gt,Dt,Ut,ct,dt){var Mr=dt[Gt.toString()]||[],cr=Jt(Mr),Ft=cr.unmanaged!==!0,st=ct[Gt],He=cr.inject||cr.multiInject;if(st=He||st,st instanceof ve.LazyServiceIdentifer&&(st=st.unwrap()),Ft){var ut=st===Object,Ye=st===Function,kt=st===void 0,ur=ut||Ye||kt;if(!Dt&&ur){var Or=v.MISSING_INJECT_ANNOTATION+" argument "+Gt+" in class "+Ut+".";throw new Error(Or)}var Gr=new me.Target(be.TargetTypeEnum.ConstructorArgument,cr.targetName,st);return Gr.metadata=Mr,Gr}return null}function we(Gt,Dt,Ut,ct,dt){for(var Mr=[],cr=0;cr<dt;cr++){var Ft=cr,st=Q(Ft,Gt,Dt,Ut,ct);st!==null&&Mr.push(st)}return Mr}function Oe(Gt,Dt){for(var Ut=Gt.getPropertiesMetadata(Dt),ct=[],dt=Object.keys(Ut),Mr=0,cr=dt;Mr<cr.length;Mr++){var Ft=cr[Mr],st=Ut[Ft],He=Jt(Ut[Ft]),ut=He.targetName||Ft,Ye=He.inject||He.multiInject,kt=new me.Target(be.TargetTypeEnum.ClassProperty,ut,Ye);kt.metadata=st,ct.push(kt)}var ur=Object.getPrototypeOf(Dt.prototype).constructor;if(ur!==Object){var Or=Oe(Gt,ur);ct=Me(Me([],ct),Or)}return ct}function M(Gt,Dt){var Ut=Object.getPrototypeOf(Dt.prototype).constructor;if(Ut!==Object){var ct=se.getFunctionName(Ut),dt=fe(Gt,ct,Ut,!0),Mr=dt.map(function(st){return st.metadata.filter(function(He){return He.key===Z.UNMANAGED_TAG})}),cr=[].concat.apply([],Mr).length,Ft=dt.length-cr;return Ft>0?Ft:M(Gt,Ut)}else return 0}X.getBaseClassDependencyCount=M;function Jt(Gt){var Dt={};return Gt.forEach(function(Ut){Dt[Ut.key.toString()]=Ut.value}),{inject:Dt[Z.INJECT_TAG],multiInject:Dt[Z.MULTI_INJECT_TAG],targetName:Dt[Z.NAME_TAG],unmanaged:Dt[Z.UNMANAGED_TAG]}}},6748:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Request=void 0;var Me=G(37791),ve=function(){function v(be,Z,se,me,ae){this.id=Me.id(),this.serviceIdentifier=be,this.parentContext=Z,this.parentRequest=se,this.target=ae,this.childRequests=[],this.bindings=Array.isArray(me)?me:[me],this.requestScope=se===null?new Map:null}return v.prototype.addChildRequest=function(be,Z,se){var me=new v(be,this.parentContext,this,Z,se);return this.childRequests.push(me),me},v}();X.Request=ve},18924:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Target=void 0;var Me=G(6867),ve=G(37791),v=G(47738),be=G(88460),Z=function(){function se(me,ae,fe,Q){this.id=ve.id(),this.type=me,this.serviceIdentifier=fe,this.name=new be.QueryableString(ae||""),this.metadata=new Array;var we=null;typeof Q=="string"?we=new v.Metadata(Me.NAMED_TAG,Q):Q instanceof v.Metadata&&(we=Q),we!==null&&this.metadata.push(we)}return se.prototype.hasTag=function(me){for(var ae=0,fe=this.metadata;ae<fe.length;ae++){var Q=fe[ae];if(Q.key===me)return!0}return!1},se.prototype.isArray=function(){return this.hasTag(Me.MULTI_INJECT_TAG)},se.prototype.matchesArray=function(me){return this.matchesTag(Me.MULTI_INJECT_TAG)(me)},se.prototype.isNamed=function(){return this.hasTag(Me.NAMED_TAG)},se.prototype.isTagged=function(){return this.metadata.some(function(me){return Me.NON_CUSTOM_TAG_KEYS.every(function(ae){return me.key!==ae})})},se.prototype.isOptional=function(){return this.matchesTag(Me.OPTIONAL_TAG)(!0)},se.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(me){return me.key===Me.NAMED_TAG})[0]:null},se.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(me){return Me.NON_CUSTOM_TAG_KEYS.every(function(ae){return me.key!==ae})}):null},se.prototype.matchesNamedTag=function(me){return this.matchesTag(Me.NAMED_TAG)(me)},se.prototype.matchesTag=function(me){var ae=this;return function(fe){for(var Q=0,we=ae.metadata;Q<we.length;Q++){var Oe=we[Q];if(Oe.key===me&&Oe.value===fe)return!0}return!1}},se}();X.Target=Z},52279:function(dr,X,G){"use strict";var Me=this&&this.__spreadArray||function(fe,Q){for(var we=0,Oe=Q.length,M=fe.length;we<Oe;we++,M++)fe[M]=Q[we];return fe};Object.defineProperty(X,"__esModule",{value:!0}),X.resolveInstance=void 0;var ve=G(16674),v=G(28421),be=G(6867);function Z(fe,Q,we){var Oe=Q.filter(function(Jt){return Jt.target!==null&&Jt.target.type===v.TargetTypeEnum.ClassProperty}),M=Oe.map(we);return Oe.forEach(function(Jt,Gt){var Dt="";Dt=Jt.target.name.value();var Ut=M[Gt];fe[Dt]=Ut}),fe}function se(fe,Q){return new(fe.bind.apply(fe,Me([void 0],Q)))}function me(fe,Q){if(Reflect.hasMetadata(be.POST_CONSTRUCT,fe)){var we=Reflect.getMetadata(be.POST_CONSTRUCT,fe);try{Q[we.value]()}catch(Oe){throw new Error(ve.POST_CONSTRUCT_ERROR(fe.name,Oe.message))}}}function ae(fe,Q,we){var Oe=null;if(Q.length>0){var M=Q.filter(function(Gt){return Gt.target!==null&&Gt.target.type===v.TargetTypeEnum.ConstructorArgument}),Jt=M.map(we);Oe=se(fe,Jt),Oe=Z(Oe,Q,we)}else Oe=new fe;return me(fe,Oe),Oe}X.resolveInstance=ae},31927:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.resolve=void 0;var Me=G(16674),ve=G(28421),v=G(85265),be=G(55800),Z=G(52279),se=function(fe,Q,we){try{return we()}catch(Oe){throw v.isStackOverflowExeption(Oe)?new Error(Me.CIRCULAR_DEPENDENCY_IN_FACTORY(fe,Q.toString())):Oe}},me=function(fe){return function(Q){Q.parentContext.setCurrentRequest(Q);var we=Q.bindings,Oe=Q.childRequests,M=Q.target&&Q.target.isArray(),Jt=!Q.parentRequest||!Q.parentRequest.target||!Q.target||!Q.parentRequest.target.matchesArray(Q.target.serviceIdentifier);if(M&&Jt)return Oe.map(function(Mr){var cr=me(fe);return cr(Mr)});var Gt=null;if(Q.target.isOptional()&&we.length===0)return;var Dt=we[0],Ut=Dt.scope===ve.BindingScopeEnum.Singleton,ct=Dt.scope===ve.BindingScopeEnum.Request;if(Ut&&Dt.activated)return Dt.cache;if(ct&&fe!==null&&fe.has(Dt.id))return fe.get(Dt.id);if(Dt.type===ve.BindingTypeEnum.ConstantValue)Gt=Dt.cache,Dt.activated=!0;else if(Dt.type===ve.BindingTypeEnum.Function)Gt=Dt.cache,Dt.activated=!0;else if(Dt.type===ve.BindingTypeEnum.Constructor)Gt=Dt.implementationType;else if(Dt.type===ve.BindingTypeEnum.DynamicValue&&Dt.dynamicValue!==null)Gt=se("toDynamicValue",Dt.serviceIdentifier,function(){return Dt.dynamicValue(Q.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Factory&&Dt.factory!==null)Gt=se("toFactory",Dt.serviceIdentifier,function(){return Dt.factory(Q.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Provider&&Dt.provider!==null)Gt=se("toProvider",Dt.serviceIdentifier,function(){return Dt.provider(Q.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Instance&&Dt.implementationType!==null)Gt=Z.resolveInstance(Dt.implementationType,Oe,me(fe));else{var dt=be.getServiceIdentifierAsString(Q.serviceIdentifier);throw new Error(Me.INVALID_BINDING_TYPE+" "+dt)}return typeof Dt.onActivation=="function"&&(Gt=Dt.onActivation(Q.parentContext,Gt)),Ut&&(Dt.cache=Gt,Dt.activated=!0),ct&&fe!==null&&!fe.has(Dt.id)&&fe.set(Dt.id,Gt),Gt}};function ae(fe){var Q=me(fe.plan.rootRequest.requestScope);return Q(fe.plan.rootRequest)}X.resolve=ae},83366:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingInSyntax=void 0;var Me=G(28421),ve=G(71325),v=function(){function be(Z){this._binding=Z}return be.prototype.inRequestScope=function(){return this._binding.scope=Me.BindingScopeEnum.Request,new ve.BindingWhenOnSyntax(this._binding)},be.prototype.inSingletonScope=function(){return this._binding.scope=Me.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},be.prototype.inTransientScope=function(){return this._binding.scope=Me.BindingScopeEnum.Transient,new ve.BindingWhenOnSyntax(this._binding)},be}();X.BindingInSyntax=v},74889:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingInWhenOnSyntax=void 0;var Me=G(83366),ve=G(51811),v=G(98370),be=function(){function Z(se){this._binding=se,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ve.BindingOnSyntax(this._binding),this._bindingInSyntax=new Me.BindingInSyntax(se)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(se){return this._bindingWhenSyntax.when(se)},Z.prototype.whenTargetNamed=function(se){return this._bindingWhenSyntax.whenTargetNamed(se)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(se,me){return this._bindingWhenSyntax.whenTargetTagged(se,me)},Z.prototype.whenInjectedInto=function(se){return this._bindingWhenSyntax.whenInjectedInto(se)},Z.prototype.whenParentNamed=function(se){return this._bindingWhenSyntax.whenParentNamed(se)},Z.prototype.whenParentTagged=function(se,me){return this._bindingWhenSyntax.whenParentTagged(se,me)},Z.prototype.whenAnyAncestorIs=function(se){return this._bindingWhenSyntax.whenAnyAncestorIs(se)},Z.prototype.whenNoAncestorIs=function(se){return this._bindingWhenSyntax.whenNoAncestorIs(se)},Z.prototype.whenAnyAncestorNamed=function(se){return this._bindingWhenSyntax.whenAnyAncestorNamed(se)},Z.prototype.whenAnyAncestorTagged=function(se,me){return this._bindingWhenSyntax.whenAnyAncestorTagged(se,me)},Z.prototype.whenNoAncestorNamed=function(se){return this._bindingWhenSyntax.whenNoAncestorNamed(se)},Z.prototype.whenNoAncestorTagged=function(se,me){return this._bindingWhenSyntax.whenNoAncestorTagged(se,me)},Z.prototype.whenAnyAncestorMatches=function(se){return this._bindingWhenSyntax.whenAnyAncestorMatches(se)},Z.prototype.whenNoAncestorMatches=function(se){return this._bindingWhenSyntax.whenNoAncestorMatches(se)},Z.prototype.onActivation=function(se){return this._bindingOnSyntax.onActivation(se)},Z}();X.BindingInWhenOnSyntax=be},51811:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingOnSyntax=void 0;var Me=G(98370),ve=function(){function v(be){this._binding=be}return v.prototype.onActivation=function(be){return this._binding.onActivation=be,new Me.BindingWhenSyntax(this._binding)},v}();X.BindingOnSyntax=ve},15451:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingToSyntax=void 0;var Me=G(16674),ve=G(28421),v=G(74889),be=G(71325),Z=function(){function se(me){this._binding=me}return se.prototype.to=function(me){return this._binding.type=ve.BindingTypeEnum.Instance,this._binding.implementationType=me,new v.BindingInWhenOnSyntax(this._binding)},se.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Me.INVALID_TO_SELF_VALUE);var me=this._binding.serviceIdentifier;return this.to(me)},se.prototype.toConstantValue=function(me){return this._binding.type=ve.BindingTypeEnum.ConstantValue,this._binding.cache=me,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ve.BindingScopeEnum.Singleton,new be.BindingWhenOnSyntax(this._binding)},se.prototype.toDynamicValue=function(me){return this._binding.type=ve.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=me,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},se.prototype.toConstructor=function(me){return this._binding.type=ve.BindingTypeEnum.Constructor,this._binding.implementationType=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new be.BindingWhenOnSyntax(this._binding)},se.prototype.toFactory=function(me){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new be.BindingWhenOnSyntax(this._binding)},se.prototype.toFunction=function(me){if(typeof me!="function")throw new Error(Me.INVALID_FUNCTION_BINDING);var ae=this.toConstantValue(me);return this._binding.type=ve.BindingTypeEnum.Function,this._binding.scope=ve.BindingScopeEnum.Singleton,ae},se.prototype.toAutoFactory=function(me){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=function(ae){var fe=function(){return ae.container.get(me)};return fe},this._binding.scope=ve.BindingScopeEnum.Singleton,new be.BindingWhenOnSyntax(this._binding)},se.prototype.toProvider=function(me){return this._binding.type=ve.BindingTypeEnum.Provider,this._binding.provider=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new be.BindingWhenOnSyntax(this._binding)},se.prototype.toService=function(me){this.toDynamicValue(function(ae){return ae.container.get(me)})},se}();X.BindingToSyntax=Z},71325:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingWhenOnSyntax=void 0;var Me=G(51811),ve=G(98370),v=function(){function be(Z){this._binding=Z,this._bindingWhenSyntax=new ve.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Me.BindingOnSyntax(this._binding)}return be.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},be.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},be.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},be.prototype.whenTargetTagged=function(Z,se){return this._bindingWhenSyntax.whenTargetTagged(Z,se)},be.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},be.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},be.prototype.whenParentTagged=function(Z,se){return this._bindingWhenSyntax.whenParentTagged(Z,se)},be.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},be.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},be.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},be.prototype.whenAnyAncestorTagged=function(Z,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,se)},be.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},be.prototype.whenNoAncestorTagged=function(Z,se){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,se)},be.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},be.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},be.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},be}();X.BindingWhenOnSyntax=v},98370:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingWhenSyntax=void 0;var Me=G(51811),ve=G(80758),v=function(){function be(Z){this._binding=Z}return be.prototype.when=function(Z){return this._binding.constraint=Z,new Me.BindingOnSyntax(this._binding)},be.prototype.whenTargetNamed=function(Z){return this._binding.constraint=ve.namedConstraint(Z),new Me.BindingOnSyntax(this._binding)},be.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var se=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return se},new Me.BindingOnSyntax(this._binding)},be.prototype.whenTargetTagged=function(Z,se){return this._binding.constraint=ve.taggedConstraint(Z)(se),new Me.BindingOnSyntax(this._binding)},be.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(se){return ve.typeConstraint(Z)(se.parentRequest)},new Me.BindingOnSyntax(this._binding)},be.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(se){return ve.namedConstraint(Z)(se.parentRequest)},new Me.BindingOnSyntax(this._binding)},be.prototype.whenParentTagged=function(Z,se){return this._binding.constraint=function(me){return ve.taggedConstraint(Z)(se)(me.parentRequest)},new Me.BindingOnSyntax(this._binding)},be.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(se){return ve.traverseAncerstors(se,ve.typeConstraint(Z))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(se){return!ve.traverseAncerstors(se,ve.typeConstraint(Z))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(se){return ve.traverseAncerstors(se,ve.namedConstraint(Z))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(se){return!ve.traverseAncerstors(se,ve.namedConstraint(Z))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenAnyAncestorTagged=function(Z,se){return this._binding.constraint=function(me){return ve.traverseAncerstors(me,ve.taggedConstraint(Z)(se))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenNoAncestorTagged=function(Z,se){return this._binding.constraint=function(me){return!ve.traverseAncerstors(me,ve.taggedConstraint(Z)(se))},new Me.BindingOnSyntax(this._binding)},be.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(se){return ve.traverseAncerstors(se,Z)},new Me.BindingOnSyntax(this._binding)},be.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(se){return!ve.traverseAncerstors(se,Z)},new Me.BindingOnSyntax(this._binding)},be}();X.BindingWhenSyntax=v},80758:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.typeConstraint=X.namedConstraint=X.taggedConstraint=X.traverseAncerstors=void 0;var Me=G(6867),ve=G(47738),v=function(me,ae){var fe=me.parentRequest;return fe!==null?ae(fe)?!0:v(fe,ae):!1};X.traverseAncerstors=v;var be=function(me){return function(ae){var fe=function(Q){return Q!==null&&Q.target!==null&&Q.target.matchesTag(me)(ae)};return fe.metaData=new ve.Metadata(me,ae),fe}};X.taggedConstraint=be;var Z=be(Me.NAMED_TAG);X.namedConstraint=Z;var se=function(me){return function(ae){var fe=null;if(ae!==null)if(fe=ae.bindings[0],typeof me=="string"){var Q=fe.serviceIdentifier;return Q===me}else{var we=ae.bindings[0].implementationType;return me===we}return!1}};X.typeConstraint=se},70600:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.multiBindToService=void 0;var G=function(Me){return function(ve){return function(){for(var v=[],be=0;be<arguments.length;be++)v[be]=arguments[be];return v.forEach(function(Z){return Me.bind(Z).toService(ve)})}}};X.multiBindToService=G},85265:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.isStackOverflowExeption=void 0;var Me=G(16674);function ve(v){return v instanceof RangeError||v.message===Me.STACK_OVERFLOW}X.isStackOverflowExeption=ve},37791:function(dr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.id=void 0;var G=0;function Me(){return G++}X.id=Me},55800:function(dr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.circularDependencyToException=X.listMetadataForTarget=X.listRegisteredBindingsForServiceIdentifier=X.getServiceIdentifierAsString=X.getFunctionName=void 0;var Me=G(16674);function ve(fe){if(typeof fe=="function"){var Q=fe;return Q.name}else{if(typeof fe=="symbol")return fe.toString();var Q=fe;return Q}}X.getServiceIdentifierAsString=ve;function v(fe,Q,we){var Oe="",M=we(fe,Q);return M.length!==0&&(Oe=`
Registered bindings:`,M.forEach(function(Jt){var Gt="Object";Jt.implementationType!==null&&(Gt=ae(Jt.implementationType)),Oe=Oe+`
 `+Gt,Jt.constraint.metaData&&(Oe=Oe+" - "+Jt.constraint.metaData)})),Oe}X.listRegisteredBindingsForServiceIdentifier=v;function be(fe,Q){return fe.parentRequest===null?!1:fe.parentRequest.serviceIdentifier===Q?!0:be(fe.parentRequest,Q)}function Z(fe){function Q(Oe,M){M===void 0&&(M=[]);var Jt=ve(Oe.serviceIdentifier);return M.push(Jt),Oe.parentRequest!==null?Q(Oe.parentRequest,M):M}var we=Q(fe);return we.reverse().join(" --> ")}function se(fe){fe.childRequests.forEach(function(Q){if(be(Q,Q.serviceIdentifier)){var we=Z(Q);throw new Error(Me.CIRCULAR_DEPENDENCY+" "+we)}else se(Q)})}X.circularDependencyToException=se;function me(fe,Q){if(Q.isTagged()||Q.isNamed()){var we="",Oe=Q.getNamedTag(),M=Q.getCustomTags();return Oe!==null&&(we+=Oe.toString()+`
`),M!==null&&M.forEach(function(Jt){we+=Jt.toString()+`
`})," "+fe+`
 `+fe+" - "+we}else return" "+fe}X.listMetadataForTarget=me;function ae(fe){if(fe.name)return fe.name;var Q=fe.toString(),we=Q.match(/^function\s*([^\s(]+)/);return we?we[1]:"Anonymous function: "+Q}X.getFunctionName=ae},49029:function(dr){var X=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function G(Me){return Me.match(X)||[]}dr.exports=G},29750:function(dr){function X(G,Me,ve){return G===G&&(ve!==void 0&&(G=G<=ve?G:ve),Me!==void 0&&(G=G>=Me?G:Me)),G}dr.exports=X},18674:function(dr){function X(G){return function(Me){return G==null?void 0:G[Me]}}dr.exports=X},98805:function(dr,X,G){var Me=G(40180),ve=G(62689),v=G(83140),be=G(79833);function Z(se){return function(me){me=be(me);var ae=ve(me)?v(me):void 0,fe=ae?ae[0]:me.charAt(0),Q=ae?Me(ae,1).join(""):me.slice(1);return fe[se]()+Q}}dr.exports=Z},35393:function(dr,X,G){var Me=G(62663),ve=G(53816),v=G(58748),be="['\u2019]",Z=RegExp(be,"g");function se(me){return function(ae){return Me(v(ve(ae).replace(Z,"")),me,"")}}dr.exports=se},69389:function(dr,X,G){var Me=G(18674),ve={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Me(ve);dr.exports=v},93157:function(dr){var X=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function G(Me){return X.test(Me)}dr.exports=G},2757:function(dr){var X="\\ud800-\\udfff",G="\\u0300-\\u036f",Me="\\ufe20-\\ufe2f",ve="\\u20d0-\\u20ff",v=G+Me+ve,be="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",se="\\xac\\xb1\\xd7\\xf7",me="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ae="\\u2000-\\u206f",fe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Q="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Oe=se+me+ae+fe,M="['\u2019]",Jt="["+Oe+"]",Gt="["+v+"]",Dt="\\d+",Ut="["+be+"]",ct="["+Z+"]",dt="[^"+X+Oe+Dt+be+Z+Q+"]",Mr="\\ud83c[\\udffb-\\udfff]",cr="(?:"+Gt+"|"+Mr+")",Ft="[^"+X+"]",st="(?:\\ud83c[\\udde6-\\uddff]){2}",He="[\\ud800-\\udbff][\\udc00-\\udfff]",ut="["+Q+"]",Ye="\\u200d",kt="(?:"+ct+"|"+dt+")",ur="(?:"+ut+"|"+dt+")",Or="(?:"+M+"(?:d|ll|m|re|s|t|ve))?",Gr="(?:"+M+"(?:D|LL|M|RE|S|T|VE))?",Ee=cr+"?",Ve="["+we+"]?",ke="(?:"+Ye+"(?:"+[Ft,st,He].join("|")+")"+Ve+Ee+")*",vt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",qe="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",H=Ve+Ee+ke,Je="(?:"+[Ut,st,He].join("|")+")"+H,Et=RegExp([ut+"?"+ct+"+"+Or+"(?="+[Jt,ut,"$"].join("|")+")",ur+"+"+Gr+"(?="+[Jt,ut+kt,"$"].join("|")+")",ut+"?"+kt+"+"+Or,ut+"+"+Gr,qe,vt,Dt,Je].join("|"),"g");function gt(qr){return qr.match(Et)||[]}dr.exports=gt},68929:function(dr,X,G){var Me=G(48403),ve=G(35393),v=ve(function(be,Z,se){return Z=Z.toLowerCase(),be+(se?Me(Z):Z)});dr.exports=v},48403:function(dr,X,G){var Me=G(79833),ve=G(11700);function v(be){return ve(Me(be).toLowerCase())}dr.exports=v},74691:function(dr,X,G){var Me=G(29750),ve=G(14841);function v(be,Z,se){return se===void 0&&(se=Z,Z=void 0),se!==void 0&&(se=ve(se),se=se===se?se:0),Z!==void 0&&(Z=ve(Z),Z=Z===Z?Z:0),Me(ve(be),Z,se)}dr.exports=v},53816:function(dr,X,G){var Me=G(69389),ve=G(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",se="\\u20d0-\\u20ff",me=be+Z+se,ae="["+me+"]",fe=RegExp(ae,"g");function Q(we){return we=ve(we),we&&we.replace(v,Me).replace(fe,"")}dr.exports=Q},60442:function(dr,X,G){var Me=G(90939);function ve(v,be){return Me(v,be)}dr.exports=ve},14293:function(dr){function X(G){return G==null}dr.exports=X},81763:function(dr,X,G){var Me=G(44239),ve=G(37005),v="[object Number]";function be(Z){return typeof Z=="number"||ve(Z)&&Me(Z)==v}dr.exports=be},30236:function(dr,X,G){var Me=G(42980),ve=G(21463),v=ve(function(be,Z,se,me){Me(be,Z,se,me)});dr.exports=v},44908:function(dr,X,G){var Me=G(45652);function ve(v){return v&&v.length?Me(v):[]}dr.exports=ve},11700:function(dr,X,G){var Me=G(98805),ve=Me("toUpperCase");dr.exports=ve},58748:function(dr,X,G){var Me=G(49029),ve=G(93157),v=G(79833),be=G(2757);function Z(se,me,ae){return se=v(se),me=ae?void 0:me,me===void 0?ve(se)?be(se):Me(se):se.match(me)||[]}dr.exports=Z},6158:function(dr){(function(X,G){dr.exports=G()})(this,function(){"use strict";var X,G,Me;function ve(v,be){if(!X)X=be;else if(!G)G=be;else{var Z="var sharedChunk = {}; ("+X+")(sharedChunk); ("+G+")(sharedChunk);",se={};X(se),Me=be(se),typeof window!="undefined"&&(Me.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return ve(["exports"],function(v){"use strict";function be(t,a){return t(a={exports:{}},a.exports),a.exports}var Z=se;function se(t,a,s,p){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=s,this.p2y=p}se.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},se.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},se.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},se.prototype.solveCurveX=function(t,a){var s,p,m,g,w;for(a===void 0&&(a=1e-6),m=t,w=0;w<8;w++){if(g=this.sampleCurveX(m)-t,Math.abs(g)<a)return m;var C=this.sampleCurveDerivativeX(m);if(Math.abs(C)<1e-6)break;m-=g/C}if((m=t)<(s=0))return s;if(m>(p=1))return p;for(;s<p;){if(g=this.sampleCurveX(m),Math.abs(g-t)<a)return m;t>g?s=m:p=m,m=.5*(p-s)+s}return m},se.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var me=ae;function ae(t,a){this.x=t,this.y=a}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),p=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=p,this},_rotateAround:function(t,a){var s=Math.cos(t),p=Math.sin(t),m=a.y+p*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-p*(this.y-a.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(t){return t instanceof ae?t:Array.isArray(t)?new ae(t[0],t[1]):t};var fe=typeof self!="undefined"?self:{},Q=Math.pow(2,53)-1;function we(t,a,s,p){var m=new Z(t,a,s,p);return function(g){return m.solve(g)}}var Oe=we(.25,.1,.25,1);function M(t,a,s){return Math.min(s,Math.max(a,t))}function Jt(t,a,s){var p=s-a,m=((t-a)%p+p)%p+a;return m===a?s:m}function Gt(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var p=0,m=a;p<m.length;p+=1){var g=m[p];for(var w in g)t[w]=g[w]}return t}var Dt=1;function Ut(){return Dt++}function ct(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Mr(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function cr(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Ft(t,a,s){var p={};for(var m in t)p[m]=a.call(s||this,t[m],m,t);return p}function st(t,a,s){var p={};for(var m in t)a.call(s||this,t[m],m,t)&&(p[m]=t[m]);return p}function He(t){return Array.isArray(t)?t.map(He):typeof t=="object"&&t?Ft(t,He):t}var ut={};function Ye(t){ut[t]||(typeof console!="undefined"&&console.warn(t),ut[t]=!0)}function kt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function ur(t){for(var a=0,s=0,p=t.length,m=p-1,g=void 0,w=void 0;s<p;m=s++)a+=((w=t[m]).x-(g=t[s]).x)*(g.y+w.y);return a}function Or(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Gr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,m,g,w){var C=g||w;return a[m]=!C||C.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var Ee=null;function Ve(t){if(Ee==null){var a=t.navigator?t.navigator.userAgent:null;Ee=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ee}function ke(t){try{var a=fe[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var vt,qe,H,Je,Et=fe.performance&&fe.performance.now?fe.performance.now.bind(fe.performance):Date.now.bind(Date),gt=fe.requestAnimationFrame||fe.mozRequestAnimationFrame||fe.webkitRequestAnimationFrame||fe.msRequestAnimationFrame,qr=fe.cancelAnimationFrame||fe.mozCancelAnimationFrame||fe.webkitCancelAnimationFrame||fe.msCancelAnimationFrame,Si={now:Et,frame:function(t){var a=gt(t);return{cancel:function(){return qr(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=fe.document.createElement("canvas"),p=s.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return vt||(vt=fe.document.createElement("a")),vt.href=t,vt.href},hardwareConcurrency:fe.navigator&&fe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return fe.devicePixelRatio},get prefersReducedMotion(){return!!fe.matchMedia&&(qe==null&&(qe=fe.matchMedia("(prefers-reduced-motion: reduce)")),qe.matches)}},On={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},An={supported:!1,testSupport:function(t){!gn&&Je&&(Cn?un(t):H=t)}},gn=!1,Cn=!1;function un(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Je),t.isContextLost())return;An.supported=!0}catch(s){}t.deleteTexture(a),gn=!0}fe.document&&((Je=fe.document.createElement("img")).onload=function(){H&&un(H),H=null,Cn=!0},Je.onerror=function(){gn=!0,H=null},Je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Oi="01",Ei=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function da(t){return t.indexOf("mapbox:")===0}Ei.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Oi,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ei.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ei.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Ei.prototype.normalizeStyleURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Ei.prototype.normalizeGlyphsURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Ei.prototype.normalizeSourceURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Ei.prototype.normalizeSpriteURL=function(t,a,s,p){var m=Mi(t);return da(t)?(m.path="/styles/v1"+m.path+"/sprite"+a+s,this._makeAPIURL(m,this._customAccessToken||p)):(m.path+=""+a+s,Pi(m))},Ei.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!da(t))return t;var s=Mi(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Si.devicePixelRatio>=2||a===512?"@2x":"")+(An.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var p=this._customAccessToken||function(m){for(var g=0,w=m;g<w.length;g+=1){var C=w[g].match(/^access_token=(.*)$/);if(C)return C[1]}return null}(s.params)||On.ACCESS_TOKEN;return On.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,p)},Ei.prototype.canonicalizeTileURL=function(t,a){var s=Mi(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=s.path.replace("/v4/","");var m=s.params;return a&&(m=m.filter(function(g){return!g.match(/^access_token=/)})),m.length&&(p+="?"+m.join("&")),p},Ei.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&da(a),p=[],m=0,g=t.tiles||[];m<g.length;m+=1){var w=g[m];Ti(w)?p.push(this.canonicalizeTileURL(w,s)):p.push(w)}return p},Ei.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Mi(On.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!On.REQUIRE_ACCESS_TOKEN)return Pi(t);if(!(a=a||On.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(g){return g.indexOf("access_token")===-1}),t.params.push("access_token="+a),Pi(t)};var sa=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ti(t){return sa.test(t)}var lo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mi(t){var a=t.match(lo);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Pi(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function bo(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(fe.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var le=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};le.prototype.getStorageKey=function(t){var a,s=bo(On.ACCESS_TOKEN);return a=s&&s.u?fe.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(p,m){return String.fromCharCode(Number("0x"+m))})):On.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},le.prototype.fetchEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var p=fe.localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));var m=fe.localStorage.getItem(s);m&&(this.anonId=m)}catch(g){Ye("Unable to read from LocalStorage")}},le.prototype.saveEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{fe.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&fe.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(p){Ye("Unable to write to LocalStorage")}},le.prototype.processRequests=function(t){},le.prototype.postEvent=function(t,a,s,p){var m=this;if(On.EVENTS_URL){var g=Mi(On.EVENTS_URL);g.params.push("access_token="+(p||On.ACCESS_TOKEN||""));var w={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Oi,userId:this.anonId},C=a?Gt(w,a):w,I={url:Pi(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=Ji(I,function(L){m.pendingRequest=null,s(L),m.saveEventData(),m.processRequests(p)})}},le.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var Ha,ki,Wo=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,p,m,g){this.skuToken=m,(On.EVENTS_URL&&g||On.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(w){return da(w)||Ti(w)}))&&this.queueRequest({id:p,timestamp:Date.now()},g)},a.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),g=m.id,w=m.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=ct()),this.postEvent(w,{skuToken:this.skuToken},function(C){C||g&&(p.success[g]=!0)},s))}},a}(le),cu=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,p){On.EVENTS_URL&&On.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(m){return da(m)||Ti(m)})&&this.queueRequest(Date.now(),p)},a.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=bo(On.ACCESS_TOKEN),g=m?m.u:On.ACCESS_TOKEN,w=g!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=ct(),w=!0);var C=this.queue.shift();if(this.eventData.lastSuccess){var I=new Date(this.eventData.lastSuccess),L=new Date(C),D=(C-this.eventData.lastSuccess)/864e5;w=w||D>=1||D<-1||I.getDate()!==L.getDate()}else w=!0;if(!w)return this.processRequests();this.postEvent(C,{"enabled.telemetry":!1},function(N){N||(p.eventData.lastSuccess=C,p.eventData.tokenU=g)},s)}},a}(le)),is=cu.postTurnstileEvent.bind(cu),as=new Wo,bt=as.postMapLoadEvent.bind(as),Xt=500,Tr=50;function Ur(){fe.caches&&!Ha&&(Ha=fe.caches.open("mapbox-tiles"))}function dn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var ui,Rn=1/0;function $n(){return ui==null&&(ui=fe.OffscreenCanvas&&new fe.OffscreenCanvas(1,1).getContext("2d")&&typeof fe.createImageBitmap=="function"),ui}var Mn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mn);var di=function(t){function a(s,p,m){p===401&&Ti(m)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=p,this.url=m,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),ni=Or()?function(){return self.worker&&self.worker.referrer}:function(){return(fe.location.protocol==="blob:"?fe.parent:fe).location.href},to,wo,fu=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(ni())&&!/^\w+:/.test(s))){if(fe.fetch&&fe.Request&&fe.AbortController&&fe.Request.prototype.hasOwnProperty("signal"))return function(p,m){var g,w=new fe.AbortController,C=new fe.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:ni(),signal:w.signal}),I=!1,L=!1,D=(g=C.url).indexOf("sku=")>0&&Ti(g);p.type==="json"&&C.headers.set("Accept","application/json");var N=function(q,xe,Ce){if(!L){if(q&&q.message!=="SecurityError"&&Ye(q),xe&&Ce)return V(xe);var ze=Date.now();fe.fetch(C).then(function(Le){if(Le.ok){var $e=D?Le.clone():null;return V(Le,$e,ze)}return m(new di(Le.statusText,Le.status,p.url))}).catch(function(Le){Le.code!==20&&m(new Error(Le.message))})}},V=function(q,xe,Ce){(p.type==="arrayBuffer"?q.arrayBuffer():p.type==="json"?q.json():q.text()).then(function(ze){L||(xe&&Ce&&function(Le,$e,ot){if(Ur(),Ha){var St={status:$e.status,statusText:$e.statusText,headers:new fe.Headers};$e.headers.forEach(function(zt,Kt){return St.headers.set(Kt,zt)});var Pt=Gr($e.headers.get("Cache-Control")||"");Pt["no-store"]||(Pt["max-age"]&&St.headers.set("Expires",new Date(ot+1e3*Pt["max-age"]).toUTCString()),new Date(St.headers.get("Expires")).getTime()-ot<42e4||function(zt,Kt){if(ki===void 0)try{new Response(new ReadableStream),ki=!0}catch(Sr){ki=!1}ki?Kt(zt.body):zt.blob().then(Kt)}($e,function(zt){var Kt=new fe.Response(zt,St);Ur(),Ha&&Ha.then(function(Sr){return Sr.put(dn(Le.url),Kt)}).catch(function(Sr){return Ye(Sr.message)})}))}}(C,xe,Ce),I=!0,m(null,ze,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(function(ze){L||m(new Error(ze.message))})};return D?function(q,xe){if(Ur(),!Ha)return xe(null);var Ce=dn(q.url);Ha.then(function(ze){ze.match(Ce).then(function(Le){var $e=function(ot){if(!ot)return!1;var St=new Date(ot.headers.get("Expires")||0),Pt=Gr(ot.headers.get("Cache-Control")||"");return St>Date.now()&&!Pt["no-cache"]}(Le);ze.delete(Ce),$e&&ze.put(Ce,Le.clone()),xe(null,Le,$e)}).catch(xe)}).catch(xe)}(C,N):N(null,null),{cancel:function(){L=!0,I||w.abort()}}}(t,a);if(Or()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(p,m){var g=new fe.XMLHttpRequest;for(var w in g.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(g.responseType="arraybuffer"),p.headers)g.setRequestHeader(w,p.headers[w]);return p.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=p.credentials==="include",g.onerror=function(){m(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var C=g.response;if(p.type==="json")try{C=JSON.parse(g.response)}catch(I){return m(I)}m(null,C,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else m(new di(g.statusText,g.status,p.url))},g.send(p.body),{cancel:function(){return g.abort()}}}(t,a)},Rs=function(t,a){return fu(Gt(t,{type:"arrayBuffer"}),a)},Ji=function(t,a){return fu(Gt(t,{method:"POST"}),a)},B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";to=[],wo=0;var U=function(t,a){if(An.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),wo>=On.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return to.push(s),s}wo++;var p=!1,m=function(){if(!p)for(p=!0,wo--;to.length&&wo<On.MAX_PARALLEL_IMAGE_REQUESTS;){var w=to.shift();w.cancelled||(w.cancel=U(w.requestParameters,w.callback).cancel)}},g=Rs(t,function(w,C,I,L){m(),w?a(w):C&&($n()?function(D,N){var V=new fe.Blob([new Uint8Array(D)],{type:"image/png"});fe.createImageBitmap(V).then(function(q){N(null,q)}).catch(function(q){N(new Error("Could not load image because of "+q.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(C,a):function(D,N,V,q){var xe=new fe.Image,Ce=fe.URL;xe.onload=function(){N(null,xe),Ce.revokeObjectURL(xe.src),xe.onload=null,fe.requestAnimationFrame(function(){xe.src=B})},xe.onerror=function(){return N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ze=new fe.Blob([new Uint8Array(D)],{type:"image/png"});xe.cacheControl=V,xe.expires=q,xe.src=D.byteLength?Ce.createObjectURL(ze):B}(C,a,I,L))});return{cancel:function(){g.cancel(),m()}}};function Y(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function oe(t,a,s){if(s&&s[t]){var p=s[t].indexOf(a);p!==-1&&s[t].splice(p,1)}}var Te=function(t,a){a===void 0&&(a={}),Gt(this,a),this.type=t},Ze=function(t){function a(s,p){p===void 0&&(p={}),t.call(this,"error",Gt({error:s},p))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Te),We=function(){};We.prototype.on=function(t,a){return this._listeners=this._listeners||{},Y(t,a,this._listeners),this},We.prototype.off=function(t,a){return oe(t,a,this._listeners),oe(t,a,this._oneTimeListeners),this},We.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},Y(t,a,this._oneTimeListeners),this},We.prototype.fire=function(t,a){typeof t=="string"&&(t=new Te(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var p=0,m=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];p<m.length;p+=1)m[p].call(this,t);for(var g=0,w=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];g<w.length;g+=1){var C=w[g];oe(s,C,this._oneTimeListeners),C.call(this,t)}var I=this._eventedParent;I&&(Gt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(t))}else t instanceof Ze&&console.error(t.error);return this},We.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},We.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pe=function(t,a,s,p){this.message=(t?t+": ":"")+s,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)};function nt(t){var a=t.value;return a?[new Pe(t.key,a,"constants have been deprecated as of v8")]:[]}function $t(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var p=0,m=a;p<m.length;p+=1){var g=m[p];for(var w in g)t[w]=g[w]}return t}function lr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function pt(t){if(Array.isArray(t))return t.map(pt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=pt(t[s]);return a}return lr(t)}var er=function(t){function a(s,p){t.call(this,p),this.message=p,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),Wr=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,p=a;s<p.length;s+=1){var m=p[s];this.bindings[m[0]]=m[1]}};Wr.prototype.concat=function(t){return new Wr(this,t)},Wr.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Wr.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Rr={kind:"null"},Rt={kind:"number"},Dr={kind:"string"},Ir={kind:"boolean"},Pr={kind:"color"},Bn={kind:"object"},Lr={kind:"value"},Un={kind:"collator"},li={kind:"formatted"},Nn={kind:"resolvedImage"};function Pn(t,a){return{kind:"array",itemType:t,N:a}}function jn(t){if(t.kind==="array"){var a=jn(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var Ea=[Rr,Rt,Dr,Ir,Pr,li,Bn,Pn(Lr),Nn];function mi(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!mi(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,p=Ea;s<p.length;s+=1)if(!mi(p[s],a))return null}}return"Expected "+jn(t)+" but found "+jn(a)+" instead."}function Li(t,a){return a.some(function(s){return s.kind===t.kind})}function Wn(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var zn=be(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(C){return(C=Math.round(C))<0?0:C>255?255:C}function m(C){return p(C[C.length-1]==="%"?parseFloat(C)/100*255:parseInt(C))}function g(C){return(I=C[C.length-1]==="%"?parseFloat(C)/100:parseFloat(C))<0?0:I>1?1:I;var I}function w(C,I,L){return L<0?L+=1:L>1&&(L-=1),6*L<1?C+(I-C)*L*6:2*L<1?I:3*L<2?C+(I-C)*(2/3-L)*6:C}try{a.parseCSSColor=function(C){var I,L=C.replace(/ /g,"").toLowerCase();if(L in s)return s[L].slice();if(L[0]==="#")return L.length===4?(I=parseInt(L.substr(1),16))>=0&&I<=4095?[(3840&I)>>4|(3840&I)>>8,240&I|(240&I)>>4,15&I|(15&I)<<4,1]:null:L.length===7&&(I=parseInt(L.substr(1),16))>=0&&I<=16777215?[(16711680&I)>>16,(65280&I)>>8,255&I,1]:null;var D=L.indexOf("("),N=L.indexOf(")");if(D!==-1&&N+1===L.length){var V=L.substr(0,D),q=L.substr(D+1,N-(D+1)).split(","),xe=1;switch(V){case"rgba":if(q.length!==4)return null;xe=g(q.pop());case"rgb":return q.length!==3?null:[m(q[0]),m(q[1]),m(q[2]),xe];case"hsla":if(q.length!==4)return null;xe=g(q.pop());case"hsl":if(q.length!==3)return null;var Ce=(parseFloat(q[0])%360+360)%360/360,ze=g(q[1]),Le=g(q[2]),$e=Le<=.5?Le*(ze+1):Le+ze-Le*ze,ot=2*Le-$e;return[p(255*w(ot,$e,Ce+1/3)),p(255*w(ot,$e,Ce)),p(255*w(ot,$e,Ce-1/3)),xe];default:return null}}return null}}catch(C){}}).parseCSSColor,Jn=function(t,a,s,p){p===void 0&&(p=1),this.r=t,this.g=a,this.b=s,this.a=p};Jn.parse=function(t){if(t){if(t instanceof Jn)return t;if(typeof t=="string"){var a=zn(t);if(a)return new Jn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Jn.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+p+")"},Jn.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1);var Qi=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Qi.prototype.compare=function(t,a){return this.collator.compare(t,a)},Qi.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ys=function(t,a,s,p,m){this.text=t,this.image=a,this.scale=s,this.fontStack=p,this.textColor=m},Bi=function(t){this.sections=t};Bi.fromString=function(t){return new Bi([new ys(t,null,null,null,null)])},Bi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Bi.factory=function(t){return t instanceof Bi?t:Bi.fromString(t)},Bi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Bi.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var p=s[a];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var m={};p.fontStack&&(m["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(m["font-scale"]=p.scale),p.textColor&&(m["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(m)}}return t};var ea=function(t){this.name=t.name,this.available=t.available};function ku(t,a,s,p){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,a,s,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,a,s,p]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function qs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Jn||t instanceof Qi||t instanceof Bi||t instanceof ea)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!qs(s[a]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!qs(t[p]))return!1;return!0}return!1}function ji(t){if(t===null)return Rr;if(typeof t=="string")return Dr;if(typeof t=="boolean")return Ir;if(typeof t=="number")return Rt;if(t instanceof Jn)return Pr;if(t instanceof Qi)return Un;if(t instanceof Bi)return li;if(t instanceof ea)return Nn;if(Array.isArray(t)){for(var a,s=t.length,p=0,m=t;p<m.length;p+=1){var g=ji(m[p]);if(a){if(a===g)continue;a=Lr;break}a=g}return Pn(a||Lr,s)}return Bn}function Wa(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Jn||t instanceof Bi||t instanceof ea?t.toString():JSON.stringify(t)}ea.prototype.toString=function(){return this.name},ea.fromString=function(t){return t?new ea({name:t,available:!1}):null},ea.prototype.serialize=function(){return["image",this.name]};var Ca=function(t,a){this.type=t,this.value=a};Ca.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!qs(t[1]))return a.error("invalid value");var s=t[1],p=ji(s),m=a.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new Ca(p,s)},Ca.prototype.evaluate=function(){return this.value},Ca.prototype.eachChild=function(){},Ca.prototype.outputDefined=function(){return!0},Ca.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toArray()):this.value instanceof Bi?this.value.serialize():this.value};var ua=function(t){this.name="ExpressionEvaluationError",this.message=t};ua.prototype.toJSON=function(){return this.message};var vo={string:Dr,number:Rt,boolean:Ir,object:Bn},wi=function(t,a){this.type=t,this.args=a};wi.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,p=1,m=t[0];if(m==="array"){var g,w;if(t.length>2){var C=t[1];if(typeof C!="string"||!(C in vo)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);g=vo[C],p++}else g=Lr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);w=t[2],p++}s=Pn(g,w)}else s=vo[m];for(var I=[];p<t.length;p++){var L=a.parse(t[p],p,Lr);if(!L)return null;I.push(L)}return new wi(s,I)},wi.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!mi(this.type,ji(s)))return s;if(a===this.args.length-1)throw new ua("Expected value to be of type "+jn(this.type)+", but found "+jn(ji(s))+" instead.")}return null},wi.prototype.eachChild=function(t){this.args.forEach(t)},wi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},wi.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(function(m){return m.serialize()}))};var mo=function(t){this.type=li,this.sections=t};mo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var p=[],m=!1,g=1;g<=t.length-1;++g){var w=t[g];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;var C=null;if(w["font-scale"]&&!(C=a.parse(w["font-scale"],1,Rt)))return null;var I=null;if(w["text-font"]&&!(I=a.parse(w["text-font"],1,Pn(Dr))))return null;var L=null;if(w["text-color"]&&!(L=a.parse(w["text-color"],1,Pr)))return null;var D=p[p.length-1];D.scale=C,D.font=I,D.textColor=L}else{var N=a.parse(t[g],1,Lr);if(!N)return null;var V=N.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:N,scale:null,font:null,textColor:null})}}return new mo(p)},mo.prototype.evaluate=function(t){return new Bi(this.sections.map(function(a){var s=a.content.evaluate(t);return ji(s)===Nn?new ys("",s,null,null,null):new ys(Wa(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},mo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var p=s[a];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},mo.prototype.outputDefined=function(){return!1},mo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var p=s[a];t.push(p.content.serialize());var m={};p.scale&&(m["font-scale"]=p.scale.serialize()),p.font&&(m["text-font"]=p.font.serialize()),p.textColor&&(m["text-color"]=p.textColor.serialize()),t.push(m)}return t};var Xa=function(t){this.type=Nn,this.input=t};Xa.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Dr);return s?new Xa(s):a.error("No image name provided.")},Xa.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=ea.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Xa.prototype.eachChild=function(t){t(this.input)},Xa.prototype.outputDefined=function(){return!1},Xa.prototype.serialize=function(){return["image",this.input.serialize()]};var So={"to-boolean":Ir,"to-color":Pr,"to-number":Rt,"to-string":Dr},Xo=function(t,a){this.type=t,this.args=a};Xo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var p=So[s],m=[],g=1;g<t.length;g++){var w=a.parse(t[g],g,Lr);if(!w)return null;m.push(w)}return new Xo(p,m)},Xo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,p=0,m=this.args;p<m.length;p+=1){if(s=null,(a=m[p].evaluate(t))instanceof Jn)return a;if(typeof a=="string"){var g=t.parseColor(a);if(g)return g}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ku(a[0],a[1],a[2],a[3])))return new Jn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ua(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var w=null,C=0,I=this.args;C<I.length;C+=1){if((w=I[C].evaluate(t))===null)return 0;var L=Number(w);if(!isNaN(L))return L}throw new ua("Could not convert "+JSON.stringify(w)+" to number.")}return this.type.kind==="formatted"?Bi.fromString(Wa(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ea.fromString(Wa(this.args[0].evaluate(t))):Wa(this.args[0].evaluate(t))},Xo.prototype.eachChild=function(t){this.args.forEach(t)},Xo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Xo.prototype.serialize=function(){if(this.type.kind==="formatted")return new mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xa(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Lc=["Unknown","Point","LineString","Polygon"],Yo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Yo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Yo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Lc[this.feature.type]:this.feature.type:null},Yo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Yo.prototype.canonicalID=function(){return this.canonical},Yo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Yo.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Jn.parse(t)),a};var Ta=function(t,a,s,p){this.name=t,this.type=a,this._evaluate=s,this.args=p};Ta.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ta.prototype.eachChild=function(t){this.args.forEach(t)},Ta.prototype.outputDefined=function(){return!1},Ta.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ta.parse=function(t,a){var s,p=t[0],m=Ta.definitions[p];if(!m)return a.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,C=w.filter(function(nn){var Br=nn[0];return!Array.isArray(Br)||Br.length===t.length-1}),I=null,L=0,D=C;L<D.length;L+=1){var N=D[L],V=N[0],q=N[1];I=new gs(a.registry,a.path,null,a.scope);for(var xe=[],Ce=!1,ze=1;ze<t.length;ze++){var Le=t[ze],$e=Array.isArray(V)?V[ze-1]:V.type,ot=I.parse(Le,1+xe.length,$e);if(!ot){Ce=!0;break}xe.push(ot)}if(!Ce)if(Array.isArray(V)&&V.length!==xe.length)I.error("Expected "+V.length+" arguments, but found "+xe.length+" instead.");else{for(var St=0;St<xe.length;St++){var Pt=Array.isArray(V)?V[St]:V.type,zt=xe[St];I.concat(St+1).checkSubtype(Pt,zt.type)}if(I.errors.length===0)return new Ta(p,g,q,xe)}}if(C.length===1)(s=a.errors).push.apply(s,I.errors);else{for(var Kt=(C.length?C:w).map(function(nn){var Br;return Br=nn[0],Array.isArray(Br)?"("+Br.map(jn).join(", ")+")":"("+jn(Br.type)+"...)"}).join(" | "),Sr=[],tr=1;tr<t.length;tr++){var zr=a.parse(t[tr],1+Sr.length);if(!zr)return null;Sr.push(jn(zr.type))}a.error("Expected arguments of type "+Kt+", but found ("+Sr.join(", ")+") instead.")}return null},Ta.register=function(t,a){for(var s in Ta.definitions=a,a)t[s]=Ta};var va=function(t,a,s){this.type=Un,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Ri(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function K(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function he(t,a){var s=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,m=Math.pow(2,a.z);return[Math.round(s*m*8192),Math.round(p*m*8192)]}function je(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function It(t,a){for(var s,p,m,g,w,C,I,L=!1,D=0,N=a.length;D<N;D++)for(var V=a[D],q=0,xe=V.length;q<xe-1;q++){if((g=(s=t)[0]-(p=V[q])[0])*(I=s[1]-(m=V[q+1])[1])-(C=s[0]-m[0])*(w=s[1]-p[1])==0&&g*C<=0&&w*I<=0)return!1;je(t,V[q],V[q+1])&&(L=!L)}return L}function xr(t,a){for(var s=0;s<a.length;s++)if(It(t,a[s]))return!0;return!1}function an(t,a,s,p){var m=p[0]-s[0],g=p[1]-s[1],w=(t[0]-s[0])*g-m*(t[1]-s[1]),C=(a[0]-s[0])*g-m*(a[1]-s[1]);return w>0&&C<0||w<0&&C>0}function yi(t,a,s){for(var p=0,m=s;p<m.length;p+=1)for(var g=m[p],w=0;w<g.length-1;++w)if((N=[(D=g[w+1])[0]-(L=g[w])[0],D[1]-L[1]])[0]*(V=[(I=a)[0]-(C=t)[0],I[1]-C[1]])[1]-N[1]*V[0]!=0&&an(C,I,L,D)&&an(L,D,C,I))return!0;var C,I,L,D,N,V;return!1}function ma(t,a){for(var s=0;s<t.length;++s)if(!It(t[s],a))return!1;for(var p=0;p<t.length-1;++p)if(yi(t[p],t[p+1],a))return!1;return!0}function Ya(t,a){for(var s=0;s<a.length;s++)if(ma(t,a[s]))return!0;return!1}function Aa(t,a,s){for(var p=[],m=0;m<t.length;m++){for(var g=[],w=0;w<t[m].length;w++){var C=he(t[m][w],s);Ri(a,C),g.push(C)}p.push(g)}return p}function qo(t,a,s){for(var p=[],m=0;m<t.length;m++){var g=Aa(t[m],a,s);p.push(g)}return p}function ac(t,a,s,p){if(t[0]<s[0]||t[0]>s[2]){var m=.5*p,g=t[0]-s[0]>m?-p:s[0]-t[0]>m?p:0;g===0&&(g=t[0]-s[2]>m?-p:s[2]-t[0]>m?p:0),t[0]+=g}Ri(a,t)}function vf(t,a,s,p){for(var m=8192*Math.pow(2,p.z),g=[8192*p.x,8192*p.y],w=[],C=0,I=t;C<I.length;C+=1)for(var L=0,D=I[C];L<D.length;L+=1){var N=D[L],V=[N.x+g[0],N.y+g[1]];ac(V,a,s,m),w.push(V)}return w}function Rc(t,a,s,p){for(var m,g=8192*Math.pow(2,p.z),w=[8192*p.x,8192*p.y],C=[],I=0,L=t;I<L.length;I+=1){for(var D=[],N=0,V=L[I];N<V.length;N+=1){var q=V[N],xe=[q.x+w[0],q.y+w[1]];Ri(a,xe),D.push(xe)}C.push(D)}if(a[2]-a[0]<=g/2){(m=a)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Ce=0,ze=C;Ce<ze.length;Ce+=1)for(var Le=0,$e=ze[Ce];Le<$e.length;Le+=1)ac($e[Le],a,s,g)}return C}va.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var p=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ir);if(!p)return null;var m=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ir);if(!m)return null;var g=null;return s.locale&&!(g=a.parse(s.locale,1,Dr))?null:new va(p,m,g)},va.prototype.evaluate=function(t){return new Qi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},va.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},va.prototype.outputDefined=function(){return!1},va.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var os=function(t,a){this.type=Ir,this.geojson=t,this.geometries=a};function Lu(t){if(t instanceof Ta&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof os)return!1;var a=!0;return t.eachChild(function(s){a&&!Lu(s)&&(a=!1)}),a}function ss(t){if(t instanceof Ta&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!ss(s)&&(a=!1)}),a}function ol(t,a){if(t instanceof Ta&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(p){s&&!ol(p,a)&&(s=!1)}),s}os.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(qs(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var p=0;p<s.features.length;++p){var m=s.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new os(s,s.features[p].geometry)}else if(s.type==="Feature"){var g=s.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new os(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new os(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},os.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(s.type==="Polygon"){var w=Aa(s.coordinates,m,g),C=vf(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var I=0,L=C;I<L.length;I+=1)if(!It(L[I],w))return!1}if(s.type==="MultiPolygon"){var D=qo(s.coordinates,m,g),N=vf(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var V=0,q=N;V<q.length;V+=1)if(!xr(q[V],D))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(s.type==="Polygon"){var w=Aa(s.coordinates,m,g),C=Rc(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var I=0,L=C;I<L.length;I+=1)if(!ma(L[I],w))return!1}if(s.type==="MultiPolygon"){var D=qo(s.coordinates,m,g),N=Rc(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var V=0,q=N;V<q.length;V+=1)if(!Ya(q[V],D))return!1}return!0}(t,this.geometries)}return!1},os.prototype.eachChild=function(){},os.prototype.outputDefined=function(){return!0},os.prototype.serialize=function(){return["within",this.geojson]};var pu=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};pu.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new pu(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},pu.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},pu.prototype.eachChild=function(){},pu.prototype.outputDefined=function(){return!1},pu.prototype.serialize=function(){return["var",this.name]};var gs=function(t,a,s,p,m){a===void 0&&(a=[]),p===void 0&&(p=new Wr),m===void 0&&(m=[]),this.registry=t,this.path=a,this.key=a.map(function(g){return"["+g+"]"}).join(""),this.scope=p,this.errors=m,this.expectedType=s};function kl(t,a){for(var s,p=t.length-1,m=0,g=p,w=0;m<=g;)if((s=t[w=Math.floor((m+g)/2)])<=a){if(w===p||a<t[w+1])return w;m=w+1}else{if(!(s>a))throw new ua("Input is not a number.");g=w-1}return 0}gs.prototype.parse=function(t,a,s,p,m){return m===void 0&&(m={}),a?this.concat(a,s,p)._parse(t,m):this._parse(t,m)},gs.prototype._parse=function(t,a){function s(L,D,N){return N==="assert"?new wi(D,[L]):N==="coerce"?new Xo(D,[L]):L}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[p];if(m){var g=m.parse(t,this);if(!g)return null;if(this.expectedType){var w=this.expectedType,C=g.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||C.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(w,C))return null}else g=s(g,w,a.typeAnnotation||"coerce");else g=s(g,w,a.typeAnnotation||"assert")}if(!(g instanceof Ca)&&g.type.kind!=="resolvedImage"&&function L(D){if(D instanceof pu)return L(D.boundExpression);if(D instanceof Ta&&D.name==="error"||D instanceof va||D instanceof os)return!1;var N=D instanceof Xo||D instanceof wi,V=!0;return D.eachChild(function(q){V=N?V&&L(q):V&&q instanceof Ca}),!!V&&Lu(D)&&ol(D,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var I=new Yo;try{g=new Ca(g.type,g.evaluate(I))}catch(L){return this.error(L.message),null}}return g}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},gs.prototype.concat=function(t,a,s){var p=typeof t=="number"?this.path.concat(t):this.path,m=s?this.scope.concat(s):this.scope;return new gs(this.registry,p,a||null,m,this.errors)},gs.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var p=""+this.key+a.map(function(m){return"["+m+"]"}).join("");this.errors.push(new er(p,t))},gs.prototype.checkSubtype=function(t,a){var s=mi(t,a);return s&&this.error(s),s};var Eo=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var p=0,m=s;p<m.length;p+=1){var g=m[p],w=g[1];this.labels.push(g[0]),this.outputs.push(w)}};function la(t,a,s){return t*(1-s)+a*s}Eo.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Rt);if(!s)return null;var p=[],m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(var g=1;g<t.length;g+=2){var w=g===1?-1/0:t[g],C=t[g+1],I=g,L=g+1;if(typeof w!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);var D=a.parse(C,L,m);if(!D)return null;m=m||D.type,p.push([w,D])}return new Eo(m,s,p)},Eo.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var p=this.input.evaluate(t);if(p<=a[0])return s[0].evaluate(t);var m=a.length;return p>=a[m-1]?s[m-1].evaluate(t):s[kl(a,p)].evaluate(t)},Eo.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},Eo.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Eo.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var Ll=Object.freeze({__proto__:null,number:la,color:function(t,a,s){return new Jn(la(t.r,a.r,s),la(t.g,a.g,s),la(t.b,a.b,s),la(t.a,a.a,s))},array:function(t,a,s){return t.map(function(p,m){return la(p,a[m],s)})}}),Dc=6/29*3*(6/29),mf=Math.PI/180,hu=180/Math.PI;function du(t){return t>.008856451679035631?Math.pow(t,1/3):t/Dc+4/29}function Fc(t){return t>6/29?t*t*t:Dc*(t-4/29)}function Ii(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function vu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function qf(t){var a=vu(t.r),s=vu(t.g),p=vu(t.b),m=du((.4124564*a+.3575761*s+.1804375*p)/.95047),g=du((.2126729*a+.7151522*s+.072175*p)/1);return{l:116*g-16,a:500*(m-g),b:200*(g-du((.0193339*a+.119192*s+.9503041*p)/1.08883)),alpha:t.a}}function Kf(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,p=isNaN(t.b)?a:a-t.b/200;return a=1*Fc(a),s=.95047*Fc(s),p=1.08883*Fc(p),new Jn(Ii(3.2404542*s-1.5371385*a-.4985314*p),Ii(-.969266*s+1.8760108*a+.041556*p),Ii(.0556434*s-.2040259*a+1.0572252*p),t.alpha)}function $f(t,a,s){var p=a-t;return t+s*(p>180||p<-180?p-360*Math.round(p/360):p)}var oc={forward:qf,reverse:Kf,interpolate:function(t,a,s){return{l:la(t.l,a.l,s),a:la(t.a,a.a,s),b:la(t.b,a.b,s),alpha:la(t.alpha,a.alpha,s)}}},Rl={forward:function(t){var a=qf(t),s=a.l,p=a.a,m=a.b,g=Math.atan2(m,p)*hu;return{h:g<0?g+360:g,c:Math.sqrt(p*p+m*m),l:s,alpha:t.a}},reverse:function(t){var a=t.h*mf,s=t.c;return Kf({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:$f(t.h,a.h,s),c:la(t.c,a.c,s),l:la(t.l,a.l,s),alpha:la(t.alpha,a.alpha,s)}}},Jf=Object.freeze({__proto__:null,lab:oc,hcl:Rl}),Yi=function(t,a,s,p,m){this.type=t,this.operator=a,this.interpolation=s,this.input=p,this.labels=[],this.outputs=[];for(var g=0,w=m;g<w.length;g+=1){var C=w[g],I=C[1];this.labels.push(C[0]),this.outputs.push(I)}};function yf(t,a,s,p){var m=p-s,g=t-s;return m===0?0:a===1?g/m:(Math.pow(a,g)-1)/(Math.pow(a,m)-1)}Yi.interpolationFactor=function(t,a,s,p){var m=0;if(t.name==="exponential")m=yf(a,t.base,s,p);else if(t.name==="linear")m=yf(a,1,s,p);else if(t.name==="cubic-bezier"){var g=t.controlPoints;m=new Z(g[0],g[1],g[2],g[3]).solve(yf(a,1,s,p))}return m},Yi.parse=function(t,a){var s=t[0],p=t[1],m=t[2],g=t.slice(3);if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var w=p[1];if(typeof w!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:w}}else{if(p[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(p[0]),1,0);var C=p.slice(1);if(C.length!==4||C.some(function(ze){return typeof ze!="number"||ze<0||ze>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:C}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(m=a.parse(m,2,Rt)))return null;var I=[],L=null;s==="interpolate-hcl"||s==="interpolate-lab"?L=Pr:a.expectedType&&a.expectedType.kind!=="value"&&(L=a.expectedType);for(var D=0;D<g.length;D+=2){var N=g[D],V=g[D+1],q=D+3,xe=D+4;if(typeof N!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(I.length&&I[I.length-1][0]>=N)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);var Ce=a.parse(V,xe,L);if(!Ce)return null;L=L||Ce.type,I.push([N,Ce])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new Yi(L,s,p,m,I):a.error("Type "+jn(L)+" is not interpolatable.")},Yi.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var p=this.input.evaluate(t);if(p<=a[0])return s[0].evaluate(t);var m=a.length;if(p>=a[m-1])return s[m-1].evaluate(t);var g=kl(a,p),w=Yi.interpolationFactor(this.interpolation,p,a[g],a[g+1]),C=s[g].evaluate(t),I=s[g+1].evaluate(t);return this.operator==="interpolate"?Ll[this.type.kind.toLowerCase()](C,I,w):this.operator==="interpolate-hcl"?Rl.reverse(Rl.interpolate(Rl.forward(C),Rl.forward(I),w)):oc.reverse(oc.interpolate(oc.forward(C),oc.forward(I),w))},Yi.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},Yi.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Yi.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var Ru=function(t,a){this.type=t,this.args=a};Ru.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,p=a.expectedType;p&&p.kind!=="value"&&(s=p);for(var m=[],g=0,w=t.slice(1);g<w.length;g+=1){var C=a.parse(w[g],1+m.length,s,void 0,{typeAnnotation:"omit"});if(!C)return null;s=s||C.type,m.push(C)}var I=p&&m.some(function(L){return mi(p,L.type)});return new Ru(I?Lr:s,m)},Ru.prototype.evaluate=function(t){for(var a,s=null,p=0,m=0,g=this.args;m<g.length&&(p++,(s=g[m].evaluate(t))&&s instanceof ea&&!s.available&&(a||(a=s.name),s=null,p===this.args.length&&(s=a)),s===null);m+=1);return s},Ru.prototype.eachChild=function(t){this.args.forEach(t)},Ru.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Ru.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Da=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};Da.prototype.evaluate=function(t){return this.result.evaluate(t)},Da.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},Da.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],p=1;p<t.length-1;p+=2){var m=t[p];if(typeof m!="string")return a.error("Expected string, but found "+typeof m+" instead.",p);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",p);var g=a.parse(t[p+1],p+1);if(!g)return null;s.push([m,g])}var w=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return w?new Da(s,w):null},Da.prototype.outputDefined=function(){return this.result.outputDefined()},Da.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var p=s[a];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var Ds=function(t,a,s){this.type=t,this.index=a,this.input=s};Ds.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Rt),p=a.parse(t[2],2,Pn(a.expectedType||Lr));return s&&p?new Ds(p.type.itemType,s,p):null},Ds.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new ua("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new ua("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new ua("Array index must be an integer, but found "+a+" instead.");return s[a]},Ds.prototype.eachChild=function(t){t(this.index),t(this.input)},Ds.prototype.outputDefined=function(){return!1},Ds.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Co=function(t,a){this.type=Ir,this.needle=t,this.haystack=a};Co.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Lr);return s&&p?Li(s.type,[Ir,Dr,Rt,Rr,Lr])?new Co(s,p):a.error("Expected first argument to be of type boolean, string, number or null, but found "+jn(s.type)+" instead"):null},Co.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Wn(a,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+jn(ji(a))+" instead.");if(!Wn(s,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+jn(ji(s))+" instead.");return s.indexOf(a)>=0},Co.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Co.prototype.outputDefined=function(){return!0},Co.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var mu=function(t,a,s){this.type=Rt,this.needle=t,this.haystack=a,this.fromIndex=s};mu.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Lr);if(!s||!p)return null;if(!Li(s.type,[Ir,Dr,Rt,Rr,Lr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+jn(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Rt);return m?new mu(s,p,m):null}return new mu(s,p)},mu.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Wn(a,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+jn(ji(a))+" instead.");if(!Wn(s,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+jn(ji(s))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return s.indexOf(a,p)}return s.indexOf(a)},mu.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},mu.prototype.outputDefined=function(){return!1},mu.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ko=function(t,a,s,p,m,g){this.inputType=t,this.type=a,this.input=s,this.cases=p,this.outputs=m,this.otherwise=g};Ko.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);for(var m={},g=[],w=2;w<t.length-1;w+=2){var C=t[w],I=t[w+1];Array.isArray(C)||(C=[C]);var L=a.concat(w);if(C.length===0)return L.error("Expected at least one branch label.");for(var D=0,N=C;D<N.length;D+=1){var V=N[D];if(typeof V!="number"&&typeof V!="string")return L.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof V=="number"&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,ji(V)))return null}else s=ji(V);if(m[String(V)]!==void 0)return L.error("Branch labels must be unique.");m[String(V)]=g.length}var q=a.parse(I,w,p);if(!q)return null;p=p||q.type,g.push(q)}var xe=a.parse(t[1],1,Lr);if(!xe)return null;var Ce=a.parse(t[t.length-1],t.length-1,p);return Ce?xe.type.kind!=="value"&&a.concat(1).checkSubtype(s,xe.type)?null:new Ko(s,p,xe,m,g,Ce):null},Ko.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ji(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},Ko.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Ko.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Ko.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],p={},m=0,g=Object.keys(this.cases).sort();m<g.length;m+=1){var w=g[m];(N=p[this.cases[w]])===void 0?(p[this.cases[w]]=s.length,s.push([this.cases[w],[w]])):s[N][1].push(w)}for(var C=function(q){return t.inputType.kind==="number"?Number(q):q},I=0,L=s;I<L.length;I+=1){var D=L[I],N=D[0],V=D[1];a.push(V.length===1?C(V[0]):V.map(C)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var yu=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};yu.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var p=[],m=1;m<t.length-1;m+=2){var g=a.parse(t[m],m,Ir);if(!g)return null;var w=a.parse(t[m+1],m+1,s);if(!w)return null;p.push([g,w]),s=s||w.type}var C=a.parse(t[t.length-1],t.length-1,s);return C?new yu(s,p,C):null},yu.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var p=s[a],m=p[1];if(p[0].evaluate(t))return m.evaluate(t)}return this.otherwise.evaluate(t)},yu.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var p=s[a],m=p[1];t(p[0]),t(m)}t(this.otherwise)},yu.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},yu.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var To=function(t,a,s,p){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=p};function sc(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Qf(t,a,s,p){return p.compare(a,s)===0}function Di(t,a,s){var p=t!=="=="&&t!=="!=";return function(){function m(g,w,C){this.type=Ir,this.lhs=g,this.rhs=w,this.collator=C,this.hasUntypedArgument=g.type.kind==="value"||w.type.kind==="value"}return m.parse=function(g,w){if(g.length!==3&&g.length!==4)return w.error("Expected two or three arguments.");var C=g[0],I=w.parse(g[1],1,Lr);if(!I)return null;if(!sc(C,I.type))return w.concat(1).error('"'+C+`" comparisons are not supported for type '`+jn(I.type)+"'.");var L=w.parse(g[2],2,Lr);if(!L)return null;if(!sc(C,L.type))return w.concat(2).error('"'+C+`" comparisons are not supported for type '`+jn(L.type)+"'.");if(I.type.kind!==L.type.kind&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error("Cannot compare types '"+jn(I.type)+"' and '"+jn(L.type)+"'.");p&&(I.type.kind==="value"&&L.type.kind!=="value"?I=new wi(L.type,[I]):I.type.kind!=="value"&&L.type.kind==="value"&&(L=new wi(I.type,[L])));var D=null;if(g.length===4){if(I.type.kind!=="string"&&L.type.kind!=="string"&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(!(D=w.parse(g[3],3,Un)))return null}return new m(I,L,D)},m.prototype.evaluate=function(g){var w=this.lhs.evaluate(g),C=this.rhs.evaluate(g);if(p&&this.hasUntypedArgument){var I=ji(w),L=ji(C);if(I.kind!==L.kind||I.kind!=="string"&&I.kind!=="number")throw new ua('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+I.kind+", "+L.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var D=ji(w),N=ji(C);if(D.kind!=="string"||N.kind!=="string")return a(g,w,C)}return this.collator?s(g,w,C,this.collator.evaluate(g)):a(g,w,C)},m.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var g=[t];return this.eachChild(function(w){g.push(w.serialize())}),g},m}()}To.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Rt);if(!s||!p)return null;if(!Li(s.type,[Pn(Lr),Dr,Lr]))return a.error("Expected first argument to be of type array or string, but found "+jn(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Rt);return m?new To(s.type,s,p,m):null}return new To(s.type,s,p)},To.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Wn(a,["string","array"]))throw new ua("Expected first argument to be of type array or string, but found "+jn(ji(a))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return a.slice(s,p)}return a.slice(s)},To.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},To.prototype.outputDefined=function(){return!1},To.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Sp=Di("==",function(t,a,s){return a===s},Qf),uc=Di("!=",function(t,a,s){return a!==s},function(t,a,s,p){return!Qf(0,a,s,p)}),ep=Di("<",function(t,a,s){return a<s},function(t,a,s,p){return p.compare(a,s)<0}),gf=Di(">",function(t,a,s){return a>s},function(t,a,s,p){return p.compare(a,s)>0}),_f=Di("<=",function(t,a,s){return a<=s},function(t,a,s,p){return p.compare(a,s)<=0}),ca=Di(">=",function(t,a,s){return a>=s},function(t,a,s,p){return p.compare(a,s)>=0}),gu=function(t,a,s,p,m){this.type=Dr,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=p,this.maxFractionDigits=m};gu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Rt);if(!s)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");var m=null;if(p.locale&&!(m=a.parse(p.locale,1,Dr)))return null;var g=null;if(p.currency&&!(g=a.parse(p.currency,1,Dr)))return null;var w=null;if(p["min-fraction-digits"]&&!(w=a.parse(p["min-fraction-digits"],1,Rt)))return null;var C=null;return p["max-fraction-digits"]&&!(C=a.parse(p["max-fraction-digits"],1,Rt))?null:new gu(s,m,g,w,C)},gu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},gu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},gu.prototype.outputDefined=function(){return!1},gu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Du=function(t){this.type=Rt,this.input=t};Du.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+jn(s.type)+" instead."):new Du(s):null},Du.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ua("Expected value to be of type string or array, but found "+jn(ji(a))+" instead.")},Du.prototype.eachChild=function(t){t(this.input)},Du.prototype.outputDefined=function(){return!1},Du.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Ao={"==":Sp,"!=":uc,">":gf,"<":ep,">=":ca,"<=":_f,array:wi,at:Ds,boolean:wi,case:yu,coalesce:Ru,collator:va,format:mo,image:Xa,in:Co,"index-of":mu,interpolate:Yi,"interpolate-hcl":Yi,"interpolate-lab":Yi,length:Du,let:Da,literal:Ca,match:Ko,number:wi,"number-format":gu,object:wi,slice:To,step:Eo,string:wi,"to-boolean":Xo,"to-color":Xo,"to-number":Xo,"to-string":Xo,var:pu,within:os};function Bc(t,a){var s=a[0],p=a[1],m=a[2],g=a[3];s=s.evaluate(t),p=p.evaluate(t),m=m.evaluate(t);var w=g?g.evaluate(t):1,C=ku(s,p,m,w);if(C)throw new ua(C);return new Jn(s/255*w,p/255*w,m/255*w,w)}function lc(t,a){return t in a}function _u(t,a){var s=a[t];return s===void 0?null:s}function Ks(t){return{type:t}}function cc(t){return{result:"success",value:t}}function Fs(t){return{result:"error",value:t}}function $s(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function xf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function sl(t){return!!t.expression&&t.expression.interpolated}function Ni(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Nc(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function tp(t){return t}function Dl(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function rp(t,a,s,p,m){return Dl(typeof s===m?p[s]:void 0,t.default,a.default)}function bf(t,a,s){if(Ni(s)!=="number")return Dl(t.default,a.default);var p=t.stops.length;if(p===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[p-1][0])return t.stops[p-1][1];var m=kl(t.stops.map(function(g){return g[0]}),s);return t.stops[m][1]}function ul(t,a,s){var p=t.base!==void 0?t.base:1;if(Ni(s)!=="number")return Dl(t.default,a.default);var m=t.stops.length;if(m===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[m-1][0])return t.stops[m-1][1];var g=kl(t.stops.map(function(N){return N[0]}),s),w=function(N,V,q,xe){var Ce=xe-q,ze=N-q;return Ce===0?0:V===1?ze/Ce:(Math.pow(V,ze)-1)/(Math.pow(V,Ce)-1)}(s,p,t.stops[g][0],t.stops[g+1][0]),C=t.stops[g][1],I=t.stops[g+1][1],L=Ll[a.type]||tp;if(t.colorSpace&&t.colorSpace!=="rgb"){var D=Jf[t.colorSpace];L=function(N,V){return D.reverse(D.interpolate(D.forward(N),D.forward(V),w))}}return typeof C.evaluate=="function"?{evaluate:function(){for(var N=[],V=arguments.length;V--;)N[V]=arguments[V];var q=C.evaluate.apply(void 0,N),xe=I.evaluate.apply(void 0,N);if(q!==void 0&&xe!==void 0)return L(q,xe,w)}}:L(C,I,w)}function Fl(t,a,s){return a.type==="color"?s=Jn.parse(s):a.type==="formatted"?s=Bi.fromString(s.toString()):a.type==="resolvedImage"?s=ea.fromString(s.toString()):Ni(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),Dl(s,t.default,a.default)}Ta.register(Ao,{error:[{kind:"error"},[Dr],function(t,a){throw new ua(a[0].evaluate(t))}],typeof:[Dr,[Lr],function(t,a){return jn(ji(a[0].evaluate(t)))}],"to-rgba":[Pn(Rt,4),[Pr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Pr,[Rt,Rt,Rt],Bc],rgba:[Pr,[Rt,Rt,Rt,Rt],Bc],has:{type:Ir,overloads:[[[Dr],function(t,a){return lc(a[0].evaluate(t),t.properties())}],[[Dr,Bn],function(t,a){var s=a[1];return lc(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Lr,overloads:[[[Dr],function(t,a){return _u(a[0].evaluate(t),t.properties())}],[[Dr,Bn],function(t,a){var s=a[1];return _u(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Lr,[Dr],function(t,a){return _u(a[0].evaluate(t),t.featureState||{})}],properties:[Bn,[],function(t){return t.properties()}],"geometry-type":[Dr,[],function(t){return t.geometryType()}],id:[Lr,[],function(t){return t.id()}],zoom:[Rt,[],function(t){return t.globals.zoom}],"heatmap-density":[Rt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Rt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Lr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Rt,Ks(Rt),function(t,a){for(var s=0,p=0,m=a;p<m.length;p+=1)s+=m[p].evaluate(t);return s}],"*":[Rt,Ks(Rt),function(t,a){for(var s=1,p=0,m=a;p<m.length;p+=1)s*=m[p].evaluate(t);return s}],"-":{type:Rt,overloads:[[[Rt,Rt],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Rt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Rt,[Rt,Rt],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Rt,[Rt,Rt],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Rt,[],function(){return Math.LN2}],pi:[Rt,[],function(){return Math.PI}],e:[Rt,[],function(){return Math.E}],"^":[Rt,[Rt,Rt],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Rt,[Rt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Rt,[Rt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Rt,[Rt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Rt,[Rt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Rt,[Rt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Rt,[Rt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Rt,[Rt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Rt,[Rt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Rt,[Rt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Rt,[Rt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Rt,Ks(Rt),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Rt,Ks(Rt),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Rt,[Rt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Rt,[Rt],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Rt,[Rt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Rt,[Rt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Ir,[Dr,Lr],function(t,a){var s=a[0],p=a[1];return t.properties()[s.value]===p.value}],"filter-id-==":[Ir,[Lr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Ir,[Dr],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Ir,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m<g}],"filter-id-<":[Ir,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p<m}],"filter->":[Ir,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m>g}],"filter-id->":[Ir,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p>m}],"filter-<=":[Ir,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m<=g}],"filter-id-<=":[Ir,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p<=m}],"filter->=":[Ir,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m>=g}],"filter-id->=":[Ir,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p>=m}],"filter-has":[Ir,[Lr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Ir,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Ir,[Pn(Dr)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ir,[Pn(Lr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ir,[Dr,Pn(Lr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Ir,[Dr,Pn(Lr)],function(t,a){var s=a[0],p=a[1];return function(m,g,w,C){for(;w<=C;){var I=w+C>>1;if(g[I]===m)return!0;g[I]>m?C=I-1:w=I+1}return!1}(t.properties()[s.value],p.value,0,p.value.length-1)}],all:{type:Ir,overloads:[[[Ir,Ir],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[Ks(Ir),function(t,a){for(var s=0,p=a;s<p.length;s+=1)if(!p[s].evaluate(t))return!1;return!0}]]},any:{type:Ir,overloads:[[[Ir,Ir],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[Ks(Ir),function(t,a){for(var s=0,p=a;s<p.length;s+=1)if(p[s].evaluate(t))return!0;return!1}]]},"!":[Ir,[Ir],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Ir,[Dr],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[Dr,[Dr],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[Dr,[Dr],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[Dr,Ks(Lr),function(t,a){return a.map(function(s){return Wa(s.evaluate(t))}).join("")}],"resolved-locale":[Dr,[Un],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var Fu=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new Yo,this._defaultValue=a?function(s){return s.type==="color"&&Nc(s.default)?new Jn(0,0,0,0):s.type==="color"?Jn.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Bs(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ao}function ll(t,a){var s=new gs(Ao,[],a?function(m){var g={color:Pr,string:Dr,number:Rt,enum:Dr,boolean:Ir,formatted:li,resolvedImage:Nn};return m.type==="array"?Pn(g[m.value]||Lr,m.length):g[m.type]}(a):void 0),p=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?cc(new Fu(p,a)):Fs(s.errors)}Fu.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Fu.prototype.evaluate=function(t,a,s,p,m,g){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{var w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ua("Expected value to be one of "+Object.keys(this._enumValues).map(function(C){return JSON.stringify(C)}).join(", ")+", but found "+JSON.stringify(w)+" instead.");return w}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}};var cl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!ss(a.expression)};cl.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,p,m,g)},cl.prototype.evaluate=function(t,a,s,p,m,g){return this._styleExpression.evaluate(t,a,s,p,m,g)};var xu=function(t,a,s,p){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!ss(a.expression),this.interpolationType=p};function fc(t,a){if((t=ll(t,a)).result==="error")return t;var s=t.value.expression,p=Lu(s);if(!p&&!$s(a))return Fs([new er("","data expressions not supported")]);var m=ol(s,["zoom"]);if(!m&&!xf(a))return Fs([new er("","zoom expressions not supported")]);var g=function w(C){var I=null;if(C instanceof Da)I=w(C.result);else if(C instanceof Ru)for(var L=0,D=C.args;L<D.length&&!(I=w(D[L]));L+=1);else(C instanceof Eo||C instanceof Yi)&&C.input instanceof Ta&&C.input.name==="zoom"&&(I=C);return I instanceof er||C.eachChild(function(N){var V=w(N);V instanceof er?I=V:!I&&V?I=new er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&V&&I!==V&&(I=new er("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(s);return g||m?g instanceof er?Fs([g]):g instanceof Yi&&!sl(a)?Fs([new er("",'"interpolate" expressions cannot be used with this property')]):cc(g?new xu(p?"camera":"composite",t.value,g.labels,g instanceof Yi?g.interpolation:void 0):new cl(p?"constant":"source",t.value)):Fs([new er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}xu.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,p,m,g)},xu.prototype.evaluate=function(t,a,s,p,m,g){return this._styleExpression.evaluate(t,a,s,p,m,g)},xu.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?Yi.interpolationFactor(this.interpolationType,t,a,s):0};var fl=function(t,a){this._parameters=t,this._specification=a,$t(this,function s(p,m){var g,w,C,I=m.type==="color",L=p.stops&&typeof p.stops[0][0]=="object",D=L||!(L||p.property!==void 0),N=p.type||(sl(m)?"exponential":"interval");if(I&&((p=$t({},p)).stops&&(p.stops=p.stops.map(function(zr){return[zr[0],Jn.parse(zr[1])]})),p.default=Jn.parse(p.default?p.default:m.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!Jf[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(N==="exponential")g=ul;else if(N==="interval")g=bf;else if(N==="categorical"){g=rp,w=Object.create(null);for(var V=0,q=p.stops;V<q.length;V+=1){var xe=q[V];w[xe[0]]=xe[1]}C=typeof p.stops[0][0]}else{if(N!=="identity")throw new Error('Unknown function type "'+N+'"');g=Fl}if(L){for(var Ce={},ze=[],Le=0;Le<p.stops.length;Le++){var $e=p.stops[Le],ot=$e[0].zoom;Ce[ot]===void 0&&(Ce[ot]={zoom:ot,type:p.type,property:p.property,default:p.default,stops:[]},ze.push(ot)),Ce[ot].stops.push([$e[0].value,$e[1]])}for(var St=[],Pt=0,zt=ze;Pt<zt.length;Pt+=1){var Kt=zt[Pt];St.push([Ce[Kt].zoom,s(Ce[Kt],m)])}var Sr={name:"linear"};return{kind:"composite",interpolationType:Sr,interpolationFactor:Yi.interpolationFactor.bind(void 0,Sr),zoomStops:St.map(function(zr){return zr[0]}),evaluate:function(zr,nn){var Br=zr.zoom;return ul({stops:St,base:p.base},m,Br).evaluate(Br,nn)}}}if(D){var tr=N==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:tr,interpolationFactor:Yi.interpolationFactor.bind(void 0,tr),zoomStops:p.stops.map(function(zr){return zr[0]}),evaluate:function(zr){return g(p,m,zr.zoom,w,C)}}}return{kind:"source",evaluate:function(zr,nn){var Br=nn&&nn.properties?nn.properties[p.property]:void 0;return Br===void 0?Dl(p.default,m.default):g(p,m,Br,w,C)}}}(this._parameters,this._specification))};function _s(t){var a=t.key,s=t.value,p=t.valueSpec||{},m=t.objectElementValidators||{},g=t.style,w=t.styleSpec,C=[],I=Ni(s);if(I!=="object")return[new Pe(a,s,"object expected, "+I+" found")];for(var L in s){var D=L.split(".")[0],N=p[D]||p["*"],V=void 0;if(m[D])V=m[D];else if(p[D])V=ii;else if(m["*"])V=m["*"];else{if(!p["*"]){C.push(new Pe(a,s[L],'unknown property "'+L+'"'));continue}V=ii}C=C.concat(V({key:(a&&a+".")+L,value:s[L],valueSpec:N,style:g,styleSpec:w,object:s,objectKey:L},s))}for(var q in p)m[q]||p[q].required&&p[q].default===void 0&&s[q]===void 0&&C.push(new Pe(a,s,'missing required property "'+q+'"'));return C}function zc(t){var a=t.value,s=t.valueSpec,p=t.style,m=t.styleSpec,g=t.key,w=t.arrayElementValidator||ii;if(Ni(a)!=="array")return[new Pe(g,a,"array expected, "+Ni(a)+" found")];if(s.length&&a.length!==s.length)return[new Pe(g,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Pe(g,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var C={type:s.value,values:s.values};m.$version<7&&(C.function=s.function),Ni(s.value)==="object"&&(C=s.value);for(var I=[],L=0;L<a.length;L++)I=I.concat(w({array:a,arrayIndex:L,value:a[L],valueSpec:C,style:p,styleSpec:m,key:g+"["+L+"]"}));return I}function wf(t){var a=t.key,s=t.value,p=t.valueSpec,m=Ni(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new Pe(a,s,"number expected, "+m+" found")]:"minimum"in p&&s<p.minimum?[new Pe(a,s,s+" is less than the minimum value "+p.minimum)]:"maximum"in p&&s>p.maximum?[new Pe(a,s,s+" is greater than the maximum value "+p.maximum)]:[]}function Zc(t){var a,s,p,m=t.valueSpec,g=lr(t.value.type),w={},C=g!=="categorical"&&t.value.property===void 0,I=!C,L=Ni(t.value.stops)==="array"&&Ni(t.value.stops[0])==="array"&&Ni(t.value.stops[0][0])==="object",D=_s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(q){if(g==="identity")return[new Pe(q.key,q.value,'identity function may not have a "stops" property')];var xe=[],Ce=q.value;return xe=xe.concat(zc({key:q.key,value:Ce,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:N})),Ni(Ce)==="array"&&Ce.length===0&&xe.push(new Pe(q.key,Ce,"array must have at least one stop")),xe},default:function(q){return ii({key:q.key,value:q.value,valueSpec:m,style:q.style,styleSpec:q.styleSpec})}}});return g==="identity"&&C&&D.push(new Pe(t.key,t.value,'missing required property "property"')),g==="identity"||t.value.stops||D.push(new Pe(t.key,t.value,'missing required property "stops"')),g==="exponential"&&t.valueSpec.expression&&!sl(t.valueSpec)&&D.push(new Pe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(I&&!$s(t.valueSpec)?D.push(new Pe(t.key,t.value,"property functions not supported")):C&&!xf(t.valueSpec)&&D.push(new Pe(t.key,t.value,"zoom functions not supported"))),g!=="categorical"&&!L||t.value.property!==void 0||D.push(new Pe(t.key,t.value,'"property" property is required')),D;function N(q){var xe=[],Ce=q.value,ze=q.key;if(Ni(Ce)!=="array")return[new Pe(ze,Ce,"array expected, "+Ni(Ce)+" found")];if(Ce.length!==2)return[new Pe(ze,Ce,"array length 2 expected, length "+Ce.length+" found")];if(L){if(Ni(Ce[0])!=="object")return[new Pe(ze,Ce,"object expected, "+Ni(Ce[0])+" found")];if(Ce[0].zoom===void 0)return[new Pe(ze,Ce,"object stop key must have zoom")];if(Ce[0].value===void 0)return[new Pe(ze,Ce,"object stop key must have value")];if(p&&p>lr(Ce[0].zoom))return[new Pe(ze,Ce[0].zoom,"stop zoom values must appear in ascending order")];lr(Ce[0].zoom)!==p&&(p=lr(Ce[0].zoom),s=void 0,w={}),xe=xe.concat(_s({key:ze+"[0]",value:Ce[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:wf,value:V}}))}else xe=xe.concat(V({key:ze+"[0]",value:Ce[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},Ce));return Bs(pt(Ce[1]))?xe.concat([new Pe(ze+"[1]",Ce[1],"expressions are not allowed in function stops.")]):xe.concat(ii({key:ze+"[1]",value:Ce[1],valueSpec:m,style:q.style,styleSpec:q.styleSpec}))}function V(q,xe){var Ce=Ni(q.value),ze=lr(q.value),Le=q.value!==null?q.value:xe;if(a){if(Ce!==a)return[new Pe(q.key,Le,Ce+" stop domain type must match previous stop domain type "+a)]}else a=Ce;if(Ce!=="number"&&Ce!=="string"&&Ce!=="boolean")return[new Pe(q.key,Le,"stop domain value must be a number, string, or boolean")];if(Ce!=="number"&&g!=="categorical"){var $e="number expected, "+Ce+" found";return $s(m)&&g===void 0&&($e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(q.key,Le,$e)]}return g!=="categorical"||Ce!=="number"||isFinite(ze)&&Math.floor(ze)===ze?g!=="categorical"&&Ce==="number"&&s!==void 0&&ze<s?[new Pe(q.key,Le,"stop domain values must appear in ascending order")]:(s=ze,g==="categorical"&&ze in w?[new Pe(q.key,Le,"stop domain values must be unique")]:(w[ze]=!0,[])):[new Pe(q.key,Le,"integer expected, found "+ze)]}}function bu(t){var a=(t.expressionContext==="property"?fc:ll)(pt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(p){return new Pe(""+t.key+p.key,t.value,p.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Pe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ss(s))return[new Pe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!ss(s))return[new Pe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ol(s,["zoom","feature-state"]))return[new Pe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Lu(s))return[new Pe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bl(t){var a=t.key,s=t.value,p=t.valueSpec,m=[];return Array.isArray(p.values)?p.values.indexOf(lr(s))===-1&&m.push(new Pe(a,s,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(p.values).indexOf(lr(s))===-1&&m.push(new Pe(a,s,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(s)+" found")),m}function Nl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var p=s[a];if(!Nl(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}fl.deserialize=function(t){return new fl(t._parameters,t._specification)},fl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var wu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Nl(t)||(t=Su(t));var a=ll(t,wu);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,p,m){return a.value.evaluate(s,p,{},m)},needGeometry:function s(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var m=1;m<p.length;m++)if(s(p[m]))return!0;return!1}(t)}}function Sf(t,a){return t<a?-1:t>a?1:0}function Su(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Ef(t[1],t[2],"=="):s==="!="?pl(Ef(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Ef(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(Su))):s==="all"?["all"].concat(t.slice(1).map(Su)):s==="none"?["all"].concat(t.slice(1).map(Su).map(pl)):s==="in"?np(t[1],t.slice(2)):s==="!in"?pl(np(t[1],t.slice(2))):s==="has"?Cf(t[1]):s==="!has"?pl(Cf(t[1])):s!=="within"||t}function Ef(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function np(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(Sf)]]:["filter-in-small",t,["literal",a]]}}function Cf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pl(t){return["!",t]}function Uc(t){return Nl(pt(t.value))?bu($t({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var p=s.value,m=s.key;if(Ni(p)!=="array")return[new Pe(m,p,"array expected, "+Ni(p)+" found")];var g,w=s.styleSpec,C=[];if(p.length<1)return[new Pe(m,p,"filter array must have at least 1 element")];switch(C=C.concat(Bl({key:m+"[0]",value:p[0],valueSpec:w.filter_operator,style:s.style,styleSpec:s.styleSpec})),lr(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&lr(p[1])==="$type"&&C.push(new Pe(m,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&C.push(new Pe(m,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(g=Ni(p[1]))!=="string"&&C.push(new Pe(m+"[1]",p[1],"string expected, "+g+" found"));for(var I=2;I<p.length;I++)g=Ni(p[I]),lr(p[1])==="$type"?C=C.concat(Bl({key:m+"["+I+"]",value:p[I],valueSpec:w.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&C.push(new Pe(m+"["+I+"]",p[I],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var L=1;L<p.length;L++)C=C.concat(a({key:m+"["+L+"]",value:p[L],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ni(p[1]),p.length!==2?C.push(new Pe(m,p,'filter array for "'+p[0]+'" operator must have 2 elements')):g!=="string"&&C.push(new Pe(m+"[1]",p[1],"string expected, "+g+" found"));break;case"within":g=Ni(p[1]),p.length!==2?C.push(new Pe(m,p,'filter array for "'+p[0]+'" operator must have 2 elements')):g!=="object"&&C.push(new Pe(m+"[1]",p[1],"object expected, "+g+" found"))}return C}(t)}function pc(t,a){var s=t.key,p=t.style,m=t.styleSpec,g=t.value,w=t.objectKey,C=m[a+"_"+t.layerType];if(!C)return[];var I=w.match(/^(.*)-transition$/);if(a==="paint"&&I&&C[I[1]]&&C[I[1]].transition)return ii({key:s,value:g,valueSpec:m.transition,style:p,styleSpec:m});var L,D=t.valueSpec||C[w];if(!D)return[new Pe(s,g,'unknown property "'+w+'"')];if(Ni(g)==="string"&&$s(D)&&!D.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Pe(s,g,'"'+w+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(L[1])+" }`.")];var N=[];return t.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&N.push(new Pe(s,g,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Nc(pt(g))&&lr(g.type)==="identity"&&N.push(new Pe(s,g,'"text-font" does not support identity functions'))),N.concat(ii({key:t.key,value:g,valueSpec:D,style:p,styleSpec:m,expressionContext:"property",propertyType:a,propertyKey:w}))}function Tf(t){return pc(t,"paint")}function hl(t){return pc(t,"layout")}function ip(t){var a=[],s=t.value,p=t.key,m=t.style,g=t.styleSpec;s.type||s.ref||a.push(new Pe(p,s,'either "type" or "ref" is required'));var w,C=lr(s.type),I=lr(s.ref);if(s.id)for(var L=lr(s.id),D=0;D<t.arrayIndex;D++){var N=m.layers[D];lr(N.id)===L&&a.push(new Pe(p,s.id,'duplicate layer id "'+s.id+'", previously used at line '+N.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(xe){xe in s&&a.push(new Pe(p,s[xe],'"'+xe+'" is prohibited for ref layers'))}),m.layers.forEach(function(xe){lr(xe.id)===I&&(w=xe)}),w?w.ref?a.push(new Pe(p,s.ref,"ref cannot reference another ref layer")):C=lr(w.type):a.push(new Pe(p,s.ref,'ref layer "'+I+'" not found'));else if(C!=="background")if(s.source){var V=m.sources&&m.sources[s.source],q=V&&lr(V.type);V?q==="vector"&&C==="raster"?a.push(new Pe(p,s.source,'layer "'+s.id+'" requires a raster source')):q==="raster"&&C!=="raster"?a.push(new Pe(p,s.source,'layer "'+s.id+'" requires a vector source')):q!=="vector"||s["source-layer"]?q==="raster-dem"&&C!=="hillshade"?a.push(new Pe(p,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!s.paint||!s.paint["line-gradient"]||q==="geojson"&&V.lineMetrics||a.push(new Pe(p,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Pe(p,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Pe(p,s.source,'source "'+s.source+'" not found'))}else a.push(new Pe(p,s,'missing required property "source"'));return a=a.concat(_s({key:p,value:s,valueSpec:g.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ii({key:p+".type",value:s.type,valueSpec:g.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Uc,layout:function(xe){return _s({layer:s,key:xe.key,value:xe.value,style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{"*":function(Ce){return hl($t({layerType:C},Ce))}}})},paint:function(xe){return _s({layer:s,key:xe.key,value:xe.value,style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{"*":function(Ce){return Tf($t({layerType:C},Ce))}}})}}}))}function Tn(t){var a=t.value,s=t.key,p=Ni(a);return p!=="string"?[new Pe(s,a,"string expected, "+p+" found")]:[]}var $r={promoteId:function(t){var a=t.key,s=t.value;if(Ni(s)==="string")return Tn({key:a,value:s});var p=[];for(var m in s)p.push.apply(p,Tn({key:a+"."+m,value:s[m]}));return p}};function Zl(t){var a=t.value,s=t.key,p=t.styleSpec,m=t.style;if(!a.type)return[new Pe(s,a,'"type" is required')];var g,w=lr(a.type);switch(w){case"vector":case"raster":case"raster-dem":return _s({key:s,value:a,valueSpec:p["source_"+w.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:$r});case"geojson":if(g=_s({key:s,value:a,valueSpec:p.source_geojson,style:m,styleSpec:p,objectElementValidators:$r}),a.cluster)for(var C in a.clusterProperties){var I=a.clusterProperties[C],L=I[0],D=typeof L=="string"?[L,["accumulated"],["get",C]]:L;g.push.apply(g,bu({key:s+"."+C+".map",value:I[1],expressionContext:"cluster-map"})),g.push.apply(g,bu({key:s+"."+C+".reduce",value:D,expressionContext:"cluster-reduce"}))}return g;case"video":return _s({key:s,value:a,valueSpec:p.source_video,style:m,styleSpec:p});case"image":return _s({key:s,value:a,valueSpec:p.source_image,style:m,styleSpec:p});case"canvas":return[new Pe(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bl({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:p})}}function Bu(t){var a=t.value,s=t.styleSpec,p=s.light,m=t.style,g=[],w=Ni(a);if(a===void 0)return g;if(w!=="object")return g.concat([new Pe("light",a,"object expected, "+w+" found")]);for(var C in a){var I=C.match(/^(.*)-transition$/);g=g.concat(I&&p[I[1]]&&p[I[1]].transition?ii({key:C,value:a[C],valueSpec:s.transition,style:m,styleSpec:s}):p[C]?ii({key:C,value:a[C],valueSpec:p[C],style:m,styleSpec:s}):[new Pe(C,a[C],'unknown property "'+C+'"')])}return g}var Nu={"*":function(){return[]},array:zc,boolean:function(t){var a=t.value,s=t.key,p=Ni(a);return p!=="boolean"?[new Pe(s,a,"boolean expected, "+p+" found")]:[]},number:wf,color:function(t){var a=t.key,s=t.value,p=Ni(s);return p!=="string"?[new Pe(a,s,"color expected, "+p+" found")]:zn(s)===null?[new Pe(a,s,'color expected, "'+s+'" found')]:[]},constants:nt,enum:Bl,filter:Uc,function:Zc,layer:ip,object:_s,source:Zl,light:Bu,string:Tn,formatted:function(t){return Tn(t).length===0?[]:bu(t)},resolvedImage:function(t){return Tn(t).length===0?[]:bu(t)}};function ii(t){var a=t.value,s=t.valueSpec,p=t.styleSpec;return s.expression&&Nc(lr(a))?Zc(t):s.expression&&Bs(pt(a))?bu(t):s.type&&Nu[s.type]?Nu[s.type](t):_s($t({},t,{valueSpec:s.type?p[s.type]:s}))}function Vi(t){var a=t.value,s=t.key,p=Tn(t);return p.length||(a.indexOf("{fontstack}")===-1&&p.push(new Pe(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&p.push(new Pe(s,a,'"glyphs" url must include a "{range}" token'))),p}function xs(t,a){a===void 0&&(a=te);var s=[];return s=s.concat(ii({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Vi,"*":function(){return[]}}})),t.constants&&(s=s.concat(nt({key:"constants",value:t.constants,style:t,styleSpec:a}))),jc(s)}function jc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function hc(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return jc(t.apply(this,a))}}xs.source=hc(Zl),xs.light=hc(Bu),xs.layer=hc(ip),xs.filter=hc(Uc),xs.paintProperty=hc(Tf),xs.layoutProperty=hc(hl);var Vc=xs,oh=Vc.light,sh=Vc.paintProperty,dc=Vc.layoutProperty;function zu(t,a){var s=!1;if(a&&a.length)for(var p=0,m=a;p<m.length;p+=1)t.fire(new Ze(new Error(m[p].message))),s=!0;return s}var Zu=fa;function fa(t,a,s){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(a=m[1])+2*(s=m[2]);for(var g=0;g<this.d*this.d;g++){var w=m[3+g],C=m[3+g+1];p.push(w===C?null:m.subarray(w,C))}var I=m[3+p.length+1];this.keys=m.subarray(m[3+p.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var L=0;L<this.d*this.d;L++)p.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var D=s/a*t;this.min=-D,this.max=t+D}fa.prototype.insert=function(t,a,s,p,m){this._forEachCell(a,s,p,m,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(m)},fa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fa.prototype._insertCell=function(t,a,s,p,m,g){this.cells[m].push(g)},fa.prototype.query=function(t,a,s,p,m){var g=this.min,w=this.max;if(t<=g&&a<=g&&w<=s&&w<=p&&!m)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(t,a,s,p,this._queryCell,C,{},m),C},fa.prototype._queryCell=function(t,a,s,p,m,g,w,C){var I=this.cells[m];if(I!==null)for(var L=this.keys,D=this.bboxes,N=0;N<I.length;N++){var V=I[N];if(w[V]===void 0){var q=4*V;(C?C(D[q+0],D[q+1],D[q+2],D[q+3]):t<=D[q+2]&&a<=D[q+3]&&s>=D[q+0]&&p>=D[q+1])?(w[V]=!0,g.push(L[V])):w[V]=!1}}},fa.prototype._forEachCell=function(t,a,s,p,m,g,w,C){for(var I=this._convertToCellCoord(t),L=this._convertToCellCoord(a),D=this._convertToCellCoord(s),N=this._convertToCellCoord(p),V=I;V<=D;V++)for(var q=L;q<=N;q++){var xe=this.d*q+V;if((!C||C(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&m.call(this,t,a,s,p,xe,g,w,C))return}},fa.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},fa.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},fa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,p=0;p<this.cells.length;p++)s+=this.cells[p].length;var m=new Int32Array(a+s+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var g=a,w=0;w<t.length;w++){var C=t[w];m[3+w]=g,m.set(C,g),g+=C.length}return m[3+t.length]=g,m.set(this.keys,g),m[3+t.length+1]=g+=this.keys.length,m.set(this.bboxes,g),g+=this.bboxes.length,m.buffer};var Fo=fe.ImageData,Ul=fe.ImageBitmap,Ma={};function Hr(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),Ma[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var us in Hr("Object",Object),Zu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Zu.deserialize=function(t){return new Zu(t.buffer)},Hr("Grid",Zu),Hr("Color",Jn),Hr("Error",Error),Hr("ResolvedImage",ea),Hr("StylePropertyFunction",fl),Hr("StyleExpression",Fu,{omit:["_evaluator"]}),Hr("ZoomDependentExpression",xu),Hr("ZoomConstantExpression",cl),Hr("CompoundExpression",Ta,{omit:["_evaluate"]}),Ao)Ao[us]._classRegistryKey||Hr("Expression_"+us,Ao[us]);function Gc(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function jl(t){return Ul&&t instanceof Ul}function Ns(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gc(t)||jl(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Fo)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],m=0,g=t;m<g.length;m+=1)p.push(Ns(g[m],a));return p}if(typeof t=="object"){var w=t.constructor,C=w._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");var I=w.serialize?w.serialize(t,a):{};if(!w.serialize){for(var L in t)if(t.hasOwnProperty(L)&&!(Ma[C].omit.indexOf(L)>=0)){var D=t[L];I[L]=Ma[C].shallow.indexOf(L)>=0?D:Ns(D,a)}t instanceof Error&&(I.message=t.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(I.$name=C),I}throw new Error("can't serialize object of type "+typeof t)}function ls(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gc(t)||jl(t)||ArrayBuffer.isView(t)||t instanceof Fo)return t;if(Array.isArray(t))return t.map(ls);if(typeof t=="object"){var a=t.$name||"Object",s=Ma[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var p=Object.create(s.prototype),m=0,g=Object.keys(t);m<g.length;m+=1){var w=g[m];if(w!=="$name"){var C=t[w];p[w]=Ma[a].shallow.indexOf(w)>=0?C:ls(C)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var dl=function(){this.first=!0};dl.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var hr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Af(t){for(var a=0,s=t;a<s.length;a+=1)if(vl(s[a].charCodeAt(0)))return!0;return!1}function vl(t){return!(t!==746&&t!==747&&(t<4352||!(hr["Bopomofo Extended"](t)||hr.Bopomofo(t)||hr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||hr["CJK Compatibility Ideographs"](t)||hr["CJK Compatibility"](t)||hr["CJK Radicals Supplement"](t)||hr["CJK Strokes"](t)||!(!hr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||hr["CJK Unified Ideographs Extension A"](t)||hr["CJK Unified Ideographs"](t)||hr["Enclosed CJK Letters and Months"](t)||hr["Hangul Compatibility Jamo"](t)||hr["Hangul Jamo Extended-A"](t)||hr["Hangul Jamo Extended-B"](t)||hr["Hangul Jamo"](t)||hr["Hangul Syllables"](t)||hr.Hiragana(t)||hr["Ideographic Description Characters"](t)||hr.Kanbun(t)||hr["Kangxi Radicals"](t)||hr["Katakana Phonetic Extensions"](t)||hr.Katakana(t)&&t!==12540||!(!hr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!hr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||hr["Unified Canadian Aboriginal Syllabics"](t)||hr["Unified Canadian Aboriginal Syllabics Extended"](t)||hr["Vertical Forms"](t)||hr["Yijing Hexagram Symbols"](t)||hr["Yi Syllables"](t)||hr["Yi Radicals"](t))))}function Uu(t){return!(vl(t)||function(a){return!!(hr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||hr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||hr["Letterlike Symbols"](a)||hr["Number Forms"](a)||hr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||hr["Control Pictures"](a)&&a!==9251||hr["Optical Character Recognition"](a)||hr["Enclosed Alphanumerics"](a)||hr["Geometric Shapes"](a)||hr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||hr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||hr["CJK Symbols and Punctuation"](a)||hr.Katakana(a)||hr["Private Use Area"](a)||hr["CJK Compatibility Forms"](a)||hr["Small Form Variants"](a)||hr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function bs(t){return t>=1424&&t<=2303||hr["Arabic Presentation Forms-A"](t)||hr["Arabic Presentation Forms-B"](t)}function $o(t,a){return!(!a&&bs(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||hr.Khmer(t))}function Mf(t){for(var a=0,s=t;a<s.length;a+=1)if(bs(s[a].charCodeAt(0)))return!0;return!1}var Pf=null,cs="unavailable",ju=null,If=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(cs="error"),Pf&&Pf(t)};function vc(){ap.fire(new Te("pluginStateChange",{pluginStatus:cs,pluginURL:ju}))}var ap=new We,Of=function(){return cs},Js=function(){if(cs!=="deferred"||!ju)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cs="loading",vc(),ju&&Rs({url:ju},function(t){t?If(t):(cs="loaded",vc())})},ws={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return cs==="loaded"||ws.applyArabicShaping!=null},isLoading:function(){return cs==="loading"},setState:function(t){cs=t.pluginStatus,ju=t.pluginURL},isParsed:function(){return ws.applyArabicShaping!=null&&ws.processBidirectionalText!=null&&ws.processStyledBidirectionalText!=null},getPluginURL:function(){return ju}},Xn=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dl,this.transition={})};Xn.prototype.isSupportedScript=function(t){return function(a,s){for(var p=0,m=a;p<m.length;p+=1)if(!$o(m[p].charCodeAt(0),s))return!1;return!0}(t,ws.isLoaded())},Xn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Xn.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Qs=function(t,a){this.property=t,this.value=a,this.expression=function(s,p){if(Nc(s))return new fl(s,p);if(Bs(s)){var m=fc(s,p);if(m.result==="error")throw new Error(m.value.map(function(w){return w.key+": "+w.message}).join(", "));return m.value}var g=s;return typeof s=="string"&&p.type==="color"&&(g=Jn.parse(s)),{kind:"constant",evaluate:function(){return g}}}(a===void 0?t.specification.default:a,t.specification)};Qs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Qs.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var ro=function(t){this.property=t,this.value=new Qs(t,void 0)};ro.prototype.transitioned=function(t,a){return new Bo(this.property,this.value,a,Gt({},t.transition,this.transition),t.now)},ro.prototype.untransitioned=function(){return new Bo(this.property,this.value,null,{},0)};var Pa=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Pa.prototype.getValue=function(t){return He(this._values[t].value.value)},Pa.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ro(this._values[t].property)),this._values[t].value=new Qs(this._values[t].property,a===null?void 0:He(a))},Pa.prototype.getTransition=function(t){return He(this._values[t].transition)},Pa.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ro(this._values[t].property)),this._values[t].transition=He(a)||void 0},Pa.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a],m=this.getValue(p);m!==void 0&&(t[p]=m);var g=this.getTransition(p);g!==void 0&&(t[p+"-transition"]=g)}return t},Pa.prototype.transitioned=function(t,a){for(var s=new No(this._properties),p=0,m=Object.keys(this._values);p<m.length;p+=1){var g=m[p];s._values[g]=this._values[g].transitioned(t,a._values[g])}return s},Pa.prototype.untransitioned=function(){for(var t=new No(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a];t._values[p]=this._values[p].untransitioned()}return t};var Bo=function(t,a,s,p,m){this.property=t,this.value=a,this.begin=m+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=s)};Bo.prototype.possiblyEvaluate=function(t,a,s){var p=t.now||0,m=this.value.possiblyEvaluate(t,a,s),g=this.prior;if(g){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return g.possiblyEvaluate(t,a,s);var w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,a,s),m,function(C){if(C<=0)return 0;if(C>=1)return 1;var I=C*C,L=I*C;return 4*(C<.5?L:3*(C-I)+L-.75)}(w))}return m};var No=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};No.prototype.possiblyEvaluate=function(t,a,s){for(var p=new ml(this._properties),m=0,g=Object.keys(this._values);m<g.length;m+=1){var w=g[m];p._values[w]=this._values[w].possiblyEvaluate(t,a,s)}return p},No.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var fs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};fs.prototype.getValue=function(t){return He(this._values[t].value)},fs.prototype.setValue=function(t,a){this._values[t]=new Qs(this._values[t].property,a===null?void 0:He(a))},fs.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a],m=this.getValue(p);m!==void 0&&(t[p]=m)}return t},fs.prototype.possiblyEvaluate=function(t,a,s){for(var p=new ml(this._properties),m=0,g=Object.keys(this._values);m<g.length;m+=1){var w=g[m];p._values[w]=this._values[w].possiblyEvaluate(t,a,s)}return p};var co=function(t,a,s){this.property=t,this.value=a,this.parameters=s};co.prototype.isConstant=function(){return this.value.kind==="constant"},co.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},co.prototype.evaluate=function(t,a,s,p){return this.property.evaluate(this.value,this.parameters,t,a,s,p)};var ml=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};ml.prototype.get=function(t){return this._values[t]};var on=function(t){this.specification=t};on.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},on.prototype.interpolate=function(t,a,s){var p=Ll[this.specification.type];return p?p(t,a,s):t};var Xr=function(t,a){this.specification=t,this.overrides=a};Xr.prototype.possiblyEvaluate=function(t,a,s,p){return new co(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,p)}:t.expression,a)},Xr.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new co(this,{kind:"constant",value:void 0},t.parameters);var p=Ll[this.specification.type];return p?new co(this,{kind:"constant",value:p(t.value.value,a.value.value,s)},t.parameters):t},Xr.prototype.evaluate=function(t,a,s,p,m,g){return t.kind==="constant"?t.value:t.evaluate(a,s,p,m,g)};var mc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,p,m,g){if(s.value===void 0)return new co(this,{kind:"constant",value:void 0},p);if(s.expression.kind==="constant"){var w=s.expression.evaluate(p,null,{},m,g),C=s.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(C,C,C,p);return new co(this,{kind:"constant",value:I},p)}if(s.expression.kind==="camera"){var L=this._calculate(s.expression.evaluate({zoom:p.zoom-1}),s.expression.evaluate({zoom:p.zoom}),s.expression.evaluate({zoom:p.zoom+1}),p);return new co(this,{kind:"constant",value:L},p)}return new co(this,s.expression,p)},a.prototype.evaluate=function(s,p,m,g,w,C){if(s.kind==="source"){var I=s.evaluate(p,m,g,w,C);return this._calculate(I,I,I,p)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(p.zoom)-1},m,g),s.evaluate({zoom:Math.floor(p.zoom)},m,g),s.evaluate({zoom:Math.floor(p.zoom)+1},m,g),p):s.value},a.prototype._calculate=function(s,p,m,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:p}:{from:m,to:p}},a.prototype.interpolate=function(s){return s},a}(Xr),yo=function(t){this.specification=t};yo.prototype.possiblyEvaluate=function(t,a,s,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var m=t.expression.evaluate(a,null,{},s,p);return this._calculate(m,m,m,a)}return this._calculate(t.expression.evaluate(new Xn(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Xn(Math.floor(a.zoom),a)),t.expression.evaluate(new Xn(Math.floor(a.zoom+1),a)),a)}},yo.prototype._calculate=function(t,a,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},yo.prototype.interpolate=function(t){return t};var Fa=function(t){this.specification=t};Fa.prototype.possiblyEvaluate=function(t,a,s,p){return!!t.expression.evaluate(a,null,{},s,p)},Fa.prototype.interpolate=function(){return!1};var ya=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var p=this.defaultPropertyValues[a]=new Qs(s,void 0),m=this.defaultTransitionablePropertyValues[a]=new ro(s);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}};Hr("DataDrivenProperty",Xr),Hr("DataConstantProperty",on),Hr("CrossFadedDataDrivenProperty",mc),Hr("CrossFadedProperty",yo),Hr("ColorRampProperty",Fa);var ta=function(t){function a(s,p){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),p.layout&&(this._unevaluatedLayout=new fs(p.layout)),p.paint)){for(var m in this._transitionablePaint=new Pa(p.paint),s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(var g in s.layout)this.setLayoutProperty(g,s.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ml(p.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,p,m){m===void 0&&(m={}),p!=null&&this._validate(dc,"layers."+this.id+".layout."+s,s,p,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,p):this.visibility=p)},a.prototype.getPaintProperty=function(s){return cr(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,p,m){if(m===void 0&&(m={}),p!=null&&this._validate(sh,"layers."+this.id+".paint."+s,s,p,m))return!1;if(cr(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),p||void 0),!1;var g=this._transitionablePaint._values[s],w=g.property.specification["property-type"]==="cross-faded-data-driven",C=g.value.isDataDriven(),I=g.value;this._transitionablePaint.setValue(s,p),this._handleSpecialPaintPropertyUpdate(s);var L=this._transitionablePaint._values[s].value;return L.isDataDriven()||C||w||this._handleOverridablePaintPropertyUpdate(s,I,L)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,p,m){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,p){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,p)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),st(s,function(p,m){return!(p===void 0||m==="layout"&&!Object.keys(p).length||m==="paint"&&!Object.keys(p).length)})},a.prototype._validate=function(s,p,m,g,w){return w===void 0&&(w={}),(!w||w.validate!==!1)&&zu(this,s.call(Vc,{key:p,layerType:this.type,objectKey:m,value:g,styleSpec:te,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var p=this.paint.get(s);if(p instanceof co&&$s(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},a}(We),Ss={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},yl=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},pi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function pa(t,a){a===void 0&&(a=1);var s=0,p=0;return{members:t.map(function(m){var g=Ss[m.type].BYTES_PER_ELEMENT,w=s=Hc(s,Math.max(a,g)),C=m.components||1;return p=Math.max(p,g),s+=g*C,{name:m.name,type:m.type,components:C,offset:w}}),size:Hc(s,Math.max(p,a)),alignment:a}}function Hc(t,a){return Math.ceil(t/a)*a}pi.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},pi.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},pi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},pi.prototype.clear=function(){this.length=0},pi.prototype.resize=function(t){this.reserve(t),this.length=t},pi.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},pi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.int16[g+0]=p,this.int16[g+1]=m,s},a}(pi);Vu.prototype.bytesPerElement=4,Hr("StructArrayLayout2i4",Vu);var Wc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=4*s;return this.int16[C+0]=p,this.int16[C+1]=m,this.int16[C+2]=g,this.int16[C+3]=w,s},a}(pi);Wc.prototype.bytesPerElement=8,Hr("StructArrayLayout4i8",Wc);var eu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var L=6*s;return this.int16[L+0]=p,this.int16[L+1]=m,this.int16[L+2]=g,this.int16[L+3]=w,this.int16[L+4]=C,this.int16[L+5]=I,s},a}(pi);eu.prototype.bytesPerElement=12,Hr("StructArrayLayout2i4i12",eu);var zo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var L=4*s,D=8*s;return this.int16[L+0]=p,this.int16[L+1]=m,this.uint8[D+4]=g,this.uint8[D+5]=w,this.uint8[D+6]=C,this.uint8[D+7]=I,s},a}(pi);zo.prototype.bytesPerElement=8,Hr("StructArrayLayout2i4ub8",zo);var Zo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.float32[g+0]=p,this.float32[g+1]=m,s},a}(pi);Zo.prototype.bytesPerElement=8,Hr("StructArrayLayout2f8",Zo);var tu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,L,D,N){var V=this.length;return this.resize(V+1),this.emplace(V,s,p,m,g,w,C,I,L,D,N)},a.prototype.emplace=function(s,p,m,g,w,C,I,L,D,N,V){var q=10*s;return this.uint16[q+0]=p,this.uint16[q+1]=m,this.uint16[q+2]=g,this.uint16[q+3]=w,this.uint16[q+4]=C,this.uint16[q+5]=I,this.uint16[q+6]=L,this.uint16[q+7]=D,this.uint16[q+8]=N,this.uint16[q+9]=V,s},a}(pi);tu.prototype.bytesPerElement=20,Hr("StructArrayLayout10ui20",tu);var ga=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,L,D,N,V,q){var xe=this.length;return this.resize(xe+1),this.emplace(xe,s,p,m,g,w,C,I,L,D,N,V,q)},a.prototype.emplace=function(s,p,m,g,w,C,I,L,D,N,V,q,xe){var Ce=12*s;return this.int16[Ce+0]=p,this.int16[Ce+1]=m,this.int16[Ce+2]=g,this.int16[Ce+3]=w,this.uint16[Ce+4]=C,this.uint16[Ce+5]=I,this.uint16[Ce+6]=L,this.uint16[Ce+7]=D,this.int16[Ce+8]=N,this.int16[Ce+9]=V,this.int16[Ce+10]=q,this.int16[Ce+11]=xe,s},a}(pi);ga.prototype.bytesPerElement=24,Hr("StructArrayLayout4i4ui4i24",ga);var re=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.float32[w+0]=p,this.float32[w+1]=m,this.float32[w+2]=g,s},a}(pi);re.prototype.bytesPerElement=12,Hr("StructArrayLayout3f12",re);var Vl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.uint32[1*s+0]=p,s},a}(pi);Vl.prototype.bytesPerElement=4,Hr("StructArrayLayout1ul4",Vl);var Xc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,L,D){var N=this.length;return this.resize(N+1),this.emplace(N,s,p,m,g,w,C,I,L,D)},a.prototype.emplace=function(s,p,m,g,w,C,I,L,D,N){var V=10*s,q=5*s;return this.int16[V+0]=p,this.int16[V+1]=m,this.int16[V+2]=g,this.int16[V+3]=w,this.int16[V+4]=C,this.int16[V+5]=I,this.uint32[q+3]=L,this.uint16[V+8]=D,this.uint16[V+9]=N,s},a}(pi);Xc.prototype.bytesPerElement=20,Hr("StructArrayLayout6i1ul2ui20",Xc);var gl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var L=6*s;return this.int16[L+0]=p,this.int16[L+1]=m,this.int16[L+2]=g,this.int16[L+3]=w,this.int16[L+4]=C,this.int16[L+5]=I,s},a}(pi);gl.prototype.bytesPerElement=12,Hr("StructArrayLayout2i2i2i12",gl);var Eu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w){var C=this.length;return this.resize(C+1),this.emplace(C,s,p,m,g,w)},a.prototype.emplace=function(s,p,m,g,w,C){var I=4*s,L=8*s;return this.float32[I+0]=p,this.float32[I+1]=m,this.float32[I+2]=g,this.int16[L+6]=w,this.int16[L+7]=C,s},a}(pi);Eu.prototype.bytesPerElement=16,Hr("StructArrayLayout2f1f2i16",Eu);var yc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=12*s,I=3*s;return this.uint8[C+0]=p,this.uint8[C+1]=m,this.float32[I+1]=g,this.float32[I+2]=w,s},a}(pi);yc.prototype.bytesPerElement=12,Hr("StructArrayLayout2ub2f12",yc);var Cu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.uint16[w+0]=p,this.uint16[w+1]=m,this.uint16[w+2]=g,s},a}(pi);Cu.prototype.bytesPerElement=6,Hr("StructArrayLayout3ui6",Cu);var ps=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e){var ot=this.length;return this.resize(ot+1),this.emplace(ot,s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e)},a.prototype.emplace=function(s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e,ot){var St=24*s,Pt=12*s,zt=48*s;return this.int16[St+0]=p,this.int16[St+1]=m,this.uint16[St+2]=g,this.uint16[St+3]=w,this.uint32[Pt+2]=C,this.uint32[Pt+3]=I,this.uint32[Pt+4]=L,this.uint16[St+10]=D,this.uint16[St+11]=N,this.uint16[St+12]=V,this.float32[Pt+7]=q,this.float32[Pt+8]=xe,this.uint8[zt+36]=Ce,this.uint8[zt+37]=ze,this.uint8[zt+38]=Le,this.uint32[Pt+10]=$e,this.int16[St+22]=ot,s},a}(pi);ps.prototype.bytesPerElement=48,Hr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ps);var _l=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e,ot,St,Pt,zt,Kt,Sr,tr,zr,nn,Br,Kn){var En=this.length;return this.resize(En+1),this.emplace(En,s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e,ot,St,Pt,zt,Kt,Sr,tr,zr,nn,Br,Kn)},a.prototype.emplace=function(s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce,ze,Le,$e,ot,St,Pt,zt,Kt,Sr,tr,zr,nn,Br,Kn,En){var en=34*s,oi=17*s;return this.int16[en+0]=p,this.int16[en+1]=m,this.int16[en+2]=g,this.int16[en+3]=w,this.int16[en+4]=C,this.int16[en+5]=I,this.int16[en+6]=L,this.int16[en+7]=D,this.uint16[en+8]=N,this.uint16[en+9]=V,this.uint16[en+10]=q,this.uint16[en+11]=xe,this.uint16[en+12]=Ce,this.uint16[en+13]=ze,this.uint16[en+14]=Le,this.uint16[en+15]=$e,this.uint16[en+16]=ot,this.uint16[en+17]=St,this.uint16[en+18]=Pt,this.uint16[en+19]=zt,this.uint16[en+20]=Kt,this.uint16[en+21]=Sr,this.uint16[en+22]=tr,this.uint32[oi+12]=zr,this.float32[oi+13]=nn,this.float32[oi+14]=Br,this.float32[oi+15]=Kn,this.float32[oi+16]=En,s},a}(pi);_l.prototype.bytesPerElement=68,Hr("StructArrayLayout8i15ui1ul4f68",_l);var Es=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.float32[1*s+0]=p,s},a}(pi);Es.prototype.bytesPerElement=4,Hr("StructArrayLayout1f4",Es);var hs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.int16[w+0]=p,this.int16[w+1]=m,this.int16[w+2]=g,s},a}(pi);hs.prototype.bytesPerElement=6,Hr("StructArrayLayout3i6",hs);var Yc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=4*s;return this.uint32[2*s+0]=p,this.uint16[w+2]=m,this.uint16[w+3]=g,s},a}(pi);Yc.prototype.bytesPerElement=8,Hr("StructArrayLayout1ul2ui8",Yc);var Gl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.uint16[g+0]=p,this.uint16[g+1]=m,s},a}(pi);Gl.prototype.bytesPerElement=4,Hr("StructArrayLayout2ui4",Gl);var qc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.uint16[1*s+0]=p,s},a}(pi);qc.prototype.bytesPerElement=2,Hr("StructArrayLayout1ui2",qc);var Kc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=4*s;return this.float32[C+0]=p,this.float32[C+1]=m,this.float32[C+2]=g,this.float32[C+3]=w,s},a}(pi);Kc.prototype.bytesPerElement=16,Hr("StructArrayLayout4f16",Kc);var u=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new me(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(yl);u.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new u(this,s)},a}(Xc);Hr("CollisionBoxArray",f);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(yl);l.prototype.size=48;var h=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(ps);Hr("PlacedSymbolArray",h);var x=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(yl);x.prototype.size=68;var S=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new x(this,s)},a}(_l);Hr("SymbolInstanceArray",S);var E=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(Es);Hr("GlyphOffsetArray",E);var P=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(hs);Hr("SymbolLineVertexArray",P);var R=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(yl);R.prototype.size=8;var z=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new R(this,s)},a}(Yc);Hr("FeatureIndexArray",z);var j=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,ee=function(t){t===void 0&&(t=[]),this.segments=t};function ne(t,a){return 256*(t=M(Math.floor(t),0,255))+M(Math.floor(a),0,255)}ee.prototype.prepareSegment=function(t,a,s,p){var m=this.segments[this.segments.length-1];return t>ee.MAX_VERTEX_ARRAY_LENGTH&&Ye("Max vertices per segment is "+ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!m||m.vertexLength+t>ee.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m},ee.prototype.get=function(){return this.segments},ee.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var p in s.vaos)s.vaos[p].destroy()}},ee.simpleSegment=function(t,a,s,p){return new ee([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:p,vaos:{},sortKey:0}])},ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Hr("SegmentVector",ee);var Ae=pa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Se=be(function(t){t.exports=function(a,s){var p,m,g,w,C,I,L,D;for(m=a.length-(p=3&a.length),g=s,C=3432918353,I=461845907,D=0;D<m;)L=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,g=27492+(65535&(w=5*(65535&(g=(g^=L=(65535&(L=(L=(65535&L)*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(L=0,p){case 3:L^=(255&a.charCodeAt(D+2))<<16;case 2:L^=(255&a.charCodeAt(D+1))<<8;case 1:g^=L=(65535&(L=(L=(65535&(L^=255&a.charCodeAt(D)))*C+(((L>>>16)*C&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),De=be(function(t){t.exports=function(a,s){for(var p,m=a.length,g=s^m,w=0;m>=4;)p=1540483477*(65535&(p=255&a.charCodeAt(w)|(255&a.charCodeAt(++w))<<8|(255&a.charCodeAt(++w))<<16|(255&a.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),m-=4,++w;switch(m){case 3:g^=(255&a.charCodeAt(w+2))<<16;case 2:g^=(255&a.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),ge=Se,Fe=De;ge.murmur3=Se,ge.murmur2=Fe;var Ge=function(){this.ids=[],this.positions=[],this.indexed=!1};Ge.prototype.add=function(t,a,s,p){this.ids.push(Ct(t)),this.positions.push(a,s,p)},Ge.prototype.getPositions=function(t){for(var a=Ct(t),s=0,p=this.ids.length-1;s<p;){var m=s+p>>1;this.ids[m]>=a?p=m:s=m+1}for(var g=[];this.ids[s]===a;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g},Ge.serialize=function(t,a){var s=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function m(g,w,C,I){for(;C<I;){for(var L=g[C+I>>1],D=C-1,N=I+1;;){do D++;while(g[D]<L);do N--;while(g[N]>L);if(D>=N)break;wt(g,D,N),wt(w,3*D,3*N),wt(w,3*D+1,3*N+1),wt(w,3*D+2,3*N+2)}N-C<I-N?(m(g,w,C,N),C=N+1):(m(g,w,N+1,I),I=N)}}(s,p,0,s.length-1),a&&a.push(s.buffer,p.buffer),{ids:s,positions:p}},Ge.deserialize=function(t){var a=new Ge;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var at=Math.pow(2,53)-1;function Ct(t){var a=+t;return!isNaN(a)&&a<=at?a:ge(String(t))}function wt(t,a,s){var p=t[a];t[a]=t[s],t[s]=p}Hr("FeaturePositionMap",Ge);var At=function(t,a){this.gl=t.gl,this.location=a},Yt=function(t){function a(s,p){t.call(this,s,p),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(At),br=function(t){function a(s,p){t.call(this,s,p),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(At),pr=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(At),Fr=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(At),rn=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(At),fn=function(t){function a(s,p){t.call(this,s,p),this.current=Jn.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(At),cn=new Float32Array(16),hi=function(t){function a(s,p){t.call(this,s,p),this.current=cn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var p=1;p<16;p++)if(s[p]!==this.current[p]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(At);function gr(t){return[ne(255*t.r,255*t.g),ne(255*t.b,255*t.a)]}var Jr=function(t,a,s){this.value=t,this.uniformNames=a.map(function(p){return"u_"+p}),this.type=s};Jr.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},Jr.prototype.getBinding=function(t,a,s){return this.type==="color"?new fn(t,a):new br(t,a)};var kn=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};kn.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},kn.prototype.setUniform=function(t,a,s,p){var m=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)},kn.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new rn(t,a):new br(t,a)};var wn=function(t,a,s,p){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(m){return{name:"a_"+m,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new p};wn.prototype.populatePaintArray=function(t,a,s,p,m){var g=this.paintVertexArray.length,w=this.expression.evaluate(new Xn(0),a,{},p,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,w)},wn.prototype.updatePaintArray=function(t,a,s,p){var m=this.expression.evaluate({zoom:0},s,p);this._setPaintValue(t,a,m)},wn.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var p=gr(s),m=t;m<a;m++)this.paintVertexArray.emplace(m,p[0],p[1]);else{for(var g=t;g<a;g++)this.paintVertexArray.emplace(g,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},wn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var vn=function(t,a,s,p,m,g){this.expression=t,this.uniformNames=a.map(function(w){return"u_"+w+"_t"}),this.type=s,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(function(w){return{name:"a_"+w,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new g};vn.prototype.populatePaintArray=function(t,a,s,p,m){var g=this.expression.evaluate(new Xn(this.zoom),a,{},p,[],m),w=this.expression.evaluate(new Xn(this.zoom+1),a,{},p,[],m),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,g,w)},vn.prototype.updatePaintArray=function(t,a,s,p){var m=this.expression.evaluate({zoom:this.zoom},s,p),g=this.expression.evaluate({zoom:this.zoom+1},s,p);this._setPaintValue(t,a,m,g)},vn.prototype._setPaintValue=function(t,a,s,p){if(this.type==="color")for(var m=gr(s),g=gr(p),w=t;w<a;w++)this.paintVertexArray.emplace(w,m[0],m[1],g[0],g[1]);else{for(var C=t;C<a;C++)this.paintVertexArray.emplace(C,s,p);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(p))}},vn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},vn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=M(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(p)},vn.prototype.getBinding=function(t,a,s){return new br(t,a)};var Zn=function(t,a,s,p,m,g){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=p,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};Zn.prototype.populatePaintArray=function(t,a,s){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,a.patterns&&a.patterns[this.layerId],s)},Zn.prototype.updatePaintArray=function(t,a,s,p,m){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],m)},Zn.prototype._setPaintValues=function(t,a,s,p){if(p&&s){var m=p[s.min],g=p[s.mid],w=p[s.max];if(m&&g&&w)for(var C=t;C<a;C++)this.zoomInPaintVertexArray.emplace(C,g.tl[0],g.tl[1],g.br[0],g.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],g.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,g.tl[0],g.tl[1],g.br[0],g.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],g.pixelRatio,w.pixelRatio)}},Zn.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ae.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ae.members,this.expression.isStateDependent))},Zn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Sn=function(t,a,s){this.binders={},this._buffers=[];var p=[];for(var m in t.paint._values)if(s(m)){var g=t.paint.get(m);if(g instanceof co&&$s(g.property.specification)){var w=Ba(m,t.type),C=g.value,I=g.property.specification.type,L=g.property.useIntegerZoom,D=g.property.specification["property-type"],N=D==="cross-faded"||D==="cross-faded-data-driven";if(C.kind==="constant")this.binders[m]=N?new kn(C.value,w):new Jr(C.value,w,I),p.push("/u_"+m);else if(C.kind==="source"||N){var V=Wi(m,I,"source");this.binders[m]=N?new Zn(C,I,L,a,V,t.id):new wn(C,w,I,V),p.push("/a_"+m)}else{var q=Wi(m,I,"composite");this.binders[m]=new vn(C,w,I,L,a,q),p.push("/z_"+m)}}}this.cacheKey=p.sort().join("")};Sn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof wn||a instanceof vn?a.maxValue:0},Sn.prototype.populatePaintArrays=function(t,a,s,p,m){for(var g in this.binders){var w=this.binders[g];(w instanceof wn||w instanceof vn||w instanceof Zn)&&w.populatePaintArray(t,a,s,p,m)}},Sn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var p=this.binders[s];p instanceof kn&&p.setConstantPatternPositions(t,a)}},Sn.prototype.updatePaintArrays=function(t,a,s,p,m){var g=!1;for(var w in t)for(var C=0,I=a.getPositions(w);C<I.length;C+=1){var L=I[C],D=s.feature(L.index);for(var N in this.binders){var V=this.binders[N];if((V instanceof wn||V instanceof vn||V instanceof Zn)&&V.expression.isStateDependent===!0){var q=p.paint.get(N);V.expression=q.value,V.updatePaintArray(L.start,L.end,D,t[w],m),g=!0}}}return g},Sn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof Jr||s instanceof kn)&&t.push.apply(t,s.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Sn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof wn||s instanceof vn)for(var p=0;p<s.paintVertexAttributes.length;p++)t.push(s.paintVertexAttributes[p].name);else if(s instanceof Zn)for(var m=0;m<Ae.members.length;m++)t.push(Ae.members[m].name)}return t},Sn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof Jr||s instanceof kn||s instanceof vn)for(var p=0,m=s.uniformNames;p<m.length;p+=1)t.push(m[p])}return t},Sn.prototype.getPaintVertexBuffers=function(){return this._buffers},Sn.prototype.getUniforms=function(t,a){var s=[];for(var p in this.binders){var m=this.binders[p];if(m instanceof Jr||m instanceof kn||m instanceof vn)for(var g=0,w=m.uniformNames;g<w.length;g+=1){var C=w[g];if(a[C]){var I=m.getBinding(t,a[C],C);s.push({name:C,property:p,binding:I})}}}return s},Sn.prototype.setUniforms=function(t,a,s,p){for(var m=0,g=a;m<g.length;m+=1){var w=g[m],C=w.name,I=w.property;this.binders[I].setUniform(w.binding,p,s.get(I),C)}},Sn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof Zn){var p=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(s instanceof wn||s instanceof vn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Sn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof wn||s instanceof vn||s instanceof Zn)&&s.upload(t)}this.updatePaintBuffers()},Sn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof wn||a instanceof vn||a instanceof Zn)&&a.destroy()}};var _n=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var p=0,m=t;p<m.length;p+=1){var g=m[p];this.programConfigurations[g.id]=new Sn(g,a,s)}this.needsUpload=!1,this._featureMap=new Ge,this._bufferOffset=0};function Ba(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Wi(t,a,s){var p={color:{source:Zo,composite:Kc},number:{source:Es,composite:Zo}},m=function(g){return{"line-pattern":{source:tu,composite:tu},"fill-pattern":{source:tu,composite:tu},"fill-extrusion-pattern":{source:tu,composite:tu}}[g]}(t);return m&&m[s]||p[a][s]}_n.prototype.populatePaintArrays=function(t,a,s,p,m,g){for(var w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,a,p,m,g);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},_n.prototype.updatePaintArrays=function(t,a,s,p){for(var m=0,g=s;m<g.length;m+=1){var w=g[m];this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,a,w,p)||this.needsUpload}},_n.prototype.get=function(t){return this.programConfigurations[t]},_n.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},_n.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Hr("ConstantBinder",Jr),Hr("CrossFadedConstantBinder",kn),Hr("SourceExpressionBinder",wn),Hr("CrossFadedCompositeBinder",Zn),Hr("CompositeExpressionBinder",vn),Hr("ProgramConfiguration",Sn,{omit:["_buffers"]}),Hr("ProgramConfigurationSet",_n);var Gi=Math.pow(2,14)-1,no=-Gi-1;function ra(t){for(var a=8192/t.extent,s=t.loadGeometry(),p=0;p<s.length;p++)for(var m=s[p],g=0;g<m.length;g++){var w=m[g],C=Math.round(w.x*a),I=Math.round(w.y*a);w.x=M(C,no,Gi),w.y=M(I,no,Gi),(C<w.x||C>w.x+1||I<w.y||I>w.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function _a(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?ra(t):[]}}function Na(t,a,s,p,m){t.emplaceBack(2*a+(p+1)/2,2*s+(m+1)/2)}var io=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Vu,this.indexArray=new Cu,this.segments=new ee,this.programConfigurations=new _n(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Cs(t,a){for(var s=0;s<t.length;s++)if(zs(a,t[s]))return!0;for(var p=0;p<a.length;p++)if(zs(t,a[p]))return!0;return!!ru(t,a)}function fo(t,a,s){return!!zs(t,a)||!!nu(a,t,s)}function Jo(t,a){if(t.length===1)return xl(a,t[0]);for(var s=0;s<a.length;s++)for(var p=a[s],m=0;m<p.length;m++)if(zs(t,p[m]))return!0;for(var g=0;g<t.length;g++)if(xl(a,t[g]))return!0;for(var w=0;w<a.length;w++)if(ru(t,a[w]))return!0;return!1}function Mo(t,a,s){if(t.length>1){if(ru(t,a))return!0;for(var p=0;p<a.length;p++)if(nu(a[p],t,s))return!0}for(var m=0;m<t.length;m++)if(nu(t[m],a,s))return!0;return!1}function ru(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var p=t[s],m=t[s+1],g=0;g<a.length-1;g++)if(Gu(p,m,a[g],a[g+1]))return!0;return!1}function Gu(t,a,s,p){return kt(t,s,p)!==kt(a,s,p)&&kt(t,a,s)!==kt(t,a,p)}function nu(t,a,s){var p=s*s;if(a.length===1)return t.distSqr(a[0])<p;for(var m=1;m<a.length;m++)if(iu(t,a[m-1],a[m])<p)return!0;return!1}function iu(t,a,s){var p=a.distSqr(s);if(p===0)return t.distSqr(a);var m=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/p;return t.distSqr(m<0?a:m>1?s:s.sub(a)._mult(m)._add(a))}function xl(t,a){for(var s,p,m,g=!1,w=0;w<t.length;w++)for(var C=0,I=(s=t[w]).length-1;C<s.length;I=C++)(p=s[C]).y>a.y!=(m=s[I]).y>a.y&&a.x<(m.x-p.x)*(a.y-p.y)/(m.y-p.y)+p.x&&(g=!g);return g}function zs(t,a){for(var s=!1,p=0,m=t.length-1;p<t.length;m=p++){var g=t[p],w=t[m];g.y>a.y!=w.y>a.y&&a.x<(w.x-g.x)*(a.y-g.y)/(w.y-g.y)+g.x&&(s=!s)}return s}function Hu(t,a,s){var p=s[0],m=s[2];if(t.x<p.x&&a.x<p.x||t.x>m.x&&a.x>m.x||t.y<p.y&&a.y<p.y||t.y>m.y&&a.y>m.y)return!1;var g=kt(t,a,s[0]);return g!==kt(t,a,s[1])||g!==kt(t,a,s[2])||g!==kt(t,a,s[3])}function za(t,a,s){var p=a.paint.get(t).value;return p.kind==="constant"?p.value:s.programConfigurations.get(a.id).getMaxValue(t)}function na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function au(t,a,s,p,m){if(!a[0]&&!a[1])return t;var g=me.convert(a)._mult(m);s==="viewport"&&g._rotate(-p);for(var w=[],C=0;C<t.length;C++)w.push(t[C].sub(g));return w}io.prototype.populate=function(t,a,s){var p=this.layers[0],m=[],g=null;p.type==="circle"&&(g=p.layout.get("circle-sort-key"));for(var w=0,C=t;w<C.length;w+=1){var I=C[w],L=I.feature,D=I.id,N=I.index,V=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,xe=_a(L,q);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),xe,s)){var Ce=g?g.evaluate(xe,{},s):void 0,ze={id:D,properties:L.properties,type:L.type,sourceLayerIndex:V,index:N,geometry:q?xe.geometry:ra(L),patterns:{},sortKey:Ce};m.push(ze)}}g&&m.sort(function(Sr,tr){return Sr.sortKey-tr.sortKey});for(var Le=0,$e=m;Le<$e.length;Le+=1){var ot=$e[Le],St=ot.geometry,Pt=ot.index,zt=ot.sourceLayerIndex,Kt=t[Pt].feature;this.addFeature(ot,St,Pt,s),a.featureIndex.insert(Kt,St,Pt,zt,this.index)}},io.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},io.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},io.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},io.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},io.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},io.prototype.addFeature=function(t,a,s,p){for(var m=0,g=a;m<g.length;m+=1)for(var w=0,C=g[m];w<C.length;w+=1){var I=C[w],L=I.x,D=I.y;if(!(L<0||L>=8192||D<0||D>=8192)){var N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=N.vertexLength;Na(this.layoutVertexArray,L,D,-1,-1),Na(this.layoutVertexArray,L,D,1,-1),Na(this.layoutVertexArray,L,D,1,1),Na(this.layoutVertexArray,L,D,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),N.vertexLength+=4,N.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},p)},Hr("CircleBucket",io,{omit:["layers"]});var Zs=new ya({"circle-sort-key":new Xr(te.layout_circle["circle-sort-key"])}),Uo={paint:new ya({"circle-radius":new Xr(te.paint_circle["circle-radius"]),"circle-color":new Xr(te.paint_circle["circle-color"]),"circle-blur":new Xr(te.paint_circle["circle-blur"]),"circle-opacity":new Xr(te.paint_circle["circle-opacity"]),"circle-translate":new on(te.paint_circle["circle-translate"]),"circle-translate-anchor":new on(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new on(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new on(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xr(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xr(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xr(te.paint_circle["circle-stroke-opacity"])}),layout:Zs},vi=typeof Float32Array!="undefined"?Float32Array:Array;function ao(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oo(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3],C=a[4],I=a[5],L=a[6],D=a[7],N=a[8],V=a[9],q=a[10],xe=a[11],Ce=a[12],ze=a[13],Le=a[14],$e=a[15],ot=s[0],St=s[1],Pt=s[2],zt=s[3];return t[0]=ot*p+St*C+Pt*N+zt*Ce,t[1]=ot*m+St*I+Pt*V+zt*ze,t[2]=ot*g+St*L+Pt*q+zt*Le,t[3]=ot*w+St*D+Pt*xe+zt*$e,t[4]=(ot=s[4])*p+(St=s[5])*C+(Pt=s[6])*N+(zt=s[7])*Ce,t[5]=ot*m+St*I+Pt*V+zt*ze,t[6]=ot*g+St*L+Pt*q+zt*Le,t[7]=ot*w+St*D+Pt*xe+zt*$e,t[8]=(ot=s[8])*p+(St=s[9])*C+(Pt=s[10])*N+(zt=s[11])*Ce,t[9]=ot*m+St*I+Pt*V+zt*ze,t[10]=ot*g+St*L+Pt*q+zt*Le,t[11]=ot*w+St*D+Pt*xe+zt*$e,t[12]=(ot=s[12])*p+(St=s[13])*C+(Pt=s[14])*N+(zt=s[15])*Ce,t[13]=ot*m+St*I+Pt*V+zt*ze,t[14]=ot*g+St*L+Pt*q+zt*Le,t[15]=ot*w+St*D+Pt*xe+zt*$e,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var ds,Wu=oo;function ou(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3];return t[0]=s[0]*p+s[4]*m+s[8]*g+s[12]*w,t[1]=s[1]*p+s[5]*m+s[9]*g+s[13]*w,t[2]=s[2]*p+s[6]*m+s[10]*g+s[14]*w,t[3]=s[3]*p+s[7]*m+s[11]*g+s[15]*w,t}ds=new vi(3),vi!=Float32Array&&(ds[0]=0,ds[1]=0,ds[2]=0),function(){var t=new vi(4);vi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Hl=(function(){var t=new vi(2);vi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Uo)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new io(s)},a.prototype.queryRadius=function(s){var p=s;return za("circle-radius",this,p)+za("circle-stroke-width",this,p)+na(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I,L){for(var D=au(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,I),N=this.paint.get("circle-radius").evaluate(p,m)+this.paint.get("circle-stroke-width").evaluate(p,m),V=this.paint.get("circle-pitch-alignment")==="map",q=V?D:function(Kt,Sr){return Kt.map(function(tr){return Xu(tr,Sr)})}(D,L),xe=V?N*I:N,Ce=0,ze=g;Ce<ze.length;Ce+=1)for(var Le=0,$e=ze[Ce];Le<$e.length;Le+=1){var ot=$e[Le],St=V?ot:Xu(ot,L),Pt=xe,zt=ou([],[ot.x,ot.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pt*=zt[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pt*=C.cameraToCenterDistance/zt[3]),fo(q,St,Pt))return!0}return!1},a}(ta));function Xu(t,a){var s=ou([],[t.x,t.y,0,1],a);return new me(s[0]/s[3],s[1]/s[3])}var gc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(io);function Us(t,a,s,p){var m=a.width,g=a.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==m*g*s)throw new RangeError("mismatched image size")}else p=new Uint8Array(m*g*s);return t.width=m,t.height=g,t.data=p,t}function bl(t,a,s){var p=a.width,m=a.height;if(p!==t.width||m!==t.height){var g=Us({},{width:p,height:m},s);$c(t,g,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,m)},s),t.width=p,t.height=m,t.data=g.data}}function $c(t,a,s,p,m,g){if(m.width===0||m.height===0)return a;if(m.width>t.width||m.height>t.height||s.x>t.width-m.width||s.y>t.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>a.width||m.height>a.height||p.x>a.width-m.width||p.y>a.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var w=t.data,C=a.data,I=0;I<m.height;I++)for(var L=((s.y+I)*t.width+s.x)*g,D=((p.y+I)*a.width+p.x)*g,N=0;N<m.width*g;N++)C[D+N]=w[L+N];return a}Hr("HeatmapBucket",gc,{omit:["layers"]});var js=function(t,a){Us(this,t,1,a)};js.prototype.resize=function(t){bl(this,t,1)},js.prototype.clone=function(){return new js({width:this.width,height:this.height},new Uint8Array(this.data))},js.copy=function(t,a,s,p,m){$c(t,a,s,p,m,1)};var qa=function(t,a){Us(this,t,4,a)};qa.prototype.resize=function(t){bl(this,t,4)},qa.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},qa.prototype.clone=function(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))},qa.copy=function(t,a,s,p,m){$c(t,a,s,p,m,4)},Hr("AlphaImage",js),Hr("RGBAImage",qa);var uh={paint:new ya({"heatmap-radius":new Xr(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xr(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new on(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fa(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new on(te.paint_heatmap["heatmap-opacity"])})};function Ep(t){var a={},s=t.resolution||256,p=t.clips?t.clips.length:1,m=t.image||new qa({width:s,height:p}),g=function(xe,Ce,ze){a[t.evaluationKey]=ze;var Le=t.expression.evaluate(a);m.data[xe+Ce+0]=Math.floor(255*Le.r/Le.a),m.data[xe+Ce+1]=Math.floor(255*Le.g/Le.a),m.data[xe+Ce+2]=Math.floor(255*Le.b/Le.a),m.data[xe+Ce+3]=Math.floor(255*Le.a)};if(t.clips)for(var w=0,C=0;w<p;++w,C+=4*s)for(var I=0,L=0;I<s;I++,L+=4){var D=I/(s-1),N=t.clips[w];g(C,L,N.start*(1-D)+N.end*D)}else for(var V=0,q=0;V<s;V++,q+=4)g(0,q,V/(s-1));return m}var Cp=function(t){function a(s){t.call(this,s,uh),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new gc(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(ta),Tp={paint:new ya({"hillshade-illumination-direction":new on(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new on(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new on(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new on(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new on(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new on(te.paint_hillshade["hillshade-accent-color"])})},Ap=function(t){function a(s){t.call(this,s,Tp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(ta),lh=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,wl=kf,ch=kf;function kf(t,a,s){s=s||2;var p,m,g,w,C,I,L,D=a&&a.length,N=D?a[0]*s:t.length,V=Mp(t,0,N,s,!0),q=[];if(!V||V.next===V.prev)return q;if(D&&(V=function(Ce,ze,Le,$e){var ot,St,Pt,zt=[];for(ot=0,St=ze.length;ot<St;ot++)(Pt=Mp(Ce,ze[ot]*$e,ot<St-1?ze[ot+1]*$e:Ce.length,$e,!1))===Pt.next&&(Pt.steiner=!0),zt.push(yh(Pt));for(zt.sort(dh),ot=0;ot<zt.length;ot++)vh(zt[ot],Le),Le=Yu(Le,Le.next);return Le}(t,a,V,s)),t.length>80*s){p=g=t[0],m=w=t[1];for(var xe=s;xe<N;xe+=s)(C=t[xe])<p&&(p=C),(I=t[xe+1])<m&&(m=I),C>g&&(g=C),I>w&&(w=I);L=(L=Math.max(g-p,w-m))!==0?1/L:0}return Jc(V,q,s,p,m,L),q}function Mp(t,a,s,p,m){var g,w;if(m===xc(t,a,s,p)>0)for(g=a;g<s;g+=p)w=Df(g,t[g],t[g+1],w);else for(g=s-p;g>=a;g-=p)w=Df(g,t[g],t[g+1],w);return w&&Wl(w,w.next)&&(Kl(w),w=w.next),w}function Yu(t,a){if(!t)return t;a||(a=t);var s,p=t;do if(s=!1,p.steiner||!Wl(p,p.next)&&ia(p.prev,p,p.next)!==0)p=p.next;else{if(Kl(p),(p=a=p.prev)===p.next)break;s=!0}while(s||p!==a);return a}function Jc(t,a,s,p,m,g,w){if(t){!w&&g&&function(D,N,V,q){var xe=D;do xe.z===null&&(xe.z=op(xe.x,xe.y,N,V,q)),xe.prevZ=xe.prev,xe.nextZ=xe.next,xe=xe.next;while(xe!==D);xe.prevZ.nextZ=null,xe.prevZ=null,function(Ce){var ze,Le,$e,ot,St,Pt,zt,Kt,Sr=1;do{for(Le=Ce,Ce=null,St=null,Pt=0;Le;){for(Pt++,$e=Le,zt=0,ze=0;ze<Sr&&(zt++,$e=$e.nextZ);ze++);for(Kt=Sr;zt>0||Kt>0&&$e;)zt!==0&&(Kt===0||!$e||Le.z<=$e.z)?(ot=Le,Le=Le.nextZ,zt--):(ot=$e,$e=$e.nextZ,Kt--),St?St.nextZ=ot:Ce=ot,ot.prevZ=St,St=ot;Le=$e}St.nextZ=null,Sr*=2}while(Pt>1)}(xe)}(t,p,m,g);for(var C,I,L=t;t.prev!==t.next;)if(C=t.prev,I=t.next,g?fh(t,p,m,g):jo(t))a.push(C.i/s),a.push(t.i/s),a.push(I.i/s),Kl(t),t=I.next,L=I.next;else if((t=I)===L){w?w===1?Jc(t=ph(Yu(t),a,s),a,s,p,m,g,2):w===2&&hh(t,a,s,p,m,g):Jc(Yu(t),a,s,p,m,g,1);break}}}function jo(t){var a=t.prev,s=t,p=t.next;if(ia(a,s,p)>=0)return!1;for(var m=t.next.next;m!==t.prev;){if(Sl(a.x,a.y,s.x,s.y,p.x,p.y,m.x,m.y)&&ia(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function fh(t,a,s,p){var m=t.prev,g=t,w=t.next;if(ia(m,g,w)>=0)return!1;for(var C=m.x>g.x?m.x>w.x?m.x:w.x:g.x>w.x?g.x:w.x,I=m.y>g.y?m.y>w.y?m.y:w.y:g.y>w.y?g.y:w.y,L=op(m.x<g.x?m.x<w.x?m.x:w.x:g.x<w.x?g.x:w.x,m.y<g.y?m.y<w.y?m.y:w.y:g.y<w.y?g.y:w.y,a,s,p),D=op(C,I,a,s,p),N=t.prevZ,V=t.nextZ;N&&N.z>=L&&V&&V.z<=D;){if(N!==t.prev&&N!==t.next&&Sl(m.x,m.y,g.x,g.y,w.x,w.y,N.x,N.y)&&ia(N.prev,N,N.next)>=0||(N=N.prevZ,V!==t.prev&&V!==t.next&&Sl(m.x,m.y,g.x,g.y,w.x,w.y,V.x,V.y)&&ia(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;N&&N.z>=L;){if(N!==t.prev&&N!==t.next&&Sl(m.x,m.y,g.x,g.y,w.x,w.y,N.x,N.y)&&ia(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;V&&V.z<=D;){if(V!==t.prev&&V!==t.next&&Sl(m.x,m.y,g.x,g.y,w.x,w.y,V.x,V.y)&&ia(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function ph(t,a,s){var p=t;do{var m=p.prev,g=p.next.next;!Wl(m,g)&&Rf(m,p,p.next,g)&&ql(m,g)&&ql(g,m)&&(a.push(m.i/s),a.push(p.i/s),a.push(g.i/s),Kl(p),Kl(p.next),p=t=g),p=p.next}while(p!==t);return Yu(p)}function hh(t,a,s,p,m,g){var w=t;do{for(var C=w.next.next;C!==w.prev;){if(w.i!==C.i&&Lf(w,C)){var I=sp(w,C);return w=Yu(w,w.next),I=Yu(I,I.next),Jc(w,a,s,p,m,g),void Jc(I,a,s,p,m,g)}C=C.next}w=w.next}while(w!==t)}function dh(t,a){return t.x-a.x}function vh(t,a){if(a=function(p,m){var g,w=m,C=p.x,I=p.y,L=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var D=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(D<=C&&D>L){if(L=D,D===C){if(I===w.y)return w;if(I===w.next.y)return w.next}g=w.x<w.next.x?w:w.next}}w=w.next}while(w!==m);if(!g)return null;if(C===L)return g;var N,V=g,q=g.x,xe=g.y,Ce=1/0;w=g;do C>=w.x&&w.x>=q&&C!==w.x&&Sl(I<xe?C:L,I,q,xe,I<xe?L:C,I,w.x,w.y)&&(N=Math.abs(I-w.y)/(C-w.x),ql(w,p)&&(N<Ce||N===Ce&&(w.x>g.x||w.x===g.x&&mh(g,w)))&&(g=w,Ce=N)),w=w.next;while(w!==V);return g}(t,a)){var s=sp(a,t);Yu(a,a.next),Yu(s,s.next)}}function mh(t,a){return ia(t.prev,t,a.prev)<0&&ia(a.next,t,t.next)<0}function op(t,a,s,p,m){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*m)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*m)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function yh(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function Sl(t,a,s,p,m,g,w,C){return(m-w)*(a-C)-(t-w)*(g-C)>=0&&(t-w)*(p-C)-(s-w)*(a-C)>=0&&(s-w)*(g-C)-(m-w)*(p-C)>=0}function Lf(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,p){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==p.i&&m.next.i!==p.i&&Rf(m,m.next,s,p))return!0;m=m.next}while(m!==s);return!1}(t,a)&&(ql(t,a)&&ql(a,t)&&function(s,p){var m=s,g=!1,w=(s.x+p.x)/2,C=(s.y+p.y)/2;do m.y>C!=m.next.y>C&&m.next.y!==m.y&&w<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(g=!g),m=m.next;while(m!==s);return g}(t,a)&&(ia(t.prev,t,a.prev)||ia(t,a.prev,a))||Wl(t,a)&&ia(t.prev,t,t.next)>0&&ia(a.prev,a,a.next)>0)}function ia(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Wl(t,a){return t.x===a.x&&t.y===a.y}function Rf(t,a,s,p){var m=Yl(ia(t,a,s)),g=Yl(ia(t,a,p)),w=Yl(ia(s,p,t)),C=Yl(ia(s,p,a));return m!==g&&w!==C||!(m!==0||!Xl(t,s,a))||!(g!==0||!Xl(t,p,a))||!(w!==0||!Xl(s,t,p))||!(C!==0||!Xl(s,a,p))}function Xl(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function Yl(t){return t>0?1:t<0?-1:0}function ql(t,a){return ia(t.prev,t,t.next)<0?ia(t,a,t.next)>=0&&ia(t,t.prev,a)>=0:ia(t,a,t.prev)<0||ia(t,t.next,a)<0}function sp(t,a){var s=new _c(t.i,t.x,t.y),p=new _c(a.i,a.x,a.y),m=t.next,g=a.prev;return t.next=a,a.prev=t,s.next=m,m.prev=s,p.next=s,s.prev=p,g.next=p,p.prev=g,p}function Df(t,a,s,p){var m=new _c(t,a,s);return p?(m.next=p.next,m.prev=p,p.next.prev=m,p.next=m):(m.prev=m,m.next=m),m}function Kl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _c(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xc(t,a,s,p){for(var m=0,g=a,w=s-p;g<s;g+=p)m+=(t[w]-t[g])*(t[g+1]+t[w+1]),w=g;return m}function Ff(t,a,s,p,m){(function g(w,C,I,L,D){for(;L>I;){if(L-I>600){var N=L-I+1,V=C-I+1,q=Math.log(N),xe=.5*Math.exp(2*q/3),Ce=.5*Math.sqrt(q*xe*(N-xe)/N)*(V-N/2<0?-1:1);g(w,C,Math.max(I,Math.floor(C-V*xe/N+Ce)),Math.min(L,Math.floor(C+(N-V)*xe/N+Ce)),D)}var ze=w[C],Le=I,$e=L;for(qu(w,I,C),D(w[L],ze)>0&&qu(w,I,L);Le<$e;){for(qu(w,Le,$e),Le++,$e--;D(w[Le],ze)<0;)Le++;for(;D(w[$e],ze)>0;)$e--}D(w[I],ze)===0?qu(w,I,$e):qu(w,++$e,L),$e<=C&&(I=$e+1),C<=$e&&(L=$e-1)}})(t,a,s||0,p||t.length-1,m||Qc)}function qu(t,a,s){var p=t[a];t[a]=t[s],t[s]=p}function Qc(t,a){return t<a?-1:t>a?1:0}function $l(t,a){var s=t.length;if(s<=1)return[t];for(var p,m,g=[],w=0;w<s;w++){var C=ur(t[w]);C!==0&&(t[w].area=Math.abs(C),m===void 0&&(m=C<0),m===C<0?(p&&g.push(p),p=[t[w]]):p.push(t[w]))}if(p&&g.push(p),a>1)for(var I=0;I<g.length;I++)g[I].length<=a||(Ff(g[I],a,1,g[I].length-1,Pp),g[I]=g[I].slice(0,a));return g}function Pp(t,a){return a.area-t.area}function Tu(t,a,s){for(var p=s.patternDependencies,m=!1,g=0,w=a;g<w.length;g+=1){var C=w[g].paint.get(t+"-pattern");C.isConstant()||(m=!0);var I=C.constantOr(null);I&&(m=!0,p[I.to]=!0,p[I.from]=!0)}return m}function Ku(t,a,s,p,m){for(var g=m.patternDependencies,w=0,C=a;w<C.length;w+=1){var I=C[w],L=I.paint.get(t+"-pattern").value;if(L.kind!=="constant"){var D=L.evaluate({zoom:p-1},s,{},m.availableImages),N=L.evaluate({zoom:p},s,{},m.availableImages),V=L.evaluate({zoom:p+1},s,{},m.availableImages);N=N&&N.name?N.name:N,V=V&&V.name?V.name:V,g[D=D&&D.name?D.name:D]=!0,g[N]=!0,g[V]=!0,s.patterns[I.id]={min:D,mid:N,max:V}}}return s}kf.deviation=function(t,a,s,p){var m=a&&a.length,g=Math.abs(xc(t,0,m?a[0]*s:t.length,s));if(m)for(var w=0,C=a.length;w<C;w++)g-=Math.abs(xc(t,a[w]*s,w<C-1?a[w+1]*s:t.length,s));var I=0;for(w=0;w<p.length;w+=3){var L=p[w]*s,D=p[w+1]*s,N=p[w+2]*s;I+=Math.abs((t[L]-t[N])*(t[D+1]-t[L+1])-(t[L]-t[D])*(t[N+1]-t[L+1]))}return g===0&&I===0?0:Math.abs((I-g)/g)},kf.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},p=0,m=0;m<t.length;m++){for(var g=0;g<t[m].length;g++)for(var w=0;w<a;w++)s.vertices.push(t[m][g][w]);m>0&&s.holes.push(p+=t[m-1].length)}return s},wl.default=ch;var su=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vu,this.indexArray=new Cu,this.indexArray2=new Gl,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.segments2=new ee,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};su.prototype.populate=function(t,a,s){this.hasPattern=Tu("fill",this.layers,a);for(var p=this.layers[0].layout.get("fill-sort-key"),m=[],g=0,w=t;g<w.length;g+=1){var C=w[g],I=C.feature,L=C.id,D=C.index,N=C.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,q=_a(I,V);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),q,s)){var xe=p?p.evaluate(q,{},s,a.availableImages):void 0,Ce={id:L,properties:I.properties,type:I.type,sourceLayerIndex:N,index:D,geometry:V?q.geometry:ra(I),patterns:{},sortKey:xe};m.push(Ce)}}p&&m.sort(function(Kt,Sr){return Kt.sortKey-Sr.sortKey});for(var ze=0,Le=m;ze<Le.length;ze+=1){var $e=Le[ze],ot=$e.geometry,St=$e.index,Pt=$e.sourceLayerIndex;if(this.hasPattern){var zt=Ku("fill",this.layers,$e,this.zoom,a);this.patternFeatures.push(zt)}else this.addFeature($e,ot,St,s,{});a.featureIndex.insert(t[St].feature,ot,St,Pt,this.index)}},su.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},su.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.patternFeatures;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},su.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},su.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},su.prototype.addFeature=function(t,a,s,p,m){for(var g=0,w=$l(a,500);g<w.length;g+=1){for(var C=w[g],I=0,L=0,D=C;L<D.length;L+=1)I+=D[L].length;for(var N=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),V=N.vertexLength,q=[],xe=[],Ce=0,ze=C;Ce<ze.length;Ce+=1){var Le=ze[Ce];if(Le.length!==0){Le!==C[0]&&xe.push(q.length/2);var $e=this.segments2.prepareSegment(Le.length,this.layoutVertexArray,this.indexArray2),ot=$e.vertexLength;this.layoutVertexArray.emplaceBack(Le[0].x,Le[0].y),this.indexArray2.emplaceBack(ot+Le.length-1,ot),q.push(Le[0].x),q.push(Le[0].y);for(var St=1;St<Le.length;St++)this.layoutVertexArray.emplaceBack(Le[St].x,Le[St].y),this.indexArray2.emplaceBack(ot+St-1,ot+St),q.push(Le[St].x),q.push(Le[St].y);$e.vertexLength+=Le.length,$e.primitiveLength+=Le.length}}for(var Pt=wl(q,xe),zt=0;zt<Pt.length;zt+=3)this.indexArray.emplaceBack(V+Pt[zt],V+Pt[zt+1],V+Pt[zt+2]);N.vertexLength+=I,N.primitiveLength+=Pt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Hr("FillBucket",su,{omit:["layers","patternFeatures"]});var Ip=new ya({"fill-sort-key":new Xr(te.layout_fill["fill-sort-key"])}),$h={paint:new ya({"fill-antialias":new on(te.paint_fill["fill-antialias"]),"fill-opacity":new Xr(te.paint_fill["fill-opacity"]),"fill-color":new Xr(te.paint_fill["fill-color"]),"fill-outline-color":new Xr(te.paint_fill["fill-outline-color"]),"fill-translate":new on(te.paint_fill["fill-translate"]),"fill-translate-anchor":new on(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new mc(te.paint_fill["fill-pattern"])}),layout:Ip},Jh=function(t){function a(s){t.call(this,s,$h)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,p){t.prototype.recalculate.call(this,s,p);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new su(s)},a.prototype.queryRadius=function(){return na(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I){return Jo(au(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,I),g)},a.prototype.isTileClipped=function(){return!0},a}(ta),Qh=pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,El=bc;function bc(t,a,s,p,m){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=m,t.readFields(gh,this,a)}function gh(t,a,s){t==1?a.id=s.readVarint():t==2?function(p,m){for(var g=p.readVarint()+p.pos;p.pos<g;){var w=m._keys[p.readVarint()],C=m._values[p.readVarint()];m.properties[w]=C}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function _h(t){for(var a,s,p=0,m=0,g=t.length,w=g-1;m<g;w=m++)p+=((s=t[w]).x-(a=t[m]).x)*(a.y+s.y);return p}bc.types=["Unknown","Point","LineString","Polygon"],bc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,p=1,m=0,g=0,w=0,C=[];t.pos<s;){if(m<=0){var I=t.readVarint();p=7&I,m=I>>3}if(m--,p===1||p===2)g+=t.readSVarint(),w+=t.readSVarint(),p===1&&(a&&C.push(a),a=[]),a.push(new me(g,w));else{if(p!==7)throw new Error("unknown command "+p);a&&a.push(a[0].clone())}}return a&&C.push(a),C},bc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,p=0,m=0,g=0,w=1/0,C=-1/0,I=1/0,L=-1/0;t.pos<a;){if(p<=0){var D=t.readVarint();s=7&D,p=D>>3}if(p--,s===1||s===2)(m+=t.readSVarint())<w&&(w=m),m>C&&(C=m),(g+=t.readSVarint())<I&&(I=g),g>L&&(L=g);else if(s!==7)throw new Error("unknown command "+s)}return[w,I,C,L]},bc.prototype.toGeoJSON=function(t,a,s){var p,m,g=this.extent*Math.pow(2,s),w=this.extent*t,C=this.extent*a,I=this.loadGeometry(),L=bc.types[this.type];function D(q){for(var xe=0;xe<q.length;xe++){var Ce=q[xe];q[xe]=[360*(Ce.x+w)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ce.y+C)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(p=0;p<I.length;p++)N[p]=I[p][0];D(I=N);break;case 2:for(p=0;p<I.length;p++)D(I[p]);break;case 3:for(I=function(q){var xe=q.length;if(xe<=1)return[q];for(var Ce,ze,Le=[],$e=0;$e<xe;$e++){var ot=_h(q[$e]);ot!==0&&(ze===void 0&&(ze=ot<0),ze===ot<0?(Ce&&Le.push(Ce),Ce=[q[$e]]):Ce.push(q[$e]))}return Ce&&Le.push(Ce),Le}(I),p=0;p<I.length;p++)for(m=0;m<I[p].length;m++)D(I[p][m])}I.length===1?I=I[0]:L="Multi"+L;var V={type:"Feature",geometry:{type:L,coordinates:I},properties:this.properties};return"id"in this&&(V.id=this.id),V};var xh=Op;function Op(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ed,this,a),this.length=this._features.length}function ed(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(p){for(var m=null,g=p.readVarint()+p.pos;p.pos<g;){var w=p.readVarint()>>3;m=w===1?p.readString():w===2?p.readFloat():w===3?p.readDouble():w===4?p.readVarint64():w===5?p.readVarint():w===6?p.readSVarint():w===7?p.readBoolean():null}return m}(s))}function $u(t,a,s){if(t===3){var p=new xh(s,s.readVarint()+s.pos);p.length&&(a[p.name]=p)}}Op.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new El(this._pbf,a,this.extent,this._keys,this._values)};var wc={VectorTile:function(t,a){this.layers=t.readFields($u,{},a)},VectorTileFeature:El,VectorTileLayer:xh},ef=wc.VectorTileFeature.types,Ju=Math.pow(2,13);function tf(t,a,s,p,m,g,w,C){t.emplaceBack(a,s,2*Math.floor(p*Ju)+w,m*Ju*2,g*Ju*2,Math.round(C))}var go=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new eu,this.indexArray=new Cu,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Au(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}go.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=Tu("fill-extrusion",this.layers,a);for(var p=0,m=t;p<m.length;p+=1){var g=m[p],w=g.feature,C=g.id,I=g.index,L=g.sourceLayerIndex,D=this.layers[0]._featureFilter.needGeometry,N=_a(w,D);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),N,s)){var V={id:C,sourceLayerIndex:L,index:I,geometry:D?N.geometry:ra(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(Ku("fill-extrusion",this.layers,V,this.zoom,a)):this.addFeature(V,V.geometry,I,s,{}),a.featureIndex.insert(w,V.geometry,I,L,this.index,!0)}}},go.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.features;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},go.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},go.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},go.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},go.prototype.addFeature=function(t,a,s,p,m){for(var g=0,w=$l(a,500);g<w.length;g+=1){for(var C=w[g],I=0,L=0,D=C;L<D.length;L+=1)I+=D[L].length;for(var N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),V=0,q=C;V<q.length;V+=1){var xe=q[V];if(xe.length!==0&&!((oi=xe).every(function(Gn){return Gn.x<0})||oi.every(function(Gn){return Gn.x>8192})||oi.every(function(Gn){return Gn.y<0})||oi.every(function(Gn){return Gn.y>8192})))for(var Ce=0,ze=0;ze<xe.length;ze++){var Le=xe[ze];if(ze>=1){var $e=xe[ze-1];if(!Au(Le,$e)){N.vertexLength+4>ee.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ot=Le.sub($e)._perp()._unit(),St=$e.dist(Le);Ce+St>32768&&(Ce=0),tf(this.layoutVertexArray,Le.x,Le.y,ot.x,ot.y,0,0,Ce),tf(this.layoutVertexArray,Le.x,Le.y,ot.x,ot.y,0,1,Ce),tf(this.layoutVertexArray,$e.x,$e.y,ot.x,ot.y,0,0,Ce+=St),tf(this.layoutVertexArray,$e.x,$e.y,ot.x,ot.y,0,1,Ce);var Pt=N.vertexLength;this.indexArray.emplaceBack(Pt,Pt+2,Pt+1),this.indexArray.emplaceBack(Pt+1,Pt+2,Pt+3),N.vertexLength+=4,N.primitiveLength+=2}}}}if(N.vertexLength+I>ee.MAX_VERTEX_ARRAY_LENGTH&&(N=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),ef[t.type]==="Polygon"){for(var zt=[],Kt=[],Sr=N.vertexLength,tr=0,zr=C;tr<zr.length;tr+=1){var nn=zr[tr];if(nn.length!==0){nn!==C[0]&&Kt.push(zt.length/2);for(var Br=0;Br<nn.length;Br++){var Kn=nn[Br];tf(this.layoutVertexArray,Kn.x,Kn.y,0,0,1,1,0),zt.push(Kn.x),zt.push(Kn.y)}}}for(var En=wl(zt,Kt),en=0;en<En.length;en+=3)this.indexArray.emplaceBack(Sr+En[en],Sr+En[en+2],Sr+En[en+1]);N.primitiveLength+=En.length/3,N.vertexLength+=I}}var oi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Hr("FillExtrusionBucket",go,{omit:["layers","features"]});var kp={paint:new ya({"fill-extrusion-opacity":new on(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xr(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new on(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new on(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mc(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xr(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xr(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new on(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Qo=function(t){function a(s){t.call(this,s,kp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new go(s)},a.prototype.queryRadius=function(){return na(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I,L){var D=au(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,I),N=this.paint.get("fill-extrusion-height").evaluate(p,m),V=this.paint.get("fill-extrusion-base").evaluate(p,m),q=function(Ce,ze,Le,$e){for(var ot=[],St=0,Pt=Ce;St<Pt.length;St+=1){var zt=Pt[St],Kt=[zt.x,zt.y,0,1];ou(Kt,Kt,ze),ot.push(new me(Kt[0]/Kt[3],Kt[1]/Kt[3]))}return ot}(D,L),xe=function(Ce,ze,Le,$e){for(var ot=[],St=[],Pt=$e[8]*ze,zt=$e[9]*ze,Kt=$e[10]*ze,Sr=$e[11]*ze,tr=$e[8]*Le,zr=$e[9]*Le,nn=$e[10]*Le,Br=$e[11]*Le,Kn=0,En=Ce;Kn<En.length;Kn+=1){for(var en=[],oi=[],Gn=0,si=En[Kn];Gn<si.length;Gn+=1){var hn=si[Gn],_i=hn.x,aa=hn.y,Oa=$e[0]*_i+$e[4]*aa+$e[12],ka=$e[1]*_i+$e[5]*aa+$e[13],oa=$e[2]*_i+$e[6]*aa+$e[14],La=$e[3]*_i+$e[7]*aa+$e[15],po=oa+Kt,ho=La+Sr,ts=Oa+tr,Oo=ka+zr,rs=oa+nn,Ua=La+Br,ko=new me((Oa+Pt)/ho,(ka+zt)/ho);ko.z=po/ho,en.push(ko);var fi=new me(ts/Ua,Oo/Ua);fi.z=rs/Ua,oi.push(fi)}ot.push(en),St.push(oi)}return[ot,St]}(g,V,N,L);return function(Ce,ze,Le){var $e=1/0;Jo(Le,ze)&&($e=xa(Le,ze[0]));for(var ot=0;ot<ze.length;ot++)for(var St=ze[ot],Pt=Ce[ot],zt=0;zt<St.length-1;zt++){var Kt=St[zt],Sr=[Kt,St[zt+1],Pt[zt+1],Pt[zt],Kt];Cs(Le,Sr)&&($e=Math.min($e,xa(Le,Sr)))}return $e!==1/0&&$e}(xe[0],xe[1],q)},a}(ta);function Vs(t,a){return t.x*a.x+t.y*a.y}function xa(t,a){if(t.length===1){for(var s,p=0,m=a[p++];!s||m.equals(s);)if(!(s=a[p++]))return 1/0;for(;p<a.length;p++){var g=a[p],w=t[0],C=s.sub(m),I=g.sub(m),L=w.sub(m),D=Vs(C,C),N=Vs(C,I),V=Vs(I,I),q=Vs(L,C),xe=Vs(L,I),Ce=D*V-N*N,ze=(V*q-N*xe)/Ce,Le=(D*xe-N*q)/Ce,$e=m.z*(1-ze-Le)+s.z*ze+g.z*Le;if(isFinite($e))return $e}return 1/0}for(var ot=1/0,St=0,Pt=a;St<Pt.length;St+=1)ot=Math.min(ot,Pt[St].z);return ot}var vs=pa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Bf=pa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,bh=wc.VectorTileFeature.types,wh=Math.cos(Math.PI/180*37.5),Sh=Math.pow(2,14)/.5,Vo=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new zo,this.layoutVertexArray2=new Zo,this.indexArray=new Cu,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Vo.prototype.populate=function(t,a,s){this.hasPattern=Tu("line",this.layers,a);for(var p=this.layers[0].layout.get("line-sort-key"),m=[],g=0,w=t;g<w.length;g+=1){var C=w[g],I=C.feature,L=C.id,D=C.index,N=C.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,q=_a(I,V);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),q,s)){var xe=p?p.evaluate(q,{},s):void 0,Ce={id:L,properties:I.properties,type:I.type,sourceLayerIndex:N,index:D,geometry:V?q.geometry:ra(I),patterns:{},sortKey:xe};m.push(Ce)}}p&&m.sort(function(Kt,Sr){return Kt.sortKey-Sr.sortKey});for(var ze=0,Le=m;ze<Le.length;ze+=1){var $e=Le[ze],ot=$e.geometry,St=$e.index,Pt=$e.sourceLayerIndex;if(this.hasPattern){var zt=Ku("line",this.layers,$e,this.zoom,a);this.patternFeatures.push(zt)}else this.addFeature($e,ot,St,s,{});a.featureIndex.insert(t[St].feature,ot,St,Pt,this.index)}},Vo.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Vo.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.patternFeatures;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},Vo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Vo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vo.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Bf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Vo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Vo.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Vo.prototype.addFeature=function(t,a,s,p,m){var g=this.layers[0].layout,w=g.get("line-join").evaluate(t,{}),C=g.get("line-cap"),I=g.get("line-miter-limit"),L=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var D=0,N=a;D<N.length;D+=1)this.addLine(N[D],t,w,C,I,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Vo.prototype.addLine=function(t,a,s,p,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var w=0;w<t.length-1;w++)this.totalDistance+=t[w].dist(t[w+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var C=bh[a.type]==="Polygon",I=t.length;I>=2&&t[I-1].equals(t[I-2]);)I--;for(var L=0;L<I-1&&t[L].equals(t[L+1]);)L++;if(!(I<(C?3:2))){s==="bevel"&&(m=1.05);var D,N=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),q=void 0,xe=void 0,Ce=void 0,ze=void 0;this.e1=this.e2=-1,C&&(ze=t[L].sub(D=t[I-2])._unit()._perp());for(var Le=L;Le<I;Le++)if(!(xe=Le===I-1?C?t[L+1]:void 0:t[Le+1])||!t[Le].equals(xe)){ze&&(Ce=ze),D&&(q=D),D=t[Le],ze=xe?xe.sub(D)._unit()._perp():Ce;var $e=(Ce=Ce||ze).add(ze);$e.x===0&&$e.y===0||$e._unit();var ot=Ce.x*ze.x+Ce.y*ze.y,St=$e.x*ze.x+$e.y*ze.y,Pt=St!==0?1/St:1/0,zt=2*Math.sqrt(2-2*St),Kt=St<wh&&q&&xe,Sr=Ce.x*ze.y-Ce.y*ze.x>0;if(Kt&&Le>L){var tr=D.dist(q);if(tr>2*N){var zr=D.sub(D.sub(q)._mult(N/tr)._round());this.updateDistance(q,zr),this.addCurrentVertex(zr,Ce,0,0,V),q=zr}}var nn=q&&xe,Br=nn?s:C?"butt":p;if(nn&&Br==="round"&&(Pt<g?Br="miter":Pt<=2&&(Br="fakeround")),Br==="miter"&&Pt>m&&(Br="bevel"),Br==="bevel"&&(Pt>2&&(Br="flipbevel"),Pt<m&&(Br="miter")),q&&this.updateDistance(q,D),Br==="miter")$e._mult(Pt),this.addCurrentVertex(D,$e,0,0,V);else if(Br==="flipbevel"){if(Pt>100)$e=ze.mult(-1);else{var Kn=Pt*Ce.add(ze).mag()/Ce.sub(ze).mag();$e._perp()._mult(Kn*(Sr?-1:1))}this.addCurrentVertex(D,$e,0,0,V),this.addCurrentVertex(D,$e.mult(-1),0,0,V)}else if(Br==="bevel"||Br==="fakeround"){var En=-Math.sqrt(Pt*Pt-1),en=Sr?En:0,oi=Sr?0:En;if(q&&this.addCurrentVertex(D,Ce,en,oi,V),Br==="fakeround")for(var Gn=Math.round(180*zt/Math.PI/20),si=1;si<Gn;si++){var hn=si/Gn;if(hn!==.5){var _i=hn-.5;hn+=hn*_i*(hn-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*_i*_i+(.848013+ot*(.215638*ot-1.06021)))}var aa=ze.sub(Ce)._mult(hn)._add(Ce)._unit()._mult(Sr?-1:1);this.addHalfVertex(D,aa.x,aa.y,!1,Sr,0,V)}xe&&this.addCurrentVertex(D,ze,-en,-oi,V)}else if(Br==="butt")this.addCurrentVertex(D,$e,0,0,V);else if(Br==="square"){var Oa=q?1:-1;this.addCurrentVertex(D,$e,Oa,Oa,V)}else Br==="round"&&(q&&(this.addCurrentVertex(D,Ce,0,0,V),this.addCurrentVertex(D,Ce,1,1,V,!0)),xe&&(this.addCurrentVertex(D,ze,-1,-1,V,!0),this.addCurrentVertex(D,ze,0,0,V)));if(Kt&&Le<I-1){var ka=D.dist(xe);if(ka>2*N){var oa=D.add(xe.sub(D)._mult(N/ka)._round());this.updateDistance(D,oa),this.addCurrentVertex(oa,ze,0,0,V),D=oa}}}}},Vo.prototype.addCurrentVertex=function(t,a,s,p,m,g){g===void 0&&(g=!1);var w=a.y*p-a.x,C=-a.y-a.x*p;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,g,!1,s,m),this.addHalfVertex(t,w,C,g,!0,-p,m),this.distance>Sh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,p,m,g))},Vo.prototype.addHalfVertex=function(t,a,s,p,m,g,w){var C=.5*(this.lineClips?this.scaledDistance*(Sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(g===0?0:g<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),m?this.e2=I:this.e1=I},Vo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Vo.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},Hr("LineBucket",Vo,{omit:["layers","patternFeatures"]});var Eh=new ya({"line-cap":new on(te.layout_line["line-cap"]),"line-join":new Xr(te.layout_line["line-join"]),"line-miter-limit":new on(te.layout_line["line-miter-limit"]),"line-round-limit":new on(te.layout_line["line-round-limit"]),"line-sort-key":new Xr(te.layout_line["line-sort-key"])}),Lp={paint:new ya({"line-opacity":new Xr(te.paint_line["line-opacity"]),"line-color":new Xr(te.paint_line["line-color"]),"line-translate":new on(te.paint_line["line-translate"]),"line-translate-anchor":new on(te.paint_line["line-translate-anchor"]),"line-width":new Xr(te.paint_line["line-width"]),"line-gap-width":new Xr(te.paint_line["line-gap-width"]),"line-offset":new Xr(te.paint_line["line-offset"]),"line-blur":new Xr(te.paint_line["line-blur"]),"line-dasharray":new yo(te.paint_line["line-dasharray"]),"line-pattern":new mc(te.paint_line["line-pattern"]),"line-gradient":new Fa(te.paint_line["line-gradient"])}),layout:Eh},Rp=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,p){return p=new Xn(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,s,p)},a.prototype.evaluate=function(s,p,m,g){return p=Gt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,s,p,m,g)},a}(Xr))(Lp.paint.properties["line-width"].specification);Rp.useIntegerZoom=!0;var Ch=function(t){function a(s){t.call(this,s,Lp),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Eo,this.gradientVersion=(this.gradientVersion+1)%Q)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,p){t.prototype.recalculate.call(this,s,p),this.paint._values["line-floorwidth"]=Rp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new Vo(s)},a.prototype.queryRadius=function(s){var p=s,m=up(za("line-width",this,p),za("line-gap-width",this,p)),g=za("line-offset",this,p);return m/2+Math.abs(g)+na(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I){var L=au(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,I),D=I/2*up(this.paint.get("line-width").evaluate(p,m),this.paint.get("line-gap-width").evaluate(p,m)),N=this.paint.get("line-offset").evaluate(p,m);return N&&(g=function(V,q){for(var xe=[],Ce=new me(0,0),ze=0;ze<V.length;ze++){for(var Le=V[ze],$e=[],ot=0;ot<Le.length;ot++){var St=Le[ot],Pt=Le[ot+1],zt=ot===0?Ce:St.sub(Le[ot-1])._unit()._perp(),Kt=ot===Le.length-1?Ce:Pt.sub(St)._unit()._perp(),Sr=zt._add(Kt)._unit();Sr._mult(1/(Sr.x*Kt.x+Sr.y*Kt.y)),$e.push(Sr._mult(q)._add(St))}xe.push($e)}return xe}(g,N*I)),function(V,q,xe){for(var Ce=0;Ce<q.length;Ce++){var ze=q[Ce];if(V.length>=3){for(var Le=0;Le<ze.length;Le++)if(zs(V,ze[Le]))return!0}if(Mo(V,ze,xe))return!0}return!1}(L,g,D)},a.prototype.isTileClipped=function(){return!0},a}(ta);function up(t,a){return a>0?a+2*t:t}var Th=pa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ah=pa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Mh=(pa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),pa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),lp=(pa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),td=pa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ph(t,a,s){return t.sections.forEach(function(p){p.text=function(m,g,w){var C=g.layout.get("text-transform").evaluate(w,{});return C==="uppercase"?m=m.toLocaleUpperCase():C==="lowercase"&&(m=m.toLocaleLowerCase()),ws.applyArabicShaping&&(m=ws.applyArabicShaping(m)),m}(p.text,a,s)}),t}pa([{name:"triangle",components:3,type:"Uint16"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pa([{type:"Float32",name:"offsetX"}]),pa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Sc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Dp=function(t,a,s,p,m){var g,w,C=8*m-p-1,I=(1<<C)-1,L=I>>1,D=-7,N=s?m-1:0,V=s?-1:1,q=t[a+N];for(N+=V,g=q&(1<<-D)-1,q>>=-D,D+=C;D>0;g=256*g+t[a+N],N+=V,D-=8);for(w=g&(1<<-D)-1,g>>=-D,D+=p;D>0;w=256*w+t[a+N],N+=V,D-=8);if(g===0)g=1-L;else{if(g===I)return w?NaN:1/0*(q?-1:1);w+=Math.pow(2,p),g-=L}return(q?-1:1)*w*Math.pow(2,g-p)},k=function(t,a,s,p,m,g){var w,C,I,L=8*g-m-1,D=(1<<L)-1,N=D>>1,V=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=p?0:g-1,xe=p?1:-1,Ce=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(C=isNaN(a)?1:0,w=D):(w=Math.floor(Math.log(a)/Math.LN2),a*(I=Math.pow(2,-w))<1&&(w--,I*=2),(a+=w+N>=1?V/I:V*Math.pow(2,1-N))*I>=2&&(w++,I/=2),w+N>=D?(C=0,w=D):w+N>=1?(C=(a*I-1)*Math.pow(2,m),w+=N):(C=a*Math.pow(2,N-1)*Math.pow(2,m),w=0));m>=8;t[s+q]=255&C,q+=xe,C/=256,m-=8);for(w=w<<m|C,L+=m;L>0;t[s+q]=255&w,q+=xe,w/=256,L-=8);t[s+q-xe]|=128*Ce},ie=ye;function ye(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ye.Varint=0,ye.Fixed64=1,ye.Bytes=2,ye.Fixed32=5;var _t=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Bt(t){return t.type===ye.Bytes?t.readVarint()+t.pos:t.pos+1}function ht(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function Mt(t,a,s){var p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(p);for(var m=s.pos-1;m>=t;m--)s.buf[m+p]=s.buf[m]}function nr(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function ar(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function fr(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function or(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function mr(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function Ar(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function rr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function vr(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function tt(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function xt(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function ir(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function kr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Ht(t,a,s){t===1&&s.readMessage(Nr,a)}function Nr(t,a,s){if(t===3){var p=s.readMessage(Qt,{}),m=p.width,g=p.height,w=p.left,C=p.top,I=p.advance;a.push({id:p.id,bitmap:new js({width:m+6,height:g+6},p.bitmap),metrics:{width:m,height:g,left:w,top:C,advance:I}})}}function Qt(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Er(t){for(var a=0,s=0,p=0,m=t;p<m.length;p+=1){var g=m[p];a+=g.w*g.h,s=Math.max(s,g.w)}t.sort(function(Ce,ze){return ze.h-Ce.h});for(var w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],C=0,I=0,L=0,D=t;L<D.length;L+=1)for(var N=D[L],V=w.length-1;V>=0;V--){var q=w[V];if(!(N.w>q.w||N.h>q.h)){if(N.x=q.x,N.y=q.y,I=Math.max(I,N.y+N.h),C=Math.max(C,N.x+N.w),N.w===q.w&&N.h===q.h){var xe=w.pop();V<w.length&&(w[V]=xe)}else N.h===q.h?(q.x+=N.w,q.w-=N.w):N.w===q.w?(q.y+=N.h,q.h-=N.h):(w.push({x:q.x+N.w,y:q.y,w:q.w-N.w,h:N.h}),q.y+=N.h,q.h-=N.h);break}}return{w:C,h:I,fill:a/(C*I)||0}}ye.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var p=this.readVarint(),m=p>>3,g=this.pos;this.type=7&p,t(m,a,this),this.pos===g&&this.skip(p)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=xt(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=kr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=xt(this.buf,this.pos)+4294967296*xt(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=xt(this.buf,this.pos)+4294967296*kr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Dp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Dp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,p=this.buf;return a=127&(s=p[this.pos++]),s<128?a:(a|=(127&(s=p[this.pos++]))<<7,s<128?a:(a|=(127&(s=p[this.pos++]))<<14,s<128?a:(a|=(127&(s=p[this.pos++]))<<21,s<128?a:function(m,g,w){var C,I,L=w.buf;if(C=(112&(I=L[w.pos++]))>>4,I<128||(C|=(127&(I=L[w.pos++]))<<3,I<128)||(C|=(127&(I=L[w.pos++]))<<10,I<128)||(C|=(127&(I=L[w.pos++]))<<17,I<128)||(C|=(127&(I=L[w.pos++]))<<24,I<128)||(C|=(1&(I=L[w.pos++]))<<31,I<128))return ht(m,C,g);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&_t?function(s,p,m){return _t.decode(s.subarray(p,m))}(this.buf,a,t):function(s,p,m){for(var g="",w=p;w<m;){var C,I,L,D=s[w],N=null,V=D>239?4:D>223?3:D>191?2:1;if(w+V>m)break;V===1?D<128&&(N=D):V===2?(192&(C=s[w+1]))==128&&(N=(31&D)<<6|63&C)<=127&&(N=null):V===3?(I=s[w+2],(192&(C=s[w+1]))==128&&(192&I)==128&&((N=(15&D)<<12|(63&C)<<6|63&I)<=2047||N>=55296&&N<=57343)&&(N=null)):V===4&&(I=s[w+2],L=s[w+3],(192&(C=s[w+1]))==128&&(192&I)==128&&(192&L)==128&&((N=(15&D)<<18|(63&C)<<12|(63&I)<<6|63&L)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,V=1):N>65535&&(N-=65536,g+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),g+=String.fromCharCode(N),w+=V}return g}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==ye.Bytes)return t.push(this.readVarint(a));var s=Bt(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==ye.Bytes)return t.push(this.readSVarint());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ye.Bytes)return t.push(this.readBoolean());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ye.Bytes)return t.push(this.readFloat());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ye.Bytes)return t.push(this.readDouble());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ye.Bytes)return t.push(this.readFixed32());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ye.Bytes)return t.push(this.readSFixed32());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ye.Bytes)return t.push(this.readFixed64());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ye.Bytes)return t.push(this.readSFixed64());var a=Bt(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===ye.Varint)for(;this.buf[this.pos++]>127;);else if(a===ye.Bytes)this.pos=this.readVarint()+this.pos;else if(a===ye.Fixed32)this.pos+=4;else{if(a!==ye.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ir(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ir(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ir(this.buf,-1&t,this.pos),ir(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ir(this.buf,-1&t,this.pos),ir(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var p,m;if(a>=0?(p=a%4294967296|0,m=a/4294967296|0):(m=~(-a/4294967296),4294967295^(p=~(-a%4294967296))?p=p+1|0:(p=0,m=m+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,w,C){C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,C.buf[C.pos]=127&(g>>>=7)}(p,0,s),function(g,w){var C=(7&g)<<4;w.buf[w.pos++]|=C|((g>>>=3)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g)))))}(m,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(p,m,g){for(var w,C,I=0;I<m.length;I++){if((w=m.charCodeAt(I))>55295&&w<57344){if(!C){w>56319||I+1===m.length?(p[g++]=239,p[g++]=191,p[g++]=189):C=w;continue}if(w<56320){p[g++]=239,p[g++]=191,p[g++]=189,C=w;continue}w=C-55296<<10|w-56320|65536,C=null}else C&&(p[g++]=239,p[g++]=191,p[g++]=189,C=null);w<128?p[g++]=w:(w<2048?p[g++]=w>>6|192:(w<65536?p[g++]=w>>12|224:(p[g++]=w>>18|240,p[g++]=w>>12&63|128),p[g++]=w>>6&63|128),p[g++]=63&w|128)}return g}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&Mt(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),k(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),k(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var p=this.pos-s;p>=128&&Mt(s,p,this),this.pos=s-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,a,s){this.writeTag(t,ye.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,nr,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,ar,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,mr,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,fr,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,or,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,Ar,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,rr,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,vr,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,tt,a)},writeBytesField:function(t,a){this.writeTag(t,ye.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,ye.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,ye.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,ye.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,ye.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,ye.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,ye.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,ye.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,ye.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,ye.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var Wt=function(t,a){var s=a.pixelRatio,p=a.version,m=a.stretchX,g=a.stretchY,w=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=g,this.content=w,this.version=p},yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yr.tlbr.get=function(){return this.tl.concat(this.br)},yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Wt.prototype,yr);var ln=function(t,a){var s={},p={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,s,m),this.addImages(a,p,m);var g=Er(m),w=new qa({width:g.w||1,height:g.h||1});for(var C in t){var I=t[C],L=s[C].paddedRect;qa.copy(I.data,w,{x:0,y:0},{x:L.x+1,y:L.y+1},I.data)}for(var D in a){var N=a[D],V=p[D].paddedRect,q=V.x+1,xe=V.y+1,Ce=N.data.width,ze=N.data.height;qa.copy(N.data,w,{x:0,y:0},{x:q,y:xe},N.data),qa.copy(N.data,w,{x:0,y:ze-1},{x:q,y:xe-1},{width:Ce,height:1}),qa.copy(N.data,w,{x:0,y:0},{x:q,y:xe+ze},{width:Ce,height:1}),qa.copy(N.data,w,{x:Ce-1,y:0},{x:q-1,y:xe},{width:1,height:ze}),qa.copy(N.data,w,{x:0,y:0},{x:q+Ce,y:xe},{width:1,height:ze})}this.image=w,this.iconPositions=s,this.patternPositions=p};ln.prototype.addImages=function(t,a,s){for(var p in t){var m=t[p],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(g),a[p]=new Wt(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},ln.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},ln.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var p=t.tl;s.update(a.data,void 0,{x:p[0],y:p[1]})}},Hr("ImagePosition",Wt),Hr("ImageAtlas",ln);var pn={horizontal:1,vertical:2,horizontalOnly:3},wr=function(){this.scale=1,this.fontStack="",this.imageName=null};wr.forText=function(t,a){var s=new wr;return s.scale=t||1,s.fontStack=a,s},wr.forImage=function(t){var a=new wr;return a.imageName=t,a};var qt=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function jt(t,a,s,p,m,g,w,C,I,L,D,N,V,q,xe,Ce){var ze,Le=qt.fromFeature(t,m);N===pn.vertical&&Le.verticalizePunctuation();var $e=ws.processBidirectionalText,ot=ws.processStyledBidirectionalText;if($e&&Le.sections.length===1){ze=[];for(var St=0,Pt=$e(Le.toString(),gi(Le,L,g,a,p,q,xe));St<Pt.length;St+=1){var zt=Pt[St],Kt=new qt;Kt.text=zt,Kt.sections=Le.sections;for(var Sr=0;Sr<zt.length;Sr++)Kt.sectionIndex.push(0);ze.push(Kt)}}else if(ot){ze=[];for(var tr=0,zr=ot(Le.text,Le.sectionIndex,gi(Le,L,g,a,p,q,xe));tr<zr.length;tr+=1){var nn=zr[tr],Br=new qt;Br.text=nn[0],Br.sectionIndex=nn[1],Br.sections=Le.sections,ze.push(Br)}}else ze=function(en,oi){for(var Gn=[],si=en.text,hn=0,_i=0,aa=oi;_i<aa.length;_i+=1){var Oa=aa[_i];Gn.push(en.substring(hn,Oa)),hn=Oa}return hn<si.length&&Gn.push(en.substring(hn,si.length)),Gn}(Le,gi(Le,L,g,a,p,q,xe));var Kn=[],En={positionedLines:Kn,text:Le.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(en,oi,Gn,si,hn,_i,aa,Oa,ka,oa,La,po){for(var ho=0,ts=-17,Oo=0,rs=0,Ua=Oa==="right"?1:Oa==="left"?0:.5,ko=0,fi=0,zi=hn;fi<zi.length;fi+=1){var Fi=zi[fi];Fi.trim();var bi=Fi.getMaxScale(),ns=24*(bi-1),Go={positionedGlyphs:[],lineOffset:0};en.positionedLines[ko]=Go;var Xi=Go.positionedGlyphs,ja=0;if(Fi.length()){for(var Lo=0;Lo<Fi.length();Lo++){var Ci=Fi.getSection(Lo),Jl=Fi.getSectionIndex(Lo),Mu=Fi.getCharCode(Lo),Tl=0,Ra=null,Ql=null,el=null,Uf=24,jf=!(ka===pn.horizontal||!La&&!vl(Mu)||La&&(xn[Mu]||(As=Mu,hr.Arabic(As)||hr["Arabic Supplement"](As)||hr["Arabic Extended-A"](As)||hr["Arabic Presentation Forms-A"](As)||hr["Arabic Presentation Forms-B"](As))));if(Ci.imageName){var fp=si[Ci.imageName];if(!fp)continue;el=Ci.imageName,en.iconsInText=en.iconsInText||!0,Ql=fp.paddedRect;var Tc=fp.displaySize;Ci.scale=24*Ci.scale/po,Tl=ns+(24-Tc[1]*Ci.scale),Uf=(Ra={width:Tc[0],height:Tc[1],left:1,top:-3,advance:jf?Tc[1]:Tc[0]}).advance;var pp=jf?Tc[0]*Ci.scale-24*bi:Tc[1]*Ci.scale-24*bi;pp>0&&pp>ja&&(ja=pp)}else{var tl=Gn[Ci.fontStack],ec=tl&&tl[Mu];if(ec&&ec.rect)Ql=ec.rect,Ra=ec.metrics;else{var Pu=oi[Ci.fontStack],Ws=Pu&&Pu[Mu];if(!Ws)continue;Ra=Ws.metrics}Tl=24*(bi-Ci.scale)}jf?(en.verticalizable=!0,Xi.push({glyph:Mu,imageName:el,x:ho,y:ts+Tl,vertical:jf,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:Jl,metrics:Ra,rect:Ql}),ho+=Uf*Ci.scale+oa):(Xi.push({glyph:Mu,imageName:el,x:ho,y:ts+Tl,vertical:jf,scale:Ci.scale,fontStack:Ci.fontStack,sectionIndex:Jl,metrics:Ra,rect:Ql}),ho+=Ra.advance*Ci.scale+oa)}Xi.length!==0&&(Oo=Math.max(ho-oa,Oo),so(Xi,0,Xi.length-1,Ua,ja)),ho=0;var of=_i*bi+ja;Go.lineOffset=Math.max(ja,ns),ts+=of,rs=Math.max(of,rs),++ko}else ts+=_i,++ko}var As,Ac=ts- -17,Mc=ba(aa),ms=Mc.horizontalAlign,rl=Mc.verticalAlign;(function(Ro,Iu,uu,sf,Oh,hp,Vf,Zp,kh){var Gf,Up=(Iu-uu)*Oh;Gf=hp!==Vf?-Zp*sf- -17:(-sf*kh+.5)*Vf;for(var dp=0,jp=Ro;dp<jp.length;dp+=1)for(var uf=0,lf=jp[dp].positionedGlyphs;uf<lf.length;uf+=1){var vp=lf[uf];vp.x+=Up,vp.y+=Gf}})(en.positionedLines,Ua,ms,rl,Oo,rs,_i,Ac,hn.length),en.top+=-rl*Ac,en.bottom=en.top+Ac,en.left+=-ms*Oo,en.right=en.left+Oo}(En,a,s,p,ze,w,C,I,N,L,V,Ce),!function(en){for(var oi=0,Gn=en;oi<Gn.length;oi+=1)if(Gn[oi].positionedGlyphs.length!==0)return!1;return!0}(Kn)&&En}qt.fromFeature=function(t,a){for(var s=new qt,p=0;p<t.sections.length;p++){var m=t.sections[p];m.image?s.addImageSection(m):s.addTextSection(m,a)}return s},qt.prototype.length=function(){return this.text.length},qt.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},qt.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},qt.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},qt.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var p=t.charCodeAt(s+1)||null,m=t.charCodeAt(s-1)||null;a+=p&&Uu(p)&&!Sc[t[s+1]]||m&&Uu(m)&&!Sc[t[s-1]]||!Sc[t[s]]?t[s]:Sc[t[s]]}return a}(this.text)},qt.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&xn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,p=this.text.length-1;p>=0&&p>=t&&xn[this.text.charCodeAt(p)];p--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},qt.prototype.substring=function(t,a){var s=new qt;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},qt.prototype.toString=function(){return this.text},qt.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},qt.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(wr.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(s)},qt.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(wr.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}else Ye("Can't add FormattedSection with an empty image.")},qt.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var xn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yn={};function Kr(t,a,s,p,m,g){if(a.imageName){var w=p[a.imageName];return w?w.displaySize[0]*a.scale*24/g+m:0}var C=s[a.fontStack],I=C&&C[t];return I?I.metrics.advance*a.scale+m:0}function Qn(t,a,s,p){var m=Math.pow(t-a,2);return p?t<a?m/2:2*m:m+Math.abs(s)*s}function Dn(t,a,s){var p=0;return t===10&&(p-=1e4),s&&(p+=150),t!==40&&t!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function Yn(t,a,s,p,m,g){for(var w=null,C=Qn(a,s,m,g),I=0,L=p;I<L.length;I+=1){var D=L[I],N=Qn(a-D.x,s,m,g)+D.badness;N<=C&&(w=D,C=N)}return{index:t,x:a,priorBreak:w,badness:C}}function gi(t,a,s,p,m,g,w){if(g!=="point")return[];if(!t)return[];for(var C,I=[],L=function(ze,Le,$e,ot,St,Pt){for(var zt=0,Kt=0;Kt<ze.length();Kt++){var Sr=ze.getSection(Kt);zt+=Kr(ze.getCharCode(Kt),Sr,ot,St,Le,Pt)}return zt/Math.max(1,Math.ceil(zt/$e))}(t,a,s,p,m,w),D=t.text.indexOf("\u200B")>=0,N=0,V=0;V<t.length();V++){var q=t.getSection(V),xe=t.getCharCode(V);if(xn[xe]||(N+=Kr(xe,q,p,m,a,w)),V<t.length()-1){var Ce=!((C=xe)<11904||!(hr["Bopomofo Extended"](C)||hr.Bopomofo(C)||hr["CJK Compatibility Forms"](C)||hr["CJK Compatibility Ideographs"](C)||hr["CJK Compatibility"](C)||hr["CJK Radicals Supplement"](C)||hr["CJK Strokes"](C)||hr["CJK Symbols and Punctuation"](C)||hr["CJK Unified Ideographs Extension A"](C)||hr["CJK Unified Ideographs"](C)||hr["Enclosed CJK Letters and Months"](C)||hr["Halfwidth and Fullwidth Forms"](C)||hr.Hiragana(C)||hr["Ideographic Description Characters"](C)||hr["Kangxi Radicals"](C)||hr["Katakana Phonetic Extensions"](C)||hr.Katakana(C)||hr["Vertical Forms"](C)||hr["Yi Radicals"](C)||hr["Yi Syllables"](C)));(yn[xe]||Ce||q.imageName)&&I.push(Yn(V+1,N,L,I,Dn(xe,t.getCharCode(V+1),Ce&&D),!1))}}return function ze(Le){return Le?ze(Le.priorBreak).concat(Le.index):[]}(Yn(t.length(),N,L,I,0,!0))}function ba(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function so(t,a,s,p,m){if(p||m)for(var g=t[s],w=(t[s].x+g.metrics.advance*g.scale)*p,C=a;C<=s;C++)t[C].x-=w,t[C].y+=m}function ai(t,a,s,p,m,g){var w,C=t.image;if(C.content){var I=C.content,L=C.pixelRatio||1;w=[I[0]/L,I[1]/L,C.displaySize[0]-I[2]/L,C.displaySize[1]-I[3]/L]}var D,N,V,q,xe=a.left*g,Ce=a.right*g;s==="width"||s==="both"?(q=m[0]+xe-p[3],N=m[0]+Ce+p[1]):N=(q=m[0]+(xe+Ce-C.displaySize[0])/2)+C.displaySize[0];var ze=a.top*g,Le=a.bottom*g;return s==="height"||s==="both"?(D=m[1]+ze-p[0],V=m[1]+Le+p[2]):V=(D=m[1]+(ze+Le-C.displaySize[1])/2)+C.displaySize[1],{image:C,top:D,right:N,bottom:V,left:q,collisionPadding:w}}yn[10]=!0,yn[32]=!0,yn[38]=!0,yn[40]=!0,yn[41]=!0,yn[43]=!0,yn[45]=!0,yn[47]=!0,yn[173]=!0,yn[183]=!0,yn[8203]=!0,yn[8208]=!0,yn[8211]=!0,yn[8231]=!0;var ha=function(t){function a(s,p,m,g){t.call(this,s,p),this.angle=m,g!==void 0&&(this.segment=g)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(me);function Hi(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Xn(t+1))};if(s.kind==="source")return{kind:"source"};for(var p=s.zoomStops,m=s.interpolationType,g=0;g<p.length&&p[g]<=t;)g++;for(var w=g=Math.max(0,g-1);w<p.length&&p[w]<t+1;)w++;w=Math.min(p.length-1,w);var C=p[g],I=p[w];return s.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:C,maxZoom:I,minSize:s.evaluate(new Xn(C)),maxSize:s.evaluate(new Xn(I)),interpolationType:m}}function Za(t,a,s){var p=a.uSize,m=s.lowerSize;return t.kind==="source"?m/128:t.kind==="composite"?la(m/128,s.upperSize/128,a.uSizeT):p}function Ka(t,a){var s=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var m=t.interpolationType,g=m?M(Yi.interpolationFactor(m,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=la(t.minSize,t.maxSize,g):s=g}return{uSizeT:s,uSize:p}}Hr("Anchor",ha);var $a=Object.freeze({__proto__:null,getSizeData:Hi,evaluateSizeForFeature:Za,evaluateSizeForZoom:Ka,SIZE_PACK_FACTOR:128});function uo(t,a,s,p,m){if(a.segment===void 0)return!0;for(var g=a,w=a.segment+1,C=0;C>-s/2;){if(--w<0)return!1;C-=t[w].dist(g),g=t[w]}C+=t[w].dist(t[w+1]),w++;for(var I=[],L=0;C<s/2;){var D=t[w],N=t[w+1];if(!N)return!1;var V=t[w-1].angleTo(D)-D.angleTo(N);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:C,angleDelta:V}),L+=V;C-I[0].distance>p;)L-=I.shift().angleDelta;if(L>m)return!1;w++,C+=D.dist(N)}return!0}function _o(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ia(t,a,s){return t?.6*a*s:0}function Vn(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Po(t,a,s,p,m,g){for(var w=Ia(s,m,g),C=Vn(s,p)*g,I=0,L=_o(t)/2,D=0;D<t.length-1;D++){var N=t[D],V=t[D+1],q=N.dist(V);if(I+q>L){var xe=(L-I)/q,Ce=la(N.x,V.x,xe),ze=la(N.y,V.y,xe),Le=new ha(Ce,ze,V.angleTo(N),D);return Le._round(),!w||uo(t,Le,C,w,a)?Le:void 0}I+=q}}function Ai(t,a,s,p,m,g,w,C,I){var L=Ia(p,g,w),D=Vn(p,m),N=D*w,V=t[0].x===0||t[0].x===I||t[0].y===0||t[0].y===I;return a-N<a/4&&(a=N+a/4),function q(xe,Ce,ze,Le,$e,ot,St,Pt,zt){for(var Kt=ot/2,Sr=_o(xe),tr=0,zr=Ce-ze,nn=[],Br=0;Br<xe.length-1;Br++){for(var Kn=xe[Br],En=xe[Br+1],en=Kn.dist(En),oi=En.angleTo(Kn);zr+ze<tr+en;){var Gn=((zr+=ze)-tr)/en,si=la(Kn.x,En.x,Gn),hn=la(Kn.y,En.y,Gn);if(si>=0&&si<zt&&hn>=0&&hn<zt&&zr-Kt>=0&&zr+Kt<=Sr){var _i=new ha(si,hn,oi,Br);_i._round(),Le&&!uo(xe,_i,ot,Le,$e)||nn.push(_i)}}tr+=en}return Pt||nn.length||St||(nn=q(xe,tr/2,ze,Le,$e,ot,St,!0,zt)),nn}(t,V?a/2*C%a:(D/2+2*g)*w*C%a,a,L,s,N,V,!1,I)}function mn(t,a,s,p,m){for(var g=[],w=0;w<t.length;w++)for(var C=t[w],I=void 0,L=0;L<C.length-1;L++){var D=C[L],N=C[L+1];D.x<a&&N.x<a||(D.x<a?D=new me(a,D.y+(a-D.x)/(N.x-D.x)*(N.y-D.y))._round():N.x<a&&(N=new me(a,D.y+(a-D.x)/(N.x-D.x)*(N.y-D.y))._round()),D.y<s&&N.y<s||(D.y<s?D=new me(D.x+(s-D.y)/(N.y-D.y)*(N.x-D.x),s)._round():N.y<s&&(N=new me(D.x+(s-D.y)/(N.y-D.y)*(N.x-D.x),s)._round()),D.x>=p&&N.x>=p||(D.x>=p?D=new me(p,D.y+(p-D.x)/(N.x-D.x)*(N.y-D.y))._round():N.x>=p&&(N=new me(p,D.y+(p-D.x)/(N.x-D.x)*(N.y-D.y))._round()),D.y>=m&&N.y>=m||(D.y>=m?D=new me(D.x+(m-D.y)/(N.y-D.y)*(N.x-D.x),m)._round():N.y>=m&&(N=new me(D.x+(m-D.y)/(N.y-D.y)*(N.x-D.x),m)._round()),I&&D.equals(I[I.length-1])||g.push(I=[D]),I.push(N)))))}return g}function ei(t,a,s,p){var m=[],g=t.image,w=g.pixelRatio,C=g.paddedRect.w-2,I=g.paddedRect.h-2,L=t.right-t.left,D=t.bottom-t.top,N=g.stretchX||[[0,C]],V=g.stretchY||[[0,I]],q=function(si,hn){return si+hn[1]-hn[0]},xe=N.reduce(q,0),Ce=V.reduce(q,0),ze=C-xe,Le=I-Ce,$e=0,ot=xe,St=0,Pt=Ce,zt=0,Kt=ze,Sr=0,tr=Le;if(g.content&&p){var zr=g.content;$e=ci(N,0,zr[0]),St=ci(V,0,zr[1]),ot=ci(N,zr[0],zr[2]),Pt=ci(V,zr[1],zr[3]),zt=zr[0]-$e,Sr=zr[1]-St,Kt=zr[2]-zr[0]-ot,tr=zr[3]-zr[1]-Pt}var nn=function(si,hn,_i,aa){var Oa=Gs(si.stretch-$e,ot,L,t.left),ka=Qu(si.fixed-zt,Kt,si.stretch,xe),oa=Gs(hn.stretch-St,Pt,D,t.top),La=Qu(hn.fixed-Sr,tr,hn.stretch,Ce),po=Gs(_i.stretch-$e,ot,L,t.left),ho=Qu(_i.fixed-zt,Kt,_i.stretch,xe),ts=Gs(aa.stretch-St,Pt,D,t.top),Oo=Qu(aa.fixed-Sr,tr,aa.stretch,Ce),rs=new me(Oa,oa),Ua=new me(po,oa),ko=new me(po,ts),fi=new me(Oa,ts),zi=new me(ka/w,La/w),Fi=new me(ho/w,Oo/w),bi=a*Math.PI/180;if(bi){var ns=Math.sin(bi),Go=Math.cos(bi),Xi=[Go,-ns,ns,Go];rs._matMult(Xi),Ua._matMult(Xi),fi._matMult(Xi),ko._matMult(Xi)}var ja=si.stretch+si.fixed,Lo=hn.stretch+hn.fixed;return{tl:rs,tr:Ua,bl:fi,br:ko,tex:{x:g.paddedRect.x+1+ja,y:g.paddedRect.y+1+Lo,w:_i.stretch+_i.fixed-ja,h:aa.stretch+aa.fixed-Lo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zi,pixelOffsetBR:Fi,minFontScaleX:Kt/w/L,minFontScaleY:tr/w/D,isSDF:s}};if(p&&(g.stretchX||g.stretchY))for(var Br=wa(N,ze,xe),Kn=wa(V,Le,Ce),En=0;En<Br.length-1;En++)for(var en=Br[En],oi=Br[En+1],Gn=0;Gn<Kn.length-1;Gn++)m.push(nn(en,Kn[Gn],oi,Kn[Gn+1]));else m.push(nn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return m}function ci(t,a,s){for(var p=0,m=0,g=t;m<g.length;m+=1){var w=g[m];p+=Math.max(a,Math.min(s,w[1]))-Math.max(a,Math.min(s,w[0]))}return p}function wa(t,a,s){for(var p=[{fixed:-1,stretch:0}],m=0,g=t;m<g.length;m+=1){var w=g[m],C=w[0],I=w[1],L=p[p.length-1];p.push({fixed:C-L.stretch,stretch:L.stretch}),p.push({fixed:C-L.stretch,stretch:L.stretch+(I-C)})}return p.push({fixed:a+1,stretch:s}),p}function Gs(t,a,s,p){return t/a*s+p}function Qu(t,a,s,p){return t-a*s/p}var _e=function(t,a,s,p,m,g,w,C,I,L){if(this.boxStartIndex=t.length,I){var D=g.top,N=g.bottom,V=g.collisionPadding;V&&(D-=V[1],N+=V[3]);var q=N-D;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{var xe=g.top*w-C,Ce=g.bottom*w+C,ze=g.left*w-C,Le=g.right*w+C,$e=g.collisionPadding;if($e&&(ze-=$e[0]*w,xe-=$e[1]*w,Le+=$e[2]*w,Ce+=$e[3]*w),L){var ot=new me(ze,xe),St=new me(Le,xe),Pt=new me(ze,Ce),zt=new me(Le,Ce),Kt=L*Math.PI/180;ot._rotate(Kt),St._rotate(Kt),Pt._rotate(Kt),zt._rotate(Kt),ze=Math.min(ot.x,St.x,Pt.x,zt.x),Le=Math.max(ot.x,St.x,Pt.x,zt.x),xe=Math.min(ot.y,St.y,Pt.y,zt.y),Ce=Math.max(ot.y,St.y,Pt.y,zt.y)}t.emplaceBack(a.x,a.y,ze,xe,Le,Ce,s,p,m)}this.boxEndIndex=t.length},yt=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ft),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ft(t,a){return t<a?-1:t>a?1:0}function Vr(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var p=1/0,m=1/0,g=-1/0,w=-1/0,C=t[0],I=0;I<C.length;I++){var L=C[I];(!I||L.x<p)&&(p=L.x),(!I||L.y<m)&&(m=L.y),(!I||L.x>g)&&(g=L.x),(!I||L.y>w)&&(w=L.y)}var D=Math.min(g-p,w-m),N=D/2,V=new yt([],ti);if(D===0)return new me(p,m);for(var q=p;q<g;q+=D)for(var xe=m;xe<w;xe+=D)V.push(new pe(q+N,xe+N,N,t));for(var Ce=function($e){for(var ot=0,St=0,Pt=0,zt=$e[0],Kt=0,Sr=zt.length,tr=Sr-1;Kt<Sr;tr=Kt++){var zr=zt[Kt],nn=zt[tr],Br=zr.x*nn.y-nn.x*zr.y;St+=(zr.x+nn.x)*Br,Pt+=(zr.y+nn.y)*Br,ot+=3*Br}return new pe(St/ot,Pt/ot,0,$e)}(t),ze=V.length;V.length;){var Le=V.pop();(Le.d>Ce.d||!Ce.d)&&(Ce=Le,s&&console.log("found best %d after %d probes",Math.round(1e4*Le.d)/1e4,ze)),Le.max-Ce.d<=a||(V.push(new pe(Le.p.x-(N=Le.h/2),Le.p.y-N,N,t)),V.push(new pe(Le.p.x+N,Le.p.y-N,N,t)),V.push(new pe(Le.p.x-N,Le.p.y+N,N,t)),V.push(new pe(Le.p.x+N,Le.p.y+N,N,t)),ze+=4)}return s&&(console.log("num probes: "+ze),console.log("best distance: "+Ce.d)),Ce.p}function ti(t,a){return a.max-t.max}function pe(t,a,s,p){this.p=new me(t,a),this.h=s,this.d=function(m,g){for(var w=!1,C=1/0,I=0;I<g.length;I++)for(var L=g[I],D=0,N=L.length,V=N-1;D<N;V=D++){var q=L[D],xe=L[V];q.y>m.y!=xe.y>m.y&&m.x<(xe.x-q.x)*(m.y-q.y)/(xe.y-q.y)+q.x&&(w=!w),C=Math.min(C,iu(m,q,xe))}return(w?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}yt.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},yt.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},yt.prototype.peek=function(){return this.data[0]},yt.prototype._up=function(t){for(var a=this.data,s=this.compare,p=a[t];t>0;){var m=t-1>>1,g=a[m];if(s(p,g)>=0)break;a[t]=g,t=m}a[t]=p},yt.prototype._down=function(t){for(var a=this.data,s=this.compare,p=this.length>>1,m=a[t];t<p;){var g=1+(t<<1),w=a[g],C=g+1;if(C<this.length&&s(a[C],w)<0&&(g=C,w=a[C]),s(w,m)>=0)break;a[t]=w,t=g}a[t]=m};var $=Number.POSITIVE_INFINITY;function Be(t,a){return a[1]!==$?function(s,p,m){var g=0,w=0;switch(p=Math.abs(p),m=Math.abs(m),s){case"top-right":case"top-left":case"top":w=m-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-m}switch(s){case"top-right":case"bottom-right":case"right":g=-p;break;case"top-left":case"bottom-left":case"left":g=p}return[g,w]}(t,a[0],a[1]):function(s,p){var m=0,g=0;p<0&&(p=0);var w=p/Math.sqrt(2);switch(s){case"top-right":case"top-left":g=w-7;break;case"bottom-right":case"bottom-left":g=7-w;break;case"bottom":g=7-p;break;case"top":g=p-7}switch(s){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=p;break;case"right":m=-p}return[m,g]}(t,a[0])}function Qe(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function et(t,a,s,p,m,g,w,C,I,L,D,N,V,q,xe){var Ce=function(St,Pt,zt,Kt,Sr,tr,zr,nn){for(var Br=Kt.layout.get("text-rotate").evaluate(tr,{})*Math.PI/180,Kn=[],En=0,en=Pt.positionedLines;En<en.length;En+=1)for(var oi=en[En],Gn=0,si=oi.positionedGlyphs;Gn<si.length;Gn+=1){var hn=si[Gn];if(hn.rect){var _i=hn.rect||{},aa=4,Oa=!0,ka=1,oa=0,La=(Sr||nn)&&hn.vertical,po=hn.metrics.advance*hn.scale/2;if(nn&&Pt.verticalizable&&(oa=oi.lineOffset/2-(hn.imageName?-(24-hn.metrics.width*hn.scale)/2:24*(hn.scale-1))),hn.imageName){var ho=zr[hn.imageName];Oa=ho.sdf,aa=1/(ka=ho.pixelRatio)}var ts=Sr?[hn.x+po,hn.y]:[0,0],Oo=Sr?[0,0]:[hn.x+po+zt[0],hn.y+zt[1]-oa],rs=[0,0];La&&(rs=Oo,Oo=[0,0]);var Ua=(hn.metrics.left-aa)*hn.scale-po+Oo[0],ko=(-hn.metrics.top-aa)*hn.scale+Oo[1],fi=Ua+_i.w*hn.scale/ka,zi=ko+_i.h*hn.scale/ka,Fi=new me(Ua,ko),bi=new me(fi,ko),ns=new me(Ua,zi),Go=new me(fi,zi);if(La){var Xi=new me(-po,po- -17),ja=-Math.PI/2,Lo=12-po,Ci=new me(22-Lo,-(hn.imageName?Lo:0)),Jl=new(Function.prototype.bind.apply(me,[null].concat(rs)));Fi._rotateAround(ja,Xi)._add(Ci)._add(Jl),bi._rotateAround(ja,Xi)._add(Ci)._add(Jl),ns._rotateAround(ja,Xi)._add(Ci)._add(Jl),Go._rotateAround(ja,Xi)._add(Ci)._add(Jl)}if(Br){var Mu=Math.sin(Br),Tl=Math.cos(Br),Ra=[Tl,-Mu,Mu,Tl];Fi._matMult(Ra),bi._matMult(Ra),ns._matMult(Ra),Go._matMult(Ra)}var Ql=new me(0,0),el=new me(0,0);Kn.push({tl:Fi,tr:bi,bl:ns,br:Go,tex:_i,writingMode:Pt.writingMode,glyphOffset:ts,sectionIndex:hn.sectionIndex,isSDF:Oa,pixelOffsetTL:Ql,pixelOffsetBR:el,minFontScaleX:0,minFontScaleY:0})}}return Kn}(0,s,C,m,g,w,p,t.allowVerticalPlacement),ze=t.textSizeData,Le=null;ze.kind==="source"?(Le=[128*m.layout.get("text-size").evaluate(w,{})])[0]>32640&&Ye(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ze.kind==="composite"&&((Le=[128*q.compositeTextSizes[0].evaluate(w,{},xe),128*q.compositeTextSizes[1].evaluate(w,{},xe)])[0]>32640||Le[1]>32640)&&Ye(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Ce,Le,C,g,w,L,a,I.lineStartIndex,I.lineLength,V,xe);for(var $e=0,ot=D;$e<ot.length;$e+=1)N[ot[$e]]=t.text.placedSymbolArray.length-1;return 4*Ce.length}function Ue(t){for(var a in t)return t[a];return null}function Ne(t,a,s,p){var m=t.compareText;if(a in m){for(var g=m[a],w=g.length-1;w>=0;w--)if(p.dist(g[w])<s)return!0}else m[a]=[];return m[a].push(p),!1}var Xe=wc.VectorTileFeature.types,de=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Re(t,a,s,p,m,g,w,C,I,L,D,N,V){var q=C?Math.min(32640,Math.round(C[0])):0,xe=C?Math.min(32640,Math.round(C[1])):0;t.emplaceBack(a,s,Math.round(32*p),Math.round(32*m),g,w,(q<<1)+(I?1:0),xe,16*L,16*D,256*N,256*V)}function ce(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function Ke(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(Mf(s[a].text))return!0;return!1}var it=function(t){this.layoutVertexArray=new ga,this.indexArray=new Cu,this.programConfigurations=t,this.segments=new ee,this.dynamicLayoutVertexArray=new re,this.opacityVertexArray=new Vl,this.placedSymbolArray=new h};it.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},it.prototype.upload=function(t,a,s,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Th.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ah.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,de,!0),this.opacityVertexBuffer.itemSize=1),(s||p)&&this.programConfigurations.upload(t))},it.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Hr("SymbolBuffers",it);var Nt=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new ee,this.collisionVertexArray=new yc};Nt.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Mh.members,!0)},Nt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Hr("CollisionBuffers",Nt);var mt=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ao([]),this.placementViewportMatrix=ao([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hi(this.zoom,a["text-size"]),this.iconSizeData=Hi(this.zoom,a["icon-size"]);var s=this.layers[0].layout,p=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(g){return pn[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=t.sourceID};mt.prototype.createArrays=function(){this.text=new it(new _n(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new it(new _n(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new E,this.lineVertexArray=new P,this.symbolInstances=new S},mt.prototype.calculateGlyphDependencies=function(t,a,s,p,m){for(var g=0;g<t.length;g++)if(a[t.charCodeAt(g)]=!0,(s||p)&&m){var w=Sc[t.charAt(g)];w&&(a[w.charCodeAt(0)]=!0)}},mt.prototype.populate=function(t,a,s){var p=this.layers[0],m=p.layout,g=m.get("text-font"),w=m.get("text-field"),C=m.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Bi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),L=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],I||L){for(var N=a.iconDependencies,V=a.glyphDependencies,q=a.availableImages,xe=new Xn(this.zoom),Ce=0,ze=t;Ce<ze.length;Ce+=1){var Le=ze[Ce],$e=Le.feature,ot=Le.id,St=Le.index,Pt=Le.sourceLayerIndex,zt=p._featureFilter.needGeometry,Kt=_a($e,zt);if(p._featureFilter.filter(xe,Kt,s)){zt||(Kt.geometry=ra($e));var Sr=void 0;if(I){var tr=p.getValueAndResolveTokens("text-field",Kt,s,q),zr=Bi.factory(tr);Ke(zr)&&(this.hasRTLText=!0),(!this.hasRTLText||Of()==="unavailable"||this.hasRTLText&&ws.isParsed())&&(Sr=Ph(zr,p,Kt))}var nn=void 0;if(L){var Br=p.getValueAndResolveTokens("icon-image",Kt,s,q);nn=Br instanceof ea?Br:ea.fromString(Br)}if(Sr||nn){var Kn=this.sortFeaturesByKey?D.evaluate(Kt,{},s):void 0;if(this.features.push({id:ot,text:Sr,icon:nn,index:St,sourceLayerIndex:Pt,geometry:Kt.geometry,properties:$e.properties,type:Xe[$e.type],sortKey:Kn}),nn&&(N[nn.name]=!0),Sr){var En=g.evaluate(Kt,{},s).join(","),en=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pn.vertical)>=0;for(var oi=0,Gn=Sr.sections;oi<Gn.length;oi+=1){var si=Gn[oi];if(si.image)N[si.image.name]=!0;else{var hn=Af(Sr.toString()),_i=si.fontStack||En,aa=V[_i]=V[_i]||{};this.calculateGlyphDependencies(si.text,aa,en,this.allowVerticalPlacement,hn)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function(Oa){var ka={},oa={},La=[],po=0;function ho(Xi){La.push(Oa[Xi]),po++}function ts(Xi,ja,Lo){var Ci=oa[Xi];return delete oa[Xi],oa[ja]=Ci,La[Ci].geometry[0].pop(),La[Ci].geometry[0]=La[Ci].geometry[0].concat(Lo[0]),Ci}function Oo(Xi,ja,Lo){var Ci=ka[ja];return delete ka[ja],ka[Xi]=Ci,La[Ci].geometry[0].shift(),La[Ci].geometry[0]=Lo[0].concat(La[Ci].geometry[0]),Ci}function rs(Xi,ja,Lo){var Ci=Lo?ja[0][ja[0].length-1]:ja[0][0];return Xi+":"+Ci.x+":"+Ci.y}for(var Ua=0;Ua<Oa.length;Ua++){var ko=Oa[Ua],fi=ko.geometry,zi=ko.text?ko.text.toString():null;if(zi){var Fi=rs(zi,fi),bi=rs(zi,fi,!0);if(Fi in oa&&bi in ka&&oa[Fi]!==ka[bi]){var ns=Oo(Fi,bi,fi),Go=ts(Fi,bi,La[ns].geometry);delete ka[Fi],delete oa[bi],oa[rs(zi,La[Go].geometry,!0)]=Go,La[ns].geometry=null}else Fi in oa?ts(Fi,bi,fi):bi in ka?Oo(Fi,bi,fi):(ho(Ua),ka[Fi]=po-1,oa[bi]=po-1)}else ho(Ua)}return La.filter(function(Xi){return Xi.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Oa,ka){return Oa.sortKey-ka.sortKey})}},mt.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},mt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},mt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},mt.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},mt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},mt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},mt.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(a[t.segment+1]),m=t.dist(a[t.segment]),g={},w=t.segment+1;w<a.length;w++)g[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:p},w<a.length-1&&(p+=a[w+1].dist(a[w]));for(var C=t.segment||0;C>=0;C--)g[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:m},C>0&&(m+=a[C-1].dist(a[C]));for(var I=0;I<a.length;I++){var L=g[I];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},mt.prototype.addSymbols=function(t,a,s,p,m,g,w,C,I,L,D,N){for(var V=t.indexArray,q=t.layoutVertexArray,xe=t.segments.prepareSegment(4*a.length,q,V,this.canOverlap?g.sortKey:void 0),Ce=this.glyphOffsetArray.length,ze=xe.vertexLength,Le=this.allowVerticalPlacement&&w===pn.vertical?Math.PI/2:0,$e=g.text&&g.text.sections,ot=0;ot<a.length;ot++){var St=a[ot],Pt=St.tl,zt=St.tr,Kt=St.bl,Sr=St.br,tr=St.tex,zr=St.pixelOffsetTL,nn=St.pixelOffsetBR,Br=St.minFontScaleX,Kn=St.minFontScaleY,En=St.glyphOffset,en=St.isSDF,oi=St.sectionIndex,Gn=xe.vertexLength,si=En[1];Re(q,C.x,C.y,Pt.x,si+Pt.y,tr.x,tr.y,s,en,zr.x,zr.y,Br,Kn),Re(q,C.x,C.y,zt.x,si+zt.y,tr.x+tr.w,tr.y,s,en,nn.x,zr.y,Br,Kn),Re(q,C.x,C.y,Kt.x,si+Kt.y,tr.x,tr.y+tr.h,s,en,zr.x,nn.y,Br,Kn),Re(q,C.x,C.y,Sr.x,si+Sr.y,tr.x+tr.w,tr.y+tr.h,s,en,nn.x,nn.y,Br,Kn),ce(t.dynamicLayoutVertexArray,C,Le),V.emplaceBack(Gn,Gn+1,Gn+2),V.emplaceBack(Gn+1,Gn+2,Gn+3),xe.vertexLength+=4,xe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(En[0]),ot!==a.length-1&&oi===a[ot+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},N,$e&&$e[oi])}t.placedSymbolArray.emplaceBack(C.x,C.y,Ce,this.glyphOffsetArray.length-Ce,ze,I,L,C.segment,s?s[0]:0,s?s[1]:0,p[0],p[1],w,0,!1,0,D)},mt.prototype._addCollisionDebugVertex=function(t,a,s,p,m,g){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,p,m,Math.round(g.x),Math.round(g.y))},mt.prototype.addCollisionDebugVertices=function(t,a,s,p,m,g,w){var C=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),I=C.vertexLength,L=m.layoutVertexArray,D=m.collisionVertexArray,N=w.anchorX,V=w.anchorY;this._addCollisionDebugVertex(L,D,g,N,V,new me(t,a)),this._addCollisionDebugVertex(L,D,g,N,V,new me(s,a)),this._addCollisionDebugVertex(L,D,g,N,V,new me(s,p)),this._addCollisionDebugVertex(L,D,g,N,V,new me(t,p)),C.vertexLength+=4;var q=m.indexArray;q.emplaceBack(I,I+1),q.emplaceBack(I+1,I+2),q.emplaceBack(I+2,I+3),q.emplaceBack(I+3,I),C.primitiveLength+=4},mt.prototype.addDebugCollisionBoxes=function(t,a,s,p){for(var m=t;m<a;m++){var g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,p?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,s)}},mt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nt(gl,lp.members,Gl),this.iconCollisionBox=new Nt(gl,lp.members,Gl);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},mt.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,p,m,g,w,C,I){for(var L={},D=a;D<s;D++){var N=t.get(D);L.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},L.textFeatureIndex=N.featureIndex;break}for(var V=p;V<m;V++){var q=t.get(V);L.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},L.verticalTextFeatureIndex=q.featureIndex;break}for(var xe=g;xe<w;xe++){var Ce=t.get(xe);L.iconBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},L.iconFeatureIndex=Ce.featureIndex;break}for(var ze=C;ze<I;ze++){var Le=t.get(ze);L.verticalIconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},L.verticalIconFeatureIndex=Le.featureIndex;break}return L},mt.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},mt.prototype.hasTextData=function(){return this.text.segments.get().length>0},mt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},mt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},mt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},mt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},mt.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),p=s.vertexStartIndex+4*s.numGlyphs,m=s.vertexStartIndex;m<p;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)},mt.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),p=[],m=[],g=[],w=0;w<this.symbolInstances.length;++w){g.push(w);var C=this.symbolInstances.get(w);p.push(0|Math.round(a*C.anchorX+s*C.anchorY)),m.push(C.featureIndex)}return g.sort(function(I,L){return p[I]-p[L]||m[L]-m[I]}),g},mt.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},mt.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,p=this.symbolInstanceIndexes;s<p.length;s+=1){var m=this.symbolInstances.get(p[s]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(g,w,C){g>=0&&C.indexOf(g)===w&&a.addIndicesForPlacedSymbol(a.text,g)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Hr("SymbolBucket",mt,{omit:["layers","collisionBoxArray","features","compareText"]}),mt.MAX_GLYPHS=65535,mt.addDynamicAttributes=ce;var Lt=new ya({"symbol-placement":new on(te.layout_symbol["symbol-placement"]),"symbol-spacing":new on(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new on(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xr(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new on(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new on(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new on(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new on(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new on(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xr(te.layout_symbol["icon-size"]),"icon-text-fit":new on(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new on(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xr(te.layout_symbol["icon-image"]),"icon-rotate":new Xr(te.layout_symbol["icon-rotate"]),"icon-padding":new on(te.layout_symbol["icon-padding"]),"icon-keep-upright":new on(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Xr(te.layout_symbol["icon-offset"]),"icon-anchor":new Xr(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new on(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new on(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new on(te.layout_symbol["text-rotation-alignment"]),"text-field":new Xr(te.layout_symbol["text-field"]),"text-font":new Xr(te.layout_symbol["text-font"]),"text-size":new Xr(te.layout_symbol["text-size"]),"text-max-width":new Xr(te.layout_symbol["text-max-width"]),"text-line-height":new on(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Xr(te.layout_symbol["text-letter-spacing"]),"text-justify":new Xr(te.layout_symbol["text-justify"]),"text-radial-offset":new Xr(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new on(te.layout_symbol["text-variable-anchor"]),"text-anchor":new Xr(te.layout_symbol["text-anchor"]),"text-max-angle":new on(te.layout_symbol["text-max-angle"]),"text-writing-mode":new on(te.layout_symbol["text-writing-mode"]),"text-rotate":new Xr(te.layout_symbol["text-rotate"]),"text-padding":new on(te.layout_symbol["text-padding"]),"text-keep-upright":new on(te.layout_symbol["text-keep-upright"]),"text-transform":new Xr(te.layout_symbol["text-transform"]),"text-offset":new Xr(te.layout_symbol["text-offset"]),"text-allow-overlap":new on(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new on(te.layout_symbol["text-ignore-placement"]),"text-optional":new on(te.layout_symbol["text-optional"])}),sr={paint:new ya({"icon-opacity":new Xr(te.paint_symbol["icon-opacity"]),"icon-color":new Xr(te.paint_symbol["icon-color"]),"icon-halo-color":new Xr(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xr(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xr(te.paint_symbol["icon-halo-blur"]),"icon-translate":new on(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new on(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Xr(te.paint_symbol["text-opacity"]),"text-color":new Xr(te.paint_symbol["text-color"],{runtimeType:Pr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Xr(te.paint_symbol["text-halo-color"]),"text-halo-width":new Xr(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Xr(te.paint_symbol["text-halo-blur"]),"text-translate":new on(te.paint_symbol["text-translate"]),"text-translate-anchor":new on(te.paint_symbol["text-translate-anchor"])}),layout:Lt},tn=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Rr,this.defaultValue=t};tn.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},tn.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},tn.prototype.outputDefined=function(){return!1},tn.prototype.serialize=function(){return null},Hr("FormatSectionOverride",tn,{omit:["defaultValue"]});var qn=function(t){function a(s){t.call(this,s,sr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,p){if(t.prototype.recalculate.call(this,s,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var g=[],w=0,C=m;w<C.length;w+=1){var I=C[w];g.indexOf(I)<0&&g.push(I)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,p,m,g){var w=this.layout.get(s).evaluate(p,{},m,g),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||Bs(C.value)||!w?w:function(I,L){return L.replace(/{([^{}]+)}/g,function(D,N){return N in I?String(I[N]):""})}(p.properties,w)},a.prototype.createBucket=function(s){return new mt(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,p=sr.paint.overridableProperties;s<p.length;s+=1){var m=p[s];if(a.hasPaintOverride(this.layout,m)){var g,w=this.paint.get(m),C=new tn(w),I=new Fu(C,w.property.specification);g=w.value.kind==="constant"||w.value.kind==="source"?new cl("source",I):new xu("composite",I,w.value.zoomStops,w.value._interpolationType),this.paint._values[m]=new co(w.property,g,w.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,p,m){return!(!this.layout||p.isDataDriven()||m.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,p){var m=s.get("text-field"),g=sr.paint.properties[p],w=!1,C=function(D){for(var N=0,V=D;N<V.length;N+=1)if(g.overrides&&g.overrides.hasOverride(V[N]))return void(w=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Bi)C(m.value.value.sections);else if(m.value.kind==="source"){var I=function(D){w||(D instanceof Ca&&ji(D.value)===li?C(D.value.sections):D instanceof mo?C(D.sections):D.eachChild(I))},L=m.value;L._styleExpression&&I(L._styleExpression.expression)}return w},a}(ta),Qr={paint:new ya({"background-color":new on(te.paint_background["background-color"]),"background-pattern":new yo(te.paint_background["background-pattern"]),"background-opacity":new on(te.paint_background["background-opacity"])})},bn=function(t){function a(s){t.call(this,s,Qr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(ta),Fn={paint:new ya({"raster-opacity":new on(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new on(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new on(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new on(te.paint_raster["raster-brightness-max"]),"raster-saturation":new on(te.paint_raster["raster-saturation"]),"raster-contrast":new on(te.paint_raster["raster-contrast"]),"raster-resampling":new on(te.paint_raster["raster-resampling"]),"raster-fade-duration":new on(te.paint_raster["raster-fade-duration"])})},xi=function(t){function a(s){t.call(this,s,Fn)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(ta),Sa=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(ta),es={circle:Hl,heatmap:Cp,hillshade:Ap,fill:Jh,"fill-extrusion":Qo,line:Ch,symbol:qn,background:bn,raster:xi},Cl=fe.HTMLImageElement,Ts=fe.HTMLCanvasElement,Fp=fe.HTMLVideoElement,Hs=fe.ImageData,rf=fe.ImageBitmap,Nf=function(t,a,s,p){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,p)};Nf.prototype.update=function(t,a,s){var p=t.width,m=t.height,g=!(this.size&&this.size[0]===p&&this.size[1]===m||s),w=this.context,C=w.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!a||a.premultiply!==!1)),g)this.size=[p,m],t instanceof Cl||t instanceof Ts||t instanceof Fp||t instanceof Hs||rf&&t instanceof rf?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,p,m,0,this.format,C.UNSIGNED_BYTE,t.data);else{var I=s||{x:0,y:0},L=I.x,D=I.y;t instanceof Cl||t instanceof Ts||t instanceof Fp||t instanceof Hs||rf&&t instanceof rf?C.texSubImage2D(C.TEXTURE_2D,0,L,D,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,L,D,p,m,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)},Nf.prototype.bind=function(t,a,s){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),s!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrap=a)},Nf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Nf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var rd=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};rd.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},rd.prototype.remove=function(){delete this._channel,this._callback=function(){}};var cp=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Mr(["receive","process"],this),this.invoker=new rd(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Or()?t:fe};function nd(t,a,s){var p=2*Math.PI*6378137/256/Math.pow(2,s);return[t*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}cp.prototype.send=function(t,a,s,p,m){var g=this;m===void 0&&(m=!1);var w=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[w]=s);var C=Ve(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:t,hasCallback:!!s,targetMapId:p,mustQueue:m,sourceMapId:this.mapId,data:Ns(a,C)},C),{cancel:function(){s&&delete g.callbacks[w],g.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:g.mapId})}}},cp.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var p=this.cancelCallbacks[s];delete this.cancelCallbacks[s],p&&p()}else Or()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},cp.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},cp.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(a.error?p(ls(a.error)):p(null,ls(a.data)))}else{var m=!1,g=Ve(this.globalScope)?void 0:[],w=a.hasCallback?function(D,N){m=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:D?Ns(D):null,data:Ns(N,g)},g)}:function(D){m=!0},C=null,I=ls(a.data);if(this.parent[a.type])C=this.parent[a.type](a.sourceMapId,I,w);else if(this.parent.getWorkerSource){var L=a.type.split(".");C=this.parent.getWorkerSource(a.sourceMapId,L[0],I.source)[L[1]](I,w)}else w(new Error("Could not find function "+a.type));!m&&C&&C.cancel&&(this.cancelCallbacks[t]=C.cancel)}},cp.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ja=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ja.prototype.setNorthEast=function(t){return this._ne=t instanceof qi?new qi(t.lng,t.lat):qi.convert(t),this},Ja.prototype.setSouthWest=function(t){return this._sw=t instanceof qi?new qi(t.lng,t.lat):qi.convert(t),this},Ja.prototype.extend=function(t){var a,s,p=this._sw,m=this._ne;if(t instanceof qi)a=t,s=t;else{if(!(t instanceof Ja))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ja.convert(t)):this.extend(qi.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return p||m?(p.lng=Math.min(a.lng,p.lng),p.lat=Math.min(a.lat,p.lat),m.lng=Math.max(s.lng,m.lng),m.lat=Math.max(s.lat,m.lat)):(this._sw=new qi(a.lng,a.lat),this._ne=new qi(s.lng,s.lat)),this},Ja.prototype.getCenter=function(){return new qi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ja.prototype.getSouthWest=function(){return this._sw},Ja.prototype.getNorthEast=function(){return this._ne},Ja.prototype.getNorthWest=function(){return new qi(this.getWest(),this.getNorth())},Ja.prototype.getSouthEast=function(){return new qi(this.getEast(),this.getSouth())},Ja.prototype.getWest=function(){return this._sw.lng},Ja.prototype.getSouth=function(){return this._sw.lat},Ja.prototype.getEast=function(){return this._ne.lng},Ja.prototype.getNorth=function(){return this._ne.lat},Ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ja.prototype.contains=function(t){var a=qi.convert(t),s=a.lng,p=a.lat,m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m},Ja.convert=function(t){return!t||t instanceof Ja?t:new Ja(t)};var qi=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qi.prototype.wrap=function(){return new qi(Jt(this.lng,-180,180),this.lat)},qi.prototype.toArray=function(){return[this.lng,this.lat]},qi.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qi.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,p=t.lat*a,m=Math.sin(s)*Math.sin(p)+Math.cos(s)*Math.cos(p)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(m,1))},qi.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Ja(new qi(this.lng-s,this.lat-a),new qi(this.lng+s,this.lat+a))},qi.convert=function(t){if(t instanceof qi)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new qi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new qi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ih=2*Math.PI*63710088e-1;function id(t){return Ih*Math.cos(t*Math.PI/180)}function ad(t){return(180+t)/360}function od(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Bd(t,a){return t/id(a)}function sd(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var zf=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};zf.fromLngLat=function(t,a){a===void 0&&(a=0);var s=qi.convert(t);return new zf(ad(s.lng),od(s.lat),Bd(a,s.lat))},zf.prototype.toLngLat=function(){return new qi(360*this.x-180,sd(this.y))},zf.prototype.toAltitude=function(){return this.z*id(sd(this.y))},zf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ih*(t=sd(this.y),1/Math.cos(t*Math.PI/180));var t};var nf=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=Bp(0,t,t,a,s)};nf.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},nf.prototype.url=function(t,a){var s,p,m,g,w,C=(p=this.y,m=this.z,g=nd(256*(s=this.x),256*(p=Math.pow(2,m)-p-1),m),w=nd(256*(s+1),256*(p+1),m),g[0]+","+g[1]+","+w[0]+","+w[1]),I=function(L,D,N){for(var V,q="",xe=L;xe>0;xe--)q+=(D&(V=1<<xe-1)?1:0)+(N&V?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",C)},nf.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new me(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},nf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Nd=function(t,a){this.wrap=t,this.canonical=a,this.key=Bp(t,a.z,a.z,a.x,a.y)},Qa=function(t,a,s,p,m){this.overscaledZ=t,this.wrap=a,this.canonical=new nf(s,+p,+m),this.key=Bp(a,t,s,p,m)};function Bp(t,a,s,p,m){(t*=2)<0&&(t=-1*t-1);var g=1<<s;return(g*g*t+g*m+p).toString(36)+s.toString(36)+a.toString(36)}Qa.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Qa.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Qa(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qa(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Qa.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?Bp(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Bp(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Qa.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Qa.prototype.children=function(t){if(this.overscaledZ>=t)return[new Qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,p=2*this.canonical.y;return[new Qa(a,this.wrap,a,s,p),new Qa(a,this.wrap,a,s+1,p),new Qa(a,this.wrap,a,s,p+1),new Qa(a,this.wrap,a,s+1,p+1)]},Qa.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Qa.prototype.wrapped=function(){return new Qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Qa.prototype.unwrapTo=function(t){return new Qa(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Qa.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Qa.prototype.toUnwrapped=function(){return new Nd(this.wrap,this.canonical)},Qa.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Qa.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new zf(t.x-this.wrap,t.y))},Hr("CanonicalTileID",nf),Hr("OverscaledTileID",Qa,{omit:["posMatrix"]});var Ec=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ye('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var p=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var m=0;m<p;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(p,m)]=this.data[this._idx(p-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,p)]=this.data[this._idx(m,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Ec.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),p=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[p],s[p+1],s[p+2])},Ec.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ec.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},Ec.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},Ec.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},Ec.prototype.getPixels=function(){return new qa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ec.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=a*this.dim,m=a*this.dim+this.dim,g=s*this.dim,w=s*this.dim+this.dim;switch(a){case-1:p=m-1;break;case 1:m=p+1}switch(s){case-1:g=w-1;break;case 1:w=g+1}for(var C=-a*this.dim,I=-s*this.dim,L=g;L<w;L++)for(var D=p;D<m;D++)this.data[this._idx(D,L)]=t.data[this._idx(D+C,L+I)]},Hr("DEMData",Ec);var Cc=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Cc.prototype.encode=function(t){return this._stringToNumber[t]},Cc.prototype.decode=function(t){return this._numberToString[t]};var Np=function(t,a,s,p,m){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=p,this.properties=t.properties,this.id=m},Zf={geometry:{configurable:!0}};Zf.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Zf.geometry.set=function(t){this._geometry=t},Np.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(Np.prototype,Zf);var zp=function(){this.state={},this.stateChanges={},this.deletedStates={}};zp.prototype.updateState=function(t,a,s){var p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Gt(this.stateChanges[t][p],s),this.deletedStates[t]===null)for(var m in this.deletedStates[t]={},this.state[t])m!==p&&(this.deletedStates[t][m]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var g in this.deletedStates[t][p]={},this.state[t][p])s[g]||(this.deletedStates[t][p][g]=null);else for(var w in s)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][w]===null&&delete this.deletedStates[t][p][w]},zp.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(s in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][s]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},zp.prototype.getState=function(t,a){var s=String(a),p=Gt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var m=this.deletedStates[t][a];if(m===null)return{};for(var g in m)delete p[g]}return p},zp.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},zp.prototype.coalesceChanges=function(t,a){var s={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var m={};for(var g in this.stateChanges[p])this.state[p][g]||(this.state[p][g]={}),Gt(this.state[p][g],this.stateChanges[p][g]),m[g]=this.state[p][g];s[p]=m}for(var w in this.deletedStates){this.state[w]=this.state[w]||{};var C={};if(this.deletedStates[w]===null)for(var I in this.state[w])C[I]={},this.state[w][I]={};else for(var L in this.deletedStates[w]){if(this.deletedStates[w][L]===null)this.state[w][L]={};else for(var D=0,N=Object.keys(this.deletedStates[w][L]);D<N.length;D+=1)delete this.state[w][L][N[D]];C[L]=this.state[w][L]}s[w]=s[w]||{},Gt(s[w],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var V in t)t[V].setFeatureState(s,a)};var xo=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Zu(8192,16,0),this.grid3D=new Zu(8192,16,0),this.featureIndexArray=new z,this.promoteId=a};function zd(t,a,s,p,m){return Ft(t,function(g,w){var C=a instanceof ml?a.get(w):null;return C&&C.evaluate?C.evaluate(s,p,m):C})}function Zd(t){for(var a=1/0,s=1/0,p=-1/0,m=-1/0,g=0,w=t;g<w.length;g+=1){var C=w[g];a=Math.min(a,C.x),s=Math.min(s,C.y),p=Math.max(p,C.x),m=Math.max(m,C.y)}return{minX:a,minY:s,maxX:p,maxY:m}}function Fv(t,a){return a-t}xo.prototype.insert=function(t,a,s,p,m,g){var w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,p,m);for(var C=g?this.grid3D:this.grid,I=0;I<a.length;I++){for(var L=a[I],D=[1/0,1/0,-1/0,-1/0],N=0;N<L.length;N++){var V=L[N];D[0]=Math.min(D[0],V.x),D[1]=Math.min(D[1],V.y),D[2]=Math.max(D[2],V.x),D[3]=Math.max(D[3],V.y)}D[0]<8192&&D[1]<8192&&D[2]>=0&&D[3]>=0&&C.insert(w,D[0],D[1],D[2],D[3])}},xo.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new wc.VectorTile(new ie(this.rawTileData)).layers,this.sourceLayerCoder=new Cc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},xo.prototype.query=function(t,a,s,p){var m=this;this.loadVTLayers();for(var g=t.params||{},w=8192/t.tileSize/t.scale,C=zl(g.filter),I=t.queryGeometry,L=t.queryPadding*w,D=Zd(I),N=this.grid.query(D.minX-L,D.minY-L,D.maxX+L,D.maxY+L),V=Zd(t.cameraQueryGeometry),q=this.grid3D.query(V.minX-L,V.minY-L,V.maxX+L,V.maxY+L,function(St,Pt,zt,Kt){return function(Sr,tr,zr,nn,Br){for(var Kn=0,En=Sr;Kn<En.length;Kn+=1){var en=En[Kn];if(tr<=en.x&&zr<=en.y&&nn>=en.x&&Br>=en.y)return!0}var oi=[new me(tr,zr),new me(tr,Br),new me(nn,Br),new me(nn,zr)];if(Sr.length>2){for(var Gn=0,si=oi;Gn<si.length;Gn+=1)if(zs(Sr,si[Gn]))return!0}for(var hn=0;hn<Sr.length-1;hn++)if(Hu(Sr[hn],Sr[hn+1],oi))return!0;return!1}(t.cameraQueryGeometry,St-L,Pt-L,zt+L,Kt+L)}),xe=0,Ce=q;xe<Ce.length;xe+=1)N.push(Ce[xe]);N.sort(Fv);for(var ze,Le={},$e=function(St){var Pt=N[St];if(Pt!==ze){ze=Pt;var zt=m.featureIndexArray.get(Pt),Kt=null;m.loadMatchingFeature(Le,zt.bucketIndex,zt.sourceLayerIndex,zt.featureIndex,C,g.layers,g.availableImages,a,s,p,function(Sr,tr,zr){return Kt||(Kt=ra(Sr)),tr.queryIntersectsFeature(I,Sr,zr,Kt,m.z,t.transform,w,t.pixelPosMatrix)})}},ot=0;ot<N.length;ot++)$e(ot);return Le},xo.prototype.loadMatchingFeature=function(t,a,s,p,m,g,w,C,I,L,D){var N=this.bucketLayerIDs[a];if(!g||function(Sr,tr){for(var zr=0;zr<Sr.length;zr++)if(tr.indexOf(Sr[zr])>=0)return!0;return!1}(g,N)){var V=this.sourceLayerCoder.decode(s),q=this.vtLayers[V].feature(p);if(m.needGeometry){var xe=_a(q,!0);if(!m.filter(new Xn(this.tileID.overscaledZ),xe,this.tileID.canonical))return}else if(!m.filter(new Xn(this.tileID.overscaledZ),q))return;for(var Ce=this.getId(q,V),ze=0;ze<N.length;ze++){var Le=N[ze];if(!(g&&g.indexOf(Le)<0)){var $e=C[Le];if($e){var ot={};Ce!==void 0&&L&&(ot=L.getState($e.sourceLayer||"_geojsonTileLayer",Ce));var St=Gt({},I[Le]);St.paint=zd(St.paint,$e.paint,q,ot,w),St.layout=zd(St.layout,$e.layout,q,ot,w);var Pt=!D||D(q,$e,ot);if(Pt){var zt=new Np(q,this.z,this.x,this.y,Ce);zt.layer=St;var Kt=t[Le];Kt===void 0&&(Kt=t[Le]=[]),Kt.push({featureIndex:p,feature:zt,intersectionZ:Pt})}}}}}},xo.prototype.lookupSymbolFeatures=function(t,a,s,p,m,g,w,C){var I={};this.loadVTLayers();for(var L=zl(m),D=0,N=t;D<N.length;D+=1)this.loadMatchingFeature(I,s,p,N[D],L,g,w,C,a);return I},xo.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var p=0,m=s[a];p<m.length;p+=1)if(t===m[p])return!0;return!1},xo.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},Hr("FeatureIndex",xo,{omit:["rawTileData","sourceLayerCoder"]});var Io=function(t,a){this.tileID=t,this.uid=Ut(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Io.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<Si.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},Io.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Io.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(L,D){var N={};if(!D)return N;for(var V=function(){var Ce=xe[q],ze=Ce.layerIds.map(function(ot){return D.getLayer(ot)}).filter(Boolean);if(ze.length!==0){Ce.layers=ze,Ce.stateDependentLayerIds&&(Ce.stateDependentLayers=Ce.stateDependentLayerIds.map(function(ot){return ze.filter(function(St){return St.id===ot})[0]}));for(var Le=0,$e=ze;Le<$e.length;Le+=1)N[$e[Le].id]=Ce}},q=0,xe=L;q<xe.length;q+=1)V();return N}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[p];if(m instanceof mt){if(this.hasSymbolBuckets=!0,!s)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var w=this.buckets[g];if(w instanceof mt&&w.hasRTLText){this.hasRTLText=!0,ws.isLoading()||ws.isLoaded()||Of()!=="deferred"||Js();break}}for(var C in this.queryPadding=0,this.buckets){var I=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(C).queryRadius(I))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Io.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Io.prototype.getBucket=function(t){return this.buckets[t.id]},Io.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nf(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nf(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Io.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Io.prototype.queryRenderedFeatures=function(t,a,s,p,m,g,w,C,I,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:m,scale:g,tileSize:this.tileSize,pixelPosMatrix:L,transform:C,params:w,queryPadding:this.queryPadding*I},t,a,s):{}},Io.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var p=s.loadVTLayers(),m=a?a.sourceLayer:"",g=p._geojsonTileLayer||p[m];if(g)for(var w=zl(a&&a.filter),C=this.tileID.canonical,I=C.z,L=C.x,D=C.y,N={z:I,x:L,y:D},V=0;V<g.length;V++){var q=g.feature(V);if(w.needGeometry){var xe=_a(q,!0);if(!w.filter(new Xn(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!w.filter(new Xn(this.tileID.overscaledZ),q))continue;var Ce=s.getId(q,m),ze=new Np(q,I,L,D,Ce);ze.tile=N,t.push(ze)}}},Io.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Io.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Io.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=Gr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),m=!1;if(this.expirationTime>p)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{var g=this.expirationTime-a;g?this.expirationTime=p+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Io.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Io.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(a.style.hasLayer(p)){var m=this.buckets[p],g=m.layers[0].sourceLayer||"_geojsonTileLayer",w=s[g],C=t[g];if(w&&C&&Object.keys(C).length!==0){m.update(C,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});var I=a&&a.style&&a.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}}},Io.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Io.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Si.now()},Io.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Io.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Si.now()+t},Io.prototype.setDependencies=function(t,a){for(var s={},p=0,m=a;p<m.length;p+=1)s[m[p]]=!0;this.dependencies[t]=s},Io.prototype.hasDependency=function(t,a){for(var s=0,p=t;s<p.length;s+=1){var m=this.dependencies[p[s]];if(m){for(var g=0,w=a;g<w.length;g+=1)if(m[w[g]])return!0}}return!1};var af=fe.performance,Bv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},af.mark(this._marks.start)};Bv.prototype.finish=function(){af.mark(this._marks.end);var t=af.getEntriesByName(this._marks.measure);return t.length===0&&(af.measure(this._marks.measure,this._marks.start,this._marks.end),t=af.getEntriesByName(this._marks.measure),af.clearMarks(this._marks.start),af.clearMarks(this._marks.end),af.clearMeasures(this._marks.measure)),t},v.Actor=cp,v.AlphaImage=js,v.CanonicalTileID=nf,v.CollisionBoxArray=f,v.Color=Jn,v.DEMData=Ec,v.DataConstantProperty=on,v.DictionaryCoder=Cc,v.EXTENT=8192,v.ErrorEvent=Ze,v.EvaluationParameters=Xn,v.Event=Te,v.Evented=We,v.FeatureIndex=xo,v.FillBucket=su,v.FillExtrusionBucket=go,v.ImageAtlas=ln,v.ImagePosition=Wt,v.LineBucket=Vo,v.LngLat=qi,v.LngLatBounds=Ja,v.MercatorCoordinate=zf,v.ONE_EM=24,v.OverscaledTileID=Qa,v.Point=me,v.Point$1=me,v.Properties=ya,v.Protobuf=ie,v.RGBAImage=qa,v.RequestManager=Ei,v.RequestPerformance=Bv,v.ResourceType=Mn,v.SegmentVector=ee,v.SourceFeatureState=zp,v.StructArrayLayout1ui2=qc,v.StructArrayLayout2f1f2i16=Eu,v.StructArrayLayout2i4=Vu,v.StructArrayLayout3ui6=Cu,v.StructArrayLayout4i8=Wc,v.SymbolBucket=mt,v.Texture=Nf,v.Tile=Io,v.Transitionable=Pa,v.Uniform1f=br,v.Uniform1i=Yt,v.Uniform2f=pr,v.Uniform3f=Fr,v.Uniform4f=rn,v.UniformColor=fn,v.UniformMatrix4f=hi,v.UnwrappedTileID=Nd,v.ValidationError=Pe,v.WritingMode=pn,v.ZoomHistory=dl,v.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},v.addDynamicAttributes=ce,v.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var p=t.length,m=new Array(t.length),g=null;t.forEach(function(w,C){a(w,function(I,L){I&&(g=I),m[C]=L,--p==0&&s(g,m)})})},v.bezier=we,v.bindAll=Mr,v.browser=Si,v.cacheEntryPossiblyAdded=function(t){++Rn>Tr&&(t.getActor().send("enforceCacheSizeLimit",Xt),Rn=0)},v.clamp=M,v.clearTileCache=function(t){var a=fe.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=mn,v.clone=function(t){var a=new vi(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=He,v.clone$2=function(t){var a=new vi(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=td,v.config=On,v.create=function(){var t=new vi(16);return vi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new vi(9);return vi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new vi(4);return vi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=be,v.createExpression=ll,v.createLayout=pa,v.createStyleLayer=function(t){return t.type==="custom"?new Sa(t):new es[t.type](t)},v.cross=function(t,a,s){var p=a[0],m=a[1],g=a[2],w=s[0],C=s[1],I=s[2];return t[0]=m*I-g*C,t[1]=g*w-p*I,t[2]=p*C-m*w,t},v.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var p=0;p<a.length;p++)if(!t(a[p],s[p]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var m in a)if(!t(a[m],s[m]))return!1;return!0}return a===s},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=Oe,v.emitValidationErrors=zu,v.endsWith=cr,v.enforceCacheSizeLimit=function(t){Ur(),Ha&&Ha.then(function(a){a.keys().then(function(s){for(var p=0;p<s.length-t;p++)a.delete(s[p])})})},v.evaluateSizeForFeature=Za,v.evaluateSizeForZoom=Ka,v.evaluateVariableOffset=Be,v.evented=ap,v.extend=Gt,v.featureFilter=zl,v.filterObject=st,v.fromRotation=function(t,a){var s=Math.sin(a),p=Math.cos(a);return t[0]=p,t[1]=s,t[2]=0,t[3]=-s,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=ba,v.getAnchorJustification=Qe,v.getArrayBuffer=Rs,v.getImage=U,v.getJSON=function(t,a){return fu(Gt(t,{type:"json"}),a)},v.getRTLTextPluginStatus=Of,v.getReferrer=ni,v.getVideo=function(t,a){var s,p,m=fe.document.createElement("video");m.muted=!0,m.onloadstart=function(){a(null,m)};for(var g=0;g<t.length;g++){var w=fe.document.createElement("source");s=t[g],p=void 0,(p=fe.document.createElement("a")).href=s,(p.protocol!==fe.document.location.protocol||p.host!==fe.document.location.host)&&(m.crossOrigin="Anonymous"),w.src=t[g],m.appendChild(w)}return{cancel:function(){}}},v.identity=ao,v.invert=function(t,a){var s=a[0],p=a[1],m=a[2],g=a[3],w=a[4],C=a[5],I=a[6],L=a[7],D=a[8],N=a[9],V=a[10],q=a[11],xe=a[12],Ce=a[13],ze=a[14],Le=a[15],$e=s*C-p*w,ot=s*I-m*w,St=s*L-g*w,Pt=p*I-m*C,zt=p*L-g*C,Kt=m*L-g*I,Sr=D*Ce-N*xe,tr=D*ze-V*xe,zr=D*Le-q*xe,nn=N*ze-V*Ce,Br=N*Le-q*Ce,Kn=V*Le-q*ze,En=$e*Kn-ot*Br+St*nn+Pt*zr-zt*tr+Kt*Sr;return En?(t[0]=(C*Kn-I*Br+L*nn)*(En=1/En),t[1]=(m*Br-p*Kn-g*nn)*En,t[2]=(Ce*Kt-ze*zt+Le*Pt)*En,t[3]=(V*zt-N*Kt-q*Pt)*En,t[4]=(I*zr-w*Kn-L*tr)*En,t[5]=(s*Kn-m*zr+g*tr)*En,t[6]=(ze*St-xe*Kt-Le*ot)*En,t[7]=(D*Kt-V*St+q*ot)*En,t[8]=(w*Br-C*zr+L*Sr)*En,t[9]=(p*zr-s*Br-g*Sr)*En,t[10]=(xe*zt-Ce*St+Le*$e)*En,t[11]=(N*St-D*zt-q*$e)*En,t[12]=(C*tr-w*nn-I*Sr)*En,t[13]=(s*nn-p*tr+m*Sr)*En,t[14]=(Ce*ot-xe*Pt-ze*$e)*En,t[15]=(D*Pt-N*ot+V*$e)*En,t):null},v.isChar=hr,v.isMapboxURL=da,v.keysDifference=function(t,a){var s=[];for(var p in t)p in a||s.push(p);return s},v.makeRequest=fu,v.mapObject=Ft,v.mercatorXfromLng=ad,v.mercatorYfromLat=od,v.mercatorZfromAltitude=Bd,v.mul=Wu,v.multiply=oo,v.mvt=wc,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var s=a[0],p=a[1],m=a[2],g=s*s+p*p+m*m;return g>0&&(g=1/Math.sqrt(g)),t[0]=a[0]*g,t[1]=a[1]*g,t[2]=a[2]*g,t},v.number=la,v.offscreenCanvasSupported=$n,v.ortho=function(t,a,s,p,m,g,w){var C=1/(a-s),I=1/(p-m),L=1/(g-w);return t[0]=-2*C,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*L,t[11]=0,t[12]=(a+s)*C,t[13]=(m+p)*I,t[14]=(w+g)*L,t[15]=1,t},v.parseGlyphPBF=function(t){return new ie(t).readFields(Ht,[])},v.pbf=ie,v.performSymbolLayout=function(t,a,s,p,m,g,w){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var C=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){var D=t.textSizeData,N=D.maxZoom;L.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Xn(D.minZoom),w),I["text-size"].possiblyEvaluate(new Xn(N),w)]}if(t.iconSizeData.kind==="composite"){var V=t.iconSizeData,q=V.maxZoom;L.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Xn(V.minZoom),w),I["icon-size"].possiblyEvaluate(new Xn(q),w)]}L.layoutTextSize=I["text-size"].possiblyEvaluate(new Xn(t.zoom+1),w),L.layoutIconSize=I["icon-size"].possiblyEvaluate(new Xn(t.zoom+1),w),L.textMaxSize=I["text-size"].possiblyEvaluate(new Xn(18));for(var xe=24*C.get("text-line-height"),Ce=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",ze=C.get("text-keep-upright"),Le=C.get("text-size"),$e=function(){var Pt=St[ot],zt=C.get("text-font").evaluate(Pt,{},w).join(","),Kt=Le.evaluate(Pt,{},w),Sr=L.layoutTextSize.evaluate(Pt,{},w),tr=L.layoutIconSize.evaluate(Pt,{},w),zr={horizontal:{},vertical:void 0},nn=Pt.text,Br=[0,0];if(nn){var Kn=nn.toString(),En=24*C.get("text-letter-spacing").evaluate(Pt,{},w),en=function(fi){for(var zi=0,Fi=fi;zi<Fi.length;zi+=1)if(bi=Fi[zi].charCodeAt(0),hr.Arabic(bi)||hr["Arabic Supplement"](bi)||hr["Arabic Extended-A"](bi)||hr["Arabic Presentation Forms-A"](bi)||hr["Arabic Presentation Forms-B"](bi))return!1;var bi;return!0}(Kn)?En:0,oi=C.get("text-anchor").evaluate(Pt,{},w),Gn=C.get("text-variable-anchor");if(!Gn){var si=C.get("text-radial-offset").evaluate(Pt,{},w);Br=si?Be(oi,[24*si,$]):C.get("text-offset").evaluate(Pt,{},w).map(function(fi){return 24*fi})}var hn=Ce?"center":C.get("text-justify").evaluate(Pt,{},w),_i=C.get("symbol-placement"),aa=_i==="point"?24*C.get("text-max-width").evaluate(Pt,{},w):0,Oa=function(){t.allowVerticalPlacement&&Af(Kn)&&(zr.vertical=jt(nn,a,s,m,zt,aa,xe,oi,"left",en,Br,pn.vertical,!0,_i,Sr,Kt))};if(!Ce&&Gn){for(var ka=hn==="auto"?Gn.map(function(fi){return Qe(fi)}):[hn],oa=!1,La=0;La<ka.length;La++){var po=ka[La];if(!zr.horizontal[po])if(oa)zr.horizontal[po]=zr.horizontal[0];else{var ho=jt(nn,a,s,m,zt,aa,xe,"center",po,en,Br,pn.horizontal,!1,_i,Sr,Kt);ho&&(zr.horizontal[po]=ho,oa=ho.positionedLines.length===1)}}Oa()}else{hn==="auto"&&(hn=Qe(oi));var ts=jt(nn,a,s,m,zt,aa,xe,oi,hn,en,Br,pn.horizontal,!1,_i,Sr,Kt);ts&&(zr.horizontal[hn]=ts),Oa(),Af(Kn)&&Ce&&ze&&(zr.vertical=jt(nn,a,s,m,zt,aa,xe,oi,hn,en,Br,pn.vertical,!1,_i,Sr,Kt))}}var Oo=void 0,rs=!1;if(Pt.icon&&Pt.icon.name){var Ua=p[Pt.icon.name];Ua&&(Oo=function(fi,zi,Fi){var bi=ba(Fi),ns=zi[0]-fi.displaySize[0]*bi.horizontalAlign,Go=zi[1]-fi.displaySize[1]*bi.verticalAlign;return{image:fi,top:Go,bottom:Go+fi.displaySize[1],left:ns,right:ns+fi.displaySize[0]}}(m[Pt.icon.name],C.get("icon-offset").evaluate(Pt,{},w),C.get("icon-anchor").evaluate(Pt,{},w)),rs=Ua.sdf,t.sdfIcons===void 0?t.sdfIcons=Ua.sdf:t.sdfIcons!==Ua.sdf&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ua.pixelRatio!==t.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ko=Ue(zr.horizontal)||zr.vertical;t.iconsInText=!!ko&&ko.iconsInText,(ko||Oo)&&function(fi,zi,Fi,bi,ns,Go,Xi,ja,Lo,Ci,Jl){var Mu=Go.textMaxSize.evaluate(zi,{});Mu===void 0&&(Mu=Xi);var Tl,Ra=fi.layers[0].layout,Ql=Ra.get("icon-offset").evaluate(zi,{},Jl),el=Ue(Fi.horizontal),Uf=Xi/24,jf=fi.tilePixelRatio*Uf,fp=fi.tilePixelRatio*Mu/24,Tc=fi.tilePixelRatio*ja,pp=fi.tilePixelRatio*Ra.get("symbol-spacing"),tl=Ra.get("text-padding")*fi.tilePixelRatio,ec=Ra.get("icon-padding")*fi.tilePixelRatio,Pu=Ra.get("text-max-angle")/180*Math.PI,Ws=Ra.get("text-rotation-alignment")==="map"&&Ra.get("symbol-placement")!=="point",of=Ra.get("icon-rotation-alignment")==="map"&&Ra.get("symbol-placement")!=="point",As=Ra.get("symbol-placement"),Ac=pp/2,Mc=Ra.get("icon-text-fit");bi&&Mc!=="none"&&(fi.allowVerticalPlacement&&Fi.vertical&&(Tl=ai(bi,Fi.vertical,Mc,Ra.get("icon-text-fit-padding"),Ql,Uf)),el&&(bi=ai(bi,el,Mc,Ra.get("icon-text-fit-padding"),Ql,Uf)));var ms=function(Nv,Vp){Vp.x<0||Vp.x>=8192||Vp.y<0||Vp.y>=8192||function(Va,Al,zv,Pc,ff,Vd,Lh,Ml,Gp,Hp,Wp,Xp,cd,Gd,Ms,Hd,pf,fd,pd,hd,Ps,Yp,Wd,tc,hf){var dd,Hf,Is,mp,Ui,yp=Va.addToLineVertexArray(Al,zv),df=0,Zv=0,Os=0,Xd=0,qp=-1,Rh=-1,Ic={},Yd=ge(""),vd=0,Dh=0;if(Ml._unevaluatedLayout.getValue("text-radial-offset")===void 0?(vd=(dd=Ml.layout.get("text-offset").evaluate(Ps,{},tc).map(function(xp){return 24*xp}))[0],Dh=dd[1]):(vd=24*Ml.layout.get("text-radial-offset").evaluate(Ps,{},tc),Dh=$),Va.allowVerticalPlacement&&Pc.vertical){var md=Ml.layout.get("text-rotate").evaluate(Ps,{},tc)+90;mp=new _e(Gp,Al,Hp,Wp,Xp,Pc.vertical,cd,Gd,Ms,md),Lh&&(Ui=new _e(Gp,Al,Hp,Wp,Xp,Lh,pf,fd,Ms,md))}if(ff){var gp=Ml.layout.get("icon-rotate").evaluate(Ps,{}),yd=Ml.layout.get("icon-text-fit")!=="none",gd=ei(ff,gp,Wd,yd),_d=Lh?ei(Lh,gp,Wd,yd):void 0;Is=new _e(Gp,Al,Hp,Wp,Xp,ff,pf,fd,!1,gp),df=4*gd.length;var qd=Va.iconSizeData,_p=null;qd.kind==="source"?(_p=[128*Ml.layout.get("icon-size").evaluate(Ps,{})])[0]>32640&&Ye(Va.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):qd.kind==="composite"&&((_p=[128*Yp.compositeIconSizes[0].evaluate(Ps,{},tc),128*Yp.compositeIconSizes[1].evaluate(Ps,{},tc)])[0]>32640||_p[1]>32640)&&Ye(Va.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Va.addSymbols(Va.icon,gd,_p,hd,pd,Ps,!1,Al,yp.lineStartIndex,yp.lineLength,-1,tc),qp=Va.icon.placedSymbolArray.length-1,_d&&(Zv=4*_d.length,Va.addSymbols(Va.icon,_d,_p,hd,pd,Ps,pn.vertical,Al,yp.lineStartIndex,yp.lineLength,-1,tc),Rh=Va.icon.placedSymbolArray.length-1)}for(var xd in Pc.horizontal){var Ho=Pc.horizontal[xd];if(!Hf){Yd=ge(Ho.text);var Uv=Ml.layout.get("text-rotate").evaluate(Ps,{},tc);Hf=new _e(Gp,Al,Hp,Wp,Xp,Ho,cd,Gd,Ms,Uv)}var Kd=Ho.positionedLines.length===1;if(Os+=et(Va,Al,Ho,Vd,Ml,Ms,Ps,Hd,yp,Pc.vertical?pn.horizontal:pn.horizontalOnly,Kd?Object.keys(Pc.horizontal):[xd],Ic,qp,Yp,tc),Kd)break}Pc.vertical&&(Xd+=et(Va,Al,Pc.vertical,Vd,Ml,Ms,Ps,Hd,yp,pn.vertical,["vertical"],Ic,Rh,Yp,tc));var $d=Hf?Hf.boxStartIndex:Va.collisionBoxArray.length,Wf=Hf?Hf.boxEndIndex:Va.collisionBoxArray.length,jv=mp?mp.boxStartIndex:Va.collisionBoxArray.length,Kp=mp?mp.boxEndIndex:Va.collisionBoxArray.length,Jd=Is?Is.boxStartIndex:Va.collisionBoxArray.length,Qd=Is?Is.boxEndIndex:Va.collisionBoxArray.length,Fh=Ui?Ui.boxStartIndex:Va.collisionBoxArray.length,ev=Ui?Ui.boxEndIndex:Va.collisionBoxArray.length,Pl=-1,Bh=function(xp,Do){return xp&&xp.circleDiameter?Math.max(xp.circleDiameter,Do):Do};Pl=Bh(Hf,Pl),Pl=Bh(mp,Pl),Pl=Bh(Is,Pl);var tv=(Pl=Bh(Ui,Pl))>-1?1:0;tv&&(Pl*=hf/24),Va.glyphOffsetArray.length>=mt.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ps.sortKey!==void 0&&Va.addToSortKeyRanges(Va.symbolInstances.length,Ps.sortKey),Va.symbolInstances.emplaceBack(Al.x,Al.y,Ic.right>=0?Ic.right:-1,Ic.center>=0?Ic.center:-1,Ic.left>=0?Ic.left:-1,Ic.vertical||-1,qp,Rh,Yd,$d,Wf,jv,Kp,Jd,Qd,Fh,ev,Hp,Os,Xd,df,Zv,tv,0,cd,vd,Dh,Pl)}(fi,Vp,Nv,Fi,bi,ns,Tl,fi.layers[0],fi.collisionBoxArray,zi.index,zi.sourceLayerIndex,fi.index,jf,tl,Ws,Lo,Tc,ec,of,Ql,zi,Go,Ci,Jl,Xi)};if(As==="line")for(var rl=0,Ro=mn(zi.geometry,0,0,8192,8192);rl<Ro.length;rl+=1)for(var Iu=Ro[rl],uu=0,sf=Ai(Iu,pp,Pu,Fi.vertical||el,bi,24,fp,fi.overscaling,8192);uu<sf.length;uu+=1){var Oh=sf[uu];el&&Ne(fi,el.text,Ac,Oh)||ms(Iu,Oh)}else if(As==="line-center")for(var hp=0,Vf=zi.geometry;hp<Vf.length;hp+=1){var Zp=Vf[hp];if(Zp.length>1){var kh=Po(Zp,Pu,Fi.vertical||el,bi,24,fp);kh&&ms(Zp,kh)}}else if(zi.type==="Polygon")for(var Gf=0,Up=$l(zi.geometry,0);Gf<Up.length;Gf+=1){var dp=Up[Gf],jp=Vr(dp,16);ms(dp[0],new ha(jp.x,jp.y,0))}else if(zi.type==="LineString")for(var uf=0,lf=zi.geometry;uf<lf.length;uf+=1){var vp=lf[uf];ms(vp,new ha(vp[0].x,vp[0].y,0))}else if(zi.type==="Point")for(var cf=0,Ud=zi.geometry;cf<Ud.length;cf+=1)for(var ud=0,jd=Ud[cf];ud<jd.length;ud+=1){var ld=jd[ud];ms([ld],new ha(ld.x,ld.y,0))}}(t,Pt,zr,Oo,p,L,Sr,tr,Br,rs,w)},ot=0,St=t.features;ot<St.length;ot+=1)$e();g&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,s,p,m){var g,w=1/Math.tan(a/2);return t[0]=w/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,m!=null&&m!==1/0?(t[10]=(m+p)*(g=1/(p-m)),t[14]=2*m*p*g):(t[10]=-1,t[14]=-2*p),t},v.pick=function(t,a){for(var s={},p=0;p<a.length;p++){var m=a[p];m in t&&(s[m]=t[m])}return s},v.plugin=ws,v.polygonIntersectsPolygon=Cs,v.postMapLoadEvent=bt,v.postTurnstileEvent=is,v.potpack=Er,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=Hr,v.registerForPluginStateChange=function(t){return t({pluginStatus:cs,pluginURL:ju}),ap.on("pluginStateChange",t),t},v.renderColorRamp=Ep,v.rotate=function(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3],C=Math.sin(s),I=Math.cos(s);return t[0]=p*I+g*C,t[1]=m*I+w*C,t[2]=p*-C+g*I,t[3]=m*-C+w*I,t},v.rotateX=function(t,a,s){var p=Math.sin(s),m=Math.cos(s),g=a[4],w=a[5],C=a[6],I=a[7],L=a[8],D=a[9],N=a[10],V=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=g*m+L*p,t[5]=w*m+D*p,t[6]=C*m+N*p,t[7]=I*m+V*p,t[8]=L*m-g*p,t[9]=D*m-w*p,t[10]=N*m-C*p,t[11]=V*m-I*p,t},v.rotateZ=function(t,a,s){var p=Math.sin(s),m=Math.cos(s),g=a[0],w=a[1],C=a[2],I=a[3],L=a[4],D=a[5],N=a[6],V=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=g*m+L*p,t[1]=w*m+D*p,t[2]=C*m+N*p,t[3]=I*m+V*p,t[4]=L*m-g*p,t[5]=D*m-w*p,t[6]=N*m-C*p,t[7]=V*m-I*p,t},v.scale=function(t,a,s){var p=s[0],m=s[1],g=s[2];return t[0]=a[0]*p,t[1]=a[1]*p,t[2]=a[2]*p,t[3]=a[3]*p,t[4]=a[4]*m,t[5]=a[5]*m,t[6]=a[6]*m,t[7]=a[7]*m,t[8]=a[8]*g,t[9]=a[9]*g,t[10]=a[10]*g,t[11]=a[11]*g,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},v.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},v.setCacheLimits=function(t,a){Xt=t,Tr=a},v.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),cs==="deferred"||cs==="loading"||cs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ju=Si.resolveURL(t),cs="deferred",Pf=a,vc(),s||Js()},v.sphericalToCartesian=function(t){var a=t[0],s=t[1],p=t[2];return s+=90,s*=Math.PI/180,p*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(p),y:a*Math.sin(s)*Math.sin(p),z:a*Math.cos(p)}},v.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},v.styleSpec=te,v.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},v.symbolSize=$a,v.transformMat3=function(t,a,s){var p=a[0],m=a[1],g=a[2];return t[0]=p*s[0]+m*s[3]+g*s[6],t[1]=p*s[1]+m*s[4]+g*s[7],t[2]=p*s[2]+m*s[5]+g*s[8],t},v.transformMat4=ou,v.translate=function(t,a,s){var p,m,g,w,C,I,L,D,N,V,q,xe,Ce=s[0],ze=s[1],Le=s[2];return a===t?(t[12]=a[0]*Ce+a[4]*ze+a[8]*Le+a[12],t[13]=a[1]*Ce+a[5]*ze+a[9]*Le+a[13],t[14]=a[2]*Ce+a[6]*ze+a[10]*Le+a[14],t[15]=a[3]*Ce+a[7]*ze+a[11]*Le+a[15]):(m=a[1],g=a[2],w=a[3],C=a[4],I=a[5],L=a[6],D=a[7],N=a[8],V=a[9],q=a[10],xe=a[11],t[0]=p=a[0],t[1]=m,t[2]=g,t[3]=w,t[4]=C,t[5]=I,t[6]=L,t[7]=D,t[8]=N,t[9]=V,t[10]=q,t[11]=xe,t[12]=p*Ce+C*ze+N*Le+a[12],t[13]=m*Ce+I*ze+V*Le+a[13],t[14]=g*Ce+L*ze+q*Le+a[14],t[15]=w*Ce+D*ze+xe*Le+a[15]),t},v.triggerPluginCompletionEvent=If,v.uniqueId=Ut,v.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=oh,v.validateStyle=Vc,v.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},v.vectorTile=wc,v.version="1.13.1",v.warnOnce=Ye,v.webpSupported=An,v.window=fe,v.wrap=Jt}),ve(["./shared"],function(v){"use strict";function be(B){var U=typeof B;if(U==="number"||U==="boolean"||U==="string"||B==null)return JSON.stringify(B);if(Array.isArray(B)){for(var Y="[",oe=0,Te=B;oe<Te.length;oe+=1)Y+=be(Te[oe])+",";return Y+"]"}for(var Ze=Object.keys(B).sort(),We="{",te=0;te<Ze.length;te++)We+=JSON.stringify(Ze[te])+":"+be(B[Ze[te]])+",";return We+"}"}function Z(B){for(var U="",Y=0,oe=v.refProperties;Y<oe.length;Y+=1)U+="/"+be(B[oe[Y]]);return U}var se=function(B){this.keyCache={},B&&this.replace(B)};se.prototype.replace=function(B){this._layerConfigs={},this._layers={},this.update(B,[])},se.prototype.update=function(B,U){for(var Y=this,oe=0,Te=B;oe<Te.length;oe+=1){var Ze=Te[oe];this._layerConfigs[Ze.id]=Ze;var We=this._layers[Ze.id]=v.createStyleLayer(Ze);We._featureFilter=v.featureFilter(We.filter),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id]}for(var te=0,Pe=U;te<Pe.length;te+=1){var nt=Pe[te];delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt]}this.familiesBySource={};for(var $t=0,lr=function(Ir,Pr){for(var Bn={},Lr=0;Lr<Ir.length;Lr++){var Un=Pr&&Pr[Ir[Lr].id]||Z(Ir[Lr]);Pr&&(Pr[Ir[Lr].id]=Un);var li=Bn[Un];li||(li=Bn[Un]=[]),li.push(Ir[Lr])}var Nn=[];for(var Pn in Bn)Nn.push(Bn[Pn]);return Nn}(v.values(this._layerConfigs),this.keyCache);$t<lr.length;$t+=1){var pt=lr[$t].map(function(Ir){return Y._layers[Ir.id]}),er=pt[0];if(er.visibility!=="none"){var Wr=er.source||"",Rr=this.familiesBySource[Wr];Rr||(Rr=this.familiesBySource[Wr]={});var Rt=er.sourceLayer||"_geojsonTileLayer",Dr=Rr[Rt];Dr||(Dr=Rr[Rt]=[]),Dr.push(pt)}}};var me=function(B){var U={},Y=[];for(var oe in B){var Te=B[oe],Ze=U[oe]={};for(var We in Te){var te=Te[+We];if(te&&te.bitmap.width!==0&&te.bitmap.height!==0){var Pe={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};Y.push(Pe),Ze[We]={rect:Pe,metrics:te.metrics}}}}var nt=v.potpack(Y),$t=new v.AlphaImage({width:nt.w||1,height:nt.h||1});for(var lr in B){var pt=B[lr];for(var er in pt){var Wr=pt[+er];if(Wr&&Wr.bitmap.width!==0&&Wr.bitmap.height!==0){var Rr=U[lr][er].rect;v.AlphaImage.copy(Wr.bitmap,$t,{x:0,y:0},{x:Rr.x+1,y:Rr.y+1},Wr.bitmap)}}}this.image=$t,this.positions=U};v.register("GlyphAtlas",me);var ae=function(B){this.tileID=new v.OverscaledTileID(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId};function fe(B,U,Y){for(var oe=new v.EvaluationParameters(U),Te=0,Ze=B;Te<Ze.length;Te+=1)Ze[Te].recalculate(oe,Y)}function Q(B,U){var Y=v.getArrayBuffer(B.request,function(oe,Te,Ze,We){oe?U(oe):Te&&U(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Te)),rawData:Te,cacheControl:Ze,expires:We})});return function(){Y.cancel(),U()}}ae.prototype.parse=function(B,U,Y,oe,Te){var Ze=this;this.status="parsing",this.data=B,this.collisionBoxArray=new v.CollisionBoxArray;var We=new v.DictionaryCoder(Object.keys(B.layers).sort()),te=new v.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];var Pe,nt,$t,lr,pt={},er={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Wr=U.familiesBySource[this.source];for(var Rr in Wr){var Rt=B.layers[Rr];if(Rt){Rt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Rr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Dr=We.encode(Rr),Ir=[],Pr=0;Pr<Rt.length;Pr++){var Bn=Rt.feature(Pr),Lr=te.getId(Bn,Rr);Ir.push({feature:Bn,id:Lr,index:Pr,sourceLayerIndex:Dr})}for(var Un=0,li=Wr[Rr];Un<li.length;Un+=1){var Nn=li[Un],Pn=Nn[0];Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(fe(Nn,this.zoom,Y),(pt[Pn.id]=Pn.createBucket({index:te.bucketLayerIDs.length,layers:Nn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source})).populate(Ir,er,this.tileID.canonical),te.bucketLayerIDs.push(Nn.map(function(Wn){return Wn.id})))}}}var jn=v.mapObject(er.glyphDependencies,function(Wn){return Object.keys(Wn).map(Number)});Object.keys(jn).length?oe.send("getGlyphs",{uid:this.uid,stacks:jn},function(Wn,zn){Pe||(Pe=Wn,nt=zn,Li.call(Ze))}):nt={};var Ea=Object.keys(er.iconDependencies);Ea.length?oe.send("getImages",{icons:Ea,source:this.source,tileID:this.tileID,type:"icons"},function(Wn,zn){Pe||(Pe=Wn,$t=zn,Li.call(Ze))}):$t={};var mi=Object.keys(er.patternDependencies);function Li(){if(Pe)return Te(Pe);if(nt&&$t&&lr){var Wn=new me(nt),zn=new v.ImageAtlas($t,lr);for(var Jn in pt){var Qi=pt[Jn];Qi instanceof v.SymbolBucket?(fe(Qi.layers,this.zoom,Y),v.performSymbolLayout(Qi,nt,Wn.positions,$t,zn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Qi.hasPattern&&(Qi instanceof v.LineBucket||Qi instanceof v.FillBucket||Qi instanceof v.FillExtrusionBucket)&&(fe(Qi.layers,this.zoom,Y),Qi.addFeatures(er,this.tileID.canonical,zn.patternPositions))}this.status="done",Te(null,{buckets:v.values(pt).filter(function(ys){return!ys.isEmpty()}),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wn.image,imageAtlas:zn,glyphMap:this.returnDependencies?nt:null,iconMap:this.returnDependencies?$t:null,glyphPositions:this.returnDependencies?Wn.positions:null})}}mi.length?oe.send("getImages",{icons:mi,source:this.source,tileID:this.tileID,type:"patterns"},function(Wn,zn){Pe||(Pe=Wn,lr=zn,Li.call(Ze))}):lr={},Li.call(this)};var we=function(B,U,Y,oe){this.actor=B,this.layerIndex=U,this.availableImages=Y,this.loadVectorData=oe||Q,this.loading={},this.loaded={}};we.prototype.loadTile=function(B,U){var Y=this,oe=B.uid;this.loading||(this.loading={});var Te=!!(B&&B.request&&B.request.collectResourceTiming)&&new v.RequestPerformance(B.request),Ze=this.loading[oe]=new ae(B);Ze.abort=this.loadVectorData(B,function(We,te){if(delete Y.loading[oe],We||!te)return Ze.status="done",Y.loaded[oe]=Ze,U(We);var Pe=te.rawData,nt={};te.expires&&(nt.expires=te.expires),te.cacheControl&&(nt.cacheControl=te.cacheControl);var $t={};if(Te){var lr=Te.finish();lr&&($t.resourceTiming=JSON.parse(JSON.stringify(lr)))}Ze.vectorTile=te.vectorTile,Ze.parse(te.vectorTile,Y.layerIndex,Y.availableImages,Y.actor,function(pt,er){if(pt||!er)return U(pt);U(null,v.extend({rawTileData:Pe.slice(0)},er,nt,$t))}),Y.loaded=Y.loaded||{},Y.loaded[oe]=Ze})},we.prototype.reloadTile=function(B,U){var Y=this,oe=this.loaded,Te=B.uid,Ze=this;if(oe&&oe[Te]){var We=oe[Te];We.showCollisionBoxes=B.showCollisionBoxes;var te=function(Pe,nt){var $t=We.reloadCallback;$t&&(delete We.reloadCallback,We.parse(We.vectorTile,Ze.layerIndex,Y.availableImages,Ze.actor,$t)),U(Pe,nt)};We.status==="parsing"?We.reloadCallback=te:We.status==="done"&&(We.vectorTile?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}},we.prototype.abortTile=function(B,U){var Y=this.loading,oe=B.uid;Y&&Y[oe]&&Y[oe].abort&&(Y[oe].abort(),delete Y[oe]),U()},we.prototype.removeTile=function(B,U){var Y=this.loaded,oe=B.uid;Y&&Y[oe]&&delete Y[oe],U()};var Oe=v.window.ImageBitmap,M=function(){this.loaded={}};function Jt(B,U){if(B.length!==0){Gt(B[0],U);for(var Y=1;Y<B.length;Y++)Gt(B[Y],!U)}}function Gt(B,U){for(var Y=0,oe=0,Te=B.length,Ze=Te-1;oe<Te;Ze=oe++)Y+=(B[oe][0]-B[Ze][0])*(B[Ze][1]+B[oe][1]);Y>=0!=!!U&&B.reverse()}M.prototype.loadTile=function(B,U){var Y=B.uid,oe=B.encoding,Te=B.rawImageData,Ze=Oe&&Te instanceof Oe?this.getImageData(Te):Te,We=new v.DEMData(Y,Ze,oe);this.loaded=this.loaded||{},this.loaded[Y]=We,U(null,We)},M.prototype.getImageData=function(B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);var U=this.offscreenCanvasContext.getImageData(-1,-1,B.width+2,B.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:U.width,height:U.height},U.data)},M.prototype.removeTile=function(B){var U=this.loaded,Y=B.uid;U&&U[Y]&&delete U[Y]};var Dt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ut=function(B){this._feature=B,this.extent=v.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))};Ut.prototype.loadGeometry=function(){if(this._feature.type===1){for(var B=[],U=0,Y=this._feature.geometry;U<Y.length;U+=1){var oe=Y[U];B.push([new v.Point$1(oe[0],oe[1])])}return B}for(var Te=[],Ze=0,We=this._feature.geometry;Ze<We.length;Ze+=1){for(var te=[],Pe=0,nt=We[Ze];Pe<nt.length;Pe+=1){var $t=nt[Pe];te.push(new v.Point$1($t[0],$t[1]))}Te.push(te)}return Te},Ut.prototype.toGeoJSON=function(B,U,Y){return Dt.call(this,B,U,Y)};var ct=function(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=B.length,this._features=B};ct.prototype.feature=function(B){return new Ut(this._features[B])};var dt=v.vectorTile.VectorTileFeature,Mr=cr;function cr(B,U){this.options=U||{},this.features=B,this.length=B.length}function Ft(B,U){this.id=typeof B.id=="number"?B.id:void 0,this.type=B.type,this.rawGeometry=B.type===1?[B.geometry]:B.geometry,this.properties=B.tags,this.extent=U||4096}cr.prototype.feature=function(B){return new Ft(this.features[B],this.options.extent)},Ft.prototype.loadGeometry=function(){var B=this.rawGeometry;this.geometry=[];for(var U=0;U<B.length;U++){for(var Y=B[U],oe=[],Te=0;Te<Y.length;Te++)oe.push(new v.Point$1(Y[Te][0],Y[Te][1]));this.geometry.push(oe)}return this.geometry},Ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var B=this.geometry,U=1/0,Y=-1/0,oe=1/0,Te=-1/0,Ze=0;Ze<B.length;Ze++)for(var We=B[Ze],te=0;te<We.length;te++){var Pe=We[te];U=Math.min(U,Pe.x),Y=Math.max(Y,Pe.x),oe=Math.min(oe,Pe.y),Te=Math.max(Te,Pe.y)}return[U,oe,Y,Te]},Ft.prototype.toGeoJSON=dt.prototype.toGeoJSON;var st=ut,He=Mr;function ut(B){var U=new v.pbf;return function(Y,oe){for(var Te in Y.layers)oe.writeMessage(3,Ye,Y.layers[Te])}(B,U),U.finish()}function Ye(B,U){var Y;U.writeVarintField(15,B.version||1),U.writeStringField(1,B.name||""),U.writeVarintField(5,B.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<B.length;Y++)oe.feature=B.feature(Y),U.writeMessage(2,kt,oe);var Te=oe.keys;for(Y=0;Y<Te.length;Y++)U.writeStringField(3,Te[Y]);var Ze=oe.values;for(Y=0;Y<Ze.length;Y++)U.writeMessage(4,Ve,Ze[Y])}function kt(B,U){var Y=B.feature;Y.id!==void 0&&U.writeVarintField(1,Y.id),U.writeMessage(2,ur,B),U.writeVarintField(3,Y.type),U.writeMessage(4,Ee,Y)}function ur(B,U){var Y=B.feature,oe=B.keys,Te=B.values,Ze=B.keycache,We=B.valuecache;for(var te in Y.properties){var Pe=Ze[te];Pe===void 0&&(oe.push(te),Ze[te]=Pe=oe.length-1),U.writeVarint(Pe);var nt=Y.properties[te],$t=typeof nt;$t!=="string"&&$t!=="boolean"&&$t!=="number"&&(nt=JSON.stringify(nt));var lr=$t+":"+nt,pt=We[lr];pt===void 0&&(Te.push(nt),We[lr]=pt=Te.length-1),U.writeVarint(pt)}}function Or(B,U){return(U<<3)+(7&B)}function Gr(B){return B<<1^B>>31}function Ee(B,U){for(var Y=B.loadGeometry(),oe=B.type,Te=0,Ze=0,We=Y.length,te=0;te<We;te++){var Pe=Y[te],nt=1;oe===1&&(nt=Pe.length),U.writeVarint(Or(1,nt));for(var $t=oe===3?Pe.length-1:Pe.length,lr=0;lr<$t;lr++){lr===1&&oe!==1&&U.writeVarint(Or(2,$t-1));var pt=Pe[lr].x-Te,er=Pe[lr].y-Ze;U.writeVarint(Gr(pt)),U.writeVarint(Gr(er)),Te+=pt,Ze+=er}oe===3&&U.writeVarint(Or(7,1))}}function Ve(B,U){var Y=typeof B;Y==="string"?U.writeStringField(1,B):Y==="boolean"?U.writeBooleanField(7,B):Y==="number"&&(B%1!=0?U.writeDoubleField(3,B):B<0?U.writeSVarintField(6,B):U.writeVarintField(5,B))}function ke(B,U,Y,oe){vt(B,Y,oe),vt(U,2*Y,2*oe),vt(U,2*Y+1,2*oe+1)}function vt(B,U,Y){var oe=B[U];B[U]=B[Y],B[Y]=oe}function qe(B,U,Y,oe){var Te=B-Y,Ze=U-oe;return Te*Te+Ze*Ze}st.fromVectorTileJs=ut,st.fromGeojsonVt=function(B,U){U=U||{};var Y={};for(var oe in B)Y[oe]=new Mr(B[oe].features,U),Y[oe].name=oe,Y[oe].version=U.version,Y[oe].extent=U.extent;return ut({layers:Y})},st.GeoJSONWrapper=He;var H=function(B){return B[0]},Je=function(B){return B[1]},Et=function(B,U,Y,oe,Te){U===void 0&&(U=H),Y===void 0&&(Y=Je),oe===void 0&&(oe=64),Te===void 0&&(Te=Float64Array),this.nodeSize=oe,this.points=B;for(var Ze=B.length<65536?Uint16Array:Uint32Array,We=this.ids=new Ze(B.length),te=this.coords=new Te(2*B.length),Pe=0;Pe<B.length;Pe++)We[Pe]=Pe,te[2*Pe]=U(B[Pe]),te[2*Pe+1]=Y(B[Pe]);(function nt($t,lr,pt,er,Wr,Rr){if(!(Wr-er<=pt)){var Rt=er+Wr>>1;(function Dr(Ir,Pr,Bn,Lr,Un,li){for(;Un>Lr;){if(Un-Lr>600){var Nn=Un-Lr+1,Pn=Bn-Lr+1,jn=Math.log(Nn),Ea=.5*Math.exp(2*jn/3),mi=.5*Math.sqrt(jn*Ea*(Nn-Ea)/Nn)*(Pn-Nn/2<0?-1:1);Dr(Ir,Pr,Bn,Math.max(Lr,Math.floor(Bn-Pn*Ea/Nn+mi)),Math.min(Un,Math.floor(Bn+(Nn-Pn)*Ea/Nn+mi)),li)}var Li=Pr[2*Bn+li],Wn=Lr,zn=Un;for(ke(Ir,Pr,Lr,Bn),Pr[2*Un+li]>Li&&ke(Ir,Pr,Lr,Un);Wn<zn;){for(ke(Ir,Pr,Wn,zn),Wn++,zn--;Pr[2*Wn+li]<Li;)Wn++;for(;Pr[2*zn+li]>Li;)zn--}Pr[2*Lr+li]===Li?ke(Ir,Pr,Lr,zn):ke(Ir,Pr,++zn,Un),zn<=Bn&&(Lr=zn+1),Bn<=zn&&(Un=zn-1)}})($t,lr,Rt,er,Wr,Rr%2),nt($t,lr,pt,er,Rt-1,Rr+1),nt($t,lr,pt,Rt+1,Wr,Rr+1)}})(We,te,oe,0,We.length-1,0)};Et.prototype.range=function(B,U,Y,oe){return function(Te,Ze,We,te,Pe,nt,$t){for(var lr,pt,er=[0,Te.length-1,0],Wr=[];er.length;){var Rr=er.pop(),Rt=er.pop(),Dr=er.pop();if(Rt-Dr<=$t)for(var Ir=Dr;Ir<=Rt;Ir++)pt=Ze[2*Ir+1],(lr=Ze[2*Ir])>=We&&lr<=Pe&&pt>=te&&pt<=nt&&Wr.push(Te[Ir]);else{var Pr=Math.floor((Dr+Rt)/2);pt=Ze[2*Pr+1],(lr=Ze[2*Pr])>=We&&lr<=Pe&&pt>=te&&pt<=nt&&Wr.push(Te[Pr]);var Bn=(Rr+1)%2;(Rr===0?We<=lr:te<=pt)&&(er.push(Dr),er.push(Pr-1),er.push(Bn)),(Rr===0?Pe>=lr:nt>=pt)&&(er.push(Pr+1),er.push(Rt),er.push(Bn))}}return Wr}(this.ids,this.coords,B,U,Y,oe,this.nodeSize)},Et.prototype.within=function(B,U,Y){return function(oe,Te,Ze,We,te,Pe){for(var nt=[0,oe.length-1,0],$t=[],lr=te*te;nt.length;){var pt=nt.pop(),er=nt.pop(),Wr=nt.pop();if(er-Wr<=Pe)for(var Rr=Wr;Rr<=er;Rr++)qe(Te[2*Rr],Te[2*Rr+1],Ze,We)<=lr&&$t.push(oe[Rr]);else{var Rt=Math.floor((Wr+er)/2),Dr=Te[2*Rt],Ir=Te[2*Rt+1];qe(Dr,Ir,Ze,We)<=lr&&$t.push(oe[Rt]);var Pr=(pt+1)%2;(pt===0?Ze-te<=Dr:We-te<=Ir)&&(nt.push(Wr),nt.push(Rt-1),nt.push(Pr)),(pt===0?Ze+te>=Dr:We+te>=Ir)&&(nt.push(Rt+1),nt.push(er),nt.push(Pr))}}return $t}(this.ids,this.coords,B,U,Y,this.nodeSize)};var gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(B){return B}},qr=function(B){this.options=Oi(Object.create(gt),B),this.trees=new Array(this.options.maxZoom+1)};function Si(B,U,Y,oe,Te){return{x:B,y:U,zoom:1/0,id:Y,parentId:-1,numPoints:oe,properties:Te}}function On(B,U){var Y=B.geometry.coordinates,oe=Y[1];return{x:Cn(Y[0]),y:un(oe),zoom:1/0,index:U,parentId:-1}}function An(B){return{type:"Feature",id:B.id,properties:gn(B),geometry:{type:"Point",coordinates:[(oe=B.x,360*(oe-.5)),(U=B.y,Y=(180-360*U)*Math.PI/180,360*Math.atan(Math.exp(Y))/Math.PI-90)]}};var U,Y,oe}function gn(B){var U=B.numPoints,Y=U>=1e4?Math.round(U/1e3)+"k":U>=1e3?Math.round(U/100)/10+"k":U;return Oi(Oi({},B.properties),{cluster:!0,cluster_id:B.id,point_count:U,point_count_abbreviated:Y})}function Cn(B){return B/360+.5}function un(B){var U=Math.sin(B*Math.PI/180),Y=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Y<0?0:Y>1?1:Y}function Oi(B,U){for(var Y in U)B[Y]=U[Y];return B}function Ei(B){return B.x}function da(B){return B.y}function sa(B,U,Y,oe,Te,Ze){var We=Te-Y,te=Ze-oe;if(We!==0||te!==0){var Pe=((B-Y)*We+(U-oe)*te)/(We*We+te*te);Pe>1?(Y=Te,oe=Ze):Pe>0&&(Y+=We*Pe,oe+=te*Pe)}return(We=B-Y)*We+(te=U-oe)*te}function Ti(B,U,Y,oe){var Te={id:B===void 0?null:B,type:U,geometry:Y,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var We=Ze.geometry,te=Ze.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")lo(Ze,We);else if(te==="Polygon"||te==="MultiLineString")for(var Pe=0;Pe<We.length;Pe++)lo(Ze,We[Pe]);else if(te==="MultiPolygon")for(Pe=0;Pe<We.length;Pe++)for(var nt=0;nt<We[Pe].length;nt++)lo(Ze,We[Pe][nt])}(Te),Te}function lo(B,U){for(var Y=0;Y<U.length;Y+=3)B.minX=Math.min(B.minX,U[Y]),B.minY=Math.min(B.minY,U[Y+1]),B.maxX=Math.max(B.maxX,U[Y]),B.maxY=Math.max(B.maxY,U[Y+1])}function Mi(B,U,Y,oe){if(U.geometry){var Te=U.geometry.coordinates,Ze=U.geometry.type,We=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),te=[],Pe=U.id;if(Y.promoteId?Pe=U.properties[Y.promoteId]:Y.generateId&&(Pe=oe||0),Ze==="Point")Pi(Te,te);else if(Ze==="MultiPoint")for(var nt=0;nt<Te.length;nt++)Pi(Te[nt],te);else if(Ze==="LineString")bo(Te,te,We,!1);else if(Ze==="MultiLineString"){if(Y.lineMetrics){for(nt=0;nt<Te.length;nt++)bo(Te[nt],te=[],We,!1),B.push(Ti(Pe,"LineString",te,U.properties));return}le(Te,te,We,!1)}else if(Ze==="Polygon")le(Te,te,We,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(nt=0;nt<U.geometry.geometries.length;nt++)Mi(B,{id:Pe,geometry:U.geometry.geometries[nt],properties:U.properties},Y,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(nt=0;nt<Te.length;nt++){var $t=[];le(Te[nt],$t,We,!0),te.push($t)}}B.push(Ti(Pe,Ze,te,U.properties))}}function Pi(B,U){U.push(Ha(B[0])),U.push(ki(B[1])),U.push(0)}function bo(B,U,Y,oe){for(var Te,Ze,We=0,te=0;te<B.length;te++){var Pe=Ha(B[te][0]),nt=ki(B[te][1]);U.push(Pe),U.push(nt),U.push(0),te>0&&(We+=oe?(Te*nt-Pe*Ze)/2:Math.sqrt(Math.pow(Pe-Te,2)+Math.pow(nt-Ze,2))),Te=Pe,Ze=nt}var $t=U.length-3;U[2]=1,function lr(pt,er,Wr,Rr){for(var Rt,Dr=Rr,Ir=Wr-er>>1,Pr=Wr-er,Bn=pt[er],Lr=pt[er+1],Un=pt[Wr],li=pt[Wr+1],Nn=er+3;Nn<Wr;Nn+=3){var Pn=sa(pt[Nn],pt[Nn+1],Bn,Lr,Un,li);if(Pn>Dr)Rt=Nn,Dr=Pn;else if(Pn===Dr){var jn=Math.abs(Nn-Ir);jn<Pr&&(Rt=Nn,Pr=jn)}}Dr>Rr&&(Rt-er>3&&lr(pt,er,Rt,Rr),pt[Rt+2]=Dr,Wr-Rt>3&&lr(pt,Rt,Wr,Rr))}(U,0,$t,Y),U[$t+2]=1,U.size=Math.abs(We),U.start=0,U.end=U.size}function le(B,U,Y,oe){for(var Te=0;Te<B.length;Te++){var Ze=[];bo(B[Te],Ze,Y,oe),U.push(Ze)}}function Ha(B){return B/360+.5}function ki(B){var U=Math.sin(B*Math.PI/180),Y=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Y<0?0:Y>1?1:Y}function Wo(B,U,Y,oe,Te,Ze,We,te){if(oe/=U,Ze>=(Y/=U)&&We<oe)return B;if(We<Y||Ze>=oe)return null;for(var Pe=[],nt=0;nt<B.length;nt++){var $t=B[nt],lr=$t.geometry,pt=$t.type,er=Te===0?$t.minX:$t.minY,Wr=Te===0?$t.maxX:$t.maxY;if(er>=Y&&Wr<oe)Pe.push($t);else if(!(Wr<Y||er>=oe)){var Rr=[];if(pt==="Point"||pt==="MultiPoint")cu(lr,Rr,Y,oe,Te);else if(pt==="LineString")is(lr,Rr,Y,oe,Te,!1,te.lineMetrics);else if(pt==="MultiLineString")bt(lr,Rr,Y,oe,Te,!1);else if(pt==="Polygon")bt(lr,Rr,Y,oe,Te,!0);else if(pt==="MultiPolygon")for(var Rt=0;Rt<lr.length;Rt++){var Dr=[];bt(lr[Rt],Dr,Y,oe,Te,!0),Dr.length&&Rr.push(Dr)}if(Rr.length){if(te.lineMetrics&&pt==="LineString"){for(Rt=0;Rt<Rr.length;Rt++)Pe.push(Ti($t.id,pt,Rr[Rt],$t.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(Rr.length===1?(pt="LineString",Rr=Rr[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=Rr.length===3?"Point":"MultiPoint"),Pe.push(Ti($t.id,pt,Rr,$t.tags))}}}return Pe.length?Pe:null}function cu(B,U,Y,oe,Te){for(var Ze=0;Ze<B.length;Ze+=3){var We=B[Ze+Te];We>=Y&&We<=oe&&(U.push(B[Ze]),U.push(B[Ze+1]),U.push(B[Ze+2]))}}function is(B,U,Y,oe,Te,Ze,We){for(var te,Pe,nt=as(B),$t=Te===0?Tr:Ur,lr=B.start,pt=0;pt<B.length-3;pt+=3){var er=B[pt],Wr=B[pt+1],Rr=B[pt+2],Rt=B[pt+3],Dr=B[pt+4],Ir=Te===0?er:Wr,Pr=Te===0?Rt:Dr,Bn=!1;We&&(te=Math.sqrt(Math.pow(er-Rt,2)+Math.pow(Wr-Dr,2))),Ir<Y?Pr>Y&&(Pe=$t(nt,er,Wr,Rt,Dr,Y),We&&(nt.start=lr+te*Pe)):Ir>oe?Pr<oe&&(Pe=$t(nt,er,Wr,Rt,Dr,oe),We&&(nt.start=lr+te*Pe)):Xt(nt,er,Wr,Rr),Pr<Y&&Ir>=Y&&(Pe=$t(nt,er,Wr,Rt,Dr,Y),Bn=!0),Pr>oe&&Ir<=oe&&(Pe=$t(nt,er,Wr,Rt,Dr,oe),Bn=!0),!Ze&&Bn&&(We&&(nt.end=lr+te*Pe),U.push(nt),nt=as(B)),We&&(lr+=te)}var Lr=B.length-3;er=B[Lr],Wr=B[Lr+1],Rr=B[Lr+2],(Ir=Te===0?er:Wr)>=Y&&Ir<=oe&&Xt(nt,er,Wr,Rr),Lr=nt.length-3,Ze&&Lr>=3&&(nt[Lr]!==nt[0]||nt[Lr+1]!==nt[1])&&Xt(nt,nt[0],nt[1],nt[2]),nt.length&&U.push(nt)}function as(B){var U=[];return U.size=B.size,U.start=B.start,U.end=B.end,U}function bt(B,U,Y,oe,Te,Ze){for(var We=0;We<B.length;We++)is(B[We],U,Y,oe,Te,Ze,!1)}function Xt(B,U,Y,oe){B.push(U),B.push(Y),B.push(oe)}function Tr(B,U,Y,oe,Te,Ze){var We=(Ze-U)/(oe-U);return B.push(Ze),B.push(Y+(Te-Y)*We),B.push(1),We}function Ur(B,U,Y,oe,Te,Ze){var We=(Ze-Y)/(Te-Y);return B.push(U+(oe-U)*We),B.push(Ze),B.push(1),We}function dn(B,U){for(var Y=[],oe=0;oe<B.length;oe++){var Te,Ze=B[oe],We=Ze.type;if(We==="Point"||We==="MultiPoint"||We==="LineString")Te=ui(Ze.geometry,U);else if(We==="MultiLineString"||We==="Polygon"){Te=[];for(var te=0;te<Ze.geometry.length;te++)Te.push(ui(Ze.geometry[te],U))}else if(We==="MultiPolygon")for(Te=[],te=0;te<Ze.geometry.length;te++){for(var Pe=[],nt=0;nt<Ze.geometry[te].length;nt++)Pe.push(ui(Ze.geometry[te][nt],U));Te.push(Pe)}Y.push(Ti(Ze.id,We,Te,Ze.tags))}return Y}function ui(B,U){var Y=[];Y.size=B.size,B.start!==void 0&&(Y.start=B.start,Y.end=B.end);for(var oe=0;oe<B.length;oe+=3)Y.push(B[oe]+U,B[oe+1],B[oe+2]);return Y}function Rn(B,U){if(B.transformed)return B;var Y,oe,Te,Ze=1<<B.z,We=B.x,te=B.y;for(Y=0;Y<B.features.length;Y++){var Pe=B.features[Y],nt=Pe.geometry,$t=Pe.type;if(Pe.geometry=[],$t===1)for(oe=0;oe<nt.length;oe+=2)Pe.geometry.push($n(nt[oe],nt[oe+1],U,Ze,We,te));else for(oe=0;oe<nt.length;oe++){var lr=[];for(Te=0;Te<nt[oe].length;Te+=2)lr.push($n(nt[oe][Te],nt[oe][Te+1],U,Ze,We,te));Pe.geometry.push(lr)}}return B.transformed=!0,B}function $n(B,U,Y,oe,Te,Ze){return[Math.round(Y*(B*oe-Te)),Math.round(Y*(U*oe-Ze))]}function Mn(B,U,Y,oe,Te){for(var Ze=U===Te.maxZoom?0:Te.tolerance/((1<<U)*Te.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:oe,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<B.length;te++){We.numFeatures++,di(We,B[te],Ze,Te);var Pe=B[te].minX,nt=B[te].minY,$t=B[te].maxX,lr=B[te].maxY;Pe<We.minX&&(We.minX=Pe),nt<We.minY&&(We.minY=nt),$t>We.maxX&&(We.maxX=$t),lr>We.maxY&&(We.maxY=lr)}return We}function di(B,U,Y,oe){var Te=U.geometry,Ze=U.type,We=[];if(Ze==="Point"||Ze==="MultiPoint")for(var te=0;te<Te.length;te+=3)We.push(Te[te]),We.push(Te[te+1]),B.numPoints++,B.numSimplified++;else if(Ze==="LineString")ni(We,Te,B,Y,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(te=0;te<Te.length;te++)ni(We,Te[te],B,Y,Ze==="Polygon",te===0);else if(Ze==="MultiPolygon")for(var Pe=0;Pe<Te.length;Pe++){var nt=Te[Pe];for(te=0;te<nt.length;te++)ni(We,nt[te],B,Y,!0,te===0)}if(We.length){var $t=U.tags||null;if(Ze==="LineString"&&oe.lineMetrics){for(var lr in $t={},U.tags)$t[lr]=U.tags[lr];$t.mapbox_clip_start=Te.start/Te.size,$t.mapbox_clip_end=Te.end/Te.size}var pt={geometry:We,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:$t};U.id!==null&&(pt.id=U.id),B.features.push(pt)}}function ni(B,U,Y,oe,Te,Ze){var We=oe*oe;if(oe>0&&U.size<(Te?We:oe))Y.numPoints+=U.length/3;else{for(var te=[],Pe=0;Pe<U.length;Pe+=3)(oe===0||U[Pe+2]>We)&&(Y.numSimplified++,te.push(U[Pe]),te.push(U[Pe+1])),Y.numPoints++;Te&&function(nt,$t){for(var lr=0,pt=0,er=nt.length,Wr=er-2;pt<er;Wr=pt,pt+=2)lr+=(nt[pt]-nt[Wr])*(nt[pt+1]+nt[Wr+1]);if(lr>0===$t)for(pt=0,er=nt.length;pt<er/2;pt+=2){var Rr=nt[pt],Rt=nt[pt+1];nt[pt]=nt[er-2-pt],nt[pt+1]=nt[er-1-pt],nt[er-2-pt]=Rr,nt[er-1-pt]=Rt}}(te,Ze),B.push(te)}}function to(B,U){var Y=(U=this.options=function(Te,Ze){for(var We in Ze)Te[We]=Ze[We];return Te}(Object.create(this.options),U)).debug;if(Y&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var oe=function(Te,Ze){var We=[];if(Te.type==="FeatureCollection")for(var te=0;te<Te.features.length;te++)Mi(We,Te.features[te],Ze,te);else Mi(We,Te.type==="Feature"?Te:{geometry:Te},Ze);return We}(B,U);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(oe=function(Te,Ze){var We=Ze.buffer/Ze.extent,te=Te,Pe=Wo(Te,1,-1-We,We,0,-1,2,Ze),nt=Wo(Te,1,1-We,2+We,0,-1,2,Ze);return(Pe||nt)&&(te=Wo(Te,1,-We,1+We,0,-1,2,Ze)||[],Pe&&(te=dn(Pe,1).concat(te)),nt&&(te=te.concat(dn(nt,-1)))),te}(oe,U)).length&&this.splitTile(oe,0,0,0),Y&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wo(B,U,Y){return 32*((1<<B)*Y+U)+B}function fu(B,U){var Y=B.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);var oe=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!oe)return U(null,null);var Te=new ct(oe.features),Ze=st(Te);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),U(null,{vectorTile:Te,rawData:Ze.buffer})}qr.prototype.load=function(B){var U=this.options,Y=U.log,oe=U.minZoom,Te=U.maxZoom,Ze=U.nodeSize;Y&&console.time("total time");var We="prepare "+B.length+" points";Y&&console.time(We),this.points=B;for(var te=[],Pe=0;Pe<B.length;Pe++)B[Pe].geometry&&te.push(On(B[Pe],Pe));this.trees[Te+1]=new Et(te,Ei,da,Ze,Float32Array),Y&&console.timeEnd(We);for(var nt=Te;nt>=oe;nt--){var $t=+Date.now();te=this._cluster(te,nt),this.trees[nt]=new Et(te,Ei,da,Ze,Float32Array),Y&&console.log("z%d: %d clusters in %dms",nt,te.length,+Date.now()-$t)}return Y&&console.timeEnd("total time"),this},qr.prototype.getClusters=function(B,U){var Y=((B[0]+180)%360+360)%360-180,oe=Math.max(-90,Math.min(90,B[1])),Te=B[2]===180?180:((B[2]+180)%360+360)%360-180,Ze=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)Y=-180,Te=180;else if(Y>Te){var We=this.getClusters([Y,oe,180,Ze],U),te=this.getClusters([-180,oe,Te,Ze],U);return We.concat(te)}for(var Pe=this.trees[this._limitZoom(U)],nt=[],$t=0,lr=Pe.range(Cn(Y),un(Ze),Cn(Te),un(oe));$t<lr.length;$t+=1){var pt=Pe.points[lr[$t]];nt.push(pt.numPoints?An(pt):this.points[pt.index])}return nt},qr.prototype.getChildren=function(B){var U=this._getOriginId(B),Y=this._getOriginZoom(B),oe="No cluster with the specified id.",Te=this.trees[Y];if(!Te)throw new Error(oe);var Ze=Te.points[U];if(!Ze)throw new Error(oe);for(var We=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),te=[],Pe=0,nt=Te.within(Ze.x,Ze.y,We);Pe<nt.length;Pe+=1){var $t=Te.points[nt[Pe]];$t.parentId===B&&te.push($t.numPoints?An($t):this.points[$t.index])}if(te.length===0)throw new Error(oe);return te},qr.prototype.getLeaves=function(B,U,Y){var oe=[];return this._appendLeaves(oe,B,U=U||10,Y=Y||0,0),oe},qr.prototype.getTile=function(B,U,Y){var oe=this.trees[this._limitZoom(B)],Te=Math.pow(2,B),Ze=this.options,We=Ze.radius/Ze.extent,te=(Y-We)/Te,Pe=(Y+1+We)/Te,nt={features:[]};return this._addTileFeatures(oe.range((U-We)/Te,te,(U+1+We)/Te,Pe),oe.points,U,Y,Te,nt),U===0&&this._addTileFeatures(oe.range(1-We/Te,te,1,Pe),oe.points,Te,Y,Te,nt),U===Te-1&&this._addTileFeatures(oe.range(0,te,We/Te,Pe),oe.points,-1,Y,Te,nt),nt.features.length?nt:null},qr.prototype.getClusterExpansionZoom=function(B){for(var U=this._getOriginZoom(B)-1;U<=this.options.maxZoom;){var Y=this.getChildren(B);if(U++,Y.length!==1)break;B=Y[0].properties.cluster_id}return U},qr.prototype._appendLeaves=function(B,U,Y,oe,Te){for(var Ze=0,We=this.getChildren(U);Ze<We.length;Ze+=1){var te=We[Ze],Pe=te.properties;if(Pe&&Pe.cluster?Te+Pe.point_count<=oe?Te+=Pe.point_count:Te=this._appendLeaves(B,Pe.cluster_id,Y,oe,Te):Te<oe?Te++:B.push(te),B.length===Y)break}return Te},qr.prototype._addTileFeatures=function(B,U,Y,oe,Te,Ze){for(var We=0,te=B;We<te.length;We+=1){var Pe=U[te[We]],nt=Pe.numPoints,$t={type:1,geometry:[[Math.round(this.options.extent*(Pe.x*Te-Y)),Math.round(this.options.extent*(Pe.y*Te-oe))]],tags:nt?gn(Pe):this.points[Pe.index].properties},lr=void 0;nt?lr=Pe.id:this.options.generateId?lr=Pe.index:this.points[Pe.index].id&&(lr=this.points[Pe.index].id),lr!==void 0&&($t.id=lr),Ze.features.push($t)}},qr.prototype._limitZoom=function(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))},qr.prototype._cluster=function(B,U){for(var Y=[],oe=this.options,Te=oe.reduce,Ze=oe.minPoints,We=oe.radius/(oe.extent*Math.pow(2,U)),te=0;te<B.length;te++){var Pe=B[te];if(!(Pe.zoom<=U)){Pe.zoom=U;for(var nt=this.trees[U+1],$t=nt.within(Pe.x,Pe.y,We),lr=Pe.numPoints||1,pt=lr,er=0,Wr=$t;er<Wr.length;er+=1){var Rr=nt.points[Wr[er]];Rr.zoom>U&&(pt+=Rr.numPoints||1)}if(pt>=Ze){for(var Rt=Pe.x*lr,Dr=Pe.y*lr,Ir=Te&&lr>1?this._map(Pe,!0):null,Pr=(te<<5)+(U+1)+this.points.length,Bn=0,Lr=$t;Bn<Lr.length;Bn+=1){var Un=nt.points[Lr[Bn]];if(!(Un.zoom<=U)){Un.zoom=U;var li=Un.numPoints||1;Rt+=Un.x*li,Dr+=Un.y*li,Un.parentId=Pr,Te&&(Ir||(Ir=this._map(Pe,!0)),Te(Ir,this._map(Un)))}}Pe.parentId=Pr,Y.push(Si(Rt/pt,Dr/pt,Pr,pt,Ir))}else if(Y.push(Pe),pt>1)for(var Nn=0,Pn=$t;Nn<Pn.length;Nn+=1){var jn=nt.points[Pn[Nn]];jn.zoom<=U||(jn.zoom=U,Y.push(jn))}}}return Y},qr.prototype._getOriginId=function(B){return B-this.points.length>>5},qr.prototype._getOriginZoom=function(B){return(B-this.points.length)%32},qr.prototype._map=function(B,U){if(B.numPoints)return U?Oi({},B.properties):B.properties;var Y=this.points[B.index].properties,oe=this.options.map(Y);return U&&oe===Y?Oi({},oe):oe},to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(B,U,Y,oe,Te,Ze,We){for(var te=[B,U,Y,oe],Pe=this.options,nt=Pe.debug;te.length;){oe=te.pop(),Y=te.pop(),U=te.pop(),B=te.pop();var $t=1<<U,lr=wo(U,Y,oe),pt=this.tiles[lr];if(!pt&&(nt>1&&console.time("creation"),pt=this.tiles[lr]=Mn(B,U,Y,oe,Pe),this.tileCoords.push({z:U,x:Y,y:oe}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,Y,oe,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));var er="z"+U;this.stats[er]=(this.stats[er]||0)+1,this.total++}if(pt.source=B,Te){if(U===Pe.maxZoom||U===Te)continue;var Wr=1<<Te-U;if(Y!==Math.floor(Ze/Wr)||oe!==Math.floor(We/Wr))continue}else if(U===Pe.indexMaxZoom||pt.numPoints<=Pe.indexMaxPoints)continue;if(pt.source=null,B.length!==0){nt>1&&console.time("clipping");var Rr,Rt,Dr,Ir,Pr,Bn,Lr=.5*Pe.buffer/Pe.extent,Un=.5-Lr,li=.5+Lr,Nn=1+Lr;Rr=Rt=Dr=Ir=null,Pr=Wo(B,$t,Y-Lr,Y+li,0,pt.minX,pt.maxX,Pe),Bn=Wo(B,$t,Y+Un,Y+Nn,0,pt.minX,pt.maxX,Pe),B=null,Pr&&(Rr=Wo(Pr,$t,oe-Lr,oe+li,1,pt.minY,pt.maxY,Pe),Rt=Wo(Pr,$t,oe+Un,oe+Nn,1,pt.minY,pt.maxY,Pe),Pr=null),Bn&&(Dr=Wo(Bn,$t,oe-Lr,oe+li,1,pt.minY,pt.maxY,Pe),Ir=Wo(Bn,$t,oe+Un,oe+Nn,1,pt.minY,pt.maxY,Pe),Bn=null),nt>1&&console.timeEnd("clipping"),te.push(Rr||[],U+1,2*Y,2*oe),te.push(Rt||[],U+1,2*Y,2*oe+1),te.push(Dr||[],U+1,2*Y+1,2*oe),te.push(Ir||[],U+1,2*Y+1,2*oe+1)}}},to.prototype.getTile=function(B,U,Y){var oe=this.options,Te=oe.extent,Ze=oe.debug;if(B<0||B>24)return null;var We=1<<B,te=wo(B,U=(U%We+We)%We,Y);if(this.tiles[te])return Rn(this.tiles[te],Te);Ze>1&&console.log("drilling down to z%d-%d-%d",B,U,Y);for(var Pe,nt=B,$t=U,lr=Y;!Pe&&nt>0;)nt--,$t=Math.floor($t/2),lr=Math.floor(lr/2),Pe=this.tiles[wo(nt,$t,lr)];return Pe&&Pe.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",nt,$t,lr),Ze>1&&console.time("drilling down"),this.splitTile(Pe.source,nt,$t,lr,B,U,Y),Ze>1&&console.timeEnd("drilling down"),this.tiles[te]?Rn(this.tiles[te],Te):null):null};var Rs=function(B){function U(Y,oe,Te,Ze){B.call(this,Y,oe,Te,fu),Ze&&(this.loadGeoJSON=Ze)}return B&&(U.__proto__=B),(U.prototype=Object.create(B&&B.prototype)).constructor=U,U.prototype.loadData=function(Y,oe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=oe,this._pendingLoadDataParams=Y,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},U.prototype._loadData=function(){var Y=this;if(this._pendingCallback&&this._pendingLoadDataParams){var oe=this._pendingCallback,Te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ze=!!(Te&&Te.request&&Te.request.collectResourceTiming)&&new v.RequestPerformance(Te.request);this.loadGeoJSON(Te,function(We,te){if(We||!te)return oe(We);if(typeof te!="object")return oe(new Error("Input data given to '"+Te.source+"' is not a valid GeoJSON object."));(function pt(er,Wr){var Rr,Rt=er&&er.type;if(Rt==="FeatureCollection")for(Rr=0;Rr<er.features.length;Rr++)pt(er.features[Rr],Wr);else if(Rt==="GeometryCollection")for(Rr=0;Rr<er.geometries.length;Rr++)pt(er.geometries[Rr],Wr);else if(Rt==="Feature")pt(er.geometry,Wr);else if(Rt==="Polygon")Jt(er.coordinates,Wr);else if(Rt==="MultiPolygon")for(Rr=0;Rr<er.coordinates.length;Rr++)Jt(er.coordinates[Rr],Wr);return er})(te,!0);try{if(Te.filter){var Pe=v.createExpression(Te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(function(pt){return pt.key+": "+pt.message}).join(", "));var nt=te.features.filter(function(pt){return Pe.value.evaluate({zoom:0},pt)});te={type:"FeatureCollection",features:nt}}Y._geoJSONIndex=Te.cluster?new qr(function(pt){var er=pt.superclusterOptions,Wr=pt.clusterProperties;if(!Wr||!er)return er;for(var Rr={},Rt={},Dr={accumulated:null,zoom:0},Ir={properties:null},Pr=Object.keys(Wr),Bn=0,Lr=Pr;Bn<Lr.length;Bn+=1){var Un=Lr[Bn],li=Wr[Un],Nn=li[0],Pn=v.createExpression(li[1]),jn=v.createExpression(typeof Nn=="string"?[Nn,["accumulated"],["get",Un]]:Nn);Rr[Un]=Pn.value,Rt[Un]=jn.value}return er.map=function(Ea){Ir.properties=Ea;for(var mi={},Li=0,Wn=Pr;Li<Wn.length;Li+=1){var zn=Wn[Li];mi[zn]=Rr[zn].evaluate(Dr,Ir)}return mi},er.reduce=function(Ea,mi){Ir.properties=mi;for(var Li=0,Wn=Pr;Li<Wn.length;Li+=1){var zn=Wn[Li];Dr.accumulated=Ea[zn],Ea[zn]=Rt[zn].evaluate(Dr,Ir)}},er}(Te)).load(te.features):function(pt,er){return new to(pt,er)}(te,Te.geojsonVtOptions)}catch(pt){return oe(pt)}Y.loaded={};var $t={};if(Ze){var lr=Ze.finish();lr&&($t.resourceTiming={},$t.resourceTiming[Te.source]=JSON.parse(JSON.stringify(lr)))}oe(null,$t)})}},U.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},U.prototype.reloadTile=function(Y,oe){var Te=this.loaded;return Te&&Te[Y.uid]?B.prototype.reloadTile.call(this,Y,oe):this.loadTile(Y,oe)},U.prototype.loadGeoJSON=function(Y,oe){if(Y.request)v.getJSON(Y.request,oe);else{if(typeof Y.data!="string")return oe(new Error("Input data given to '"+Y.source+"' is not a valid GeoJSON object."));try{return oe(null,JSON.parse(Y.data))}catch(Te){return oe(new Error("Input data given to '"+Y.source+"' is not a valid GeoJSON object."))}}},U.prototype.removeSource=function(Y,oe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),oe()},U.prototype.getClusterExpansionZoom=function(Y,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(Te){oe(Te)}},U.prototype.getClusterChildren=function(Y,oe){try{oe(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(Te){oe(Te)}},U.prototype.getClusterLeaves=function(Y,oe){try{oe(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(Te){oe(Te)}},U}(we),Ji=function(B){var U=this;this.self=B,this.actor=new v.Actor(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:Rs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Y,oe){if(U.workerSourceTypes[Y])throw new Error('Worker source with name "'+Y+'" already registered.');U.workerSourceTypes[Y]=oe},this.self.registerRTLTextPlugin=function(Y){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=Y.applyArabicShaping,v.plugin.processBidirectionalText=Y.processBidirectionalText,v.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}};return Ji.prototype.setReferrer=function(B,U){this.referrer=U},Ji.prototype.setImages=function(B,U,Y){for(var oe in this.availableImages[B]=U,this.workerSources[B]){var Te=this.workerSources[B][oe];for(var Ze in Te)Te[Ze].availableImages=U}Y()},Ji.prototype.setLayers=function(B,U,Y){this.getLayerIndex(B).replace(U),Y()},Ji.prototype.updateLayers=function(B,U,Y){this.getLayerIndex(B).update(U.layers,U.removedIds),Y()},Ji.prototype.loadTile=function(B,U,Y){this.getWorkerSource(B,U.type,U.source).loadTile(U,Y)},Ji.prototype.loadDEMTile=function(B,U,Y){this.getDEMWorkerSource(B,U.source).loadTile(U,Y)},Ji.prototype.reloadTile=function(B,U,Y){this.getWorkerSource(B,U.type,U.source).reloadTile(U,Y)},Ji.prototype.abortTile=function(B,U,Y){this.getWorkerSource(B,U.type,U.source).abortTile(U,Y)},Ji.prototype.removeTile=function(B,U,Y){this.getWorkerSource(B,U.type,U.source).removeTile(U,Y)},Ji.prototype.removeDEMTile=function(B,U){this.getDEMWorkerSource(B,U.source).removeTile(U)},Ji.prototype.removeSource=function(B,U,Y){if(this.workerSources[B]&&this.workerSources[B][U.type]&&this.workerSources[B][U.type][U.source]){var oe=this.workerSources[B][U.type][U.source];delete this.workerSources[B][U.type][U.source],oe.removeSource!==void 0?oe.removeSource(U,Y):Y()}},Ji.prototype.loadWorkerSource=function(B,U,Y){try{this.self.importScripts(U.url),Y()}catch(oe){Y(oe.toString())}},Ji.prototype.syncRTLPluginState=function(B,U,Y){try{v.plugin.setState(U);var oe=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&oe!=null){this.self.importScripts(oe);var Te=v.plugin.isParsed();Y(Te?void 0:new Error("RTL Text Plugin failed to import scripts from "+oe),Te)}}catch(Ze){Y(Ze.toString())}},Ji.prototype.getAvailableImages=function(B){var U=this.availableImages[B];return U||(U=[]),U},Ji.prototype.getLayerIndex=function(B){var U=this.layerIndexes[B];return U||(U=this.layerIndexes[B]=new se),U},Ji.prototype.getWorkerSource=function(B,U,Y){var oe=this;return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][U]||(this.workerSources[B][U]={}),this.workerSources[B][U][Y]||(this.workerSources[B][U][Y]=new this.workerSourceTypes[U]({send:function(Te,Ze,We){oe.actor.send(Te,Ze,We,B)}},this.getLayerIndex(B),this.getAvailableImages(B))),this.workerSources[B][U][Y]},Ji.prototype.getDEMWorkerSource=function(B,U){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][U]||(this.demWorkerSources[B][U]=new M),this.demWorkerSources[B][U]},Ji.prototype.enforceCacheSizeLimit=function(B,U){v.enforceCacheSizeLimit(U)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ji(self)),Ji}),ve(["./shared"],function(v){"use strict";var be=v.createCommonjsModule(function(u){function f(x){return!l(x)}function l(x){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,P,R=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(R);try{P=new Worker(z),E=!0}catch(j){E=!1}return P&&P.terminate(),URL.revokeObjectURL(z),E}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var E=document.createElement("canvas");E.width=E.height=1;var P=E.getContext("2d");if(!P)return!1;var R=P.getImageData(0,0,1,1);return R&&R.width===E.width}()?(h[S=x&&x.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(E){var P=function(z){var j=document.createElement("canvas"),ee=Object.create(f.webGLContextAttributes);return ee.failIfMajorPerformanceCaveat=z,j.probablySupportsContext?j.probablySupportsContext("webgl",ee)||j.probablySupportsContext("experimental-webgl",ee):j.supportsContext?j.supportsContext("webgl",ee)||j.supportsContext("experimental-webgl",ee):j.getContext("webgl",ee)||j.getContext("experimental-webgl",ee)}(E);if(!P)return!1;var R=P.createShader(P.VERTEX_SHADER);return!(!R||P.isContextLost())&&(P.shaderSource(R,"void main() {}"),P.compileShader(R),P.getShaderParameter(R,P.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}u.exports?u.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=l);var h={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(u,f,l){var h=v.window.document.createElement(u);return f!==void 0&&(h.className=f),l&&l.appendChild(h),h},createNS:function(u,f){return v.window.document.createElementNS(u,f)}},se=v.window.document&&v.window.document.documentElement.style;function me(u){if(!se)return u[0];for(var f=0;f<u.length;f++)if(u[f]in se)return u[f];return u[0]}var ae,fe=me(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){se&&fe&&(ae=se[fe],se[fe]="none")},Z.enableDrag=function(){se&&fe&&(se[fe]=ae)};var Q=me(["transform","WebkitTransform"]);Z.setTransform=function(u,f){u.style[Q]=f};var we=!1;try{var Oe=Object.defineProperty({},"passive",{get:function(){we=!0}});v.window.addEventListener("test",Oe,Oe),v.window.removeEventListener("test",Oe,Oe)}catch(u){we=!1}Z.addEventListener=function(u,f,l,h){h===void 0&&(h={}),u.addEventListener(f,l,"passive"in h&&we?h:h.capture)},Z.removeEventListener=function(u,f,l,h){h===void 0&&(h={}),u.removeEventListener(f,l,"passive"in h&&we?h:h.capture)};var M=function(u){u.preventDefault(),u.stopPropagation(),v.window.removeEventListener("click",M,!0)};function Jt(u){var f=u.userImage;return!!(f&&f.render&&f.render())&&(u.data.replace(new Uint8Array(f.data.buffer)),!0)}Z.suppressClick=function(){v.window.addEventListener("click",M,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",M,!0)},0)},Z.mousePos=function(u,f){var l=u.getBoundingClientRect();return new v.Point(f.clientX-l.left-u.clientLeft,f.clientY-l.top-u.clientTop)},Z.touchPos=function(u,f){for(var l=u.getBoundingClientRect(),h=[],x=0;x<f.length;x++)h.push(new v.Point(f[x].clientX-l.left-u.clientLeft,f[x].clientY-l.top-u.clientTop));return h},Z.mouseButton=function(u){return v.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button},Z.remove=function(u){u.parentNode&&u.parentNode.removeChild(u)};var Gt=function(u){function f(){u.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(l){if(this.loaded!==l&&(this.loaded=l,l)){for(var h=0,x=this.requestors;h<x.length;h+=1){var S=x[h];this._notify(S.ids,S.callback)}this.requestors=[]}},f.prototype.getImage=function(l){return this.images[l]},f.prototype.addImage=function(l,h){this._validate(l,h)&&(this.images[l]=h)},f.prototype._validate=function(l,h){var x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchX" value'))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchY" value'))),x=!1),this._validateContent(h.content,h)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "content" value'))),x=!1),x},f.prototype._validateStretch=function(l,h){if(!l)return!0;for(var x=0,S=0,E=l;S<E.length;S+=1){var P=E[S];if(P[0]<x||P[1]<P[0]||h<P[1])return!1;x=P[1]}return!0},f.prototype._validateContent=function(l,h){return!(l&&(l.length!==4||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))},f.prototype.updateImage=function(l,h){h.version=this.images[l].version+1,this.images[l]=h,this.updatedImages[l]=!0},f.prototype.removeImage=function(l){var h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(l,h){var x=!0;if(!this.isLoaded())for(var S=0,E=l;S<E.length;S+=1)this.images[E[S]]||(x=!1);this.isLoaded()||x?this._notify(l,h):this.requestors.push({ids:l,callback:h})},f.prototype._notify=function(l,h){for(var x={},S=0,E=l;S<E.length;S+=1){var P=E[S];this.images[P]||this.fire(new v.Event("styleimagemissing",{id:P}));var R=this.images[P];R?x[P]={data:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:Boolean(R.userImage&&R.userImage.render)}:v.warnOnce('Image "'+P+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,x)},f.prototype.getPixelSize=function(){var l=this.atlasImage;return{width:l.width,height:l.height}},f.prototype.getPattern=function(l){var h=this.patterns[l],x=this.getImage(l);if(!x)return null;if(h&&h.position.version===x.version)return h.position;if(h)h.position.version=x.version;else{var S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},E=new v.ImagePosition(S,x);this.patterns[l]={bin:S,position:E}}return this._updatePatternAtlas(),this.patterns[l].position},f.prototype.bind=function(l){var h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var l=[];for(var h in this.patterns)l.push(this.patterns[h].bin);var x=v.potpack(l),S=x.w,E=x.h,P=this.atlasImage;for(var R in P.resize({width:S||1,height:E||1}),this.patterns){var z=this.patterns[R].bin,j=z.x+1,ee=z.y+1,ne=this.images[R].data,Ae=ne.width,Se=ne.height;v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j,y:ee},{width:Ae,height:Se}),v.RGBAImage.copy(ne,P,{x:0,y:Se-1},{x:j,y:ee-1},{width:Ae,height:1}),v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j,y:ee+Se},{width:Ae,height:1}),v.RGBAImage.copy(ne,P,{x:Ae-1,y:0},{x:j-1,y:ee},{width:1,height:Se}),v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j+Ae,y:ee},{width:1,height:Se})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(l){for(var h=0,x=l;h<x.length;h+=1){var S=x[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var E=this.images[S];Jt(E)&&this.updateImage(S,E)}}},f}(v.Evented),Dt=dt,Ut=dt,ct=1e20;function dt(u,f,l,h,x,S){this.fontSize=u||24,this.buffer=f===void 0?3:f,this.cutoff=h||.25,this.fontFamily=x||"sans-serif",this.fontWeight=S||"normal",this.radius=l||8;var E=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=E,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.d=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Int16Array(E),this.middle=Math.round(E/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Mr(u,f,l,h,x,S,E){for(var P=0;P<f;P++){for(var R=0;R<l;R++)h[R]=u[R*f+P];for(cr(h,x,S,E,l),R=0;R<l;R++)u[R*f+P]=x[R]}for(R=0;R<l;R++){for(P=0;P<f;P++)h[P]=u[R*f+P];for(cr(h,x,S,E,f),P=0;P<f;P++)u[R*f+P]=Math.sqrt(x[P])}}function cr(u,f,l,h,x){l[0]=0,h[0]=-ct,h[1]=+ct;for(var S=1,E=0;S<x;S++){for(var P=(u[S]+S*S-(u[l[E]]+l[E]*l[E]))/(2*S-2*l[E]);P<=h[E];)E--,P=(u[S]+S*S-(u[l[E]]+l[E]*l[E]))/(2*S-2*l[E]);l[++E]=S,h[E]=P,h[E+1]=+ct}for(S=0,E=0;S<x;S++){for(;h[E+1]<S;)E++;f[S]=(S-l[E])*(S-l[E])+u[l[E]]}}dt.prototype.draw=function(u){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(u,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),l=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var x=f.data[4*h+3]/255;this.gridOuter[h]=x===1?0:x===0?ct:Math.pow(Math.max(0,.5-x),2),this.gridInner[h]=x===1?ct:x===0?0:Math.pow(Math.max(0,x-.5),2)}for(Mr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Mr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)l[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return l},Dt.default=Ut;var Ft=function(u,f){this.requestManager=u,this.localIdeographFontFamily=f,this.entries={}};Ft.prototype.setURL=function(u){this.url=u},Ft.prototype.getGlyphs=function(u,f){var l=this,h=[];for(var x in u)for(var S=0,E=u[x];S<E.length;S+=1)h.push({stack:x,id:E[S]});v.asyncAll(h,function(P,R){var z=P.stack,j=P.id,ee=l.entries[z];ee||(ee=l.entries[z]={glyphs:{},requests:{},ranges:{}});var ne=ee.glyphs[j];if(ne===void 0){if(ne=l._tinySDF(ee,z,j))return ee.glyphs[j]=ne,void R(null,{stack:z,id:j,glyph:ne});var Ae=Math.floor(j/256);if(256*Ae>65535)R(new Error("glyphs > 65535 not supported"));else if(ee.ranges[Ae])R(null,{stack:z,id:j,glyph:ne});else{var Se=ee.requests[Ae];Se||(Se=ee.requests[Ae]=[],Ft.loadGlyphRange(z,Ae,l.url,l.requestManager,function(De,ge){if(ge){for(var Fe in ge)l._doesCharSupportLocalGlyph(+Fe)||(ee.glyphs[+Fe]=ge[+Fe]);ee.ranges[Ae]=!0}for(var Ge=0,at=Se;Ge<at.length;Ge+=1)(0,at[Ge])(De,ge);delete ee.requests[Ae]})),Se.push(function(De,ge){De?R(De):ge&&R(null,{stack:z,id:j,glyph:ge[j]||null})})}}else R(null,{stack:z,id:j,glyph:ne})},function(P,R){if(P)f(P);else if(R){for(var z={},j=0,ee=R;j<ee.length;j+=1){var ne=ee[j],Ae=ne.stack,Se=ne.id,De=ne.glyph;(z[Ae]||(z[Ae]={}))[Se]=De&&{id:De.id,bitmap:De.bitmap.clone(),metrics:De.metrics}}f(null,z)}})},Ft.prototype._doesCharSupportLocalGlyph=function(u){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](u)||v.isChar["Hangul Syllables"](u)||v.isChar.Hiragana(u)||v.isChar.Katakana(u))},Ft.prototype._tinySDF=function(u,f,l){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(l)){var x=u.tinySDF;if(!x){var S="400";/bold/i.test(f)?S="900":/medium/i.test(f)?S="500":/light/i.test(f)&&(S="200"),x=u.tinySDF=new Ft.TinySDF(24,3,8,.25,h,S)}return{id:l,bitmap:new v.AlphaImage({width:30,height:30},x.draw(String.fromCharCode(l))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ft.loadGlyphRange=function(u,f,l,h,x){var S=256*f,E=S+255,P=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",S+"-"+E),v.ResourceType.Glyphs);v.getArrayBuffer(P,function(R,z){if(R)x(R);else if(z){for(var j={},ee=0,ne=v.parseGlyphPBF(z);ee<ne.length;ee+=1){var Ae=ne[ee];j[Ae.id]=Ae}x(null,j)}})},Ft.TinySDF=Dt;var st=function(){this.specification=v.styleSpec.light.position};st.prototype.possiblyEvaluate=function(u,f){return v.sphericalToCartesian(u.expression.evaluate(f))},st.prototype.interpolate=function(u,f,l){return{x:v.number(u.x,f.x,l),y:v.number(u.y,f.y,l),z:v.number(u.z,f.z,l)}};var He=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new st,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),ut=function(u){function f(l){u.call(this),this._transitionable=new v.Transitionable(He),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(l,h){if(h===void 0&&(h={}),!this._validate(v.validateLight,l,h))for(var x in l){var S=l[x];v.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-"-transition".length),S):this._transitionable.setValue(x,S)}},f.prototype.updateTransitions=function(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(l){this.properties=this._transitioning.possiblyEvaluate(l)},f.prototype._validate=function(l,h,x){return(!x||x.validate!==!1)&&v.emitValidationErrors(this,l.call(v.validateStyle,v.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),Ye=function(u,f){this.width=u,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ye.prototype.getDash=function(u,f){var l=u.join(",")+String(f);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(u,f)),this.dashEntry[l]},Ye.prototype.getDashRanges=function(u,f,l){var h=[],x=u.length%2==1?-u[u.length-1]*l:0,S=u[0]*l,E=!0;h.push({left:x,right:S,isDash:E,zeroLength:u[0]===0});for(var P=u[0],R=1;R<u.length;R++){var z=u[R];h.push({left:x=P*l,right:S=(P+=z)*l,isDash:E=!E,zeroLength:z===0})}return h},Ye.prototype.addRoundDash=function(u,f,l){for(var h=f/2,x=-l;x<=l;x++)for(var S=this.width*(this.nextRow+l+x),E=0,P=u[E],R=0;R<this.width;R++){R/P.right>1&&(P=u[++E]);var z=Math.abs(R-P.left),j=Math.abs(R-P.right),ee=Math.min(z,j),ne=void 0,Ae=x/l*(h+1);if(P.isDash){var Se=h-Math.abs(Ae);ne=Math.sqrt(ee*ee+Se*Se)}else ne=h-Math.sqrt(ee*ee+Ae*Ae);this.data[S+R]=Math.max(0,Math.min(255,ne+128))}},Ye.prototype.addRegularDash=function(u){for(var f=u.length-1;f>=0;--f){var l=u[f],h=u[f+1];l.zeroLength?u.splice(f,1):h&&h.isDash===l.isDash&&(h.left=l.left,u.splice(f,1))}var x=u[0],S=u[u.length-1];x.isDash===S.isDash&&(x.left=S.left-this.width,S.right=x.right+this.width);for(var E=this.width*this.nextRow,P=0,R=u[P],z=0;z<this.width;z++){z/R.right>1&&(R=u[++P]);var j=Math.abs(z-R.left),ee=Math.abs(z-R.right),ne=Math.min(j,ee);this.data[E+z]=Math.max(0,Math.min(255,(R.isDash?ne:-ne)+128))}},Ye.prototype.addDash=function(u,f){var l=f?7:0,h=2*l+1;if(this.nextRow+h>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var x=0,S=0;S<u.length;S++)x+=u[S];if(x!==0){var E=this.width/x,P=this.getDashRanges(u,this.width,E);f?this.addRoundDash(P,E,l):this.addRegularDash(P)}var R={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:x};return this.nextRow+=h,this.dirty=!0,R},Ye.prototype.bind=function(u){var f=u.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var kt=function u(f,l){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var h=this.workerPool.acquire(this.id),x=0;x<h.length;x++){var S=new u.Actor(h[x],l,this.id);S.name="Worker "+x,this.actors.push(S)}};function ur(u,f,l){var h=function(x,S){if(x)return l(x);if(S){var E=v.pick(v.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(E.vectorLayers=S.vector_layers,E.vectorLayerIds=E.vectorLayers.map(function(P){return P.id})),E.tiles=f.canonicalizeTileset(E,u.url),l(null,E)}};return u.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(u.url),v.ResourceType.Source),h):v.browser.frame(function(){return h(null,u)})}kt.prototype.broadcast=function(u,f,l){v.asyncAll(this.actors,function(h,x){h.send(u,f,x)},l=l||function(){})},kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},kt.prototype.remove=function(){this.actors.forEach(function(u){u.remove()}),this.actors=[],this.workerPool.release(this.id)},kt.Actor=v.Actor;var Or=function(u,f,l){this.bounds=v.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=f||0,this.maxzoom=l||24};Or.prototype.validateBounds=function(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]},Or.prototype.contains=function(u){var f=Math.pow(2,u.z),l=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),h=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),x=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),S=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return u.x>=l&&u.x<x&&u.y>=h&&u.y<S};var Gr=function(u){function f(l,h,x,S){if(u.call(this),this.id=l,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(h,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,function(h,x){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new v.ErrorEvent(h)):x&&(v.extend(l,x),x.bounds&&(l.tileBounds=new Or(x.bounds,l.minzoom,l.maxzoom)),v.postTurnstileEvent(x.tiles,l.map._requestManager._customAccessToken),v.postMapLoadEvent(x.tiles,l.map._getMapId(),l.map._requestManager._skuToken,l.map._requestManager._customAccessToken),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setSourceProperty=function(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(l){var h=this;return this.setSourceProperty(function(){h._options.tiles=l}),this},f.prototype.setUrl=function(l){var h=this;return this.setSourceProperty(function(){h.url=l,h._options.url=l}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(l,h){var x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(x,v.ResourceType.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function E(P,R){return delete l.request,l.aborted?h(null):P&&P.status!==404?h(P):(R&&R.resourceTiming&&(l.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&l.setExpiryData(R),l.loadVectorData(R,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired"?l.state==="loading"?l.reloadCallback=h:l.request=l.actor.send("reloadTile",S,E.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",S,E.bind(this)))},f.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ee=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},h),v.extend(this,v.pick(h,["url","scheme","tileSize"]))}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,function(h,x){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new v.ErrorEvent(h)):x&&(v.extend(l,x),x.bounds&&(l.tileBounds=new Or(x.bounds,l.minzoom,l.maxzoom)),v.postTurnstileEvent(x.tiles),v.postMapLoadEvent(x.tiles,l.map._getMapId(),l.map._requestManager._skuToken),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},f.prototype.loadTile=function(l,h){var x=this,S=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);l.request=v.getImage(this.map._requestManager.transformRequest(S,v.ResourceType.Tile),function(E,P){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(E)l.state="errored",h(E);else if(P){x.map._refreshExpiredTiles&&l.setExpiryData(P),delete P.cacheControl,delete P.expires;var R=x.map.painter.context,z=R.gl;l.texture=x.map.painter.getTileTexture(P.width),l.texture?l.texture.update(P,{useMipmap:!0}):(l.texture=new v.Texture(R,P,z.RGBA,{useMipmap:!0}),l.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),R.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),l.state="loaded",v.cacheEntryPossiblyAdded(x.dispatcher),h(null)}})},f.prototype.abortTile=function(l,h){l.request&&(l.request.cancel(),delete l.request),h()},f.prototype.unloadTile=function(l,h){l.texture&&this.map.painter.saveTileTexture(l.texture),h()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ve=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(l,h){var x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(E,P){E&&(l.state="errored",h(E)),P&&(l.dem=P,l.needsHillshadePrepare=!0,l.state="loaded",h(null))}l.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),function(E,P){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(E)l.state="errored",h(E);else if(P){this.map._refreshExpiredTiles&&l.setExpiryData(P),delete P.cacheControl,delete P.expires;var R=v.window.ImageBitmap&&P instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?P:v.browser.getImageData(P,1),z={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:R,encoding:this.encoding};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",z,S.bind(this)))}}.bind(this)),l.neighboringTiles=this._getNeighboringTiles(l.tileID)},f.prototype._getNeighboringTiles=function(l){var h=l.canonical,x=Math.pow(2,h.z),S=(h.x-1+x)%x,E=h.x===0?l.wrap-1:l.wrap,P=(h.x+1+x)%x,R=h.x+1===x?l.wrap+1:l.wrap,z={};return z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y).key]={backfilled:!1},h.y>0&&(z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y-1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<x&&(z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y+1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y+1).key]={backfilled:!1}),z},f.prototype.unloadTile=function(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})},f}(Ee),ke=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=x.getActor(),this.setEventedParent(S),this._data=h.data,this._options=v.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var E=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*E,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*E,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:v.EXTENT,radius:(h.clusterRadius||50)*E,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)l.fire(new v.ErrorEvent(h));else{var x={dataType:"source",sourceDataType:"metadata"};l._collectResourceTiming&&l._resourceTiming&&l._resourceTiming.length>0&&(x.resourceTiming=l._resourceTiming,l._resourceTiming=[]),l.fire(new v.Event("data",x))}})},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setData=function(l){var h=this;return this._data=l,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)h.fire(new v.ErrorEvent(x));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new v.Event("data",S))}}),this},f.prototype.getClusterExpansionZoom=function(l,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},h),this},f.prototype.getClusterChildren=function(l,h){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},h),this},f.prototype.getClusterLeaves=function(l,h,x,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:h,offset:x},S),this},f.prototype._updateWorkerData=function(l){var h=this;this._loaded=!1;var x=v.extend({},this.workerOptions),S=this._data;typeof S=="string"?(x.request=this.map._requestManager.transformRequest(v.browser.resolveURL(S),v.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(S),this.actor.send(this.type+".loadData",x,function(E,P){h._removed||P&&P.abandoned||(h._loaded=!0,P&&P.resourceTiming&&P.resourceTiming[h.id]&&(h._resourceTiming=P.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:x.source},null),l(E))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(l,h){var x=this,S=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(S,{type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(E,P){return delete l.request,l.unloadVectorData(),l.aborted?h(null):E?h(E):(l.loadVectorData(P,x.map.painter,S==="reloadTile"),h(null))})},f.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0},f.prototype.unloadTile=function(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),vt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),qe=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.dispatcher=x,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(l,h){var x=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(S,E){x._loaded=!0,S?x.fire(new v.ErrorEvent(S)):E&&(x.image=E,l&&(x.coordinates=l),h&&h(),x._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(l){var h=this;return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,function(){h.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setCoordinates=function(l){var h=this;this.coordinates=l;var x=l.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(E){for(var P=1/0,R=1/0,z=-1/0,j=-1/0,ee=0,ne=E;ee<ne.length;ee+=1){var Ae=ne[ee];P=Math.min(P,Ae.x),R=Math.min(R,Ae.y),z=Math.max(z,Ae.x),j=Math.max(j,Ae.y)}var Se=Math.max(z-P,j-R),De=Math.max(0,Math.floor(-Math.log(Se)/Math.LN2)),ge=Math.pow(2,De);return new v.CanonicalTileID(De,Math.floor((P+z)/2*ge),Math.floor((R+j)/2*ge))}(x),this.minzoom=this.maxzoom=this.tileID.z;var S=x.map(function(E){return h.tileID.getTilePoint(E)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var l=this.map.painter.context,h=l.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.loadTile=function(l,h){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},h(null)):(l.state="errored",h(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),H=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),this.roundZoom=!0,this.type="video",this.options=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1;var h=this.options;this.urls=[];for(var x=0,S=h.urls;x<S.length;x+=1)this.urls.push(this.map._requestManager.transformRequest(S[x],v.ResourceType.Source).url);v.getVideo(this.urls,function(E,P){l._loaded=!0,E?l.fire(new v.ErrorEvent(E)):P&&(l.video=P,l.video.loop=!0,l.video.addEventListener("playing",function(){l.map.triggerRepaint()}),l.map&&l.video.play(),l._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(l){if(this.video){var h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=l}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var l=this.map.painter.context,h=l.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(qe),Je=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(E){return!Array.isArray(E)||E.length!==2||E.some(function(P){return typeof P!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,x=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(h,this.canvas,x.RGBA,{premultiply:!0}),this.tiles){var E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var l=0,h=[this.canvas.width,this.canvas.height];l<h.length;l+=1){var x=h[l];if(isNaN(x)||x<=0)return!0}return!1},f}(qe),Et={vector:Gr,raster:Ee,"raster-dem":Ve,geojson:ke,video:H,image:qe,canvas:Je};function gt(u,f){var l=v.identity([]);return v.translate(l,l,[1,1,0]),v.scale(l,l,[.5*u.width,.5*u.height,1]),v.multiply(l,l,u.calculatePosMatrix(f.toUnwrapped()))}function qr(u,f,l,h,x,S){var E=function(De,ge,Fe){if(De)for(var Ge=0,at=De;Ge<at.length;Ge+=1){var Ct=ge[at[Ge]];if(Ct&&Ct.source===Fe&&Ct.type==="fill-extrusion")return!0}else for(var wt in ge){var At=ge[wt];if(At.source===Fe&&At.type==="fill-extrusion")return!0}return!1}(x&&x.layers,f,u.id),P=S.maxPitchScaleFactor(),R=u.tilesIn(h,P,E);R.sort(Si);for(var z=[],j=0,ee=R;j<ee.length;j+=1){var ne=ee[j];z.push({wrappedTileID:ne.tileID.wrapped().key,queryResults:ne.tile.queryRenderedFeatures(f,l,u._state,ne.queryGeometry,ne.cameraQueryGeometry,ne.scale,x,S,P,gt(u.transform,ne.tileID))})}var Ae=function(De){for(var ge={},Fe={},Ge=0,at=De;Ge<at.length;Ge+=1){var Ct=at[Ge],wt=Ct.queryResults,At=Ct.wrappedTileID,Yt=Fe[At]=Fe[At]||{};for(var br in wt)for(var pr=wt[br],Fr=Yt[br]=Yt[br]||{},rn=ge[br]=ge[br]||[],fn=0,cn=pr;fn<cn.length;fn+=1){var hi=cn[fn];Fr[hi.featureIndex]||(Fr[hi.featureIndex]=!0,rn.push(hi))}}return ge}(z);for(var Se in Ae)Ae[Se].forEach(function(De){var ge=De.feature,Fe=u.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Fe});return Ae}function Si(u,f){var l=u.tileID,h=f.tileID;return l.overscaledZ-h.overscaledZ||l.canonical.y-h.canonical.y||l.wrap-h.wrap||l.canonical.x-h.canonical.x}var On=function(u,f){this.max=u,this.onRemove=f,this.reset()};On.prototype.reset=function(){for(var u in this.data)for(var f=0,l=this.data[u];f<l.length;f+=1){var h=l[f];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},On.prototype.add=function(u,f,l){var h=this,x=u.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);var S={value:f,timeout:void 0};if(l!==void 0&&(S.timeout=setTimeout(function(){h.remove(u,S)},l)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){var E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this},On.prototype.has=function(u){return u.wrapped().key in this.data},On.prototype.getAndRemove=function(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null},On.prototype._getAndRemoveByKey=function(u){var f=this.data[u].shift();return f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),f.value},On.prototype.getByKey=function(u){var f=this.data[u];return f?f[0].value:null},On.prototype.get=function(u){return this.has(u)?this.data[u.wrapped().key][0].value:null},On.prototype.remove=function(u,f){if(!this.has(u))return this;var l=u.wrapped().key,h=f===void 0?0:this.data[l].indexOf(f),x=this.data[l][h];return this.data[l].splice(h,1),x.timeout&&clearTimeout(x.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(x.value),this.order.splice(this.order.indexOf(l),1),this},On.prototype.setMaxSize=function(u){for(this.max=u;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},On.prototype.filter=function(u){var f=[];for(var l in this.data)for(var h=0,x=this.data[l];h<x.length;h+=1){var S=x[h];u(S.value)||f.push(S)}for(var E=0,P=f;E<P.length;E+=1){var R=P[E];this.remove(R.value.tileID,R)}};var An=function(u,f,l){this.context=u;var h=u.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(l),this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};An.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},An.prototype.updateData=function(u){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)},An.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Cn=function(u,f,l,h){this.length=f.length,this.attributes=l,this.itemSize=f.bytesPerElement,this.dynamicDraw=h,this.context=u;var x=u.gl;this.buffer=x.createBuffer(),u.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Cn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Cn.prototype.updateData=function(u){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,u.arrayBuffer)},Cn.prototype.enableAttributes=function(u,f){for(var l=0;l<this.attributes.length;l++){var h=f.attributes[this.attributes[l].name];h!==void 0&&u.enableVertexAttribArray(h)}},Cn.prototype.setVertexAttribPointers=function(u,f,l){for(var h=0;h<this.attributes.length;h++){var x=this.attributes[h],S=f.attributes[x.name];S!==void 0&&u.vertexAttribPointer(S,x.components,u[gn[x.type]],!1,this.itemSize,x.offset+this.itemSize*(l||0))}},Cn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var un=function(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};un.prototype.get=function(){return this.current},un.prototype.set=function(u){},un.prototype.getDefault=function(){return this.default},un.prototype.setDefault=function(){this.set(this.default)};var Oi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},f}(un),Ei=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)},f}(un),da=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)},f}(un),sa=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},f}(un),Ti=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)},f}(un),lo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)},f}(un),Mi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(l){var h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)},f}(un),Pi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)},f}(un),bo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}},f}(un),le=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)},f}(un),Ha=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}},f}(un),ki=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)},f}(un),Wo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}},f}(un),cu=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[l.ONE,l.ZERO]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)},f}(un),is=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},f}(un),as=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)},f}(un),bt=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}},f}(un),Xt=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)},f}(un),Tr=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)},f}(un),Ur=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)},f}(un),dn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)},f}(un),ui=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},f}(un),Rn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}},f}(un),$n=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},f}(un),Mn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}},f}(un),di=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}},f}(un),ni=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1},f}(un),to=function(u){function f(l){u.call(this,l),this.vao=l.extVertexArrayObject}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)},f}(un),wo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}},f}(un),fu=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}},f}(un),Rs=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}},f}(un),Ji=function(u){function f(l,h){u.call(this,l),this.context=l,this.parent=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(un),B=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}},f}(Ji),U=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},f}(Ji),Y=function(u,f,l,h){this.context=u,this.width=f,this.height=l;var x=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new B(u,x),h&&(this.depthAttachment=new U(u,x))};Y.prototype.destroy=function(){var u=this.context.gl,f=this.colorAttachment.get();if(f&&u.deleteTexture(f),this.depthAttachment){var l=this.depthAttachment.get();l&&u.deleteRenderbuffer(l)}u.deleteFramebuffer(this.framebuffer)};var oe=function(u,f,l){this.func=u,this.mask=f,this.range=l};oe.ReadOnly=!1,oe.ReadWrite=!0,oe.disabled=new oe(519,oe.ReadOnly,[0,1]);var Te=function(u,f,l,h,x,S){this.test=u,this.ref=f,this.mask=l,this.fail=h,this.depthFail=x,this.pass=S};Te.disabled=new Te({func:519,mask:0},0,0,7680,7680,7680);var Ze=function(u,f,l){this.blendFunction=u,this.blendColor=f,this.mask=l};Ze.disabled=new Ze(Ze.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ze.unblended=new Ze(Ze.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ze.alphaBlended=new Ze([1,771],v.Color.transparent,[!0,!0,!0,!0]);var We=function(u,f,l){this.enable=u,this.mode=f,this.frontFace=l};We.disabled=new We(!1,1029,2305),We.backCCW=new We(!0,1029,2305);var te=function(u){this.gl=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Oi(this),this.clearDepth=new Ei(this),this.clearStencil=new da(this),this.colorMask=new sa(this),this.depthMask=new Ti(this),this.stencilMask=new lo(this),this.stencilFunc=new Mi(this),this.stencilOp=new Pi(this),this.stencilTest=new bo(this),this.depthRange=new le(this),this.depthTest=new Ha(this),this.depthFunc=new ki(this),this.blend=new Wo(this),this.blendFunc=new cu(this),this.blendColor=new is(this),this.blendEquation=new as(this),this.cullFace=new bt(this),this.cullFaceSide=new Xt(this),this.frontFace=new Tr(this),this.program=new Ur(this),this.activeTexture=new dn(this),this.viewport=new ui(this),this.bindFramebuffer=new Rn(this),this.bindRenderbuffer=new $n(this),this.bindTexture=new Mn(this),this.bindVertexBuffer=new di(this),this.bindElementBuffer=new ni(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new to(this),this.pixelStoreUnpack=new wo(this),this.pixelStoreUnpackPremultiplyAlpha=new fu(this),this.pixelStoreUnpackFlipY=new Rs(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=u.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(u.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)};te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},te.prototype.createIndexBuffer=function(u,f){return new An(this,u,f)},te.prototype.createVertexBuffer=function(u,f,l){return new Cn(this,u,f,l)},te.prototype.createRenderbuffer=function(u,f,l){var h=this.gl,x=h.createRenderbuffer();return this.bindRenderbuffer.set(x),h.renderbufferStorage(h.RENDERBUFFER,u,f,l),this.bindRenderbuffer.set(null),x},te.prototype.createFramebuffer=function(u,f,l){return new Y(this,u,f,l)},te.prototype.clear=function(u){var f=u.color,l=u.depth,h=this.gl,x=0;f&&(x|=h.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(x|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),h.clear(x)},te.prototype.setCullFace=function(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))},te.prototype.setDepthMode=function(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)},te.prototype.setStencilMode=function(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)},te.prototype.setColorMode=function(u){v.deepEqual(u.blendFunction,Ze.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)},te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pe=function(u){function f(l,h,x){var S=this;u.call(this),this.id=l,this.dispatcher=x,this.on("data",function(E){E.dataType==="source"&&E.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(E,P,R,z){var j=new Et[P.type](E,P,R,z);if(j.id!==E)throw new Error("Expected Source id to be "+E+" instead of "+j.id);return v.bindAll(["load","abort","unload","serialize","prepare"],j),j}(l,h,x,this),this._tiles={},this._cache=new On(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.onAdd=function(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(l)},f.prototype.onRemove=function(l){this._source&&this._source.onRemove&&this._source.onRemove(l)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var l in this._tiles){var h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(l,h){return this._source.loadTile(l,h)},f.prototype._unloadTile=function(l){if(this._source.unloadTile)return this._source.unloadTile(l,function(){})},f.prototype._abortTile=function(l){if(this._source.abortTile)return this._source.abortTile(l,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(l){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var x=this._tiles[h];x.upload(l),x.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(l){return l.tileID}).sort(nt).map(function(l){return l.key})},f.prototype.getRenderableIds=function(l){var h=this,x=[];for(var S in this._tiles)this._isIdRenderable(S,l)&&x.push(this._tiles[S]);return l?x.sort(function(E,P){var R=E.tileID,z=P.tileID,j=new v.Point(R.canonical.x,R.canonical.y)._rotate(h.transform.angle),ee=new v.Point(z.canonical.x,z.canonical.y)._rotate(h.transform.angle);return R.overscaledZ-z.overscaledZ||ee.y-j.y||ee.x-j.x}).map(function(E){return E.tileID.key}):x.map(function(E){return E.tileID}).sort(nt).map(function(E){return E.key})},f.prototype.hasRenderableParent=function(l){var h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)},f.prototype._isIdRenderable=function(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var l in this._cache.reset(),this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")},f.prototype._reloadTile=function(l,h){var x=this._tiles[l];x&&(x.state!=="loading"&&(x.state=h),this._loadTile(x,this._tileLoaded.bind(this,x,l,h)))},f.prototype._tileLoaded=function(l,h,x,S){if(S)return l.state="errored",void(S.status!==404?this._source.fire(new v.ErrorEvent(S,{tile:l})):this.update(this.transform));l.timeAdded=v.browser.now(),x==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:l,coord:l.tileID}))},f.prototype._backfillDEM=function(l){for(var h=this.getRenderableIds(),x=0;x<h.length;x++){var S=h[x];if(l.neighboringTiles&&l.neighboringTiles[S]){var E=this.getTileByID(S);P(l,E),P(E,l)}}function P(R,z){R.needsHillshadePrepare=!0;var j=z.tileID.canonical.x-R.tileID.canonical.x,ee=z.tileID.canonical.y-R.tileID.canonical.y,ne=Math.pow(2,R.tileID.canonical.z),Ae=z.tileID.key;j===0&&ee===0||Math.abs(ee)>1||(Math.abs(j)>1&&(Math.abs(j+ne)===1?j+=ne:Math.abs(j-ne)===1&&(j-=ne)),z.dem&&R.dem&&(R.dem.backfillBorder(z.dem,j,ee),R.neighboringTiles&&R.neighboringTiles[Ae]&&(R.neighboringTiles[Ae].backfilled=!0)))}},f.prototype.getTile=function(l){return this.getTileByID(l.key)},f.prototype.getTileByID=function(l){return this._tiles[l]},f.prototype._retainLoadedChildren=function(l,h,x,S){for(var E in this._tiles){var P=this._tiles[E];if(!(S[E]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>x)){for(var R=P.tileID;P&&P.tileID.overscaledZ>h+1;){var z=P.tileID.scaledTo(P.tileID.overscaledZ-1);(P=this._tiles[z.key])&&P.hasData()&&(R=z)}for(var j=R;j.overscaledZ>h;)if(l[(j=j.scaledTo(j.overscaledZ-1)).key]){S[R.key]=R;break}}}},f.prototype.findLoadedParent=function(l,h){if(l.key in this._loadedParentTiles){var x=this._loadedParentTiles[l.key];return x&&x.tileID.overscaledZ>=h?x:null}for(var S=l.overscaledZ-1;S>=h;S--){var E=l.scaledTo(S),P=this._getLoadedTile(E);if(P)return P}},f.prototype._getLoadedTile=function(l){var h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)},f.prototype.updateCacheSize=function(l){var h=Math.ceil(l.width/this._source.tileSize)+1,x=Math.ceil(l.height/this._source.tileSize)+1,S=Math.floor(h*x*5),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(E)},f.prototype.handleWrapJump=function(l){var h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){var x={};for(var S in this._tiles){var E=this._tiles[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),x[E.tileID.key]=E}for(var P in this._tiles=x,this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(var R in this._tiles)this._setTileReloadTimer(R,this._tiles[R])}},f.prototype.update=function(l){var h=this;if(this.transform=l,this._sourceLoaded&&!this._paused){var x;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?x=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Yt){return new v.OverscaledTileID(Yt.canonical.z,Yt.wrap,Yt.canonical.z,Yt.canonical.x,Yt.canonical.y)}):(x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(x=x.filter(function(Yt){return h._source.hasTile(Yt)}))):x=[];var S=l.coveringZoomLevel(this._source),E=Math.max(S-f.maxOverzooming,this._source.minzoom),P=Math.max(S+f.maxUnderzooming,this._source.minzoom),R=this._updateRetainedTiles(x,S);if($t(this._source.type)){for(var z={},j={},ee=0,ne=Object.keys(R);ee<ne.length;ee+=1){var Ae=ne[ee],Se=R[Ae],De=this._tiles[Ae];if(De&&!(De.fadeEndTime&&De.fadeEndTime<=v.browser.now())){var ge=this.findLoadedParent(Se,E);ge&&(this._addTile(ge.tileID),z[ge.tileID.key]=ge.tileID),j[Ae]=Se}}for(var Fe in this._retainLoadedChildren(j,S,P,R),z)R[Fe]||(this._coveredTiles[Fe]=!0,R[Fe]=z[Fe])}for(var Ge in R)this._tiles[Ge].clearFadeHold();for(var at=0,Ct=v.keysDifference(this._tiles,R);at<Ct.length;at+=1){var wt=Ct[at],At=this._tiles[wt];At.hasSymbolBuckets&&!At.holdingForFade()?At.setHoldDuration(this.map._fadeDuration):At.hasSymbolBuckets&&!At.symbolFadeFinished()||this._removeTile(wt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)},f.prototype._updateRetainedTiles=function(l,h){for(var x={},S={},E=Math.max(h-f.maxOverzooming,this._source.minzoom),P=Math.max(h+f.maxUnderzooming,this._source.minzoom),R={},z=0,j=l;z<j.length;z+=1){var ee=j[z],ne=this._addTile(ee);x[ee.key]=ee,ne.hasData()||h<this._source.maxzoom&&(R[ee.key]=ee)}this._retainLoadedChildren(R,h,P,x);for(var Ae=0,Se=l;Ae<Se.length;Ae+=1){var De=Se[Ae],ge=this._tiles[De.key];if(!ge.hasData()){if(h+1>this._source.maxzoom){var Fe=De.children(this._source.maxzoom)[0],Ge=this.getTile(Fe);if(Ge&&Ge.hasData()){x[Fe.key]=Fe;continue}}else{var at=De.children(this._source.maxzoom);if(x[at[0].key]&&x[at[1].key]&&x[at[2].key]&&x[at[3].key])continue}for(var Ct=ge.wasRequested(),wt=De.overscaledZ-1;wt>=E;--wt){var At=De.scaledTo(wt);if(S[At.key]||(S[At.key]=!0,!(ge=this.getTile(At))&&Ct&&(ge=this._addTile(At)),ge&&(x[At.key]=At,Ct=ge.wasRequested(),ge.hasData())))break}}}return x},f.prototype._updateLoadedParentTileCache=function(){for(var l in this._loadedParentTiles={},this._tiles){for(var h=[],x=void 0,S=this._tiles[l].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){x=this._loadedParentTiles[S.key];break}h.push(S.key);var E=S.scaledTo(S.overscaledZ-1);if(x=this._getLoadedTile(E))break;S=E}for(var P=0,R=h;P<R.length;P+=1)this._loadedParentTiles[R[P]]=x}},f.prototype._addTile=function(l){var h=this._tiles[l.key];if(h)return h;(h=this._cache.getAndRemove(l))&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));var x=Boolean(h);return x||(h=new v.Tile(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,l.key,h.state))),h?(h.uses++,this._tiles[l.key]=h,x||this._source.fire(new v.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},f.prototype._setTileReloadTimer=function(l,h){var x=this;l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);var S=h.getExpiryTimeout();S&&(this._timers[l]=setTimeout(function(){x._reloadTile(l,"expired"),delete x._timers[l]},S))},f.prototype._removeTile=function(l){var h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},f.prototype.clearTiles=function(){for(var l in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(l);this._cache.reset()},f.prototype.tilesIn=function(l,h,x){var S=this,E=[],P=this.transform;if(!P)return E;for(var R=x?P.getCameraQueryGeometry(l):l,z=l.map(function(wt){return P.pointCoordinate(wt)}),j=R.map(function(wt){return P.pointCoordinate(wt)}),ee=this.getIds(),ne=1/0,Ae=1/0,Se=-1/0,De=-1/0,ge=0,Fe=j;ge<Fe.length;ge+=1){var Ge=Fe[ge];ne=Math.min(ne,Ge.x),Ae=Math.min(Ae,Ge.y),Se=Math.max(Se,Ge.x),De=Math.max(De,Ge.y)}for(var at=function(wt){var At=S._tiles[ee[wt]];if(!At.holdingForFade()){var Yt=At.tileID,br=Math.pow(2,P.zoom-At.tileID.overscaledZ),pr=h*At.queryPadding*v.EXTENT/At.tileSize/br,Fr=[Yt.getTilePoint(new v.MercatorCoordinate(ne,Ae)),Yt.getTilePoint(new v.MercatorCoordinate(Se,De))];if(Fr[0].x-pr<v.EXTENT&&Fr[0].y-pr<v.EXTENT&&Fr[1].x+pr>=0&&Fr[1].y+pr>=0){var rn=z.map(function(cn){return Yt.getTilePoint(cn)}),fn=j.map(function(cn){return Yt.getTilePoint(cn)});E.push({tile:At,tileID:Yt,queryGeometry:rn,cameraQueryGeometry:fn,scale:br})}}},Ct=0;Ct<ee.length;Ct++)at(Ct);return E},f.prototype.getVisibleCoordinates=function(l){for(var h=this,x=this.getRenderableIds(l).map(function(R){return h._tiles[R].tileID}),S=0,E=x;S<E.length;S+=1){var P=E[S];P.posMatrix=this.transform.calculatePosMatrix(P.toUnwrapped())}return x},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if($t(this._source.type))for(var l in this._tiles){var h=this._tiles[l];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(l,h,x){this._state.updateState(l=l||"_geojsonTileLayer",h,x)},f.prototype.removeFeatureState=function(l,h,x){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,x)},f.prototype.getFeatureState=function(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)},f.prototype.setDependencies=function(l,h,x){var S=this._tiles[l];S&&S.setDependencies(h,x)},f.prototype.reloadTilesForDependencies=function(l,h){for(var x in this._tiles)this._tiles[x].hasDependency(l,h)&&this._reloadTile(x,"reloading");this._cache.filter(function(S){return!S.hasDependency(l,h)})},f}(v.Evented);function nt(u,f){var l=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*f.wrap)-+(f.wrap<0);return u.overscaledZ-f.overscaledZ||h-l||f.canonical.y-u.canonical.y||f.canonical.x-u.canonical.x}function $t(u){return u==="raster"||u==="image"||u==="video"}function lr(){return new v.window.Worker(Kc.workerUrl)}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;var pt="mapboxgl_preloaded_worker_pool",er=function(){this.active={}};er.prototype.acquire=function(u){if(!this.workers)for(this.workers=[];this.workers.length<er.workerCount;)this.workers.push(new lr);return this.active[u]=!0,this.workers.slice()},er.prototype.release=function(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},er.prototype.isPreloaded=function(){return!!this.active[pt]},er.prototype.numActive=function(){return Object.keys(this.active).length};var Wr,Rr=Math.floor(v.browser.hardwareConcurrency/2);function Rt(){return Wr||(Wr=new er),Wr}function Dr(u,f){var l={};for(var h in u)h!=="ref"&&(l[h]=u[h]);return v.refProperties.forEach(function(x){x in f&&(l[x]=f[x])}),l}function Ir(u){u=u.slice();for(var f=Object.create(null),l=0;l<u.length;l++)f[u[l].id]=u[l];for(var h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Dr(u[h],f[u[h].ref]));return u}er.workerCount=Math.max(Math.min(Rr,6),1);var Pr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Bn(u,f,l){l.push({command:Pr.addSource,args:[u,f[u]]})}function Lr(u,f,l){f.push({command:Pr.removeSource,args:[u]}),l[u]=!0}function Un(u,f,l,h){Lr(u,l,h),Bn(u,f,l)}function li(u,f,l){var h;for(h in u[l])if(u[l].hasOwnProperty(h)&&h!=="data"&&!v.deepEqual(u[l][h],f[l][h]))return!1;for(h in f[l])if(f[l].hasOwnProperty(h)&&h!=="data"&&!v.deepEqual(u[l][h],f[l][h]))return!1;return!0}function Nn(u,f,l,h,x,S){var E;for(E in f=f||{},u=u||{})u.hasOwnProperty(E)&&(v.deepEqual(u[E],f[E])||l.push({command:S,args:[h,E,f[E],x]}));for(E in f)f.hasOwnProperty(E)&&!u.hasOwnProperty(E)&&(v.deepEqual(u[E],f[E])||l.push({command:S,args:[h,E,f[E],x]}))}function Pn(u){return u.id}function jn(u,f){return u[f.id]=f,u}var Ea=function(u,f){this.reset(u,f)};Ea.prototype.reset=function(u,f){this.points=u||[],this._distances=[0];for(var l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ea.prototype.lerp=function(u){if(this.points.length===1)return this.points[0];u=v.clamp(u,0,1);for(var f=1,l=this._distances[f],h=u*this.paddedLength+this.padding;l<h&&f<this._distances.length;)l=this._distances[++f];var x=f-1,S=this._distances[x],E=l-S,P=E>0?(h-S)/E:0;return this.points[x].mult(1-P).add(this.points[f].mult(P))};var mi=function(u,f,l){var h=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(u/l),this.yCellCount=Math.ceil(f/l);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=f,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Li(u,f,l,h,x){var S=v.create();return f?(v.scale(S,S,[1/x,1/x,1]),l||v.rotateZ(S,S,h.angle)):v.multiply(S,h.labelPlaneMatrix,u),S}function Wn(u,f,l,h,x){if(f){var S=v.clone(u);return v.scale(S,S,[x,x,1]),l||v.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function zn(u,f){var l=[u.x,u.y,0,1];ua(l,l,f);var h=l[3];return{point:new v.Point(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function Jn(u,f){return .5+u/f*.5}function Qi(u,f){var l=u[0]/u[3],h=u[1]/u[3];return l>=-f[0]&&l<=f[0]&&h>=-f[1]&&h<=f[1]}function ys(u,f,l,h,x,S,E,P){var R=h?u.textSizeData:u.iconSizeData,z=v.evaluateSizeForZoom(R,l.transform.zoom),j=[256/l.width*2+1,256/l.height*2+1],ee=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;ee.clear();for(var ne=u.lineVertexArray,Ae=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,Se=l.transform.width/l.transform.height,De=!1,ge=0;ge<Ae.length;ge++){var Fe=Ae.get(ge);if(Fe.hidden||Fe.writingMode===v.WritingMode.vertical&&!De)Ca(Fe.numGlyphs,ee);else{De=!1;var Ge=[Fe.anchorX,Fe.anchorY,0,1];if(v.transformMat4(Ge,Ge,f),Qi(Ge,j)){var at=Jn(l.transform.cameraToCenterDistance,Ge[3]),Ct=v.evaluateSizeForFeature(R,z,Fe),wt=E?Ct/at:Ct*at,At=new v.Point(Fe.anchorX,Fe.anchorY),Yt=zn(At,x).point,br={},pr=ku(Fe,wt,!1,P,f,x,S,u.glyphOffsetArray,ne,ee,Yt,At,br,Se);De=pr.useVertical,(pr.notEnoughRoom||De||pr.needsFlipping&&ku(Fe,wt,!0,P,f,x,S,u.glyphOffsetArray,ne,ee,Yt,At,br,Se).notEnoughRoom)&&Ca(Fe.numGlyphs,ee)}else Ca(Fe.numGlyphs,ee)}}h?u.text.dynamicLayoutVertexBuffer.updateData(ee):u.icon.dynamicLayoutVertexBuffer.updateData(ee)}function Bi(u,f,l,h,x,S,E,P,R,z,j){var ee=P.glyphStartIndex+P.numGlyphs,ne=P.lineStartIndex,Ae=P.lineStartIndex+P.lineLength,Se=f.getoffsetX(P.glyphStartIndex),De=f.getoffsetX(ee-1),ge=ji(u*Se,l,h,x,S,E,P.segment,ne,Ae,R,z,j);if(!ge)return null;var Fe=ji(u*De,l,h,x,S,E,P.segment,ne,Ae,R,z,j);return Fe?{first:ge,last:Fe}:null}function ea(u,f,l,h){return u===v.WritingMode.horizontal&&Math.abs(l.y-f.y)>Math.abs(l.x-f.x)*h?{useVertical:!0}:(u===v.WritingMode.vertical?f.y<l.y:f.x>l.x)?{needsFlipping:!0}:null}function ku(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae){var Se,De=f/24,ge=u.lineOffsetX*De,Fe=u.lineOffsetY*De;if(u.numGlyphs>1){var Ge=u.glyphStartIndex+u.numGlyphs,at=u.lineStartIndex,Ct=u.lineStartIndex+u.lineLength,wt=Bi(De,P,ge,Fe,l,j,ee,u,R,S,ne);if(!wt)return{notEnoughRoom:!0};var At=zn(wt.first.point,E).point,Yt=zn(wt.last.point,E).point;if(h&&!l){var br=ea(u.writingMode,At,Yt,Ae);if(br)return br}Se=[wt.first];for(var pr=u.glyphStartIndex+1;pr<Ge-1;pr++)Se.push(ji(De*P.getoffsetX(pr),ge,Fe,l,j,ee,u.segment,at,Ct,R,S,ne));Se.push(wt.last)}else{if(h&&!l){var Fr=zn(ee,x).point,rn=u.lineStartIndex+u.segment+1,fn=new v.Point(R.getx(rn),R.gety(rn)),cn=zn(fn,x),hi=cn.signedDistanceFromCamera>0?cn.point:qs(ee,fn,Fr,1,x),gr=ea(u.writingMode,Fr,hi,Ae);if(gr)return gr}var Jr=ji(De*P.getoffsetX(u.glyphStartIndex),ge,Fe,l,j,ee,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,R,S,ne);if(!Jr)return{notEnoughRoom:!0};Se=[Jr]}for(var kn=0,wn=Se;kn<wn.length;kn+=1){var vn=wn[kn];v.addDynamicAttributes(z,vn.point,vn.angle)}return{}}function qs(u,f,l,h,x){var S=zn(u.add(u.sub(f)._unit()),x).point,E=l.sub(S);return l.add(E._mult(h/E.mag()))}function ji(u,f,l,h,x,S,E,P,R,z,j,ee){var ne=h?u-f:u+f,Ae=ne>0?1:-1,Se=0;h&&(Ae*=-1,Se=Math.PI),Ae<0&&(Se+=Math.PI);for(var De=Ae>0?P+E:P+E+1,ge=x,Fe=x,Ge=0,at=0,Ct=Math.abs(ne),wt=[];Ge+at<=Ct;){if((De+=Ae)<P||De>=R)return null;if(Fe=ge,wt.push(ge),(ge=ee[De])===void 0){var At=new v.Point(z.getx(De),z.gety(De)),Yt=zn(At,j);if(Yt.signedDistanceFromCamera>0)ge=ee[De]=Yt.point;else{var br=De-Ae;ge=qs(Ge===0?S:new v.Point(z.getx(br),z.gety(br)),At,Fe,Ct-Ge+1,j)}}Ge+=at,at=Fe.dist(ge)}var pr=(Ct-Ge)/at,Fr=ge.sub(Fe),rn=Fr.mult(pr)._add(Fe);rn._add(Fr._unit()._perp()._mult(l*Ae));var fn=Se+Math.atan2(ge.y-Fe.y,ge.x-Fe.x);return wt.push(rn),{point:rn,angle:fn,path:wt}}mi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},mi.prototype.insert=function(u,f,l,h,x){this._forEachCell(f,l,h,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(f),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(x)},mi.prototype.insertCircle=function(u,f,l,h){this._forEachCell(f-h,l-h,f+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(f),this.circles.push(l),this.circles.push(h)},mi.prototype._insertBoxCell=function(u,f,l,h,x,S){this.boxCells[x].push(S)},mi.prototype._insertCircleCell=function(u,f,l,h,x,S){this.circleCells[x].push(S)},mi.prototype._query=function(u,f,l,h,x,S){if(l<0||u>this.width||h<0||f>this.height)return!x&&[];var E=[];if(u<=0&&f<=0&&this.width<=l&&this.height<=h){if(x)return!0;for(var P=0;P<this.boxKeys.length;P++)E.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(var R=0;R<this.circleKeys.length;R++){var z=this.circles[3*R],j=this.circles[3*R+1],ee=this.circles[3*R+2];E.push({key:this.circleKeys[R],x1:z-ee,y1:j-ee,x2:z+ee,y2:j+ee})}return S?E.filter(S):E}return this._forEachCell(u,f,l,h,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?E.length>0:E},mi.prototype._queryCircle=function(u,f,l,h,x){var S=u-l,E=u+l,P=f-l,R=f+l;if(E<0||S>this.width||R<0||P>this.height)return!h&&[];var z=[];return this._forEachCell(S,P,E,R,this._queryCellCircle,z,{hitTest:h,circle:{x:u,y:f,radius:l},seenUids:{box:{},circle:{}}},x),h?z.length>0:z},mi.prototype.query=function(u,f,l,h,x){return this._query(u,f,l,h,!1,x)},mi.prototype.hitTest=function(u,f,l,h,x){return this._query(u,f,l,h,!0,x)},mi.prototype.hitTestCircle=function(u,f,l,h){return this._queryCircle(u,f,l,!0,h)},mi.prototype._queryCell=function(u,f,l,h,x,S,E,P){var R=E.seenUids,z=this.boxCells[x];if(z!==null)for(var j=this.bboxes,ee=0,ne=z;ee<ne.length;ee+=1){var Ae=ne[ee];if(!R.box[Ae]){R.box[Ae]=!0;var Se=4*Ae;if(u<=j[Se+2]&&f<=j[Se+3]&&l>=j[Se+0]&&h>=j[Se+1]&&(!P||P(this.boxKeys[Ae]))){if(E.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ae],x1:j[Se],y1:j[Se+1],x2:j[Se+2],y2:j[Se+3]})}}}var De=this.circleCells[x];if(De!==null)for(var ge=this.circles,Fe=0,Ge=De;Fe<Ge.length;Fe+=1){var at=Ge[Fe];if(!R.circle[at]){R.circle[at]=!0;var Ct=3*at;if(this._circleAndRectCollide(ge[Ct],ge[Ct+1],ge[Ct+2],u,f,l,h)&&(!P||P(this.circleKeys[at]))){if(E.hitTest)return S.push(!0),!0;var wt=ge[Ct],At=ge[Ct+1],Yt=ge[Ct+2];S.push({key:this.circleKeys[at],x1:wt-Yt,y1:At-Yt,x2:wt+Yt,y2:At+Yt})}}}},mi.prototype._queryCellCircle=function(u,f,l,h,x,S,E,P){var R=E.circle,z=E.seenUids,j=this.boxCells[x];if(j!==null)for(var ee=this.bboxes,ne=0,Ae=j;ne<Ae.length;ne+=1){var Se=Ae[ne];if(!z.box[Se]){z.box[Se]=!0;var De=4*Se;if(this._circleAndRectCollide(R.x,R.y,R.radius,ee[De+0],ee[De+1],ee[De+2],ee[De+3])&&(!P||P(this.boxKeys[Se])))return S.push(!0),!0}}var ge=this.circleCells[x];if(ge!==null)for(var Fe=this.circles,Ge=0,at=ge;Ge<at.length;Ge+=1){var Ct=at[Ge];if(!z.circle[Ct]){z.circle[Ct]=!0;var wt=3*Ct;if(this._circlesCollide(Fe[wt],Fe[wt+1],Fe[wt+2],R.x,R.y,R.radius)&&(!P||P(this.circleKeys[Ct])))return S.push(!0),!0}}},mi.prototype._forEachCell=function(u,f,l,h,x,S,E,P){for(var R=this._convertToXCellCoord(u),z=this._convertToYCellCoord(f),j=this._convertToXCellCoord(l),ee=this._convertToYCellCoord(h),ne=R;ne<=j;ne++)for(var Ae=z;Ae<=ee;Ae++)if(x.call(this,u,f,l,h,this.xCellCount*Ae+ne,S,E,P))return},mi.prototype._convertToXCellCoord=function(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))},mi.prototype._convertToYCellCoord=function(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))},mi.prototype._circlesCollide=function(u,f,l,h,x,S){var E=h-u,P=x-f,R=l+S;return R*R>E*E+P*P},mi.prototype._circleAndRectCollide=function(u,f,l,h,x,S,E){var P=(S-h)/2,R=Math.abs(u-(h+P));if(R>P+l)return!1;var z=(E-x)/2,j=Math.abs(f-(x+z));if(j>z+l)return!1;if(R<=P||j<=z)return!0;var ee=R-P,ne=j-z;return ee*ee+ne*ne<=l*l};var Wa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ca(u,f){for(var l=0;l<u;l++){var h=f.length;f.resize(h+4),f.float32.set(Wa,3*h)}}function ua(u,f,l){var h=f[0],x=f[1];return u[0]=l[0]*h+l[4]*x+l[12],u[1]=l[1]*h+l[5]*x+l[13],u[3]=l[3]*h+l[7]*x+l[15],u}var vo=function(u,f,l){f===void 0&&(f=new mi(u.width+200,u.height+200,25)),l===void 0&&(l=new mi(u.width+200,u.height+200,25)),this.transform=u,this.grid=f,this.ignoredGrid=l,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+100,this.screenBottomBoundary=u.height+100,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200};function wi(u,f,l){return f*(v.EXTENT/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}vo.prototype.placeCollisionBox=function(u,f,l,h,x){var S=this.projectAndGetPerspectiveRatio(h,u.anchorPointX,u.anchorPointY),E=l*S.perspectiveRatio,P=u.x1*E+S.point.x,R=u.y1*E+S.point.y,z=u.x2*E+S.point.x,j=u.y2*E+S.point.y;return!this.isInsideGrid(P,R,z,j)||!f&&this.grid.hitTest(P,R,z,j,x)?{box:[],offscreen:!1}:{box:[P,R,z,j],offscreen:this.isOffscreen(P,R,z,j)}},vo.prototype.placeCollisionCircles=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne){var Ae=[],Se=new v.Point(f.anchorX,f.anchorY),De=zn(Se,S),ge=Jn(this.transform.cameraToCenterDistance,De.signedDistanceFromCamera),Fe=(z?x/ge:x*ge)/v.ONE_EM,Ge=zn(Se,E).point,at=Bi(Fe,h,f.lineOffsetX*Fe,f.lineOffsetY*Fe,!1,Ge,Se,f,l,E,{}),Ct=!1,wt=!1,At=!0;if(at){for(var Yt=.5*ee*ge+ne,br=new v.Point(-100,-100),pr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),Fr=new Ea,rn=at.first,fn=at.last,cn=[],hi=rn.path.length-1;hi>=1;hi--)cn.push(rn.path[hi]);for(var gr=1;gr<fn.path.length;gr++)cn.push(fn.path[gr]);var Jr=2.5*Yt;if(P){var kn=cn.map(function(Mo){return zn(Mo,P)});cn=kn.some(function(Mo){return Mo.signedDistanceFromCamera<=0})?[]:kn.map(function(Mo){return Mo.point})}var wn=[];if(cn.length>0){for(var vn=cn[0].clone(),Zn=cn[0].clone(),Sn=1;Sn<cn.length;Sn++)vn.x=Math.min(vn.x,cn[Sn].x),vn.y=Math.min(vn.y,cn[Sn].y),Zn.x=Math.max(Zn.x,cn[Sn].x),Zn.y=Math.max(Zn.y,cn[Sn].y);wn=vn.x>=br.x&&Zn.x<=pr.x&&vn.y>=br.y&&Zn.y<=pr.y?[cn]:Zn.x<br.x||vn.x>pr.x||Zn.y<br.y||vn.y>pr.y?[]:v.clipLine([cn],br.x,br.y,pr.x,pr.y)}for(var _n=0,Ba=wn;_n<Ba.length;_n+=1){var Wi;Fr.reset(Ba[_n],.25*Yt),Wi=Fr.length<=.5*Yt?1:Math.ceil(Fr.paddedLength/Jr)+1;for(var Gi=0;Gi<Wi;Gi++){var no=Gi/Math.max(Wi-1,1),ra=Fr.lerp(no),_a=ra.x+100,Na=ra.y+100;Ae.push(_a,Na,Yt,0);var io=_a-Yt,Cs=Na-Yt,fo=_a+Yt,Jo=Na+Yt;if(At=At&&this.isOffscreen(io,Cs,fo,Jo),wt=wt||this.isInsideGrid(io,Cs,fo,Jo),!u&&this.grid.hitTestCircle(_a,Na,Yt,j)&&(Ct=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ct}}}}return{circles:!R&&Ct||!wt?[]:Ae,offscreen:At,collisionDetected:Ct}},vo.prototype.queryRenderedSymbols=function(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],l=1/0,h=1/0,x=-1/0,S=-1/0,E=0,P=u;E<P.length;E+=1){var R=P[E],z=new v.Point(R.x+100,R.y+100);l=Math.min(l,z.x),h=Math.min(h,z.y),x=Math.max(x,z.x),S=Math.max(S,z.y),f.push(z)}for(var j={},ee={},ne=0,Ae=this.grid.query(l,h,x,S).concat(this.ignoredGrid.query(l,h,x,S));ne<Ae.length;ne+=1){var Se=Ae[ne],De=Se.key;if(j[De.bucketInstanceId]===void 0&&(j[De.bucketInstanceId]={}),!j[De.bucketInstanceId][De.featureIndex]){var ge=[new v.Point(Se.x1,Se.y1),new v.Point(Se.x2,Se.y1),new v.Point(Se.x2,Se.y2),new v.Point(Se.x1,Se.y2)];v.polygonIntersectsPolygon(f,ge)&&(j[De.bucketInstanceId][De.featureIndex]=!0,ee[De.bucketInstanceId]===void 0&&(ee[De.bucketInstanceId]=[]),ee[De.bucketInstanceId].push(De.featureIndex))}}return ee},vo.prototype.insertCollisionBox=function(u,f,l,h,x){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:x},u[0],u[1],u[2],u[3])},vo.prototype.insertCollisionCircles=function(u,f,l,h,x){for(var S=f?this.ignoredGrid:this.grid,E={bucketInstanceId:l,featureIndex:h,collisionGroupID:x},P=0;P<u.length;P+=4)S.insertCircle(E,u[P],u[P+1],u[P+2])},vo.prototype.projectAndGetPerspectiveRatio=function(u,f,l){var h=[f,l,0,1];return ua(h,h,u),{point:new v.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},vo.prototype.isOffscreen=function(u,f,l,h){return l<100||u>=this.screenRightBoundary||h<100||f>this.screenBottomBoundary},vo.prototype.isInsideGrid=function(u,f,l,h){return l>=0&&u<this.gridRightBoundary&&h>=0&&f<this.gridBottomBoundary},vo.prototype.getViewportMatrix=function(){var u=v.identity([]);return v.translate(u,u,[-100,-100,0]),u};var mo=function(u,f,l,h){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?f:-f))):h&&l?1:0,this.placed=l};mo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Xa=function(u,f,l,h,x){this.text=new mo(u?u.text:null,f,l,x),this.icon=new mo(u?u.icon:null,f,h,x)};Xa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var So=function(u,f,l){this.text=u,this.icon=f,this.skipFade=l},Xo=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Lc=function(u,f,l,h,x){this.bucketInstanceId=u,this.featureIndex=f,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=x},Yo=function(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}};function Ta(u,f,l,h,x){var S=v.getAnchorAlignment(u),E=-(S.horizontalAlign-.5)*f,P=-(S.verticalAlign-.5)*l,R=v.evaluateVariableOffset(u,h);return new v.Point(E+R[0]*x,P+R[1]*x)}function va(u,f,l,h,x,S){var E=u.x1,P=u.x2,R=u.y1,z=u.y2,j=u.anchorPointX,ee=u.anchorPointY,ne=new v.Point(f,l);return h&&ne._rotate(x?S:-S),{x1:E+ne.x,y1:R+ne.y,x2:P+ne.x,y2:z+ne.y,anchorPointX:j,anchorPointY:ee}}Yo.prototype.get=function(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){var f=++this.maxGroupID;this.collisionGroups[u]={ID:f,predicate:function(l){return l.collisionGroupID===f}}}return this.collisionGroups[u]};var Ri=function(u,f,l,h){this.transform=u.clone(),this.collisionIndex=new vo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Yo(l),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function K(u,f,l,h,x){u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0)}Ri.prototype.getBucketParts=function(u,f,l,h){var x=l.getBucket(f),S=l.latestFeatureIndex;if(x&&S&&f.id===x.layerIds[0]){var E=l.collisionBoxArray,P=x.layers[0].layout,R=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/v.EXTENT,j=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),ee=P.get("text-pitch-alignment")==="map",ne=P.get("text-rotation-alignment")==="map",Ae=wi(l,1,this.transform.zoom),Se=Li(j,ee,ne,this.transform,Ae),De=null;if(ee){var ge=Wn(j,ee,ne,this.transform,Ae);De=v.multiply([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[x.bucketInstanceId]=new Lc(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,l.tileID);var Fe={bucket:x,layout:P,posMatrix:j,textLabelPlaneMatrix:Se,labelToScreenMatrix:De,scale:R,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(h)for(var Ge=0,at=x.sortKeyRanges;Ge<at.length;Ge+=1){var Ct=at[Ge];u.push({sortKey:Ct.sortKey,symbolInstanceStart:Ct.symbolInstanceStart,symbolInstanceEnd:Ct.symbolInstanceEnd,parameters:Fe})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}},Ri.prototype.attemptAnchorPlacement=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae,Se){var De,ge=[ee.textOffset0,ee.textOffset1],Fe=Ta(u,l,h,ge,x),Ge=this.collisionIndex.placeCollisionBox(va(f,Fe.x,Fe.y,S,E,this.transform.angle),j,P,R,z.predicate);if(!Se||this.collisionIndex.placeCollisionBox(va(Se,Fe.x,Fe.y,S,E,this.transform.angle),j,P,R,z.predicate).box.length!==0)return Ge.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(De=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),this.variableOffsets[ee.crossTileID]={textOffset:ge,width:l,height:h,anchor:u,textBoxScale:x,prevAnchor:De},this.markUsedJustification(ne,u,ee,Ae),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,Ae,ee),this.placedOrientations[ee.crossTileID]=Ae),{shift:Fe,placedGlyphBoxes:Ge}):void 0},Ri.prototype.placeLayerBucketPart=function(u,f,l){var h=this,x=u.parameters,S=x.bucket,E=x.layout,P=x.posMatrix,R=x.textLabelPlaneMatrix,z=x.labelToScreenMatrix,j=x.textPixelRatio,ee=x.holdingForFade,ne=x.collisionBoxArray,Ae=x.partiallyEvaluatedTextSize,Se=x.collisionGroup,De=E.get("text-optional"),ge=E.get("icon-optional"),Fe=E.get("text-allow-overlap"),Ge=E.get("icon-allow-overlap"),at=E.get("text-rotation-alignment")==="map",Ct=E.get("text-pitch-alignment")==="map",wt=E.get("icon-text-fit")!=="none",At=E.get("symbol-z-order")==="viewport-y",Yt=Fe&&(Ge||!S.hasIconData()||ge),br=Ge&&(Fe||!S.hasTextData()||De);!S.collisionArrays&&ne&&S.deserializeCollisionBoxes(ne);var pr=function(gr,Jr){if(!f[gr.crossTileID])if(ee)h.placements[gr.crossTileID]=new So(!1,!1,!1);else{var kn,wn=!1,vn=!1,Zn=!0,Sn=null,_n={box:null,offscreen:null},Ba={box:null,offscreen:null},Wi=null,Gi=null,no=0,ra=0,_a=0;Jr.textFeatureIndex?no=Jr.textFeatureIndex:gr.useRuntimeCollisionCircles&&(no=gr.featureIndex),Jr.verticalTextFeatureIndex&&(ra=Jr.verticalTextFeatureIndex);var Na=Jr.textBox;if(Na){var io=function(vi){var ao=v.WritingMode.horizontal;if(S.allowVerticalPlacement&&!vi&&h.prevPlacement){var oo=h.prevPlacement.placedOrientations[gr.crossTileID];oo&&(h.placedOrientations[gr.crossTileID]=oo,h.markUsedOrientation(S,ao=oo,gr))}return ao},Cs=function(vi,ao){if(S.allowVerticalPlacement&&gr.numVerticalGlyphVertices>0&&Jr.verticalTextBox)for(var oo=0,ds=S.writingModes;oo<ds.length&&(ds[oo]===v.WritingMode.vertical?(_n=ao(),Ba=_n):_n=vi(),!(_n&&_n.box&&_n.box.length));oo+=1);else _n=vi()};if(E.get("text-variable-anchor")){var fo=E.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[gr.crossTileID]){var Jo=h.prevPlacement.variableOffsets[gr.crossTileID];fo.indexOf(Jo.anchor)>0&&(fo=fo.filter(function(vi){return vi!==Jo.anchor})).unshift(Jo.anchor)}var Mo=function(vi,ao,oo){for(var ds=vi.x2-vi.x1,Wu=vi.y2-vi.y1,ou=gr.textBoxScale,Hl=wt&&!Ge?ao:null,Xu={box:[],offscreen:!1},gc=Fe?2*fo.length:fo.length,Us=0;Us<gc;++Us){var bl=h.attemptAnchorPlacement(fo[Us%fo.length],vi,ds,Wu,ou,at,Ct,j,P,Se,Us>=fo.length,gr,S,oo,Hl);if(bl&&(Xu=bl.placedGlyphBoxes)&&Xu.box&&Xu.box.length){wn=!0,Sn=bl.shift;break}}return Xu};Cs(function(){return Mo(Na,Jr.iconBox,v.WritingMode.horizontal)},function(){var vi=Jr.verticalTextBox;return S.allowVerticalPlacement&&!(_n&&_n.box&&_n.box.length)&&gr.numVerticalGlyphVertices>0&&vi?Mo(vi,Jr.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),_n&&(wn=_n.box,Zn=_n.offscreen);var ru=io(_n&&_n.box);if(!wn&&h.prevPlacement){var Gu=h.prevPlacement.variableOffsets[gr.crossTileID];Gu&&(h.variableOffsets[gr.crossTileID]=Gu,h.markUsedJustification(S,Gu.anchor,gr,ru))}}else{var nu=function(vi,ao){var oo=h.collisionIndex.placeCollisionBox(vi,Fe,j,P,Se.predicate);return oo&&oo.box&&oo.box.length&&(h.markUsedOrientation(S,ao,gr),h.placedOrientations[gr.crossTileID]=ao),oo};Cs(function(){return nu(Na,v.WritingMode.horizontal)},function(){var vi=Jr.verticalTextBox;return S.allowVerticalPlacement&&gr.numVerticalGlyphVertices>0&&vi?nu(vi,v.WritingMode.vertical):{box:null,offscreen:null}}),io(_n&&_n.box&&_n.box.length)}}if(wn=(kn=_n)&&kn.box&&kn.box.length>0,Zn=kn&&kn.offscreen,gr.useRuntimeCollisionCircles){var iu=S.text.placedSymbolArray.get(gr.centerJustifiedTextSymbolIndex),xl=v.evaluateSizeForFeature(S.textSizeData,Ae,iu),zs=E.get("text-padding");Wi=h.collisionIndex.placeCollisionCircles(Fe,iu,S.lineVertexArray,S.glyphOffsetArray,xl,P,R,z,l,Ct,Se.predicate,gr.collisionCircleDiameter,zs),wn=Fe||Wi.circles.length>0&&!Wi.collisionDetected,Zn=Zn&&Wi.offscreen}if(Jr.iconFeatureIndex&&(_a=Jr.iconFeatureIndex),Jr.iconBox){var Hu=function(vi){var ao=wt&&Sn?va(vi,Sn.x,Sn.y,at,Ct,h.transform.angle):vi;return h.collisionIndex.placeCollisionBox(ao,Ge,j,P,Se.predicate)};vn=Ba&&Ba.box&&Ba.box.length&&Jr.verticalIconBox?(Gi=Hu(Jr.verticalIconBox)).box.length>0:(Gi=Hu(Jr.iconBox)).box.length>0,Zn=Zn&&Gi.offscreen}var za=De||gr.numHorizontalGlyphVertices===0&&gr.numVerticalGlyphVertices===0,na=ge||gr.numIconVertices===0;if(za||na?na?za||(vn=vn&&wn):wn=vn&&wn:vn=wn=vn&&wn,wn&&kn&&kn.box&&h.collisionIndex.insertCollisionBox(kn.box,E.get("text-ignore-placement"),S.bucketInstanceId,Ba&&Ba.box&&ra?ra:no,Se.ID),vn&&Gi&&h.collisionIndex.insertCollisionBox(Gi.box,E.get("icon-ignore-placement"),S.bucketInstanceId,_a,Se.ID),Wi&&(wn&&h.collisionIndex.insertCollisionCircles(Wi.circles,E.get("text-ignore-placement"),S.bucketInstanceId,no,Se.ID),l)){var au=S.bucketInstanceId,Zs=h.collisionCircleArrays[au];Zs===void 0&&(Zs=h.collisionCircleArrays[au]=new Xo);for(var Uo=0;Uo<Wi.circles.length;Uo+=4)Zs.circles.push(Wi.circles[Uo+0]),Zs.circles.push(Wi.circles[Uo+1]),Zs.circles.push(Wi.circles[Uo+2]),Zs.circles.push(Wi.collisionDetected?1:0)}h.placements[gr.crossTileID]=new So(wn||Yt,vn||br,Zn||S.justReloaded),f[gr.crossTileID]=!0}};if(At)for(var Fr=S.getSortedSymbolIndexes(this.transform.angle),rn=Fr.length-1;rn>=0;--rn){var fn=Fr[rn];pr(S.symbolInstances.get(fn),S.collisionArrays[fn])}else for(var cn=u.symbolInstanceStart;cn<u.symbolInstanceEnd;cn++)pr(S.symbolInstances.get(cn),S.collisionArrays[cn]);if(l&&S.bucketInstanceId in this.collisionCircleArrays){var hi=this.collisionCircleArrays[S.bucketInstanceId];v.invert(hi.invProjMatrix,P),hi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Ri.prototype.markUsedJustification=function(u,f,l,h){var x;x=h===v.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var S=0,E=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];S<E.length;S+=1){var P=E[S];P>=0&&(u.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:l.crossTileID)}},Ri.prototype.markUsedOrientation=function(u,f,l){for(var h=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,x=f===v.WritingMode.vertical?f:0,S=0,E=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];S<E.length;S+=1)u.text.placedSymbolArray.get(E[S]).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=x)},Ri.prototype.commit=function(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,l=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var h=f?f.symbolFadeChange(u):1,x=f?f.opacities:{},S=f?f.variableOffsets:{},E=f?f.placedOrientations:{};for(var P in this.placements){var R=this.placements[P],z=x[P];z?(this.opacities[P]=new Xa(z,h,R.text,R.icon),l=l||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[P]=new Xa(null,h,R.text,R.icon,R.skipFade),l=l||R.text||R.icon)}for(var j in x){var ee=x[j];if(!this.opacities[j]){var ne=new Xa(ee,h,!1,!1);ne.isHidden()||(this.opacities[j]=ne,l=l||ee.text.placed||ee.icon.placed)}}for(var Ae in S)this.variableOffsets[Ae]||!this.opacities[Ae]||this.opacities[Ae].isHidden()||(this.variableOffsets[Ae]=S[Ae]);for(var Se in E)this.placedOrientations[Se]||!this.opacities[Se]||this.opacities[Se].isHidden()||(this.placedOrientations[Se]=E[Se]);l?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:u)},Ri.prototype.updateLayerOpacities=function(u,f){for(var l={},h=0,x=f;h<x.length;h+=1){var S=x[h],E=S.getBucket(u);E&&S.latestFeatureIndex&&u.id===E.layerIds[0]&&this.updateBucketOpacities(E,l,S.collisionBoxArray)}},Ri.prototype.updateBucketOpacities=function(u,f,l){var h=this;u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();var x=u.layers[0].layout,S=new Xa(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),R=x.get("text-variable-anchor"),z=x.get("text-rotation-alignment")==="map",j=x.get("text-pitch-alignment")==="map",ee=x.get("icon-text-fit")!=="none",ne=new Xa(null,0,E&&(P||!u.hasIconData()||x.get("icon-optional")),P&&(E||!u.hasTextData()||x.get("text-optional")),!0);!u.collisionArrays&&l&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(l);for(var Ae=function(Fe,Ge,at){for(var Ct=0;Ct<Ge/4;Ct++)Fe.opacityVertexArray.emplaceBack(at)},Se=function(Fe){var Ge=u.symbolInstances.get(Fe),at=Ge.numHorizontalGlyphVertices,Ct=Ge.numVerticalGlyphVertices,wt=Ge.crossTileID,At=h.opacities[wt];f[wt]?At=S:At||(h.opacities[wt]=At=ne),f[wt]=!0;var Yt=Ge.numIconVertices>0,br=h.placedOrientations[Ge.crossTileID],pr=br===v.WritingMode.vertical,Fr=br===v.WritingMode.horizontal||br===v.WritingMode.horizontalOnly;if(at>0||Ct>0){var rn=Ya(At.text);Ae(u.text,at,pr?Aa:rn),Ae(u.text,Ct,Fr?Aa:rn);var fn=At.text.isHidden();[Ge.rightJustifiedTextSymbolIndex,Ge.centerJustifiedTextSymbolIndex,Ge.leftJustifiedTextSymbolIndex].forEach(function(_n){_n>=0&&(u.text.placedSymbolArray.get(_n).hidden=fn||pr?1:0)}),Ge.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Ge.verticalPlacedTextSymbolIndex).hidden=fn||Fr?1:0);var cn=h.variableOffsets[Ge.crossTileID];cn&&h.markUsedJustification(u,cn.anchor,Ge,br);var hi=h.placedOrientations[Ge.crossTileID];hi&&(h.markUsedJustification(u,"left",Ge,hi),h.markUsedOrientation(u,hi,Ge))}if(Yt){var gr=Ya(At.icon),Jr=!(ee&&Ge.verticalPlacedIconSymbolIndex&&pr);Ge.placedIconSymbolIndex>=0&&(Ae(u.icon,Ge.numIconVertices,Jr?gr:Aa),u.icon.placedSymbolArray.get(Ge.placedIconSymbolIndex).hidden=At.icon.isHidden()),Ge.verticalPlacedIconSymbolIndex>=0&&(Ae(u.icon,Ge.numVerticalIconVertices,Jr?Aa:gr),u.icon.placedSymbolArray.get(Ge.verticalPlacedIconSymbolIndex).hidden=At.icon.isHidden())}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){var kn=u.collisionArrays[Fe];if(kn){var wn=new v.Point(0,0);if(kn.textBox||kn.verticalTextBox){var vn=!0;if(R){var Zn=h.variableOffsets[wt];Zn?(wn=Ta(Zn.anchor,Zn.width,Zn.height,Zn.textOffset,Zn.textBoxScale),z&&wn._rotate(j?h.transform.angle:-h.transform.angle)):vn=!1}kn.textBox&&K(u.textCollisionBox.collisionVertexArray,At.text.placed,!vn||pr,wn.x,wn.y),kn.verticalTextBox&&K(u.textCollisionBox.collisionVertexArray,At.text.placed,!vn||Fr,wn.x,wn.y)}var Sn=Boolean(!Fr&&kn.verticalIconBox);kn.iconBox&&K(u.iconCollisionBox.collisionVertexArray,At.icon.placed,Sn,ee?wn.x:0,ee?wn.y:0),kn.verticalIconBox&&K(u.iconCollisionBox.collisionVertexArray,At.icon.placed,!Sn,ee?wn.x:0,ee?wn.y:0)}}},De=0;De<u.symbolInstances.length;De++)Se(De);if(u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){var ge=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=ge.invProjMatrix,u.placementViewportMatrix=ge.viewportMatrix,u.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}},Ri.prototype.symbolFadeChange=function(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ri.prototype.zoomAdjustment=function(u){return Math.max(0,(this.transform.zoom-u)/1.5)},Ri.prototype.hasTransitions=function(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration},Ri.prototype.stillRecent=function(u,f){var l=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*l>u},Ri.prototype.setStale=function(){this.stale=!0};var he=Math.pow(2,25),je=Math.pow(2,24),It=Math.pow(2,17),xr=Math.pow(2,16),an=Math.pow(2,9),yi=Math.pow(2,8),ma=Math.pow(2,1);function Ya(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;var f=u.placed?1:0,l=Math.floor(127*u.opacity);return l*he+f*je+l*It+f*xr+l*an+f*yi+l*ma+f}var Aa=0,qo=function(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};qo.prototype.continuePlacement=function(u,f,l,h,x){for(var S=this._bucketParts;this._currentTileIndex<u.length;)if(f.getBucketParts(S,h,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(E,P){return E.sortKey-P.sortKey}));this._currentPartIndex<S.length;)if(f.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,x())return!0;return!1};var ac=function(u,f,l,h,x,S,E){this.placement=new Ri(u,x,S,E),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1};ac.prototype.isDone=function(){return this._done},ac.prototype.continuePlacement=function(u,f,l){for(var h=this,x=v.browser.now(),S=function(){var R=v.browser.now()-x;return!h._forceFullPlacement&&R>2};this._currentPlacementIndex>=0;){var E=f[u[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=P)&&(!E.maxzoom||E.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new qo(E)),this._inProgressLayer.continuePlacement(l[E.source],this.placement,this._showCollisionBoxes,E,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},ac.prototype.commit=function(u){return this.placement.commit(u),this.placement};var vf=512/v.EXTENT/2,Rc=function(u,f,l){this.tileID=u,this.indexedSymbolInstances={},this.bucketInstanceId=l;for(var h=0;h<f.length;h++){var x=f.get(h),S=x.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,u)})}};Rc.prototype.getScaledCoordinates=function(u,f){var l=vf/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+u.anchorX)*l),y:Math.floor((f.canonical.y*v.EXTENT+u.anchorY)*l)}},Rc.prototype.findMatches=function(u,f,l){for(var h=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),x=0;x<u.length;x++){var S=u.get(x);if(!S.crossTileID){var E=this.indexedSymbolInstances[S.key];if(E)for(var P=this.getScaledCoordinates(S,f),R=0,z=E;R<z.length;R+=1){var j=z[R];if(Math.abs(j.coord.x-P.x)<=h&&Math.abs(j.coord.y-P.y)<=h&&!l[j.crossTileID]){l[j.crossTileID]=!0,S.crossTileID=j.crossTileID;break}}}}};var os=function(){this.maxCrossTileID=0};os.prototype.generate=function(){return++this.maxCrossTileID};var Lu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Lu.prototype.handleWrapJump=function(u){var f=Math.round((u-this.lng)/360);if(f!==0)for(var l in this.indexes){var h=this.indexes[l],x={};for(var S in h){var E=h[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),x[E.tileID.key]=E}this.indexes[l]=x}this.lng=u},Lu.prototype.addBucket=function(u,f,l){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(var h=0;h<f.symbolInstances.length;h++)f.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});var x=this.usedCrossTileIDs[u.overscaledZ];for(var S in this.indexes){var E=this.indexes[S];if(Number(S)>u.overscaledZ)for(var P in E){var R=E[P];R.tileID.isChildOf(u)&&R.findMatches(f.symbolInstances,u,x)}else{var z=E[u.scaledTo(Number(S)).key];z&&z.findMatches(f.symbolInstances,u,x)}}for(var j=0;j<f.symbolInstances.length;j++){var ee=f.symbolInstances.get(j);ee.crossTileID||(ee.crossTileID=l.generate(),x[ee.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Rc(u,f.symbolInstances,f.bucketInstanceId),!0},Lu.prototype.removeBucketCrossTileIDs=function(u,f){for(var l in f.indexedSymbolInstances)for(var h=0,x=f.indexedSymbolInstances[l];h<x.length;h+=1)delete this.usedCrossTileIDs[u][x[h].crossTileID]},Lu.prototype.removeStaleBuckets=function(u){var f=!1;for(var l in this.indexes){var h=this.indexes[l];for(var x in h)u[h[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[x]),delete h[x],f=!0)}return f};var ss=function(){this.layerIndexes={},this.crossTileIDs=new os,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ss.prototype.addLayer=function(u,f,l){var h=this.layerIndexes[u.id];h===void 0&&(h=this.layerIndexes[u.id]=new Lu);var x=!1,S={};h.handleWrapJump(l);for(var E=0,P=f;E<P.length;E+=1){var R=P[E],z=R.getBucket(u);z&&u.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(R.tileID,z,this.crossTileIDs)&&(x=!0),S[z.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(x=!0),x},ss.prototype.pruneUnusedLayers=function(u){var f={};for(var l in u.forEach(function(h){f[h]=!0}),this.layerIndexes)f[l]||delete this.layerIndexes[l]};var ol=function(u,f){return v.emitValidationErrors(u,f&&f.filter(function(l){return l.identifier!=="source.canvas"}))},pu=v.pick(Pr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),gs=v.pick(Pr,["setCenter","setZoom","setBearing","setPitch"]),kl=function(){var u={},f=v.styleSpec.$version;for(var l in v.styleSpec.$root){var h,x=v.styleSpec.$root[l];x.required&&(h=l==="version"?f:x.type==="array"?[]:{})!=null&&(u[l]=h)}return u}(),Eo=function(u){function f(l,h){var x=this;h===void 0&&(h={}),u.call(this),this.map=l,this.dispatcher=new kt(Rt(),this),this.imageManager=new Gt,this.imageManager.setEventedParent(this),this.glyphManager=new Ft(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ye(256,512),this.crossTileSymbolIndex=new ss,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var S=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(E){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},function(P,R){if(v.triggerPluginCompletionEvent(P),R&&R.every(function(j){return j}))for(var z in S.sourceCaches)S.sourceCaches[z].reload()})}),this.on("data",function(E){if(E.dataType==="source"&&E.sourceDataType==="metadata"){var P=x.sourceCaches[E.sourceId];if(P){var R=P.getSource();if(R&&R.vectorLayerIds)for(var z in x._layers){var j=x._layers[z];j.source===R.id&&x._validateLayer(j)}}}})}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.loadURL=function(l,h){var x=this;h===void 0&&(h={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!v.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,h.accessToken);var E=this.map._requestManager.transformRequest(l,v.ResourceType.Style);this._request=v.getJSON(E,function(P,R){x._request=null,P?x.fire(new v.ErrorEvent(P)):R&&x._load(R,S)})},f.prototype.loadJSON=function(l,h){var x=this;h===void 0&&(h={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){x._request=null,x._load(l,h.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(kl,!1)},f.prototype._load=function(l,h){if(!h||!ol(this,v.validateStyle(l))){for(var x in this._loaded=!0,this.stylesheet=l,l.sources)this.addSource(x,l.sources[x],{validate:!1});l.sprite?this._loadSprite(l.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(l.glyphs);var S=Ir(this.stylesheet.layers);this._order=S.map(function(z){return z.id}),this._layers={},this._serializedLayers={};for(var E=0,P=S;E<P.length;E+=1){var R=P[E];(R=v.createStyleLayer(R)).setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R,this._serializedLayers[R.id]=R.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ut(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(l){var h=this;this._spriteRequest=function(x,S,E){var P,R,z,j=v.browser.devicePixelRatio>1?"@2x":"",ee=v.getJSON(S.transformRequest(S.normalizeSpriteURL(x,j,".json"),v.ResourceType.SpriteJSON),function(Se,De){ee=null,z||(z=Se,P=De,Ae())}),ne=v.getImage(S.transformRequest(S.normalizeSpriteURL(x,j,".png"),v.ResourceType.SpriteImage),function(Se,De){ne=null,z||(z=Se,R=De,Ae())});function Ae(){if(z)E(z);else if(P&&R){var Se=v.browser.getImageData(R),De={};for(var ge in P){var Fe=P[ge],Ge=Fe.width,at=Fe.height,Ct=Fe.x,wt=Fe.y,At=Fe.sdf,Yt=Fe.pixelRatio,br=Fe.stretchX,pr=Fe.stretchY,Fr=Fe.content,rn=new v.RGBAImage({width:Ge,height:at});v.RGBAImage.copy(Se,rn,{x:Ct,y:wt},{x:0,y:0},{width:Ge,height:at}),De[ge]={data:rn,pixelRatio:Yt,sdf:At,stretchX:br,stretchY:pr,content:Fr}}E(null,De)}}return{cancel:function(){ee&&(ee.cancel(),ee=null),ne&&(ne.cancel(),ne=null)}}}(l,this.map._requestManager,function(x,S){if(h._spriteRequest=null,x)h.fire(new v.ErrorEvent(x));else if(S)for(var E in S)h.imageManager.addImage(E,S[E]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(l){var h=this.sourceCaches[l.source];if(h){var x=l.sourceLayer;if(x){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(x)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+x+'" does not exist on source "'+S.id+'" as specified by style layer "'+l.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(l){for(var h=[],x=0,S=l;x<S.length;x+=1){var E=this._layers[S[x]];E.type!=="custom"&&h.push(E.serialize())}return h},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(l){if(this._loaded){var h=this._changed;if(this._changed){var x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var E in(x.length||S.length)&&this._updateWorkerLayers(x,S),this._updatedSources){var P=this._updatedSources[E];P==="reload"?this._reloadSource(E):P==="clear"&&this._clearSource(E)}for(var R in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[R].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}var z={};for(var j in this.sourceCaches){var ee=this.sourceCaches[j];z[j]=ee.used,ee.used=!1}for(var ne=0,Ae=this._order;ne<Ae.length;ne+=1){var Se=this._layers[Ae[ne]];Se.recalculate(l,this._availableImages),!Se.isHidden(l.zoom)&&Se.source&&(this.sourceCaches[Se.source].used=!0)}for(var De in z){var ge=this.sourceCaches[De];z[De]!==ge.used&&ge.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:De}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var l=Object.keys(this._changedImages);if(l.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}},f.prototype._updateWorkerLayers=function(l,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:h})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(l){var h=this;if(this._checkLoaded(),ol(this,v.validateStyle(l)))return!1;(l=v.clone$1(l)).layers=Ir(l.layers);var x=function(E,P){if(!E)return[{command:Pr.setStyle,args:[P]}];var R=[];try{if(!v.deepEqual(E.version,P.version))return[{command:Pr.setStyle,args:[P]}];v.deepEqual(E.center,P.center)||R.push({command:Pr.setCenter,args:[P.center]}),v.deepEqual(E.zoom,P.zoom)||R.push({command:Pr.setZoom,args:[P.zoom]}),v.deepEqual(E.bearing,P.bearing)||R.push({command:Pr.setBearing,args:[P.bearing]}),v.deepEqual(E.pitch,P.pitch)||R.push({command:Pr.setPitch,args:[P.pitch]}),v.deepEqual(E.sprite,P.sprite)||R.push({command:Pr.setSprite,args:[P.sprite]}),v.deepEqual(E.glyphs,P.glyphs)||R.push({command:Pr.setGlyphs,args:[P.glyphs]}),v.deepEqual(E.transition,P.transition)||R.push({command:Pr.setTransition,args:[P.transition]}),v.deepEqual(E.light,P.light)||R.push({command:Pr.setLight,args:[P.light]});var z={},j=[];(function(ne,Ae,Se,De){var ge;for(ge in Ae=Ae||{},ne=ne||{})ne.hasOwnProperty(ge)&&(Ae.hasOwnProperty(ge)||Lr(ge,Se,De));for(ge in Ae)Ae.hasOwnProperty(ge)&&(ne.hasOwnProperty(ge)?v.deepEqual(ne[ge],Ae[ge])||(ne[ge].type==="geojson"&&Ae[ge].type==="geojson"&&li(ne,Ae,ge)?Se.push({command:Pr.setGeoJSONSourceData,args:[ge,Ae[ge].data]}):Un(ge,Ae,Se,De)):Bn(ge,Ae,Se))})(E.sources,P.sources,j,z);var ee=[];E.layers&&E.layers.forEach(function(ne){z[ne.source]?R.push({command:Pr.removeLayer,args:[ne.id]}):ee.push(ne)}),R=R.concat(j),function(ne,Ae,Se){Ae=Ae||[];var De,ge,Fe,Ge,at,Ct,wt,At=(ne=ne||[]).map(Pn),Yt=Ae.map(Pn),br=ne.reduce(jn,{}),pr=Ae.reduce(jn,{}),Fr=At.slice(),rn=Object.create(null);for(De=0,ge=0;De<At.length;De++)pr.hasOwnProperty(Fe=At[De])?ge++:(Se.push({command:Pr.removeLayer,args:[Fe]}),Fr.splice(Fr.indexOf(Fe,ge),1));for(De=0,ge=0;De<Yt.length;De++)Fr[Fr.length-1-De]!==(Fe=Yt[Yt.length-1-De])&&(br.hasOwnProperty(Fe)?(Se.push({command:Pr.removeLayer,args:[Fe]}),Fr.splice(Fr.lastIndexOf(Fe,Fr.length-ge),1)):ge++,Se.push({command:Pr.addLayer,args:[pr[Fe],Ct=Fr[Fr.length-De]]}),Fr.splice(Fr.length-De,0,Fe),rn[Fe]=!0);for(De=0;De<Yt.length;De++)if(Ge=br[Fe=Yt[De]],at=pr[Fe],!rn[Fe]&&!v.deepEqual(Ge,at))if(v.deepEqual(Ge.source,at.source)&&v.deepEqual(Ge["source-layer"],at["source-layer"])&&v.deepEqual(Ge.type,at.type)){for(wt in Nn(Ge.layout,at.layout,Se,Fe,null,Pr.setLayoutProperty),Nn(Ge.paint,at.paint,Se,Fe,null,Pr.setPaintProperty),v.deepEqual(Ge.filter,at.filter)||Se.push({command:Pr.setFilter,args:[Fe,at.filter]}),v.deepEqual(Ge.minzoom,at.minzoom)&&v.deepEqual(Ge.maxzoom,at.maxzoom)||Se.push({command:Pr.setLayerZoomRange,args:[Fe,at.minzoom,at.maxzoom]}),Ge)Ge.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Nn(Ge[wt],at[wt],Se,Fe,wt.slice(6),Pr.setPaintProperty):v.deepEqual(Ge[wt],at[wt])||Se.push({command:Pr.setLayerProperty,args:[Fe,wt,at[wt]]}));for(wt in at)at.hasOwnProperty(wt)&&!Ge.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?Nn(Ge[wt],at[wt],Se,Fe,wt.slice(6),Pr.setPaintProperty):v.deepEqual(Ge[wt],at[wt])||Se.push({command:Pr.setLayerProperty,args:[Fe,wt,at[wt]]}))}else Se.push({command:Pr.removeLayer,args:[Fe]}),Ct=Fr[Fr.lastIndexOf(Fe)+1],Se.push({command:Pr.addLayer,args:[at,Ct]})}(ee,P.layers,R)}catch(ne){console.warn("Unable to compute style diff:",ne),R=[{command:Pr.setStyle,args:[P]}]}return R}(this.serialize(),l).filter(function(E){return!(E.command in gs)});if(x.length===0)return!1;var S=x.filter(function(E){return!(E.command in pu)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(E){return E.command}).join(", ")+".");return x.forEach(function(E){E.command!=="setTransition"&&h[E.command].apply(h,E.args)}),this.stylesheet=l,!0},f.prototype.addImage=function(l,h){if(this.getImage(l))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(l,h),this._afterImageUpdated(l)},f.prototype.updateImage=function(l,h){this.imageManager.updateImage(l,h)},f.prototype.getImage=function(l){return this.imageManager.getImage(l)},f.prototype.removeImage=function(l){if(!this.getImage(l))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(l),this._afterImageUpdated(l)},f.prototype._afterImageUpdated=function(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(l,h,x){var S=this;if(x===void 0&&(x={}),this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(v.validateStyle.source,"sources."+l,h,null,x))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var E=this.sourceCaches[l]=new Pe(l,h,this.dispatcher);E.style=this,E.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:E.serialize(),sourceId:l}}),E.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===l)return this.fire(new v.ErrorEvent(new Error('Source "'+l+'" cannot be removed while layer "'+h+'" is using it.')));var x=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],x.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),x.setEventedParent(null),x.clearTiles(),x.onRemove&&x.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(l,h){this._checkLoaded(),this.sourceCaches[l].getSource().setData(h),this._changed=!0},f.prototype.getSource=function(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()},f.prototype.addLayer=function(l,h,x){x===void 0&&(x={}),this._checkLoaded();var S=l.id;if(this.getLayer(S))this.fire(new v.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var E;if(l.type==="custom"){if(ol(this,v.validateCustomStyleLayer(l)))return;E=v.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(S,l.source),l=v.clone$1(l),l=v.extend(l,{source:S})),this._validate(v.validateStyle.layer,"layers."+S,l,{arrayIndex:-1},x))return;E=v.createStyleLayer(l),this._validateLayer(E),E.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[E.id]=E.serialize()}var P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(P,0,S),this._layerOrderChanged=!0,this._layers[S]=E,this._removedLayers[S]&&E.source&&E.type!=="custom"){var R=this._removedLayers[S];delete this._removedLayers[S],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}},f.prototype.moveLayer=function(l,h){if(this._checkLoaded(),this._changed=!0,this._layers[l]){if(l!==h){var x=this._order.indexOf(l);this._order.splice(x,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,l),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(l){this._checkLoaded();var h=this._layers[l];if(h){h.setEventedParent(null);var x=this._order.indexOf(l);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(l){return this._layers[l]},f.prototype.hasLayer=function(l){return l in this._layers},f.prototype.setLayerZoomRange=function(l,h,x){this._checkLoaded();var S=this.getLayer(l);S?S.minzoom===h&&S.maxzoom===x||(h!=null&&(S.minzoom=h),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(l,h,x){x===void 0&&(x={}),this._checkLoaded();var S=this.getLayer(l);if(S){if(!v.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(v.validateStyle.filter,"layers."+S.id+".filter",h,null,x)||(S.filter=v.clone$1(h),this._updateLayer(S)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(l){return v.clone$1(this.getLayer(l).filter)},f.prototype.setLayoutProperty=function(l,h,x,S){S===void 0&&(S={}),this._checkLoaded();var E=this.getLayer(l);E?v.deepEqual(E.getLayoutProperty(h),x)||(E.setLayoutProperty(h,x,S),this._updateLayer(E)):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(l,h){var x=this.getLayer(l);if(x)return x.getLayoutProperty(h);this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(l,h,x,S){S===void 0&&(S={}),this._checkLoaded();var E=this.getLayer(l);E?v.deepEqual(E.getPaintProperty(h),x)||(E.setPaintProperty(h,x,S)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(l,h){return this.getLayer(l).getPaintProperty(h)},f.prototype.setFeatureState=function(l,h){this._checkLoaded();var x=l.source,S=l.sourceLayer,E=this.sourceCaches[x];if(E!==void 0){var P=E.getSource().type;P==="geojson"&&S?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||S?(l.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),E.setFeatureState(S,l.id,h)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(l,h){this._checkLoaded();var x=l.source,S=this.sourceCaches[x];if(S!==void 0){var E=S.getSource().type,P=E==="vector"?l.sourceLayer:void 0;E!=="vector"||P?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(P,l.id,h):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(l){this._checkLoaded();var h=l.source,x=l.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||x)return l.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(x,l.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(l){return l.serialize()}),layers:this._serializeLayers(this._order)},function(l){return l!==void 0})},f.prototype._updateLayer=function(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(l){for(var h=this,x=function(br){return h._layers[br].type==="fill-extrusion"},S={},E=[],P=this._order.length-1;P>=0;P--){var R=this._order[P];if(x(R)){S[R]=P;for(var z=0,j=l;z<j.length;z+=1){var ee=j[z][R];if(ee)for(var ne=0,Ae=ee;ne<Ae.length;ne+=1)E.push(Ae[ne])}}}E.sort(function(br,pr){return pr.intersectionZ-br.intersectionZ});for(var Se=[],De=this._order.length-1;De>=0;De--){var ge=this._order[De];if(x(ge))for(var Fe=E.length-1;Fe>=0;Fe--){var Ge=E[Fe].feature;if(S[Ge.layer.id]<De)break;Se.push(Ge),E.pop()}else for(var at=0,Ct=l;at<Ct.length;at+=1){var wt=Ct[at][ge];if(wt)for(var At=0,Yt=wt;At<Yt.length;At+=1)Se.push(Yt[At].feature)}}return Se},f.prototype.queryRenderedFeatures=function(l,h,x){h&&h.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var E=0,P=h.layers;E<P.length;E+=1){var R=P[E],z=this._layers[R];if(!z)return this.fire(new v.ErrorEvent(new Error("The layer '"+R+"' does not exist in the map's style and cannot be queried for features."))),[];S[z.source]=!0}}var j=[];for(var ee in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[ee]||j.push(qr(this.sourceCaches[ee],this._layers,this._serializedLayers,l,h,x));return this.placement&&j.push(function(ne,Ae,Se,De,ge,Fe,Ge){for(var at={},Ct=Fe.queryRenderedSymbols(De),wt=[],At=0,Yt=Object.keys(Ct).map(Number);At<Yt.length;At+=1)wt.push(Ge[Yt[At]]);wt.sort(Si);for(var br=function(){var cn=Fr[pr],hi=cn.featureIndex.lookupSymbolFeatures(Ct[cn.bucketInstanceId],Ae,cn.bucketIndex,cn.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,ne);for(var gr in hi){var Jr=at[gr]=at[gr]||[],kn=hi[gr];kn.sort(function(Zn,Sn){var _n=cn.featureSortOrder;if(_n){var Ba=_n.indexOf(Zn.featureIndex);return _n.indexOf(Sn.featureIndex)-Ba}return Sn.featureIndex-Zn.featureIndex});for(var wn=0,vn=kn;wn<vn.length;wn+=1)Jr.push(vn[wn])}},pr=0,Fr=wt;pr<Fr.length;pr+=1)br();var rn=function(cn){at[cn].forEach(function(hi){var gr=hi.feature,Jr=Se[ne[cn].source].getFeatureState(gr.layer["source-layer"],gr.id);gr.source=gr.layer.source,gr.layer["source-layer"]&&(gr.sourceLayer=gr.layer["source-layer"]),gr.state=Jr})};for(var fn in at)rn(fn);return at}(this._layers,this._serializedLayers,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)},f.prototype.querySourceFeatures=function(l,h){h&&h.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var x=this.sourceCaches[l];return x?function(S,E){for(var P=S.getRenderableIds().map(function(Ae){return S.getTileByID(Ae)}),R=[],z={},j=0;j<P.length;j++){var ee=P[j],ne=ee.tileID.canonical.key;z[ne]||(z[ne]=!0,ee.querySourceFeatures(R,E))}return R}(x,h):[]},f.prototype.addSourceType=function(l,h,x){return f.getSourceType(l)?x(new Error('A source type called "'+l+'" already exists.')):(f.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},x):x(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(l,h){h===void 0&&(h={}),this._checkLoaded();var x=this.light.getLight(),S=!1;for(var E in l)if(!v.deepEqual(l[E],x[E])){S=!0;break}if(S){var P={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(P)}},f.prototype._validate=function(l,h,x,S,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&ol(this,l.call(v.validateStyle,v.extend({key:h,style:this.serialize(),value:x,styleSpec:v.styleSpec},S)))},f.prototype._remove=function(){for(var l in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[l].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(l){this.sourceCaches[l].clearTiles()},f.prototype._reloadSource=function(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()},f.prototype._updateSources=function(l){for(var h in this.sourceCaches)this.sourceCaches[h].update(l)},f.prototype._generateCollisionBoxes=function(){for(var l in this.sourceCaches)this._reloadSource(l)},f.prototype._updatePlacement=function(l,h,x,S,E){E===void 0&&(E=!1);for(var P=!1,R=!1,z={},j=0,ee=this._order;j<ee.length;j+=1){var ne=this._layers[ee[j]];if(ne.type==="symbol"){if(!z[ne.source]){var Ae=this.sourceCaches[ne.source];z[ne.source]=Ae.getRenderableIds(!0).map(function(Ge){return Ae.getTileByID(Ge)}).sort(function(Ge,at){return at.tileID.overscaledZ-Ge.tileID.overscaledZ||(Ge.tileID.isLessThan(at.tileID)?-1:1)})}var Se=this.crossTileSymbolIndex.addLayer(ne,z[ne.source],l.center.lng);P=P||Se}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),l.zoom))&&(this.pauseablePlacement=new ac(l,this._order,E,h,x,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(var De=0,ge=this._order;De<ge.length;De+=1){var Fe=this._layers[ge[De]];Fe.type==="symbol"&&this.placement.updateLayerOpacities(Fe,z[Fe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()},f.prototype.getImages=function(l,h,x){this.imageManager.getImages(h.icons,x),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},f.prototype.getGlyphs=function(l,h,x){this.glyphManager.getGlyphs(h.stacks,x)},f.prototype.getResource=function(l,h,x){return v.makeRequest(h,x)},f}(v.Evented);Eo.getSourceType=function(u){return Et[u]},Eo.setSourceType=function(u,f){Et[u]=f},Eo.registerForPluginStateChange=v.registerForPluginStateChange;var la=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ll=Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Dc=Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),mf=Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),hu=Di(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),du=Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Fc=Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ii=Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vu=Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),qf=Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Kf=Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),$f=Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),oc=Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Rl=Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Jf=Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Yi=Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),yf=Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ru=Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Da=Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ds=Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Co=Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),mu=Di(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ko=Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),yu=Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),To=Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),sc=Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Qf=Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Di(u,f){var l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=f.match(/attribute ([\w]+) ([\w]+)/g),x=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=S?S.concat(x):x,P={};return{fragmentSource:u=u.replace(l,function(R,z,j,ee,ne){return P[ne]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
varying `+j+" "+ee+" "+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`}),vertexSource:f=f.replace(l,function(R,z,j,ee,ne){var Ae=ee==="float"?"vec2":"vec4",Se=ne.match(/color/)?"color":Ae;return P[ne]?z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
uniform lowp float u_`+ne+`_t;
attribute `+j+" "+Ae+" a_"+ne+`;
varying `+j+" "+ee+" "+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+ne+" = a_"+ne+`;
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+ne+" = unpack_mix_"+Se+"(a_"+ne+", u_"+ne+`_t);
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
uniform lowp float u_`+ne+`_t;
attribute `+j+" "+Ae+" a_"+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = a_"+ne+`;
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = unpack_mix_"+Se+"(a_"+ne+", u_"+ne+`_t);
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`}),staticAttributes:h,staticUniforms:E}}var Sp=Object.freeze({__proto__:null,prelude:Ll,background:Dc,backgroundPattern:mf,circle:hu,clippingMask:du,heatmap:Fc,heatmapTexture:Ii,collisionBox:vu,collisionCircle:qf,debug:Kf,fill:$f,fillOutline:oc,fillOutlinePattern:Rl,fillPattern:Jf,fillExtrusion:Yi,fillExtrusionPattern:yf,hillshadePrepare:Ru,hillshade:Da,line:Ds,lineGradient:Co,linePattern:mu,lineSDF:Ko,raster:yu,symbolIcon:To,symbolSDF:sc,symbolTextAndIcon:Qf}),uc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ep(u){for(var f=[],l=0;l<u.length;l++)if(u[l]!==null){var h=u[l].split(" ");f.push(h.pop())}return f}uc.prototype.bind=function(u,f,l,h,x,S,E,P){this.context=u;for(var R=this.boundPaintVertexBuffers.length!==h.length,z=0;!R&&z<h.length;z++)this.boundPaintVertexBuffers[z]!==h[z]&&(R=!0);u.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===l&&!R&&this.boundIndexBuffer===x&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===P?(u.bindVertexArrayOES.set(this.vao),E&&E.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(f,l,h,x,S,E,P)},uc.prototype.freshBind=function(u,f,l,h,x,S,E){var P,R=u.numAttributes,z=this.context,j=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=u,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=E;else{P=z.currentNumAttributes||0;for(var ee=R;ee<P;ee++)j.disableVertexAttribArray(ee)}f.enableAttributes(j,u);for(var ne=0,Ae=l;ne<Ae.length;ne+=1)Ae[ne].enableAttributes(j,u);S&&S.enableAttributes(j,u),E&&E.enableAttributes(j,u),f.bind(),f.setVertexAttribPointers(j,u,x);for(var Se=0,De=l;Se<De.length;Se+=1){var ge=De[Se];ge.bind(),ge.setVertexAttribPointers(j,u,x)}S&&(S.bind(),S.setVertexAttribPointers(j,u,x)),h&&h.bind(),E&&(E.bind(),E.setVertexAttribPointers(j,u,x)),z.currentNumAttributes=R},uc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var gf=function(u,f,l,h,x,S){var E=u.gl;this.program=E.createProgram();for(var P=ep(l.staticAttributes),R=h?h.getBinderAttributes():[],z=P.concat(R),j=l.staticUniforms?ep(l.staticUniforms):[],ee=h?h.getBinderUniforms():[],ne=[],Ae=0,Se=j.concat(ee);Ae<Se.length;Ae+=1){var De=Se[Ae];ne.indexOf(De)<0&&ne.push(De)}var ge=h?h.defines():[];S&&ge.push("#define OVERDRAW_INSPECTOR;");var Fe=ge.concat(Ll.fragmentSource,l.fragmentSource).join(`
`),Ge=ge.concat(Ll.vertexSource,l.vertexSource).join(`
`),at=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(at,Fe),E.compileShader(at),E.attachShader(this.program,at);var Ct=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Ct,Ge),E.compileShader(Ct),E.attachShader(this.program,Ct),this.attributes={};var wt={};this.numAttributes=z.length;for(var At=0;At<this.numAttributes;At++)z[At]&&(E.bindAttribLocation(this.program,At,z[At]),this.attributes[z[At]]=At);E.linkProgram(this.program),E.deleteShader(Ct),E.deleteShader(at);for(var Yt=0;Yt<ne.length;Yt++){var br=ne[Yt];if(br&&!wt[br]){var pr=E.getUniformLocation(this.program,br);pr&&(wt[br]=pr)}}this.fixedUniforms=x(u,wt),this.binderUniforms=h?h.getUniforms(u,wt):[]}}};function _f(u,f,l){var h=1/wi(l,1,f.transform.tileZoom),x=Math.pow(2,l.tileID.overscaledZ),S=l.tileSize*Math.pow(2,f.transform.tileZoom)/x,E=S*(l.tileID.canonical.x+l.tileID.wrap*x),P=S*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[h,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[E>>16,P>>16],u_pixel_coord_lower:[65535&E,65535&P]}}gf.prototype.draw=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae,Se,De){var ge,Fe=u.gl;if(!this.failedToCreate){for(var Ge in u.program.set(this.program),u.setDepthMode(l),u.setStencilMode(h),u.setColorMode(x),u.setCullFace(S),this.fixedUniforms)this.fixedUniforms[Ge].set(E[Ge]);Ae&&Ae.setUniforms(u,this.binderUniforms,ee,{zoom:ne});for(var at=(ge={},ge[Fe.LINES]=2,ge[Fe.TRIANGLES]=3,ge[Fe.LINE_STRIP]=1,ge)[f],Ct=0,wt=j.get();Ct<wt.length;Ct+=1){var At=wt[Ct],Yt=At.vaos||(At.vaos={});(Yt[P]||(Yt[P]=new uc)).bind(u,this,R,Ae?Ae.getPaintVertexBuffers():[],z,At.vertexOffset,Se,De),Fe.drawElements(f,At.primitiveLength*at,Fe.UNSIGNED_SHORT,At.primitiveOffset*at*2)}}};var ca=function(u,f,l,h){var x=f.style.light,S=x.properties.get("position"),E=[S.x,S.y,S.z],P=v.create$1();x.properties.get("anchor")==="viewport"&&v.fromRotation(P,-f.transform.angle),v.transformMat3(E,E,P);var R=x.properties.get("color");return{u_matrix:u,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+l,u_opacity:h}},gu=function(u,f,l,h,x,S,E){return v.extend(ca(u,f,l,h),_f(S,f,E),{u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8})},Du=function(u){return{u_matrix:u}},Ao=function(u,f,l,h){return v.extend(Du(u),_f(l,f,h))},Bc=function(u,f){return{u_matrix:u,u_world:f}},lc=function(u,f,l,h,x){return v.extend(Ao(u,f,l,h),{u_world:x})},_u=function(u,f,l,h){var x,S,E=u.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var P=wi(l,1,E.zoom);x=!0,S=[P,P]}else x=!1,S=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(f.posMatrix,l,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:S}},Ks=function(u,f,l){var h=wi(l,1,f.zoom),x=Math.pow(2,f.zoom-l.tileID.overscaledZ),S=l.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[f.pixelsToGLUnits[0]/(h*x),f.pixelsToGLUnits[1]/(h*x)],u_overscale_factor:S}},cc=function(u,f,l){return{u_matrix:u,u_inv_matrix:f,u_camera_to_center_distance:l.cameraToCenterDistance,u_viewport_size:[l.width,l.height]}},Fs=function(u,f,l){return l===void 0&&(l=1),{u_matrix:u,u_color:f,u_overlay:0,u_overlay_scale:l}},$s=function(u){return{u_matrix:u}},xf=function(u,f,l,h){return{u_matrix:u,u_extrude_scale:wi(f,1,l),u_intensity:h}},sl=function(u,f,l){var h=u.transform;return{u_matrix:rp(u,f,l),u_ratio:1/wi(f,1,h.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ni=function(u,f,l,h){return v.extend(sl(u,f,l),{u_image:0,u_image_height:h})},Nc=function(u,f,l,h){var x=u.transform,S=Dl(f,x);return{u_matrix:rp(u,f,l),u_texsize:f.imageAtlasTexture.size,u_ratio:1/wi(f,1,x.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},tp=function(u,f,l,h,x){var S=u.lineAtlas,E=Dl(f,u.transform),P=l.layout.get("line-cap")==="round",R=S.getDash(h.from,P),z=S.getDash(h.to,P),j=R.width*x.fromScale,ee=z.width*x.toScale;return v.extend(sl(u,f,l),{u_patternscale_a:[E/j,-R.height/2],u_patternscale_b:[E/ee,-z.height/2],u_sdfgamma:S.width/(256*Math.min(j,ee)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:z.y,u_mix:x.t})};function Dl(u,f){return 1/wi(u,1,f.tileZoom)}function rp(u,f,l){return u.translatePosMatrix(f.tileID.posMatrix,f,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}var bf=function(u,f,l,h,x){return{u_matrix:u,u_tl_parent:f,u_scale_parent:l,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(E=x.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ul(x.paint.get("raster-hue-rotate"))};var S,E};function ul(u){u*=Math.PI/180;var f=Math.sin(u),l=Math.cos(u);return[(2*l+1)/3,(-Math.sqrt(3)*f-l+1)/3,(Math.sqrt(3)*f-l+1)/3]}var Fl,Fu=function(u,f,l,h,x,S,E,P,R,z){var j=x.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:j.width/j.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:E,u_coord_matrix:P,u_is_text:+R,u_pitch_with_map:+h,u_texsize:z,u_texture:0}},Bs=function(u,f,l,h,x,S,E,P,R,z,j){var ee=x.transform;return v.extend(Fu(u,f,l,h,x,S,E,P,R,z),{u_gamma_scale:h?Math.cos(ee._pitch)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+j})},ll=function(u,f,l,h,x,S,E,P,R,z){return v.extend(Bs(u,f,l,h,x,S,E,P,!0,R,!0),{u_texsize_icon:z,u_texture_icon:1})},cl=function(u,f,l){return{u_matrix:u,u_opacity:f,u_color:l}},xu=function(u,f,l,h,x,S){return v.extend(function(E,P,R,z){var j=R.imageManager.getPattern(E.from.toString()),ee=R.imageManager.getPattern(E.to.toString()),ne=R.imageManager.getPixelSize(),Ae=ne.width,Se=ne.height,De=Math.pow(2,z.tileID.overscaledZ),ge=z.tileSize*Math.pow(2,R.transform.tileZoom)/De,Fe=ge*(z.tileID.canonical.x+z.tileID.wrap*De),Ge=ge*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:ee.tl,u_pattern_br_b:ee.br,u_texsize:[Ae,Se],u_mix:P.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:ee.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/wi(z,1,R.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,Ge>>16],u_pixel_coord_lower:[65535&Fe,65535&Ge]}}(h,S,l,x),{u_matrix:u,u_opacity:f})},fc={fillExtrusion:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_lightpos:new v.Uniform3f(u,f.u_lightpos),u_lightintensity:new v.Uniform1f(u,f.u_lightintensity),u_lightcolor:new v.Uniform3f(u,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(u,f.u_vertical_gradient),u_opacity:new v.Uniform1f(u,f.u_opacity)}},fillExtrusionPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_lightpos:new v.Uniform3f(u,f.u_lightpos),u_lightintensity:new v.Uniform1f(u,f.u_lightintensity),u_lightcolor:new v.Uniform3f(u,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(u,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(u,f.u_height_factor),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade),u_opacity:new v.Uniform1f(u,f.u_opacity)}},fill:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},fillPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},fillOutline:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world)}},fillOutlinePattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},circle:function(u,f){return{u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(u,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(u,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},collisionBox:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(u,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(u,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(u,f.u_overscale_factor)}},collisionCircle:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(u,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(u,f.u_viewport_size)}},debug:function(u,f){return{u_color:new v.UniformColor(u,f.u_color),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_overlay:new v.Uniform1i(u,f.u_overlay),u_overlay_scale:new v.Uniform1f(u,f.u_overlay_scale)}},clippingMask:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},heatmap:function(u,f){return{u_extrude_scale:new v.Uniform1f(u,f.u_extrude_scale),u_intensity:new v.Uniform1f(u,f.u_intensity),u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},heatmapTexture:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world),u_image:new v.Uniform1i(u,f.u_image),u_color_ramp:new v.Uniform1i(u,f.u_color_ramp),u_opacity:new v.Uniform1f(u,f.u_opacity)}},hillshade:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_latrange:new v.Uniform2f(u,f.u_latrange),u_light:new v.Uniform2f(u,f.u_light),u_shadow:new v.UniformColor(u,f.u_shadow),u_highlight:new v.UniformColor(u,f.u_highlight),u_accent:new v.UniformColor(u,f.u_accent)}},hillshadePrepare:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_dimension:new v.Uniform2f(u,f.u_dimension),u_zoom:new v.Uniform1f(u,f.u_zoom),u_unpack:new v.Uniform4f(u,f.u_unpack)}},line:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels)}},lineGradient:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_image:new v.Uniform1i(u,f.u_image),u_image_height:new v.Uniform1f(u,f.u_image_height)}},linePattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_texsize:new v.Uniform2f(u,f.u_texsize),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_image:new v.Uniform1i(u,f.u_image),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},lineSDF:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(u,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(u,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(u,f.u_sdfgamma),u_image:new v.Uniform1i(u,f.u_image),u_tex_y_a:new v.Uniform1f(u,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(u,f.u_tex_y_b),u_mix:new v.Uniform1f(u,f.u_mix)}},raster:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_tl_parent:new v.Uniform2f(u,f.u_tl_parent),u_scale_parent:new v.Uniform1f(u,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(u,f.u_buffer_scale),u_fade_t:new v.Uniform1f(u,f.u_fade_t),u_opacity:new v.Uniform1f(u,f.u_opacity),u_image0:new v.Uniform1i(u,f.u_image0),u_image1:new v.Uniform1i(u,f.u_image1),u_brightness_low:new v.Uniform1f(u,f.u_brightness_low),u_brightness_high:new v.Uniform1f(u,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(u,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(u,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(u,f.u_spin_weights)}},symbolIcon:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texture:new v.Uniform1i(u,f.u_texture)}},symbolSDF:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texture:new v.Uniform1i(u,f.u_texture),u_gamma_scale:new v.Uniform1f(u,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(u,f.u_is_halo)}},symbolTextAndIcon:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texsize_icon:new v.Uniform2f(u,f.u_texsize_icon),u_texture:new v.Uniform1i(u,f.u_texture),u_texture_icon:new v.Uniform1i(u,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(u,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(u,f.u_is_halo)}},background:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_opacity:new v.Uniform1f(u,f.u_opacity),u_color:new v.UniformColor(u,f.u_color)}},backgroundPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_opacity:new v.Uniform1f(u,f.u_opacity),u_image:new v.Uniform1i(u,f.u_image),u_pattern_tl_a:new v.Uniform2f(u,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(u,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(u,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(u,f.u_pattern_br_b),u_texsize:new v.Uniform2f(u,f.u_texsize),u_mix:new v.Uniform1f(u,f.u_mix),u_pattern_size_a:new v.Uniform2f(u,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(u,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(u,f.u_scale_a),u_scale_b:new v.Uniform1f(u,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(u,f.u_tile_units_to_pixels)}}};function fl(u,f,l,h,x,S,E){for(var P=u.context,R=P.gl,z=u.useProgram("collisionBox"),j=[],ee=0,ne=0,Ae=0;Ae<h.length;Ae++){var Se=h[Ae],De=f.getTile(Se),ge=De.getBucket(l);if(ge){var Fe=Se.posMatrix;x[0]===0&&x[1]===0||(Fe=u.translatePosMatrix(Se.posMatrix,De,x,S));var Ge=E?ge.textCollisionBox:ge.iconCollisionBox,at=ge.collisionCircleArray;if(at.length>0){var Ct=v.create(),wt=Fe;v.mul(Ct,ge.placementInvProjMatrix,u.transform.glCoordMatrix),v.mul(Ct,Ct,ge.placementViewportMatrix),j.push({circleArray:at,circleOffset:ne,transform:wt,invTransform:Ct}),ne=ee+=at.length/4}Ge&&z.draw(P,R.LINES,oe.disabled,Te.disabled,u.colorModeForRenderPass(),We.disabled,Ks(Fe,u.transform,De),l.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,u.transform.zoom,null,null,Ge.collisionVertexBuffer)}}if(E&&j.length){var At=u.useProgram("collisionCircle"),Yt=new v.StructArrayLayout2f1f2i16;Yt.resize(4*ee),Yt._trim();for(var br=0,pr=0,Fr=j;pr<Fr.length;pr+=1)for(var rn=Fr[pr],fn=0;fn<rn.circleArray.length/4;fn++){var cn=4*fn,hi=rn.circleArray[cn+0],gr=rn.circleArray[cn+1],Jr=rn.circleArray[cn+2],kn=rn.circleArray[cn+3];Yt.emplace(br++,hi,gr,Jr,kn,0),Yt.emplace(br++,hi,gr,Jr,kn,1),Yt.emplace(br++,hi,gr,Jr,kn,2),Yt.emplace(br++,hi,gr,Jr,kn,3)}(!Fl||Fl.length<2*ee)&&(Fl=function(Wi){var Gi=2*Wi,no=new v.StructArrayLayout3ui6;no.resize(Gi),no._trim();for(var ra=0;ra<Gi;ra++){var _a=6*ra;no.uint16[_a+0]=4*ra+0,no.uint16[_a+1]=4*ra+1,no.uint16[_a+2]=4*ra+2,no.uint16[_a+3]=4*ra+2,no.uint16[_a+4]=4*ra+3,no.uint16[_a+5]=4*ra+0}return no}(ee));for(var wn=P.createIndexBuffer(Fl,!0),vn=P.createVertexBuffer(Yt,v.collisionCircleLayout.members,!0),Zn=0,Sn=j;Zn<Sn.length;Zn+=1){var _n=Sn[Zn],Ba=cc(_n.transform,_n.invTransform,u.transform);At.draw(P,R.TRIANGLES,oe.disabled,Te.disabled,u.colorModeForRenderPass(),We.disabled,Ba,l.id,vn,wn,v.SegmentVector.simpleSegment(0,2*_n.circleOffset,_n.circleArray.length,_n.circleArray.length/2),null,u.transform.zoom,null,null,null)}vn.destroy(),wn.destroy()}}var _s=v.identity(new Float32Array(16));function zc(u,f,l,h,x,S){var E=v.getAnchorAlignment(u),P=-(E.horizontalAlign-.5)*f,R=-(E.verticalAlign-.5)*l,z=v.evaluateVariableOffset(u,h);return new v.Point((P/x+z[0])*S,(R/x+z[1])*S)}function wf(u,f,l,h,x,S,E,P,R,z,j){var ee=u.text.placedSymbolArray,ne=u.text.dynamicLayoutVertexArray,Ae=u.icon.dynamicLayoutVertexArray,Se={};ne.clear();for(var De=0;De<ee.length;De++){var ge=ee.get(De),Fe=ge.hidden||!ge.crossTileID||u.allowVerticalPlacement&&!ge.placedOrientation?null:h[ge.crossTileID];if(Fe){var Ge=new v.Point(ge.anchorX,ge.anchorY),at=zn(Ge,l?P:E),Ct=Jn(S.cameraToCenterDistance,at.signedDistanceFromCamera),wt=x.evaluateSizeForFeature(u.textSizeData,z,ge)*Ct/v.ONE_EM;l&&(wt*=u.tilePixelRatio/R);for(var At=zc(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale,wt),Yt=l?zn(Ge.add(At),E).point:at.point.add(f?At.rotate(-S.angle):At),br=u.allowVerticalPlacement&&ge.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,pr=0;pr<ge.numGlyphs;pr++)v.addDynamicAttributes(ne,Yt,br);j&&ge.associatedIconIndex>=0&&(Se[ge.associatedIconIndex]={shiftedAnchor:Yt,angle:br})}else Ca(ge.numGlyphs,ne)}if(j){Ae.clear();for(var Fr=u.icon.placedSymbolArray,rn=0;rn<Fr.length;rn++){var fn=Fr.get(rn);if(fn.hidden)Ca(fn.numGlyphs,Ae);else{var cn=Se[rn];if(cn)for(var hi=0;hi<fn.numGlyphs;hi++)v.addDynamicAttributes(Ae,cn.shiftedAnchor,cn.angle);else Ca(fn.numGlyphs,Ae)}}u.icon.dynamicLayoutVertexBuffer.updateData(Ae)}u.text.dynamicLayoutVertexBuffer.updateData(ne)}function Zc(u,f,l){return l.iconsInText&&f?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function bu(u,f,l,h,x,S,E,P,R,z,j,ee){for(var ne=u.context,Ae=ne.gl,Se=u.transform,De=P==="map",ge=R==="map",Fe=De&&l.layout.get("symbol-placement")!=="point",Ge=De&&!ge&&!Fe,at=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ct=!1,wt=u.depthModeForSublayer(0,oe.ReadOnly),At=l.layout.get("text-variable-anchor"),Yt=[],br=0,pr=h;br<pr.length;br+=1){var Fr=pr[br],rn=f.getTile(Fr),fn=rn.getBucket(l);if(fn){var cn=x?fn.text:fn.icon;if(cn&&cn.segments.get().length){var hi=cn.programConfigurations.get(l.id),gr=x||fn.sdfIcons,Jr=x?fn.textSizeData:fn.iconSizeData,kn=ge||Se.pitch!==0,wn=u.useProgram(Zc(gr,x,fn),hi),vn=v.evaluateSizeForZoom(Jr,Se.zoom),Zn=void 0,Sn=[0,0],_n=void 0,Ba=void 0,Wi=null,Gi=void 0;if(x)_n=rn.glyphAtlasTexture,Ba=Ae.LINEAR,Zn=rn.glyphAtlasTexture.size,fn.iconsInText&&(Sn=rn.imageAtlasTexture.size,Wi=rn.imageAtlasTexture,Gi=kn||u.options.rotating||u.options.zooming||Jr.kind==="composite"||Jr.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{var no=l.layout.get("icon-size").constantOr(0)!==1||fn.iconsNeedLinear;_n=rn.imageAtlasTexture,Ba=gr||u.options.rotating||u.options.zooming||no||kn?Ae.LINEAR:Ae.NEAREST,Zn=rn.imageAtlasTexture.size}var ra=wi(rn,1,u.transform.zoom),_a=Li(Fr.posMatrix,ge,De,u.transform,ra),Na=Wn(Fr.posMatrix,ge,De,u.transform,ra),io=At&&fn.hasTextData(),Cs=l.layout.get("icon-text-fit")!=="none"&&io&&fn.hasIconData();Fe&&ys(fn,Fr.posMatrix,u,x,_a,Na,ge,z);var fo=u.translatePosMatrix(Fr.posMatrix,rn,S,E),Jo=Fe||x&&At||Cs?_s:_a,Mo=u.translatePosMatrix(Na,rn,S,E,!0),ru=gr&&l.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Gu={program:wn,buffers:cn,uniformValues:gr?fn.iconsInText?ll(Jr.kind,vn,Ge,ge,u,fo,Jo,Mo,Zn,Sn):Bs(Jr.kind,vn,Ge,ge,u,fo,Jo,Mo,x,Zn,!0):Fu(Jr.kind,vn,Ge,ge,u,fo,Jo,Mo,x,Zn),atlasTexture:_n,atlasTextureIcon:Wi,atlasInterpolation:Ba,atlasInterpolationIcon:Gi,isSDF:gr,hasHalo:ru};if(at&&fn.canOverlap){Ct=!0;for(var nu=0,iu=cn.segments.get();nu<iu.length;nu+=1){var xl=iu[nu];Yt.push({segments:new v.SegmentVector([xl]),sortKey:xl.sortKey,state:Gu})}}else Yt.push({segments:cn.segments,sortKey:0,state:Gu})}}}Ct&&Yt.sort(function(Zs,Uo){return Zs.sortKey-Uo.sortKey});for(var zs=0,Hu=Yt;zs<Hu.length;zs+=1){var za=Hu[zs],na=za.state;if(ne.activeTexture.set(Ae.TEXTURE0),na.atlasTexture.bind(na.atlasInterpolation,Ae.CLAMP_TO_EDGE),na.atlasTextureIcon&&(ne.activeTexture.set(Ae.TEXTURE1),na.atlasTextureIcon&&na.atlasTextureIcon.bind(na.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),na.isSDF){var au=na.uniformValues;na.hasHalo&&(au.u_is_halo=1,Bl(na.buffers,za.segments,l,u,na.program,wt,j,ee,au)),au.u_is_halo=0}Bl(na.buffers,za.segments,l,u,na.program,wt,j,ee,na.uniformValues)}}function Bl(u,f,l,h,x,S,E,P,R){var z=h.context;x.draw(z,z.gl.TRIANGLES,S,E,P,We.disabled,R,l.id,u.layoutVertexBuffer,u.indexBuffer,f,l.paint,h.transform.zoom,u.programConfigurations.get(l.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Nl(u,f,l,h,x,S,E){var P,R,z,j,ee,ne=u.context.gl,Ae=l.paint.get("fill-pattern"),Se=Ae&&Ae.constantOr(1),De=l.getCrossfadeParameters();E?(R=Se&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=ne.LINES):(R=Se?"fillPattern":"fill",P=ne.TRIANGLES);for(var ge=0,Fe=h;ge<Fe.length;ge+=1){var Ge=Fe[ge],at=f.getTile(Ge);if(!Se||at.patternsLoaded()){var Ct=at.getBucket(l);if(Ct){var wt=Ct.programConfigurations.get(l.id),At=u.useProgram(R,wt);Se&&(u.context.activeTexture.set(ne.TEXTURE0),at.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),wt.updatePaintBuffers(De));var Yt=Ae.constantOr(null);if(Yt&&at.imageAtlas){var br=at.imageAtlas,pr=br.patternPositions[Yt.to.toString()],Fr=br.patternPositions[Yt.from.toString()];pr&&Fr&&wt.setConstantPatternPositions(pr,Fr)}var rn=u.translatePosMatrix(Ge.posMatrix,at,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){j=Ct.indexBuffer2,ee=Ct.segments2;var fn=[ne.drawingBufferWidth,ne.drawingBufferHeight];z=R==="fillOutlinePattern"&&Se?lc(rn,u,De,at,fn):Bc(rn,fn)}else j=Ct.indexBuffer,ee=Ct.segments,z=Se?Ao(rn,u,De,at):Du(rn);At.draw(u.context,P,x,u.stencilModeForClipping(Ge),S,We.disabled,z,l.id,Ct.layoutVertexBuffer,j,ee,l.paint,u.transform.zoom,wt)}}}}function wu(u,f,l,h,x,S,E){for(var P=u.context,R=P.gl,z=l.paint.get("fill-extrusion-pattern"),j=z.constantOr(1),ee=l.getCrossfadeParameters(),ne=l.paint.get("fill-extrusion-opacity"),Ae=0,Se=h;Ae<Se.length;Ae+=1){var De=Se[Ae],ge=f.getTile(De),Fe=ge.getBucket(l);if(Fe){var Ge=Fe.programConfigurations.get(l.id),at=u.useProgram(j?"fillExtrusionPattern":"fillExtrusion",Ge);j&&(u.context.activeTexture.set(R.TEXTURE0),ge.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ge.updatePaintBuffers(ee));var Ct=z.constantOr(null);if(Ct&&ge.imageAtlas){var wt=ge.imageAtlas,At=wt.patternPositions[Ct.to.toString()],Yt=wt.patternPositions[Ct.from.toString()];At&&Yt&&Ge.setConstantPatternPositions(At,Yt)}var br=u.translatePosMatrix(De.posMatrix,ge,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),pr=l.paint.get("fill-extrusion-vertical-gradient"),Fr=j?gu(br,u,pr,ne,De,ee,ge):ca(br,u,pr,ne);at.draw(P,P.gl.TRIANGLES,x,S,E,We.backCCW,Fr,l.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,l.paint,u.transform.zoom,Ge)}}}function zl(u,f,l,h,x,S){var E=u.context,P=E.gl,R=f.fbo;if(R){var z=u.useProgram("hillshade");E.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get());var j=function(ee,ne,Ae){var Se=Ae.paint.get("hillshade-shadow-color"),De=Ae.paint.get("hillshade-highlight-color"),ge=Ae.paint.get("hillshade-accent-color"),Fe=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fe-=ee.transform.angle);var Ge,at,Ct,wt=!ee.options.moving;return{u_matrix:ee.transform.calculatePosMatrix(ne.tileID.toUnwrapped(),wt),u_image:0,u_latrange:(Ge=ne.tileID,at=Math.pow(2,Ge.canonical.z),Ct=Ge.canonical.y,[new v.MercatorCoordinate(0,Ct/at).toLngLat().lat,new v.MercatorCoordinate(0,(Ct+1)/at).toLngLat().lat]),u_light:[Ae.paint.get("hillshade-exaggeration"),Fe],u_shadow:Se,u_highlight:De,u_accent:ge}}(u,f,l);z.draw(E,P.TRIANGLES,h,x,S,We.disabled,j,l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}}function Sf(u,f,l,h,x,S){var E=u.context,P=E.gl,R=f.dem;if(R&&R.data){var z=R.dim,j=R.stride,ee=R.getPixels();if(E.activeTexture.set(P.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||u.getTileTexture(j),f.demTexture){var ne=f.demTexture;ne.update(ee,{premultiply:!1}),ne.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(E,ee,P.RGBA,{premultiply:!1}),f.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);E.activeTexture.set(P.TEXTURE0);var Ae=f.fbo;if(!Ae){var Se=new v.Texture(E,{width:z,height:z,data:null},P.RGBA);Se.bind(P.LINEAR,P.CLAMP_TO_EDGE),(Ae=f.fbo=E.createFramebuffer(z,z,!0)).colorAttachment.set(Se.texture)}E.bindFramebuffer.set(Ae.framebuffer),E.viewport.set([0,0,z,z]),u.useProgram("hillshadePrepare").draw(E,P.TRIANGLES,h,x,S,We.disabled,function(De,ge){var Fe=ge.stride,Ge=v.create();return v.ortho(Ge,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Ge,Ge,[0,-v.EXTENT,0]),{u_matrix:Ge,u_image:1,u_dimension:[Fe,Fe],u_zoom:De.overscaledZ,u_unpack:ge.getUnpackVector()}}(f.tileID,R),l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Su(u,f,l,h,x){var S=h.paint.get("raster-fade-duration");if(S>0){var E=v.browser.now(),P=(E-u.timeAdded)/S,R=f?(E-f.timeAdded)/S:-1,z=l.getSource(),j=x.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),ee=!f||Math.abs(f.tileID.overscaledZ-j)>Math.abs(u.tileID.overscaledZ-j),ne=ee&&u.refreshedUponExpiration?1:v.clamp(ee?P:1-R,0,1);return u.refreshedUponExpiration&&P>=1&&(u.refreshedUponExpiration=!1),f?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}var Ef=new v.Color(1,0,0,1),np=new v.Color(0,1,0,1),Cf=new v.Color(0,0,1,1),pl=new v.Color(1,0,1,1),Uc=new v.Color(0,1,1,1);function pc(u,f,l,h){hl(u,0,f+l/2,u.transform.width,l,h)}function Tf(u,f,l,h){hl(u,f-l/2,0,l,u.transform.height,h)}function hl(u,f,l,h,x,S){var E=u.context,P=E.gl;P.enable(P.SCISSOR_TEST),P.scissor(f*v.browser.devicePixelRatio,l*v.browser.devicePixelRatio,h*v.browser.devicePixelRatio,x*v.browser.devicePixelRatio),E.clear({color:S}),P.disable(P.SCISSOR_TEST)}function ip(u,f,l){var h=u.context,x=h.gl,S=l.posMatrix,E=u.useProgram("debug"),P=oe.disabled,R=Te.disabled,z=u.colorModeForRenderPass();h.activeTexture.set(x.TEXTURE0),u.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),E.draw(h,x.LINE_STRIP,P,R,z,We.disabled,Fs(S,v.Color.red),"$debug",u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments);var j=f.getTileByID(l.key).latestRawTileData,ee=Math.floor((j&&j.byteLength||0)/1024),ne=f.getTile(l).tileSize,Ae=512/Math.min(ne,512)*(l.overscaledZ/u.transform.zoom)*.5,Se=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Se+=" => "+l.overscaledZ),function(De,ge){De.initDebugOverlayCanvas();var Fe=De.debugOverlayCanvas,Ge=De.context.gl,at=De.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,Fe.width,Fe.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(ge,5,5),at.strokeText(ge,5,5),De.debugOverlayTexture.update(Fe),De.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(u,Se+" "+ee+"kb"),E.draw(h,x.TRIANGLES,P,R,Ze.alphaBlended,We.disabled,Fs(S,v.Color.transparent,Ae),"$debug",u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments)}var Tn={symbol:function(u,f,l,h,x){if(u.renderPass==="translucent"){var S=Te.disabled,E=u.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(P,R,z,j,ee,ne,Ae){for(var Se=R.transform,De=ee==="map",ge=ne==="map",Fe=0,Ge=P;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=j.getTile(at),wt=Ct.getBucket(z);if(wt&&wt.text&&wt.text.segments.get().length){var At=v.evaluateSizeForZoom(wt.textSizeData,Se.zoom),Yt=wi(Ct,1,R.transform.zoom),br=Li(at.posMatrix,ge,De,R.transform,Yt),pr=z.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(At){var Fr=Math.pow(2,Se.zoom-Ct.tileID.overscaledZ);wf(wt,De,ge,Ae,v.symbolSize,Se,br,at.posMatrix,Fr,At,pr)}}}}(h,u,l,f,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x),l.paint.get("icon-opacity").constantOr(1)!==0&&bu(u,f,l,h,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),S,E),l.paint.get("text-opacity").constantOr(1)!==0&&bu(u,f,l,h,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),S,E),f.map.showCollisionBoxes&&(fl(u,f,l,h,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),fl(u,f,l,h,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))}},circle:function(u,f,l,h){if(u.renderPass==="translucent"){var x=l.paint.get("circle-opacity"),S=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),P=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)!==0||S.constantOr(1)!==0&&E.constantOr(1)!==0){for(var R=u.context,z=R.gl,j=u.depthModeForSublayer(0,oe.ReadOnly),ee=Te.disabled,ne=u.colorModeForRenderPass(),Ae=[],Se=0;Se<h.length;Se++){var De=h[Se],ge=f.getTile(De),Fe=ge.getBucket(l);if(Fe){var Ge=Fe.programConfigurations.get(l.id),at={programConfiguration:Ge,program:u.useProgram("circle",Ge),layoutVertexBuffer:Fe.layoutVertexBuffer,indexBuffer:Fe.indexBuffer,uniformValues:_u(u,De,ge,l)};if(P)for(var Ct=0,wt=Fe.segments.get();Ct<wt.length;Ct+=1){var At=wt[Ct];Ae.push({segments:new v.SegmentVector([At]),sortKey:At.sortKey,state:at})}else Ae.push({segments:Fe.segments,sortKey:0,state:at})}}P&&Ae.sort(function(rn,fn){return rn.sortKey-fn.sortKey});for(var Yt=0,br=Ae;Yt<br.length;Yt+=1){var pr=br[Yt],Fr=pr.state;Fr.program.draw(R,z.TRIANGLES,j,ee,ne,We.disabled,Fr.uniformValues,l.id,Fr.layoutVertexBuffer,Fr.indexBuffer,pr.segments,l.paint,u.transform.zoom,Fr.programConfiguration)}}}},heatmap:function(u,f,l,h){if(l.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){var x=u.context,S=x.gl,E=Te.disabled,P=new Ze([S.ONE,S.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Ae,Se,De){var ge=Ae.gl;Ae.activeTexture.set(ge.TEXTURE1),Ae.viewport.set([0,0,Se.width/4,Se.height/4]);var Fe=De.heatmapFbo;if(Fe)ge.bindTexture(ge.TEXTURE_2D,Fe.colorAttachment.get()),Ae.bindFramebuffer.set(Fe.framebuffer);else{var Ge=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Ge),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Fe=De.heatmapFbo=Ae.createFramebuffer(Se.width/4,Se.height/4,!1),function(at,Ct,wt,At){var Yt=at.gl;Yt.texImage2D(Yt.TEXTURE_2D,0,Yt.RGBA,Ct.width/4,Ct.height/4,0,Yt.RGBA,at.extRenderToTextureHalfFloat?at.extTextureHalfFloat.HALF_FLOAT_OES:Yt.UNSIGNED_BYTE,null),At.colorAttachment.set(wt)}(Ae,Se,Ge,Fe)}})(x,u,l),x.clear({color:v.Color.transparent});for(var R=0;R<h.length;R++){var z=h[R];if(!f.hasRenderableParent(z)){var j=f.getTile(z),ee=j.getBucket(l);if(ee){var ne=ee.programConfigurations.get(l.id);u.useProgram("heatmap",ne).draw(x,S.TRIANGLES,oe.disabled,E,P,We.disabled,xf(z.posMatrix,j,u.transform.zoom,l.paint.get("heatmap-intensity")),l.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,l.paint,u.transform.zoom,ne)}}}x.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(Ae,Se){var De=Ae.context,ge=De.gl,Fe=Se.heatmapFbo;if(Fe){De.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Fe.colorAttachment.get()),De.activeTexture.set(ge.TEXTURE1);var Ge=Se.colorRampTexture;Ge||(Ge=Se.colorRampTexture=new v.Texture(De,Se.colorRamp,ge.RGBA)),Ge.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ae.useProgram("heatmapTexture").draw(De,ge.TRIANGLES,oe.disabled,Te.disabled,Ae.colorModeForRenderPass(),We.disabled,function(at,Ct,wt,At){var Yt=v.create();v.ortho(Yt,0,at.width,at.height,0,0,1);var br=at.context.gl;return{u_matrix:Yt,u_world:[br.drawingBufferWidth,br.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ct.paint.get("heatmap-opacity")}}(Ae,Se),Se.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments,Se.paint,Ae.transform.zoom)}}(u,l))},line:function(u,f,l,h){if(u.renderPass==="translucent"){var x=l.paint.get("line-opacity"),S=l.paint.get("line-width");if(x.constantOr(1)!==0&&S.constantOr(1)!==0)for(var E=u.depthModeForSublayer(0,oe.ReadOnly),P=u.colorModeForRenderPass(),R=l.paint.get("line-dasharray"),z=l.paint.get("line-pattern"),j=z.constantOr(1),ee=l.paint.get("line-gradient"),ne=l.getCrossfadeParameters(),Ae=j?"linePattern":R?"lineSDF":ee?"lineGradient":"line",Se=u.context,De=Se.gl,ge=!0,Fe=0,Ge=h;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=f.getTile(at);if(!j||Ct.patternsLoaded()){var wt=Ct.getBucket(l);if(wt){var At=wt.programConfigurations.get(l.id),Yt=u.context.program.get(),br=u.useProgram(Ae,At),pr=ge||br.program!==Yt,Fr=z.constantOr(null);if(Fr&&Ct.imageAtlas){var rn=Ct.imageAtlas,fn=rn.patternPositions[Fr.to.toString()],cn=rn.patternPositions[Fr.from.toString()];fn&&cn&&At.setConstantPatternPositions(fn,cn)}var hi=j?Nc(u,Ct,l,ne):R?tp(u,Ct,l,R,ne):ee?Ni(u,Ct,l,wt.lineClipsArray.length):sl(u,Ct,l);if(j)Se.activeTexture.set(De.TEXTURE0),Ct.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),At.updatePaintBuffers(ne);else if(R&&(pr||u.lineAtlas.dirty))Se.activeTexture.set(De.TEXTURE0),u.lineAtlas.bind(Se);else if(ee){var gr=wt.gradients[l.id],Jr=gr.texture;if(l.gradientVersion!==gr.version){var kn=256;if(l.stepInterpolant){var wn=f.getSource().maxzoom,vn=at.canonical.z===wn?Math.ceil(1<<u.transform.maxZoom-at.canonical.z):1;kn=v.clamp(v.nextPowerOfTwo(wt.maxLineLength/v.EXTENT*1024*vn),256,Se.maxTextureSize)}gr.gradient=v.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:kn,image:gr.gradient||void 0,clips:wt.lineClipsArray}),gr.texture?gr.texture.update(gr.gradient):gr.texture=new v.Texture(Se,gr.gradient,De.RGBA),gr.version=l.gradientVersion,Jr=gr.texture}Se.activeTexture.set(De.TEXTURE0),Jr.bind(l.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}br.draw(Se,De.TRIANGLES,E,u.stencilModeForClipping(at),P,We.disabled,hi,l.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,l.paint,u.transform.zoom,At,wt.layoutVertexBuffer2),ge=!1}}}}},fill:function(u,f,l,h){var x=l.paint.get("fill-color"),S=l.paint.get("fill-opacity");if(S.constantOr(1)!==0){var E=u.colorModeForRenderPass(),P=l.paint.get("fill-pattern"),R=u.opaquePassEnabledForLayer()&&!P.constantOr(1)&&x.constantOr(v.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===R){var z=u.depthModeForSublayer(1,u.renderPass==="opaque"?oe.ReadWrite:oe.ReadOnly);Nl(u,f,l,h,z,E,!1)}if(u.renderPass==="translucent"&&l.paint.get("fill-antialias")){var j=u.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,oe.ReadOnly);Nl(u,f,l,h,j,E,!0)}}},"fill-extrusion":function(u,f,l,h){var x=l.paint.get("fill-extrusion-opacity");if(x!==0&&u.renderPass==="translucent"){var S=new oe(u.context.gl.LEQUAL,oe.ReadWrite,u.depthRangeFor3D);if(x!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))wu(u,f,l,h,S,Te.disabled,Ze.disabled),wu(u,f,l,h,S,u.stencilModeFor3D(),u.colorModeForRenderPass());else{var E=u.colorModeForRenderPass();wu(u,f,l,h,S,Te.disabled,E)}}},hillshade:function(u,f,l,h){if(u.renderPass==="offscreen"||u.renderPass==="translucent"){for(var x=u.context,S=u.depthModeForSublayer(0,oe.ReadOnly),E=u.colorModeForRenderPass(),P=u.renderPass==="translucent"?u.stencilConfigForOverlap(h):[{},h],R=P[0],z=0,j=P[1];z<j.length;z+=1){var ee=j[z],ne=f.getTile(ee);ne.needsHillshadePrepare&&u.renderPass==="offscreen"?Sf(u,ne,l,S,Te.disabled,E):u.renderPass==="translucent"&&zl(u,ne,l,S,R[ee.overscaledZ],E)}x.viewport.set([0,0,u.width,u.height])}},raster:function(u,f,l,h){if(u.renderPass==="translucent"&&l.paint.get("raster-opacity")!==0&&h.length)for(var x=u.context,S=x.gl,E=f.getSource(),P=u.useProgram("raster"),R=u.colorModeForRenderPass(),z=E instanceof qe?[{},h]:u.stencilConfigForOverlap(h),j=z[0],ee=z[1],ne=ee[ee.length-1].overscaledZ,Ae=!u.options.moving,Se=0,De=ee;Se<De.length;Se+=1){var ge=De[Se],Fe=u.depthModeForSublayer(ge.overscaledZ-ne,l.paint.get("raster-opacity")===1?oe.ReadWrite:oe.ReadOnly,S.LESS),Ge=f.getTile(ge),at=u.transform.calculatePosMatrix(ge.toUnwrapped(),Ae);Ge.registerFadeDuration(l.paint.get("raster-fade-duration"));var Ct=f.findLoadedParent(ge,0),wt=Su(Ge,Ct,f,l,u.transform),At=void 0,Yt=void 0,br=l.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;x.activeTexture.set(S.TEXTURE0),Ge.texture.bind(br,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(S.TEXTURE1),Ct?(Ct.texture.bind(br,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),At=Math.pow(2,Ct.tileID.overscaledZ-Ge.tileID.overscaledZ),Yt=[Ge.tileID.canonical.x*At%1,Ge.tileID.canonical.y*At%1]):Ge.texture.bind(br,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var pr=bf(at,Yt||[0,0],At||1,wt,l);E instanceof qe?P.draw(x,S.TRIANGLES,Fe,Te.disabled,R,We.disabled,pr,l.id,E.boundsBuffer,u.quadTriangleIndexBuffer,E.boundsSegments):P.draw(x,S.TRIANGLES,Fe,j[ge.overscaledZ],R,We.disabled,pr,l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}},background:function(u,f,l){var h=l.paint.get("background-color"),x=l.paint.get("background-opacity");if(x!==0){var S=u.context,E=S.gl,P=u.transform,R=P.tileSize,z=l.paint.get("background-pattern");if(!u.isPatternMissing(z)){var j=!z&&h.a===1&&x===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass===j){var ee=Te.disabled,ne=u.depthModeForSublayer(0,j==="opaque"?oe.ReadWrite:oe.ReadOnly),Ae=u.colorModeForRenderPass(),Se=u.useProgram(z?"backgroundPattern":"background"),De=P.coveringTiles({tileSize:R});z&&(S.activeTexture.set(E.TEXTURE0),u.imageManager.bind(u.context));for(var ge=l.getCrossfadeParameters(),Fe=0,Ge=De;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=u.transform.calculatePosMatrix(at.toUnwrapped()),wt=z?xu(Ct,x,u,z,{tileID:at,tileSize:R},ge):cl(Ct,x,h);Se.draw(S,E.TRIANGLES,ne,ee,Ae,We.disabled,wt,l.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}}}},debug:function(u,f,l){for(var h=0;h<l.length;h++)ip(u,f,l[h])},custom:function(u,f,l){var h=u.context,x=l.implementation;if(u.renderPass==="offscreen"){var S=x.prerender;S&&(u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),S.call(x,h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),h.setStencilMode(Te.disabled);var E=x.renderingMode==="3d"?new oe(u.context.gl.LEQUAL,oe.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,oe.ReadOnly);h.setDepthMode(E),x.render(h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState(),h.bindFramebuffer.set(null)}}},$r=function(u,f){this.context=new te(u),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ss,this.gpuTimers={}};$r.prototype.resize=function(u,f){if(this.width=u*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var l=0,h=this.style._order;l<h.length;l+=1)this.style._layers[h[l]].resize()},$r.prototype.setup=function(){var u=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(f,la.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var l=new v.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(v.EXTENT,0),l.emplaceBack(0,v.EXTENT),l.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=u.createVertexBuffer(l,la.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var h=new v.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(v.EXTENT,0,v.EXTENT,0),h.emplaceBack(0,v.EXTENT,0,v.EXTENT),h.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=u.createVertexBuffer(h,vt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var x=new v.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(x,la.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var S=new v.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(S);var E=new v.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(E),this.emptyTexture=new v.Texture(u,{width:1,height:1,data:new Uint8Array([0,0,0,0])},u.gl.RGBA);var P=this.context.gl;this.stencilClearMode=new Te({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)},$r.prototype.clearStencil=function(){var u=this.context,f=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var l=v.create();v.ortho(l,0,this.width,this.height,0,0,1),v.scale(l,l,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(u,f.TRIANGLES,oe.disabled,this.stencilClearMode,Ze.disabled,We.disabled,$s(l),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$r.prototype._renderTileClippingMasks=function(u,f){if(this.currentStencilSource!==u.source&&u.isTileClipped()&&f&&f.length){this.currentStencilSource=u.source;var l=this.context,h=l.gl;this.nextStencilID+f.length>256&&this.clearStencil(),l.setColorMode(Ze.disabled),l.setDepthMode(oe.disabled);var x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,E=f;S<E.length;S+=1){var P=E[S],R=this._tileClippingMaskIDs[P.key]=this.nextStencilID++;x.draw(l,h.TRIANGLES,oe.disabled,new Te({func:h.ALWAYS,mask:0},R,255,h.KEEP,h.KEEP,h.REPLACE),Ze.disabled,We.disabled,$s(P.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var u=this.nextStencilID++,f=this.context.gl;return new Te({func:f.NOTEQUAL,mask:255},u,255,f.KEEP,f.KEEP,f.REPLACE)},$r.prototype.stencilModeForClipping=function(u){var f=this.context.gl;return new Te({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,f.KEEP,f.KEEP,f.REPLACE)},$r.prototype.stencilConfigForOverlap=function(u){var f,l=this.context.gl,h=u.sort(function(R,z){return z.overscaledZ-R.overscaledZ}),x=h[h.length-1].overscaledZ,S=h[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var E={},P=0;P<S;P++)E[P+x]=new Te({func:l.GEQUAL,mask:255},P+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=S,[E,h]}return[(f={},f[x]=Te.disabled,f),h]},$r.prototype.colorModeForRenderPass=function(){var u=this.context.gl;return this._showOverdrawInspector?new Ze([u.CONSTANT_COLOR,u.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ze.unblended:Ze.alphaBlended},$r.prototype.depthModeForSublayer=function(u,f,l){if(!this.opaquePassEnabledForLayer())return oe.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new oe(l||this.context.gl.LEQUAL,f,[h,h])},$r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$r.prototype.render=function(u,f){var l=this;this.style=u,this.options=f,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var h=this.style._order,x=this.style.sourceCaches;for(var S in x){var E=x[S];E.used&&E.prepare(this.context)}var P,R,z={},j={},ee={};for(var ne in x){var Ae=x[ne];z[ne]=Ae.getVisibleCoordinates(),j[ne]=z[ne].slice().reverse(),ee[ne]=Ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Se=0;Se<h.length;Se++)if(this.style._layers[h[Se]].is3D()){this.opaquePassCutoff=Se;break}this.renderPass="offscreen";for(var De=0,ge=h;De<ge.length;De+=1){var Fe=this.style._layers[ge[De]];if(Fe.hasOffscreenPass()&&!Fe.isHidden(this.transform.zoom)){var Ge=j[Fe.source];(Fe.type==="custom"||Ge.length)&&this.renderLayer(this,x[Fe.source],Fe,Ge)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var at=this.style._layers[h[this.currentLayer]],Ct=x[at.source],wt=z[at.source];this._renderTileClippingMasks(at,wt),this.renderLayer(this,Ct,at,wt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var At=this.style._layers[h[this.currentLayer]],Yt=x[At.source],br=(At.type==="symbol"?ee:j)[At.source];this._renderTileClippingMasks(At,z[At.source]),this.renderLayer(this,Yt,At,br)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(pr){pr.source&&!pr.isHidden(l.transform.zoom)&&(pr.source!==(R&&R.id)&&(R=l.style.sourceCaches[pr.source]),(!P||P.getSource().maxzoom<R.getSource().maxzoom)&&(P=R))}),P&&Tn.debug(this,P,P.getVisibleCoordinates())),this.options.showPadding&&function(pr){var Fr=pr.transform.padding;pc(pr,pr.transform.height-(Fr.top||0),3,Ef),pc(pr,Fr.bottom||0,3,np),Tf(pr,Fr.left||0,3,Cf),Tf(pr,pr.transform.width-(Fr.right||0),3,pl);var rn=pr.transform.centerPoint;(function(fn,cn,hi,gr){hl(fn,cn-1,hi-10,2,20,gr),hl(fn,cn-10,hi-1,20,2,gr)})(pr,rn.x,pr.transform.height-rn.y,Uc)}(this),this.context.setDefault()},$r.prototype.renderLayer=function(u,f,l,h){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||h.length)&&(this.id=l.id,this.gpuTimingStart(l),Tn[l.type](u,f,l,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},$r.prototype.gpuTimingStart=function(u){if(this.options.gpuTiming){var f=this.context.extTimerQuery,l=this.gpuTimers[u.id];l||(l=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),l.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,l.query)}},$r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}},$r.prototype.collectGpuTimers=function(){var u=this.gpuTimers;return this.gpuTimers={},u},$r.prototype.queryGpuTimers=function(u){var f={};for(var l in u){var h=u[l],x=this.context.extTimerQuery,S=x.getQueryObjectEXT(h.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(h.query),f[l]=S}return f},$r.prototype.translatePosMatrix=function(u,f,l,h,x){if(!l[0]&&!l[1])return u;var S=x?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var E=Math.sin(S),P=Math.cos(S);l=[l[0]*P-l[1]*E,l[0]*E+l[1]*P]}var R=[x?l[0]:wi(f,l[0],this.transform.zoom),x?l[1]:wi(f,l[1],this.transform.zoom),0],z=new Float32Array(16);return v.translate(z,u,R),z},$r.prototype.saveTileTexture=function(u){var f=this._tileTextures[u.size[0]];f?f.push(u):this._tileTextures[u.size[0]]=[u]},$r.prototype.getTileTexture=function(u){var f=this._tileTextures[u];return f&&f.length>0?f.pop():null},$r.prototype.isPatternMissing=function(u){if(!u)return!1;if(!u.from||!u.to)return!0;var f=this.imageManager.getPattern(u.from.toString()),l=this.imageManager.getPattern(u.to.toString());return!f||!l},$r.prototype.useProgram=function(u,f){this.cache=this.cache||{};var l=""+u+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[l]||(this.cache[l]=new gf(this.context,u,Sp[u],f,fc[u],this._showOverdrawInspector)),this.cache[l]},$r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$r.prototype.setBaseState=function(){var u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)},$r.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Zl=function(u,f){this.points=u,this.planes=f};Zl.fromInvProjectionMatrix=function(u,f,l){var h=Math.pow(2,l),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(E){return v.transformMat4([],E,u)}).map(function(E){return v.scale$1([],E,1/E[3]/f*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(E){var P=v.sub([],x[E[0]],x[E[1]]),R=v.sub([],x[E[2]],x[E[1]]),z=v.normalize([],v.cross([],P,R)),j=-v.dot(z,x[E[1]]);return z.concat(j)});return new Zl(x,S)};var Bu=function(u,f){this.min=u,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Bu.prototype.quadrant=function(u){for(var f=[u%2==0,u<2],l=v.clone$2(this.min),h=v.clone$2(this.max),x=0;x<f.length;x++)l[x]=f[x]?this.min[x]:this.center[x],h[x]=f[x]?this.center[x]:this.max[x];return h[2]=this.max[2],new Bu(l,h)},Bu.prototype.distanceX=function(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]},Bu.prototype.distanceY=function(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]},Bu.prototype.intersects=function(u){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],l=!0,h=0;h<u.planes.length;h++){for(var x=u.planes[h],S=0,E=0;E<f.length;E++)S+=v.dot$1(x,f[E])>=0;if(S===0)return 0;S!==f.length&&(l=!1)}if(l)return 2;for(var P=0;P<3;P++){for(var R=Number.MAX_VALUE,z=-Number.MAX_VALUE,j=0;j<u.points.length;j++){var ee=u.points[j][P]-this.min[P];R=Math.min(R,ee),z=Math.max(z,ee)}if(z<0||R>this.max[P]-this.min[P])return 0}return 1};var Nu=function(u,f,l,h){if(u===void 0&&(u=0),f===void 0&&(f=0),l===void 0&&(l=0),h===void 0&&(h=0),isNaN(u)||u<0||isNaN(f)||f<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=f,this.left=l,this.right=h};Nu.prototype.interpolate=function(u,f,l){return f.top!=null&&u.top!=null&&(this.top=v.number(u.top,f.top,l)),f.bottom!=null&&u.bottom!=null&&(this.bottom=v.number(u.bottom,f.bottom,l)),f.left!=null&&u.left!=null&&(this.left=v.number(u.left,f.left,l)),f.right!=null&&u.right!=null&&(this.right=v.number(u.right,f.right,l)),this},Nu.prototype.getCenter=function(u,f){var l=v.clamp((this.left+u-this.right)/2,0,u),h=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(l,h)},Nu.prototype.equals=function(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right},Nu.prototype.clone=function(){return new Nu(this.top,this.bottom,this.left,this.right)},Nu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ii=function(u,f,l,h,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||x,this._minZoom=u||0,this._maxZoom=f||22,this._minPitch=l==null?0:l,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Nu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Vi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ii.prototype.clone=function(){var u=new ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return u.tileSize=this.tileSize,u.latRange=this.latRange,u.width=this.width,u.height=this.height,u._center=this._center,u.zoom=this.zoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._calcMatrices(),u},Vi.minZoom.get=function(){return this._minZoom},Vi.minZoom.set=function(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))},Vi.maxZoom.get=function(){return this._maxZoom},Vi.maxZoom.set=function(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))},Vi.minPitch.get=function(){return this._minPitch},Vi.minPitch.set=function(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))},Vi.maxPitch.get=function(){return this._maxPitch},Vi.maxPitch.set=function(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))},Vi.renderWorldCopies.get=function(){return this._renderWorldCopies},Vi.renderWorldCopies.set=function(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u},Vi.worldSize.get=function(){return this.tileSize*this.scale},Vi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Vi.size.get=function(){return new v.Point(this.width,this.height)},Vi.bearing.get=function(){return-this.angle/Math.PI*180},Vi.bearing.set=function(u){var f=-v.wrap(u,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Vi.pitch.get=function(){return this._pitch/Math.PI*180},Vi.pitch.set=function(u){var f=v.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Vi.fov.get=function(){return this._fov/Math.PI*180},Vi.fov.set=function(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=u/180*Math.PI,this._calcMatrices())},Vi.zoom.get=function(){return this._zoom},Vi.zoom.set=function(u){var f=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Vi.center.get=function(){return this._center},Vi.center.set=function(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._constrain(),this._calcMatrices())},Vi.padding.get=function(){return this._edgeInsets.toJSON()},Vi.padding.set=function(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())},Vi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ii.prototype.isPaddingEqual=function(u){return this._edgeInsets.equals(u)},ii.prototype.interpolatePadding=function(u,f,l){this._unmodified=!1,this._edgeInsets.interpolate(u,f,l),this._constrain(),this._calcMatrices()},ii.prototype.coveringZoomLevel=function(u){var f=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,f)},ii.prototype.getVisibleUnwrappedCoordinates=function(u){var f=[new v.UnwrappedTileID(0,u)];if(this._renderWorldCopies)for(var l=this.pointCoordinate(new v.Point(0,0)),h=this.pointCoordinate(new v.Point(this.width,0)),x=this.pointCoordinate(new v.Point(this.width,this.height)),S=this.pointCoordinate(new v.Point(0,this.height)),E=Math.floor(Math.min(l.x,h.x,x.x,S.x)),P=Math.floor(Math.max(l.x,h.x,x.x,S.x)),R=E-1;R<=P+1;R++)R!==0&&f.push(new v.UnwrappedTileID(R,u));return f},ii.prototype.coveringTiles=function(u){var f=this.coveringZoomLevel(u),l=f;if(u.minzoom!==void 0&&f<u.minzoom)return[];u.maxzoom!==void 0&&f>u.maxzoom&&(f=u.maxzoom);var h=v.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,f),S=[x*h.x,x*h.y,0],E=Zl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),P=u.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(P=f);var R=function(pr){return{aabb:new Bu([pr*x,0,0],[(pr+1)*x,x,0]),zoom:0,x:0,y:0,wrap:pr,fullyVisible:!1}},z=[],j=[],ee=f,ne=u.reparseOverscaled?l:f;if(this._renderWorldCopies)for(var Ae=1;Ae<=3;Ae++)z.push(R(-Ae)),z.push(R(Ae));for(z.push(R(0));z.length>0;){var Se=z.pop(),De=Se.x,ge=Se.y,Fe=Se.fullyVisible;if(!Fe){var Ge=Se.aabb.intersects(E);if(Ge===0)continue;Fe=Ge===2}var at=Se.aabb.distanceX(S),Ct=Se.aabb.distanceY(S),wt=Math.max(Math.abs(at),Math.abs(Ct));if(Se.zoom===ee||wt>3+(1<<ee-Se.zoom)-2&&Se.zoom>=P)j.push({tileID:new v.OverscaledTileID(Se.zoom===ee?ne:Se.zoom,Se.wrap,Se.zoom,De,ge),distanceSq:v.sqrLen([S[0]-.5-De,S[1]-.5-ge])});else for(var At=0;At<4;At++){var Yt=(De<<1)+At%2,br=(ge<<1)+(At>>1);z.push({aabb:Se.aabb.quadrant(At),zoom:Se.zoom+1,x:Yt,y:br,wrap:Se.wrap,fullyVisible:Fe})}}return j.sort(function(pr,Fr){return pr.distanceSq-Fr.distanceSq}).map(function(pr){return pr.tileID})},ii.prototype.resize=function(u,f){this.width=u,this.height=f,this.pixelsToGLUnits=[2/u,-2/f],this._constrain(),this._calcMatrices()},Vi.unmodified.get=function(){return this._unmodified},ii.prototype.zoomScale=function(u){return Math.pow(2,u)},ii.prototype.scaleZoom=function(u){return Math.log(u)/Math.LN2},ii.prototype.project=function(u){var f=v.clamp(u.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(u.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},ii.prototype.unproject=function(u){return new v.MercatorCoordinate(u.x/this.worldSize,u.y/this.worldSize).toLngLat()},Vi.point.get=function(){return this.project(this.center)},ii.prototype.setLocationAtPoint=function(u,f){var l=this.pointCoordinate(f),h=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(u),S=new v.MercatorCoordinate(x.x-(l.x-h.x),x.y-(l.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},ii.prototype.locationPoint=function(u){return this.coordinatePoint(this.locationCoordinate(u))},ii.prototype.pointLocation=function(u){return this.coordinateLocation(this.pointCoordinate(u))},ii.prototype.locationCoordinate=function(u){return v.MercatorCoordinate.fromLngLat(u)},ii.prototype.coordinateLocation=function(u){return u.toLngLat()},ii.prototype.pointCoordinate=function(u){var f=[u.x,u.y,0,1],l=[u.x,u.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(l,l,this.pixelMatrixInverse);var h=f[3],x=l[3],S=f[1]/h,E=l[1]/x,P=f[2]/h,R=l[2]/x,z=P===R?0:(0-P)/(R-P);return new v.MercatorCoordinate(v.number(f[0]/h,l[0]/x,z)/this.worldSize,v.number(S,E,z)/this.worldSize)},ii.prototype.coordinatePoint=function(u){var f=[u.x*this.worldSize,u.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},ii.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},ii.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ii.prototype.setMaxBounds=function(u){u?(this.lngRange=[u.getWest(),u.getEast()],this.latRange=[u.getSouth(),u.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ii.prototype.calculatePosMatrix=function(u,f){f===void 0&&(f=!1);var l=u.key,h=f?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];var x=u.canonical,S=this.worldSize/this.zoomScale(x.z),E=x.x+Math.pow(2,x.z)*u.wrap,P=v.identity(new Float64Array(16));return v.translate(P,P,[E*S,x.y*S,0]),v.scale(P,P,[S/v.EXTENT,S/v.EXTENT,1]),v.multiply(P,f?this.alignedProjMatrix:this.projMatrix,P),h[l]=new Float32Array(P),h[l]},ii.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ii.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var u,f,l,h,x=-90,S=90,E=-180,P=180,R=this.size,z=this._unmodified;if(this.latRange){var j=this.latRange;x=v.mercatorYfromLat(j[1])*this.worldSize,u=(S=v.mercatorYfromLat(j[0])*this.worldSize)-x<R.y?R.y/(S-x):0}if(this.lngRange){var ee=this.lngRange;E=v.mercatorXfromLng(ee[0])*this.worldSize,f=(P=v.mercatorXfromLng(ee[1])*this.worldSize)-E<R.x?R.x/(P-E):0}var ne=this.point,Ae=Math.max(f||0,u||0);if(Ae)return this.center=this.unproject(new v.Point(f?(P+E)/2:ne.x,u?(S+x)/2:ne.y)),this.zoom+=this.scaleZoom(Ae),this._unmodified=z,void(this._constraining=!1);if(this.latRange){var Se=ne.y,De=R.y/2;Se-De<x&&(h=x+De),Se+De>S&&(h=S-De)}if(this.lngRange){var ge=ne.x,Fe=R.x/2;ge-Fe<E&&(l=E+Fe),ge+Fe>P&&(l=P-Fe)}l===void 0&&h===void 0||(this.center=this.unproject(new v.Point(l!==void 0?l:ne.x,h!==void 0?h:ne.y))),this._unmodified=z,this._constraining=!1}},ii.prototype._calcMatrices=function(){if(this.height){var u=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,l=this._fov*(.5+u.y/this.height),h=Math.sin(l)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-l,.01,Math.PI-.01)),x=this.point,S=x.x,E=x.y,P=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),R=this.height/50,z=new Float64Array(16);v.perspective(z,this._fov,this.width/this.height,R,P),z[8]=2*-u.x/this.width,z[9]=2*u.y/this.height,v.scale(z,z,[1,-1,1]),v.translate(z,z,[0,0,-this.cameraToCenterDistance]),v.rotateX(z,z,this._pitch),v.rotateZ(z,z,this.angle),v.translate(z,z,[-S,-E,0]),this.mercatorMatrix=v.scale([],z,[this.worldSize,this.worldSize,this.worldSize]),v.scale(z,z,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=z,this.invProjMatrix=v.invert([],this.projMatrix);var j=this.width%2/2,ee=this.height%2/2,ne=Math.cos(this.angle),Ae=Math.sin(this.angle),Se=S-Math.round(S)+ne*j+Ae*ee,De=E-Math.round(E)+ne*ee+Ae*j,ge=new Float64Array(z);if(v.translate(ge,ge,[Se>.5?Se-1:Se,De>.5?De-1:De,0]),this.alignedProjMatrix=ge,z=v.create(),v.scale(z,z,[this.width/2,-this.height/2,1]),v.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=v.create(),v.scale(z,z,[1,-1,1]),v.translate(z,z,[-1,-1,0]),v.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(z=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=z,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ii.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var u=this.pointCoordinate(new v.Point(0,0)),f=[u.x*this.worldSize,u.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},ii.prototype.getCameraPoint=function(){var u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,u))},ii.prototype.getCameraQueryGeometry=function(u){var f=this.getCameraPoint();if(u.length===1)return[u[0],f];for(var l=f.x,h=f.y,x=f.x,S=f.y,E=0,P=u;E<P.length;E+=1){var R=P[E];l=Math.min(l,R.x),h=Math.min(h,R.y),x=Math.max(x,R.x),S=Math.max(S,R.y)}return[new v.Point(l,h),new v.Point(x,h),new v.Point(x,S),new v.Point(l,S),new v.Point(l,h)]},Object.defineProperties(ii.prototype,Vi);var xs=function(u){var f,l,h,x;this._hashName=u&&encodeURIComponent(u),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),l=!1,h=null,x=function(){h=null,l&&(f(),h=setTimeout(x,300),l=!1)},function(){return l=!0,h||x(),h})};xs.prototype.addTo=function(u){return this._map=u,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},xs.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},xs.prototype.getHashString=function(u){var f=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,h),S=Math.round(f.lng*x)/x,E=Math.round(f.lat*x)/x,P=this._map.getBearing(),R=this._map.getPitch(),z="";if(z+=u?"/"+S+"/"+E+"/"+l:l+"/"+E+"/"+S,(P||R)&&(z+="/"+Math.round(10*P)/10),R&&(z+="/"+Math.round(R)),this._hashName){var j=this._hashName,ee=!1,ne=v.window.location.hash.slice(1).split("&").map(function(Ae){var Se=Ae.split("=")[0];return Se===j?(ee=!0,Se+"="+z):Ae}).filter(function(Ae){return Ae});return ee||ne.push(j+"="+z),"#"+ne.join("&")}return"#"+z},xs.prototype._getCurrentHash=function(){var u,f=this,l=v.window.location.hash.replace("#","");return this._hashName?(l.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===f._hashName&&(u=h)}),(u&&u[1]||"").split("/")):l.split("/")},xs.prototype._onHashChange=function(){var u=this._getCurrentHash();if(u.length>=3&&!u.some(function(l){return isNaN(l)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:f,pitch:+(u[4]||0)}),!0}return!1},xs.prototype._updateHashUnthrottled=function(){var u=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,u)}catch(f){}};var jc={linearity:.3,easing:v.bezier(0,0,.3,1)},hc=v.extend({deceleration:2500,maxSpeed:1400},jc),Vc=v.extend({deceleration:20,maxSpeed:1400},jc),oh=v.extend({deceleration:1e3,maxSpeed:360},jc),sh=v.extend({deceleration:1e3,maxSpeed:90},jc),dc=function(u){this._map=u,this.clear()};function zu(u,f){(!u.duration||u.duration<f.duration)&&(u.duration=f.duration,u.easing=f.easing)}function Zu(u,f,l){var h=l.maxSpeed,x=l.linearity,S=l.deceleration,E=v.clamp(u*x/(f/1e3),-h,h),P=Math.abs(E)/(S*x);return{easing:l.easing,duration:1e3*P,amount:E*(P/2)}}dc.prototype.clear=function(){this._inertiaBuffer=[]},dc.prototype.record=function(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:u})},dc.prototype._drainInertiaBuffer=function(){for(var u=this._inertiaBuffer,f=v.browser.now();u.length>0&&f-u[0].time>160;)u.shift()},dc.prototype._onMoveEnd=function(u){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},l=0,h=this._inertiaBuffer;l<h.length;l+=1){var x=h[l].settings;f.zoom+=x.zoomDelta||0,f.bearing+=x.bearingDelta||0,f.pitch+=x.pitchDelta||0,x.panDelta&&f.pan._add(x.panDelta),x.around&&(f.around=x.around),x.pinchAround&&(f.pinchAround=x.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(f.pan.mag()){var P=Zu(f.pan.mag(),S,v.extend({},hc,u||{}));E.offset=f.pan.mult(P.amount/f.pan.mag()),E.center=this._map.transform.center,zu(E,P)}if(f.zoom){var R=Zu(f.zoom,S,Vc);E.zoom=this._map.transform.zoom+R.amount,zu(E,R)}if(f.bearing){var z=Zu(f.bearing,S,oh);E.bearing=this._map.transform.bearing+v.clamp(z.amount,-179,179),zu(E,z)}if(f.pitch){var j=Zu(f.pitch,S,sh);E.pitch=this._map.transform.pitch+j.amount,zu(E,j)}if(E.zoom||E.bearing){var ee=f.pinchAround===void 0?f.around:f.pinchAround;E.around=ee?this._map.unproject(ee):this._map.getCenter()}return this.clear(),v.extend(E,{noMoveStart:!0})}};var fa=function(u){function f(h,x,S,E){E===void 0&&(E={});var P=Z.mousePos(x.getCanvasContainer(),S),R=x.unproject(P);u.call(this,h,v.extend({point:P,lngLat:R,originalEvent:S},E)),this._defaultPrevented=!1,this.target=x}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Fo=function(u){function f(h,x,S){var E=h==="touchend"?S.changedTouches:S.touches,P=Z.touchPos(x.getCanvasContainer(),E),R=P.map(function(ee){return x.unproject(ee)}),z=P.reduce(function(ee,ne,Ae,Se){return ee.add(ne.div(Se.length))},new v.Point(0,0)),j=x.unproject(z);u.call(this,h,{points:P,point:z,lngLats:R,lngLat:j,originalEvent:S}),this._defaultPrevented=!1}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Ul=function(u){function f(h,x,S){u.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Ma=function(u,f){this._map=u,this._clickTolerance=f.clickTolerance};Ma.prototype.reset=function(){delete this._mousedownPos},Ma.prototype.wheel=function(u){return this._firePreventable(new Ul(u.type,this._map,u))},Ma.prototype.mousedown=function(u,f){return this._mousedownPos=f,this._firePreventable(new fa(u.type,this._map,u))},Ma.prototype.mouseup=function(u){this._map.fire(new fa(u.type,this._map,u))},Ma.prototype.click=function(u,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new fa(u.type,this._map,u))},Ma.prototype.dblclick=function(u){return this._firePreventable(new fa(u.type,this._map,u))},Ma.prototype.mouseover=function(u){this._map.fire(new fa(u.type,this._map,u))},Ma.prototype.mouseout=function(u){this._map.fire(new fa(u.type,this._map,u))},Ma.prototype.touchstart=function(u){return this._firePreventable(new Fo(u.type,this._map,u))},Ma.prototype.touchmove=function(u){this._map.fire(new Fo(u.type,this._map,u))},Ma.prototype.touchend=function(u){this._map.fire(new Fo(u.type,this._map,u))},Ma.prototype.touchcancel=function(u){this._map.fire(new Fo(u.type,this._map,u))},Ma.prototype._firePreventable=function(u){if(this._map.fire(u),u.defaultPrevented)return{}},Ma.prototype.isEnabled=function(){return!0},Ma.prototype.isActive=function(){return!1},Ma.prototype.enable=function(){},Ma.prototype.disable=function(){};var Hr=function(u){this._map=u};Hr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Hr.prototype.mousemove=function(u){this._map.fire(new fa(u.type,this._map,u))},Hr.prototype.mousedown=function(){this._delayContextMenu=!0},Hr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Hr.prototype.contextmenu=function(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new fa(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()},Hr.prototype.isEnabled=function(){return!0},Hr.prototype.isActive=function(){return!1},Hr.prototype.enable=function(){},Hr.prototype.disable=function(){};var us=function(u,f){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=f.clickTolerance||1};function Gc(u,f){for(var l={},h=0;h<u.length;h++)l[u[h].identifier]=f[h];return l}us.prototype.isEnabled=function(){return!!this._enabled},us.prototype.isActive=function(){return!!this._active},us.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},us.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},us.prototype.mousedown=function(u,f){this.isEnabled()&&u.shiftKey&&u.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},us.prototype.mousemoveWindow=function(u,f){if(this._active){var l=f;if(!(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=l,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));var x=Math.min(h.x,l.x),S=Math.max(h.x,l.x),E=Math.min(h.y,l.y),P=Math.max(h.y,l.y);Z.setTransform(this._box,"translate("+x+"px,"+E+"px)"),this._box.style.width=S-x+"px",this._box.style.height=P-E+"px"}}},us.prototype.mouseupWindow=function(u,f){var l=this;if(this._active&&u.button===0){var h=this._startPos,x=f;if(this.reset(),Z.suppressClick(),h.x!==x.x||h.y!==x.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,x,l._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",u)}},us.prototype.keydown=function(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))},us.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},us.prototype._fireEvent=function(u,f){return this._map.fire(new v.Event(u,{originalEvent:f}))};var jl=function(u){this.reset(),this.numTouches=u.numTouches};jl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},jl.prototype.touchstart=function(u,f,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=u.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){for(var x=new v.Point(0,0),S=0,E=h;S<E.length;S+=1)x._add(E[S]);return x.div(h.length)}(f),this.touches=Gc(l,f)))},jl.prototype.touchmove=function(u,f,l){if(!this.aborted&&this.centroid){var h=Gc(l,f);for(var x in this.touches){var S=h[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}},jl.prototype.touchend=function(u,f,l){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Ns=function(u){this.singleTap=new jl(u),this.numTaps=u.numTaps,this.reset()};Ns.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ns.prototype.touchstart=function(u,f,l){this.singleTap.touchstart(u,f,l)},Ns.prototype.touchmove=function(u,f,l){this.singleTap.touchmove(u,f,l)},Ns.prototype.touchend=function(u,f,l){var h=this.singleTap.touchend(u,f,l);if(h){var x=u.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(x&&S||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ls=function(){this._zoomIn=new Ns({numTouches:1,numTaps:2}),this._zoomOut=new Ns({numTouches:2,numTaps:1}),this.reset()};ls.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ls.prototype.touchstart=function(u,f,l){this._zoomIn.touchstart(u,f,l),this._zoomOut.touchstart(u,f,l)},ls.prototype.touchmove=function(u,f,l){this._zoomIn.touchmove(u,f,l),this._zoomOut.touchmove(u,f,l)},ls.prototype.touchend=function(u,f,l){var h=this,x=this._zoomIn.touchend(u,f,l),S=this._zoomOut.touchend(u,f,l);return x?(this._active=!0,u.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:u})}}):S?(this._active=!0,u.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(S)},{originalEvent:u})}}):void 0},ls.prototype.touchcancel=function(){this.reset()},ls.prototype.enable=function(){this._enabled=!0},ls.prototype.disable=function(){this._enabled=!1,this.reset()},ls.prototype.isEnabled=function(){return this._enabled},ls.prototype.isActive=function(){return this._active};var dl={0:1,2:2},hr=function(u){this.reset(),this._clickTolerance=u.clickTolerance||1};hr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},hr.prototype._correctButton=function(u,f){return!1},hr.prototype._move=function(u,f){return{}},hr.prototype.mousedown=function(u,f){if(!this._lastPoint){var l=Z.mouseButton(u);this._correctButton(u,l)&&(this._lastPoint=f,this._eventButton=l)}},hr.prototype.mousemoveWindow=function(u,f){var l=this._lastPoint;if(l){if(u.preventDefault(),function(h,x){var S=dl[x];return h.buttons===void 0||(h.buttons&S)!==S}(u,this._eventButton))this.reset();else if(this._moved||!(f.dist(l)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(l,f)}},hr.prototype.mouseupWindow=function(u){this._lastPoint&&Z.mouseButton(u)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},hr.prototype.enable=function(){this._enabled=!0},hr.prototype.disable=function(){this._enabled=!1,this.reset()},hr.prototype.isEnabled=function(){return this._enabled},hr.prototype.isActive=function(){return this._active};var Af=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.mousedown=function(l,h){u.prototype.mousedown.call(this,l,h),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(l,h){return h===0&&!l.ctrlKey},f.prototype._move=function(l,h){return{around:h,panDelta:h.sub(l)}},f}(hr),vl=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype._correctButton=function(l,h){return h===0&&l.ctrlKey||h===2},f.prototype._move=function(l,h){var x=.8*(h.x-l.x);if(x)return this._active=!0,{bearingDelta:x}},f.prototype.contextmenu=function(l){l.preventDefault()},f}(hr),Uu=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype._correctButton=function(l,h){return h===0&&l.ctrlKey||h===2},f.prototype._move=function(l,h){var x=-.5*(h.y-l.y);if(x)return this._active=!0,{pitchDelta:x}},f.prototype.contextmenu=function(l){l.preventDefault()},f}(hr),bs=function(u){this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset()};bs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},bs.prototype.touchstart=function(u,f,l){return this._calculateTransform(u,f,l)},bs.prototype.touchmove=function(u,f,l){if(this._active&&!(l.length<this._minTouches))return u.preventDefault(),this._calculateTransform(u,f,l)},bs.prototype.touchend=function(u,f,l){this._calculateTransform(u,f,l),this._active&&l.length<this._minTouches&&this.reset()},bs.prototype.touchcancel=function(){this.reset()},bs.prototype._calculateTransform=function(u,f,l){l.length>0&&(this._active=!0);var h=Gc(l,f),x=new v.Point(0,0),S=new v.Point(0,0),E=0;for(var P in h){var R=h[P],z=this._touches[P];z&&(x._add(R),S._add(R.sub(z)),E++,h[P]=R)}if(this._touches=h,!(E<this._minTouches)&&S.mag()){var j=S.div(E);if(this._sum._add(j),!(this._sum.mag()<this._clickTolerance))return{around:x.div(E),panDelta:j}}},bs.prototype.enable=function(){this._enabled=!0},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var $o=function(){this.reset()};function Mf(u,f,l){for(var h=0;h<u.length;h++)if(u[h].identifier===l)return f[h]}function Pf(u,f){return Math.log(u/f)/Math.LN2}$o.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},$o.prototype._start=function(u){},$o.prototype._move=function(u,f,l){return{}},$o.prototype.touchstart=function(u,f,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([f[0],f[1]]))},$o.prototype.touchmove=function(u,f,l){if(this._firstTwoTouches){u.preventDefault();var h=this._firstTwoTouches,x=h[1],S=Mf(l,f,h[0]),E=Mf(l,f,x);if(S&&E){var P=this._aroundCenter?null:S.add(E).div(2);return this._move([S,E],P,u)}}},$o.prototype.touchend=function(u,f,l){if(this._firstTwoTouches){var h=this._firstTwoTouches,x=h[1],S=Mf(l,f,h[0]),E=Mf(l,f,x);S&&E||(this._active&&Z.suppressClick(),this.reset())}},$o.prototype.touchcancel=function(){this.reset()},$o.prototype.enable=function(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"},$o.prototype.disable=function(){this._enabled=!1,this.reset()},$o.prototype.isEnabled=function(){return this._enabled},$o.prototype.isActive=function(){return this._active};var cs=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(l){this._startDistance=this._distance=l[0].dist(l[1])},f.prototype._move=function(l,h){var x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Pf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pf(this._distance,x),pinchAround:h}},f}($o);function ju(u,f){return 180*u.angleWith(f)/Math.PI}var If=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])},f.prototype._move=function(l,h){var x=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ju(this._vector,x),pinchAround:h}},f.prototype._isBelowThreshold=function(l){this._minDiameter=Math.min(this._minDiameter,l.mag());var h=25/(Math.PI*this._minDiameter)*360,x=ju(l,this._startVector);return Math.abs(x)<h},f}($o);function vc(u){return Math.abs(u.y)>Math.abs(u.x)}var ap=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(l){this._lastPoints=l,vc(l[0].sub(l[1]))&&(this._valid=!1)},f.prototype._move=function(l,h,x){var S=l[0].sub(this._lastPoints[0]),E=l[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,E,x.timeStamp),this._valid)return this._lastPoints=l,this._active=!0,{pitchDelta:(S.y+E.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(l,h,x){if(this._valid!==void 0)return this._valid;var S=l.mag()>=2,E=h.mag()>=2;if(S||E){if(!S||!E)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;var P=l.y>0==h.y>0;return vc(l)&&vc(h)&&P}},f}($o),Of={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var u=Of;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1};function ws(u){return u*(2-u)}Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(u){var f=this;if(!(u.altKey||u.ctrlKey||u.metaKey)){var l=0,h=0,x=0,S=0,E=0;switch(u.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:u.shiftKey?h=-1:(u.preventDefault(),S=-1);break;case 39:u.shiftKey?h=1:(u.preventDefault(),S=1);break;case 38:u.shiftKey?x=1:(u.preventDefault(),E=-1);break;case 40:u.shiftKey?x=-1:(u.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(h=0,x=0),{cameraAnimation:function(P){var R=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:ws,zoom:l?Math.round(R)+l*(u.shiftKey?2:1):R,bearing:P.getBearing()+h*f._bearingStep,pitch:P.getPitch()+x*f._pitchStep,offset:[-S*f._panStep,-E*f._panStep],center:P.getCenter()},{originalEvent:u})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Xn=function(u,f){this._map=u,this._el=u.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Xn.prototype.setZoomRate=function(u){this._defaultZoomRate=u},Xn.prototype.setWheelZoomRate=function(u){this._wheelZoomRate=u},Xn.prototype.isEnabled=function(){return!!this._enabled},Xn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Xn.prototype.isZooming=function(){return!!this._zooming},Xn.prototype.enable=function(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=u&&u.around==="center")},Xn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xn.prototype.wheel=function(u){if(this.isEnabled()){var f=u.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY,l=v.browser.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(h*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),u.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=u,this._delta-=f,this._active||this._start(u)),u.preventDefault()}},Xn.prototype._onTimeout=function(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},Xn.prototype._start=function(u){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=Z.mousePos(this._el,u);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Xn.prototype.renderFrame=function(){var u=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var l=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*l)));this._delta<0&&h!==0&&(h=1/h);var x=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(x*h))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,E=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,P=this._startZoom,R=this._easing,z=!1;if(this._type==="wheel"&&P&&R){var j=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),ee=R(j);S=v.number(P,E,ee),j<1?this._frameId||(this._frameId=!0):z=!0}else S=E,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(function(){u._zooming=!1,u._handler._triggerRenderFrame(),delete u._targetZoom,delete u._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:S-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Xn.prototype._smoothOutEasing=function(u){var f=v.ease;if(this._prevEase){var l=this._prevEase,h=(v.browser.now()-l.start)/l.duration,x=l.easing(h+.01)-l.easing(h),S=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-S*S);f=v.bezier(S,E,.25,1)}return this._prevEase={start:v.browser.now(),duration:u,easing:f},f},Xn.prototype.reset=function(){this._active=!1};var Qs=function(u,f){this._clickZoom=u,this._tapZoom=f};Qs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Qs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Qs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Qs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ro=function(){this.reset()};ro.prototype.reset=function(){this._active=!1},ro.prototype.dblclick=function(u,f){return u.preventDefault(),{cameraAnimation:function(l){l.easeTo({duration:300,zoom:l.getZoom()+(u.shiftKey?-1:1),around:l.unproject(f)},{originalEvent:u})}}},ro.prototype.enable=function(){this._enabled=!0},ro.prototype.disable=function(){this._enabled=!1,this.reset()},ro.prototype.isEnabled=function(){return this._enabled},ro.prototype.isActive=function(){return this._active};var Pa=function(){this._tap=new Ns({numTouches:1,numTaps:1}),this.reset()};Pa.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Pa.prototype.touchstart=function(u,f,l){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?l.length>0&&(this._swipePoint=f[0],this._swipeTouch=l[0].identifier):this._tap.touchstart(u,f,l))},Pa.prototype.touchmove=function(u,f,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;var h=f[0],x=h.y-this._swipePoint.y;return this._swipePoint=h,u.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(u,f,l)},Pa.prototype.touchend=function(u,f,l){this._tapTime?this._swipePoint&&l.length===0&&this.reset():this._tap.touchend(u,f,l)&&(this._tapTime=u.timeStamp)},Pa.prototype.touchcancel=function(){this.reset()},Pa.prototype.enable=function(){this._enabled=!0},Pa.prototype.disable=function(){this._enabled=!1,this.reset()},Pa.prototype.isEnabled=function(){return this._enabled},Pa.prototype.isActive=function(){return this._active};var Bo=function(u,f,l){this._el=u,this._mousePan=f,this._touchPan=l};Bo.prototype.enable=function(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Bo.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Bo.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Bo.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var No=function(u,f,l){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=f,this._mousePitch=l};No.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},No.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},No.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},No.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fs=function(u,f,l,h){this._el=u,this._touchZoom=f,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};fs.prototype.enable=function(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var co=function(u){return u.zoom||u.drag||u.pitch||u.rotate},ml=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f}(v.Event);function on(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}var Xr=function(u,f){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dc(u),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[v.window,"blur",void 0]];for(var h=0,x=this._listeners;h<x.length;h+=1){var S=x[h],E=S[0];Z.addEventListener(E,S[1],E===v.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};Xr.prototype.destroy=function(){for(var u=0,f=this._listeners;u<f.length;u+=1){var l=f[u],h=l[0];Z.removeEventListener(h,l[1],h===v.window.document?this.handleWindowEvent:this.handleEvent,l[2])}},Xr.prototype._addDefaultHandlers=function(u){var f=this._map,l=f.getCanvasContainer();this._add("mapEvent",new Ma(f,u));var h=f.boxZoom=new us(f,u);this._add("boxZoom",h);var x=new ls,S=new ro;f.doubleClickZoom=new Qs(S,x),this._add("tapZoom",x),this._add("clickZoom",S);var E=new Pa;this._add("tapDragZoom",E);var P=f.touchPitch=new ap;this._add("touchPitch",P);var R=new vl(u),z=new Uu(u);f.dragRotate=new No(u,R,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);var j=new Af(u),ee=new bs(u);f.dragPan=new Bo(l,j,ee),this._add("mousePan",j),this._add("touchPan",ee,["touchZoom","touchRotate"]);var ne=new If,Ae=new cs;f.touchZoomRotate=new fs(l,Ae,ne,E),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]);var Se=f.scrollZoom=new Xn(f,this);this._add("scrollZoom",Se,["mousePan"]);var De=f.keyboard=new Js;this._add("keyboard",De),this._add("blockableMapEvent",new Hr(f));for(var ge=0,Fe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ge<Fe.length;ge+=1){var Ge=Fe[ge];u.interactive&&u[Ge]&&f[Ge].enable(u[Ge])}},Xr.prototype._add=function(u,f,l){this._handlers.push({handlerName:u,handler:f,allowed:l}),this._handlersById[u]=f},Xr.prototype.stop=function(u){if(!this._updatingCamera){for(var f=0,l=this._handlers;f<l.length;f+=1)l[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}},Xr.prototype.isActive=function(){for(var u=0,f=this._handlers;u<f.length;u+=1)if(f[u].handler.isActive())return!0;return!1},Xr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Xr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Xr.prototype.isMoving=function(){return Boolean(co(this._eventsInProgress))||this.isZooming()},Xr.prototype._blockedByActive=function(u,f,l){for(var h in u)if(h!==l&&(!f||f.indexOf(h)<0))return!0;return!1},Xr.prototype.handleWindowEvent=function(u){this.handleEvent(u,u.type+"Window")},Xr.prototype._getMapTouches=function(u){for(var f=[],l=0,h=u;l<h.length;l+=1){var x=h[l];this._el.contains(x.target)&&f.push(x)}return f},Xr.prototype.handleEvent=function(u,f){if(u.type!=="blur"){this._updatingCamera=!0;for(var l=u.type==="renderFrame"?void 0:u,h={needsRenderFrame:!1},x={},S={},E=u.touches?this._getMapTouches(u.touches):void 0,P=E?Z.touchPos(this._el,E):Z.mousePos(this._el,u),R=0,z=this._handlers;R<z.length;R+=1){var j=z[R],ee=j.handlerName,ne=j.handler,Ae=j.allowed;if(ne.isEnabled()){var Se=void 0;this._blockedByActive(S,Ae,ee)?ne.reset():ne[f||u.type]&&(Se=ne[f||u.type](u,P,E),this.mergeHandlerResult(h,x,Se,ee,l),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||ne.isActive())&&(S[ee]=ne)}}var De={};for(var ge in this._previousActiveHandlers)S[ge]||(De[ge]=l);this._previousActiveHandlers=S,(Object.keys(De).length||on(h))&&(this._changes.push([h,x,De]),this._triggerRenderFrame()),(Object.keys(S).length||on(h))&&this._map._stop(!0),this._updatingCamera=!1;var Fe=h.cameraAnimation;Fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Fe(this._map))}else this.stop(!0)},Xr.prototype.mergeHandlerResult=function(u,f,l,h,x){if(l){v.extend(u,l);var S={handlerName:h,originalEvent:l.originalEvent||x};l.zoomDelta!==void 0&&(f.zoom=S),l.panDelta!==void 0&&(f.drag=S),l.pitchDelta!==void 0&&(f.pitch=S),l.bearingDelta!==void 0&&(f.rotate=S)}},Xr.prototype._applyChanges=function(){for(var u={},f={},l={},h=0,x=this._changes;h<x.length;h+=1){var S=x[h],E=S[0],P=S[1],R=S[2];E.panDelta&&(u.panDelta=(u.panDelta||new v.Point(0,0))._add(E.panDelta)),E.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(u.around=E.around),E.pinchAround!==void 0&&(u.pinchAround=E.pinchAround),E.noInertia&&(u.noInertia=E.noInertia),v.extend(f,P),v.extend(l,R)}this._updateMapTransform(u,f,l),this._changes=[]},Xr.prototype._updateMapTransform=function(u,f,l){var h=this._map,x=h.transform;if(!on(u))return this._fireEvents(f,l,!0);var S=u.panDelta,E=u.zoomDelta,P=u.bearingDelta,R=u.pitchDelta,z=u.around,j=u.pinchAround;j!==void 0&&(z=j),h._stop(!0),z=z||h.transform.centerPoint;var ee=x.pointLocation(S?z.sub(S):z);P&&(x.bearing+=P),R&&(x.pitch+=R),E&&(x.zoom+=E),x.setLocationAtPoint(ee,z),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(f,l,!0)},Xr.prototype._fireEvents=function(u,f,l){var h=this,x=co(this._eventsInProgress),S=co(u),E={};for(var P in u)this._eventsInProgress[P]||(E[P+"start"]=u[P].originalEvent),this._eventsInProgress[P]=u[P];for(var R in!x&&S&&this._fireEvent("movestart",S.originalEvent),E)this._fireEvent(R,E[R]);for(var z in S&&this._fireEvent("move",S.originalEvent),u)this._fireEvent(z,u[z].originalEvent);var j,ee={};for(var ne in this._eventsInProgress){var Ae=this._eventsInProgress[ne],Se=Ae.handlerName,De=Ae.originalEvent;this._handlersById[Se].isActive()||(delete this._eventsInProgress[ne],ee[ne+"end"]=j=f[Se]||De)}for(var ge in ee)this._fireEvent(ge,ee[ge]);var Fe=co(this._eventsInProgress);if(l&&(x||S)&&!Fe){this._updatingCamera=!0;var Ge=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),at=function(Ct){return Ct!==0&&-h._bearingSnap<Ct&&Ct<h._bearingSnap};Ge?(at(Ge.bearing||this._map.getBearing())&&(Ge.bearing=0),this._map.easeTo(Ge,{originalEvent:j})):(this._map.fire(new v.Event("moveend",{originalEvent:j})),at(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Xr.prototype._fireEvent=function(u,f){this._map.fire(new v.Event(u,f?{originalEvent:f}:{}))},Xr.prototype._requestFrame=function(){var u=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete u._frameId,u.handleEvent(new ml("renderFrame",{timeStamp:f})),u._applyChanges()})},Xr.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var mc=function(u){function f(l,h){u.call(this),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(l,h){return this.jumpTo({center:l},h)},f.prototype.panBy=function(l,h,x){return l=v.Point.convert(l).mult(-1),this.panTo(this.transform.center,v.extend({offset:l},h),x)},f.prototype.panTo=function(l,h,x){return this.easeTo(v.extend({center:l},h),x)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(l,h){return this.jumpTo({zoom:l},h),this},f.prototype.zoomTo=function(l,h,x){return this.easeTo(v.extend({zoom:l},h),x)},f.prototype.zoomIn=function(l,h){return this.zoomTo(this.getZoom()+1,l,h),this},f.prototype.zoomOut=function(l,h){return this.zoomTo(this.getZoom()-1,l,h),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(l,h){return this.jumpTo({bearing:l},h),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(l,h){return this.jumpTo({padding:l},h),this},f.prototype.rotateTo=function(l,h,x){return this.easeTo(v.extend({bearing:l},h),x)},f.prototype.resetNorth=function(l,h){return this.rotateTo(0,v.extend({duration:1e3},l),h),this},f.prototype.resetNorthPitch=function(l,h){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},l),h),this},f.prototype.snapToNorth=function(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(l,h){return this.jumpTo({pitch:l},h),this},f.prototype.cameraForBounds=function(l,h){l=v.LngLatBounds.convert(l);var x=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),x,h)},f.prototype._cameraForBoxAndBearing=function(l,h,x,S){var E={top:0,bottom:0,right:0,left:0};if(typeof(S=v.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var P=S.padding;S.padding={top:P,bottom:P,right:P,left:P}}S.padding=v.extend(E,S.padding);var R=this.transform,z=R.padding,j=R.project(v.LngLat.convert(l)),ee=R.project(v.LngLat.convert(h)),ne=j.rotate(-x*Math.PI/180),Ae=ee.rotate(-x*Math.PI/180),Se=new v.Point(Math.max(ne.x,Ae.x),Math.max(ne.y,Ae.y)),De=new v.Point(Math.min(ne.x,Ae.x),Math.min(ne.y,Ae.y)),ge=Se.sub(De),Fe=(R.width-(z.left+z.right+S.padding.left+S.padding.right))/ge.x,Ge=(R.height-(z.top+z.bottom+S.padding.top+S.padding.bottom))/ge.y;if(!(Ge<0||Fe<0)){var at=Math.min(R.scaleZoom(R.scale*Math.min(Fe,Ge)),S.maxZoom),Ct=typeof S.offset.x=="number"?new v.Point(S.offset.x,S.offset.y):v.Point.convert(S.offset),wt=new v.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(x*Math.PI/180),At=Ct.add(wt).mult(R.scale/R.zoomScale(at));return{center:R.unproject(j.add(ee).div(2).sub(At)),zoom:at,bearing:x}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(l,h,x){return this._fitInternal(this.cameraForBounds(l,h),h,x)},f.prototype.fitScreenCoordinates=function(l,h,x,S,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(l)),this.transform.pointLocation(v.Point.convert(h)),x,S),S,E)},f.prototype._fitInternal=function(l,h,x){return l?(delete(h=v.extend(l,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this},f.prototype.jumpTo=function(l,h){this.stop();var x=this.transform,S=!1,E=!1,P=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(S=!0,x.zoom=+l.zoom),l.center!==void 0&&(x.center=v.LngLat.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(E=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(P=!0,x.pitch=+l.pitch),l.padding==null||x.isPaddingEqual(l.padding)||(x.padding=l.padding),this.fire(new v.Event("movestart",h)).fire(new v.Event("move",h)),S&&this.fire(new v.Event("zoomstart",h)).fire(new v.Event("zoom",h)).fire(new v.Event("zoomend",h)),E&&this.fire(new v.Event("rotatestart",h)).fire(new v.Event("rotate",h)).fire(new v.Event("rotateend",h)),P&&this.fire(new v.Event("pitchstart",h)).fire(new v.Event("pitch",h)).fire(new v.Event("pitchend",h)),this.fire(new v.Event("moveend",h))},f.prototype.easeTo=function(l,h){var x=this;this._stop(!1,l.easeId),((l=v.extend({offset:[0,0],duration:500,easing:v.ease},l)).animate===!1||!l.essential&&v.browser.prefersReducedMotion)&&(l.duration=0);var S=this.transform,E=this.getZoom(),P=this.getBearing(),R=this.getPitch(),z=this.getPadding(),j="zoom"in l?+l.zoom:E,ee="bearing"in l?this._normalizeBearing(l.bearing,P):P,ne="pitch"in l?+l.pitch:R,Ae="padding"in l?l.padding:S.padding,Se=v.Point.convert(l.offset),De=S.centerPoint.add(Se),ge=S.pointLocation(De),Fe=v.LngLat.convert(l.center||ge);this._normalizeCenter(Fe);var Ge,at,Ct=S.project(ge),wt=S.project(Fe).sub(Ct),At=S.zoomScale(j-E);l.around&&(Ge=v.LngLat.convert(l.around),at=S.locationPoint(Ge));var Yt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==E,this._rotating=this._rotating||P!==ee,this._pitching=this._pitching||ne!==R,this._padding=!S.isPaddingEqual(Ae),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,Yt),this._ease(function(br){if(x._zooming&&(S.zoom=v.number(E,j,br)),x._rotating&&(S.bearing=v.number(P,ee,br)),x._pitching&&(S.pitch=v.number(R,ne,br)),x._padding&&(S.interpolatePadding(z,Ae,br),De=S.centerPoint.add(Se)),Ge)S.setLocationAtPoint(Ge,at);else{var pr=S.zoomScale(S.zoom-E),Fr=j>E?Math.min(2,At):Math.max(.5,At),rn=Math.pow(Fr,1-br),fn=S.unproject(Ct.add(wt.mult(br*rn)).mult(pr));S.setLocationAtPoint(S.renderWorldCopies?fn.wrap():fn,De)}x._fireMoveEvents(h)},function(br){x._afterEase(h,br)},l),this},f.prototype._prepareEase=function(l,h,x){x===void 0&&(x={}),this._moving=!0,h||x.moving||this.fire(new v.Event("movestart",l)),this._zooming&&!x.zooming&&this.fire(new v.Event("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new v.Event("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new v.Event("pitchstart",l))},f.prototype._fireMoveEvents=function(l){this.fire(new v.Event("move",l)),this._zooming&&this.fire(new v.Event("zoom",l)),this._rotating&&this.fire(new v.Event("rotate",l)),this._pitching&&this.fire(new v.Event("pitch",l))},f.prototype._afterEase=function(l,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var x=this._zooming,S=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new v.Event("zoomend",l)),S&&this.fire(new v.Event("rotateend",l)),E&&this.fire(new v.Event("pitchend",l)),this.fire(new v.Event("moveend",l))}},f.prototype.flyTo=function(l,h){var x=this;if(!l.essential&&v.browser.prefersReducedMotion){var S=v.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),l=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},l);var E=this.transform,P=this.getZoom(),R=this.getBearing(),z=this.getPitch(),j=this.getPadding(),ee="zoom"in l?v.clamp(+l.zoom,E.minZoom,E.maxZoom):P,ne="bearing"in l?this._normalizeBearing(l.bearing,R):R,Ae="pitch"in l?+l.pitch:z,Se="padding"in l?l.padding:E.padding,De=E.zoomScale(ee-P),ge=v.Point.convert(l.offset),Fe=E.centerPoint.add(ge),Ge=E.pointLocation(Fe),at=v.LngLat.convert(l.center||Ge);this._normalizeCenter(at);var Ct=E.project(Ge),wt=E.project(at).sub(Ct),At=l.curve,Yt=Math.max(E.width,E.height),br=Yt/De,pr=wt.mag();if("minZoom"in l){var Fr=v.clamp(Math.min(l.minZoom,P,ee),E.minZoom,E.maxZoom),rn=Yt/E.zoomScale(Fr-P);At=Math.sqrt(rn/pr*2)}var fn=At*At;function cn(Sn){var _n=(br*br-Yt*Yt+(Sn?-1:1)*fn*fn*pr*pr)/(2*(Sn?br:Yt)*fn*pr);return Math.log(Math.sqrt(_n*_n+1)-_n)}function hi(Sn){return(Math.exp(Sn)-Math.exp(-Sn))/2}function gr(Sn){return(Math.exp(Sn)+Math.exp(-Sn))/2}var Jr=cn(0),kn=function(Sn){return gr(Jr)/gr(Jr+At*Sn)},wn=function(Sn){return Yt*((gr(Jr)*(hi(_n=Jr+At*Sn)/gr(_n))-hi(Jr))/fn)/pr;var _n},vn=(cn(1)-Jr)/At;if(Math.abs(pr)<1e-6||!isFinite(vn)){if(Math.abs(Yt-br)<1e-6)return this.easeTo(l,h);var Zn=br<Yt?-1:1;vn=Math.abs(Math.log(br/Yt))/At,wn=function(){return 0},kn=function(Sn){return Math.exp(Zn*At*Sn)}}return l.duration="duration"in l?+l.duration:1e3*vn/("screenSpeed"in l?+l.screenSpeed/At:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=R!==ne,this._pitching=Ae!==z,this._padding=!E.isPaddingEqual(Se),this._prepareEase(h,!1),this._ease(function(Sn){var _n=Sn*vn,Ba=1/kn(_n);E.zoom=Sn===1?ee:P+E.scaleZoom(Ba),x._rotating&&(E.bearing=v.number(R,ne,Sn)),x._pitching&&(E.pitch=v.number(z,Ae,Sn)),x._padding&&(E.interpolatePadding(j,Se,Sn),Fe=E.centerPoint.add(ge));var Wi=Sn===1?at:E.unproject(Ct.add(wt.mult(wn(_n))).mult(Ba));E.setLocationAtPoint(E.renderWorldCopies?Wi.wrap():Wi,Fe),x._fireMoveEvents(h)},function(){return x._afterEase(h)},l),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,h)}if(!l){var S=this.handlers;S&&S.stop(!1)}return this},f.prototype._ease=function(l,h,x){x.animate===!1||x.duration===0?(l(1),h()):(this._easeStart=v.browser.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var l=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(l,h){l=v.wrap(l,-180,180);var x=Math.abs(l-h);return Math.abs(l-360-h)<x&&(l-=360),Math.abs(l+360-h)<x&&(l+=360),l},f.prototype._normalizeCenter=function(l){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var x=l.lng-h.center.lng;l.lng+=x>180?-360:x<-180?360:0}},f}(v.Evented),yo=function(u){u===void 0&&(u={}),this.options=u,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};yo.prototype.getDefaultPosition=function(){return"bottom-right"},yo.prototype.onAdd=function(u){var f=this.options&&this.options.compact;return this._map=u,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},yo.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},yo.prototype._setElementTitle=function(u,f){var l=this._map._getUIString("AttributionControl."+f);u.title=l,u.setAttribute("aria-label",l)},yo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},yo.prototype._updateEditLink=function(){var u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(u){var l=f.reduce(function(h,x,S){return x.value&&(h+=x.key+"="+x.value+(S<f.length-1?"&":"")),h},"?");u.href=v.config.FEEDBACK_URL+"/"+l+(this._map._hash?this._map._hash.getHashString(!0):""),u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}},yo.prototype._updateData=function(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},yo.prototype._updateAttributions=function(){if(this._map.style){var u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map(function(P){return typeof P!="string"?"":P})):typeof this.options.customAttribution=="string"&&u.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var l=this._map.style.sourceCaches;for(var h in l){var x=l[h];if(x.used){var S=x.getSource();S.attribution&&u.indexOf(S.attribution)<0&&u.push(S.attribution)}}u.sort(function(P,R){return P.length-R.length});var E=(u=u.filter(function(P,R){for(var z=R+1;z<u.length;z++)if(u[z].indexOf(P)>=0)return!1;return!0})).join(" | ");E!==this._attribHTML&&(this._attribHTML=E,u.length?(this._innerContainer.innerHTML=E,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},yo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Fa=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};Fa.prototype.onAdd=function(u){this._map=u,this._container=Z.create("div","mapboxgl-ctrl");var f=Z.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Fa.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Fa.prototype.getDefaultPosition=function(){return"bottom-left"},Fa.prototype._updateLogo=function(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Fa.prototype._logoRequired=function(){if(this._map.style){var u=this._map.style.sourceCaches;for(var f in u)if(u[f].getSource().mapbox_logo)return!0;return!1}},Fa.prototype._updateCompact=function(){var u=this._container.children;if(u.length){var f=u[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var ya=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ya.prototype.add=function(u){var f=++this._id;return this._queue.push({callback:u,id:f,cancelled:!1}),f},ya.prototype.remove=function(u){for(var f=this._currentlyRunning,l=0,h=f?this._queue.concat(f):this._queue;l<h.length;l+=1){var x=h[l];if(x.id===u)return void(x.cancelled=!0)}},ya.prototype.run=function(u){u===void 0&&(u=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var l=0,h=f;l<h.length;l+=1){var x=h[l];if(!x.cancelled&&(x.callback(u),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ya.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ss=v.window.HTMLImageElement,yl=v.window.HTMLElement,pi=v.window.ImageBitmap,pa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Hc=function(u){function f(h){var x=this;if((h=v.extend({},pa,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new ii(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(u.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new ya,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},ta,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new v.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=v.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof yl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return x._update(!1)}),this.on("moveend",function(){return x._update(!1)}),this.on("zoom",function(){return x._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Xr(this,h),this._hash=h.hash&&new xs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,v.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new yo({customAttribution:h.customAttribution})),this.addControl(new Fa,h.logoPosition),this.on("style.load",function(){x.transform.unmodified&&x.jumpTo(x.style.stylesheet)}),this.on("data",function(E){x._update(E.dataType==="style"),x.fire(new v.Event(E.dataType+"data",E))}),this.on("dataloading",function(E){x.fire(new v.Event(E.dataType+"dataloading",E))})}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(h,x){if(x===void 0&&(x=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var E=this._controlPositions[x];return x.indexOf("bottom")!==-1?E.insertBefore(S,E.firstChild):E.appendChild(S),this},f.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var x=this._controls.indexOf(h);return x>-1&&this._controls.splice(x,1),h.onRemove(this),this},f.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},f.prototype.resize=function(h){var x=this._containerDimensions(),S=x[0],E=x[1];this._resizeCanvas(S,E),this.transform.resize(S,E),this.painter.resize(S,E);var P=!this._moving;return P&&(this.stop(),this.fire(new v.Event("movestart",h)).fire(new v.Event("move",h))),this.fire(new v.Event("resize",h)),P&&this.fire(new v.Event("moveend",h)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(v.LngLatBounds.convert(h)),this._update()},f.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},f.prototype.project=function(h){return this.transform.locationPoint(v.LngLat.convert(h))},f.prototype.unproject=function(h){return this.transform.pointLocation(v.Point.convert(h))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(h,x,S){var E,P=this;if(h==="mouseenter"||h==="mouseover"){var R=!1;return{layer:x,listener:S,delegates:{mousemove:function(j){var ee=P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[];ee.length?R||(R=!0,S.call(P,new fa(h,P,j.originalEvent,{features:ee}))):R=!1},mouseout:function(){R=!1}}}}if(h==="mouseleave"||h==="mouseout"){var z=!1;return{layer:x,listener:S,delegates:{mousemove:function(j){(P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[]).length?z=!0:z&&(z=!1,S.call(P,new fa(h,P,j.originalEvent)))},mouseout:function(j){z&&(z=!1,S.call(P,new fa(h,P,j.originalEvent)))}}}}return{layer:x,listener:S,delegates:(E={},E[h]=function(j){var ee=P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[];ee.length&&(j.features=ee,S.call(P,j),delete j.features)},E)}},f.prototype.on=function(h,x,S){if(S===void 0)return u.prototype.on.call(this,h,x);var E=this._createDelegatedListener(h,x,S);for(var P in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(E),E.delegates)this.on(P,E.delegates[P]);return this},f.prototype.once=function(h,x,S){if(S===void 0)return u.prototype.once.call(this,h,x);var E=this._createDelegatedListener(h,x,S);for(var P in E.delegates)this.once(P,E.delegates[P]);return this},f.prototype.off=function(h,x,S){var E=this;return S===void 0?u.prototype.off.call(this,h,x):(this._delegatedListeners&&this._delegatedListeners[h]&&function(P){for(var R=P[h],z=0;z<R.length;z++){var j=R[z];if(j.layer===x&&j.listener===S){for(var ee in j.delegates)E.off(ee,j.delegates[ee]);return R.splice(z,1),E}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(h,x){if(!this.style)return[];var S;if(x!==void 0||h===void 0||h instanceof v.Point||Array.isArray(h)||(x=h,h=void 0),x=x||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof h[0]=="number")S=[v.Point.convert(h)];else{var E=v.Point.convert(h[0]),P=v.Point.convert(h[1]);S=[E,new v.Point(P.x,E.y),P,new v.Point(E.x,P.y),E]}return this.style.queryRenderedFeatures(S,x,this.transform)},f.prototype.querySourceFeatures=function(h,x){return this.style.querySourceFeatures(h,x)},f.prototype.setStyle=function(h,x){return(x=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},x)).diff!==!1&&x.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,x),this):(this._localIdeographFontFamily=x.localIdeographFontFamily,this._updateStyle(h,x))},f.prototype._getUIString=function(h){var x=this._locale[h];if(x==null)throw new Error("Missing UI string '"+h+"'");return x},f.prototype._updateStyle=function(h,x){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Eo(this,x||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Eo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(h,x){var S=this;if(typeof h=="string"){var E=this._requestManager.normalizeStyleURL(h),P=this._requestManager.transformRequest(E,v.ResourceType.Style);v.getJSON(P,function(R,z){R?S.fire(new v.ErrorEvent(R)):z&&S._updateDiff(z,x)})}else typeof h=="object"&&this._updateDiff(h,x)},f.prototype._updateDiff=function(h,x){try{this.style.setState(h)&&this._update(!0)}catch(S){v.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,x)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(h,x){return this._lazyInitEmptyStyle(),this.style.addSource(h,x),this._update(!0)},f.prototype.isSourceLoaded=function(h){var x=this.style&&this.style.sourceCaches[h];if(x!==void 0)return x.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},f.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var x in h){var S=h[x]._tiles;for(var E in S){var P=S[E];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(h,x,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,x,S)},f.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},f.prototype.getSource=function(h){return this.style.getSource(h)},f.prototype.addImage=function(h,x,S){S===void 0&&(S={});var E=S.pixelRatio;E===void 0&&(E=1);var P=S.sdf;P===void 0&&(P=!1);var R=S.stretchX,z=S.stretchY,j=S.content;if(this._lazyInitEmptyStyle(),x instanceof Ss||pi&&x instanceof pi){var ee=v.browser.getImageData(x);this.style.addImage(h,{data:new v.RGBAImage({width:ee.width,height:ee.height},ee.data),pixelRatio:E,stretchX:R,stretchY:z,content:j,sdf:P,version:0})}else{if(x.width===void 0||x.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ne=x;this.style.addImage(h,{data:new v.RGBAImage({width:x.width,height:x.height},new Uint8Array(x.data)),pixelRatio:E,stretchX:R,stretchY:z,content:j,sdf:P,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,h)}},f.prototype.updateImage=function(h,x){var S=this.style.getImage(h);if(!S)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var E=x instanceof Ss||pi&&x instanceof pi?v.browser.getImageData(x):x,P=E.width,R=E.height,z=E.data;return P===void 0||R===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):P!==S.data.width||R!==S.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(z,!(x instanceof Ss||pi&&x instanceof pi)),void this.style.updateImage(h,S))},f.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(h){this.style.removeImage(h)},f.prototype.loadImage=function(h,x){v.getImage(this._requestManager.transformRequest(h,v.ResourceType.Image),x)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(h,x){return this._lazyInitEmptyStyle(),this.style.addLayer(h,x),this._update(!0)},f.prototype.moveLayer=function(h,x){return this.style.moveLayer(h,x),this._update(!0)},f.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},f.prototype.getLayer=function(h){return this.style.getLayer(h)},f.prototype.setLayerZoomRange=function(h,x,S){return this.style.setLayerZoomRange(h,x,S),this._update(!0)},f.prototype.setFilter=function(h,x,S){return S===void 0&&(S={}),this.style.setFilter(h,x,S),this._update(!0)},f.prototype.getFilter=function(h){return this.style.getFilter(h)},f.prototype.setPaintProperty=function(h,x,S,E){return E===void 0&&(E={}),this.style.setPaintProperty(h,x,S,E),this._update(!0)},f.prototype.getPaintProperty=function(h,x){return this.style.getPaintProperty(h,x)},f.prototype.setLayoutProperty=function(h,x,S,E){return E===void 0&&(E={}),this.style.setLayoutProperty(h,x,S,E),this._update(!0)},f.prototype.getLayoutProperty=function(h,x){return this.style.getLayoutProperty(h,x)},f.prototype.setLight=function(h,x){return x===void 0&&(x={}),this._lazyInitEmptyStyle(),this.style.setLight(h,x),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(h,x){return this.style.setFeatureState(h,x),this._update()},f.prototype.removeFeatureState=function(h,x){return this.style.removeFeatureState(h,x),this._update()},f.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var h=0,x=0;return this._container&&(h=this._container.clientWidth||400,x=this._container.clientHeight||300),[h,x]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var x=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",h);this._interactive&&x.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",x),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var E=this._controlContainer=Z.create("div","mapboxgl-control-container",h),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(R){P[R]=Z.create("div","mapboxgl-ctrl-"+R,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(h,x){var S=v.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*x,this._canvas.style.width=h+"px",this._canvas.style.height=x+"px"},f.prototype._setupPainter=function(){var h=v.extend({},be.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),x=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);x?(this.painter=new $r(x,this.transform),v.webpSupported.testSupport(x)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:h}))},f.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:h}))},f.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},f.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},f.prototype._render=function(h){var x,S=this,E=0,P=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(x=P.createQueryEXT(),P.beginQueryEXT(P.TIME_ELAPSED_EXT,x),E=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var R=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var z=this.transform.zoom,j=v.browser.now();this.style.zoomHistory.update(z,j);var ee=new v.EvaluationParameters(z,{now:j,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ne=ee.crossFadingFactor();ne===1&&ne===this._crossFadingFactor||(R=!0,this._crossFadingFactor=ne),this.style.update(ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||R)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ae=v.browser.now()-E;P.endQueryEXT(P.TIME_ELAPSED_EXT,x),setTimeout(function(){var ge=P.getQueryObjectEXT(x,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(x),S.fire(new v.Event("gpu-timing-frame",{cpuTime:Ae,gpuTime:ge}))},50)}if(this.listens("gpu-timing-layer")){var Se=this.painter.collectGpuTimers();setTimeout(function(){var ge=S.painter.queryGpuTimers(Se);S.fire(new v.Event("gpu-timing-layer",{layerTimes:ge}))},50)}var De=this._sourcesDirty||this._styleDirty||this._placementDirty;return De||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||De||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,x=this._controls;h<x.length;h+=1)x[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Vu(this._canvasContainer),Vu(this._controlContainer),Vu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(x){h._frame=null,h._render(x)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},l.showTileBoundaries.get=function(){return!!this._showTileBoundaries},l.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},l.showPadding.get=function(){return!!this._showPadding},l.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},l.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},l.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},l.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},l.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},l.repaint.get=function(){return!!this._repaint},l.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},l.vertices.get=function(){return!!this._vertices},l.vertices.set=function(h){this._vertices=h,this._update()},f.prototype._setCacheLimits=function(h,x){v.setCacheLimits(h,x)},l.version.get=function(){return v.version},Object.defineProperties(f.prototype,l),f}(mc);function Vu(u){u.parentNode&&u.parentNode.removeChild(u)}var Wc={showCompass:!0,showZoom:!0,visualizePitch:!1},eu=function(u){var f=this;this.options=v.extend({},Wc,u),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(l){return l.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(l){return f._map.zoomIn({},{originalEvent:l})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(l){return f._map.zoomOut({},{originalEvent:l})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(l){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:l}):f._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};eu.prototype._updateZoomButtons=function(){var u=this._map.getZoom(),f=u===this._map.getMaxZoom(),l=u===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},eu.prototype._rotateCompassArrow=function(){var u=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=u},eu.prototype.onAdd=function(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zo(this._map,this._compass,this.options.visualizePitch)),this._container},eu.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},eu.prototype._createButton=function(u,f){var l=Z.create("button",u,this._container);return l.type="button",l.addEventListener("click",f),l},eu.prototype._setButtonTitle=function(u,f){var l=this._map._getUIString("NavigationControl."+f);u.title=l,u.setAttribute("aria-label",l)};var zo=function(u,f,l){l===void 0&&(l=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new vl({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,l&&(this.mousePitch=new Uu({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(f,"mousedown",this.mousedown),Z.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(f,"touchmove",this.touchmove),Z.addEventListener(f,"touchend",this.touchend),Z.addEventListener(f,"touchcancel",this.reset)};function Zo(u,f,l){if(u=new v.LngLat(u.lng,u.lat),f){var h=new v.LngLat(u.lng-360,u.lat),x=new v.LngLat(u.lng+360,u.lat),S=l.locationPoint(u).distSqr(f);l.locationPoint(h).distSqr(f)<S?u=h:l.locationPoint(x).distSqr(f)<S&&(u=x)}for(;Math.abs(u.lng-l.center.lng)>180;){var E=l.locationPoint(u);if(E.x>=0&&E.y>=0&&E.x<=l.width&&E.y<=l.height)break;u.lng>l.center.lng?u.lng-=360:u.lng+=360}return u}zo.prototype.down=function(u,f){this.mouseRotate.mousedown(u,f),this.mousePitch&&this.mousePitch.mousedown(u,f),Z.disableDrag()},zo.prototype.move=function(u,f){var l=this.map,h=this.mouseRotate.mousemoveWindow(u,f);if(h&&h.bearingDelta&&l.setBearing(l.getBearing()+h.bearingDelta),this.mousePitch){var x=this.mousePitch.mousemoveWindow(u,f);x&&x.pitchDelta&&l.setPitch(l.getPitch()+x.pitchDelta)}},zo.prototype.off=function(){var u=this.element;Z.removeEventListener(u,"mousedown",this.mousedown),Z.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(u,"touchmove",this.touchmove),Z.removeEventListener(u,"touchend",this.touchend),Z.removeEventListener(u,"touchcancel",this.reset),this.offTemp()},zo.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(v.window,"mousemove",this.mousemove),Z.removeEventListener(v.window,"mouseup",this.mouseup)},zo.prototype.mousedown=function(u){this.down(v.extend({},u,{ctrlKey:!0,preventDefault:function(){return u.preventDefault()}}),Z.mousePos(this.element,u)),Z.addEventListener(v.window,"mousemove",this.mousemove),Z.addEventListener(v.window,"mouseup",this.mouseup)},zo.prototype.mousemove=function(u){this.move(u,Z.mousePos(this.element,u))},zo.prototype.mouseup=function(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()},zo.prototype.touchstart=function(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return u.preventDefault()}},this._startPos))},zo.prototype.touchmove=function(u){u.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,u.targetTouches)[0],this.move({preventDefault:function(){return u.preventDefault()}},this._lastPos))},zo.prototype.touchend=function(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ga(u,f,l){var h=u.classList;for(var x in tu)h.remove("mapboxgl-"+l+"-anchor-"+x);h.add("mapboxgl-"+l+"-anchor-"+f)}var re,Vl=function(u){function f(l,h){if(u.call(this),(l instanceof v.window.HTMLElement||h)&&(l=v.extend({element:l},h)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=v.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var x=Z.createNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","41px"),x.setAttributeNS(null,"width","27px"),x.setAttributeNS(null,"viewBox","0 0 27 41");var S=Z.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var E=Z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");for(var R=0,z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];R<z.length;R+=1){var j=z[R],ee=Z.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",j.rx),ee.setAttributeNS(null,"ry",j.ry),P.appendChild(ee)}var ne=Z.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"fill",this._color);var Ae=Z.createNS("http://www.w3.org/2000/svg","path");Ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ne.appendChild(Ae);var Se=Z.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"opacity","0.25"),Se.setAttributeNS(null,"fill","#000000");var De=Z.createNS("http://www.w3.org/2000/svg","path");De.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Se.appendChild(De);var ge=Z.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");var Fe=Z.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ge=Z.createNS("http://www.w3.org/2000/svg","circle");Ge.setAttributeNS(null,"fill","#000000"),Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"cx","5.5"),Ge.setAttributeNS(null,"cy","5.5"),Ge.setAttributeNS(null,"r","5.4999962");var at=Z.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#FFFFFF"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962"),Fe.appendChild(Ge),Fe.appendChild(at),E.appendChild(P),E.appendChild(ne),E.appendChild(Se),E.appendChild(ge),E.appendChild(Fe),x.appendChild(E),x.setAttributeNS(null,"height",41*this._scale+"px"),x.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(x),this._offset=v.Point.convert(l&&l.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ct){Ct.preventDefault()}),this._element.addEventListener("mousedown",function(Ct){Ct.preventDefault()}),ga(this._element,this._anchor,"marker"),this._popup=null}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.addTo=function(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(l){return this._lngLat=v.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(l){var h=l.code,x=l.charCode||l.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()},f.prototype._onMapClick=function(l){var h=l.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this},f.prototype._update=function(l){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Zo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x="rotateX("+this._map.getPitch()+"deg)"),l&&l.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,tu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+x+" "+h)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(l){return this._offset=v.Point.convert(l),this._update(),this},f.prototype._onMove=function(l){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(l){return this._rotation=l||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(l){return this._rotationAlignment=l||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Xc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},gl=0,Eu=!1,yc=function(u){function f(l){u.call(this),this.options=v.extend({},Xc,l),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.onAdd=function(l){var h;return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,re!==void 0?h(re):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(x){h(re=x.state!=="denied")}):h(re=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gl=0,Eu=!1},f.prototype._isOutOfMapMaxBounds=function(l){var h=this._map.getMaxBounds(),x=l.coords;return h&&(x.longitude<h.getWest()||x.longitude>h.getEast()||x.latitude<h.getSouth()||x.latitude>h.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",l)),this._finish()}},f.prototype._updateCamera=function(l){var h=new v.LngLat(l.coords.longitude,l.coords.latitude),x=l.coords.accuracy,S=this._map.getBearing(),E=v.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(x),E,{geolocateSource:!0})},f.prototype._updateMarker=function(l){if(l){var h=new v.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var l=this._map._container.clientHeight/2,h=this._map.unproject([0,l]),x=this._map.unproject([1,l]),S=h.distanceTo(x),E=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=E+"px",this._circleElement.style.height=E+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Eu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",l)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(l){var h=this;if(this._container.addEventListener("contextmenu",function(E){return E.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",l===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Vl(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(E){E.geolocateSource||h._watchState!=="ACTIVE_LOCK"||E.originalEvent&&E.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gl--,Eu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++gl>1?(l={maximumAge:6e5,timeout:0},Eu=!0):(l=this.options.positionOptions,Eu=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),Cu={maxWidth:100,unit:"metric"},ps=function(u){this.options=v.extend({},Cu,u),v.bindAll(["_onMove","setUnit"],this)};function _l(u,f,l){var h=l&&l.maxWidth||100,x=u._container.clientHeight/2,S=u.unproject([0,x]),E=u.unproject([h,x]),P=S.distanceTo(E);if(l&&l.unit==="imperial"){var R=3.2808*P;R>5280?Es(f,h,R/5280,u._getUIString("ScaleControl.Miles")):Es(f,h,R,u._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Es(f,h,P/1852,u._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Es(f,h,P/1e3,u._getUIString("ScaleControl.Kilometers")):Es(f,h,P,u._getUIString("ScaleControl.Meters"))}function Es(u,f,l,h){var x,S,E,P=(x=l,(S=Math.pow(10,(""+Math.floor(x)).length-1))*(E=(E=x/S)>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(R){var z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(E)));u.style.width=f*(P/l)+"px",u.innerHTML=P+"&nbsp;"+h}ps.prototype.getDefaultPosition=function(){return"bottom-left"},ps.prototype._onMove=function(){_l(this._map,this._container,this.options)},ps.prototype.onAdd=function(u){return this._map=u,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ps.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ps.prototype.setUnit=function(u){this.options.unit=u,_l(this._map,this._container,this.options)};var hs=function(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof v.window.HTMLElement?this._container=u.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};hs.prototype.onAdd=function(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},hs.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},hs.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},hs.prototype._setupUI=function(){var u=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden",!0),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},hs.prototype._updateTitle=function(){var u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u},hs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},hs.prototype._isFullscreen=function(){return this._fullscreen},hs.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},hs.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Yc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qc=function(u){function f(l){u.call(this),this.options=v.extend(Object.create(Yc),l),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.addTo=function(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(l){return this._lngLat=v.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(l){return this.setDOMContent(v.window.document.createTextNode(l))},f.prototype.setHTML=function(l){var h,x=v.window.document.createDocumentFragment(),S=v.window.document.createElement("body");for(S.innerHTML=l;h=S.firstChild;)x.appendChild(h);return this.setDOMContent(x)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(l){return this.options.maxWidth=l,this._update(),this},f.prototype.setDOMContent=function(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(l){this._container&&this._container.classList.add(l)},f.prototype.removeClassName=function(l){this._container&&this._container.classList.remove(l)},f.prototype.setOffset=function(l){return this.options.offset=l,this._update(),this},f.prototype.toggleClassName=function(l){if(this._container)return this._container.classList.toggle(l)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(l){this._update(l.point)},f.prototype._onMouseMove=function(l){this._update(l.point)},f.prototype._onDrag=function(l){this._update(l.point)},f.prototype._update=function(l){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ee){return h._container.classList.add(ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||l)){var x=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat),S=this.options.anchor,E=function ee(ne){if(ne){if(typeof ne=="number"){var Ae=Math.round(Math.sqrt(.5*Math.pow(ne,2)));return{center:new v.Point(0,0),top:new v.Point(0,ne),"top-left":new v.Point(Ae,Ae),"top-right":new v.Point(-Ae,Ae),bottom:new v.Point(0,-ne),"bottom-left":new v.Point(Ae,-Ae),"bottom-right":new v.Point(-Ae,-Ae),left:new v.Point(ne,0),right:new v.Point(-ne,0)}}if(ne instanceof v.Point||Array.isArray(ne)){var Se=v.Point.convert(ne);return{center:Se,top:Se,"top-left":Se,"top-right":Se,bottom:Se,"bottom-left":Se,"bottom-right":Se,left:Se,right:Se}}return{center:v.Point.convert(ne.center||[0,0]),top:v.Point.convert(ne.top||[0,0]),"top-left":v.Point.convert(ne["top-left"]||[0,0]),"top-right":v.Point.convert(ne["top-right"]||[0,0]),bottom:v.Point.convert(ne.bottom||[0,0]),"bottom-left":v.Point.convert(ne["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(ne["bottom-right"]||[0,0]),left:v.Point.convert(ne.left||[0,0]),right:v.Point.convert(ne.right||[0,0])}}return ee(new v.Point(0,0))}(this.options.offset);if(!S){var P,R=this._container.offsetWidth,z=this._container.offsetHeight;P=x.y+E.bottom.y<z?["top"]:x.y>this._map.transform.height-z?["bottom"]:[],x.x<R/2?P.push("left"):x.x>this._map.transform.width-R/2&&P.push("right"),S=P.length===0?"bottom":P.join("-")}var j=x.add(E[S]).round();Z.setTransform(this._container,tu[S]+" translate("+j.x+"px,"+j.y+"px)"),ga(this._container,S,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var l=this._container.querySelector(Gl);l&&l.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),Kc={version:v.version,supported:be,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Hc,NavigationControl:eu,GeolocateControl:yc,AttributionControl:yo,ScaleControl:ps,FullscreenControl:hs,Popup:qc,Marker:Vl,Style:Eo,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Rt().acquire(pt)},clearPrewarmedResources:function(){var u=Wr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(pt),Wr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(u){v.config.ACCESS_TOKEN=u},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(u){v.config.API_URL=u},get workerCount(){return er.workerCount},set workerCount(u){er.workerCount=u},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){v.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage:function(u){v.clearTileCache(u)},workerUrl:""};return Kc}),Me})},28660:function(dr,X,G){var Me=G(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ve;(function(v){(function(be){var Z=typeof G.g=="object"?G.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),se=me(v);typeof Z.Reflect=="undefined"?Z.Reflect=v:se=me(Z.Reflect,se),be(se);function me(ae,fe){return function(Q,we){typeof ae[Q]!="function"&&Object.defineProperty(ae,Q,{configurable:!0,writable:!0,value:we}),fe&&fe(Q,we)}}})(function(be){var Z=Object.prototype.hasOwnProperty,se=typeof Symbol=="function",me=se&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ae=se&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",fe=typeof Object.create=="function",Q={__proto__:[]}instanceof Array,we=!fe&&!Q,Oe={create:fe?function(){return as(Object.create(null))}:Q?function(){return as({__proto__:null})}:function(){return as({})},has:we?function(bt,Xt){return Z.call(bt,Xt)}:function(bt,Xt){return Xt in bt},get:we?function(bt,Xt){return Z.call(bt,Xt)?bt[Xt]:void 0}:function(bt,Xt){return bt[Xt]}},M=Object.getPrototypeOf(Function),Jt=typeof Me=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Gt=!Jt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Wo(),Dt=!Jt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:cu(),Ut=!Jt&&typeof WeakMap=="function"?WeakMap:is(),ct=new Ut;function dt(bt,Xt,Tr,Ur){if(qr(Tr)){if(!da(bt))throw new TypeError;if(!Ti(Xt))throw new TypeError;return Or(bt,Xt)}else{if(!da(bt))throw new TypeError;if(!An(Xt))throw new TypeError;if(!An(Ur)&&!qr(Ur)&&!Si(Ur))throw new TypeError;return Si(Ur)&&(Ur=void 0),Tr=Ei(Tr),Gr(bt,Xt,Tr,Ur)}}be("decorate",dt);function Mr(bt,Xt){function Tr(Ur,dn){if(!An(Ur))throw new TypeError;if(!qr(dn)&&!lo(dn))throw new TypeError;H(bt,Xt,Ur,dn)}return Tr}be("metadata",Mr);function cr(bt,Xt,Tr,Ur){if(!An(Tr))throw new TypeError;return qr(Ur)||(Ur=Ei(Ur)),H(bt,Xt,Tr,Ur)}be("defineMetadata",cr);function Ft(bt,Xt,Tr){if(!An(Xt))throw new TypeError;return qr(Tr)||(Tr=Ei(Tr)),Ve(bt,Xt,Tr)}be("hasMetadata",Ft);function st(bt,Xt,Tr){if(!An(Xt))throw new TypeError;return qr(Tr)||(Tr=Ei(Tr)),ke(bt,Xt,Tr)}be("hasOwnMetadata",st);function He(bt,Xt,Tr){if(!An(Xt))throw new TypeError;return qr(Tr)||(Tr=Ei(Tr)),vt(bt,Xt,Tr)}be("getMetadata",He);function ut(bt,Xt,Tr){if(!An(Xt))throw new TypeError;return qr(Tr)||(Tr=Ei(Tr)),qe(bt,Xt,Tr)}be("getOwnMetadata",ut);function Ye(bt,Xt){if(!An(bt))throw new TypeError;return qr(Xt)||(Xt=Ei(Xt)),Je(bt,Xt)}be("getMetadataKeys",Ye);function kt(bt,Xt){if(!An(bt))throw new TypeError;return qr(Xt)||(Xt=Ei(Xt)),Et(bt,Xt)}be("getOwnMetadataKeys",kt);function ur(bt,Xt,Tr){if(!An(Xt))throw new TypeError;qr(Tr)||(Tr=Ei(Tr));var Ur=Ee(Xt,Tr,!1);if(qr(Ur)||!Ur.delete(bt))return!1;if(Ur.size>0)return!0;var dn=ct.get(Xt);return dn.delete(Tr),dn.size>0||ct.delete(Xt),!0}be("deleteMetadata",ur);function Or(bt,Xt){for(var Tr=bt.length-1;Tr>=0;--Tr){var Ur=bt[Tr],dn=Ur(Xt);if(!qr(dn)&&!Si(dn)){if(!Ti(dn))throw new TypeError;Xt=dn}}return Xt}function Gr(bt,Xt,Tr,Ur){for(var dn=bt.length-1;dn>=0;--dn){var ui=bt[dn],Rn=ui(Xt,Tr,Ur);if(!qr(Rn)&&!Si(Rn)){if(!An(Rn))throw new TypeError;Ur=Rn}}return Ur}function Ee(bt,Xt,Tr){var Ur=ct.get(bt);if(qr(Ur)){if(!Tr)return;Ur=new Gt,ct.set(bt,Ur)}var dn=Ur.get(Xt);if(qr(dn)){if(!Tr)return;dn=new Gt,Ur.set(Xt,dn)}return dn}function Ve(bt,Xt,Tr){var Ur=ke(bt,Xt,Tr);if(Ur)return!0;var dn=ki(Xt);return Si(dn)?!1:Ve(bt,dn,Tr)}function ke(bt,Xt,Tr){var Ur=Ee(Xt,Tr,!1);return qr(Ur)?!1:un(Ur.has(bt))}function vt(bt,Xt,Tr){var Ur=ke(bt,Xt,Tr);if(Ur)return qe(bt,Xt,Tr);var dn=ki(Xt);if(!Si(dn))return vt(bt,dn,Tr)}function qe(bt,Xt,Tr){var Ur=Ee(Xt,Tr,!1);if(!qr(Ur))return Ur.get(bt)}function H(bt,Xt,Tr,Ur){var dn=Ee(Tr,Ur,!0);dn.set(bt,Xt)}function Je(bt,Xt){var Tr=Et(bt,Xt),Ur=ki(bt);if(Ur===null)return Tr;var dn=Je(Ur,Xt);if(dn.length<=0)return Tr;if(Tr.length<=0)return dn;for(var ui=new Dt,Rn=[],$n=0,Mn=Tr;$n<Mn.length;$n++){var di=Mn[$n],ni=ui.has(di);ni||(ui.add(di),Rn.push(di))}for(var to=0,wo=dn;to<wo.length;to++){var di=wo[to],ni=ui.has(di);ni||(ui.add(di),Rn.push(di))}return Rn}function Et(bt,Xt){var Tr=[],Ur=Ee(bt,Xt,!1);if(qr(Ur))return Tr;for(var dn=Ur.keys(),ui=Pi(dn),Rn=0;;){var $n=le(ui);if(!$n)return Tr.length=Rn,Tr;var Mn=bo($n);try{Tr[Rn]=Mn}catch(di){try{Ha(ui)}finally{throw di}}Rn++}}function gt(bt){if(bt===null)return 1;switch(typeof bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return bt===null?1:6;default:return 6}}function qr(bt){return bt===void 0}function Si(bt){return bt===null}function On(bt){return typeof bt=="symbol"}function An(bt){return typeof bt=="object"?bt!==null:typeof bt=="function"}function gn(bt,Xt){switch(gt(bt)){case 0:return bt;case 1:return bt;case 2:return bt;case 3:return bt;case 4:return bt;case 5:return bt}var Tr=Xt===3?"string":Xt===5?"number":"default",Ur=Mi(bt,me);if(Ur!==void 0){var dn=Ur.call(bt,Tr);if(An(dn))throw new TypeError;return dn}return Cn(bt,Tr==="default"?"number":Tr)}function Cn(bt,Xt){if(Xt==="string"){var Tr=bt.toString;if(sa(Tr)){var Ur=Tr.call(bt);if(!An(Ur))return Ur}var dn=bt.valueOf;if(sa(dn)){var Ur=dn.call(bt);if(!An(Ur))return Ur}}else{var dn=bt.valueOf;if(sa(dn)){var Ur=dn.call(bt);if(!An(Ur))return Ur}var ui=bt.toString;if(sa(ui)){var Ur=ui.call(bt);if(!An(Ur))return Ur}}throw new TypeError}function un(bt){return!!bt}function Oi(bt){return""+bt}function Ei(bt){var Xt=gn(bt,3);return On(Xt)?Xt:Oi(Xt)}function da(bt){return Array.isArray?Array.isArray(bt):bt instanceof Object?bt instanceof Array:Object.prototype.toString.call(bt)==="[object Array]"}function sa(bt){return typeof bt=="function"}function Ti(bt){return typeof bt=="function"}function lo(bt){switch(gt(bt)){case 3:return!0;case 4:return!0;default:return!1}}function Mi(bt,Xt){var Tr=bt[Xt];if(Tr!=null){if(!sa(Tr))throw new TypeError;return Tr}}function Pi(bt){var Xt=Mi(bt,ae);if(!sa(Xt))throw new TypeError;var Tr=Xt.call(bt);if(!An(Tr))throw new TypeError;return Tr}function bo(bt){return bt.value}function le(bt){var Xt=bt.next();return Xt.done?!1:Xt}function Ha(bt){var Xt=bt.return;Xt&&Xt.call(bt)}function ki(bt){var Xt=Object.getPrototypeOf(bt);if(typeof bt!="function"||bt===M||Xt!==M)return Xt;var Tr=bt.prototype,Ur=Tr&&Object.getPrototypeOf(Tr);if(Ur==null||Ur===Object.prototype)return Xt;var dn=Ur.constructor;return typeof dn!="function"||dn===bt?Xt:dn}function Wo(){var bt={},Xt=[],Tr=function(){function Rn($n,Mn,di){this._index=0,this._keys=$n,this._values=Mn,this._selector=di}return Rn.prototype["@@iterator"]=function(){return this},Rn.prototype[ae]=function(){return this},Rn.prototype.next=function(){var $n=this._index;if($n>=0&&$n<this._keys.length){var Mn=this._selector(this._keys[$n],this._values[$n]);return $n+1>=this._keys.length?(this._index=-1,this._keys=Xt,this._values=Xt):this._index++,{value:Mn,done:!1}}return{value:void 0,done:!0}},Rn.prototype.throw=function($n){throw this._index>=0&&(this._index=-1,this._keys=Xt,this._values=Xt),$n},Rn.prototype.return=function($n){return this._index>=0&&(this._index=-1,this._keys=Xt,this._values=Xt),{value:$n,done:!0}},Rn}();return function(){function Rn(){this._keys=[],this._values=[],this._cacheKey=bt,this._cacheIndex=-2}return Object.defineProperty(Rn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Rn.prototype.has=function($n){return this._find($n,!1)>=0},Rn.prototype.get=function($n){var Mn=this._find($n,!1);return Mn>=0?this._values[Mn]:void 0},Rn.prototype.set=function($n,Mn){var di=this._find($n,!0);return this._values[di]=Mn,this},Rn.prototype.delete=function($n){var Mn=this._find($n,!1);if(Mn>=0){for(var di=this._keys.length,ni=Mn+1;ni<di;ni++)this._keys[ni-1]=this._keys[ni],this._values[ni-1]=this._values[ni];return this._keys.length--,this._values.length--,$n===this._cacheKey&&(this._cacheKey=bt,this._cacheIndex=-2),!0}return!1},Rn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=bt,this._cacheIndex=-2},Rn.prototype.keys=function(){return new Tr(this._keys,this._values,Ur)},Rn.prototype.values=function(){return new Tr(this._keys,this._values,dn)},Rn.prototype.entries=function(){return new Tr(this._keys,this._values,ui)},Rn.prototype["@@iterator"]=function(){return this.entries()},Rn.prototype[ae]=function(){return this.entries()},Rn.prototype._find=function($n,Mn){return this._cacheKey!==$n&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=$n)),this._cacheIndex<0&&Mn&&(this._cacheIndex=this._keys.length,this._keys.push($n),this._values.push(void 0)),this._cacheIndex},Rn}();function Ur(Rn,$n){return Rn}function dn(Rn,$n){return $n}function ui(Rn,$n){return[Rn,$n]}}function cu(){return function(){function bt(){this._map=new Gt}return Object.defineProperty(bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),bt.prototype.has=function(Xt){return this._map.has(Xt)},bt.prototype.add=function(Xt){return this._map.set(Xt,Xt),this},bt.prototype.delete=function(Xt){return this._map.delete(Xt)},bt.prototype.clear=function(){this._map.clear()},bt.prototype.keys=function(){return this._map.keys()},bt.prototype.values=function(){return this._map.values()},bt.prototype.entries=function(){return this._map.entries()},bt.prototype["@@iterator"]=function(){return this.keys()},bt.prototype[ae]=function(){return this.keys()},bt}()}function is(){var bt=16,Xt=Oe.create(),Tr=Ur();return function(){function Mn(){this._key=Ur()}return Mn.prototype.has=function(di){var ni=dn(di,!1);return ni!==void 0?Oe.has(ni,this._key):!1},Mn.prototype.get=function(di){var ni=dn(di,!1);return ni!==void 0?Oe.get(ni,this._key):void 0},Mn.prototype.set=function(di,ni){var to=dn(di,!0);return to[this._key]=ni,this},Mn.prototype.delete=function(di){var ni=dn(di,!1);return ni!==void 0?delete ni[this._key]:!1},Mn.prototype.clear=function(){this._key=Ur()},Mn}();function Ur(){var Mn;do Mn="@@WeakMap@@"+$n();while(Oe.has(Xt,Mn));return Xt[Mn]=!0,Mn}function dn(Mn,di){if(!Z.call(Mn,Tr)){if(!di)return;Object.defineProperty(Mn,Tr,{value:Oe.create()})}return Mn[Tr]}function ui(Mn,di){for(var ni=0;ni<di;++ni)Mn[ni]=Math.random()*255|0;return Mn}function Rn(Mn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Mn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Mn)):ui(new Uint8Array(Mn),Mn):ui(new Array(Mn),Mn)}function $n(){var Mn=Rn(bt);Mn[6]=Mn[6]&79|64,Mn[8]=Mn[8]&191|128;for(var di="",ni=0;ni<bt;++ni){var to=Mn[ni];(ni===4||ni===6||ni===8)&&(di+="-"),to<16&&(di+="0"),di+=to.toString(16).toLowerCase()}return di}}function as(bt){return bt.__=void 0,delete bt.__,bt}})})(ve||(ve={}))},81550:function(dr){(function(X,G){dr.exports=G()})(this,function(){"use strict";var X=function(k){return k instanceof Uint8Array||k instanceof Uint16Array||k instanceof Uint32Array||k instanceof Int8Array||k instanceof Int16Array||k instanceof Int32Array||k instanceof Float32Array||k instanceof Float64Array||k instanceof Uint8ClampedArray},G=function(k,ie){for(var ye=Object.keys(ie),_t=0;_t<ye.length;++_t)k[ye[_t]]=ie[ye[_t]];return k},Me=`
`;function ve(k){return typeof atob!="undefined"?atob(k):"base64:"+k}function v(k){var ie=new Error("(regl) "+k);throw console.error(ie),ie}function be(k,ie){k||v(ie)}function Z(k){return k?": "+k:""}function se(k,ie,ye){k in ie||v("unknown parameter ("+k+")"+Z(ye)+". possible values: "+Object.keys(ie).join())}function me(k,ie){X(k)||v("invalid parameter type"+Z(ie)+". must be a typed array")}function ae(k,ie){switch(ie){case"number":return typeof k=="number";case"object":return typeof k=="object";case"string":return typeof k=="string";case"boolean":return typeof k=="boolean";case"function":return typeof k=="function";case"undefined":return typeof k=="undefined";case"symbol":return typeof k=="symbol"}}function fe(k,ie,ye){ae(k,ie)||v("invalid parameter type"+Z(ye)+". expected "+ie+", got "+typeof k)}function Q(k,ie){k>=0&&(k|0)===k||v("invalid parameter type, ("+k+")"+Z(ie)+". must be a nonnegative integer")}function we(k,ie,ye){ie.indexOf(k)<0&&v("invalid value"+Z(ye)+". must be one of: "+ie)}var Oe=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function M(k){Object.keys(k).forEach(function(ie){Oe.indexOf(ie)<0&&v('invalid regl constructor argument "'+ie+'". must be one of '+Oe)})}function Jt(k,ie){for(k=k+"";k.length<ie;)k=" "+k;return k}function Gt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Dt(k,ie){this.number=k,this.line=ie,this.errors=[]}function Ut(k,ie,ye){this.file=k,this.line=ie,this.message=ye}function ct(){var k=new Error,ie=(k.stack||k).toString(),ye=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ie);if(ye)return ye[1];var _t=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ie);return _t?_t[1]:"unknown"}function dt(){var k=new Error,ie=(k.stack||k).toString(),ye=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ie);if(ye)return ye[1];var _t=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ie);return _t?_t[1]:"unknown"}function Mr(k,ie){var ye=k.split(`
`),_t=1,Bt=0,ht={unknown:new Gt,0:new Gt};ht.unknown.name=ht[0].name=ie||ct(),ht.unknown.lines.push(new Dt(0,""));for(var Mt=0;Mt<ye.length;++Mt){var nr=ye[Mt],ar=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(nr);if(ar)switch(ar[1]){case"line":var fr=/(\d+)(\s+\d+)?/.exec(ar[2]);fr&&(_t=fr[1]|0,fr[2]&&(Bt=fr[2]|0,Bt in ht||(ht[Bt]=new Gt)));break;case"define":var or=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ar[2]);or&&(ht[Bt].name=or[1]?ve(or[2]):or[2]);break}ht[Bt].lines.push(new Dt(_t++,nr))}return Object.keys(ht).forEach(function(mr){var Ar=ht[mr];Ar.lines.forEach(function(rr){Ar.index[rr.number]=rr})}),ht}function cr(k){var ie=[];return k.split(`
`).forEach(function(ye){if(!(ye.length<5)){var _t=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ye);_t?ie.push(new Ut(_t[1]|0,_t[2]|0,_t[3].trim())):ye.length>0&&ie.push(new Ut("unknown",0,ye))}}),ie}function Ft(k,ie){ie.forEach(function(ye){var _t=k[ye.file];if(_t){var Bt=_t.index[ye.line];if(Bt){Bt.errors.push(ye),_t.hasErrors=!0;return}}k.unknown.hasErrors=!0,k.unknown.lines[0].errors.push(ye)})}function st(k,ie,ye,_t,Bt){if(!k.getShaderParameter(ie,k.COMPILE_STATUS)){var ht=k.getShaderInfoLog(ie),Mt=_t===k.FRAGMENT_SHADER?"fragment":"vertex";Gr(ye,"string",Mt+" shader source must be a string",Bt);var nr=Mr(ye,Bt),ar=cr(ht);Ft(nr,ar),Object.keys(nr).forEach(function(fr){var or=nr[fr];if(!or.hasErrors)return;var mr=[""],Ar=[""];function rr(vr,tt){mr.push(vr),Ar.push(tt||"")}rr("file number "+fr+": "+or.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),or.lines.forEach(function(vr){if(vr.errors.length>0){rr(Jt(vr.number,4)+"|  ","background-color:yellow; font-weight:bold"),rr(vr.line+Me,"color:red; background-color:yellow; font-weight:bold");var tt=0;vr.errors.forEach(function(xt){var ir=xt.message,kr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(ir);if(kr){var Ht=kr[1];switch(ir=kr[2],Ht){case"assign":Ht="=";break}tt=Math.max(vr.line.indexOf(Ht,tt),0)}else tt=0;rr(Jt("| ",6)),rr(Jt("^^^",tt+3)+Me,"font-weight:bold"),rr(Jt("| ",6)),rr(ir+Me,"font-weight:bold")}),rr(Jt("| ",6)+Me)}else rr(Jt(vr.number,4)+"|  "),rr(vr.line+Me,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ar[0]=mr.join("%c"),console.log.apply(console,Ar)):console.log(mr.join(""))}),be.raise("Error compiling "+Mt+" shader, "+nr[0].name)}}function He(k,ie,ye,_t,Bt){if(!k.getProgramParameter(ie,k.LINK_STATUS)){var ht=k.getProgramInfoLog(ie),Mt=Mr(ye,Bt),nr=Mr(_t,Bt),ar='Error linking program with vertex shader, "'+nr[0].name+'", and fragment shader "'+Mt[0].name+'"';typeof document!="undefined"?console.log("%c"+ar+Me+"%c"+ht,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(ar+Me+ht),be.raise(ar)}}function ut(k){k._commandRef=ct()}function Ye(k,ie,ye,_t){ut(k);function Bt(ar){return ar?_t.id(ar):0}k._fragId=Bt(k.static.frag),k._vertId=Bt(k.static.vert);function ht(ar,fr){Object.keys(fr).forEach(function(or){ar[_t.id(or)]=!0})}var Mt=k._uniformSet={};ht(Mt,ie.static),ht(Mt,ie.dynamic);var nr=k._attributeSet={};ht(nr,ye.static),ht(nr,ye.dynamic),k._hasCount="count"in k.static||"count"in k.dynamic||"elements"in k.static||"elements"in k.dynamic}function kt(k,ie){var ye=dt();v(k+" in command "+(ie||ct())+(ye==="unknown"?"":" called from "+ye))}function ur(k,ie,ye){k||kt(ie,ye||ct())}function Or(k,ie,ye,_t){k in ie||kt("unknown parameter ("+k+")"+Z(ye)+". possible values: "+Object.keys(ie).join(),_t||ct())}function Gr(k,ie,ye,_t){ae(k,ie)||kt("invalid parameter type"+Z(ye)+". expected "+ie+", got "+typeof k,_t||ct())}function Ee(k){k()}function Ve(k,ie,ye){k.texture?we(k.texture._texture.internalformat,ie,"unsupported texture format for attachment"):we(k.renderbuffer._renderbuffer.format,ye,"unsupported renderbuffer format for attachment")}var ke=33071,vt=9728,qe=9984,H=9985,Je=9986,Et=9987,gt=5120,qr=5121,Si=5122,On=5123,An=5124,gn=5125,Cn=5126,un=32819,Oi=32820,Ei=33635,da=34042,sa=36193,Ti={};Ti[gt]=Ti[qr]=1,Ti[Si]=Ti[On]=Ti[sa]=Ti[Ei]=Ti[un]=Ti[Oi]=2,Ti[An]=Ti[gn]=Ti[Cn]=Ti[da]=4;function lo(k,ie){return k===Oi||k===un||k===Ei?2:k===da?4:Ti[k]*ie}function Mi(k){return!(k&k-1)&&!!k}function Pi(k,ie,ye){var _t,Bt=ie.width,ht=ie.height,Mt=ie.channels;be(Bt>0&&Bt<=ye.maxTextureSize&&ht>0&&ht<=ye.maxTextureSize,"invalid texture shape"),(k.wrapS!==ke||k.wrapT!==ke)&&be(Mi(Bt)&&Mi(ht),"incompatible wrap mode for texture, both width and height must be power of 2"),ie.mipmask===1?Bt!==1&&ht!==1&&be(k.minFilter!==qe&&k.minFilter!==Je&&k.minFilter!==H&&k.minFilter!==Et,"min filter requires mipmap"):(be(Mi(Bt)&&Mi(ht),"texture must be a square power of 2 to support mipmapping"),be(ie.mipmask===(Bt<<1)-1,"missing or incomplete mipmap data")),ie.type===Cn&&(ye.extensions.indexOf("oes_texture_float_linear")<0&&be(k.minFilter===vt&&k.magFilter===vt,"filter not supported, must enable oes_texture_float_linear"),be(!k.genMipmaps,"mipmap generation not supported with float textures"));var nr=ie.images;for(_t=0;_t<16;++_t)if(nr[_t]){var ar=Bt>>_t,fr=ht>>_t;be(ie.mipmask&1<<_t,"missing mipmap data");var or=nr[_t];if(be(or.width===ar&&or.height===fr,"invalid shape for mip images"),be(or.format===ie.format&&or.internalformat===ie.internalformat&&or.type===ie.type,"incompatible type for mip image"),!or.compressed)if(or.data){var mr=Math.ceil(lo(or.type,Mt)*ar/or.unpackAlignment)*or.unpackAlignment;be(or.data.byteLength===mr*fr,"invalid data for image, buffer size is inconsistent with image format")}else or.element||or.copy}else k.genMipmaps||be((ie.mipmask&1<<_t)==0,"extra mipmap data");ie.compressed&&be(!k.genMipmaps,"mipmap generation for compressed images not supported")}function bo(k,ie,ye,_t){var Bt=k.width,ht=k.height,Mt=k.channels;be(Bt>0&&Bt<=_t.maxTextureSize&&ht>0&&ht<=_t.maxTextureSize,"invalid texture shape"),be(Bt===ht,"cube map must be square"),be(ie.wrapS===ke&&ie.wrapT===ke,"wrap mode not supported by cube map");for(var nr=0;nr<ye.length;++nr){var ar=ye[nr];be(ar.width===Bt&&ar.height===ht,"inconsistent cube map face shape"),ie.genMipmaps&&(be(!ar.compressed,"can not generate mipmap for compressed textures"),be(ar.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var fr=ar.images,or=0;or<16;++or){var mr=fr[or];if(mr){var Ar=Bt>>or,rr=ht>>or;be(ar.mipmask&1<<or,"missing mipmap data"),be(mr.width===Ar&&mr.height===rr,"invalid shape for mip images"),be(mr.format===k.format&&mr.internalformat===k.internalformat&&mr.type===k.type,"incompatible type for mip image"),mr.compressed||(mr.data?be(mr.data.byteLength===Ar*rr*Math.max(lo(mr.type,Mt),mr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):mr.element||mr.copy)}}}}var le=G(be,{optional:Ee,raise:v,commandRaise:kt,command:ur,parameter:se,commandParameter:Or,constructor:M,type:fe,commandType:Gr,isTypedArray:me,nni:Q,oneOf:we,shaderError:st,linkError:He,callSite:dt,saveCommandRef:ut,saveDrawInfo:Ye,framebufferFormat:Ve,guessCommand:ct,texture2D:Pi,textureCube:bo}),Ha=0,ki=0,Wo=5,cu=6;function is(k,ie){this.id=Ha++,this.type=k,this.data=ie}function as(k){return k.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function bt(k){if(k.length===0)return[];var ie=k.charAt(0),ye=k.charAt(k.length-1);if(k.length>1&&ie===ye&&(ie==='"'||ie==="'"))return['"'+as(k.substr(1,k.length-2))+'"'];var _t=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(k);if(_t)return bt(k.substr(0,_t.index)).concat(bt(_t[1])).concat(bt(k.substr(_t.index+_t[0].length)));var Bt=k.split(".");if(Bt.length===1)return['"'+as(k)+'"'];for(var ht=[],Mt=0;Mt<Bt.length;++Mt)ht=ht.concat(bt(Bt[Mt]));return ht}function Xt(k){return"["+bt(k).join("][")+"]"}function Tr(k,ie){return new is(k,Xt(ie+""))}function Ur(k){return typeof k=="function"&&!k._reglType||k instanceof is}function dn(k,ie){if(typeof k=="function")return new is(ki,k);if(typeof k=="number"||typeof k=="boolean")return new is(Wo,k);if(Array.isArray(k))return new is(cu,k.map((ye,_t)=>dn(ye,ie+"["+_t+"]")));if(k instanceof is)return k;le(!1,"invalid option type in uniform "+ie)}var ui={DynamicVariable:is,define:Tr,isDynamic:Ur,unbox:dn,accessor:Xt},Rn={next:typeof requestAnimationFrame=="function"?function(k){return requestAnimationFrame(k)}:function(k){return setTimeout(k,16)},cancel:typeof cancelAnimationFrame=="function"?function(k){return cancelAnimationFrame(k)}:clearTimeout},$n=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Mn(){var k={"":0},ie=[""];return{id:function(ye){var _t=k[ye];return _t||(_t=k[ye]=ie.length,ie.push(ye),_t)},str:function(ye){return ie[ye]}}}function di(k,ie,ye){var _t=document.createElement("canvas");G(_t.style,{border:0,margin:0,padding:0,top:0,left:0}),k.appendChild(_t),k===document.body&&(_t.style.position="absolute",G(k.style,{margin:0,padding:0}));function Bt(){var nr=window.innerWidth,ar=window.innerHeight;if(k!==document.body){var fr=k.getBoundingClientRect();nr=fr.right-fr.left,ar=fr.bottom-fr.top}_t.width=ye*nr,_t.height=ye*ar,G(_t.style,{width:nr+"px",height:ar+"px"})}var ht;k!==document.body&&typeof ResizeObserver=="function"?(ht=new ResizeObserver(function(){setTimeout(Bt)}),ht.observe(k)):window.addEventListener("resize",Bt,!1);function Mt(){ht?ht.disconnect():window.removeEventListener("resize",Bt),k.removeChild(_t)}return Bt(),{canvas:_t,onDestroy:Mt}}function ni(k,ie){function ye(_t){try{return k.getContext(_t,ie)}catch(Bt){return null}}return ye("webgl")||ye("experimental-webgl")||ye("webgl-experimental")}function to(k){return typeof k.nodeName=="string"&&typeof k.appendChild=="function"&&typeof k.getBoundingClientRect=="function"}function wo(k){return typeof k.drawArrays=="function"||typeof k.drawElements=="function"}function fu(k){return typeof k=="string"?k.split():(le(Array.isArray(k),"invalid extension array"),k)}function Rs(k){return typeof k=="string"?(le(typeof document!="undefined","not supported outside of DOM"),document.querySelector(k)):k}function Ji(k){var ie=k||{},ye,_t,Bt,ht,Mt={},nr=[],ar=[],fr=typeof window=="undefined"?1:window.devicePixelRatio,or=!1,mr=function(vr){vr&&le.raise(vr)},Ar=function(){};if(typeof ie=="string"?(le(typeof document!="undefined","selector queries only supported in DOM enviroments"),ye=document.querySelector(ie),le(ye,"invalid query string for element")):typeof ie=="object"?to(ie)?ye=ie:wo(ie)?(ht=ie,Bt=ht.canvas):(le.constructor(ie),"gl"in ie?ht=ie.gl:"canvas"in ie?Bt=Rs(ie.canvas):"container"in ie&&(_t=Rs(ie.container)),"attributes"in ie&&(Mt=ie.attributes,le.type(Mt,"object","invalid context attributes")),"extensions"in ie&&(nr=fu(ie.extensions)),"optionalExtensions"in ie&&(ar=fu(ie.optionalExtensions)),"onDone"in ie&&(le.type(ie.onDone,"function","invalid or missing onDone callback"),mr=ie.onDone),"profile"in ie&&(or=!!ie.profile),"pixelRatio"in ie&&(fr=+ie.pixelRatio,le(fr>0,"invalid pixel ratio"))):le.raise("invalid arguments to regl"),ye&&(ye.nodeName.toLowerCase()==="canvas"?Bt=ye:_t=ye),!ht){if(!Bt){le(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var rr=di(_t||document.body,mr,fr);if(!rr)return null;Bt=rr.canvas,Ar=rr.onDestroy}Mt.premultipliedAlpha===void 0&&(Mt.premultipliedAlpha=!0),ht=ni(Bt,Mt)}return ht?{gl:ht,canvas:Bt,container:_t,extensions:nr,optionalExtensions:ar,pixelRatio:fr,profile:or,onDone:mr,onDestroy:Ar}:(Ar(),mr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function B(k,ie){var ye={};function _t(Mt){le.type(Mt,"string","extension name must be string");var nr=Mt.toLowerCase(),ar;try{ar=ye[nr]=k.getExtension(nr)}catch(fr){}return!!ar}for(var Bt=0;Bt<ie.extensions.length;++Bt){var ht=ie.extensions[Bt];if(!_t(ht))return ie.onDestroy(),ie.onDone('"'+ht+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ie.optionalExtensions.forEach(_t),{extensions:ye,restore:function(){Object.keys(ye).forEach(function(Mt){if(ye[Mt]&&!_t(Mt))throw new Error("(regl): error restoring extension "+Mt)})}}}function U(k,ie){for(var ye=Array(k),_t=0;_t<k;++_t)ye[_t]=ie(_t);return ye}var Y=5120,oe=5121,Te=5122,Ze=5123,We=5124,te=5125,Pe=5126;function nt(k){for(var ie=16;ie<=1<<28;ie*=16)if(k<=ie)return ie;return 0}function $t(k){var ie,ye;return ie=(k>65535)<<4,k>>>=ie,ye=(k>255)<<3,k>>>=ye,ie|=ye,ye=(k>15)<<2,k>>>=ye,ie|=ye,ye=(k>3)<<1,k>>>=ye,ie|=ye,ie|k>>1}function lr(){var k=U(8,function(){return[]});function ie(ht){var Mt=nt(ht),nr=k[$t(Mt)>>2];return nr.length>0?nr.pop():new ArrayBuffer(Mt)}function ye(ht){k[$t(ht.byteLength)>>2].push(ht)}function _t(ht,Mt){var nr=null;switch(ht){case Y:nr=new Int8Array(ie(Mt),0,Mt);break;case oe:nr=new Uint8Array(ie(Mt),0,Mt);break;case Te:nr=new Int16Array(ie(2*Mt),0,Mt);break;case Ze:nr=new Uint16Array(ie(2*Mt),0,Mt);break;case We:nr=new Int32Array(ie(4*Mt),0,Mt);break;case te:nr=new Uint32Array(ie(4*Mt),0,Mt);break;case Pe:nr=new Float32Array(ie(4*Mt),0,Mt);break;default:return null}return nr.length!==Mt?nr.subarray(0,Mt):nr}function Bt(ht){ye(ht.buffer)}return{alloc:ie,free:ye,allocType:_t,freeType:Bt}}var pt=lr();pt.zero=lr();var er=3408,Wr=3410,Rr=3411,Rt=3412,Dr=3413,Ir=3414,Pr=3415,Bn=33901,Lr=33902,Un=3379,li=3386,Nn=34921,Pn=36347,jn=36348,Ea=35661,mi=35660,Li=34930,Wn=36349,zn=34076,Jn=34024,Qi=7936,ys=7937,Bi=7938,ea=35724,ku=34047,qs=36063,ji=34852,Wa=3553,Ca=34067,ua=34069,vo=33984,wi=6408,mo=5126,Xa=5121,So=36160,Xo=36053,Lc=36064,Yo=16384,Ta=function(k,ie){var ye=1;ie.ext_texture_filter_anisotropic&&(ye=k.getParameter(ku));var _t=1,Bt=1;ie.webgl_draw_buffers&&(_t=k.getParameter(ji),Bt=k.getParameter(qs));var ht=!!ie.oes_texture_float;if(ht){var Mt=k.createTexture();k.bindTexture(Wa,Mt),k.texImage2D(Wa,0,wi,1,1,0,wi,mo,null);var nr=k.createFramebuffer();if(k.bindFramebuffer(So,nr),k.framebufferTexture2D(So,Lc,Wa,Mt,0),k.bindTexture(Wa,null),k.checkFramebufferStatus(So)!==Xo)ht=!1;else{k.viewport(0,0,1,1),k.clearColor(1,0,0,1),k.clear(Yo);var ar=pt.allocType(mo,4);k.readPixels(0,0,1,1,wi,mo,ar),k.getError()?ht=!1:(k.deleteFramebuffer(nr),k.deleteTexture(Mt),ht=ar[0]===1),pt.freeType(ar)}}var fr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),or=!0;if(!fr){var mr=k.createTexture(),Ar=pt.allocType(Xa,36);k.activeTexture(vo),k.bindTexture(Ca,mr),k.texImage2D(ua,0,wi,3,3,0,wi,Xa,Ar),pt.freeType(Ar),k.bindTexture(Ca,null),k.deleteTexture(mr),or=!k.getError()}return{colorBits:[k.getParameter(Wr),k.getParameter(Rr),k.getParameter(Rt),k.getParameter(Dr)],depthBits:k.getParameter(Ir),stencilBits:k.getParameter(Pr),subpixelBits:k.getParameter(er),extensions:Object.keys(ie).filter(function(rr){return!!ie[rr]}),maxAnisotropic:ye,maxDrawbuffers:_t,maxColorAttachments:Bt,pointSizeDims:k.getParameter(Bn),lineWidthDims:k.getParameter(Lr),maxViewportDims:k.getParameter(li),maxCombinedTextureUnits:k.getParameter(Ea),maxCubeMapSize:k.getParameter(zn),maxRenderbufferSize:k.getParameter(Jn),maxTextureUnits:k.getParameter(Li),maxTextureSize:k.getParameter(Un),maxAttributes:k.getParameter(Nn),maxVertexUniforms:k.getParameter(Pn),maxVertexTextureUnits:k.getParameter(mi),maxVaryingVectors:k.getParameter(jn),maxFragmentUniforms:k.getParameter(Wn),glsl:k.getParameter(ea),renderer:k.getParameter(ys),vendor:k.getParameter(Qi),version:k.getParameter(Bi),readFloat:ht,npotTextureCube:or}};function va(k){return!!k&&typeof k=="object"&&Array.isArray(k.shape)&&Array.isArray(k.stride)&&typeof k.offset=="number"&&k.shape.length===k.stride.length&&(Array.isArray(k.data)||X(k.data))}var Ri=function(k){return Object.keys(k).map(function(ie){return k[ie]})},K={shape:yi,flatten:an};function he(k,ie,ye){for(var _t=0;_t<ie;++_t)ye[_t]=k[_t]}function je(k,ie,ye,_t){for(var Bt=0,ht=0;ht<ie;++ht)for(var Mt=k[ht],nr=0;nr<ye;++nr)_t[Bt++]=Mt[nr]}function It(k,ie,ye,_t,Bt,ht){for(var Mt=ht,nr=0;nr<ie;++nr)for(var ar=k[nr],fr=0;fr<ye;++fr)for(var or=ar[fr],mr=0;mr<_t;++mr)Bt[Mt++]=or[mr]}function xr(k,ie,ye,_t,Bt){for(var ht=1,Mt=ye+1;Mt<ie.length;++Mt)ht*=ie[Mt];var nr=ie[ye];if(ie.length-ye==4){var ar=ie[ye+1],fr=ie[ye+2],or=ie[ye+3];for(Mt=0;Mt<nr;++Mt)It(k[Mt],ar,fr,or,_t,Bt),Bt+=ht}else for(Mt=0;Mt<nr;++Mt)xr(k[Mt],ie,ye+1,_t,Bt),Bt+=ht}function an(k,ie,ye,_t){var Bt=1;if(ie.length)for(var ht=0;ht<ie.length;++ht)Bt*=ie[ht];else Bt=0;var Mt=_t||pt.allocType(ye,Bt);switch(ie.length){case 0:break;case 1:he(k,ie[0],Mt);break;case 2:je(k,ie[0],ie[1],Mt);break;case 3:It(k,ie[0],ie[1],ie[2],Mt,0);break;default:xr(k,ie,0,Mt,0)}return Mt}function yi(k){for(var ie=[],ye=k;ye.length;ye=ye[0])ie.push(ye.length);return ie}var ma={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ya=5120,Aa=5122,qo=5124,ac=5121,vf=5123,Rc=5125,os=5126,Lu=5126,ss={int8:Ya,int16:Aa,int32:qo,uint8:ac,uint16:vf,uint32:Rc,float:os,float32:Lu},ol=35048,pu=35040,gs={dynamic:ol,stream:pu,static:35044},kl=K.flatten,Eo=K.shape,la=35044,Ll=35040,Dc=5121,mf=5126,hu=[];hu[5120]=1,hu[5122]=2,hu[5124]=4,hu[5121]=1,hu[5123]=2,hu[5125]=4,hu[5126]=4;function du(k){return ma[Object.prototype.toString.call(k)]|0}function Fc(k,ie){for(var ye=0;ye<ie.length;++ye)k[ye]=ie[ye]}function Ii(k,ie,ye,_t,Bt,ht,Mt){for(var nr=0,ar=0;ar<ye;++ar)for(var fr=0;fr<_t;++fr)k[nr++]=ie[Bt*ar+ht*fr+Mt]}function vu(k,ie,ye,_t){var Bt=0,ht={};function Mt(tt){this.id=Bt++,this.buffer=k.createBuffer(),this.type=tt,this.usage=la,this.byteLength=0,this.dimension=1,this.dtype=Dc,this.persistentData=null,ye.profile&&(this.stats={size:0})}Mt.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)},Mt.prototype.destroy=function(){Ar(this)};var nr=[];function ar(tt,xt){var ir=nr.pop();return ir||(ir=new Mt(tt)),ir.bind(),mr(ir,xt,Ll,0,1,!1),ir}function fr(tt){nr.push(tt)}function or(tt,xt,ir){tt.byteLength=xt.byteLength,k.bufferData(tt.type,xt,ir)}function mr(tt,xt,ir,kr,Ht,Nr){var Qt;if(tt.usage=ir,Array.isArray(xt)){if(tt.dtype=kr||mf,xt.length>0){var Er;if(Array.isArray(xt[0])){Qt=Eo(xt);for(var Wt=1,yr=1;yr<Qt.length;++yr)Wt*=Qt[yr];tt.dimension=Wt,Er=kl(xt,Qt,tt.dtype),or(tt,Er,ir),Nr?tt.persistentData=Er:pt.freeType(Er)}else if(typeof xt[0]=="number"){tt.dimension=Ht;var ln=pt.allocType(tt.dtype,xt.length);Fc(ln,xt),or(tt,ln,ir),Nr?tt.persistentData=ln:pt.freeType(ln)}else X(xt[0])?(tt.dimension=xt[0].length,tt.dtype=kr||du(xt[0])||mf,Er=kl(xt,[xt.length,xt[0].length],tt.dtype),or(tt,Er,ir),Nr?tt.persistentData=Er:pt.freeType(Er)):le.raise("invalid buffer data")}}else if(X(xt))tt.dtype=kr||du(xt),tt.dimension=Ht,or(tt,xt,ir),Nr&&(tt.persistentData=new Uint8Array(new Uint8Array(xt.buffer)));else if(va(xt)){Qt=xt.shape;var pn=xt.stride,wr=xt.offset,qt=0,jt=0,xn=0,yn=0;Qt.length===1?(qt=Qt[0],jt=1,xn=pn[0],yn=0):Qt.length===2?(qt=Qt[0],jt=Qt[1],xn=pn[0],yn=pn[1]):le.raise("invalid shape"),tt.dtype=kr||du(xt.data)||mf,tt.dimension=jt;var Kr=pt.allocType(tt.dtype,qt*jt);Ii(Kr,xt.data,qt,jt,xn,yn,wr),or(tt,Kr,ir),Nr?tt.persistentData=Kr:pt.freeType(Kr)}else xt instanceof ArrayBuffer?(tt.dtype=Dc,tt.dimension=Ht,or(tt,xt,ir),Nr&&(tt.persistentData=new Uint8Array(new Uint8Array(xt)))):le.raise("invalid buffer data")}function Ar(tt){ie.bufferCount--,_t(tt);var xt=tt.buffer;le(xt,"buffer must not be deleted already"),k.deleteBuffer(xt),tt.buffer=null,delete ht[tt.id]}function rr(tt,xt,ir,kr){ie.bufferCount++;var Ht=new Mt(xt);ht[Ht.id]=Ht;function Nr(Wt){var yr=la,ln=null,pn=0,wr=0,qt=1;return Array.isArray(Wt)||X(Wt)||va(Wt)||Wt instanceof ArrayBuffer?ln=Wt:typeof Wt=="number"?pn=Wt|0:Wt&&(le.type(Wt,"object","buffer arguments must be an object, a number or an array"),"data"in Wt&&(le(ln===null||Array.isArray(ln)||X(ln)||va(ln),"invalid data for buffer"),ln=Wt.data),"usage"in Wt&&(le.parameter(Wt.usage,gs,"invalid buffer usage"),yr=gs[Wt.usage]),"type"in Wt&&(le.parameter(Wt.type,ss,"invalid buffer type"),wr=ss[Wt.type]),"dimension"in Wt&&(le.type(Wt.dimension,"number","invalid dimension"),qt=Wt.dimension|0),"length"in Wt&&(le.nni(pn,"buffer length must be a nonnegative integer"),pn=Wt.length|0)),Ht.bind(),ln?mr(Ht,ln,yr,wr,qt,kr):(pn&&k.bufferData(Ht.type,pn,yr),Ht.dtype=wr||Dc,Ht.usage=yr,Ht.dimension=qt,Ht.byteLength=pn),ye.profile&&(Ht.stats.size=Ht.byteLength*hu[Ht.dtype]),Nr}function Qt(Wt,yr){le(yr+Wt.byteLength<=Ht.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Wt.byteLength+" starting from offset "+yr+" to a buffer of size "+Ht.byteLength),k.bufferSubData(Ht.type,yr,Wt)}function Er(Wt,yr){var ln=(yr||0)|0,pn;if(Ht.bind(),X(Wt)||Wt instanceof ArrayBuffer)Qt(Wt,ln);else if(Array.isArray(Wt)){if(Wt.length>0)if(typeof Wt[0]=="number"){var wr=pt.allocType(Ht.dtype,Wt.length);Fc(wr,Wt),Qt(wr,ln),pt.freeType(wr)}else if(Array.isArray(Wt[0])||X(Wt[0])){pn=Eo(Wt);var qt=kl(Wt,pn,Ht.dtype);Qt(qt,ln),pt.freeType(qt)}else le.raise("invalid buffer data")}else if(va(Wt)){pn=Wt.shape;var jt=Wt.stride,xn=0,yn=0,Kr=0,Qn=0;pn.length===1?(xn=pn[0],yn=1,Kr=jt[0],Qn=0):pn.length===2?(xn=pn[0],yn=pn[1],Kr=jt[0],Qn=jt[1]):le.raise("invalid shape");var Dn=Array.isArray(Wt.data)?Ht.dtype:du(Wt.data),Yn=pt.allocType(Dn,xn*yn);Ii(Yn,Wt.data,xn,yn,Kr,Qn,Wt.offset),Qt(Yn,ln),pt.freeType(Yn)}else le.raise("invalid data for buffer subdata");return Nr}return ir||Nr(tt),Nr._reglType="buffer",Nr._buffer=Ht,Nr.subdata=Er,ye.profile&&(Nr.stats=Ht.stats),Nr.destroy=function(){Ar(Ht)},Nr}function vr(){Ri(ht).forEach(function(tt){tt.buffer=k.createBuffer(),k.bindBuffer(tt.type,tt.buffer),k.bufferData(tt.type,tt.persistentData||tt.byteLength,tt.usage)})}return ye.profile&&(ie.getTotalBufferSize=function(){var tt=0;return Object.keys(ht).forEach(function(xt){tt+=ht[xt].stats.size}),tt}),{create:rr,createStream:ar,destroyStream:fr,clear:function(){Ri(ht).forEach(Ar),nr.forEach(Ar)},getBuffer:function(tt){return tt&&tt._buffer instanceof Mt?tt._buffer:null},restore:vr,_initBuffer:mr}}var qf=0,Kf=0,$f=1,oc=1,Rl=4,Jf=4,Yi={points:qf,point:Kf,lines:$f,line:oc,triangles:Rl,triangle:Jf,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},yf=0,Ru=1,Da=4,Ds=5120,Co=5121,mu=5122,Ko=5123,yu=5124,To=5125,sc=34963,Qf=35040,Di=35044;function Sp(k,ie,ye,_t){var Bt={},ht=0,Mt={uint8:Co,uint16:Ko};ie.oes_element_index_uint&&(Mt.uint32=To);function nr(vr){this.id=ht++,Bt[this.id]=this,this.buffer=vr,this.primType=Da,this.vertCount=0,this.type=0}nr.prototype.bind=function(){this.buffer.bind()};var ar=[];function fr(vr){var tt=ar.pop();return tt||(tt=new nr(ye.create(null,sc,!0,!1)._buffer)),mr(tt,vr,Qf,-1,-1,0,0),tt}function or(vr){ar.push(vr)}function mr(vr,tt,xt,ir,kr,Ht,Nr){vr.buffer.bind();var Qt;if(tt){var Er=Nr;!Nr&&(!X(tt)||va(tt)&&!X(tt.data))&&(Er=ie.oes_element_index_uint?To:Ko),ye._initBuffer(vr.buffer,tt,xt,Er,3)}else k.bufferData(sc,Ht,xt),vr.buffer.dtype=Qt||Co,vr.buffer.usage=xt,vr.buffer.dimension=3,vr.buffer.byteLength=Ht;if(Qt=Nr,!Nr){switch(vr.buffer.dtype){case Co:case Ds:Qt=Co;break;case Ko:case mu:Qt=Ko;break;case To:case yu:Qt=To;break;default:le.raise("unsupported type for element array")}vr.buffer.dtype=Qt}vr.type=Qt,le(Qt!==To||!!ie.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Wt=kr;Wt<0&&(Wt=vr.buffer.byteLength,Qt===Ko?Wt>>=1:Qt===To&&(Wt>>=2)),vr.vertCount=Wt;var yr=ir;if(ir<0){yr=Da;var ln=vr.buffer.dimension;ln===1&&(yr=yf),ln===2&&(yr=Ru),ln===3&&(yr=Da)}vr.primType=yr}function Ar(vr){_t.elementsCount--,le(vr.buffer!==null,"must not double destroy elements"),delete Bt[vr.id],vr.buffer.destroy(),vr.buffer=null}function rr(vr,tt){var xt=ye.create(null,sc,!0),ir=new nr(xt._buffer);_t.elementsCount++;function kr(Ht){if(!Ht)xt(),ir.primType=Da,ir.vertCount=0,ir.type=Co;else if(typeof Ht=="number")xt(Ht),ir.primType=Da,ir.vertCount=Ht|0,ir.type=Co;else{var Nr=null,Qt=Di,Er=-1,Wt=-1,yr=0,ln=0;Array.isArray(Ht)||X(Ht)||va(Ht)?Nr=Ht:(le.type(Ht,"object","invalid arguments for elements"),"data"in Ht&&(Nr=Ht.data,le(Array.isArray(Nr)||X(Nr)||va(Nr),"invalid data for element buffer")),"usage"in Ht&&(le.parameter(Ht.usage,gs,"invalid element buffer usage"),Qt=gs[Ht.usage]),"primitive"in Ht&&(le.parameter(Ht.primitive,Yi,"invalid element buffer primitive"),Er=Yi[Ht.primitive]),"count"in Ht&&(le(typeof Ht.count=="number"&&Ht.count>=0,"invalid vertex count for elements"),Wt=Ht.count|0),"type"in Ht&&(le.parameter(Ht.type,Mt,"invalid buffer type"),ln=Mt[Ht.type]),"length"in Ht?yr=Ht.length|0:(yr=Wt,ln===Ko||ln===mu?yr*=2:(ln===To||ln===yu)&&(yr*=4))),mr(ir,Nr,Qt,Er,Wt,yr,ln)}return kr}return kr(vr),kr._reglType="elements",kr._elements=ir,kr.subdata=function(Ht,Nr){return xt.subdata(Ht,Nr),kr},kr.destroy=function(){Ar(ir)},kr}return{create:rr,createStream:fr,destroyStream:or,getElements:function(vr){return typeof vr=="function"&&vr._elements instanceof nr?vr._elements:null},clear:function(){Ri(Bt).forEach(Ar)}}}var uc=new Float32Array(1),ep=new Uint32Array(uc.buffer),gf=5123;function _f(k){for(var ie=pt.allocType(gf,k.length),ye=0;ye<k.length;++ye)if(isNaN(k[ye]))ie[ye]=65535;else if(k[ye]===Infinity)ie[ye]=31744;else if(k[ye]===-Infinity)ie[ye]=64512;else{uc[0]=k[ye];var _t=ep[0],Bt=_t>>>31<<15,ht=(_t<<1>>>24)-127,Mt=_t>>13&(1<<10)-1;if(ht<-24)ie[ye]=Bt;else if(ht<-14){var nr=-14-ht;ie[ye]=Bt+(Mt+(1<<10)>>nr)}else ht>15?ie[ye]=Bt+31744:ie[ye]=Bt+(ht+15<<10)+Mt}return ie}function ca(k){return Array.isArray(k)||X(k)}var gu=function(k){return!(k&k-1)&&!!k},Du=34467,Ao=3553,Bc=34067,lc=34069,_u=6408,Ks=6406,cc=6407,Fs=6409,$s=6410,xf=32854,sl=32855,Ni=36194,Nc=32819,tp=32820,Dl=33635,rp=34042,bf=6402,ul=34041,Fl=35904,Fu=35906,Bs=36193,ll=33776,cl=33777,xu=33778,fc=33779,fl=35986,_s=35987,zc=34798,wf=35840,Zc=35841,bu=35842,Bl=35843,Nl=36196,wu=5121,zl=5123,Sf=5125,Su=5126,Ef=10242,np=10243,Cf=10497,pl=33071,Uc=33648,pc=10240,Tf=10241,hl=9728,ip=9729,Tn=9984,$r=9985,Zl=9986,Bu=9987,Nu=33170,ii=4352,Vi=4353,xs=4354,jc=34046,hc=3317,Vc=37440,oh=37441,sh=37443,dc=37444,zu=33984,Zu=[Tn,Zl,$r,Bu],fa=[0,Fs,$s,cc,_u],Fo={};Fo[Fs]=Fo[Ks]=Fo[bf]=1,Fo[ul]=Fo[$s]=2,Fo[cc]=Fo[Fl]=3,Fo[_u]=Fo[Fu]=4;function Ul(k){return"[object "+k+"]"}var Ma=Ul("HTMLCanvasElement"),Hr=Ul("OffscreenCanvas"),us=Ul("CanvasRenderingContext2D"),Gc=Ul("ImageBitmap"),jl=Ul("HTMLImageElement"),Ns=Ul("HTMLVideoElement"),ls=Object.keys(ma).concat([Ma,Hr,us,Gc,jl,Ns]),dl=[];dl[wu]=1,dl[Su]=4,dl[Bs]=2,dl[zl]=2,dl[Sf]=4;var hr=[];hr[xf]=2,hr[sl]=2,hr[Ni]=2,hr[ul]=4,hr[ll]=.5,hr[cl]=.5,hr[xu]=1,hr[fc]=1,hr[fl]=.5,hr[_s]=1,hr[zc]=1,hr[wf]=.5,hr[Zc]=.25,hr[bu]=.5,hr[Bl]=.25,hr[Nl]=.5;function Af(k){return Array.isArray(k)&&(k.length===0||typeof k[0]=="number")}function vl(k){if(!Array.isArray(k))return!1;var ie=k.length;return!(ie===0||!ca(k[0]))}function Uu(k){return Object.prototype.toString.call(k)}function bs(k){return Uu(k)===Ma}function $o(k){return Uu(k)===Hr}function Mf(k){return Uu(k)===us}function Pf(k){return Uu(k)===Gc}function cs(k){return Uu(k)===jl}function ju(k){return Uu(k)===Ns}function If(k){if(!k)return!1;var ie=Uu(k);return ls.indexOf(ie)>=0?!0:Af(k)||vl(k)||va(k)}function vc(k){return ma[Object.prototype.toString.call(k)]|0}function ap(k,ie){var ye=ie.length;switch(k.type){case wu:case zl:case Sf:case Su:var _t=pt.allocType(k.type,ye);_t.set(ie),k.data=_t;break;case Bs:k.data=_f(ie);break;default:le.raise("unsupported texture type, must specify a typed array")}}function Of(k,ie){return pt.allocType(k.type===Bs?Su:k.type,ie)}function Js(k,ie){k.type===Bs?(k.data=_f(ie),pt.freeType(ie)):k.data=ie}function ws(k,ie,ye,_t,Bt,ht){for(var Mt=k.width,nr=k.height,ar=k.channels,fr=Mt*nr*ar,or=Of(k,fr),mr=0,Ar=0;Ar<nr;++Ar)for(var rr=0;rr<Mt;++rr)for(var vr=0;vr<ar;++vr)or[mr++]=ie[ye*rr+_t*Ar+Bt*vr+ht];Js(k,or)}function Xn(k,ie,ye,_t,Bt,ht){var Mt;if(typeof hr[k]!="undefined"?Mt=hr[k]:Mt=Fo[k]*dl[ie],ht&&(Mt*=6),Bt){for(var nr=0,ar=ye;ar>=1;)nr+=Mt*ar*ar,ar/=2;return nr}else return Mt*ye*_t}function Qs(k,ie,ye,_t,Bt,ht,Mt){var nr={"don't care":ii,"dont care":ii,nice:xs,fast:Vi},ar={repeat:Cf,clamp:pl,mirror:Uc},fr={nearest:hl,linear:ip},or=G({mipmap:Bu,"nearest mipmap nearest":Tn,"linear mipmap nearest":$r,"nearest mipmap linear":Zl,"linear mipmap linear":Bu},fr),mr={none:0,browser:dc},Ar={uint8:wu,rgba4:Nc,rgb565:Dl,"rgb5 a1":tp},rr={alpha:Ks,luminance:Fs,"luminance alpha":$s,rgb:cc,rgba:_u,rgba4:xf,"rgb5 a1":sl,rgb565:Ni},vr={};ie.ext_srgb&&(rr.srgb=Fl,rr.srgba=Fu),ie.oes_texture_float&&(Ar.float32=Ar.float=Su),ie.oes_texture_half_float&&(Ar.float16=Ar["half float"]=Bs),ie.webgl_depth_texture&&(G(rr,{depth:bf,"depth stencil":ul}),G(Ar,{uint16:zl,uint32:Sf,"depth stencil":rp})),ie.webgl_compressed_texture_s3tc&&G(vr,{"rgb s3tc dxt1":ll,"rgba s3tc dxt1":cl,"rgba s3tc dxt3":xu,"rgba s3tc dxt5":fc}),ie.webgl_compressed_texture_atc&&G(vr,{"rgb atc":fl,"rgba atc explicit alpha":_s,"rgba atc interpolated alpha":zc}),ie.webgl_compressed_texture_pvrtc&&G(vr,{"rgb pvrtc 4bppv1":wf,"rgb pvrtc 2bppv1":Zc,"rgba pvrtc 4bppv1":bu,"rgba pvrtc 2bppv1":Bl}),ie.webgl_compressed_texture_etc1&&(vr["rgb etc1"]=Nl);var tt=Array.prototype.slice.call(k.getParameter(Du));Object.keys(vr).forEach(function(_e){var yt=vr[_e];tt.indexOf(yt)>=0&&(rr[_e]=yt)});var xt=Object.keys(rr);ye.textureFormats=xt;var ir=[];Object.keys(rr).forEach(function(_e){var yt=rr[_e];ir[yt]=_e});var kr=[];Object.keys(Ar).forEach(function(_e){var yt=Ar[_e];kr[yt]=_e});var Ht=[];Object.keys(fr).forEach(function(_e){var yt=fr[_e];Ht[yt]=_e});var Nr=[];Object.keys(or).forEach(function(_e){var yt=or[_e];Nr[yt]=_e});var Qt=[];Object.keys(ar).forEach(function(_e){var yt=ar[_e];Qt[yt]=_e});var Er=xt.reduce(function(_e,yt){var ft=rr[yt];return ft===Fs||ft===Ks||ft===Fs||ft===$s||ft===bf||ft===ul||ie.ext_srgb&&(ft===Fl||ft===Fu)?_e[ft]=ft:ft===sl||yt.indexOf("rgba")>=0?_e[ft]=_u:_e[ft]=cc,_e},{});function Wt(){this.internalformat=_u,this.format=_u,this.type=wu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=dc,this.width=0,this.height=0,this.channels=0}function yr(_e,yt){_e.internalformat=yt.internalformat,_e.format=yt.format,_e.type=yt.type,_e.compressed=yt.compressed,_e.premultiplyAlpha=yt.premultiplyAlpha,_e.flipY=yt.flipY,_e.unpackAlignment=yt.unpackAlignment,_e.colorSpace=yt.colorSpace,_e.width=yt.width,_e.height=yt.height,_e.channels=yt.channels}function ln(_e,yt){if(!(typeof yt!="object"||!yt)){if("premultiplyAlpha"in yt&&(le.type(yt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),_e.premultiplyAlpha=yt.premultiplyAlpha),"flipY"in yt&&(le.type(yt.flipY,"boolean","invalid texture flip"),_e.flipY=yt.flipY),"alignment"in yt&&(le.oneOf(yt.alignment,[1,2,4,8],"invalid texture unpack alignment"),_e.unpackAlignment=yt.alignment),"colorSpace"in yt&&(le.parameter(yt.colorSpace,mr,"invalid colorSpace"),_e.colorSpace=mr[yt.colorSpace]),"type"in yt){var ft=yt.type;le(ie.oes_texture_float||!(ft==="float"||ft==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),le(ie.oes_texture_half_float||!(ft==="half float"||ft==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),le(ie.webgl_depth_texture||!(ft==="uint16"||ft==="uint32"||ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(ft,Ar,"invalid texture type"),_e.type=Ar[ft]}var Vr=_e.width,ti=_e.height,pe=_e.channels,$=!1;"shape"in yt?(le(Array.isArray(yt.shape)&&yt.shape.length>=2,"shape must be an array"),Vr=yt.shape[0],ti=yt.shape[1],yt.shape.length===3&&(pe=yt.shape[2],le(pe>0&&pe<=4,"invalid number of channels"),$=!0),le(Vr>=0&&Vr<=ye.maxTextureSize,"invalid width"),le(ti>=0&&ti<=ye.maxTextureSize,"invalid height")):("radius"in yt&&(Vr=ti=yt.radius,le(Vr>=0&&Vr<=ye.maxTextureSize,"invalid radius")),"width"in yt&&(Vr=yt.width,le(Vr>=0&&Vr<=ye.maxTextureSize,"invalid width")),"height"in yt&&(ti=yt.height,le(ti>=0&&ti<=ye.maxTextureSize,"invalid height")),"channels"in yt&&(pe=yt.channels,le(pe>0&&pe<=4,"invalid number of channels"),$=!0)),_e.width=Vr|0,_e.height=ti|0,_e.channels=pe|0;var Be=!1;if("format"in yt){var Qe=yt.format;le(ie.webgl_depth_texture||!(Qe==="depth"||Qe==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(Qe,rr,"invalid texture format");var et=_e.internalformat=rr[Qe];_e.format=Er[et],Qe in Ar&&("type"in yt||(_e.type=Ar[Qe])),Qe in vr&&(_e.compressed=!0),Be=!0}!$&&Be?_e.channels=Fo[_e.format]:$&&!Be?_e.channels!==fa[_e.format]&&(_e.format=_e.internalformat=fa[_e.channels]):Be&&$&&le(_e.channels===Fo[_e.format],"number of channels inconsistent with specified format")}}function pn(_e){k.pixelStorei(Vc,_e.flipY),k.pixelStorei(oh,_e.premultiplyAlpha),k.pixelStorei(sh,_e.colorSpace),k.pixelStorei(hc,_e.unpackAlignment)}function wr(){Wt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function qt(_e,yt){var ft=null;if(If(yt)?ft=yt:yt&&(le.type(yt,"object","invalid pixel data type"),ln(_e,yt),"x"in yt&&(_e.xOffset=yt.x|0),"y"in yt&&(_e.yOffset=yt.y|0),If(yt.data)&&(ft=yt.data)),le(!_e.compressed||ft instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),yt.copy){le(!ft,"can not specify copy and data field for the same texture");var Vr=Bt.viewportWidth,ti=Bt.viewportHeight;_e.width=_e.width||Vr-_e.xOffset,_e.height=_e.height||ti-_e.yOffset,_e.needsCopy=!0,le(_e.xOffset>=0&&_e.xOffset<Vr&&_e.yOffset>=0&&_e.yOffset<ti&&_e.width>0&&_e.width<=Vr&&_e.height>0&&_e.height<=ti,"copy texture read out of bounds")}else if(!ft)_e.width=_e.width||1,_e.height=_e.height||1,_e.channels=_e.channels||4;else if(X(ft))_e.channels=_e.channels||4,_e.data=ft,!("type"in yt)&&_e.type===wu&&(_e.type=vc(ft));else if(Af(ft))_e.channels=_e.channels||4,ap(_e,ft),_e.alignment=1,_e.needsFree=!0;else if(va(ft)){var pe=ft.data;!Array.isArray(pe)&&_e.type===wu&&(_e.type=vc(pe));var $=ft.shape,Be=ft.stride,Qe,et,Ue,Ne,Xe,de;$.length===3?(Ue=$[2],de=Be[2]):(le($.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ue=1,de=1),Qe=$[0],et=$[1],Ne=Be[0],Xe=Be[1],_e.alignment=1,_e.width=Qe,_e.height=et,_e.channels=Ue,_e.format=_e.internalformat=fa[Ue],_e.needsFree=!0,ws(_e,pe,Ne,Xe,de,ft.offset)}else if(bs(ft)||$o(ft)||Mf(ft))bs(ft)||$o(ft)?_e.element=ft:_e.element=ft.canvas,_e.width=_e.element.width,_e.height=_e.element.height,_e.channels=4;else if(Pf(ft))_e.element=ft,_e.width=ft.width,_e.height=ft.height,_e.channels=4;else if(cs(ft))_e.element=ft,_e.width=ft.naturalWidth,_e.height=ft.naturalHeight,_e.channels=4;else if(ju(ft))_e.element=ft,_e.width=ft.videoWidth,_e.height=ft.videoHeight,_e.channels=4;else if(vl(ft)){var Re=_e.width||ft[0].length,ce=_e.height||ft.length,Ke=_e.channels;ca(ft[0][0])?Ke=Ke||ft[0][0].length:Ke=Ke||1;for(var it=K.shape(ft),Nt=1,mt=0;mt<it.length;++mt)Nt*=it[mt];var Lt=Of(_e,Nt);K.flatten(ft,it,"",Lt),Js(_e,Lt),_e.alignment=1,_e.width=Re,_e.height=ce,_e.channels=Ke,_e.format=_e.internalformat=fa[Ke],_e.needsFree=!0}_e.type===Su?le(ye.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):_e.type===Bs&&le(ye.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function jt(_e,yt,ft){var Vr=_e.element,ti=_e.data,pe=_e.internalformat,$=_e.format,Be=_e.type,Qe=_e.width,et=_e.height;pn(_e),Vr?k.texImage2D(yt,ft,$,$,Be,Vr):_e.compressed?k.compressedTexImage2D(yt,ft,pe,Qe,et,0,ti):_e.needsCopy?(_t(),k.copyTexImage2D(yt,ft,$,_e.xOffset,_e.yOffset,Qe,et,0)):k.texImage2D(yt,ft,$,Qe,et,0,$,Be,ti||null)}function xn(_e,yt,ft,Vr,ti){var pe=_e.element,$=_e.data,Be=_e.internalformat,Qe=_e.format,et=_e.type,Ue=_e.width,Ne=_e.height;pn(_e),pe?k.texSubImage2D(yt,ti,ft,Vr,Qe,et,pe):_e.compressed?k.compressedTexSubImage2D(yt,ti,ft,Vr,Be,Ue,Ne,$):_e.needsCopy?(_t(),k.copyTexSubImage2D(yt,ti,ft,Vr,_e.xOffset,_e.yOffset,Ue,Ne)):k.texSubImage2D(yt,ti,ft,Vr,Ue,Ne,Qe,et,$)}var yn=[];function Kr(){return yn.pop()||new wr}function Qn(_e){_e.needsFree&&pt.freeType(_e.data),wr.call(_e),yn.push(_e)}function Dn(){Wt.call(this),this.genMipmaps=!1,this.mipmapHint=ii,this.mipmask=0,this.images=Array(16)}function Yn(_e,yt,ft){var Vr=_e.images[0]=Kr();_e.mipmask=1,Vr.width=_e.width=yt,Vr.height=_e.height=ft,Vr.channels=_e.channels=4}function gi(_e,yt){var ft=null;if(If(yt))ft=_e.images[0]=Kr(),yr(ft,_e),qt(ft,yt),_e.mipmask=1;else if(ln(_e,yt),Array.isArray(yt.mipmap))for(var Vr=yt.mipmap,ti=0;ti<Vr.length;++ti)ft=_e.images[ti]=Kr(),yr(ft,_e),ft.width>>=ti,ft.height>>=ti,qt(ft,Vr[ti]),_e.mipmask|=1<<ti;else ft=_e.images[0]=Kr(),yr(ft,_e),qt(ft,yt),_e.mipmask=1;yr(_e,_e.images[0]),_e.compressed&&(_e.internalformat===ll||_e.internalformat===cl||_e.internalformat===xu||_e.internalformat===fc)&&le(_e.width%4==0&&_e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ba(_e,yt){for(var ft=_e.images,Vr=0;Vr<ft.length;++Vr){if(!ft[Vr])return;jt(ft[Vr],yt,Vr)}}var so=[];function ai(){var _e=so.pop()||new Dn;Wt.call(_e),_e.mipmask=0;for(var yt=0;yt<16;++yt)_e.images[yt]=null;return _e}function ha(_e){for(var yt=_e.images,ft=0;ft<yt.length;++ft)yt[ft]&&Qn(yt[ft]),yt[ft]=null;so.push(_e)}function Hi(){this.minFilter=hl,this.magFilter=hl,this.wrapS=pl,this.wrapT=pl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ii}function Za(_e,yt){if("min"in yt){var ft=yt.min;le.parameter(ft,or),_e.minFilter=or[ft],Zu.indexOf(_e.minFilter)>=0&&!("faces"in yt)&&(_e.genMipmaps=!0)}if("mag"in yt){var Vr=yt.mag;le.parameter(Vr,fr),_e.magFilter=fr[Vr]}var ti=_e.wrapS,pe=_e.wrapT;if("wrap"in yt){var $=yt.wrap;typeof $=="string"?(le.parameter($,ar),ti=pe=ar[$]):Array.isArray($)&&(le.parameter($[0],ar),le.parameter($[1],ar),ti=ar[$[0]],pe=ar[$[1]])}else{if("wrapS"in yt){var Be=yt.wrapS;le.parameter(Be,ar),ti=ar[Be]}if("wrapT"in yt){var Qe=yt.wrapT;le.parameter(Qe,ar),pe=ar[Qe]}}if(_e.wrapS=ti,_e.wrapT=pe,"anisotropic"in yt){var et=yt.anisotropic;le(typeof et=="number"&&et>=1&&et<=ye.maxAnisotropic,"aniso samples must be between 1 and "),_e.anisotropic=yt.anisotropic}if("mipmap"in yt){var Ue=!1;switch(typeof yt.mipmap){case"string":le.parameter(yt.mipmap,nr,"invalid mipmap hint"),_e.mipmapHint=nr[yt.mipmap],_e.genMipmaps=!0,Ue=!0;break;case"boolean":Ue=_e.genMipmaps=yt.mipmap;break;case"object":le(Array.isArray(yt.mipmap),"invalid mipmap type"),_e.genMipmaps=!1,Ue=!0;break;default:le.raise("invalid mipmap type")}Ue&&!("min"in yt)&&(_e.minFilter=Tn)}}function Ka(_e,yt){k.texParameteri(yt,Tf,_e.minFilter),k.texParameteri(yt,pc,_e.magFilter),k.texParameteri(yt,Ef,_e.wrapS),k.texParameteri(yt,np,_e.wrapT),ie.ext_texture_filter_anisotropic&&k.texParameteri(yt,jc,_e.anisotropic),_e.genMipmaps&&(k.hint(Nu,_e.mipmapHint),k.generateMipmap(yt))}var $a=0,uo={},_o=ye.maxTextureUnits,Ia=Array(_o).map(function(){return null});function Vn(_e){Wt.call(this),this.mipmask=0,this.internalformat=_u,this.id=$a++,this.refCount=1,this.target=_e,this.texture=k.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Hi,Mt.profile&&(this.stats={size:0})}function Po(_e){k.activeTexture(zu),k.bindTexture(_e.target,_e.texture)}function Ai(){var _e=Ia[0];_e?k.bindTexture(_e.target,_e.texture):k.bindTexture(Ao,null)}function mn(_e){var yt=_e.texture;le(yt,"must not double destroy texture");var ft=_e.unit,Vr=_e.target;ft>=0&&(k.activeTexture(zu+ft),k.bindTexture(Vr,null),Ia[ft]=null),k.deleteTexture(yt),_e.texture=null,_e.params=null,_e.pixels=null,_e.refCount=0,delete uo[_e.id],ht.textureCount--}G(Vn.prototype,{bind:function(){var _e=this;_e.bindCount+=1;var yt=_e.unit;if(yt<0){for(var ft=0;ft<_o;++ft){var Vr=Ia[ft];if(Vr){if(Vr.bindCount>0)continue;Vr.unit=-1}Ia[ft]=_e,yt=ft;break}yt>=_o&&le.raise("insufficient number of texture units"),Mt.profile&&ht.maxTextureUnits<yt+1&&(ht.maxTextureUnits=yt+1),_e.unit=yt,k.activeTexture(zu+yt),k.bindTexture(_e.target,_e.texture)}return yt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&mn(this)}});function ei(_e,yt){var ft=new Vn(Ao);uo[ft.id]=ft,ht.textureCount++;function Vr($,Be){var Qe=ft.texInfo;Hi.call(Qe);var et=ai();return typeof $=="number"?typeof Be=="number"?Yn(et,$|0,Be|0):Yn(et,$|0,$|0):$?(le.type($,"object","invalid arguments to regl.texture"),Za(Qe,$),gi(et,$)):Yn(et,1,1),Qe.genMipmaps&&(et.mipmask=(et.width<<1)-1),ft.mipmask=et.mipmask,yr(ft,et),le.texture2D(Qe,et,ye),ft.internalformat=et.internalformat,Vr.width=et.width,Vr.height=et.height,Po(ft),ba(et,Ao),Ka(Qe,Ao),Ai(),ha(et),Mt.profile&&(ft.stats.size=Xn(ft.internalformat,ft.type,et.width,et.height,Qe.genMipmaps,!1)),Vr.format=ir[ft.internalformat],Vr.type=kr[ft.type],Vr.mag=Ht[Qe.magFilter],Vr.min=Nr[Qe.minFilter],Vr.wrapS=Qt[Qe.wrapS],Vr.wrapT=Qt[Qe.wrapT],Vr}function ti($,Be,Qe,et){le(!!$,"must specify image data");var Ue=Be|0,Ne=Qe|0,Xe=et|0,de=Kr();return yr(de,ft),de.width=0,de.height=0,qt(de,$),de.width=de.width||(ft.width>>Xe)-Ue,de.height=de.height||(ft.height>>Xe)-Ne,le(ft.type===de.type&&ft.format===de.format&&ft.internalformat===de.internalformat,"incompatible format for texture.subimage"),le(Ue>=0&&Ne>=0&&Ue+de.width<=ft.width&&Ne+de.height<=ft.height,"texture.subimage write out of bounds"),le(ft.mipmask&1<<Xe,"missing mipmap data"),le(de.data||de.element||de.needsCopy,"missing image data"),Po(ft),xn(de,Ao,Ue,Ne,Xe),Ai(),Qn(de),Vr}function pe($,Be){var Qe=$|0,et=Be|0||Qe;if(Qe===ft.width&&et===ft.height)return Vr;Vr.width=ft.width=Qe,Vr.height=ft.height=et,Po(ft);for(var Ue=0;ft.mipmask>>Ue;++Ue){var Ne=Qe>>Ue,Xe=et>>Ue;if(!Ne||!Xe)break;k.texImage2D(Ao,Ue,ft.format,Ne,Xe,0,ft.format,ft.type,null)}return Ai(),Mt.profile&&(ft.stats.size=Xn(ft.internalformat,ft.type,Qe,et,!1,!1)),Vr}return Vr(_e,yt),Vr.subimage=ti,Vr.resize=pe,Vr._reglType="texture2d",Vr._texture=ft,Mt.profile&&(Vr.stats=ft.stats),Vr.destroy=function(){ft.decRef()},Vr}function ci(_e,yt,ft,Vr,ti,pe){var $=new Vn(Bc);uo[$.id]=$,ht.cubeCount++;var Be=new Array(6);function Qe(Ne,Xe,de,Re,ce,Ke){var it,Nt=$.texInfo;for(Hi.call(Nt),it=0;it<6;++it)Be[it]=ai();if(typeof Ne=="number"||!Ne){var mt=Ne|0||1;for(it=0;it<6;++it)Yn(Be[it],mt,mt)}else if(typeof Ne=="object")if(Xe)gi(Be[0],Ne),gi(Be[1],Xe),gi(Be[2],de),gi(Be[3],Re),gi(Be[4],ce),gi(Be[5],Ke);else if(Za(Nt,Ne),ln($,Ne),"faces"in Ne){var Lt=Ne.faces;for(le(Array.isArray(Lt)&&Lt.length===6,"cube faces must be a length 6 array"),it=0;it<6;++it)le(typeof Lt[it]=="object"&&!!Lt[it],"invalid input for cube map face"),yr(Be[it],$),gi(Be[it],Lt[it])}else for(it=0;it<6;++it)gi(Be[it],Ne);else le.raise("invalid arguments to cube map");for(yr($,Be[0]),ye.npotTextureCube||le(gu($.width)&&gu($.height),"your browser does not support non power or two texture dimensions"),Nt.genMipmaps?$.mipmask=(Be[0].width<<1)-1:$.mipmask=Be[0].mipmask,le.textureCube($,Nt,Be,ye),$.internalformat=Be[0].internalformat,Qe.width=Be[0].width,Qe.height=Be[0].height,Po($),it=0;it<6;++it)ba(Be[it],lc+it);for(Ka(Nt,Bc),Ai(),Mt.profile&&($.stats.size=Xn($.internalformat,$.type,Qe.width,Qe.height,Nt.genMipmaps,!0)),Qe.format=ir[$.internalformat],Qe.type=kr[$.type],Qe.mag=Ht[Nt.magFilter],Qe.min=Nr[Nt.minFilter],Qe.wrapS=Qt[Nt.wrapS],Qe.wrapT=Qt[Nt.wrapT],it=0;it<6;++it)ha(Be[it]);return Qe}function et(Ne,Xe,de,Re,ce){le(!!Xe,"must specify image data"),le(typeof Ne=="number"&&Ne===(Ne|0)&&Ne>=0&&Ne<6,"invalid face");var Ke=de|0,it=Re|0,Nt=ce|0,mt=Kr();return yr(mt,$),mt.width=0,mt.height=0,qt(mt,Xe),mt.width=mt.width||($.width>>Nt)-Ke,mt.height=mt.height||($.height>>Nt)-it,le($.type===mt.type&&$.format===mt.format&&$.internalformat===mt.internalformat,"incompatible format for texture.subimage"),le(Ke>=0&&it>=0&&Ke+mt.width<=$.width&&it+mt.height<=$.height,"texture.subimage write out of bounds"),le($.mipmask&1<<Nt,"missing mipmap data"),le(mt.data||mt.element||mt.needsCopy,"missing image data"),Po($),xn(mt,lc+Ne,Ke,it,Nt),Ai(),Qn(mt),Qe}function Ue(Ne){var Xe=Ne|0;if(Xe!==$.width){Qe.width=$.width=Xe,Qe.height=$.height=Xe,Po($);for(var de=0;de<6;++de)for(var Re=0;$.mipmask>>Re;++Re)k.texImage2D(lc+de,Re,$.format,Xe>>Re,Xe>>Re,0,$.format,$.type,null);return Ai(),Mt.profile&&($.stats.size=Xn($.internalformat,$.type,Qe.width,Qe.height,!1,!0)),Qe}}return Qe(_e,yt,ft,Vr,ti,pe),Qe.subimage=et,Qe.resize=Ue,Qe._reglType="textureCube",Qe._texture=$,Mt.profile&&(Qe.stats=$.stats),Qe.destroy=function(){$.decRef()},Qe}function wa(){for(var _e=0;_e<_o;++_e)k.activeTexture(zu+_e),k.bindTexture(Ao,null),Ia[_e]=null;Ri(uo).forEach(mn),ht.cubeCount=0,ht.textureCount=0}Mt.profile&&(ht.getTotalTextureSize=function(){var _e=0;return Object.keys(uo).forEach(function(yt){_e+=uo[yt].stats.size}),_e});function Gs(){for(var _e=0;_e<_o;++_e){var yt=Ia[_e];yt&&(yt.bindCount=0,yt.unit=-1,Ia[_e]=null)}Ri(uo).forEach(function(ft){ft.texture=k.createTexture(),k.bindTexture(ft.target,ft.texture);for(var Vr=0;Vr<32;++Vr)if((ft.mipmask&1<<Vr)!=0)if(ft.target===Ao)k.texImage2D(Ao,Vr,ft.internalformat,ft.width>>Vr,ft.height>>Vr,0,ft.internalformat,ft.type,null);else for(var ti=0;ti<6;++ti)k.texImage2D(lc+ti,Vr,ft.internalformat,ft.width>>Vr,ft.height>>Vr,0,ft.internalformat,ft.type,null);Ka(ft.texInfo,ft.target)})}function Qu(){for(var _e=0;_e<_o;++_e){var yt=Ia[_e];yt&&(yt.bindCount=0,yt.unit=-1,Ia[_e]=null),k.activeTexture(zu+_e),k.bindTexture(Ao,null),k.bindTexture(Bc,null)}}return{create2D:ei,createCube:ci,clear:wa,getTexture:function(_e){return null},restore:Gs,refresh:Qu}}var ro=36161,Pa=32854,Bo=32855,No=36194,fs=33189,co=36168,ml=34041,on=35907,Xr=34836,mc=34842,yo=34843,Fa=[];Fa[Pa]=2,Fa[Bo]=2,Fa[No]=2,Fa[fs]=2,Fa[co]=1,Fa[ml]=4,Fa[on]=4,Fa[Xr]=16,Fa[mc]=8,Fa[yo]=6;function ya(k,ie,ye){return Fa[k]*ie*ye}var ta=function(k,ie,ye,_t,Bt){var ht={rgba4:Pa,rgb565:No,"rgb5 a1":Bo,depth:fs,stencil:co,"depth stencil":ml};ie.ext_srgb&&(ht.srgba=on),ie.ext_color_buffer_half_float&&(ht.rgba16f=mc,ht.rgb16f=yo),ie.webgl_color_buffer_float&&(ht.rgba32f=Xr);var Mt=[];Object.keys(ht).forEach(function(rr){var vr=ht[rr];Mt[vr]=rr});var nr=0,ar={};function fr(rr){this.id=nr++,this.refCount=1,this.renderbuffer=rr,this.format=Pa,this.width=0,this.height=0,Bt.profile&&(this.stats={size:0})}fr.prototype.decRef=function(){--this.refCount<=0&&or(this)};function or(rr){var vr=rr.renderbuffer;le(vr,"must not double destroy renderbuffer"),k.bindRenderbuffer(ro,null),k.deleteRenderbuffer(vr),rr.renderbuffer=null,rr.refCount=0,delete ar[rr.id],_t.renderbufferCount--}function mr(rr,vr){var tt=new fr(k.createRenderbuffer());ar[tt.id]=tt,_t.renderbufferCount++;function xt(kr,Ht){var Nr=0,Qt=0,Er=Pa;if(typeof kr=="object"&&kr){var Wt=kr;if("shape"in Wt){var yr=Wt.shape;le(Array.isArray(yr)&&yr.length>=2,"invalid renderbuffer shape"),Nr=yr[0]|0,Qt=yr[1]|0}else"radius"in Wt&&(Nr=Qt=Wt.radius|0),"width"in Wt&&(Nr=Wt.width|0),"height"in Wt&&(Qt=Wt.height|0);"format"in Wt&&(le.parameter(Wt.format,ht,"invalid renderbuffer format"),Er=ht[Wt.format])}else typeof kr=="number"?(Nr=kr|0,typeof Ht=="number"?Qt=Ht|0:Qt=Nr):kr?le.raise("invalid arguments to renderbuffer constructor"):Nr=Qt=1;if(le(Nr>0&&Qt>0&&Nr<=ye.maxRenderbufferSize&&Qt<=ye.maxRenderbufferSize,"invalid renderbuffer size"),!(Nr===tt.width&&Qt===tt.height&&Er===tt.format))return xt.width=tt.width=Nr,xt.height=tt.height=Qt,tt.format=Er,k.bindRenderbuffer(ro,tt.renderbuffer),k.renderbufferStorage(ro,Er,Nr,Qt),le(k.getError()===0,"invalid render buffer format"),Bt.profile&&(tt.stats.size=ya(tt.format,tt.width,tt.height)),xt.format=Mt[tt.format],xt}function ir(kr,Ht){var Nr=kr|0,Qt=Ht|0||Nr;return Nr===tt.width&&Qt===tt.height||(le(Nr>0&&Qt>0&&Nr<=ye.maxRenderbufferSize&&Qt<=ye.maxRenderbufferSize,"invalid renderbuffer size"),xt.width=tt.width=Nr,xt.height=tt.height=Qt,k.bindRenderbuffer(ro,tt.renderbuffer),k.renderbufferStorage(ro,tt.format,Nr,Qt),le(k.getError()===0,"invalid render buffer format"),Bt.profile&&(tt.stats.size=ya(tt.format,tt.width,tt.height))),xt}return xt(rr,vr),xt.resize=ir,xt._reglType="renderbuffer",xt._renderbuffer=tt,Bt.profile&&(xt.stats=tt.stats),xt.destroy=function(){tt.decRef()},xt}Bt.profile&&(_t.getTotalRenderbufferSize=function(){var rr=0;return Object.keys(ar).forEach(function(vr){rr+=ar[vr].stats.size}),rr});function Ar(){Ri(ar).forEach(function(rr){rr.renderbuffer=k.createRenderbuffer(),k.bindRenderbuffer(ro,rr.renderbuffer),k.renderbufferStorage(ro,rr.format,rr.width,rr.height)}),k.bindRenderbuffer(ro,null)}return{create:mr,clear:function(){Ri(ar).forEach(or)},restore:Ar}},Ss=36160,yl=36161,pi=3553,pa=34069,Hc=36064,Vu=36096,Wc=36128,eu=33306,zo=36053,Zo=36054,tu=36055,ga=36057,re=36061,Vl=36193,Xc=5121,gl=5126,Eu=6407,yc=6408,Cu=6402,ps=[Eu,yc],_l=[];_l[yc]=4,_l[Eu]=3;var Es=[];Es[Xc]=1,Es[gl]=4,Es[Vl]=2;var hs=32854,Yc=32855,Gl=36194,qc=33189,Kc=36168,u=34041,f=35907,l=34836,h=34842,x=34843,S=[hs,Yc,Gl,f,h,x,l],E={};E[zo]="complete",E[Zo]="incomplete attachment",E[ga]="incomplete dimensions",E[tu]="incomplete, missing attachment",E[re]="unsupported";function P(k,ie,ye,_t,Bt,ht){var Mt={cur:null,next:null,dirty:!1,setFBO:null},nr=["rgba"],ar=["rgba4","rgb565","rgb5 a1"];ie.ext_srgb&&ar.push("srgba"),ie.ext_color_buffer_half_float&&ar.push("rgba16f","rgb16f"),ie.webgl_color_buffer_float&&ar.push("rgba32f");var fr=["uint8"];ie.oes_texture_half_float&&fr.push("half float","float16"),ie.oes_texture_float&&fr.push("float","float32");function or(wr,qt,jt){this.target=wr,this.texture=qt,this.renderbuffer=jt;var xn=0,yn=0;qt?(xn=qt.width,yn=qt.height):jt&&(xn=jt.width,yn=jt.height),this.width=xn,this.height=yn}function mr(wr){wr&&(wr.texture&&wr.texture._texture.decRef(),wr.renderbuffer&&wr.renderbuffer._renderbuffer.decRef())}function Ar(wr,qt,jt){if(!!wr)if(wr.texture){var xn=wr.texture._texture,yn=Math.max(1,xn.width),Kr=Math.max(1,xn.height);le(yn===qt&&Kr===jt,"inconsistent width/height for supplied texture"),xn.refCount+=1}else{var Qn=wr.renderbuffer._renderbuffer;le(Qn.width===qt&&Qn.height===jt,"inconsistent width/height for renderbuffer"),Qn.refCount+=1}}function rr(wr,qt){qt&&(qt.texture?k.framebufferTexture2D(Ss,wr,qt.target,qt.texture._texture.texture,0):k.framebufferRenderbuffer(Ss,wr,yl,qt.renderbuffer._renderbuffer.renderbuffer))}function vr(wr){var qt=pi,jt=null,xn=null,yn=wr;typeof wr=="object"&&(yn=wr.data,"target"in wr&&(qt=wr.target|0)),le.type(yn,"function","invalid attachment data");var Kr=yn._reglType;return Kr==="texture2d"?(jt=yn,le(qt===pi)):Kr==="textureCube"?(jt=yn,le(qt>=pa&&qt<pa+6,"invalid cube map target")):Kr==="renderbuffer"?(xn=yn,qt=yl):le.raise("invalid regl object for attachment"),new or(qt,jt,xn)}function tt(wr,qt,jt,xn,yn){if(jt){var Kr=_t.create2D({width:wr,height:qt,format:xn,type:yn});return Kr._texture.refCount=0,new or(pi,Kr,null)}else{var Qn=Bt.create({width:wr,height:qt,format:xn});return Qn._renderbuffer.refCount=0,new or(yl,null,Qn)}}function xt(wr){return wr&&(wr.texture||wr.renderbuffer)}function ir(wr,qt,jt){wr&&(wr.texture?wr.texture.resize(qt,jt):wr.renderbuffer&&wr.renderbuffer.resize(qt,jt),wr.width=qt,wr.height=jt)}var kr=0,Ht={};function Nr(){this.id=kr++,Ht[this.id]=this,this.framebuffer=k.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qt(wr){wr.colorAttachments.forEach(mr),mr(wr.depthAttachment),mr(wr.stencilAttachment),mr(wr.depthStencilAttachment)}function Er(wr){var qt=wr.framebuffer;le(qt,"must not double destroy framebuffer"),k.deleteFramebuffer(qt),wr.framebuffer=null,ht.framebufferCount--,delete Ht[wr.id]}function Wt(wr){var qt;k.bindFramebuffer(Ss,wr.framebuffer);var jt=wr.colorAttachments;for(qt=0;qt<jt.length;++qt)rr(Hc+qt,jt[qt]);for(qt=jt.length;qt<ye.maxColorAttachments;++qt)k.framebufferTexture2D(Ss,Hc+qt,pi,null,0);k.framebufferTexture2D(Ss,eu,pi,null,0),k.framebufferTexture2D(Ss,Vu,pi,null,0),k.framebufferTexture2D(Ss,Wc,pi,null,0),rr(Vu,wr.depthAttachment),rr(Wc,wr.stencilAttachment),rr(eu,wr.depthStencilAttachment);var xn=k.checkFramebufferStatus(Ss);!k.isContextLost()&&xn!==zo&&le.raise("framebuffer configuration not supported, status = "+E[xn]),k.bindFramebuffer(Ss,Mt.next?Mt.next.framebuffer:null),Mt.cur=Mt.next,k.getError()}function yr(wr,qt){var jt=new Nr;ht.framebufferCount++;function xn(Kr,Qn){var Dn;le(Mt.next!==jt,"can not update framebuffer which is currently in use");var Yn=0,gi=0,ba=!0,so=!0,ai=null,ha=!0,Hi="rgba",Za="uint8",Ka=1,$a=null,uo=null,_o=null,Ia=!1;if(typeof Kr=="number")Yn=Kr|0,gi=Qn|0||Yn;else if(!Kr)Yn=gi=1;else{le.type(Kr,"object","invalid arguments for framebuffer");var Vn=Kr;if("shape"in Vn){var Po=Vn.shape;le(Array.isArray(Po)&&Po.length>=2,"invalid shape for framebuffer"),Yn=Po[0],gi=Po[1]}else"radius"in Vn&&(Yn=gi=Vn.radius),"width"in Vn&&(Yn=Vn.width),"height"in Vn&&(gi=Vn.height);("color"in Vn||"colors"in Vn)&&(ai=Vn.color||Vn.colors,Array.isArray(ai)&&le(ai.length===1||ie.webgl_draw_buffers,"multiple render targets not supported")),ai||("colorCount"in Vn&&(Ka=Vn.colorCount|0,le(Ka>0,"invalid color buffer count")),"colorTexture"in Vn&&(ha=!!Vn.colorTexture,Hi="rgba4"),"colorType"in Vn&&(Za=Vn.colorType,ha?(le(ie.oes_texture_float||!(Za==="float"||Za==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),le(ie.oes_texture_half_float||!(Za==="half float"||Za==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Za==="half float"||Za==="float16"?(le(ie.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Hi="rgba16f"):(Za==="float"||Za==="float32")&&(le(ie.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Hi="rgba32f"),le.oneOf(Za,fr,"invalid color type")),"colorFormat"in Vn&&(Hi=Vn.colorFormat,nr.indexOf(Hi)>=0?ha=!0:ar.indexOf(Hi)>=0?ha=!1:ha?le.oneOf(Vn.colorFormat,nr,"invalid color format for texture"):le.oneOf(Vn.colorFormat,ar,"invalid color format for renderbuffer"))),("depthTexture"in Vn||"depthStencilTexture"in Vn)&&(Ia=!!(Vn.depthTexture||Vn.depthStencilTexture),le(!Ia||ie.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Vn&&(typeof Vn.depth=="boolean"?ba=Vn.depth:($a=Vn.depth,so=!1)),"stencil"in Vn&&(typeof Vn.stencil=="boolean"?so=Vn.stencil:(uo=Vn.stencil,ba=!1)),"depthStencil"in Vn&&(typeof Vn.depthStencil=="boolean"?ba=so=Vn.depthStencil:(_o=Vn.depthStencil,ba=!1,so=!1))}var Ai=null,mn=null,ei=null,ci=null;if(Array.isArray(ai))Ai=ai.map(vr);else if(ai)Ai=[vr(ai)];else for(Ai=new Array(Ka),Dn=0;Dn<Ka;++Dn)Ai[Dn]=tt(Yn,gi,ha,Hi,Za);le(ie.webgl_draw_buffers||Ai.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),le(Ai.length<=ye.maxColorAttachments,"too many color attachments, not supported"),Yn=Yn||Ai[0].width,gi=gi||Ai[0].height,$a?mn=vr($a):ba&&!so&&(mn=tt(Yn,gi,Ia,"depth","uint32")),uo?ei=vr(uo):so&&!ba&&(ei=tt(Yn,gi,!1,"stencil","uint8")),_o?ci=vr(_o):!$a&&!uo&&so&&ba&&(ci=tt(Yn,gi,Ia,"depth stencil","depth stencil")),le(!!$a+!!uo+!!_o<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var wa=null;for(Dn=0;Dn<Ai.length;++Dn)if(Ar(Ai[Dn],Yn,gi),le(!Ai[Dn]||Ai[Dn].texture&&ps.indexOf(Ai[Dn].texture._texture.format)>=0||Ai[Dn].renderbuffer&&S.indexOf(Ai[Dn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Dn+" is invalid"),Ai[Dn]&&Ai[Dn].texture){var Gs=_l[Ai[Dn].texture._texture.format]*Es[Ai[Dn].texture._texture.type];wa===null?wa=Gs:le(wa===Gs,"all color attachments much have the same number of bits per pixel.")}return Ar(mn,Yn,gi),le(!mn||mn.texture&&mn.texture._texture.format===Cu||mn.renderbuffer&&mn.renderbuffer._renderbuffer.format===qc,"invalid depth attachment for framebuffer object"),Ar(ei,Yn,gi),le(!ei||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===Kc,"invalid stencil attachment for framebuffer object"),Ar(ci,Yn,gi),le(!ci||ci.texture&&ci.texture._texture.format===u||ci.renderbuffer&&ci.renderbuffer._renderbuffer.format===u,"invalid depth-stencil attachment for framebuffer object"),Qt(jt),jt.width=Yn,jt.height=gi,jt.colorAttachments=Ai,jt.depthAttachment=mn,jt.stencilAttachment=ei,jt.depthStencilAttachment=ci,xn.color=Ai.map(xt),xn.depth=xt(mn),xn.stencil=xt(ei),xn.depthStencil=xt(ci),xn.width=jt.width,xn.height=jt.height,Wt(jt),xn}function yn(Kr,Qn){le(Mt.next!==jt,"can not resize a framebuffer which is currently in use");var Dn=Math.max(Kr|0,1),Yn=Math.max(Qn|0||Dn,1);if(Dn===jt.width&&Yn===jt.height)return xn;for(var gi=jt.colorAttachments,ba=0;ba<gi.length;++ba)ir(gi[ba],Dn,Yn);return ir(jt.depthAttachment,Dn,Yn),ir(jt.stencilAttachment,Dn,Yn),ir(jt.depthStencilAttachment,Dn,Yn),jt.width=xn.width=Dn,jt.height=xn.height=Yn,Wt(jt),xn}return xn(wr,qt),G(xn,{resize:yn,_reglType:"framebuffer",_framebuffer:jt,destroy:function(){Er(jt),Qt(jt)},use:function(Kr){Mt.setFBO({framebuffer:xn},Kr)}})}function ln(wr){var qt=Array(6);function jt(yn){var Kr;le(qt.indexOf(Mt.next)<0,"can not update framebuffer which is currently in use");var Qn={color:null},Dn=0,Yn=null,gi="rgba",ba="uint8",so=1;if(typeof yn=="number")Dn=yn|0;else if(!yn)Dn=1;else{le.type(yn,"object","invalid arguments for framebuffer");var ai=yn;if("shape"in ai){var ha=ai.shape;le(Array.isArray(ha)&&ha.length>=2,"invalid shape for framebuffer"),le(ha[0]===ha[1],"cube framebuffer must be square"),Dn=ha[0]}else"radius"in ai&&(Dn=ai.radius|0),"width"in ai?(Dn=ai.width|0,"height"in ai&&le(ai.height===Dn,"must be square")):"height"in ai&&(Dn=ai.height|0);("color"in ai||"colors"in ai)&&(Yn=ai.color||ai.colors,Array.isArray(Yn)&&le(Yn.length===1||ie.webgl_draw_buffers,"multiple render targets not supported")),Yn||("colorCount"in ai&&(so=ai.colorCount|0,le(so>0,"invalid color buffer count")),"colorType"in ai&&(le.oneOf(ai.colorType,fr,"invalid color type"),ba=ai.colorType),"colorFormat"in ai&&(gi=ai.colorFormat,le.oneOf(ai.colorFormat,nr,"invalid color format for texture"))),"depth"in ai&&(Qn.depth=ai.depth),"stencil"in ai&&(Qn.stencil=ai.stencil),"depthStencil"in ai&&(Qn.depthStencil=ai.depthStencil)}var Hi;if(Yn)if(Array.isArray(Yn))for(Hi=[],Kr=0;Kr<Yn.length;++Kr)Hi[Kr]=Yn[Kr];else Hi=[Yn];else{Hi=Array(so);var Za={radius:Dn,format:gi,type:ba};for(Kr=0;Kr<so;++Kr)Hi[Kr]=_t.createCube(Za)}for(Qn.color=Array(Hi.length),Kr=0;Kr<Hi.length;++Kr){var Ka=Hi[Kr];le(typeof Ka=="function"&&Ka._reglType==="textureCube","invalid cube map"),Dn=Dn||Ka.width,le(Ka.width===Dn&&Ka.height===Dn,"invalid cube map shape"),Qn.color[Kr]={target:pa,data:Hi[Kr]}}for(Kr=0;Kr<6;++Kr){for(var $a=0;$a<Hi.length;++$a)Qn.color[$a].target=pa+Kr;Kr>0&&(Qn.depth=qt[0].depth,Qn.stencil=qt[0].stencil,Qn.depthStencil=qt[0].depthStencil),qt[Kr]?qt[Kr](Qn):qt[Kr]=yr(Qn)}return G(jt,{width:Dn,height:Dn,color:Hi})}function xn(yn){var Kr,Qn=yn|0;if(le(Qn>0&&Qn<=ye.maxCubeMapSize,"invalid radius for cube fbo"),Qn===jt.width)return jt;var Dn=jt.color;for(Kr=0;Kr<Dn.length;++Kr)Dn[Kr].resize(Qn);for(Kr=0;Kr<6;++Kr)qt[Kr].resize(Qn);return jt.width=jt.height=Qn,jt}return jt(wr),G(jt,{faces:qt,resize:xn,_reglType:"framebufferCube",destroy:function(){qt.forEach(function(yn){yn.destroy()})}})}function pn(){Mt.cur=null,Mt.next=null,Mt.dirty=!0,Ri(Ht).forEach(function(wr){wr.framebuffer=k.createFramebuffer(),Wt(wr)})}return G(Mt,{getFramebuffer:function(wr){if(typeof wr=="function"&&wr._reglType==="framebuffer"){var qt=wr._framebuffer;if(qt instanceof Nr)return qt}return null},create:yr,createCube:ln,clear:function(){Ri(Ht).forEach(Er)},restore:pn})}var R=5126,z=34962;function j(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function ee(k,ie,ye,_t,Bt){for(var ht=ye.maxAttributes,Mt=new Array(ht),nr=0;nr<ht;++nr)Mt[nr]=new j;var ar=0,fr={},or={Record:j,scope:{},state:Mt,currentVAO:null,targetVAO:null,restore:Ar()?Ht:function(){},createVAO:Nr,getVAO:vr,destroyBuffer:mr,setVAO:Ar()?tt:xt,clear:Ar()?ir:function(){}};function mr(Qt){for(var Er=0;Er<Mt.length;++Er){var Wt=Mt[Er];Wt.buffer===Qt&&(k.disableVertexAttribArray(Er),Wt.buffer=null)}}function Ar(){return ie.oes_vertex_array_object}function rr(){return ie.angle_instanced_arrays}function vr(Qt){return typeof Qt=="function"&&Qt._vao?Qt._vao:null}function tt(Qt){if(Qt!==or.currentVAO){var Er=Ar();Qt?Er.bindVertexArrayOES(Qt.vao):Er.bindVertexArrayOES(null),or.currentVAO=Qt}}function xt(Qt){if(Qt!==or.currentVAO){if(Qt)Qt.bindAttrs();else for(var Er=rr(),Wt=0;Wt<Mt.length;++Wt){var yr=Mt[Wt];yr.buffer?(k.enableVertexAttribArray(Wt),k.vertexAttribPointer(Wt,yr.size,yr.type,yr.normalized,yr.stride,yr.offfset),Er&&yr.divisor&&Er.vertexAttribDivisorANGLE(Wt,yr.divisor)):(k.disableVertexAttribArray(Wt),k.vertexAttrib4f(Wt,yr.x,yr.y,yr.z,yr.w))}or.currentVAO=Qt}}function ir(){Ri(fr).forEach(function(Qt){Qt.destroy()})}function kr(){this.id=++ar,this.attributes=[];var Qt=Ar();Qt?this.vao=Qt.createVertexArrayOES():this.vao=null,fr[this.id]=this,this.buffers=[]}kr.prototype.bindAttrs=function(){for(var Qt=rr(),Er=this.attributes,Wt=0;Wt<Er.length;++Wt){var yr=Er[Wt];yr.buffer?(k.enableVertexAttribArray(Wt),k.bindBuffer(z,yr.buffer.buffer),k.vertexAttribPointer(Wt,yr.size,yr.type,yr.normalized,yr.stride,yr.offset),Qt&&yr.divisor&&Qt.vertexAttribDivisorANGLE(Wt,yr.divisor)):(k.disableVertexAttribArray(Wt),k.vertexAttrib4f(Wt,yr.x,yr.y,yr.z,yr.w))}for(var ln=Er.length;ln<ht;++ln)k.disableVertexAttribArray(ln)},kr.prototype.refresh=function(){var Qt=Ar();Qt&&(Qt.bindVertexArrayOES(this.vao),this.bindAttrs(),or.currentVAO=this)},kr.prototype.destroy=function(){if(this.vao){var Qt=Ar();this===or.currentVAO&&(or.currentVAO=null,Qt.bindVertexArrayOES(null)),Qt.deleteVertexArrayOES(this.vao),this.vao=null}fr[this.id]&&(delete fr[this.id],_t.vaoCount-=1)};function Ht(){var Qt=Ar();Qt&&Ri(fr).forEach(function(Er){Er.refresh()})}function Nr(Qt){var Er=new kr;_t.vaoCount+=1;function Wt(yr){le(Array.isArray(yr),"arguments to vertex array constructor must be an array"),le(yr.length<ht,"too many attributes"),le(yr.length>0,"must specify at least one attribute");var ln={},pn=Er.attributes;pn.length=yr.length;for(var wr=0;wr<yr.length;++wr){var qt=yr[wr],jt=pn[wr]=new j,xn=qt.data||qt;if(Array.isArray(xn)||X(xn)||va(xn)){var yn;Er.buffers[wr]&&(yn=Er.buffers[wr],X(xn)&&yn._buffer.byteLength>=xn.byteLength?yn.subdata(xn):(yn.destroy(),Er.buffers[wr]=null)),Er.buffers[wr]||(yn=Er.buffers[wr]=Bt.create(qt,z,!1,!0)),jt.buffer=Bt.getBuffer(yn),jt.size=jt.buffer.dimension|0,jt.normalized=!1,jt.type=jt.buffer.dtype,jt.offset=0,jt.stride=0,jt.divisor=0,jt.state=1,ln[wr]=1}else Bt.getBuffer(qt)?(jt.buffer=Bt.getBuffer(qt),jt.size=jt.buffer.dimension|0,jt.normalized=!1,jt.type=jt.buffer.dtype,jt.offset=0,jt.stride=0,jt.divisor=0,jt.state=1):Bt.getBuffer(qt.buffer)?(jt.buffer=Bt.getBuffer(qt.buffer),jt.size=(+qt.size||jt.buffer.dimension)|0,jt.normalized=!!qt.normalized||!1,"type"in qt?(le.parameter(qt.type,ss,"invalid buffer type"),jt.type=ss[qt.type]):jt.type=jt.buffer.dtype,jt.offset=(qt.offset||0)|0,jt.stride=(qt.stride||0)|0,jt.divisor=(qt.divisor||0)|0,jt.state=1,le(jt.size>=1&&jt.size<=4,"size must be between 1 and 4"),le(jt.offset>=0,"invalid offset"),le(jt.stride>=0&&jt.stride<=255,"stride must be between 0 and 255"),le(jt.divisor>=0,"divisor must be positive"),le(!jt.divisor||!!ie.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in qt?(le(wr>0,"first attribute must not be a constant"),jt.x=+qt.x||0,jt.y=+qt.y||0,jt.z=+qt.z||0,jt.w=+qt.w||0,jt.state=2):le(!1,"invalid attribute spec for location "+wr)}for(var Kr=0;Kr<Er.buffers.length;++Kr)!ln[Kr]&&Er.buffers[Kr]&&(Er.buffers[Kr].destroy(),Er.buffers[Kr]=null);return Er.refresh(),Wt}return Wt.destroy=function(){for(var yr=0;yr<Er.buffers.length;++yr)Er.buffers[yr]&&Er.buffers[yr].destroy();Er.buffers.length=0,Er.destroy()},Wt._vao=Er,Wt._reglType="vao",Wt(Qt)}return or}var ne=35632,Ae=35633,Se=35718,De=35721;function ge(k,ie,ye,_t){var Bt={},ht={};function Mt(tt,xt,ir,kr){this.name=tt,this.id=xt,this.location=ir,this.info=kr}function nr(tt,xt){for(var ir=0;ir<tt.length;++ir)if(tt[ir].id===xt.id){tt[ir].location=xt.location;return}tt.push(xt)}function ar(tt,xt,ir){var kr=tt===ne?Bt:ht,Ht=kr[xt];if(!Ht){var Nr=ie.str(xt);Ht=k.createShader(tt),k.shaderSource(Ht,Nr),k.compileShader(Ht),le.shaderError(k,Ht,Nr,tt,ir),kr[xt]=Ht}return Ht}var fr={},or=[],mr=0;function Ar(tt,xt){this.id=mr++,this.fragId=tt,this.vertId=xt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,_t.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function rr(tt,xt,ir){var kr,Ht,Nr=ar(ne,tt.fragId),Qt=ar(Ae,tt.vertId),Er=tt.program=k.createProgram();if(k.attachShader(Er,Nr),k.attachShader(Er,Qt),ir)for(kr=0;kr<ir.length;++kr){var Wt=ir[kr];k.bindAttribLocation(Er,Wt[0],Wt[1])}k.linkProgram(Er),le.linkError(k,Er,ie.str(tt.fragId),ie.str(tt.vertId),xt);var yr=k.getProgramParameter(Er,Se);_t.profile&&(tt.stats.uniformsCount=yr);var ln=tt.uniforms;for(kr=0;kr<yr;++kr)if(Ht=k.getActiveUniform(Er,kr),Ht)if(Ht.size>1)for(var pn=0;pn<Ht.size;++pn){var wr=Ht.name.replace("[0]","["+pn+"]");nr(ln,new Mt(wr,ie.id(wr),k.getUniformLocation(Er,wr),Ht))}else nr(ln,new Mt(Ht.name,ie.id(Ht.name),k.getUniformLocation(Er,Ht.name),Ht));var qt=k.getProgramParameter(Er,De);_t.profile&&(tt.stats.attributesCount=qt);var jt=tt.attributes;for(kr=0;kr<qt;++kr)Ht=k.getActiveAttrib(Er,kr),Ht&&nr(jt,new Mt(Ht.name,ie.id(Ht.name),k.getAttribLocation(Er,Ht.name),Ht))}_t.profile&&(ye.getMaxUniformsCount=function(){var tt=0;return or.forEach(function(xt){xt.stats.uniformsCount>tt&&(tt=xt.stats.uniformsCount)}),tt},ye.getMaxAttributesCount=function(){var tt=0;return or.forEach(function(xt){xt.stats.attributesCount>tt&&(tt=xt.stats.attributesCount)}),tt});function vr(){Bt={},ht={};for(var tt=0;tt<or.length;++tt)rr(or[tt],null,or[tt].attributes.map(function(xt){return[xt.location,xt.name]}))}return{clear:function(){var tt=k.deleteShader.bind(k);Ri(Bt).forEach(tt),Bt={},Ri(ht).forEach(tt),ht={},or.forEach(function(xt){k.deleteProgram(xt.program)}),or.length=0,fr={},ye.shaderCount=0},program:function(tt,xt,ir,kr){le.command(tt>=0,"missing vertex shader",ir),le.command(xt>=0,"missing fragment shader",ir);var Ht=fr[xt];Ht||(Ht=fr[xt]={});var Nr=Ht[tt];if(Nr&&(Nr.refCount++,!kr))return Nr;var Qt=new Ar(xt,tt);return ye.shaderCount++,rr(Qt,ir,kr),Nr||(Ht[tt]=Qt),or.push(Qt),G(Qt,{destroy:function(){if(Qt.refCount--,Qt.refCount<=0){k.deleteProgram(Qt.program);var Er=or.indexOf(Qt);or.splice(Er,1),ye.shaderCount--}Ht[Qt.vertId].refCount<=0&&(k.deleteShader(ht[Qt.vertId]),delete ht[Qt.vertId],delete fr[Qt.fragId][Qt.vertId]),Object.keys(fr[Qt.fragId]).length||(k.deleteShader(Bt[Qt.fragId]),delete Bt[Qt.fragId],delete fr[Qt.fragId])}})},restore:vr,shader:ar,frag:-1,vert:-1}}var Fe=6408,Ge=5121,at=3333,Ct=5126;function wt(k,ie,ye,_t,Bt,ht,Mt){function nr(or){var mr;ie.next===null?(le(Bt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),mr=Ge):(le(ie.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),mr=ie.next.colorAttachments[0].texture._texture.type,ht.oes_texture_float?(le(mr===Ge||mr===Ct,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),mr===Ct&&le(Mt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):le(mr===Ge,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Ar=0,rr=0,vr=_t.framebufferWidth,tt=_t.framebufferHeight,xt=null;X(or)?xt=or:or&&(le.type(or,"object","invalid arguments to regl.read()"),Ar=or.x|0,rr=or.y|0,le(Ar>=0&&Ar<_t.framebufferWidth,"invalid x offset for regl.read"),le(rr>=0&&rr<_t.framebufferHeight,"invalid y offset for regl.read"),vr=(or.width||_t.framebufferWidth-Ar)|0,tt=(or.height||_t.framebufferHeight-rr)|0,xt=or.data||null),xt&&(mr===Ge?le(xt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):mr===Ct&&le(xt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),le(vr>0&&vr+Ar<=_t.framebufferWidth,"invalid width for read pixels"),le(tt>0&&tt+rr<=_t.framebufferHeight,"invalid height for read pixels"),ye();var ir=vr*tt*4;return xt||(mr===Ge?xt=new Uint8Array(ir):mr===Ct&&(xt=xt||new Float32Array(ir))),le.isTypedArray(xt,"data buffer for regl.read() must be a typedarray"),le(xt.byteLength>=ir,"data buffer for regl.read() too small"),k.pixelStorei(at,4),k.readPixels(Ar,rr,vr,tt,Fe,mr,xt),xt}function ar(or){var mr;return ie.setFBO({framebuffer:or.framebuffer},function(){mr=nr(or)}),mr}function fr(or){return!or||!("framebuffer"in or)?nr(or):ar(or)}return fr}function At(k){return Array.prototype.slice.call(k)}function Yt(k){return At(k).join("")}function br(){var k=0,ie=[],ye=[];function _t(mr){for(var Ar=0;Ar<ye.length;++Ar)if(ye[Ar]===mr)return ie[Ar];var rr="g"+k++;return ie.push(rr),ye.push(mr),rr}function Bt(){var mr=[];function Ar(){mr.push.apply(mr,At(arguments))}var rr=[];function vr(){var tt="v"+k++;return rr.push(tt),arguments.length>0&&(mr.push(tt,"="),mr.push.apply(mr,At(arguments)),mr.push(";")),tt}return G(Ar,{def:vr,toString:function(){return Yt([rr.length>0?"var "+rr.join(",")+";":"",Yt(mr)])}})}function ht(){var mr=Bt(),Ar=Bt(),rr=mr.toString,vr=Ar.toString;function tt(xt,ir){Ar(xt,ir,"=",mr.def(xt,ir),";")}return G(function(){mr.apply(mr,At(arguments))},{def:mr.def,entry:mr,exit:Ar,save:tt,set:function(xt,ir,kr){tt(xt,ir),mr(xt,ir,"=",kr,";")},toString:function(){return rr()+vr()}})}function Mt(){var mr=Yt(arguments),Ar=ht(),rr=ht(),vr=Ar.toString,tt=rr.toString;return G(Ar,{then:function(){return Ar.apply(Ar,At(arguments)),this},else:function(){return rr.apply(rr,At(arguments)),this},toString:function(){var xt=tt();return xt&&(xt="else{"+xt+"}"),Yt(["if(",mr,"){",vr(),"}",xt])}})}var nr=Bt(),ar={};function fr(mr,Ar){var rr=[];function vr(){var Ht="a"+rr.length;return rr.push(Ht),Ht}Ar=Ar||0;for(var tt=0;tt<Ar;++tt)vr();var xt=ht(),ir=xt.toString,kr=ar[mr]=G(xt,{arg:vr,toString:function(){return Yt(["function(",rr.join(),"){",ir(),"}"])}});return kr}function or(){var mr=['"use strict";',nr,"return {"];Object.keys(ar).forEach(function(vr){mr.push('"',vr,'":',ar[vr].toString(),",")}),mr.push("}");var Ar=Yt(mr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),rr=Function.apply(null,ie.concat(Ar));return rr.apply(null,ye)}return{global:nr,link:_t,block:Bt,proc:fr,scope:ht,cond:Mt,compile:or}}var pr="xyzw".split(""),Fr=5121,rn=1,fn=2,cn=0,hi=1,gr=2,Jr=3,kn=4,wn=5,vn=6,Zn="dither",Sn="blend.enable",_n="blend.color",Ba="blend.equation",Wi="blend.func",Gi="depth.enable",no="depth.func",ra="depth.range",_a="depth.mask",Na="colorMask",io="cull.enable",Cs="cull.face",fo="frontFace",Jo="lineWidth",Mo="polygonOffset.enable",ru="polygonOffset.offset",Gu="sample.alpha",nu="sample.enable",iu="sample.coverage",xl="stencil.enable",zs="stencil.mask",Hu="stencil.func",za="stencil.opFront",na="stencil.opBack",au="scissor.enable",Zs="scissor.box",Uo="viewport",vi="profile",ao="framebuffer",oo="vert",ds="frag",Wu="elements",ou="primitive",Hl="count",Xu="offset",gc="instances",Us="vao",bl="Width",$c="Height",js=ao+bl,qa=ao+$c,uh=Uo+bl,Ep=Uo+$c,Cp="drawingBuffer",Tp=Cp+bl,Ap=Cp+$c,lh=[Wi,Ba,Hu,za,na,iu,Uo,Zs,ru],wl=34962,ch=34963,kf=35632,Mp=35633,Yu=3553,Jc=34067,jo=2884,fh=3042,ph=3024,hh=2960,dh=2929,vh=3089,mh=32823,op=32926,yh=32928,Sl=5126,Lf=35664,ia=35665,Wl=35666,Rf=5124,Xl=35667,Yl=35668,ql=35669,sp=35670,Df=35671,Kl=35672,_c=35673,xc=35674,Ff=35675,qu=35676,Qc=35678,$l=35680,Pp=4,Tu=1028,Ku=1029,su=2304,Ip=2305,$h=32775,Jh=32776,Qh=519,El=7680,bc=0,gh=1,_h=32774,xh=513,Op=36160,ed=36064,$u={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},wc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ef={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ju={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},tf={frag:kf,vert:Mp},go={cw:su,ccw:Ip};function Au(k){return Array.isArray(k)||X(k)||va(k)}function kp(k){return k.sort(function(ie,ye){return ie===Uo?-1:ye===Uo?1:ie<ye?-1:1})}function Qo(k,ie,ye,_t){this.thisDep=k,this.contextDep=ie,this.propDep=ye,this.append=_t}function Vs(k){return k&&!(k.thisDep||k.contextDep||k.propDep)}function xa(k){return new Qo(!1,!1,!1,k)}function vs(k,ie){var ye=k.type;if(ye===cn){var _t=k.data.length;return new Qo(!0,_t>=1,_t>=2,ie)}else if(ye===kn){var Bt=k.data;return new Qo(Bt.thisDep,Bt.contextDep,Bt.propDep,ie)}else{if(ye===wn)return new Qo(!1,!1,!1,ie);if(ye===vn){for(var ht=!1,Mt=!1,nr=!1,ar=0;ar<k.data.length;++ar){var fr=k.data[ar];if(fr.type===hi)nr=!0;else if(fr.type===gr)Mt=!0;else if(fr.type===Jr)ht=!0;else if(fr.type===cn){ht=!0;var or=fr.data;or>=1&&(Mt=!0),or>=2&&(nr=!0)}else fr.type===kn&&(ht=ht||fr.data.thisDep,Mt=Mt||fr.data.contextDep,nr=nr||fr.data.propDep)}return new Qo(ht,Mt,nr,ie)}else return new Qo(ye===Jr,ye===gr,ye===hi,ie)}}var Bf=new Qo(!1,!1,!1,function(){});function bh(k,ie,ye,_t,Bt,ht,Mt,nr,ar,fr,or,mr,Ar,rr,vr){var tt=fr.Record,xt={add:32774,subtract:32778,"reverse subtract":32779};ye.ext_blend_minmax&&(xt.min=$h,xt.max=Jh);var ir=ye.angle_instanced_arrays,kr=ye.webgl_draw_buffers,Ht={dirty:!0,profile:vr.profile},Nr={},Qt=[],Er={},Wt={};function yr(pe){return pe.replace(".","_")}function ln(pe,$,Be){var Qe=yr(pe);Qt.push(pe),Nr[Qe]=Ht[Qe]=!!Be,Er[Qe]=$}function pn(pe,$,Be){var Qe=yr(pe);Qt.push(pe),Array.isArray(Be)?(Ht[Qe]=Be.slice(),Nr[Qe]=Be.slice()):Ht[Qe]=Nr[Qe]=Be,Wt[Qe]=$}ln(Zn,ph),ln(Sn,fh),pn(_n,"blendColor",[0,0,0,0]),pn(Ba,"blendEquationSeparate",[_h,_h]),pn(Wi,"blendFuncSeparate",[gh,bc,gh,bc]),ln(Gi,dh,!0),pn(no,"depthFunc",xh),pn(ra,"depthRange",[0,1]),pn(_a,"depthMask",!0),pn(Na,Na,[!0,!0,!0,!0]),ln(io,jo),pn(Cs,"cullFace",Ku),pn(fo,fo,Ip),pn(Jo,Jo,1),ln(Mo,mh),pn(ru,"polygonOffset",[0,0]),ln(Gu,op),ln(nu,yh),pn(iu,"sampleCoverage",[1,!1]),ln(xl,hh),pn(zs,"stencilMask",-1),pn(Hu,"stencilFunc",[Qh,0,-1]),pn(za,"stencilOpSeparate",[Tu,El,El,El]),pn(na,"stencilOpSeparate",[Ku,El,El,El]),ln(au,vh),pn(Zs,"scissor",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]),pn(Uo,Uo,[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var wr={gl:k,context:Ar,strings:ie,next:Nr,current:Ht,draw:mr,elements:ht,buffer:Bt,shader:or,attributes:fr.state,vao:fr,uniforms:ar,framebuffer:nr,extensions:ye,timer:rr,isBufferArgs:Au},qt={primTypes:Yi,compareFuncs:ef,blendFuncs:$u,blendEquations:xt,stencilOps:Ju,glTypes:ss,orientationType:go};le.optional(function(){wr.isArrayLike=ca}),kr&&(qt.backBuffer=[Ku],qt.drawBuffer=U(_t.maxDrawbuffers,function(pe){return pe===0?[0]:U(pe,function($){return ed+$})}));var jt=0;function xn(){var pe=br(),$=pe.link,Be=pe.global;pe.id=jt++,pe.batchId="0";var Qe=$(wr),et=pe.shared={props:"a0"};Object.keys(wr).forEach(function(Re){et[Re]=Be.def(Qe,".",Re)}),le.optional(function(){pe.CHECK=$(le),pe.commandStr=le.guessCommand(),pe.command=$(pe.commandStr),pe.assert=function(Re,ce,Ke){Re("if(!(",ce,"))",this.CHECK,".commandRaise(",$(Ke),",",this.command,");")},qt.invalidBlendCombinations=wc});var Ue=pe.next={},Ne=pe.current={};Object.keys(Wt).forEach(function(Re){Array.isArray(Ht[Re])&&(Ue[Re]=Be.def(et.next,".",Re),Ne[Re]=Be.def(et.current,".",Re))});var Xe=pe.constants={};Object.keys(qt).forEach(function(Re){Xe[Re]=Be.def(JSON.stringify(qt[Re]))}),pe.invoke=function(Re,ce){switch(ce.type){case cn:var Ke=["this",et.context,et.props,pe.batchId];return Re.def($(ce.data),".call(",Ke.slice(0,Math.max(ce.data.length+1,4)),")");case hi:return Re.def(et.props,ce.data);case gr:return Re.def(et.context,ce.data);case Jr:return Re.def("this",ce.data);case kn:return ce.data.append(pe,Re),ce.data.ref;case wn:return ce.data.toString();case vn:return ce.data.map(function(it){return pe.invoke(Re,it)})}},pe.attribCache={};var de={};return pe.scopeAttrib=function(Re){var ce=ie.id(Re);if(ce in de)return de[ce];var Ke=fr.scope[ce];Ke||(Ke=fr.scope[ce]=new tt);var it=de[ce]=$(Ke);return it},pe}function yn(pe){var $=pe.static,Be=pe.dynamic,Qe;if(vi in $){var et=!!$[vi];Qe=xa(function(Ne,Xe){return et}),Qe.enable=et}else if(vi in Be){var Ue=Be[vi];Qe=vs(Ue,function(Ne,Xe){return Ne.invoke(Xe,Ue)})}return Qe}function Kr(pe,$){var Be=pe.static,Qe=pe.dynamic;if(ao in Be){var et=Be[ao];return et?(et=nr.getFramebuffer(et),le.command(et,"invalid framebuffer object"),xa(function(Ne,Xe){var de=Ne.link(et),Re=Ne.shared;Xe.set(Re.framebuffer,".next",de);var ce=Re.context;return Xe.set(ce,"."+js,de+".width"),Xe.set(ce,"."+qa,de+".height"),de})):xa(function(Ne,Xe){var de=Ne.shared;Xe.set(de.framebuffer,".next","null");var Re=de.context;return Xe.set(Re,"."+js,Re+"."+Tp),Xe.set(Re,"."+qa,Re+"."+Ap),"null"})}else if(ao in Qe){var Ue=Qe[ao];return vs(Ue,function(Ne,Xe){var de=Ne.invoke(Xe,Ue),Re=Ne.shared,ce=Re.framebuffer,Ke=Xe.def(ce,".getFramebuffer(",de,")");le.optional(function(){Ne.assert(Xe,"!"+de+"||"+Ke,"invalid framebuffer object")}),Xe.set(ce,".next",Ke);var it=Re.context;return Xe.set(it,"."+js,Ke+"?"+Ke+".width:"+it+"."+Tp),Xe.set(it,"."+qa,Ke+"?"+Ke+".height:"+it+"."+Ap),Ke})}else return null}function Qn(pe,$,Be){var Qe=pe.static,et=pe.dynamic;function Ue(de){if(de in Qe){var Re=Qe[de];le.commandType(Re,"object","invalid "+de,Be.commandStr);var ce=!0,Ke=Re.x|0,it=Re.y|0,Nt,mt;return"width"in Re?(Nt=Re.width|0,le.command(Nt>=0,"invalid "+de,Be.commandStr)):ce=!1,"height"in Re?(mt=Re.height|0,le.command(mt>=0,"invalid "+de,Be.commandStr)):ce=!1,new Qo(!ce&&$&&$.thisDep,!ce&&$&&$.contextDep,!ce&&$&&$.propDep,function(tn,qn){var Qr=tn.shared.context,bn=Nt;"width"in Re||(bn=qn.def(Qr,".",js,"-",Ke));var Fn=mt;return"height"in Re||(Fn=qn.def(Qr,".",qa,"-",it)),[Ke,it,bn,Fn]})}else if(de in et){var Lt=et[de],sr=vs(Lt,function(tn,qn){var Qr=tn.invoke(qn,Lt);le.optional(function(){tn.assert(qn,Qr+"&&typeof "+Qr+'==="object"',"invalid "+de)});var bn=tn.shared.context,Fn=qn.def(Qr,".x|0"),xi=qn.def(Qr,".y|0"),Sa=qn.def('"width" in ',Qr,"?",Qr,".width|0:","(",bn,".",js,"-",Fn,")"),es=qn.def('"height" in ',Qr,"?",Qr,".height|0:","(",bn,".",qa,"-",xi,")");return le.optional(function(){tn.assert(qn,Sa+">=0&&"+es+">=0","invalid "+de)}),[Fn,xi,Sa,es]});return $&&(sr.thisDep=sr.thisDep||$.thisDep,sr.contextDep=sr.contextDep||$.contextDep,sr.propDep=sr.propDep||$.propDep),sr}else return $?new Qo($.thisDep,$.contextDep,$.propDep,function(tn,qn){var Qr=tn.shared.context;return[0,0,qn.def(Qr,".",js),qn.def(Qr,".",qa)]}):null}var Ne=Ue(Uo);if(Ne){var Xe=Ne;Ne=new Qo(Ne.thisDep,Ne.contextDep,Ne.propDep,function(de,Re){var ce=Xe.append(de,Re),Ke=de.shared.context;return Re.set(Ke,"."+uh,ce[2]),Re.set(Ke,"."+Ep,ce[3]),ce})}return{viewport:Ne,scissor_box:Ue(Zs)}}function Dn(pe,$){var Be=pe.static,Qe=typeof Be[ds]=="string"&&typeof Be[oo]=="string";if(Qe){if(Object.keys($.dynamic).length>0)return null;var et=$.static,Ue=Object.keys(et);if(Ue.length>0&&typeof et[Ue[0]]=="number"){for(var Ne=[],Xe=0;Xe<Ue.length;++Xe)le(typeof et[Ue[Xe]]=="number","must specify all vertex attribute locations when using vaos"),Ne.push([et[Ue[Xe]]|0,Ue[Xe]]);return Ne}}return null}function Yn(pe,$,Be){var Qe=pe.static,et=pe.dynamic;function Ue(ce){if(ce in Qe){var Ke=ie.id(Qe[ce]);le.optional(function(){or.shader(tf[ce],Ke,le.guessCommand())});var it=xa(function(){return Ke});return it.id=Ke,it}else if(ce in et){var Nt=et[ce];return vs(Nt,function(mt,Lt){var sr=mt.invoke(Lt,Nt),tn=Lt.def(mt.shared.strings,".id(",sr,")");return le.optional(function(){Lt(mt.shared.shader,".shader(",tf[ce],",",tn,",",mt.command,");")}),tn})}return null}var Ne=Ue(ds),Xe=Ue(oo),de=null,Re;return Vs(Ne)&&Vs(Xe)?(de=or.program(Xe.id,Ne.id,null,Be),Re=xa(function(ce,Ke){return ce.link(de)})):Re=new Qo(Ne&&Ne.thisDep||Xe&&Xe.thisDep,Ne&&Ne.contextDep||Xe&&Xe.contextDep,Ne&&Ne.propDep||Xe&&Xe.propDep,function(ce,Ke){var it=ce.shared.shader,Nt;Ne?Nt=Ne.append(ce,Ke):Nt=Ke.def(it,".",ds);var mt;Xe?mt=Xe.append(ce,Ke):mt=Ke.def(it,".",oo);var Lt=it+".program("+mt+","+Nt;return le.optional(function(){Lt+=","+ce.command}),Ke.def(Lt+")")}),{frag:Ne,vert:Xe,progVar:Re,program:de}}function gi(pe,$){var Be=pe.static,Qe=pe.dynamic;function et(){if(Wu in Be){var ce=Be[Wu];Au(ce)?ce=ht.getElements(ht.create(ce,!0)):ce&&(ce=ht.getElements(ce),le.command(ce,"invalid elements",$.commandStr));var Ke=xa(function(Nt,mt){if(ce){var Lt=Nt.link(ce);return Nt.ELEMENTS=Lt,Lt}return Nt.ELEMENTS=null,null});return Ke.value=ce,Ke}else if(Wu in Qe){var it=Qe[Wu];return vs(it,function(Nt,mt){var Lt=Nt.shared,sr=Lt.isBufferArgs,tn=Lt.elements,qn=Nt.invoke(mt,it),Qr=mt.def("null"),bn=mt.def(sr,"(",qn,")"),Fn=Nt.cond(bn).then(Qr,"=",tn,".createStream(",qn,");").else(Qr,"=",tn,".getElements(",qn,");");return le.optional(function(){Nt.assert(Fn.else,"!"+qn+"||"+Qr,"invalid elements")}),mt.entry(Fn),mt.exit(Nt.cond(bn).then(tn,".destroyStream(",Qr,");")),Nt.ELEMENTS=Qr,Qr})}return null}var Ue=et();function Ne(){if(ou in Be){var ce=Be[ou];return le.commandParameter(ce,Yi,"invalid primitve",$.commandStr),xa(function(it,Nt){return Yi[ce]})}else if(ou in Qe){var Ke=Qe[ou];return vs(Ke,function(it,Nt){var mt=it.constants.primTypes,Lt=it.invoke(Nt,Ke);return le.optional(function(){it.assert(Nt,Lt+" in "+mt,"invalid primitive, must be one of "+Object.keys(Yi))}),Nt.def(mt,"[",Lt,"]")})}else if(Ue)return Vs(Ue)?Ue.value?xa(function(it,Nt){return Nt.def(it.ELEMENTS,".primType")}):xa(function(){return Pp}):new Qo(Ue.thisDep,Ue.contextDep,Ue.propDep,function(it,Nt){var mt=it.ELEMENTS;return Nt.def(mt,"?",mt,".primType:",Pp)});return null}function Xe(ce,Ke){if(ce in Be){var it=Be[ce]|0;return le.command(!Ke||it>=0,"invalid "+ce,$.commandStr),xa(function(mt,Lt){return Ke&&(mt.OFFSET=it),it})}else if(ce in Qe){var Nt=Qe[ce];return vs(Nt,function(mt,Lt){var sr=mt.invoke(Lt,Nt);return Ke&&(mt.OFFSET=sr,le.optional(function(){mt.assert(Lt,sr+">=0","invalid "+ce)})),sr})}else if(Ke&&Ue)return xa(function(mt,Lt){return mt.OFFSET="0",0});return null}var de=Xe(Xu,!0);function Re(){if(Hl in Be){var ce=Be[Hl]|0;return le.command(typeof ce=="number"&&ce>=0,"invalid vertex count",$.commandStr),xa(function(){return ce})}else if(Hl in Qe){var Ke=Qe[Hl];return vs(Ke,function(mt,Lt){var sr=mt.invoke(Lt,Ke);return le.optional(function(){mt.assert(Lt,"typeof "+sr+'==="number"&&'+sr+">=0&&"+sr+"===("+sr+"|0)","invalid vertex count")}),sr})}else if(Ue)if(Vs(Ue)){if(Ue)return de?new Qo(de.thisDep,de.contextDep,de.propDep,function(mt,Lt){var sr=Lt.def(mt.ELEMENTS,".vertCount-",mt.OFFSET);return le.optional(function(){mt.assert(Lt,sr+">=0","invalid vertex offset/element buffer too small")}),sr}):xa(function(mt,Lt){return Lt.def(mt.ELEMENTS,".vertCount")});var it=xa(function(){return-1});return le.optional(function(){it.MISSING=!0}),it}else{var Nt=new Qo(Ue.thisDep||de.thisDep,Ue.contextDep||de.contextDep,Ue.propDep||de.propDep,function(mt,Lt){var sr=mt.ELEMENTS;return mt.OFFSET?Lt.def(sr,"?",sr,".vertCount-",mt.OFFSET,":-1"):Lt.def(sr,"?",sr,".vertCount:-1")});return le.optional(function(){Nt.DYNAMIC=!0}),Nt}return null}return{elements:Ue,primitive:Ne(),count:Re(),instances:Xe(gc,!1),offset:de}}function ba(pe,$){var Be=pe.static,Qe=pe.dynamic,et={};return Qt.forEach(function(Ue){var Ne=yr(Ue);function Xe(de,Re){if(Ue in Be){var ce=de(Be[Ue]);et[Ne]=xa(function(){return ce})}else if(Ue in Qe){var Ke=Qe[Ue];et[Ne]=vs(Ke,function(it,Nt){return Re(it,Nt,it.invoke(Nt,Ke))})}}switch(Ue){case io:case Sn:case Zn:case xl:case Gi:case au:case Mo:case Gu:case nu:case _a:return Xe(function(de){return le.commandType(de,"boolean",Ue,$.commandStr),de},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="boolean"',"invalid flag "+Ue,de.commandStr)}),ce});case no:return Xe(function(de){return le.commandParameter(de,ef,"invalid "+Ue,$.commandStr),ef[de]},function(de,Re,ce){var Ke=de.constants.compareFuncs;return le.optional(function(){de.assert(Re,ce+" in "+Ke,"invalid "+Ue+", must be one of "+Object.keys(ef))}),Re.def(Ke,"[",ce,"]")});case ra:return Xe(function(de){return le.command(ca(de)&&de.length===2&&typeof de[0]=="number"&&typeof de[1]=="number"&&de[0]<=de[1],"depth range is 2d array",$.commandStr),de},function(de,Re,ce){le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===2&&typeof "+ce+'[0]==="number"&&typeof '+ce+'[1]==="number"&&'+ce+"[0]<="+ce+"[1]","depth range must be a 2d array")});var Ke=Re.def("+",ce,"[0]"),it=Re.def("+",ce,"[1]");return[Ke,it]});case Wi:return Xe(function(de){le.commandType(de,"object","blend.func",$.commandStr);var Re="srcRGB"in de?de.srcRGB:de.src,ce="srcAlpha"in de?de.srcAlpha:de.src,Ke="dstRGB"in de?de.dstRGB:de.dst,it="dstAlpha"in de?de.dstAlpha:de.dst;return le.commandParameter(Re,$u,Ne+".srcRGB",$.commandStr),le.commandParameter(ce,$u,Ne+".srcAlpha",$.commandStr),le.commandParameter(Ke,$u,Ne+".dstRGB",$.commandStr),le.commandParameter(it,$u,Ne+".dstAlpha",$.commandStr),le.command(wc.indexOf(Re+", "+Ke)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Re+", "+Ke+")",$.commandStr),[$u[Re],$u[Ke],$u[ce],$u[it]]},function(de,Re,ce){var Ke=de.constants.blendFuncs;le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid blend func, must be an object")});function it(Qr,bn){var Fn=Re.def('"',Qr,bn,'" in ',ce,"?",ce,".",Qr,bn,":",ce,".",Qr);return le.optional(function(){de.assert(Re,Fn+" in "+Ke,"invalid "+Ue+"."+Qr+bn+", must be one of "+Object.keys($u))}),Fn}var Nt=it("src","RGB"),mt=it("dst","RGB");le.optional(function(){var Qr=de.constants.invalidBlendCombinations;de.assert(Re,Qr+".indexOf("+Nt+'+", "+'+mt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Lt=Re.def(Ke,"[",Nt,"]"),sr=Re.def(Ke,"[",it("src","Alpha"),"]"),tn=Re.def(Ke,"[",mt,"]"),qn=Re.def(Ke,"[",it("dst","Alpha"),"]");return[Lt,tn,sr,qn]});case Ba:return Xe(function(de){if(typeof de=="string")return le.commandParameter(de,xt,"invalid "+Ue,$.commandStr),[xt[de],xt[de]];if(typeof de=="object")return le.commandParameter(de.rgb,xt,Ue+".rgb",$.commandStr),le.commandParameter(de.alpha,xt,Ue+".alpha",$.commandStr),[xt[de.rgb],xt[de.alpha]];le.commandRaise("invalid blend.equation",$.commandStr)},function(de,Re,ce){var Ke=de.constants.blendEquations,it=Re.def(),Nt=Re.def(),mt=de.cond("typeof ",ce,'==="string"');return le.optional(function(){function Lt(sr,tn,qn){de.assert(sr,qn+" in "+Ke,"invalid "+tn+", must be one of "+Object.keys(xt))}Lt(mt.then,Ue,ce),de.assert(mt.else,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue),Lt(mt.else,Ue+".rgb",ce+".rgb"),Lt(mt.else,Ue+".alpha",ce+".alpha")}),mt.then(it,"=",Nt,"=",Ke,"[",ce,"];"),mt.else(it,"=",Ke,"[",ce,".rgb];",Nt,"=",Ke,"[",ce,".alpha];"),Re(mt),[it,Nt]});case _n:return Xe(function(de){return le.command(ca(de)&&de.length===4,"blend.color must be a 4d array",$.commandStr),U(4,function(Re){return+de[Re]})},function(de,Re,ce){return le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===4","blend.color must be a 4d array")}),U(4,function(Ke){return Re.def("+",ce,"[",Ke,"]")})});case zs:return Xe(function(de){return le.commandType(de,"number",Ne,$.commandStr),de|0},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="number"',"invalid stencil.mask")}),Re.def(ce,"|0")});case Hu:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.cmp||"keep",ce=de.ref||0,Ke="mask"in de?de.mask:-1;return le.commandParameter(Re,ef,Ue+".cmp",$.commandStr),le.commandType(ce,"number",Ue+".ref",$.commandStr),le.commandType(Ke,"number",Ue+".mask",$.commandStr),[ef[Re],ce,Ke]},function(de,Re,ce){var Ke=de.constants.compareFuncs;le.optional(function(){function Lt(){de.assert(Re,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Lt(ce+"&&typeof ",ce,'==="object"'),Lt('!("cmp" in ',ce,")||(",ce,".cmp in ",Ke,")")});var it=Re.def('"cmp" in ',ce,"?",Ke,"[",ce,".cmp]",":",El),Nt=Re.def(ce,".ref|0"),mt=Re.def('"mask" in ',ce,"?",ce,".mask|0:-1");return[it,Nt,mt]});case za:case na:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.fail||"keep",ce=de.zfail||"keep",Ke=de.zpass||"keep";return le.commandParameter(Re,Ju,Ue+".fail",$.commandStr),le.commandParameter(ce,Ju,Ue+".zfail",$.commandStr),le.commandParameter(Ke,Ju,Ue+".zpass",$.commandStr),[Ue===na?Ku:Tu,Ju[Re],Ju[ce],Ju[Ke]]},function(de,Re,ce){var Ke=de.constants.stencilOps;le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue)});function it(Nt){return le.optional(function(){de.assert(Re,'!("'+Nt+'" in '+ce+")||("+ce+"."+Nt+" in "+Ke+")","invalid "+Ue+"."+Nt+", must be one of "+Object.keys(Ju))}),Re.def('"',Nt,'" in ',ce,"?",Ke,"[",ce,".",Nt,"]:",El)}return[Ue===na?Ku:Tu,it("fail"),it("zfail"),it("zpass")]});case ru:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.factor|0,ce=de.units|0;return le.commandType(Re,"number",Ne+".factor",$.commandStr),le.commandType(ce,"number",Ne+".units",$.commandStr),[Re,ce]},function(de,Re,ce){le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue)});var Ke=Re.def(ce,".factor|0"),it=Re.def(ce,".units|0");return[Ke,it]});case Cs:return Xe(function(de){var Re=0;return de==="front"?Re=Tu:de==="back"&&(Re=Ku),le.command(!!Re,Ne,$.commandStr),Re},function(de,Re,ce){return le.optional(function(){de.assert(Re,ce+'==="front"||'+ce+'==="back"',"invalid cull.face")}),Re.def(ce,'==="front"?',Tu,":",Ku)});case Jo:return Xe(function(de){return le.command(typeof de=="number"&&de>=_t.lineWidthDims[0]&&de<=_t.lineWidthDims[1],"invalid line width, must be a positive number between "+_t.lineWidthDims[0]+" and "+_t.lineWidthDims[1],$.commandStr),de},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="number"&&'+ce+">="+_t.lineWidthDims[0]+"&&"+ce+"<="+_t.lineWidthDims[1],"invalid line width")}),ce});case fo:return Xe(function(de){return le.commandParameter(de,go,Ne,$.commandStr),go[de]},function(de,Re,ce){return le.optional(function(){de.assert(Re,ce+'==="cw"||'+ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Re.def(ce+'==="cw"?'+su+":"+Ip)});case Na:return Xe(function(de){return le.command(ca(de)&&de.length===4,"color.mask must be length 4 array",$.commandStr),de.map(function(Re){return!!Re})},function(de,Re,ce){return le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===4","invalid color.mask")}),U(4,function(Ke){return"!!"+ce+"["+Ke+"]"})});case iu:return Xe(function(de){le.command(typeof de=="object"&&de,Ne,$.commandStr);var Re="value"in de?de.value:1,ce=!!de.invert;return le.command(typeof Re=="number"&&Re>=0&&Re<=1,"sample.coverage.value must be a number between 0 and 1",$.commandStr),[Re,ce]},function(de,Re,ce){le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid sample.coverage")});var Ke=Re.def('"value" in ',ce,"?+",ce,".value:1"),it=Re.def("!!",ce,".invert");return[Ke,it]})}}),et}function so(pe,$){var Be=pe.static,Qe=pe.dynamic,et={};return Object.keys(Be).forEach(function(Ue){var Ne=Be[Ue],Xe;if(typeof Ne=="number"||typeof Ne=="boolean")Xe=xa(function(){return Ne});else if(typeof Ne=="function"){var de=Ne._reglType;de==="texture2d"||de==="textureCube"?Xe=xa(function(Re){return Re.link(Ne)}):de==="framebuffer"||de==="framebufferCube"?(le.command(Ne.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ue+'"',$.commandStr),Xe=xa(function(Re){return Re.link(Ne.color[0])})):le.commandRaise('invalid data for uniform "'+Ue+'"',$.commandStr)}else ca(Ne)?Xe=xa(function(Re){var ce=Re.global.def("[",U(Ne.length,function(Ke){return le.command(typeof Ne[Ke]=="number"||typeof Ne[Ke]=="boolean","invalid uniform "+Ue,Re.commandStr),Ne[Ke]}),"]");return ce}):le.commandRaise('invalid or missing data for uniform "'+Ue+'"',$.commandStr);Xe.value=Ne,et[Ue]=Xe}),Object.keys(Qe).forEach(function(Ue){var Ne=Qe[Ue];et[Ue]=vs(Ne,function(Xe,de){return Xe.invoke(de,Ne)})}),et}function ai(pe,$){var Be=pe.static,Qe=pe.dynamic,et={};return Object.keys(Be).forEach(function(Ue){var Ne=Be[Ue],Xe=ie.id(Ue),de=new tt;if(Au(Ne))de.state=rn,de.buffer=Bt.getBuffer(Bt.create(Ne,wl,!1,!0)),de.type=0;else{var Re=Bt.getBuffer(Ne);if(Re)de.state=rn,de.buffer=Re,de.type=0;else if(le.command(typeof Ne=="object"&&Ne,"invalid data for attribute "+Ue,$.commandStr),"constant"in Ne){var ce=Ne.constant;de.buffer="null",de.state=fn,typeof ce=="number"?de.x=ce:(le.command(ca(ce)&&ce.length>0&&ce.length<=4,"invalid constant for attribute "+Ue,$.commandStr),pr.forEach(function(tn,qn){qn<ce.length&&(de[tn]=ce[qn])}))}else{Au(Ne.buffer)?Re=Bt.getBuffer(Bt.create(Ne.buffer,wl,!1,!0)):Re=Bt.getBuffer(Ne.buffer),le.command(!!Re,'missing buffer for attribute "'+Ue+'"',$.commandStr);var Ke=Ne.offset|0;le.command(Ke>=0,'invalid offset for attribute "'+Ue+'"',$.commandStr);var it=Ne.stride|0;le.command(it>=0&&it<256,'invalid stride for attribute "'+Ue+'", must be integer betweeen [0, 255]',$.commandStr);var Nt=Ne.size|0;le.command(!("size"in Ne)||Nt>0&&Nt<=4,'invalid size for attribute "'+Ue+'", must be 1,2,3,4',$.commandStr);var mt=!!Ne.normalized,Lt=0;"type"in Ne&&(le.commandParameter(Ne.type,ss,"invalid type for attribute "+Ue,$.commandStr),Lt=ss[Ne.type]);var sr=Ne.divisor|0;"divisor"in Ne&&(le.command(sr===0||ir,'cannot specify divisor for attribute "'+Ue+'", instancing not supported',$.commandStr),le.command(sr>=0,'invalid divisor for attribute "'+Ue+'"',$.commandStr)),le.optional(function(){var tn=$.commandStr,qn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ne).forEach(function(Qr){le.command(qn.indexOf(Qr)>=0,'unknown parameter "'+Qr+'" for attribute pointer "'+Ue+'" (valid parameters are '+qn+")",tn)})}),de.buffer=Re,de.state=rn,de.size=Nt,de.normalized=mt,de.type=Lt||Re.dtype,de.offset=Ke,de.stride=it,de.divisor=sr}}et[Ue]=xa(function(tn,qn){var Qr=tn.attribCache;if(Xe in Qr)return Qr[Xe];var bn={isStream:!1};return Object.keys(de).forEach(function(Fn){bn[Fn]=de[Fn]}),de.buffer&&(bn.buffer=tn.link(de.buffer),bn.type=bn.type||bn.buffer+".dtype"),Qr[Xe]=bn,bn})}),Object.keys(Qe).forEach(function(Ue){var Ne=Qe[Ue];function Xe(de,Re){var ce=de.invoke(Re,Ne),Ke=de.shared,it=de.constants,Nt=Ke.isBufferArgs,mt=Ke.buffer;le.optional(function(){de.assert(Re,ce+"&&(typeof "+ce+'==="object"||typeof '+ce+'==="function")&&('+Nt+"("+ce+")||"+mt+".getBuffer("+ce+")||"+mt+".getBuffer("+ce+".buffer)||"+Nt+"("+ce+'.buffer)||("constant" in '+ce+"&&(typeof "+ce+'.constant==="number"||'+Ke.isArrayLike+"("+ce+".constant))))",'invalid dynamic attribute "'+Ue+'"')});var Lt={isStream:Re.def(!1)},sr=new tt;sr.state=rn,Object.keys(sr).forEach(function(bn){Lt[bn]=Re.def(""+sr[bn])});var tn=Lt.buffer,qn=Lt.type;Re("if(",Nt,"(",ce,")){",Lt.isStream,"=true;",tn,"=",mt,".createStream(",wl,",",ce,");",qn,"=",tn,".dtype;","}else{",tn,"=",mt,".getBuffer(",ce,");","if(",tn,"){",qn,"=",tn,".dtype;",'}else if("constant" in ',ce,"){",Lt.state,"=",fn,";","if(typeof "+ce+'.constant === "number"){',Lt[pr[0]],"=",ce,".constant;",pr.slice(1).map(function(bn){return Lt[bn]}).join("="),"=0;","}else{",pr.map(function(bn,Fn){return Lt[bn]+"="+ce+".constant.length>"+Fn+"?"+ce+".constant["+Fn+"]:0;"}).join(""),"}}else{","if(",Nt,"(",ce,".buffer)){",tn,"=",mt,".createStream(",wl,",",ce,".buffer);","}else{",tn,"=",mt,".getBuffer(",ce,".buffer);","}",qn,'="type" in ',ce,"?",it.glTypes,"[",ce,".type]:",tn,".dtype;",Lt.normalized,"=!!",ce,".normalized;");function Qr(bn){Re(Lt[bn],"=",ce,".",bn,"|0;")}return Qr("size"),Qr("offset"),Qr("stride"),Qr("divisor"),Re("}}"),Re.exit("if(",Lt.isStream,"){",mt,".destroyStream(",tn,");","}"),Lt}et[Ue]=vs(Ne,Xe)}),et}function ha(pe,$){var Be=pe.static,Qe=pe.dynamic;if(Us in Be){var et=Be[Us];return et!==null&&fr.getVAO(et)===null&&(et=fr.createVAO(et)),xa(function(Ne){return Ne.link(fr.getVAO(et))})}else if(Us in Qe){var Ue=Qe[Us];return vs(Ue,function(Ne,Xe){var de=Ne.invoke(Xe,Ue);return Xe.def(Ne.shared.vao+".getVAO("+de+")")})}return null}function Hi(pe){var $=pe.static,Be=pe.dynamic,Qe={};return Object.keys($).forEach(function(et){var Ue=$[et];Qe[et]=xa(function(Ne,Xe){return typeof Ue=="number"||typeof Ue=="boolean"?""+Ue:Ne.link(Ue)})}),Object.keys(Be).forEach(function(et){var Ue=Be[et];Qe[et]=vs(Ue,function(Ne,Xe){return Ne.invoke(Xe,Ue)})}),Qe}function Za(pe,$,Be,Qe,et){var Ue=pe.static,Ne=pe.dynamic;le.optional(function(){var Qr=[ao,oo,ds,Wu,ou,Xu,Hl,gc,vi,Us].concat(Qt);function bn(Fn){Object.keys(Fn).forEach(function(xi){le.command(Qr.indexOf(xi)>=0,'unknown parameter "'+xi+'"',et.commandStr)})}bn(Ue),bn(Ne)});var Xe=Dn(pe,$),de=Kr(pe,et),Re=Qn(pe,de,et),ce=gi(pe,et),Ke=ba(pe,et),it=Yn(pe,et,Xe);function Nt(Qr){var bn=Re[Qr];bn&&(Ke[Qr]=bn)}Nt(Uo),Nt(yr(Zs));var mt=Object.keys(Ke).length>0,Lt={framebuffer:de,draw:ce,shader:it,state:Ke,dirty:mt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Lt.profile=yn(pe,et),Lt.uniforms=so(Be,et),Lt.drawVAO=Lt.scopeVAO=ha(pe,et),!Lt.drawVAO&&it.program&&!Xe&&ye.angle_instanced_arrays){var sr=!0,tn=it.program.attributes.map(function(Qr){var bn=$.static[Qr];return sr=sr&&!!bn,bn});if(sr&&tn.length>0){var qn=fr.getVAO(fr.createVAO(tn));Lt.drawVAO=new Qo(null,null,null,function(Qr,bn){return Qr.link(qn)}),Lt.useVAO=!0}}return Xe?Lt.useVAO=!0:Lt.attributes=ai($,et),Lt.context=Hi(Qe,et),Lt}function Ka(pe,$,Be){var Qe=pe.shared,et=Qe.context,Ue=pe.scope();Object.keys(Be).forEach(function(Ne){$.save(et,"."+Ne);var Xe=Be[Ne],de=Xe.append(pe,$);Array.isArray(de)?Ue(et,".",Ne,"=[",de.join(),"];"):Ue(et,".",Ne,"=",de,";")}),$(Ue)}function $a(pe,$,Be,Qe){var et=pe.shared,Ue=et.gl,Ne=et.framebuffer,Xe;kr&&(Xe=$.def(et.extensions,".webgl_draw_buffers"));var de=pe.constants,Re=de.drawBuffer,ce=de.backBuffer,Ke;Be?Ke=Be.append(pe,$):Ke=$.def(Ne,".next"),Qe||$("if(",Ke,"!==",Ne,".cur){"),$("if(",Ke,"){",Ue,".bindFramebuffer(",Op,",",Ke,".framebuffer);"),kr&&$(Xe,".drawBuffersWEBGL(",Re,"[",Ke,".colorAttachments.length]);"),$("}else{",Ue,".bindFramebuffer(",Op,",null);"),kr&&$(Xe,".drawBuffersWEBGL(",ce,");"),$("}",Ne,".cur=",Ke,";"),Qe||$("}")}function uo(pe,$,Be){var Qe=pe.shared,et=Qe.gl,Ue=pe.current,Ne=pe.next,Xe=Qe.current,de=Qe.next,Re=pe.cond(Xe,".dirty");Qt.forEach(function(ce){var Ke=yr(ce);if(!(Ke in Be.state)){var it,Nt;if(Ke in Ne){it=Ne[Ke],Nt=Ue[Ke];var mt=U(Ht[Ke].length,function(sr){return Re.def(it,"[",sr,"]")});Re(pe.cond(mt.map(function(sr,tn){return sr+"!=="+Nt+"["+tn+"]"}).join("||")).then(et,".",Wt[Ke],"(",mt,");",mt.map(function(sr,tn){return Nt+"["+tn+"]="+sr}).join(";"),";"))}else{it=Re.def(de,".",Ke);var Lt=pe.cond(it,"!==",Xe,".",Ke);Re(Lt),Ke in Er?Lt(pe.cond(it).then(et,".enable(",Er[Ke],");").else(et,".disable(",Er[Ke],");"),Xe,".",Ke,"=",it,";"):Lt(et,".",Wt[Ke],"(",it,");",Xe,".",Ke,"=",it,";")}}}),Object.keys(Be.state).length===0&&Re(Xe,".dirty=false;"),$(Re)}function _o(pe,$,Be,Qe){var et=pe.shared,Ue=pe.current,Ne=et.current,Xe=et.gl;kp(Object.keys(Be)).forEach(function(de){var Re=Be[de];if(!(Qe&&!Qe(Re))){var ce=Re.append(pe,$);if(Er[de]){var Ke=Er[de];Vs(Re)?ce?$(Xe,".enable(",Ke,");"):$(Xe,".disable(",Ke,");"):$(pe.cond(ce).then(Xe,".enable(",Ke,");").else(Xe,".disable(",Ke,");")),$(Ne,".",de,"=",ce,";")}else if(ca(ce)){var it=Ue[de];$(Xe,".",Wt[de],"(",ce,");",ce.map(function(Nt,mt){return it+"["+mt+"]="+Nt}).join(";"),";")}else $(Xe,".",Wt[de],"(",ce,");",Ne,".",de,"=",ce,";")}})}function Ia(pe,$){ir&&(pe.instancing=$.def(pe.shared.extensions,".angle_instanced_arrays"))}function Vn(pe,$,Be,Qe,et){var Ue=pe.shared,Ne=pe.stats,Xe=Ue.current,de=Ue.timer,Re=Be.profile;function ce(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Ke,it;function Nt(Qr){Ke=$.def(),Qr(Ke,"=",ce(),";"),typeof et=="string"?Qr(Ne,".count+=",et,";"):Qr(Ne,".count++;"),rr&&(Qe?(it=$.def(),Qr(it,"=",de,".getNumPendingQueries();")):Qr(de,".beginQuery(",Ne,");"))}function mt(Qr){Qr(Ne,".cpuTime+=",ce(),"-",Ke,";"),rr&&(Qe?Qr(de,".pushScopeStats(",it,",",de,".getNumPendingQueries(),",Ne,");"):Qr(de,".endQuery();"))}function Lt(Qr){var bn=$.def(Xe,".profile");$(Xe,".profile=",Qr,";"),$.exit(Xe,".profile=",bn,";")}var sr;if(Re){if(Vs(Re)){Re.enable?(Nt($),mt($.exit),Lt("true")):Lt("false");return}sr=Re.append(pe,$),Lt(sr)}else sr=$.def(Xe,".profile");var tn=pe.block();Nt(tn),$("if(",sr,"){",tn,"}");var qn=pe.block();mt(qn),$.exit("if(",sr,"){",qn,"}")}function Po(pe,$,Be,Qe,et){var Ue=pe.shared;function Ne(de){switch(de){case Lf:case Xl:case Df:return 2;case ia:case Yl:case Kl:return 3;case Wl:case ql:case _c:return 4;default:return 1}}function Xe(de,Re,ce){var Ke=Ue.gl,it=$.def(de,".location"),Nt=$.def(Ue.attributes,"[",it,"]"),mt=ce.state,Lt=ce.buffer,sr=[ce.x,ce.y,ce.z,ce.w],tn=["buffer","normalized","offset","stride"];function qn(){$("if(!",Nt,".buffer){",Ke,".enableVertexAttribArray(",it,");}");var bn=ce.type,Fn;if(ce.size?Fn=$.def(ce.size,"||",Re):Fn=Re,$("if(",Nt,".type!==",bn,"||",Nt,".size!==",Fn,"||",tn.map(function(Sa){return Nt+"."+Sa+"!=="+ce[Sa]}).join("||"),"){",Ke,".bindBuffer(",wl,",",Lt,".buffer);",Ke,".vertexAttribPointer(",[it,Fn,bn,ce.normalized,ce.stride,ce.offset],");",Nt,".type=",bn,";",Nt,".size=",Fn,";",tn.map(function(Sa){return Nt+"."+Sa+"="+ce[Sa]+";"}).join(""),"}"),ir){var xi=ce.divisor;$("if(",Nt,".divisor!==",xi,"){",pe.instancing,".vertexAttribDivisorANGLE(",[it,xi],");",Nt,".divisor=",xi,";}")}}function Qr(){$("if(",Nt,".buffer){",Ke,".disableVertexAttribArray(",it,");",Nt,".buffer=null;","}if(",pr.map(function(bn,Fn){return Nt+"."+bn+"!=="+sr[Fn]}).join("||"),"){",Ke,".vertexAttrib4f(",it,",",sr,");",pr.map(function(bn,Fn){return Nt+"."+bn+"="+sr[Fn]+";"}).join(""),"}")}mt===rn?qn():mt===fn?Qr():($("if(",mt,"===",rn,"){"),qn(),$("}else{"),Qr(),$("}"))}Qe.forEach(function(de){var Re=de.name,ce=Be.attributes[Re],Ke;if(ce){if(!et(ce))return;Ke=ce.append(pe,$)}else{if(!et(Bf))return;var it=pe.scopeAttrib(Re);le.optional(function(){pe.assert($,it+".state","missing attribute "+Re)}),Ke={},Object.keys(new tt).forEach(function(Nt){Ke[Nt]=$.def(it,".",Nt)})}Xe(pe.link(de),Ne(de.info.type),Ke)})}function Ai(pe,$,Be,Qe,et){for(var Ue=pe.shared,Ne=Ue.gl,Xe,de=0;de<Qe.length;++de){var Re=Qe[de],ce=Re.name,Ke=Re.info.type,it=Be.uniforms[ce],Nt=pe.link(Re),mt=Nt+".location",Lt;if(it){if(!et(it))continue;if(Vs(it)){var sr=it.value;if(le.command(sr!==null&&typeof sr!="undefined",'missing uniform "'+ce+'"',pe.commandStr),Ke===Qc||Ke===$l){le.command(typeof sr=="function"&&(Ke===Qc&&(sr._reglType==="texture2d"||sr._reglType==="framebuffer")||Ke===$l&&(sr._reglType==="textureCube"||sr._reglType==="framebufferCube")),"invalid texture for uniform "+ce,pe.commandStr);var tn=pe.link(sr._texture||sr.color[0]._texture);$(Ne,".uniform1i(",mt,",",tn+".bind());"),$.exit(tn,".unbind();")}else if(Ke===xc||Ke===Ff||Ke===qu){le.optional(function(){le.command(ca(sr),"invalid matrix for uniform "+ce,pe.commandStr),le.command(Ke===xc&&sr.length===4||Ke===Ff&&sr.length===9||Ke===qu&&sr.length===16,"invalid length for matrix uniform "+ce,pe.commandStr)});var qn=pe.global.def("new Float32Array(["+Array.prototype.slice.call(sr)+"])"),Qr=2;Ke===Ff?Qr=3:Ke===qu&&(Qr=4),$(Ne,".uniformMatrix",Qr,"fv(",mt,",false,",qn,");")}else{switch(Ke){case Sl:le.commandType(sr,"number","uniform "+ce,pe.commandStr),Xe="1f";break;case Lf:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2f";break;case ia:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3f";break;case Wl:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4f";break;case sp:le.commandType(sr,"boolean","uniform "+ce,pe.commandStr),Xe="1i";break;case Rf:le.commandType(sr,"number","uniform "+ce,pe.commandStr),Xe="1i";break;case Df:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2i";break;case Xl:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2i";break;case Kl:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3i";break;case Yl:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3i";break;case _c:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4i";break;case ql:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4i";break}$(Ne,".uniform",Xe,"(",mt,",",ca(sr)?Array.prototype.slice.call(sr):sr,");")}continue}else Lt=it.append(pe,$)}else{if(!et(Bf))continue;Lt=$.def(Ue.uniforms,"[",ie.id(ce),"]")}Ke===Qc?(le(!Array.isArray(Lt),"must specify a scalar prop for textures"),$("if(",Lt,"&&",Lt,'._reglType==="framebuffer"){',Lt,"=",Lt,".color[0];","}")):Ke===$l&&(le(!Array.isArray(Lt),"must specify a scalar prop for cube maps"),$("if(",Lt,"&&",Lt,'._reglType==="framebufferCube"){',Lt,"=",Lt,".color[0];","}")),le.optional(function(){function es(Hs,rf){pe.assert($,Hs,'bad data or missing for uniform "'+ce+'".  '+rf)}function Cl(Hs){le(!Array.isArray(Lt),"must not specify an array type for uniform"),es("typeof "+Lt+'==="'+Hs+'"',"invalid type, expected "+Hs)}function Ts(Hs,rf){Array.isArray(Lt)?le(Lt.length===Hs,"must have length "+Hs):es(Ue.isArrayLike+"("+Lt+")&&"+Lt+".length==="+Hs,"invalid vector, should have length "+Hs,pe.commandStr)}function Fp(Hs){le(!Array.isArray(Lt),"must not specify a value type"),es("typeof "+Lt+'==="function"&&'+Lt+'._reglType==="texture'+(Hs===Yu?"2d":"Cube")+'"',"invalid texture type",pe.commandStr)}switch(Ke){case Rf:Cl("number");break;case Xl:Ts(2,"number");break;case Yl:Ts(3,"number");break;case ql:Ts(4,"number");break;case Sl:Cl("number");break;case Lf:Ts(2,"number");break;case ia:Ts(3,"number");break;case Wl:Ts(4,"number");break;case sp:Cl("boolean");break;case Df:Ts(2,"boolean");break;case Kl:Ts(3,"boolean");break;case _c:Ts(4,"boolean");break;case xc:Ts(4,"number");break;case Ff:Ts(9,"number");break;case qu:Ts(16,"number");break;case Qc:Fp(Yu);break;case $l:Fp(Jc);break}});var bn=1;switch(Ke){case Qc:case $l:var Fn=$.def(Lt,"._texture");$(Ne,".uniform1i(",mt,",",Fn,".bind());"),$.exit(Fn,".unbind();");continue;case Rf:case sp:Xe="1i";break;case Xl:case Df:Xe="2i",bn=2;break;case Yl:case Kl:Xe="3i",bn=3;break;case ql:case _c:Xe="4i",bn=4;break;case Sl:Xe="1f";break;case Lf:Xe="2f",bn=2;break;case ia:Xe="3f",bn=3;break;case Wl:Xe="4f",bn=4;break;case xc:Xe="Matrix2fv";break;case Ff:Xe="Matrix3fv";break;case qu:Xe="Matrix4fv";break}if($(Ne,".uniform",Xe,"(",mt,","),Xe.charAt(0)==="M"){var xi=Math.pow(Ke-xc+2,2),Sa=pe.global.def("new Float32Array(",xi,")");Array.isArray(Lt)?$("false,(",U(xi,function(es){return Sa+"["+es+"]="+Lt[es]}),",",Sa,")"):$("false,(Array.isArray(",Lt,")||",Lt," instanceof Float32Array)?",Lt,":(",U(xi,function(es){return Sa+"["+es+"]="+Lt+"["+es+"]"}),",",Sa,")")}else bn>1?$(U(bn,function(es){return Array.isArray(Lt)?Lt[es]:Lt+"["+es+"]"})):(le(!Array.isArray(Lt),"uniform value must not be an array"),$(Lt));$(");")}}function mn(pe,$,Be,Qe){var et=pe.shared,Ue=et.gl,Ne=et.draw,Xe=Qe.draw;function de(){var Fn=Xe.elements,xi,Sa=$;return Fn?((Fn.contextDep&&Qe.contextDynamic||Fn.propDep)&&(Sa=Be),xi=Fn.append(pe,Sa)):xi=Sa.def(Ne,".",Wu),xi&&Sa("if("+xi+")"+Ue+".bindBuffer("+ch+","+xi+".buffer.buffer);"),xi}function Re(){var Fn=Xe.count,xi,Sa=$;return Fn?((Fn.contextDep&&Qe.contextDynamic||Fn.propDep)&&(Sa=Be),xi=Fn.append(pe,Sa),le.optional(function(){Fn.MISSING&&pe.assert($,"false","missing vertex count"),Fn.DYNAMIC&&pe.assert(Sa,xi+">=0","missing vertex count")})):(xi=Sa.def(Ne,".",Hl),le.optional(function(){pe.assert(Sa,xi+">=0","missing vertex count")})),xi}var ce=de();function Ke(Fn){var xi=Xe[Fn];return xi?xi.contextDep&&Qe.contextDynamic||xi.propDep?xi.append(pe,Be):xi.append(pe,$):$.def(Ne,".",Fn)}var it=Ke(ou),Nt=Ke(Xu),mt=Re();if(typeof mt=="number"){if(mt===0)return}else Be("if(",mt,"){"),Be.exit("}");var Lt,sr;ir&&(Lt=Ke(gc),sr=pe.instancing);var tn=ce+".type",qn=Xe.elements&&Vs(Xe.elements);function Qr(){function Fn(){Be(sr,".drawElementsInstancedANGLE(",[it,mt,tn,Nt+"<<(("+tn+"-"+Fr+")>>1)",Lt],");")}function xi(){Be(sr,".drawArraysInstancedANGLE(",[it,Nt,mt,Lt],");")}ce?qn?Fn():(Be("if(",ce,"){"),Fn(),Be("}else{"),xi(),Be("}")):xi()}function bn(){function Fn(){Be(Ue+".drawElements("+[it,mt,tn,Nt+"<<(("+tn+"-"+Fr+")>>1)"]+");")}function xi(){Be(Ue+".drawArrays("+[it,Nt,mt]+");")}ce?qn?Fn():(Be("if(",ce,"){"),Fn(),Be("}else{"),xi(),Be("}")):xi()}ir&&(typeof Lt!="number"||Lt>=0)?typeof Lt=="string"?(Be("if(",Lt,">0){"),Qr(),Be("}else if(",Lt,"<0){"),bn(),Be("}")):Qr():bn()}function ei(pe,$,Be,Qe,et){var Ue=xn(),Ne=Ue.proc("body",et);return le.optional(function(){Ue.commandStr=$.commandStr,Ue.command=Ue.link($.commandStr)}),ir&&(Ue.instancing=Ne.def(Ue.shared.extensions,".angle_instanced_arrays")),pe(Ue,Ne,Be,Qe),Ue.compile().body}function ci(pe,$,Be,Qe){Ia(pe,$),Be.useVAO?Be.drawVAO?$(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,$),");"):$(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):($(pe.shared.vao,".setVAO(null);"),Po(pe,$,Be,Qe.attributes,function(){return!0})),Ai(pe,$,Be,Qe.uniforms,function(){return!0}),mn(pe,$,$,Be)}function wa(pe,$){var Be=pe.proc("draw",1);Ia(pe,Be),Ka(pe,Be,$.context),$a(pe,Be,$.framebuffer),uo(pe,Be,$),_o(pe,Be,$.state),Vn(pe,Be,$,!1,!0);var Qe=$.shader.progVar.append(pe,Be);if(Be(pe.shared.gl,".useProgram(",Qe,".program);"),$.shader.program)ci(pe,Be,$,$.shader.program);else{Be(pe.shared.vao,".setVAO(null);");var et=pe.global.def("{}"),Ue=Be.def(Qe,".id"),Ne=Be.def(et,"[",Ue,"]");Be(pe.cond(Ne).then(Ne,".call(this,a0);").else(Ne,"=",et,"[",Ue,"]=",pe.link(function(Xe){return ei(ci,pe,$,Xe,1)}),"(",Qe,");",Ne,".call(this,a0);"))}Object.keys($.state).length>0&&Be(pe.shared.current,".dirty=true;")}function Gs(pe,$,Be,Qe){pe.batchId="a1",Ia(pe,$);function et(){return!0}Po(pe,$,Be,Qe.attributes,et),Ai(pe,$,Be,Qe.uniforms,et),mn(pe,$,$,Be)}function Qu(pe,$,Be,Qe){Ia(pe,$);var et=Be.contextDep,Ue=$.def(),Ne="a0",Xe="a1",de=$.def();pe.shared.props=de,pe.batchId=Ue;var Re=pe.scope(),ce=pe.scope();$(Re.entry,"for(",Ue,"=0;",Ue,"<",Xe,";++",Ue,"){",de,"=",Ne,"[",Ue,"];",ce,"}",Re.exit);function Ke(tn){return tn.contextDep&&et||tn.propDep}function it(tn){return!Ke(tn)}if(Be.needsContext&&Ka(pe,ce,Be.context),Be.needsFramebuffer&&$a(pe,ce,Be.framebuffer),_o(pe,ce,Be.state,Ke),Be.profile&&Ke(Be.profile)&&Vn(pe,ce,Be,!1,!0),Qe)Be.useVAO?Be.drawVAO?Ke(Be.drawVAO)?ce(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,ce),");"):Re(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,Re),");"):Re(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):(Re(pe.shared.vao,".setVAO(null);"),Po(pe,Re,Be,Qe.attributes,it),Po(pe,ce,Be,Qe.attributes,Ke)),Ai(pe,Re,Be,Qe.uniforms,it),Ai(pe,ce,Be,Qe.uniforms,Ke),mn(pe,Re,ce,Be);else{var Nt=pe.global.def("{}"),mt=Be.shader.progVar.append(pe,ce),Lt=ce.def(mt,".id"),sr=ce.def(Nt,"[",Lt,"]");ce(pe.shared.gl,".useProgram(",mt,".program);","if(!",sr,"){",sr,"=",Nt,"[",Lt,"]=",pe.link(function(tn){return ei(Gs,pe,Be,tn,2)}),"(",mt,");}",sr,".call(this,a0[",Ue,"],",Ue,");")}}function _e(pe,$){var Be=pe.proc("batch",2);pe.batchId="0",Ia(pe,Be);var Qe=!1,et=!0;Object.keys($.context).forEach(function(Nt){Qe=Qe||$.context[Nt].propDep}),Qe||(Ka(pe,Be,$.context),et=!1);var Ue=$.framebuffer,Ne=!1;Ue?(Ue.propDep?Qe=Ne=!0:Ue.contextDep&&Qe&&(Ne=!0),Ne||$a(pe,Be,Ue)):$a(pe,Be,null),$.state.viewport&&$.state.viewport.propDep&&(Qe=!0);function Xe(Nt){return Nt.contextDep&&Qe||Nt.propDep}uo(pe,Be,$),_o(pe,Be,$.state,function(Nt){return!Xe(Nt)}),(!$.profile||!Xe($.profile))&&Vn(pe,Be,$,!1,"a1"),$.contextDep=Qe,$.needsContext=et,$.needsFramebuffer=Ne;var de=$.shader.progVar;if(de.contextDep&&Qe||de.propDep)Qu(pe,Be,$,null);else{var Re=de.append(pe,Be);if(Be(pe.shared.gl,".useProgram(",Re,".program);"),$.shader.program)Qu(pe,Be,$,$.shader.program);else{Be(pe.shared.vao,".setVAO(null);");var ce=pe.global.def("{}"),Ke=Be.def(Re,".id"),it=Be.def(ce,"[",Ke,"]");Be(pe.cond(it).then(it,".call(this,a0,a1);").else(it,"=",ce,"[",Ke,"]=",pe.link(function(Nt){return ei(Qu,pe,$,Nt,2)}),"(",Re,");",it,".call(this,a0,a1);"))}}Object.keys($.state).length>0&&Be(pe.shared.current,".dirty=true;")}function yt(pe,$){var Be=pe.proc("scope",3);pe.batchId="a2";var Qe=pe.shared,et=Qe.current;Ka(pe,Be,$.context),$.framebuffer&&$.framebuffer.append(pe,Be),kp(Object.keys($.state)).forEach(function(Ne){var Xe=$.state[Ne],de=Xe.append(pe,Be);ca(de)?de.forEach(function(Re,ce){Be.set(pe.next[Ne],"["+ce+"]",Re)}):Be.set(Qe.next,"."+Ne,de)}),Vn(pe,Be,$,!0,!0),[Wu,Xu,Hl,gc,ou].forEach(function(Ne){var Xe=$.draw[Ne];!Xe||Be.set(Qe.draw,"."+Ne,""+Xe.append(pe,Be))}),Object.keys($.uniforms).forEach(function(Ne){var Xe=$.uniforms[Ne].append(pe,Be);Array.isArray(Xe)&&(Xe="["+Xe.join()+"]"),Be.set(Qe.uniforms,"["+ie.id(Ne)+"]",Xe)}),Object.keys($.attributes).forEach(function(Ne){var Xe=$.attributes[Ne].append(pe,Be),de=pe.scopeAttrib(Ne);Object.keys(new tt).forEach(function(Re){Be.set(de,"."+Re,Xe[Re])})}),$.scopeVAO&&Be.set(Qe.vao,".targetVAO",$.scopeVAO.append(pe,Be));function Ue(Ne){var Xe=$.shader[Ne];Xe&&Be.set(Qe.shader,"."+Ne,Xe.append(pe,Be))}Ue(oo),Ue(ds),Object.keys($.state).length>0&&(Be(et,".dirty=true;"),Be.exit(et,".dirty=true;")),Be("a1(",pe.shared.context,",a0,",pe.batchId,");")}function ft(pe){if(!(typeof pe!="object"||ca(pe))){for(var $=Object.keys(pe),Be=0;Be<$.length;++Be)if(ui.isDynamic(pe[$[Be]]))return!0;return!1}}function Vr(pe,$,Be){var Qe=$.static[Be];if(!Qe||!ft(Qe))return;var et=pe.global,Ue=Object.keys(Qe),Ne=!1,Xe=!1,de=!1,Re=pe.global.def("{}");Ue.forEach(function(Ke){var it=Qe[Ke];if(ui.isDynamic(it)){typeof it=="function"&&(it=Qe[Ke]=ui.unbox(it));var Nt=vs(it,null);Ne=Ne||Nt.thisDep,de=de||Nt.propDep,Xe=Xe||Nt.contextDep}else{switch(et(Re,".",Ke,"="),typeof it){case"number":et(it);break;case"string":et('"',it,'"');break;case"object":Array.isArray(it)&&et("[",it.join(),"]");break;default:et(pe.link(it));break}et(";")}});function ce(Ke,it){Ue.forEach(function(Nt){var mt=Qe[Nt];if(!!ui.isDynamic(mt)){var Lt=Ke.invoke(it,mt);it(Re,".",Nt,"=",Lt,";")}})}$.dynamic[Be]=new ui.DynamicVariable(kn,{thisDep:Ne,contextDep:Xe,propDep:de,ref:Re,append:ce}),delete $.static[Be]}function ti(pe,$,Be,Qe,et){var Ue=xn();Ue.stats=Ue.link(et),Object.keys($.static).forEach(function(Xe){Vr(Ue,$,Xe)}),lh.forEach(function(Xe){Vr(Ue,pe,Xe)});var Ne=Za(pe,$,Be,Qe,Ue);return wa(Ue,Ne),yt(Ue,Ne),_e(Ue,Ne),G(Ue.compile(),{destroy:function(){Ne.shader.program.destroy()}})}return{next:Nr,current:Ht,procs:function(){var pe=xn(),$=pe.proc("poll"),Be=pe.proc("refresh"),Qe=pe.block();$(Qe),Be(Qe);var et=pe.shared,Ue=et.gl,Ne=et.next,Xe=et.current;Qe(Xe,".dirty=false;"),$a(pe,$),$a(pe,Be,null,!0);var de;ir&&(de=pe.link(ir)),ye.oes_vertex_array_object&&Be(pe.link(ye.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Re=0;Re<_t.maxAttributes;++Re){var ce=Be.def(et.attributes,"[",Re,"]"),Ke=pe.cond(ce,".buffer");Ke.then(Ue,".enableVertexAttribArray(",Re,");",Ue,".bindBuffer(",wl,",",ce,".buffer.buffer);",Ue,".vertexAttribPointer(",Re,",",ce,".size,",ce,".type,",ce,".normalized,",ce,".stride,",ce,".offset);").else(Ue,".disableVertexAttribArray(",Re,");",Ue,".vertexAttrib4f(",Re,",",ce,".x,",ce,".y,",ce,".z,",ce,".w);",ce,".buffer=null;"),Be(Ke),ir&&Be(de,".vertexAttribDivisorANGLE(",Re,",",ce,".divisor);")}return Be(pe.shared.vao,".currentVAO=null;",pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"),Object.keys(Er).forEach(function(it){var Nt=Er[it],mt=Qe.def(Ne,".",it),Lt=pe.block();Lt("if(",mt,"){",Ue,".enable(",Nt,")}else{",Ue,".disable(",Nt,")}",Xe,".",it,"=",mt,";"),Be(Lt),$("if(",mt,"!==",Xe,".",it,"){",Lt,"}")}),Object.keys(Wt).forEach(function(it){var Nt=Wt[it],mt=Ht[it],Lt,sr,tn=pe.block();if(tn(Ue,".",Nt,"("),ca(mt)){var qn=mt.length;Lt=pe.global.def(Ne,".",it),sr=pe.global.def(Xe,".",it),tn(U(qn,function(Qr){return Lt+"["+Qr+"]"}),");",U(qn,function(Qr){return sr+"["+Qr+"]="+Lt+"["+Qr+"];"}).join("")),$("if(",U(qn,function(Qr){return Lt+"["+Qr+"]!=="+sr+"["+Qr+"]"}).join("||"),"){",tn,"}")}else Lt=Qe.def(Ne,".",it),sr=Qe.def(Xe,".",it),tn(Lt,");",Xe,".",it,"=",Lt,";"),$("if(",Lt,"!==",sr,"){",tn,"}");Be(tn)}),pe.compile()}(),compile:ti}}function wh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Sh=34918,Vo=34919,Eh=35007,Lp=function(k,ie){if(!ie.ext_disjoint_timer_query)return null;var ye=[];function _t(){return ye.pop()||ie.ext_disjoint_timer_query.createQueryEXT()}function Bt(ir){ye.push(ir)}var ht=[];function Mt(ir){var kr=_t();ie.ext_disjoint_timer_query.beginQueryEXT(Eh,kr),ht.push(kr),rr(ht.length-1,ht.length,ir)}function nr(){ie.ext_disjoint_timer_query.endQueryEXT(Eh)}function ar(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var fr=[];function or(){return fr.pop()||new ar}function mr(ir){fr.push(ir)}var Ar=[];function rr(ir,kr,Ht){var Nr=or();Nr.startQueryIndex=ir,Nr.endQueryIndex=kr,Nr.sum=0,Nr.stats=Ht,Ar.push(Nr)}var vr=[],tt=[];function xt(){var ir,kr,Ht=ht.length;if(Ht!==0){tt.length=Math.max(tt.length,Ht+1),vr.length=Math.max(vr.length,Ht+1),vr[0]=0,tt[0]=0;var Nr=0;for(ir=0,kr=0;kr<ht.length;++kr){var Qt=ht[kr];ie.ext_disjoint_timer_query.getQueryObjectEXT(Qt,Vo)?(Nr+=ie.ext_disjoint_timer_query.getQueryObjectEXT(Qt,Sh),Bt(Qt)):ht[ir++]=Qt,vr[kr+1]=Nr,tt[kr+1]=ir}for(ht.length=ir,ir=0,kr=0;kr<Ar.length;++kr){var Er=Ar[kr],Wt=Er.startQueryIndex,yr=Er.endQueryIndex;Er.sum+=vr[yr]-vr[Wt];var ln=tt[Wt],pn=tt[yr];pn===ln?(Er.stats.gpuTime+=Er.sum/1e6,mr(Er)):(Er.startQueryIndex=ln,Er.endQueryIndex=pn,Ar[ir++]=Er)}Ar.length=ir}}return{beginQuery:Mt,endQuery:nr,pushScopeStats:rr,update:xt,getNumPendingQueries:function(){return ht.length},clear:function(){ye.push.apply(ye,ht);for(var ir=0;ir<ye.length;ir++)ie.ext_disjoint_timer_query.deleteQueryEXT(ye[ir]);ht.length=0,ye.length=0},restore:function(){ht.length=0,ye.length=0}}},Rp=16384,Ch=256,up=1024,Th=34962,Ah="webglcontextlost",Mh="webglcontextrestored",lp=1,td=2,Ph=3;function Sc(k,ie){for(var ye=0;ye<k.length;++ye)if(k[ye]===ie)return ye;return-1}function Dp(k){var ie=Ji(k);if(!ie)return null;var ye=ie.gl,_t=ye.getContextAttributes(),Bt=ye.isContextLost(),ht=B(ye,ie);if(!ht)return null;var Mt=Mn(),nr=wh(),ar=ht.extensions,fr=Lp(ye,ar),or=$n(),mr=ye.drawingBufferWidth,Ar=ye.drawingBufferHeight,rr={tick:0,time:0,viewportWidth:mr,viewportHeight:Ar,framebufferWidth:mr,framebufferHeight:Ar,drawingBufferWidth:mr,drawingBufferHeight:Ar,pixelRatio:ie.pixelRatio},vr={},tt={elements:null,primitive:4,count:-1,offset:0,instances:-1},xt=Ta(ye,ar),ir=vu(ye,nr,ie,Ht),kr=ee(ye,ar,xt,nr,ir);function Ht(mn){return kr.destroyBuffer(mn)}var Nr=Sp(ye,ar,ir,nr),Qt=ge(ye,Mt,nr,ie),Er=Qs(ye,ar,xt,function(){ln.procs.poll()},rr,nr,ie),Wt=ta(ye,ar,xt,nr,ie),yr=P(ye,ar,xt,Er,Wt,nr),ln=bh(ye,Mt,ar,xt,ir,Nr,Er,yr,vr,kr,Qt,tt,rr,fr,ie),pn=wt(ye,yr,ln.procs.poll,rr,_t,ar,xt),wr=ln.next,qt=ye.canvas,jt=[],xn=[],yn=[],Kr=[ie.onDestroy],Qn=null;function Dn(){if(jt.length===0){fr&&fr.update(),Qn=null;return}Qn=Rn.next(Dn),_o();for(var mn=jt.length-1;mn>=0;--mn){var ei=jt[mn];ei&&ei(rr,null,0)}ye.flush(),fr&&fr.update()}function Yn(){!Qn&&jt.length>0&&(Qn=Rn.next(Dn))}function gi(){Qn&&(Rn.cancel(Dn),Qn=null)}function ba(mn){mn.preventDefault(),Bt=!0,gi(),xn.forEach(function(ei){ei()})}function so(mn){ye.getError(),Bt=!1,ht.restore(),Qt.restore(),ir.restore(),Er.restore(),Wt.restore(),yr.restore(),kr.restore(),fr&&fr.restore(),ln.procs.refresh(),Yn(),yn.forEach(function(ei){ei()})}qt&&(qt.addEventListener(Ah,ba,!1),qt.addEventListener(Mh,so,!1));function ai(){jt.length=0,gi(),qt&&(qt.removeEventListener(Ah,ba),qt.removeEventListener(Mh,so)),Qt.clear(),yr.clear(),Wt.clear(),Er.clear(),Nr.clear(),ir.clear(),kr.clear(),fr&&fr.clear(),Kr.forEach(function(mn){mn()})}function ha(mn){le(!!mn,"invalid args to regl({...})"),le.type(mn,"object","invalid args to regl({...})");function ei(et){var Ue=G({},et);delete Ue.uniforms,delete Ue.attributes,delete Ue.context,delete Ue.vao,"stencil"in Ue&&Ue.stencil.op&&(Ue.stencil.opBack=Ue.stencil.opFront=Ue.stencil.op,delete Ue.stencil.op);function Ne(Xe){if(Xe in Ue){var de=Ue[Xe];delete Ue[Xe],Object.keys(de).forEach(function(Re){Ue[Xe+"."+Re]=de[Re]})}}return Ne("blend"),Ne("depth"),Ne("cull"),Ne("stencil"),Ne("polygonOffset"),Ne("scissor"),Ne("sample"),"vao"in et&&(Ue.vao=et.vao),Ue}function ci(et,Ue){var Ne={},Xe={};return Object.keys(et).forEach(function(de){var Re=et[de];if(ui.isDynamic(Re)){Xe[de]=ui.unbox(Re,de);return}else if(Ue&&Array.isArray(Re)){for(var ce=0;ce<Re.length;++ce)if(ui.isDynamic(Re[ce])){Xe[de]=ui.unbox(Re,de);return}}Ne[de]=Re}),{dynamic:Xe,static:Ne}}var wa=ci(mn.context||{},!0),Gs=ci(mn.uniforms||{},!0),Qu=ci(mn.attributes||{},!1),_e=ci(ei(mn),!1),yt={gpuTime:0,cpuTime:0,count:0},ft=ln.compile(_e,Qu,Gs,wa,yt),Vr=ft.draw,ti=ft.batch,pe=ft.scope,$=[];function Be(et){for(;$.length<et;)$.push(null);return $}function Qe(et,Ue){var Ne;if(Bt&&le.raise("context lost"),typeof et=="function")return pe.call(this,null,et,0);if(typeof Ue=="function")if(typeof et=="number")for(Ne=0;Ne<et;++Ne)pe.call(this,null,Ue,Ne);else if(Array.isArray(et))for(Ne=0;Ne<et.length;++Ne)pe.call(this,et[Ne],Ue,Ne);else return pe.call(this,et,Ue,0);else if(typeof et=="number"){if(et>0)return ti.call(this,Be(et|0),et|0)}else if(Array.isArray(et)){if(et.length)return ti.call(this,et,et.length)}else return Vr.call(this,et)}return G(Qe,{stats:yt,destroy:function(){ft.destroy()}})}var Hi=yr.setFBO=ha({framebuffer:ui.define.call(null,lp,"framebuffer")});function Za(mn,ei){var ci=0;ln.procs.poll();var wa=ei.color;wa&&(ye.clearColor(+wa[0]||0,+wa[1]||0,+wa[2]||0,+wa[3]||0),ci|=Rp),"depth"in ei&&(ye.clearDepth(+ei.depth),ci|=Ch),"stencil"in ei&&(ye.clearStencil(ei.stencil|0),ci|=up),le(!!ci,"called regl.clear with no buffer specified"),ye.clear(ci)}function Ka(mn){if(le(typeof mn=="object"&&mn,"regl.clear() takes an object as input"),"framebuffer"in mn)if(mn.framebuffer&&mn.framebuffer_reglType==="framebufferCube")for(var ei=0;ei<6;++ei)Hi(G({framebuffer:mn.framebuffer.faces[ei]},mn),Za);else Hi(mn,Za);else Za(null,mn)}function $a(mn){le.type(mn,"function","regl.frame() callback must be a function"),jt.push(mn);function ei(){var ci=Sc(jt,mn);le(ci>=0,"cannot cancel a frame twice");function wa(){var Gs=Sc(jt,wa);jt[Gs]=jt[jt.length-1],jt.length-=1,jt.length<=0&&gi()}jt[ci]=wa}return Yn(),{cancel:ei}}function uo(){var mn=wr.viewport,ei=wr.scissor_box;mn[0]=mn[1]=ei[0]=ei[1]=0,rr.viewportWidth=rr.framebufferWidth=rr.drawingBufferWidth=mn[2]=ei[2]=ye.drawingBufferWidth,rr.viewportHeight=rr.framebufferHeight=rr.drawingBufferHeight=mn[3]=ei[3]=ye.drawingBufferHeight}function _o(){rr.tick+=1,rr.time=Vn(),uo(),ln.procs.poll()}function Ia(){Er.refresh(),uo(),ln.procs.refresh(),fr&&fr.update()}function Vn(){return($n()-or)/1e3}Ia();function Po(mn,ei){le.type(ei,"function","listener callback must be a function");var ci;switch(mn){case"frame":return $a(ei);case"lost":ci=xn;break;case"restore":ci=yn;break;case"destroy":ci=Kr;break;default:le.raise("invalid event, must be one of frame,lost,restore,destroy")}return ci.push(ei),{cancel:function(){for(var wa=0;wa<ci.length;++wa)if(ci[wa]===ei){ci[wa]=ci[ci.length-1],ci.pop();return}}}}var Ai=G(ha,{clear:Ka,prop:ui.define.bind(null,lp),context:ui.define.bind(null,td),this:ui.define.bind(null,Ph),draw:ha({}),buffer:function(mn){return ir.create(mn,Th,!1,!1)},elements:function(mn){return Nr.create(mn,!1)},texture:Er.create2D,cube:Er.createCube,renderbuffer:Wt.create,framebuffer:yr.create,framebufferCube:yr.createCube,vao:kr.createVAO,attributes:_t,frame:$a,on:Po,limits:xt,hasExtension:function(mn){return xt.extensions.indexOf(mn.toLowerCase())>=0},read:pn,destroy:ai,_gl:ye,_refresh:Ia,poll:function(){_o(),fr&&fr.update()},now:Vn,stats:nr});return ie.onDone(null,Ai),Ai}return Dp})},69848:function(dr){(function(X,G){dr.exports=G()})(this,function(){"use strict";function X(st,He,ut,Ye,kt,ur){if(!(kt-Ye<=ut)){var Or=Ye+kt>>1;G(st,He,Or,Ye,kt,ur%2),X(st,He,ut,Ye,Or-1,ur+1),X(st,He,ut,Or+1,kt,ur+1)}}function G(st,He,ut,Ye,kt,ur){for(;kt>Ye;){if(kt-Ye>600){var Or=kt-Ye+1,Gr=ut-Ye+1,Ee=Math.log(Or),Ve=.5*Math.exp(2*Ee/3),ke=.5*Math.sqrt(Ee*Ve*(Or-Ve)/Or)*(Gr-Or/2<0?-1:1),vt=Math.max(Ye,Math.floor(ut-Gr*Ve/Or+ke)),qe=Math.min(kt,Math.floor(ut+(Or-Gr)*Ve/Or+ke));G(st,He,ut,vt,qe,ur)}var H=He[2*ut+ur],Je=Ye,Et=kt;for(Me(st,He,Ye,ut),He[2*kt+ur]>H&&Me(st,He,Ye,kt);Je<Et;){for(Me(st,He,Je,Et),Je++,Et--;He[2*Je+ur]<H;)Je++;for(;He[2*Et+ur]>H;)Et--}He[2*Ye+ur]===H?Me(st,He,Ye,Et):(Et++,Me(st,He,Et,kt)),Et<=ut&&(Ye=Et+1),ut<=Et&&(kt=Et-1)}}function Me(st,He,ut,Ye){ve(st,ut,Ye),ve(He,2*ut,2*Ye),ve(He,2*ut+1,2*Ye+1)}function ve(st,He,ut){var Ye=st[He];st[He]=st[ut],st[ut]=Ye}function v(st,He,ut,Ye,kt,ur,Or){for(var Gr=[0,st.length-1,0],Ee=[],Ve,ke;Gr.length;){var vt=Gr.pop(),qe=Gr.pop(),H=Gr.pop();if(qe-H<=Or){for(var Je=H;Je<=qe;Je++)Ve=He[2*Je],ke=He[2*Je+1],Ve>=ut&&Ve<=kt&&ke>=Ye&&ke<=ur&&Ee.push(st[Je]);continue}var Et=Math.floor((H+qe)/2);Ve=He[2*Et],ke=He[2*Et+1],Ve>=ut&&Ve<=kt&&ke>=Ye&&ke<=ur&&Ee.push(st[Et]);var gt=(vt+1)%2;(vt===0?ut<=Ve:Ye<=ke)&&(Gr.push(H),Gr.push(Et-1),Gr.push(gt)),(vt===0?kt>=Ve:ur>=ke)&&(Gr.push(Et+1),Gr.push(qe),Gr.push(gt))}return Ee}function be(st,He,ut,Ye,kt,ur){for(var Or=[0,st.length-1,0],Gr=[],Ee=kt*kt;Or.length;){var Ve=Or.pop(),ke=Or.pop(),vt=Or.pop();if(ke-vt<=ur){for(var qe=vt;qe<=ke;qe++)Z(He[2*qe],He[2*qe+1],ut,Ye)<=Ee&&Gr.push(st[qe]);continue}var H=Math.floor((vt+ke)/2),Je=He[2*H],Et=He[2*H+1];Z(Je,Et,ut,Ye)<=Ee&&Gr.push(st[H]);var gt=(Ve+1)%2;(Ve===0?ut-kt<=Je:Ye-kt<=Et)&&(Or.push(vt),Or.push(H-1),Or.push(gt)),(Ve===0?ut+kt>=Je:Ye+kt>=Et)&&(Or.push(H+1),Or.push(ke),Or.push(gt))}return Gr}function Z(st,He,ut,Ye){var kt=st-ut,ur=He-Ye;return kt*kt+ur*ur}var se=function(st){return st[0]},me=function(st){return st[1]},ae=function(He,ut,Ye,kt,ur){ut===void 0&&(ut=se),Ye===void 0&&(Ye=me),kt===void 0&&(kt=64),ur===void 0&&(ur=Float64Array),this.nodeSize=kt,this.points=He;for(var Or=He.length<65536?Uint16Array:Uint32Array,Gr=this.ids=new Or(He.length),Ee=this.coords=new ur(He.length*2),Ve=0;Ve<He.length;Ve++)Gr[Ve]=Ve,Ee[2*Ve]=ut(He[Ve]),Ee[2*Ve+1]=Ye(He[Ve]);X(Gr,Ee,kt,0,Gr.length-1,0)};ae.prototype.range=function(He,ut,Ye,kt){return v(this.ids,this.coords,He,ut,Ye,kt,this.nodeSize)},ae.prototype.within=function(He,ut,Ye){return be(this.ids,this.coords,He,ut,Ye,this.nodeSize)};var fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(st){return st}},Q=Math.fround||function(st){return function(He){return st[0]=+He,st[0]}}(new Float32Array(1)),we=function(He){this.options=Mr(Object.create(fe),He),this.trees=new Array(this.options.maxZoom+1)};we.prototype.load=function(He){var ut=this.options,Ye=ut.log,kt=ut.minZoom,ur=ut.maxZoom,Or=ut.nodeSize;Ye&&console.time("total time");var Gr="prepare "+He.length+" points";Ye&&console.time(Gr),this.points=He;for(var Ee=[],Ve=0;Ve<He.length;Ve++)!He[Ve].geometry||Ee.push(M(He[Ve],Ve));this.trees[ur+1]=new ae(Ee,cr,Ft,Or,Float32Array),Ye&&console.timeEnd(Gr);for(var ke=ur;ke>=kt;ke--){var vt=+Date.now();Ee=this._cluster(Ee,ke),this.trees[ke]=new ae(Ee,cr,Ft,Or,Float32Array),Ye&&console.log("z%d: %d clusters in %dms",ke,Ee.length,+Date.now()-vt)}return Ye&&console.timeEnd("total time"),this},we.prototype.getClusters=function(He,ut){var Ye=((He[0]+180)%360+360)%360-180,kt=Math.max(-90,Math.min(90,He[1])),ur=He[2]===180?180:((He[2]+180)%360+360)%360-180,Or=Math.max(-90,Math.min(90,He[3]));if(He[2]-He[0]>=360)Ye=-180,ur=180;else if(Ye>ur){var Gr=this.getClusters([Ye,kt,180,Or],ut),Ee=this.getClusters([-180,kt,ur,Or],ut);return Gr.concat(Ee)}for(var Ve=this.trees[this._limitZoom(ut)],ke=Ve.range(Dt(Ye),Ut(Or),Dt(ur),Ut(kt)),vt=[],qe=0,H=ke;qe<H.length;qe+=1){var Je=H[qe],Et=Ve.points[Je];vt.push(Et.numPoints?Jt(Et):this.points[Et.index])}return vt},we.prototype.getChildren=function(He){var ut=this._getOriginId(He),Ye=this._getOriginZoom(He),kt="No cluster with the specified id.",ur=this.trees[Ye];if(!ur)throw new Error(kt);var Or=ur.points[ut];if(!Or)throw new Error(kt);for(var Gr=this.options.radius/(this.options.extent*Math.pow(2,Ye-1)),Ee=ur.within(Or.x,Or.y,Gr),Ve=[],ke=0,vt=Ee;ke<vt.length;ke+=1){var qe=vt[ke],H=ur.points[qe];H.parentId===He&&Ve.push(H.numPoints?Jt(H):this.points[H.index])}if(Ve.length===0)throw new Error(kt);return Ve},we.prototype.getLeaves=function(He,ut,Ye){ut=ut||10,Ye=Ye||0;var kt=[];return this._appendLeaves(kt,He,ut,Ye,0),kt},we.prototype.getTile=function(He,ut,Ye){var kt=this.trees[this._limitZoom(He)],ur=Math.pow(2,He),Or=this.options,Gr=Or.extent,Ee=Or.radius,Ve=Ee/Gr,ke=(Ye-Ve)/ur,vt=(Ye+1+Ve)/ur,qe={features:[]};return this._addTileFeatures(kt.range((ut-Ve)/ur,ke,(ut+1+Ve)/ur,vt),kt.points,ut,Ye,ur,qe),ut===0&&this._addTileFeatures(kt.range(1-Ve/ur,ke,1,vt),kt.points,ur,Ye,ur,qe),ut===ur-1&&this._addTileFeatures(kt.range(0,ke,Ve/ur,vt),kt.points,-1,Ye,ur,qe),qe.features.length?qe:null},we.prototype.getClusterExpansionZoom=function(He){for(var ut=this._getOriginZoom(He)-1;ut<=this.options.maxZoom;){var Ye=this.getChildren(He);if(ut++,Ye.length!==1)break;He=Ye[0].properties.cluster_id}return ut},we.prototype._appendLeaves=function(He,ut,Ye,kt,ur){for(var Or=this.getChildren(ut),Gr=0,Ee=Or;Gr<Ee.length;Gr+=1){var Ve=Ee[Gr],ke=Ve.properties;if(ke&&ke.cluster?ur+ke.point_count<=kt?ur+=ke.point_count:ur=this._appendLeaves(He,ke.cluster_id,Ye,kt,ur):ur<kt?ur++:He.push(Ve),He.length===Ye)break}return ur},we.prototype._addTileFeatures=function(He,ut,Ye,kt,ur,Or){for(var Gr=0,Ee=He;Gr<Ee.length;Gr+=1){var Ve=Ee[Gr],ke=ut[Ve],vt=ke.numPoints,qe=void 0,H=void 0,Je=void 0;if(vt)qe=Gt(ke),H=ke.x,Je=ke.y;else{var Et=this.points[ke.index];qe=Et.properties,H=Dt(Et.geometry.coordinates[0]),Je=Ut(Et.geometry.coordinates[1])}var gt={type:1,geometry:[[Math.round(this.options.extent*(H*ur-Ye)),Math.round(this.options.extent*(Je*ur-kt))]],tags:qe},qr=void 0;vt?qr=ke.id:this.options.generateId?qr=ke.index:this.points[ke.index].id&&(qr=this.points[ke.index].id),qr!==void 0&&(gt.id=qr),Or.features.push(gt)}},we.prototype._limitZoom=function(He){return Math.max(this.options.minZoom,Math.min(+He,this.options.maxZoom+1))},we.prototype._cluster=function(He,ut){for(var Ye=[],kt=this.options,ur=kt.radius,Or=kt.extent,Gr=kt.reduce,Ee=kt.minPoints,Ve=ur/(Or*Math.pow(2,ut)),ke=0;ke<He.length;ke++){var vt=He[ke];if(!(vt.zoom<=ut)){vt.zoom=ut;for(var qe=this.trees[ut+1],H=qe.within(vt.x,vt.y,Ve),Je=vt.numPoints||1,Et=Je,gt=0,qr=H;gt<qr.length;gt+=1){var Si=qr[gt],On=qe.points[Si];On.zoom>ut&&(Et+=On.numPoints||1)}if(Et>=Ee){for(var An=vt.x*Je,gn=vt.y*Je,Cn=Gr&&Je>1?this._map(vt,!0):null,un=(ke<<5)+(ut+1)+this.points.length,Oi=0,Ei=H;Oi<Ei.length;Oi+=1){var da=Ei[Oi],sa=qe.points[da];if(!(sa.zoom<=ut)){sa.zoom=ut;var Ti=sa.numPoints||1;An+=sa.x*Ti,gn+=sa.y*Ti,sa.parentId=un,Gr&&(Cn||(Cn=this._map(vt,!0)),Gr(Cn,this._map(sa)))}}vt.parentId=un,Ye.push(Oe(An/Et,gn/Et,un,Et,Cn))}else if(Ye.push(vt),Et>1)for(var lo=0,Mi=H;lo<Mi.length;lo+=1){var Pi=Mi[lo],bo=qe.points[Pi];bo.zoom<=ut||(bo.zoom=ut,Ye.push(bo))}}}return Ye},we.prototype._getOriginId=function(He){return He-this.points.length>>5},we.prototype._getOriginZoom=function(He){return(He-this.points.length)%32},we.prototype._map=function(He,ut){if(He.numPoints)return ut?Mr({},He.properties):He.properties;var Ye=this.points[He.index].properties,kt=this.options.map(Ye);return ut&&kt===Ye?Mr({},kt):kt};function Oe(st,He,ut,Ye,kt){return{x:Q(st),y:Q(He),zoom:Infinity,id:ut,parentId:-1,numPoints:Ye,properties:kt}}function M(st,He){var ut=st.geometry.coordinates,Ye=ut[0],kt=ut[1];return{x:Q(Dt(Ye)),y:Q(Ut(kt)),zoom:Infinity,index:He,parentId:-1}}function Jt(st){return{type:"Feature",id:st.id,properties:Gt(st),geometry:{type:"Point",coordinates:[ct(st.x),dt(st.y)]}}}function Gt(st){var He=st.numPoints,ut=He>=1e4?Math.round(He/1e3)+"k":He>=1e3?Math.round(He/100)/10+"k":He;return Mr(Mr({},st.properties),{cluster:!0,cluster_id:st.id,point_count:He,point_count_abbreviated:ut})}function Dt(st){return st/360+.5}function Ut(st){var He=Math.sin(st*Math.PI/180),ut=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return ut<0?0:ut>1?1:ut}function ct(st){return(st-.5)*360}function dt(st){var He=(180-st*360)*Math.PI/180;return 360*Math.atan(Math.exp(He))/Math.PI-90}function Mr(st,He){for(var ut in He)st[ut]=He[ut];return st}function cr(st){return st.x}function Ft(st){return st.y}return we})},75752:function(dr){dr.exports.RADIUS=6378137,dr.exports.FLATTENING=1/298.257223563,dr.exports.POLAR_RADIUS=63567523142e-4}}]);
