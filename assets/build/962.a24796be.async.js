(self.webpackChunkgosh_esp=self.webpackChunkgosh_esp||[]).push([[962],{81618:function(Te){"use strict";(function(c,n){Te.exports=n()})(this,function(){function c(d){var E=[];return d.AMapUI&&E.push(n(d.AMapUI)),d.Loca&&E.push(i(d.Loca)),Promise.all(E)}function n(d){return new Promise(function(E,g){var k=[];if(d.plugins)for(var M=0;M<d.plugins.length;M+=1)o.AMapUI.plugins.indexOf(d.plugins[M])==-1&&k.push(d.plugins[M]);if(w.AMapUI===F.failed)g("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(w.AMapUI===F.notload){w.AMapUI=F.loading,o.AMapUI.version=d.version||o.AMapUI.version,M=o.AMapUI.version;var j=document.body||document.head,U=document.createElement("script");U.type="text/javascript",U.src="https://webapi.amap.com/ui/"+M+"/main.js",U.onerror=function(I){w.AMapUI=F.failed,g("\u8BF7\u6C42 AMapUI \u5931\u8D25")},U.onload=function(){if(w.AMapUI=F.loaded,k.length)window.AMapUI.loadUI(k,function(){for(var I=0,O=k.length;I<O;I++){var D=k[I].split("/").slice(-1)[0];window.AMapUI[D]=arguments[I]}for(E();_.AMapUI.length;)_.AMapUI.splice(0,1)[0]()});else for(E();_.AMapUI.length;)_.AMapUI.splice(0,1)[0]()},j.appendChild(U)}else w.AMapUI===F.loaded?d.version&&d.version!==o.AMapUI.version?g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):k.length?window.AMapUI.loadUI(k,function(){for(var I=0,O=k.length;I<O;I++){var D=k[I].split("/").slice(-1)[0];window.AMapUI[D]=arguments[I]}E()}):E():d.version&&d.version!==o.AMapUI.version?g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):_.AMapUI.push(function(I){I?g(I):k.length?window.AMapUI.loadUI(k,function(){for(var O=0,D=k.length;O<D;O++){var R=k[O].split("/").slice(-1)[0];window.AMapUI[R]=arguments[O]}E()}):E()})})}function i(d){return new Promise(function(E,g){if(o.AMap.version.startsWith("2.0"))g("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(w.Loca===F.failed)g("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(w.Loca===F.notload){w.Loca=F.loading,o.Loca.version=d.version||o.Loca.version;var k=o.Loca.version,M=o.key,j=document.body||document.head,U=document.createElement("script");U.type="text/javascript",U.src="https://webapi.amap.com/loca?v="+k+"&key="+M,U.onerror=function(I){w.Loca=F.failed,g("\u8BF7\u6C42 AMapUI \u5931\u8D25")},U.onload=function(){for(w.Loca=F.loaded,E();_.Loca.length;)_.Loca.splice(0,1)[0]()},j.appendChild(U)}else w.Loca===F.loaded?d.version&&d.version!==o.Loca.version?g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):E():d.version&&d.version!==o.Loca.version?g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):_.Loca.push(function(I){I?g(I):g()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var F;(function(d){d.notload="notload",d.loading="loading",d.loaded="loaded",d.failed="failed"})(F||(F={}));var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},w={AMap:F.notload,AMapUI:F.notload,Loca:F.notload},_={AMap:[],AMapUI:[],Loca:[]},P=[],L=function(d){typeof d=="function"&&(w.AMap===F.loaded?d(window.AMap):P.push(d))};return{load:function(d){return new Promise(function(E,g){if(w.AMap==F.failed)g("");else if(w.AMap==F.notload){var k=d.key,M=d.version,j=d.plugins;k?(window.AMap&&location.host!=="lbs.amap.com"&&g("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),o.key=k,o.AMap.version=M||o.AMap.version,o.AMap.plugins=j||o.AMap.plugins,w.AMap=F.loading,M=document.body||document.head,window.___onAPILoaded=function(I){if(delete window.___onAPILoaded,I)w.AMap=F.failed,g(I);else for(w.AMap=F.loaded,c(d).then(function(){E(window.AMap)}).catch(g);P.length;)P.splice(0,1)[0]()},j=document.createElement("script"),j.type="text/javascript",j.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+k+"&plugin="+o.AMap.plugins.join(","),j.onerror=function(I){w.AMap=F.failed,g(I)},M.appendChild(j)):g("\u8BF7\u586B\u5199key")}else if(w.AMap==F.loaded)if(d.key&&d.key!==o.key)g("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(d.version&&d.version!==o.AMap.version)g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(k=[],d.plugins)for(M=0;M<d.plugins.length;M+=1)o.AMap.plugins.indexOf(d.plugins[M])==-1&&k.push(d.plugins[M]);k.length?window.AMap.plugin(k,function(){c(d).then(function(){E(window.AMap)}).catch(g)}):c(d).then(function(){E(window.AMap)}).catch(g)}else if(d.key&&d.key!==o.key)g("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(d.version&&d.version!==o.AMap.version)g("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var U=[];if(d.plugins)for(M=0;M<d.plugins.length;M+=1)o.AMap.plugins.indexOf(d.plugins[M])==-1&&U.push(d.plugins[M]);L(function(){U.length?window.AMap.plugin(U,function(){c(d).then(function(){E(window.AMap)}).catch(g)}):c(d).then(function(){E(window.AMap)}).catch(g)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},w={AMap:F.notload,AMapUI:F.notload,Loca:F.notload},_={AMap:[],AMapUI:[],Loca:[]}}}})},64335:function(Te,c,n){"use strict";var i=n(67294),F=(0,i.createContext)({});c.Z=F},21349:function(Te,c,n){"use strict";var i=n(84305),F=n(69224),o=n(17781),w=n.n(o),_=n(67294),P=n(94184),L=n.n(P),d=n(64335),E=function(k){var M=(0,_.useContext)(d.Z),j=k.children,U=k.contentWidth,I=k.className,O=k.style,D=(0,_.useContext)(F.ZP.ConfigContext),R=D.getPrefixCls,y=k.prefixCls||R("pro"),v=U||M.contentWidth,h="".concat(y,"-grid-content");return _.createElement("div",{className:L()(h,I,{wide:v==="Fixed"}),style:O},_.createElement("div",{className:"".concat(y,"-grid-content-children")},j))};c.Z=E},46343:function(Te,c,n){"use strict";n.r(c),n.d(c,{AsyncParallelHook:function(){return le},SyncBailHook:function(){return Ne},SyncHook:function(){return H},SyncWaterfallHook:function(){return pe}});var i=n(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function F(Re,he,se,J){function fe(me){return me instanceof se?me:new se(function(Le){Le(me)})}return new(se||(se=Promise))(function(me,Le){function C(Ae){try{de(J.next(Ae))}catch(De){Le(De)}}function X(Ae){try{de(J.throw(Ae))}catch(De){Le(De)}}function de(Ae){Ae.done?me(Ae.value):fe(Ae.value).then(C,X)}de((J=J.apply(Re,he||[])).next())})}function o(Re,he){var se={label:0,sent:function(){if(me[0]&1)throw me[1];return me[1]},trys:[],ops:[]},J,fe,me,Le;return Le={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(Le[Symbol.iterator]=function(){return this}),Le;function C(de){return function(Ae){return X([de,Ae])}}function X(de){if(J)throw new TypeError("Generator is already executing.");for(;se;)try{if(J=1,fe&&(me=de[0]&2?fe.return:de[0]?fe.throw||((me=fe.return)&&me.call(fe),0):fe.next)&&!(me=me.call(fe,de[1])).done)return me;switch(fe=0,me&&(de=[de[0]&2,me.value]),de[0]){case 0:case 1:me=de;break;case 4:return se.label++,{value:de[1],done:!1};case 5:se.label++,fe=de[1],de=[0];continue;case 7:de=se.ops.pop(),se.trys.pop();continue;default:if(me=se.trys,!(me=me.length>0&&me[me.length-1])&&(de[0]===6||de[0]===2)){se=0;continue}if(de[0]===3&&(!me||de[1]>me[0]&&de[1]<me[3])){se.label=de[1];break}if(de[0]===6&&se.label<me[1]){se.label=me[1],me=de;break}if(me&&se.label<me[2]){se.label=me[2],se.ops.push(de);break}me[2]&&se.ops.pop(),se.trys.pop();continue}de=he.call(Re,se)}catch(Ae){de=[6,Ae],fe=0}finally{J=me=0}if(de[0]&5)throw de[1];return{value:de[0]?de[1]:void 0,done:!0}}}function w(Re,he){var se=typeof Symbol=="function"&&Re[Symbol.iterator];if(!se)return Re;var J=se.call(Re),fe,me=[],Le;try{for(;(he===void 0||he-- >0)&&!(fe=J.next()).done;)me.push(fe.value)}catch(C){Le={error:C}}finally{try{fe&&!fe.done&&(se=J.return)&&se.call(J)}finally{if(Le)throw Le.error}}return me}function _(){for(var Re=[],he=0;he<arguments.length;he++)Re=Re.concat(w(arguments[he]));return Re}function P(Re){return Re&&Re.__esModule&&Object.prototype.hasOwnProperty.call(Re,"default")?Re.default:Re}function L(Re,he){return he={exports:{}},Re(he,he.exports),he.exports}var d=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=se;function se(J){return J&&typeof J.length=="number"&&J.length>=0&&J.length%1==0}Re.exports=he.default});P(d);var E=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=function(se){return function(){for(var J=[],fe=arguments.length;fe--;)J[fe]=arguments[fe];var me=J.pop();return se.call(this,J,me)}},Re.exports=he.default});P(E);var g=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.fallback=fe,he.wrap=me;var se=he.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,J=he.hasNextTick=typeof i=="object"&&typeof i.nextTick=="function";function fe(C){setTimeout(C,0)}function me(C){return function(X){for(var de=[],Ae=arguments.length-1;Ae-- >0;)de[Ae]=arguments[Ae+1];return C(function(){return X.apply(void 0,de)})}}var Le;se?Le=setImmediate:J?Le=i.nextTick:Le=fe,he.default=me(Le)});P(g);var k=g.fallback,M=g.wrap,j=g.hasSetImmediate,U=g.hasNextTick,I=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=me;var se=fe(E),J=fe(g);function fe(X){return X&&X.__esModule?X:{default:X}}function me(X){return(0,O.isAsync)(X)?function(){for(var de=[],Ae=arguments.length;Ae--;)de[Ae]=arguments[Ae];var De=de.pop(),Ge=X.apply(this,de);return Le(Ge,De)}:(0,se.default)(function(de,Ae){var De;try{De=X.apply(this,de)}catch(Ge){return Ae(Ge)}if(De&&typeof De.then=="function")return Le(De,Ae);Ae(null,De)})}function Le(X,de){return X.then(function(Ae){C(de,null,Ae)},function(Ae){C(de,Ae&&Ae.message?Ae:new Error(Ae))})}function C(X,de,Ae){try{X(de,Ae)}catch(De){(0,J.default)(function(Ge){throw Ge},De)}}Re.exports=he.default});P(I);var O=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.isAsyncIterable=he.isAsyncGenerator=he.isAsync=void 0;var se=J(I);function J(X){return X&&X.__esModule?X:{default:X}}function fe(X){return X[Symbol.toStringTag]==="AsyncFunction"}function me(X){return X[Symbol.toStringTag]==="AsyncGenerator"}function Le(X){return typeof X[Symbol.asyncIterator]=="function"}function C(X){if(typeof X!="function")throw new Error("expected a function");return fe(X)?(0,se.default)(X):X}he.default=C,he.isAsync=fe,he.isAsyncGenerator=me,he.isAsyncIterable=Le});P(O);var D=O.isAsyncIterable,R=O.isAsyncGenerator,y=O.isAsync,v=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=se;function se(J,fe){if(fe===void 0&&(fe=J.length),!fe)throw new Error("arity is undefined");function me(){for(var Le=this,C=[],X=arguments.length;X--;)C[X]=arguments[X];return typeof C[fe-1]=="function"?J.apply(this,C):new Promise(function(de,Ae){C[fe-1]=function(De){for(var Ge=[],$e=arguments.length-1;$e-- >0;)Ge[$e]=arguments[$e+1];if(De)return Ae(De);de(Ge.length>1?Ge:Ge[0])},J.apply(Le,C)})}return Object.defineProperty(me,"name",{configurable:!0,value:"awaitable("+J.name+")"}),me}Re.exports=he.default});P(v);var h=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=me(d),J=me(O),fe=me(v);function me(Le){return Le&&Le.__esModule?Le:{default:Le}}he.default=(0,fe.default)(function(Le,C,X){var de=(0,se.default)(C)?[]:{};Le(C,function(Ae,De,Ge){(0,J.default)(Ae)(function($e){for(var ct,gt=[],st=arguments.length-1;st-- >0;)gt[st]=arguments[st+1];gt.length<2&&(ct=gt,gt=ct[0]),de[De]=gt,Ge($e)})},function(Ae){return X(Ae,de)})},3),Re.exports=he.default});P(h);var S=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=se;function se(J){function fe(){for(var me=[],Le=arguments.length;Le--;)me[Le]=arguments[Le];if(J!==null){var C=J;J=null,C.apply(this,me)}}return Object.assign(fe,J),fe}Re.exports=he.default});P(S);var A=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=function(se){return se[Symbol.iterator]&&se[Symbol.iterator]()},Re.exports=he.default});P(A);var x=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=X;var se=fe(d),J=fe(A);function fe(de){return de&&de.__esModule?de:{default:de}}function me(de){var Ae=-1,De=de.length;return function(){return++Ae<De?{value:de[Ae],key:Ae}:null}}function Le(de){var Ae=-1;return function(){var Ge=de.next();return Ge.done?null:(Ae++,{value:Ge.value,key:Ae})}}function C(de){var Ae=de?Object.keys(de):[],De=-1,Ge=Ae.length;return function(){var ct=Ae[++De];return De<Ge?{value:de[ct],key:ct}:null}}function X(de){if((0,se.default)(de))return me(de);var Ae=(0,J.default)(de);return Ae?Le(Ae):C(de)}Re.exports=he.default});P(x);var z=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=se;function se(J){return function(){for(var fe=[],me=arguments.length;me--;)fe[me]=arguments[me];if(J===null)throw new Error("Callback was already called.");var Le=J;J=null,Le.apply(this,fe)}}Re.exports=he.default});P(z);var B=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se={};he.default=se,Re.exports=he.default});P(B);var V=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=fe;var se=J(B);function J(me){return me&&me.__esModule?me:{default:me}}function fe(me,Le,C,X){var de=!1,Ae=!1,De=!1,Ge=0,$e=0;function ct(){Ge>=Le||De||de||(De=!0,me.next().then(function(xe){var Mt=xe.value,Ut=xe.done;if(!(Ae||de)){if(De=!1,Ut){de=!0,Ge<=0&&X(null);return}Ge++,C(Mt,$e,gt),$e++,ct()}}).catch(st))}function gt(xe,Mt){if(Ge-=1,!Ae){if(xe)return st(xe);if(xe===!1){de=!0,Ae=!0;return}if(Mt===se.default||de&&Ge<=0)return de=!0,X(null);ct()}}function st(xe){Ae||(De=!1,de=!0,X(xe))}ct()}Re.exports=he.default});P(V);var Q=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=C(S),J=C(x),fe=C(z),me=C(V),Le=C(B);function C(X){return X&&X.__esModule?X:{default:X}}he.default=function(X){return function(de,Ae,De){if(De=(0,se.default)(De),X<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!de)return De(null);if((0,O.isAsyncGenerator)(de))return(0,me.default)(de,X,Ae,De);if((0,O.isAsyncIterable)(de))return(0,me.default)(de[Symbol.asyncIterator](),X,Ae,De);var Ge=(0,J.default)(de),$e=!1,ct=!1,gt=0,st=!1;function xe(Ut,At){if(!ct)if(gt-=1,Ut)$e=!0,De(Ut);else if(Ut===!1)$e=!0,ct=!0;else{if(At===Le.default||$e&&gt<=0)return $e=!0,De(null);st||Mt()}}function Mt(){for(st=!0;gt<X&&!$e;){var Ut=Ge();if(Ut===null){$e=!0,gt<=0&&De(null);return}gt+=1,Ae(Ut.value,Ut.key,(0,fe.default)(xe))}st=!1}Mt()}},Re.exports=he.default});P(Q);var oe=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=me(Q),J=me(O),fe=me(v);function me(C){return C&&C.__esModule?C:{default:C}}function Le(C,X,de,Ae){return(0,se.default)(X)(C,(0,J.default)(de),Ae)}he.default=(0,fe.default)(Le,4),Re.exports=he.default});P(oe);var re=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=fe(oe),J=fe(v);function fe(Le){return Le&&Le.__esModule?Le:{default:Le}}function me(Le,C,X){return(0,se.default)(Le,1,C,X)}he.default=(0,J.default)(me,3),Re.exports=he.default});P(re);var Z=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=me;var se=fe(h),J=fe(re);function fe(Le){return Le&&Le.__esModule?Le:{default:Le}}function me(Le,C){return(0,se.default)(J.default,Le,C)}Re.exports=he.default}),ee=P(Z),H=function(){function Re(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];this.args=[],this.tasks=[]}return Re.prototype.call=function(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];return this.args=se,ee(this.tasks)},Re.prototype.tap=function(he,se){var J=this;this.tasks.push(function(fe){se.apply(void 0,_(J.args)),fe(null,he)})},Re}(),ae=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=de(d),J=de(B),fe=de(oe),me=de(S),Le=de(z),C=de(O),X=de(v);function de($e){return $e&&$e.__esModule?$e:{default:$e}}function Ae($e,ct,gt){gt=(0,me.default)(gt);var st=0,xe=0,Mt=$e.length,Ut=!1;Mt===0&&gt(null);function At(nt,it){nt===!1&&(Ut=!0),Ut!==!0&&(nt?gt(nt):(++xe===Mt||it===J.default)&&gt(null))}for(;st<Mt;st++)ct($e[st],st,(0,Le.default)(At))}function De($e,ct,gt){return(0,fe.default)($e,Infinity,ct,gt)}function Ge($e,ct,gt){var st=(0,se.default)($e)?Ae:De;return st($e,(0,C.default)(ct),gt)}he.default=(0,X.default)(Ge,3),Re.exports=he.default});P(ae);var G=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0}),he.default=me;var se=fe(ae),J=fe(h);function fe(Le){return Le&&Le.__esModule?Le:{default:Le}}function me(Le,C){return(0,J.default)(se.default,Le,C)}Re.exports=he.default}),ie=P(G),le=function(){function Re(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];this.tasks=[]}return Re.prototype.promise=function(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];return ie(this.tasks)},Re.prototype.tapPromise=function(he,se){var J=this;this.tasks.push(function(fe){return F(J,void 0,void 0,function(){return o(this,function(me){switch(me.label){case 0:return[4,se()];case 1:return me.sent(),fe(null,he),[2]}})})})},Re}(),Me=L(function(Re,he){Object.defineProperty(he,"__esModule",{value:!0});var se=Le(S),J=Le(z),fe=Le(O),me=Le(v);function Le(X){return X&&X.__esModule?X:{default:X}}function C(X,de){if(de=(0,se.default)(de),!Array.isArray(X))return de(new Error("First argument to waterfall must be an array of functions"));if(!X.length)return de();var Ae=0;function De($e){var ct=(0,fe.default)(X[Ae++]);ct.apply(void 0,$e.concat([(0,J.default)(Ge)]))}function Ge($e){for(var ct=[],gt=arguments.length-1;gt-- >0;)ct[gt]=arguments[gt+1];if($e!==!1){if($e||Ae===X.length)return de.apply(void 0,[$e].concat(ct));De(ct)}}De([])}he.default=(0,me.default)(C),Re.exports=he.default}),ge=P(Me),pe=function(){function Re(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];this.tasks=[]}return Re.prototype.call=function(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];return ge(this.tasks)},Re.prototype.tap=function(he,se){this.tasks.length===0?this.tasks.push(function(J){var fe=se();J(fe?null:!1,fe)}):this.tasks.push(function(J,fe){var me=se();fe(me?null:!1,he)})},Re}(),Ne=function(){function Re(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];this.tasks=[]}return Re.prototype.call=function(){for(var he=arguments,se=[],J=0;J<arguments.length;J++)se[J]=he[J];return ee(this.tasks)},Re.prototype.tap=function(he,se){this.tasks.push(function(J){var fe=se();J(fe,he)})},Re}()},48191:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.PositionType=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=n(82887),k=n(26729);function M(y,v){var h=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);v&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(y,A).enumerable})),h.push.apply(h,S)}return h}function j(y){for(var v=1;v<arguments.length;v++){var h=arguments[v]!=null?arguments[v]:{};v%2?M(Object(h),!0).forEach(function(S){(0,d.default)(y,S,h[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(h)):M(Object(h)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(h,S))})}return y}function U(y){var v=I();return function(){var S=(0,L.default)(y),A;if(v){var x=(0,L.default)(this).constructor;A=Reflect.construct(S,arguments,x)}else A=S.apply(this,arguments);return(0,P.default)(this,A)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}var O;c.PositionType=O,function(y){y.TOPRIGHT="topright",y.TOPLEFT="topleft",y.BOTTOMRIGHT="bottomright",y.BOTTOMLEFT="bottomleft"}(O||(c.PositionType=O={}));var D=0,R=function(y){(0,_.default)(h,y);var v=U(h);function h(S){var A;return(0,F.default)(this,h),A=v.call(this),(0,d.default)((0,w.default)(A),"controlOption",void 0),(0,d.default)((0,w.default)(A),"container",void 0),(0,d.default)((0,w.default)(A),"sceneContainer",void 0),(0,d.default)((0,w.default)(A),"mapsService",void 0),(0,d.default)((0,w.default)(A),"renderService",void 0),(0,d.default)((0,w.default)(A),"layerService",void 0),(0,d.default)((0,w.default)(A),"controlService",void 0),(0,d.default)((0,w.default)(A),"isShow",void 0),A.controlOption=j(j({},A.getDefault()),S||{}),A}return(0,o.default)(h,[{key:"getDefault",value:function(){return{position:O.TOPRIGHT,name:"".concat(D++)}}},{key:"setPosition",value:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",x=this.controlService;return x&&x.removeControl(this),this.controlOption.position=A,x&&x.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(A){this.mapsService=A.get(E.TYPES.IMapService),this.renderService=A.get(E.TYPES.IRendererService),this.layerService=A.get(E.TYPES.ILayerService),this.controlService=A.get(E.TYPES.IControlService),this.sceneContainer=A,this.isShow=!0,this.container=this.onAdd();var x=this.container,z=this.controlOption.position,B=this.controlService.controlCorners[z];return g.DOM.addClass(x,"l7-control"),z.indexOf("bottom")!==-1?B.insertBefore(x,B.firstChild):B.appendChild(x),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var A=this.container;g.DOM.addClass(A,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var A=this.container;g.DOM.removeClass(A,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;g.DOM.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(A){if(this.mapsService&&A&&A.screenX>0&&A.screenY>0){var x=this.mapsService.getContainer();x!==null&&x.focus()}}}]),h}(k.EventEmitter);c.default=R},95547:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=n(82887),k=i(n(48191));function M(I){var O=j();return function(){var R=(0,L.default)(I),y;if(O){var v=(0,L.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,P.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=function(I){(0,_.default)(D,I);var O=M(D);function D(R){var y;return(0,F.default)(this,D),y=O.call(this,R),(0,d.default)((0,w.default)(y),"layerControlInputs",void 0),(0,d.default)((0,w.default)(y),"layers",void 0),(0,d.default)((0,w.default)(y),"lastZIndex",void 0),(0,d.default)((0,w.default)(y),"handlingClick",void 0),(0,d.default)((0,w.default)(y),"layersLink",void 0),(0,d.default)((0,w.default)(y),"baseLayersList",void 0),(0,d.default)((0,w.default)(y),"separator",void 0),(0,d.default)((0,w.default)(y),"overlaysList",void 0),(0,d.default)((0,w.default)(y),"form",void 0),y.layerControlInputs=[],y.layers=[],y.lastZIndex=0,y.handlingClick=!1,y.initLayers(),(0,g.bindAll)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,w.default)(y)),y}return(0,o.default)(D,[{key:"getDefault",value:function(){return{collapsed:!0,position:E.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var y=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(v){v.layer.on("remove",y.onLayerChange),v.layer.on("add",y.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(y,v){return this.addLayer(y,v,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var y=this.renderService.getViewportSize(),v=y.height;g.DOM.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var h=v-(this.container.offsetTop+50);return h<this.form.clientHeight?(g.DOM.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=h+"px"):g.DOM.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return g.DOM.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var y=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(v){v.layer.off("remove",y.onLayerChange),v.layer.off("add",y.onLayerChange)}))}},{key:"initLayout",value:function(){var y="l7-control-layers",v=this.container=g.DOM.create("div",y),h=this.controlOption.collapsed;v.setAttribute("aria-haspopup","true");var S=this.form=g.DOM.create("form",y+"-list");h&&(this.mapsService.on("click",this.collapse),v.addEventListener("mouseenter",this.expand),v.addEventListener("mouseleave",this.collapse)),this.layersLink=g.DOM.create("a",y+"-toggle",v);var A=this.layersLink;A.title="Layers",h||this.expand(),this.baseLayersList=g.DOM.create("div",y+"-base",S),this.separator=g.DOM.create("div",y+"-separator",S),this.overlaysList=g.DOM.create("div",y+"-overlays",S),v.appendChild(S)}},{key:"initLayers",value:function(){var y=this,v=this.controlOption,h=v.baseLayers,S=h===void 0?{}:h,A=v.overlayers,x=A===void 0?{}:A;Object.keys(S).forEach(function(z,B){y.addLayer(S[z],z,!1)}),Object.keys(x).forEach(function(z,B){y.addLayer(x[z],z,!0)})}},{key:"update",value:function(){if(!this.container)return this;g.DOM.empty(this.baseLayersList),g.DOM.empty(this.overlaysList),this.layerControlInputs=[];var y,v,h,S,A=0;for(h=0;h<this.layers.length;h++)S=this.layers[h],this.addItem(S),v=v||S.overlay,y=y||!S.overlay,A+=S.overlay?0:1;return this.controlOption.hideSingleBase&&(y=y&&A>1,this.baseLayersList.style.display=y?"":"none"),this.separator.style.display=v&&y?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var y=this.layerControlInputs,v,h,S=this.mapsService.getZoom(),A=y.length-1;A>=0;A--)if(v=y[A],h=this.layerService.getLayer(v.layerId),h&&h.inited){var x=h.getMinZoom(),z=h.getMaxZoom();v.disabled=S<x||S>z}}},{key:"addLayer",value:function(y,v,h){this.mapsService&&(y.on("add",this.onLayerChange),y.on("remove",this.onLayerChange)),this.layers.push({layer:y,name:v,overlay:h});var S=this.controlOption,A=S.sortLayers,x=S.sortFunction,z=S.autoZIndex;A&&this.layers.sort(function(B,V){return x(B.layer,V.layer,B.name,V.name)}),z&&y.setZIndex&&(this.lastZIndex++,y.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(y){this.handlingClick||this.update();var v=this.layerService.getLayer(y.target.layerId),h=v!=null&&v.overlay?y.type==="add"?"overlayadd":"overlayremove":y.type==="add"?"baselayerchange":null;h&&this.emit(h,v)}},{key:"createRadioElement",value:function(y,v){var h='<input type="radio" class="l7-control-layers-selector" name="'+y+'"'+(v?' checked="checked"':"")+"/>",S=document.createElement("div");return S.innerHTML=h,S.firstChild}},{key:"addItem",value:function(y){var v=document.createElement("label"),h=this.layerService.getLayer(y.layer.id),S=h&&h.inited&&y.layer.isVisible(),A;y.overlay?(A=document.createElement("input"),A.type="checkbox",A.className="l7-control-layers-selector",A.defaultChecked=S):A=this.createRadioElement("l7-base-layers",S),this.layerControlInputs.push(A),A.layerId=y.layer.id,A.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+y.name;var z=document.createElement("div");v.appendChild(z),z.appendChild(A),z.appendChild(x);var B=y.overlay?this.overlaysList:this.baseLayersList;return B.appendChild(v),this.checkDisabledLayers(),v}},{key:"onInputClick",value:function(){var y=this.layerControlInputs,v,h,S=[],A=[];this.handlingClick=!0;for(var x=y.length-1;x>=0;x--)v=y[x],h=this.layerService.getLayer(v.layerId),v.checked?S.push(h):v.checked||A.push(h);A.forEach(function(z){z.hide()}),S.forEach(function(z){z.show()}),this.handlingClick=!1}}]),D}(k.default);c.default=U},99119:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(2205)),P=F(n(78585)),L=F(n(29754)),d=n(82887),E=i(n(48191));function g(j){var U=k();return function(){var O=(0,L.default)(j),D;if(U){var R=(0,L.default)(this).constructor;D=Reflect.construct(O,arguments,R)}else D=O.apply(this,arguments);return(0,P.default)(this,D)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var M=function(j){(0,_.default)(I,j);var U=g(I);function I(){return(0,o.default)(this,I),U.apply(this,arguments)}return(0,w.default)(I,[{key:"getDefault",value:function(){return{position:E.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var D="l7-control-logo",R=d.DOM.create("div",D),y=d.DOM.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),R.appendChild(y),R}},{key:"onRemove",value:function(){return null}}]),I}(E.default);c.default=M},99828:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(81506)),P=F(n(2205)),L=F(n(78585)),d=F(n(29754)),E=F(n(59713)),g=n(82887),k=i(n(48191));function M(I){var O=j();return function(){var R=(0,d.default)(I),y;if(O){var v=(0,d.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,L.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=function(I){(0,P.default)(D,I);var O=M(D);function D(R){var y;return(0,o.default)(this,D),y=O.call(this,R),(0,E.default)((0,_.default)(y),"mScale",void 0),(0,E.default)((0,_.default)(y),"iScale",void 0),(0,g.bindAll)(["update"],(0,_.default)(y)),y}return(0,w.default)(D,[{key:"getDefault",value:function(){return{position:k.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var y="l7-control-scale",v=g.DOM.create("div",y);this.addScales(y+"-line",v);var h=this.controlOption.updateWhenIdle;return this.mapsService.on(h?"moveend":"mapmove",this.update),this.mapsService.on(h?"zoomend":"zoomchange",this.update),this.update(),v}},{key:"onRemove",value:function(){var y=this.controlOption.updateWhenIdle;this.mapsService.off(y?"zoomend":"zoomchange",this.update),this.mapsService.off(y?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var y=this.mapsService,v=this.controlOption.maxWidth,h=y.getSize()[1]/2,S=y.containerToLngLat([0,h]),A=y.containerToLngLat([v,h]),x=(0,g.lnglatDistance)([S.lng,S.lat],[A.lng,A.lat]);this.updateScales(x)}},{key:"updateScales",value:function(y){var v=this.controlOption,h=v.metric,S=v.imperial;h&&y&&this.updateMetric(y),S&&y&&this.updateImperial(y)}},{key:"updateMetric",value:function(y){var v=this.getRoundNum(y),h=v<1e3?v+" m":v/1e3+" km";this.updateScale(this.mScale,h,v/y)}},{key:"updateImperial",value:function(y){var v=y*3.2808399,h,S,A;v>5280?(h=v/5280,S=this.getRoundNum(h),this.updateScale(this.iScale,S+" mi",S/h)):(A=this.getRoundNum(v),this.updateScale(this.iScale,A+" ft",A/v))}},{key:"updateScale",value:function(y,v,h){var S=this.controlOption.maxWidth;y.style.width=Math.round(S*h)+"px",y.innerHTML=v}},{key:"getRoundNum",value:function(y){var v=Math.pow(10,(Math.floor(y)+"").length-1),h=y/v;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:1,v*h}},{key:"addScales",value:function(y,v){var h=this.controlOption,S=h.metric,A=h.imperial;S&&(this.mScale=g.DOM.create("div",y,v)),A&&(this.iScale=g.DOM.create("div",y,v))}}]),D}(k.default);c.default=U},289:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(81506)),P=F(n(2205)),L=F(n(78585)),d=F(n(29754)),E=F(n(59713)),g=n(82887),k=i(n(48191));function M(I){var O=j();return function(){var R=(0,d.default)(I),y;if(O){var v=(0,d.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,L.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=function(I){(0,P.default)(D,I);var O=M(D);function D(R){var y;return(0,o.default)(this,D),y=O.call(this,R),(0,E.default)((0,_.default)(y),"disabled",void 0),(0,E.default)((0,_.default)(y),"zoomInButton",void 0),(0,E.default)((0,_.default)(y),"zoomOutButton",void 0),(0,g.bindAll)(["updateDisabled","zoomIn","zoomOut"],(0,_.default)(y)),y}return(0,w.default)(D,[{key:"getDefault",value:function(){return{position:k.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var y="l7-control-zoom",v=g.DOM.create("div",y+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,y+"-in",v,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,y+"-out",v,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),v}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(y,v,h,S,A){var x=g.DOM.create("a",h,S);return x.innerHTML=y,x.title=v,x.href="javascript:void(0)",x.addEventListener("click",A),x}},{key:"updateDisabled",value:function(){var y=this.mapsService,v="l7-disabled";g.DOM.removeClass(this.zoomInButton,v),g.DOM.removeClass(this.zoomOutButton,v),(this.disabled||y.getZoom()<=y.getMinZoom())&&g.DOM.addClass(this.zoomOutButton,v),(this.disabled||y.getZoom()>=y.getMaxZoom())&&g.DOM.addClass(this.zoomInButton,v)}}]),D}(k.default);c.default=U},58722:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"Control",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(c,"Layers",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"Logo",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(c,"Scale",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(c,"Zoom",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(c,"Marker",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(c,"MarkerLayer",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(c,"Popup",{enumerable:!0,get:function(){return E.default}});var F=i(n(48191)),o=i(n(95547)),w=i(n(99119)),_=i(n(99828)),P=i(n(289)),L=i(n(66803)),d=i(n(40695)),E=i(n(46076));function g(k,M){if(M||(M=document),!!M){var j=M.head||M.getElementsByTagName("head")[0];if(!j){j=M.createElement("head");var U=M.body||M.getElementsByTagName("body")[0];U?U.parentNode.insertBefore(j,U):M.documentElement.appendChild(j)}var I=M.createElement("style");return I.type="text/css",I.styleSheet?I.styleSheet.cssText=k:I.appendChild(M.createTextNode(k)),j.appendChild(I),I}}g(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`)},66803:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=n(82887),k=n(26729);function M(D,R){var y=Object.keys(D);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(D);R&&(v=v.filter(function(h){return Object.getOwnPropertyDescriptor(D,h).enumerable})),y.push.apply(y,v)}return y}function j(D){for(var R=1;R<arguments.length;R++){var y=arguments[R]!=null?arguments[R]:{};R%2?M(Object(y),!0).forEach(function(v){(0,d.default)(D,v,y[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(y)):M(Object(y)).forEach(function(v){Object.defineProperty(D,v,Object.getOwnPropertyDescriptor(y,v))})}return D}function U(D){var R=I();return function(){var v=(0,L.default)(D),h;if(R){var S=(0,L.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,P.default)(this,h)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var O=function(D){(0,_.default)(y,D);var R=U(y);function y(v){var h;return(0,F.default)(this,y),h=R.call(this),(0,d.default)((0,w.default)(h),"markerOption",void 0),(0,d.default)((0,w.default)(h),"defaultMarker",void 0),(0,d.default)((0,w.default)(h),"popup",void 0),(0,d.default)((0,w.default)(h),"mapsService",void 0),(0,d.default)((0,w.default)(h),"sceneSerive",void 0),(0,d.default)((0,w.default)(h),"lngLat",void 0),(0,d.default)((0,w.default)(h),"scene",void 0),(0,d.default)((0,w.default)(h),"added",!1),(0,d.default)((0,w.default)(h),"eventHandle",function(S){h.emit(S.type,{target:S,data:h.markerOption.extData,lngLat:h.lngLat})}),h.markerOption=j(j({},h.getDefault()),v),(0,g.bindAll)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,w.default)(h)),h.init(),h}return(0,o.default)(y,[{key:"getDefault",value:function(){return{element:void 0,anchor:g.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(h){this.scene=h,this.mapsService=h.get(E.TYPES.IMapService),this.sceneSerive=h.get(E.TYPES.ISceneService);var S=this.markerOption,A=S.element,x=S.draggable;return this.mapsService.getMarkerContainer().appendChild(A),this.registerMarkerEvent(A),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var h=this.markerOption.element;return h&&g.DOM.remove(h),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(h){return this.lngLat=h,Array.isArray(h)&&(this.lngLat={lng:h[0],lat:h[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(h){var S=this;if(!this.added)return this.once("added",function(){S.setElement(h)}),this;var A=this.markerOption.element;return A&&g.DOM.remove(A),this.markerOption.element=h,this.init(),this.mapsService.getMarkerContainer().appendChild(h),this.registerMarkerEvent(h),this.update(),this}},{key:"openPopup",value:function(){var h=this;if(!this.added)return this.once("added",function(){h.openPopup()}),this;var S=this.popup;return S?(S.isOpen()||S.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var h=this;this.added||this.once("added",function(){h.closePopup()});var S=this.popup;return S&&S.remove(),this}},{key:"setPopup",value:function(h){return this.popup=h,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var h=this.popup;if(h)h.isOpen()?h.remove():h.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(h){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(h){this.markerOption.extData=h}},{key:"update",value:function(){if(!!this.mapsService){var h=this.markerOption,S=h.element,A=h.anchor;this.updatePosition(),g.DOM.setTransform(S,"".concat(g.anchorTranslate[A]))}}},{key:"onMapClick",value:function(h){var S=this.markerOption.element;this.popup&&S&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var h=this.markerOption,S=h.element,A=h.offsets,x=this.lngLat,z=x.lng,B=x.lat,V=this.mapsService.getBounds(),Q=this.mapsService.lngLatToContainer([z,B]);if(S){S.style.display="block";var oe=this.mapsService.getContainer(),re=0,Z=0;if(oe&&(re=oe.scrollWidth,Z=oe.scrollHeight),Math.abs(V[0][0])>180||Math.abs(V[1][0])>180){if(Q.x>re){var ee=this.mapsService.lngLatToContainer([z-360,B]);Q.x=ee.x}if(Q.x<0){var H=this.mapsService.lngLatToContainer([z+360,B]);Q.x=H.x}}(Q.x>re||Q.x<0||Q.y>Z||Q.y<0)&&(S.style.display="none"),S.style.left=Q.x+A[0]+"px",S.style.top=Q.y-A[1]+"px"}}}},{key:"init",value:function(){var h=this,S=this.markerOption.element,A=this.markerOption,x=A.color,z=A.anchor;if(!S){this.defaultMarker=!0,S=g.DOM.create("div"),this.markerOption.element=S;var B=document.createElementNS("http://www.w3.org/2000/svg","svg");B.setAttributeNS(null,"display","block"),B.setAttributeNS(null,"height","48px"),B.setAttributeNS(null,"width","48px"),B.setAttributeNS(null,"viewBox","0 0 1024 1024");var V=document.createElementNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),V.setAttributeNS(null,"fill",x),B.appendChild(V),S.appendChild(B)}g.DOM.addClass(S,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(Q){var oe,re,Z=((oe=h.markerOption)===null||oe===void 0?void 0:oe.style)&&((re=h.markerOption)===null||re===void 0?void 0:re.style[Q]);S&&(S.style[Q]=Z)}),S.addEventListener("click",function(Q){h.onMapClick(Q)}),S.addEventListener("click",this.eventHandle),(0,g.applyAnchorClass)(S,z,"marker")}},{key:"registerMarkerEvent",value:function(h){h.addEventListener("mousemove",this.eventHandle),h.addEventListener("click",this.eventHandle),h.addEventListener("mousedown",this.eventHandle),h.addEventListener("mouseup",this.eventHandle),h.addEventListener("dblclick",this.eventHandle),h.addEventListener("contextmenu",this.eventHandle),h.addEventListener("mouseover",this.eventHandle),h.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var h=this.getElement();h.removeEventListener("mousemove",this.eventHandle),h.removeEventListener("click",this.eventHandle),h.removeEventListener("mousedown",this.eventHandle),h.removeEventListener("mouseup",this.eventHandle),h.removeEventListener("dblclick",this.eventHandle),h.removeEventListener("contextmenu",this.eventHandle),h.removeEventListener("mouseover",this.eventHandle),h.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(h){throw new Error("Method not implemented.")}},{key:"onUp",value:function(h){throw new Error("Method not implemented.")}}]),y}(k.EventEmitter);c.default=O},40695:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(82492)),g=n(5602),k=n(82887),M=n(26729),j=i(n(69848)),U=i(n(66803));function I(v,h){var S=Object.keys(v);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(v);h&&(A=A.filter(function(x){return Object.getOwnPropertyDescriptor(v,x).enumerable})),S.push.apply(S,A)}return S}function O(v){for(var h=1;h<arguments.length;h++){var S=arguments[h]!=null?arguments[h]:{};h%2?I(Object(S),!0).forEach(function(A){(0,d.default)(v,A,S[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(S)):I(Object(S)).forEach(function(A){Object.defineProperty(v,A,Object.getOwnPropertyDescriptor(S,A))})}return v}function D(v){var h=R();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var y=function(v){(0,_.default)(S,v);var h=D(S);function S(A){var x,z;return(0,F.default)(this,S),z=h.call(this),(0,d.default)((0,w.default)(z),"markers",[]),(0,d.default)((0,w.default)(z),"markerLayerOption",void 0),(0,d.default)((0,w.default)(z),"clusterIndex",void 0),(0,d.default)((0,w.default)(z),"points",[]),(0,d.default)((0,w.default)(z),"clusterMarkers",[]),(0,d.default)((0,w.default)(z),"mapsService",void 0),(0,d.default)((0,w.default)(z),"scene",void 0),(0,d.default)((0,w.default)(z),"zoom",void 0),(0,d.default)((0,w.default)(z),"bbox",void 0),z.markerLayerOption=(0,E.default)(z.getDefault(),A),(0,k.bindAll)(["update"],(0,w.default)(z)),z.zoom=((x=z.markerLayerOption.clusterOption)===null||x===void 0?void 0:x.zoom)||-99,z}return(0,o.default)(S,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(x){return this.scene=x,this.mapsService=x.get(g.TYPES.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(x){var z=this.markerLayerOption.cluster;z&&this.addPoint(x,this.markers.length),this.markers.push(x)}},{key:"removeMarker",value:function(x){this.markers.indexOf(x);var z=this.markers.indexOf(x);z>-1&&this.markers.splice(z,1)}},{key:"hide",value:function(){this.markers.map(function(x){x.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(x){x.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var x=this.markerLayerOption.cluster;return x?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var x=this;this.getMarkers().forEach(function(z){z.addTo(x.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(x){x.remove()}),this.clusterMarkers.forEach(function(x){x.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(x,z){var B=x.getLnglat(),V=B.lng,Q=B.lat,oe={geometry:{type:"Point",coordinates:[V,Q]},properties:O(O({},x.getExtData()),{},{marker_id:z})};this.points.push(oe)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var x=this.markerLayerOption.clusterOption,z=x.radius,B=x.minZoom,V=B===void 0?0:B,Q=x.maxZoom;this.clusterIndex=new j.default({radius:z,minZoom:V,maxZoom:Q}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(x,z){var B=this,V=x[0].concat(x[1]),Q=this.clusterIndex.getClusters(V,z);this.clusterMarkers.forEach(function(oe){oe.remove()}),this.clusterMarkers=[],Q.forEach(function(oe){var re,Z=B.markerLayerOption.clusterOption,ee=Z.field,H=Z.method;if(oe.properties&&(re=oe.properties)!==null&&re!==void 0&&re.cluster_id){var ae,G=B.getLeaves((ae=oe.properties)===null||ae===void 0?void 0:ae.cluster_id);if(oe.properties.clusterData=G,ee&&H){var ie=G==null?void 0:G.map(function(Ne){var Re=(0,d.default)({},ee,Ne.properties[ee]);return Re}),le=k.Satistics.getColumn(ie,ee),Me=k.Satistics.getSatByColumn(H,le),ge="point_"+H;oe.properties[ge]=Me.toFixed(2)}}var pe=B.clusterMarker(oe);B.clusterMarkers.push(pe),pe.addTo(B.scene)})}},{key:"getLeaves",value:function(x){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return x?this.clusterIndex.getLeaves(x,z,B):null}},{key:"clusterMarker",value:function(x){var z=this.markerLayerOption.clusterOption,B=z,V=B.element,Q=V===void 0?this.generateElement.bind(this):V,oe=new U.default({element:Q(x)}).setLnglat({lng:x.geometry.coordinates[0],lat:x.geometry.coordinates[1]});return oe}},{key:"normalMarker",value:function(x){var z=x.properties.marker_id;return this.markers[z]}},{key:"update",value:function(){var x=this.mapsService.getZoom(),z=this.mapsService.getBounds();(!this.bbox||Math.abs(x-this.zoom)>=1||!(0,k.boundsContains)(this.bbox,z))&&(this.bbox=(0,k.padBounds)(z,.5),this.zoom=Math.floor(x),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(x){var z=k.DOM.create("div","l7-marker-cluster"),B=k.DOM.create("div","",z),V=k.DOM.create("span","",B),Q=this.markerLayerOption.clusterOption,oe=Q.field,re=Q.method;x.properties.point_count=x.properties.point_count||1;var Z=oe&&re?x.properties["point_"+re]||x.properties[oe]:x.properties.point_count;return V.textContent=Z,z}}]),S}(M.EventEmitter);c.default=y},46076:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=n(82887),k=n(26729);function M(D,R){var y=Object.keys(D);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(D);R&&(v=v.filter(function(h){return Object.getOwnPropertyDescriptor(D,h).enumerable})),y.push.apply(y,v)}return y}function j(D){for(var R=1;R<arguments.length;R++){var y=arguments[R]!=null?arguments[R]:{};R%2?M(Object(y),!0).forEach(function(v){(0,d.default)(D,v,y[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(y)):M(Object(y)).forEach(function(v){Object.defineProperty(D,v,Object.getOwnPropertyDescriptor(y,v))})}return D}function U(D){var R=I();return function(){var v=(0,L.default)(D),h;if(R){var S=(0,L.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,P.default)(this,h)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var O=function(D){(0,_.default)(y,D);var R=U(y);function y(v){var h;return(0,F.default)(this,y),h=R.call(this),(0,d.default)((0,w.default)(h),"popupOption",void 0),(0,d.default)((0,w.default)(h),"mapsService",void 0),(0,d.default)((0,w.default)(h),"sceneSerive",void 0),(0,d.default)((0,w.default)(h),"lngLat",void 0),(0,d.default)((0,w.default)(h),"content",void 0),(0,d.default)((0,w.default)(h),"closeButton",void 0),(0,d.default)((0,w.default)(h),"timeoutInstance",void 0),(0,d.default)((0,w.default)(h),"container",void 0),(0,d.default)((0,w.default)(h),"tip",void 0),(0,d.default)((0,w.default)(h),"scene",void 0),h.popupOption=j(j({},h.getdefault()),v),(0,g.bindAll)(["update","onClickClose","remove"],(0,w.default)(h)),h}return(0,o.default)(y,[{key:"addTo",value:function(h){var S=this;return this.mapsService=h.get(E.TYPES.IMapService),this.sceneSerive=h.get(E.TYPES.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=h,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){S.mapsService.on("click",S.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(h){var S=window.document.createDocumentFragment(),A=window.document.createElement("body"),x;for(A.innerHTML=h;x=A.firstChild,!!x;)S.appendChild(x);return this.setDOMContent(S)}},{key:"setLnglat",value:function(h){return this.lngLat=h,Array.isArray(h)&&(this.lngLat={lng:h[0],lat:h[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(h){return this.setDOMContent(window.document.createTextNode(h))}},{key:"setMaxWidth",value:function(h){return this.popupOption.maxWidth=h,this.update(),this}},{key:"setDOMContent",value:function(h){return this.createContent(),this.content.appendChild(h),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&g.DOM.remove(this.content),this.content=g.DOM.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=g.DOM.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(h,S,A){var x=window.document.createElement(h);return S!==void 0&&(x.className=S),A&&A.appendChild(x),x}},{key:"removeDom",value:function(h){h.parentNode&&h.parentNode.removeChild(h)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:g.anchorType.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(h){h.stopPropagation&&h.stopPropagation(),this.remove()}},{key:"update",value:function(){var h=this,S=this.lngLat,A=this.popupOption,x=A.className,z=A.maxWidth,B=A.anchor;if(!(!this.mapsService||!S||!this.content)){var V=this.mapsService.getMarkerContainer();if(!this.container&&V){this.container=this.creatDom("div","l7-popup",V),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),x&&x.split(" ").forEach(function(oe){return h.container.classList.add(oe)});var Q=this.popupOption.stopPropagation;Q&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(oe){h.container.addEventListener(oe,function(re){re.stopPropagation()})})}z&&this.container.style.maxWidth!==z&&(this.container.style.maxWidth=z),this.updatePosition(),g.DOM.setTransform(this.container,"".concat(g.anchorTranslate[B])),(0,g.applyAnchorClass)(this.container,B,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var h=this.lngLat,S=h.lng,A=h.lat,x=this.popupOption.offsets,z=this.mapsService.lngLatToContainer([S,A]);this.container.style.left=z.x+x[0]+"px",this.container.style.top=z.y-x[1]+"px"}}}]),y}(k.EventEmitter);c.default=O},5602:function(Te,c,n){"use strict";var i=n(95318),F=n(20862);Object.defineProperty(c,"__esModule",{value:!0});var o={container:!0,createLayerContainer:!0,createSceneContainer:!0,lazyInject:!0,lazyMultiInject:!0,BasePostProcessingPass:!0,TYPES:!0,packCircleVertex:!0};Object.defineProperty(c,"container",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(c,"createLayerContainer",{enumerable:!0,get:function(){return w.createLayerContainer}}),Object.defineProperty(c,"createSceneContainer",{enumerable:!0,get:function(){return w.createSceneContainer}}),Object.defineProperty(c,"lazyInject",{enumerable:!0,get:function(){return w.lazyInject}}),Object.defineProperty(c,"lazyMultiInject",{enumerable:!0,get:function(){return w.lazyMultiInject}}),Object.defineProperty(c,"BasePostProcessingPass",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(c,"TYPES",{enumerable:!0,get:function(){return P.TYPES}}),Object.defineProperty(c,"packCircleVertex",{enumerable:!0,get:function(){return L.packCircleVertex}});var w=F(n(63170)),_=i(n(36770)),P=n(19403),L=n(4495),d=n(21214);Object.keys(d).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===d[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return d[G]}})});var E=n(69232);Object.keys(E).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===E[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return E[G]}})});var g=n(46770);Object.keys(g).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===g[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return g[G]}})});var k=n(28680);Object.keys(k).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===k[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return k[G]}})});var M=n(93739);Object.keys(M).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===M[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return M[G]}})});var j=n(68446);Object.keys(j).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===j[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return j[G]}})});var U=n(58105);Object.keys(U).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===U[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return U[G]}})});var I=n(9061);Object.keys(I).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===I[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return I[G]}})});var O=n(14989);Object.keys(O).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===O[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return O[G]}})});var D=n(8039);Object.keys(D).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===D[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return D[G]}})});var R=n(21447);Object.keys(R).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===R[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return R[G]}})});var y=n(57414);Object.keys(y).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===y[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return y[G]}})});var v=n(6074);Object.keys(v).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===v[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return v[G]}})});var h=n(58646);Object.keys(h).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===h[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return h[G]}})});var S=n(42818);Object.keys(S).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===S[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return S[G]}})});var A=n(77235);Object.keys(A).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===A[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return A[G]}})});var x=n(72227);Object.keys(x).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===x[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return x[G]}})});var z=n(92151);Object.keys(z).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===z[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return z[G]}})});var B=n(7751);Object.keys(B).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===B[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return B[G]}})});var V=n(84539);Object.keys(V).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===V[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return V[G]}})});var Q=n(33896);Object.keys(Q).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===Q[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return Q[G]}})});var oe=n(22328);Object.keys(oe).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===oe[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return oe[G]}})});var re=n(45857);Object.keys(re).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===re[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return re[G]}})});var Z=n(47759);Object.keys(Z).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===Z[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return Z[G]}})});var ee=n(82856);Object.keys(ee).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===ee[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return ee[G]}})});var H=n(18694);Object.keys(H).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===H[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return H[G]}})});var ae=n(7403);Object.keys(ae).forEach(function(G){G==="default"||G==="__esModule"||Object.prototype.hasOwnProperty.call(o,G)||G in c&&c[G]===ae[G]||Object.defineProperty(c,G,{enumerable:!0,get:function(){return ae[G]}})})},63170:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.createSceneContainer=pe,c.createLayerContainer=Ne,c.default=c.lazyMultiInject=c.lazyInject=void 0,n(28660);var F=n(26729),o=n(86700),w=i(n(84879)),_=n(19403),P=i(n(30753)),L=i(n(19071)),d=i(n(88047)),E=i(n(48494)),g=i(n(9159)),k=i(n(6070)),M=i(n(65044)),j=i(n(59204)),U=i(n(45265)),I=i(n(11503)),O=i(n(20233)),D=i(n(9868)),R=i(n(17768)),y=i(n(71002)),v=i(n(82978)),h=i(n(37911)),S=i(n(65528)),A=i(n(34945)),x=i(n(38800)),z=i(n(50797)),B=i(n(94358)),V=i(n(86751)),Q=i(n(46359)),oe=i(n(67754)),re=i(n(47100)),Z=i(n(97985)),ee=i(n(74916)),H=i(n(89431)),ae=new o.Container;ae.bind(_.TYPES.IGlobalConfigService).to(M.default).inSingletonScope(),ae.bind(_.TYPES.IShaderModuleService).to(y.default).inSingletonScope(),(0,o.decorate)((0,o.injectable)(),F.EventEmitter),ae.bind(_.TYPES.IEventEmitter).to(F.EventEmitter);var G=(0,w.default)(ae,!1),ie=function(he){var se=G.lazyInject(he);return function(J,fe,me){se.call(this,J,fe),me&&(me.initializer=function(){return J[fe]})}};c.lazyInject=ie;var le=function(he){var se=G.lazyMultiInject(he);return function(J,fe,me){se.call(this,J,fe),me&&(me.initializer=function(){return J[fe]})}};c.lazyMultiInject=le;var Me=ae;c.default=Me;var ge=0;function pe(){var Re=new o.Container;return Re.parent=ae,Re.bind(_.TYPES.SceneID).toConstantValue("".concat(ge++)),Re.bind(_.TYPES.ILayerService).to(O.default).inSingletonScope(),Re.bind(_.TYPES.ISceneService).to(R.default).inSingletonScope(),Re.bind(_.TYPES.ICameraService).to(d.default).inSingletonScope(),Re.bind(_.TYPES.ICoordinateSystemService).to(j.default).inSingletonScope(),Re.bind(_.TYPES.IInteractionService).to(U.default).inSingletonScope(),Re.bind(_.TYPES.IPickingService).to(I.default).inSingletonScope(),Re.bind(_.TYPES.IControlService).to(E.default).inSingletonScope(),Re.bind(_.TYPES.IMarkerService).to(g.default).inSingletonScope(),Re.bind(_.TYPES.IIconService).to(L.default).inSingletonScope(),Re.bind(_.TYPES.IFontService).to(P.default).inSingletonScope(),Re.bind(_.TYPES.IPopupService).to(k.default).inSingletonScope(),Re.bind(_.TYPES.INormalPass).to(v.default).whenTargetNamed("clear"),Re.bind(_.TYPES.INormalPass).to(S.default).whenTargetNamed("pixelPicking"),Re.bind(_.TYPES.INormalPass).to(ee.default).whenTargetNamed("render"),Re.bind(_.TYPES.INormalPass).to(H.default).whenTargetNamed("taa"),Re.bind(_.TYPES.IFactoryNormalPass).toFactory(function(he){return function(se){return he.container.getNamed(_.TYPES.INormalPass,se)}}),Re.bind(_.TYPES.IPostProcessingPass).to(B.default).whenTargetNamed("copy"),Re.bind(_.TYPES.IPostProcessingPass).to(A.default).whenTargetNamed("blurH"),Re.bind(_.TYPES.IPostProcessingPass).to(x.default).whenTargetNamed("blurV"),Re.bind(_.TYPES.IPostProcessingPass).to(oe.default).whenTargetNamed("noise"),Re.bind(_.TYPES.IPostProcessingPass).to(re.default).whenTargetNamed("sepia"),Re.bind(_.TYPES.IPostProcessingPass).to(z.default).whenTargetNamed("colorHalftone"),Re.bind(_.TYPES.IPostProcessingPass).to(V.default).whenTargetNamed("hexagonalPixelate"),Re.bind(_.TYPES.IPostProcessingPass).to(Q.default).whenTargetNamed("ink"),Re.bind(_.TYPES.IFactoryPostProcessingPass).toFactory(function(he){return function(se){var J=he.container.getNamed(_.TYPES.IPostProcessingPass,se);return J.setName(se),J}}),Re}function Ne(Re){var he=new o.Container;return he.parent=Re,he.bind(_.TYPES.IStyleAttributeService).to(D.default).inSingletonScope(),he.bind(_.TYPES.IMultiPassRenderer).to(h.default).inSingletonScope(),he.bind(_.TYPES.IPostProcessor).to(Z.default).inSingletonScope(),he}},30753:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.DEFAULT_RADIUS=c.DEFAULT_CUTOFF=c.DEFAULT_BUFFER=c.DEFAULT_FONT_SIZE=c.DEFAULT_FONT_WEIGHT=c.DEFAULT_FONT_FAMILY=c.DEFAULT_CHAR_SET=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(82887),P=i(n(49296)),L=n(86700);n(28660);var d=n(28955),E,g;function k(ee,H){var ae=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!ae){if(Array.isArray(ee)||(ae=M(ee))||H&&ee&&typeof ee.length=="number"){ae&&(ee=ae);var G=0,ie=function(){};return{s:ie,n:function(){return G>=ee.length?{done:!0}:{done:!1,value:ee[G++]}},e:function(Ne){throw Ne},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var le=!0,Me=!1,ge;return{s:function(){ae=ae.call(ee)},n:function(){var Ne=ae.next();return le=Ne.done,Ne},e:function(Ne){Me=!0,ge=Ne},f:function(){try{!le&&ae.return!=null&&ae.return()}finally{if(Me)throw ge}}}}function M(ee,H){if(!!ee){if(typeof ee=="string")return j(ee,H);var ae=Object.prototype.toString.call(ee).slice(8,-1);if(ae==="Object"&&ee.constructor&&(ae=ee.constructor.name),ae==="Map"||ae==="Set")return Array.from(ee);if(ae==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ae))return j(ee,H)}}function j(ee,H){(H==null||H>ee.length)&&(H=ee.length);for(var ae=0,G=new Array(H);ae<H;ae++)G[ae]=ee[ae];return G}function U(ee,H){var ae=Object.keys(ee);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(ee);H&&(G=G.filter(function(ie){return Object.getOwnPropertyDescriptor(ee,ie).enumerable})),ae.push.apply(ae,G)}return ae}function I(ee){for(var H=1;H<arguments.length;H++){var ae=arguments[H]!=null?arguments[H]:{};H%2?U(Object(ae),!0).forEach(function(G){(0,w.default)(ee,G,ae[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(ae)):U(Object(ae)).forEach(function(G){Object.defineProperty(ee,G,Object.getOwnPropertyDescriptor(ae,G))})}return ee}var O=Q();c.DEFAULT_CHAR_SET=O;var D="sans-serif";c.DEFAULT_FONT_FAMILY=D;var R="normal";c.DEFAULT_FONT_WEIGHT=R;var y=24;c.DEFAULT_FONT_SIZE=y;var v=3;c.DEFAULT_BUFFER=v;var h=.25;c.DEFAULT_CUTOFF=h;var S=8;c.DEFAULT_RADIUS=S;var A=1024,x=1,z=1,B=3,V=null;function Q(){for(var ee=[],H=32;H<128;H++)ee.push(String.fromCharCode(H));return ee}function oe(ee,H,ae,G){ee.font="".concat(G," ").concat(ae,"px ").concat(H),ee.fillStyle="black",ee.textBaseline="middle"}function re(ee,H){for(var ae=0;ae<ee.length;ae++)H.data[4*ae+3]=ee[ae]}var Z=(E=(0,L.injectable)(),E(g=function(){function ee(){(0,F.default)(this,ee),(0,w.default)(this,"fontAtlas",void 0),(0,w.default)(this,"iconFontMap",void 0),(0,w.default)(this,"iconFontGlyphs",{}),(0,w.default)(this,"fontOptions",void 0),(0,w.default)(this,"key",void 0),(0,w.default)(this,"cache",new _.LRUCache(B))}return(0,o.default)(ee,[{key:"scale",get:function(){return z}},{key:"canvas",get:function(){var ae=this.cache.get(this.key);return ae&&ae.data}},{key:"mapping",get:function(){var ae=this.cache.get(this.key);return ae&&ae.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:D,fontWeight:R,characterSet:O,fontSize:y,buffer:v,sdf:!0,cutoff:h,radius:S,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(ae){var G=this;ae.forEach(function(ie){G.iconFontGlyphs[ie.name]=ie.unicode})}},{key:"addIconFont",value:function(ae,G){this.iconFontMap.set(ae,G)}},{key:"getIconFontKey",value:function(ae){return this.iconFontMap.get(ae)||ae}},{key:"getGlyph",value:function(ae){return this.iconFontGlyphs[ae]?String.fromCharCode(parseInt(this.iconFontGlyphs[ae],16)):""}},{key:"setFontOptions",value:function(ae){this.fontOptions=I(I({},this.fontOptions),ae),this.key=this.getKey();var G=this.getNewChars(this.key,this.fontOptions.characterSet),ie=this.cache.get(this.key);if(!(ie&&G.length===0)){var le=this.generateFontAtlas(this.key,G,ie);this.fontAtlas=le,this.cache.set(this.key,le)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(ae,G,ie){var le=this.fontOptions,Me=le.fontFamily,ge=le.fontWeight,pe=le.fontSize,Ne=le.buffer,Re=le.sdf,he=le.radius,se=le.cutoff,J=le.iconfont,fe=ie&&ie.data;fe||(fe=document.createElement("canvas"),fe.width=A);var me=fe.getContext("2d");oe(me,Me,pe,ge);var Le=(0,d.buildMapping)(I({getFontWidth:function(pt){return me.measureText(pt).width},fontHeight:pe*z,buffer:Ne,characterSet:G,maxCanvasWidth:A},ie&&{mapping:ie.mapping,xOffset:ie.xOffset,yOffset:ie.yOffset})),C=Le.mapping,X=Le.canvasHeight,de=Le.xOffset,Ae=Le.yOffset,De=me.getImageData(0,0,fe.width,fe.height);if(fe.height=X,me.putImageData(De,0,0),oe(me,Me,pe,ge),Re){var Ge=new P.default(pe,Ne,he,se,Me,ge),$e=me.getImageData(0,0,Ge.size,Ge.size),ct=k(G),gt;try{for(ct.s();!(gt=ct.n()).done;){var st=gt.value;if(J){var xe=String.fromCharCode(parseInt(st.replace("&#x","").replace(";",""),16)),Mt=Ge.draw(xe);re(Mt,$e)}else re(Ge.draw(st),$e);me.putImageData($e,C[st].x,C[st].y)}}catch(it){ct.e(it)}finally{ct.f()}}else{var Ut=k(G),At;try{for(Ut.s();!(At=Ut.n()).done;){var nt=At.value;me.fillText(nt,C[nt].x,C[nt].y+pe*x)}}catch(it){Ut.e(it)}finally{Ut.f()}}return{xOffset:de,yOffset:Ae,mapping:C,data:fe,width:fe.width,height:fe.height}}},{key:"getKey",value:function(){return"key";var ae,G,ie,le,Me,ge,pe,Ne}},{key:"getNewChars",value:function(ae,G){var ie=this.cache.get(ae);if(!ie)return G;var le=[],Me=ie.mapping,ge=new Set(Object.keys(Me)),pe=new Set(G);return pe.forEach(function(Ne){ge.has(Ne)||le.push(Ne)}),le}}]),ee}())||g);c.default=Z},57414:function(){"use strict"},21447:function(){"use strict"},19071:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(26729),g=n(86700);n(28660);var k=n(28955),M,j;function U(v){var h=I();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var O=3,D=1024,R=64,y=(M=(0,g.injectable)(),M(j=function(v){(0,_.default)(S,v);var h=U(S);function S(){var A;(0,F.default)(this,S);for(var x=arguments.length,z=new Array(x),B=0;B<x;B++)z[B]=arguments[B];return A=h.call.apply(h,[this].concat(z)),(0,d.default)((0,w.default)(A),"canvasHeight",128),(0,d.default)((0,w.default)(A),"texture",void 0),(0,d.default)((0,w.default)(A),"canvas",void 0),(0,d.default)((0,w.default)(A),"iconData",void 0),(0,d.default)((0,w.default)(A),"iconMap",void 0),(0,d.default)((0,w.default)(A),"ctx",void 0),(0,d.default)((0,w.default)(A),"loadingImageCount",0),A}return(0,o.default)(S,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(x,z){var B=this,V=new Image;if(this.loadingImageCount++,this.hasImage(x))throw new Error("Image Id already exists");this.iconData.push({id:x,size:R}),this.updateIconMap(),this.loadImage(z).then(function(Q){V=Q;var oe=B.iconData.find(function(re){return re.id===x});oe&&(oe.image=V,oe.width=V.width,oe.height=V.height),B.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(x){return this.iconMap.hasOwnProperty(x)}},{key:"removeImage",value:function(x){this.hasImage(x)&&(this.iconData=this.iconData.filter(function(z){return z.id!==x}),delete this.iconMap[x],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var x=this;this.canvas.width=D,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(z){var B=x.iconMap[z],V=B.x,Q=B.y,oe=B.image,re=B.width,Z=re===void 0?64:re,ee=B.height,H=ee===void 0?64:ee,ae=Math.max(Z,H),G=ae/R,ie=H/G,le=Z/G;oe&&x.ctx.drawImage(oe,V+(R-le)/2,Q+(R-ie)/2,le,ie)})}},{key:"updateIconMap",value:function(){var x=(0,k.buildIconMaping)(this.iconData,O,D),z=x.mapping,B=x.canvasHeight;this.iconMap=z,this.canvasHeight=B}},{key:"loadImage",value:function(x){return new Promise(function(z,B){if(x instanceof HTMLImageElement){z(x);return}var V=new Image;V.crossOrigin="anonymous",V.onload=function(){z(V)},V.onerror=function(){B(new Error("Could not load image at "+x))},V.src=x instanceof File?URL.createObjectURL(x):x})}}]),S}(E.EventEmitter))||j);c.default=y},88047:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=n(89568),L=n(86700);n(28660);var d,E,g=(d=(0,L.injectable)(),d(E=function(){function k(){(0,o.default)(this,k),(0,_.default)(this,"viewport",void 0),(0,_.default)(this,"overridedViewProjectionMatrix",void 0),(0,_.default)(this,"jitteredViewProjectionMatrix",void 0),(0,_.default)(this,"jitteredProjectionMatrix",void 0),(0,_.default)(this,"viewMatrixInverse",void 0),(0,_.default)(this,"cameraPosition",void 0)}return(0,w.default)(k,[{key:"init",value:function(){}},{key:"update",value:function(j){this.viewport=j,this.viewMatrixInverse=P.mat4.create(),P.mat4.invert(this.viewMatrixInverse,j.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var j=this.viewport.getCenter(),U=(0,F.default)(j,2),I=U[0],O=U[1];return[I,O]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(j,U){return this.viewport.projectFlat(j,U)}},{key:"setViewProjectionMatrix",value:function(j){this.overridedViewProjectionMatrix=j}},{key:"jitterProjectionMatrix",value:function(j,U){var I=P.mat4.fromTranslation(P.mat4.create(),[j,U,0]);this.jitteredProjectionMatrix=P.mat4.multiply(P.mat4.create(),I,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=P.mat4.multiply(P.mat4.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),k}())||E);c.default=g},58105:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CameraUniform=void 0;var n={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};c.CameraUniform=n},48494:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(82887),P=n(86700);n(28660);var L=n(19403),d,E;function g(U,I){var O=typeof Symbol!="undefined"&&U[Symbol.iterator]||U["@@iterator"];if(!O){if(Array.isArray(U)||(O=k(U))||I&&U&&typeof U.length=="number"){O&&(U=O);var D=0,R=function(){};return{s:R,n:function(){return D>=U.length?{done:!0}:{done:!1,value:U[D++]}},e:function(A){throw A},f:R}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var y=!0,v=!1,h;return{s:function(){O=O.call(U)},n:function(){var A=O.next();return y=A.done,A},e:function(A){v=!0,h=A},f:function(){try{!y&&O.return!=null&&O.return()}finally{if(v)throw h}}}}function k(U,I){if(!!U){if(typeof U=="string")return M(U,I);var O=Object.prototype.toString.call(U).slice(8,-1);if(O==="Object"&&U.constructor&&(O=U.constructor.name),O==="Map"||O==="Set")return Array.from(U);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return M(U,I)}}function M(U,I){(I==null||I>U.length)&&(I=U.length);for(var O=0,D=new Array(I);O<I;O++)D[O]=U[O];return D}var j=(d=(0,P.injectable)(),d(E=function(){function U(){(0,F.default)(this,U),(0,w.default)(this,"container",void 0),(0,w.default)(this,"controlCorners",void 0),(0,w.default)(this,"controlContainer",void 0),(0,w.default)(this,"scene",void 0),(0,w.default)(this,"mapsService",void 0),(0,w.default)(this,"controls",[]),(0,w.default)(this,"unAddControls",[])}return(0,o.default)(U,[{key:"init",value:function(O,D){this.container=O.container,this.scene=D,this.mapsService=D.get(L.TYPES.IMapService),this.initControlPos()}},{key:"addControl",value:function(O,D){var R=D.get(L.TYPES.IMapService);R.map?(O.addTo(this.scene),this.controls.push(O)):this.unAddControls.push(O)}},{key:"getControlByName",value:function(O){return this.controls.find(function(D){return D.controlOption.name===O})}},{key:"removeControl",value:function(O){var D=this.controls.indexOf(O);return D>-1&&this.controls.splice(D,1),O.remove(),this}},{key:"addControls",value:function(){var O=this;this.unAddControls.forEach(function(D){D.addTo(O.scene),O.controls.push(D)}),this.unAddControls=[]}},{key:"destroy",value:function(){var O=g(this.controls),D;try{for(O.s();!(D=O.n()).done;){var R=D.value;R.remove()}}catch(y){O.e(y)}finally{O.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var O=this.controlCorners={},D="l7-",R=this.controlContainer=_.DOM.create("div",D+"control-container",this.container);function y(v,h){var S=D+v+" "+D+h;O[v+h]=_.DOM.create("div",S,R)}y("top","left"),y("top","right"),y("bottom","left"),y("bottom","right")}},{key:"clearControlPos",value:function(){for(var O in this.controlCorners)this.controlCorners[O]&&_.DOM.remove(this.controlCorners[O]);this.controlContainer&&_.DOM.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),U}())||E);c.default=j},6074:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PositionType=void 0;var n;c.PositionType=n,function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"}(n||(c.PositionType=n={}))},58646:function(){"use strict"},42818:function(){"use strict"},9159:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(86700);n(28660);var P=n(19403),L,d,E=(L=(0,_.injectable)(),L(d=function(){function g(){(0,F.default)(this,g),(0,w.default)(this,"container",void 0),(0,w.default)(this,"scene",void 0),(0,w.default)(this,"mapsService",void 0),(0,w.default)(this,"markers",[]),(0,w.default)(this,"markerLayers",[]),(0,w.default)(this,"unAddMarkers",[]),(0,w.default)(this,"unAddMarkerLayers",[])}return(0,o.default)(g,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var j=this.markerLayers.indexOf(M);j>-1&&this.markerLayers.splice(j,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(j){j.addTo(M.scene),M.markers.push(j)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(j){M.markerLayers.push(j),j.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var j=this.markers.indexOf(M);j>-1&&this.markers.splice(j,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(P.TYPES.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),g}())||d);c.default=E},6070:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(86700);n(28660);var P=n(19403),L,d,E=(L=(0,_.injectable)(),L(d=function(){function g(){(0,F.default)(this,g),(0,w.default)(this,"scene",void 0),(0,w.default)(this,"popup",void 0),(0,w.default)(this,"mapsService",void 0),(0,w.default)(this,"unAddPopup",void 0)}return(0,o.default)(g,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(P.TYPES.IMapService)}}]),g}())||d);c.default=E},65044:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(82492)),P=n(86700);n(28660);var L=i(n(82108)),d,E;function g(I,O){var D=Object.keys(I);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(I);O&&(R=R.filter(function(y){return Object.getOwnPropertyDescriptor(I,y).enumerable})),D.push.apply(D,R)}return D}function k(I){for(var O=1;O<arguments.length;O++){var D=arguments[O]!=null?arguments[O]:{};O%2?g(Object(D),!0).forEach(function(R){(0,w.default)(I,R,D[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(D)):g(Object(D)).forEach(function(R){Object.defineProperty(I,R,Object.getOwnPropertyDescriptor(D,R))})}return I}var M={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},j={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},U=(d=(0,P.injectable)(),d(E=function(){function I(){(0,F.default)(this,I),(0,w.default)(this,"sceneConfigCache",{}),(0,w.default)(this,"layerConfigCache",{})}return(0,o.default)(I,[{key:"getSceneConfig",value:function(D){return this.sceneConfigCache[D]}},{key:"getSceneWarninfo",value:function(D){return L.default[D]}},{key:"setSceneConfig",value:function(D,R){this.sceneConfigCache[D]=k(k({},M),R)}},{key:"getLayerConfig",value:function(D){return this.layerConfigCache[D]}},{key:"setLayerConfig",value:function(D,R,y){this.layerConfigCache[R]=k({},(0,_.default)({},this.sceneConfigCache[D],j,y))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),I}())||E);c.default=U},9061:function(){"use strict"},82108:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var n={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},i=n;c.default=i},59204:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(89568),E=n(86700);n(28660);var g=n(19403),k=n(29142),M=n(93739),j,U,I,O,D,R=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],y=(j=(0,E.injectable)(),U=(0,E.inject)(g.TYPES.ICameraService),j(I=(O=function(){function v(){(0,o.default)(this,v),(0,_.default)(this,"needRefresh",!0),(0,F.default)(this,"cameraService",D,this),(0,_.default)(this,"coordinateSystem",void 0),(0,_.default)(this,"viewportCenter",void 0),(0,_.default)(this,"viewportCenterProjection",void 0),(0,_.default)(this,"pixelsPerDegree",void 0),(0,_.default)(this,"pixelsPerDegree2",void 0),(0,_.default)(this,"pixelsPerMeter",void 0)}return(0,w.default)(v,[{key:"refresh",value:function(){var S=this.cameraService.getZoom(),A=this.cameraService.getZoomScale(),x=this.cameraService.getCenter(),z=(0,k.getDistanceScales)({latitude:x[1],zoom:S}),B=z.pixelsPerMeter,V=z.pixelsPerDegree;this.viewportCenter=x,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=B,this.pixelsPerDegree=V,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===M.CoordinateSystem.LNGLAT||this.coordinateSystem===M.CoordinateSystem.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===M.CoordinateSystem.LNGLAT_OFFSET?this.calculateLnglatOffset(x,S):this.coordinateSystem===M.CoordinateSystem.P20_OFFSET&&this.calculateLnglatOffset(x,S,A,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(S){this.coordinateSystem=S}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(S,A,x,z){var B=(0,k.getDistanceScales)({latitude:S[1],zoom:A,scale:x,flipY:z,highPrecision:!0}),V=B.pixelsPerMeter,Q=B.pixelsPerDegree,oe=B.pixelsPerDegree2,re=this.cameraService.getViewMatrix(),Z=this.cameraService.getProjectionMatrix(),ee=d.mat4.multiply([],Z,re),H=this.cameraService.projectFlat([Math.fround(S[0]),Math.fround(S[1])],Math.pow(2,A));this.viewportCenterProjection=d.vec4.transformMat4([],[H[0],H[1],0,1],ee),re=this.cameraService.getViewMatrixUncentered()||re,ee=d.mat4.multiply([],Z,re),ee=d.mat4.multiply([],ee,R),this.cameraService.setViewProjectionMatrix(ee),this.pixelsPerMeter=V,this.pixelsPerDegree=Q,this.pixelsPerDegree2=oe}}]),v}(),D=(0,P.default)(O.prototype,"cameraService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O))||I);c.default=y},93739:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CoordinateUniform=c.CoordinateSystem=void 0;var n;c.CoordinateSystem=n,function(F){F[F.LNGLAT=1]="LNGLAT",F[F.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",F[F.VECTOR_TILE=3]="VECTOR_TILE",F[F.IDENTITY=4]="IDENTITY",F[F.P20=5]="P20",F[F.P20_OFFSET=6]="P20_OFFSET",F[F.METER_OFFSET=7]="METER_OFFSET",F[F.P20_2=8]="P20_2"}(n||(c.CoordinateSystem=n={}));var i={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"};c.CoordinateUniform=i},77235:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InteractionEvent=void 0;var n;c.InteractionEvent=n,function(i){i.Hover="hover",i.Click="click",i.Select="select",i.Active="active",i.Drag="drag"}(n||(c.InteractionEvent=n={}))},72227:function(){"use strict"},45265:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(81506)),P=i(n(2205)),L=i(n(78585)),d=i(n(29754)),E=i(n(59713)),g=i(n(33124)),k=i(n(67268)),M=i(n(26729)),j=i(n(50840)),U=n(86700);n(28660);var I=n(19403),O=n(77235),D,R,y,v,h;function S(B){var V=A();return function(){var oe=(0,d.default)(B),re;if(V){var Z=(0,d.default)(this).constructor;re=Reflect.construct(oe,arguments,Z)}else re=oe.apply(this,arguments);return(0,L.default)(this,re)}}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var x={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(D=(0,U.injectable)(),R=(0,U.inject)(I.TYPES.IMapService),D(y=(v=function(B){(0,P.default)(Q,B);var V=S(Q);function Q(){var oe;(0,o.default)(this,Q);for(var re=arguments.length,Z=new Array(re),ee=0;ee<re;ee++)Z[ee]=arguments[ee];return oe=V.call.apply(V,[this].concat(Z)),(0,F.default)((0,_.default)(oe),"mapService",h,(0,_.default)(oe)),(0,E.default)((0,_.default)(oe),"hammertime",void 0),(0,E.default)((0,_.default)(oe),"lastClickTime",0),(0,E.default)((0,_.default)(oe),"lastClickXY",[-1,-1]),(0,E.default)((0,_.default)(oe),"clickTimer",void 0),(0,E.default)((0,_.default)(oe),"$containter",void 0),(0,E.default)((0,_.default)(oe),"onDrag",function(H){var ae=oe.interactionEvent(H);ae.type=x[ae.type],oe.emit(O.InteractionEvent.Drag,ae)}),(0,E.default)((0,_.default)(oe),"onHammer",function(H){H.srcEvent.stopPropagation();var ae=oe.interactionEvent(H);oe.emit(O.InteractionEvent.Hover,ae)}),(0,E.default)((0,_.default)(oe),"onTouch",function(H){var ae=H.touches[0];oe.onHover({x:ae.pageX,y:ae.pageY,type:"touch"})}),(0,E.default)((0,_.default)(oe),"onHover",function(H){var ae=H.clientX,G=H.clientY,ie=ae,le=G,Me=H.type,ge=oe.mapService.getMapContainer();if(ge){var pe=ge.getBoundingClientRect(),Ne=pe.top,Re=pe.left;ie=ie-Re-ge.clientLeft,le=le-Ne-ge.clientTop}var he=oe.mapService.containerToLngLat([ie,le]);if(Me==="click"){if("ontouchstart"in document.documentElement)return;oe.isDoubleTap(ie,le,he);return}if(Me==="touch"){oe.isDoubleTap(ie,le,he);return}Me!=="click"&&Me!=="dblclick"&&oe.emit(O.InteractionEvent.Hover,{x:ie,y:le,lngLat:he,type:Me,target:H})}),oe}return(0,w.default)(Q,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(O.InteractionEvent.Hover)}},{key:"triggerHover",value:function(re){var Z=re.x,ee=re.y;this.emit(O.InteractionEvent.Hover,{x:Z,y:ee})}},{key:"triggerSelect",value:function(re){this.emit(O.InteractionEvent.Select,{featureId:re})}},{key:"triggerActive",value:function(re){this.emit(O.InteractionEvent.Active,{featureId:re})}},{key:"addEventListenerOnMap",value:function(){var re=this.mapService.getMapContainer();if(re){var Z=new j.default.Manager(re);Z.add(new j.default.Tap({event:"dblclick",taps:2})),Z.add(new j.default.Tap({event:"click"})),Z.add(new j.default.Pan({threshold:0,pointers:0})),Z.add(new j.default.Press({})),Z.on("dblclick click",this.onHammer),Z.on("panstart panmove panend pancancel",this.onDrag),re.addEventListener("mousemove",this.onHover),re.addEventListener("mousedown",this.onHover,!0),re.addEventListener("mouseup",this.onHover),re.addEventListener("contextmenu",this.onHover),this.hammertime=Z}}},{key:"removeEventListenerOnMap",value:function(){var re=this.mapService.getMapContainer();re&&(re.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),re.removeEventListener("mousedown",this.onHover),re.removeEventListener("mouseup",this.onHover),re.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(re){var Z=re.type,ee=re.pointerType,H,ae;ee==="touch"?(ae=Math.floor(re.pointers[0].clientY),H=Math.floor(re.pointers[0].clientX)):(ae=Math.floor(re.srcEvent.y),H=Math.floor(re.srcEvent.x));var G=this.mapService.getMapContainer();if(G){var ie=G.getBoundingClientRect(),le=ie.top,Me=ie.left;H-=Me,ae-=le}var ge=this.mapService.containerToLngLat([H,ae]);return{x:H,y:ae,lngLat:ge,type:Z,target:re.srcEvent}}},{key:"isDoubleTap",value:function(re,Z,ee){var H=this,ae=new Date().getTime(),G="click";ae-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-re)<10&&Math.abs(this.lastClickXY[1]-Z)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),G="dblclick",this.emit(O.InteractionEvent.Hover,{x:re,y:Z,lngLat:ee,type:G})):(this.lastClickTime=ae,this.lastClickXY=[re,Z],this.clickTimer=setTimeout(function(){G="click",H.emit(O.InteractionEvent.Hover,{x:re,y:Z,lngLat:ee,type:G})},400))}}]),Q}(M.default),h=(0,g.default)(v.prototype,"mapService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v))||y);c.default=z},11503:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(63038)),w=i(n(48926)),_=i(n(21165)),P=i(n(34575)),L=i(n(93913)),d=i(n(59713)),E=i(n(33124)),g=i(n(67268)),k=n(82887),M=n(86700);n(28660);var j=n(19403),U=n(77235),I=n(7403),O,D,R,y,v,h,S,A,x,z,B;function V(re,Z){var ee=Object.keys(re);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(re);Z&&(H=H.filter(function(ae){return Object.getOwnPropertyDescriptor(re,ae).enumerable})),ee.push.apply(ee,H)}return ee}function Q(re){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z]!=null?arguments[Z]:{};Z%2?V(Object(ee),!0).forEach(function(H){(0,d.default)(re,H,ee[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(re,Object.getOwnPropertyDescriptors(ee)):V(Object(ee)).forEach(function(H){Object.defineProperty(re,H,Object.getOwnPropertyDescriptor(ee,H))})}return re}var oe=(O=(0,M.injectable)(),D=(0,M.inject)(j.TYPES.IRendererService),R=(0,M.inject)(j.TYPES.IGlobalConfigService),y=(0,M.inject)(j.TYPES.IInteractionService),v=(0,M.inject)(j.TYPES.ILayerService),O(h=(S=function(){function re(){var Z=this;(0,P.default)(this,re),(0,_.default)(this,"rendererService",A,this),(0,_.default)(this,"configService",x,this),(0,_.default)(this,"interactionService",z,this),(0,_.default)(this,"layerService",B,this),(0,d.default)(this,"pickingFBO",void 0),(0,d.default)(this,"width",0),(0,d.default)(this,"height",0),(0,d.default)(this,"alreadyInPicking",!1),(0,d.default)(this,"pickBufferScale",1),(0,d.default)(this,"pickFromPickingFBO",function(ee,H){var ae,G=H.x,ie=H.y,le=H.lngLat,Me=H.type,ge=H.target,pe=!1,Ne=Z.rendererService,Re=Ne.getViewportSize,he=Ne.readPixels,se=Ne.getContainer,J=se().getBoundingClientRect(),fe=J.width,me=J.height;fe*=k.DOM.DPR,me*=k.DOM.DPR;var Le=ee.getLayerConfig(),C=Le.enableHighlight,X=Le.enableSelect,de=G*k.DOM.DPR,Ae=ie*k.DOM.DPR;if(de>fe-1*k.DOM.DPR||de<0||Ae>me-1*k.DOM.DPR||Ae<0)return!1;var De;if(De=he({x:Math.floor(de/Z.pickBufferScale),y:Math.floor((me-(ie+1)*k.DOM.DPR)/Z.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:Z.pickingFBO}),De[0]!==0||De[1]!==0||De[2]!==0){var Ge=(0,k.decodePickingColor)(De),$e=ee.getSource().getFeatureById(Ge);Ge!==ee.getCurrentPickId()&&Me==="mousemove"&&(Me="mouseenter");var ct={x:G,y:ie,type:Me,lngLat:le,featureId:Ge,feature:$e,target:ge};$e&&(pe=!0,ee.setCurrentPickId(Ge),Z.triggerHoverOnLayer(ee,ct))}else{var gt={x:G,y:ie,lngLat:le,type:ee.getCurrentPickId()!==null&&Me==="mousemove"?"mouseout":"un"+Me,featureId:null,target:ge,feature:null};Z.triggerHoverOnLayer(ee,Q(Q({},gt),{},{type:"unpick"})),Z.triggerHoverOnLayer(ee,gt),ee.setCurrentPickId(null)}if(C&&Z.highlightPickedFeature(ee,De),X&&Me==="click"&&((ae=De)===null||ae===void 0?void 0:ae.toString())!==[0,0,0,0].toString()){var st=(0,k.decodePickingColor)(De);ee.getCurrentSelectedId()===null||st!==ee.getCurrentSelectedId()?(Z.selectFeature(ee,De),ee.setCurrentSelectedId(st)):(Z.selectFeature(ee,new Uint8Array([0,0,0,0])),ee.setCurrentSelectedId(null))}return pe})}return(0,L.default)(re,[{key:"init",value:function(ee){var H=this.rendererService,ae=H.createTexture2D,G=H.createFramebuffer,ie=H.getViewportSize,le=H.getContainer,Me=le().getBoundingClientRect(),ge=Me.width,pe=Me.height;ge*=k.DOM.DPR,pe*=k.DOM.DPR,this.pickBufferScale=this.configService.getSceneConfig(ee).pickBufferScale||1,this.pickingFBO=G({color:ae({width:Math.round(ge/this.pickBufferScale),height:Math.round(pe/this.pickBufferScale),wrapS:I.gl.CLAMP_TO_EDGE,wrapT:I.gl.CLAMP_TO_EDGE})}),this.interactionService.on(U.InteractionEvent.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var Z=(0,w.default)(F.default.mark(function H(ae,G,ie){var le=this,Me,ge,pe,Ne;return F.default.wrap(function(he){for(;;)switch(he.prev=he.next){case 0:Me=this.rendererService,ge=Me.useFramebuffer,pe=Me.clear,Ne=Me.getContainer,this.resizePickingFBO(),ge(this.pickingFBO,function(){pe({framebuffer:le.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ae.hooks.beforePickingEncode.call(),ae.renderModels(),ae.hooks.afterPickingEncode.call();var se=le.pickBox(ae,G);ie(se)});case 3:case"end":return he.stop()}},H,this)}));function ee(H,ae,G){return Z.apply(this,arguments)}return ee}()},{key:"pickBox",value:function(ee,H){var ae=this,G=H.map(function(gt){var st=gt<0?0:gt;return Math.floor(st*k.DOM.DPR/ae.pickBufferScale)}),ie=(0,o.default)(G,4),le=ie[0],Me=ie[1],ge=ie[2],pe=ie[3],Ne=this.rendererService,Re=Ne.getViewportSize,he=Ne.readPixels,se=Ne.getContainer,J=se().getBoundingClientRect(),fe=J.width,me=J.height;if(fe*=k.DOM.DPR,me*=k.DOM.DPR,le>(fe-1)*k.DOM.DPR/this.pickBufferScale||ge<0||Me>(me-1)*k.DOM.DPR/this.pickBufferScale||pe<0)return[];var Le,C=Math.min(fe/this.pickBufferScale,ge)-le,X=Math.min(me/this.pickBufferScale,pe)-Me;Le=he({x:le,y:Math.floor(me/this.pickBufferScale-(pe+1)),width:C,height:X,data:new Uint8Array(C*X*4),framebuffer:this.pickingFBO});for(var de=[],Ae={},De=0;De<Le.length/4;De=De+1){var Ge=Le.slice(De*4,De*4+4),$e=(0,k.decodePickingColor)(Ge);if($e!==-1&&!Ae[$e]){var ct=ee.getSource().getFeatureById($e);de.push(ct),Ae[$e]=!0}}return de}},{key:"pickingAllLayer",value:function(){var Z=(0,w.default)(F.default.mark(function H(ae){return F.default.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ie.next=2;break}return ie.abrupt("return");case 2:return this.alreadyInPicking=!0,ie.next=5,this.pickingLayers(ae);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return ie.stop()}},H,this)}));function ee(H){return Z.apply(this,arguments)}return ee}()},{key:"resizePickingFBO",value:function(){var ee=this.rendererService.getContainer,H=ee().getBoundingClientRect(),ae=H.width,G=H.height;ae*=k.DOM.DPR,G*=k.DOM.DPR,(this.width!==ae||this.height!==G)&&(this.pickingFBO.resize({width:Math.round(ae/this.pickBufferScale),height:Math.round(G/this.pickBufferScale)}),this.width=ae,this.height=G)}},{key:"pickingLayers",value:function(){var Z=(0,w.default)(F.default.mark(function H(ae){var G=this,ie,le,Me,ge,pe;return F.default.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:ie=this.rendererService,le=ie.getViewportSize,Me=ie.useFramebuffer,ge=ie.clear,pe=ie.getContainer,this.resizePickingFBO(),Me(this.pickingFBO,function(){var he=G.layerService.getLayers();he.filter(function(se){return se.needPick(ae.type)}).reverse().some(function(se){ge({framebuffer:G.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),se.hooks.beforePickingEncode.call(),se.renderModels(),se.hooks.afterPickingEncode.call();var J=G.pickFromPickingFBO(se,ae);return J&&!se.getLayerConfig().enablePropagation})});case 3:case"end":return Re.stop()}},H,this)}));function ee(H){return Z.apply(this,arguments)}return ee}()},{key:"triggerHoverOnLayer",value:function(ee,H){ee.emit(H.type,H)}},{key:"isEventCrash",value:function(ee){var H=!0;return ee.target.path.map(function(ae){ae.classList&&ae.classList.forEach(function(G){(G==="l7-marker"||G==="l7-popup")&&(H=!1)})}),H}},{key:"highlightPickedFeature",value:function(ee,H){var ae=(0,o.default)(H,3),G=ae[0],ie=ae[1],le=ae[2];ee.hooks.beforeHighlight.call([G,ie,le])}},{key:"selectFeature",value:function(ee,H){var ae=(0,o.default)(H,3),G=ae[0],ie=ae[1],le=ae[2];ee.hooks.beforeSelect.call([G,ie,le])}}]),re}(),A=(0,E.default)(S.prototype,"rendererService",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=(0,E.default)(S.prototype,"configService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=(0,E.default)(S.prototype,"interactionService",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,E.default)(S.prototype,"layerService",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S))||h);c.default=oe},21214:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BlendType=void 0;var n;c.BlendType=n,function(i){i.normal="normal",i.additive="additive",i.subtractive="subtractive",i.min="min",i.max="max",i.none="none"}(n||(c.BlendType=n={}))},69232:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AttributeType=c.StyleScaleType=c.ScaleTypes=void 0;var n;c.ScaleTypes=n,function(o){o.LINEAR="linear",o.POWER="power",o.LOG="log",o.IDENTITY="identity",o.TIME="time",o.QUANTILE="quantile",o.QUANTIZE="quantize",o.THRESHOLD="threshold",o.CAT="cat"}(n||(c.ScaleTypes=n={}));var i;c.StyleScaleType=i,function(o){o.CONSTANT="constant",o.VARIABLE="variable"}(i||(c.StyleScaleType=i={}));var F;c.AttributeType=F,function(o){o[o.Attribute=0]="Attribute",o[o.InstancedAttribute=1]="InstancedAttribute",o[o.Uniform=2]="Uniform"}(F||(c.AttributeType=F={}))},20233:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(86700);n(28660);var E=n(19403),g=i(n(65196)),k,M,j,U,I,O,D,R=(k=(0,d.injectable)(),M=(0,d.inject)(E.TYPES.IRendererService),j=(0,d.inject)(E.TYPES.IGlobalConfigService),k(U=(I=function(){function y(){(0,o.default)(this,y),(0,_.default)(this,"clock",new g.default),(0,_.default)(this,"alreadyInRendering",!1),(0,_.default)(this,"layers",[]),(0,_.default)(this,"layerRenderID",void 0),(0,_.default)(this,"sceneInited",!1),(0,_.default)(this,"animateInstanceCount",0),(0,F.default)(this,"renderService",O,this),(0,F.default)(this,"configService",D,this)}return(0,w.default)(y,[{key:"add",value:function(h){this.sceneInited&&h.init(),this.layers.push(h)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(h){h.inited||h.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(h){return this.layers.find(function(S){return S.id===h})}},{key:"getLayerByName",value:function(h){return this.layers.find(function(S){return S.name===h})}},{key:"remove",value:function(h){var S=this.layers.indexOf(h);S>-1&&this.layers.splice(S,1),h.emit("remove",null),h.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(h){return h.inited}).filter(function(h){return h.isVisible()}).forEach(function(h){h.hooks.beforeRenderData.call(),h.hooks.beforeRender.call(),h.render(),h.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(h,S){return h.zIndex-S.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(h){return h.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),y}(),O=(0,P.default)(I.prototype,"renderService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=(0,P.default)(I.prototype,"configService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I))||U);c.default=R},25960:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(319)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(14293)),L=function(){function d(E){var g=this;(0,o.default)(this,d),(0,_.default)(this,"name",void 0),(0,_.default)(this,"type",void 0),(0,_.default)(this,"scale",void 0),(0,_.default)(this,"descriptor",void 0),(0,_.default)(this,"featureBufferLayout",[]),(0,_.default)(this,"needRescale",!1),(0,_.default)(this,"needRemapping",!1),(0,_.default)(this,"needRegenerateVertices",!1),(0,_.default)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,_.default)(this,"vertexAttribute",void 0),(0,_.default)(this,"defaultCallback",function(k){if(k.length===0){var M;return((M=g.scale)===null||M===void 0?void 0:M.defaultValues)||[]}return k.map(function(j,U){var I,O=(I=g.scale)===null||I===void 0?void 0:I.scalers[U].func,D=O(j);return D})}),this.setProps(E)}return(0,w.default)(d,[{key:"setProps",value:function(g){Object.assign(this,g)}},{key:"mapping",value:function(g){var k;if((k=this.scale)!==null&&k!==void 0&&k.callback){var M,j=(M=this.scale)===null||M===void 0?void 0:M.callback.apply(M,(0,F.default)(g));if(!(0,P.default)(j))return[j]}return this.defaultCallback(g)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),d}();c.default=L},9868:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(6479)),o=i(n(319)),w=i(n(21165)),_=i(n(34575)),P=i(n(93913)),L=i(n(33124)),d=i(n(67268)),E=i(n(59713)),g=n(86700);n(28660);var k=n(19403),M=n(7403),j=i(n(25960)),U,I,O,D,R,y;function v(z,B){var V=Object.keys(z);if(Object.getOwnPropertySymbols){var Q=Object.getOwnPropertySymbols(z);B&&(Q=Q.filter(function(oe){return Object.getOwnPropertyDescriptor(z,oe).enumerable})),V.push.apply(V,Q)}return V}function h(z){for(var B=1;B<arguments.length;B++){var V=arguments[B]!=null?arguments[B]:{};B%2?v(Object(V),!0).forEach(function(Q){(0,E.default)(z,Q,V[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(V)):v(Object(V)).forEach(function(Q){Object.defineProperty(z,Q,Object.getOwnPropertyDescriptor(V,Q))})}return z}function S(z){return new Promise(function(B){return setTimeout(B,z)})}var A=(U={},(0,E.default)(U,M.gl.FLOAT,4),(0,E.default)(U,M.gl.UNSIGNED_BYTE,1),(0,E.default)(U,M.gl.UNSIGNED_SHORT,2),U),x=(I=(0,g.injectable)(),O=(0,g.inject)(k.TYPES.IRendererService),I(D=(R=function(){function z(){(0,_.default)(this,z),(0,E.default)(this,"attributesAndIndices",void 0),(0,w.default)(this,"rendererService",y,this),(0,E.default)(this,"attributes",[]),(0,E.default)(this,"triangulation",void 0),(0,E.default)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,P.default)(z,[{key:"registerStyleAttribute",value:function(V){var Q=this.getLayerStyleAttribute(V.name||"");return Q?Q.setProps(V):(Q=new j.default(V),this.attributes.push(Q)),Q}},{key:"updateStyleAttribute",value:function(V,Q,oe){var re=this.getLayerStyleAttribute(V);re||(re=this.registerStyleAttribute(h(h({},Q),{},{name:V})));var Z=Q.scale;Z&&re&&(re.scale=Z,re.needRescale=!0,re.needRemapping=!0,re.needRegenerateVertices=!0,oe&&oe.featureRange&&(re.featureRange=oe.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(V){return this.attributes.find(function(Q){return Q.name===V})}},{key:"getLayerAttributeScale",value:function(V){var Q,oe=this.getLayerStyleAttribute(V),re=oe==null||(Q=oe.scale)===null||Q===void 0?void 0:Q.scalers;return re&&re[0]?re[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(V,Q){var oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,re=arguments.length>3?arguments[3]:void 0,Z=this.attributes.find(function(J){return J.name===V});if(Z&&Z.descriptor){var ee=Z.descriptor,H=ee.update,ae=ee.buffer,G=ee.size,ie=G===void 0?0:G,le=A[ae.type||M.gl.FLOAT];if(H){var Me=this.featureLayout,ge=Me.elements,pe=Me.sizePerElement,Ne=ge.slice(oe,re);if(!Ne.length)return;var Re=Ne[0].offset,he=Re*ie*le,se=Ne.map(function(J,fe){for(var me=J.featureIdx,Le=J.vertices,C=J.normals,X=Le.length/pe,de=[],Ae=0;Ae<X;Ae++){var De=C?C.slice(Ae*3,Ae*3+3):[];de.push.apply(de,(0,o.default)(H(Q[me],me,Le.slice(Ae*pe,Ae*pe+pe),fe,De)))}return de}).reduce(function(J,fe){return J.push.apply(J,(0,o.default)(fe)),J},[]);Z.vertexAttribute.updateBuffer({data:se,offset:he})}}}},{key:"createAttributesAndIndices",value:function(V,Q){var oe=this;this.featureLayout={sizePerElement:0,elements:[]},Q&&(this.triangulation=Q);var re=this.attributes.map(function(Re){return Re.resetDescriptor(),Re.descriptor}),Z=0,ee=[],H=[],ae=[],G=3;V.forEach(function(Re,he){var se=oe.triangulation(Re),J=se.indices,fe=se.vertices,me=se.normals,Le=se.size;J.forEach(function(Ae){H.push(Ae+Z)}),G=Le;var C=fe.length/Le;oe.featureLayout.sizePerElement=G,oe.featureLayout.elements.push({featureIdx:he,vertices:fe,normals:me,offset:Z}),Z+=C;for(var X=function(De){var Ge=(me==null?void 0:me.slice(De*3,De*3+3))||[],$e=fe.slice(De*Le,De*Le+Le);re.forEach(function(ct,gt){if(ct&&ct.update){var st;(st=ct.buffer.data).push.apply(st,(0,o.default)(ct.update(Re,he,$e,De,Ge)))}})},de=0;de<C;de++)X(de)});var ie=this.rendererService,le=ie.createAttribute,Me=ie.createBuffer,ge=ie.createElements,pe={};re.forEach(function(Re,he){if(Re){var se=Re.buffer,J=Re.update,fe=Re.name,me=(0,F.default)(Re,["buffer","update","name"]),Le=le(h({buffer:Me(se)},me));pe[Re.name||""]=Le,oe.attributes[he].vertexAttribute=Le}});var Ne=ge({data:H,type:M.gl.UNSIGNED_INT,count:H.length});return this.attributesAndIndices={attributes:pe,elements:Ne},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var V;this.attributes.forEach(function(Q){Q.vertexAttribute&&Q.vertexAttribute.destroy()}),(V=this.attributesAndIndices)===null||V===void 0||V.elements.destroy(),this.attributes=[]}}]),z}(),y=(0,L.default)(R.prototype,"rendererService",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R))||D);c.default=x},28680:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MapServiceEvent=void 0;var n=["mapload"];c.MapServiceEvent=n},92151:function(){"use strict"},7751:function(){"use strict"},84539:function(){"use strict"},33896:function(){"use strict"},22328:function(){"use strict"},45857:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PassType=void 0;var n;c.PassType=n,function(i){i.Normal="normal",i.PostProcessing="post-processing"}(n||(c.PassType=n={}))},47759:function(){"use strict"},68446:function(){"use strict"},82856:function(){"use strict"},18694:function(){"use strict"},7403:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.gl=void 0;var n;c.gl=n,function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.MAX_EXT=32776]="MAX_EXT",i[i.MIN_EXT=32775]="MIN_EXT",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.CULL_FACE=2884]="CULL_FACE",i[i.BLEND=3042]="BLEND",i[i.DITHER=3024]="DITHER",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.TEXTURE1=33985]="TEXTURE1",i[i.TEXTURE2=33986]="TEXTURE2",i[i.TEXTURE3=33987]="TEXTURE3",i[i.TEXTURE4=33988]="TEXTURE4",i[i.TEXTURE5=33989]="TEXTURE5",i[i.TEXTURE6=33990]="TEXTURE6",i[i.TEXTURE7=33991]="TEXTURE7",i[i.TEXTURE8=33992]="TEXTURE8",i[i.TEXTURE9=33993]="TEXTURE9",i[i.TEXTURE10=33994]="TEXTURE10",i[i.TEXTURE11=33995]="TEXTURE11",i[i.TEXTURE12=33996]="TEXTURE12",i[i.TEXTURE13=33997]="TEXTURE13",i[i.TEXTURE14=33998]="TEXTURE14",i[i.TEXTURE15=33999]="TEXTURE15",i[i.TEXTURE16=34e3]="TEXTURE16",i[i.TEXTURE17=34001]="TEXTURE17",i[i.TEXTURE18=34002]="TEXTURE18",i[i.TEXTURE19=34003]="TEXTURE19",i[i.TEXTURE20=34004]="TEXTURE20",i[i.TEXTURE21=34005]="TEXTURE21",i[i.TEXTURE22=34006]="TEXTURE22",i[i.TEXTURE23=34007]="TEXTURE23",i[i.TEXTURE24=34008]="TEXTURE24",i[i.TEXTURE25=34009]="TEXTURE25",i[i.TEXTURE26=34010]="TEXTURE26",i[i.TEXTURE27=34011]="TEXTURE27",i[i.TEXTURE28=34012]="TEXTURE28",i[i.TEXTURE29=34013]="TEXTURE29",i[i.TEXTURE30=34014]="TEXTURE30",i[i.TEXTURE31=34015]="TEXTURE31",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"}(n||(c.gl=n={}))},94080:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(86700);n(28660);var E=n(19403),g=n(45857),k,M,j,U,I,O=(k=(0,d.injectable)(),M=(0,d.inject)(E.TYPES.IShaderModuleService),k(j=(U=function(){function D(){(0,o.default)(this,D),(0,F.default)(this,"shaderModuleService",I,this),(0,_.default)(this,"rendererService",void 0),(0,_.default)(this,"cameraService",void 0),(0,_.default)(this,"mapService",void 0),(0,_.default)(this,"interactionService",void 0),(0,_.default)(this,"layerService",void 0),(0,_.default)(this,"config",void 0)}return(0,w.default)(D,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return g.PassType.Normal}},{key:"init",value:function(y,v){this.config=v,this.rendererService=y.getContainer().get(E.TYPES.IRendererService),this.cameraService=y.getContainer().get(E.TYPES.ICameraService),this.mapService=y.getContainer().get(E.TYPES.IMapService),this.interactionService=y.getContainer().get(E.TYPES.IInteractionService),this.layerService=y.getContainer().get(E.TYPES.ILayerService)}},{key:"render",value:function(y){}}]),D}(),I=(0,P.default)(U.prototype,"shaderModuleService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U))||j);c.default=O},36770:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=i(n(11700)),E=i(n(14293)),g=i(n(68929)),k=n(86700);n(28660);var M=n(7403),j=n(19403),U=n(45857),I,O,D,R,y;function v(x,z){var B=Object.keys(x);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(x);z&&(V=V.filter(function(Q){return Object.getOwnPropertyDescriptor(x,Q).enumerable})),B.push.apply(B,V)}return B}function h(x){for(var z=1;z<arguments.length;z++){var B=arguments[z]!=null?arguments[z]:{};z%2?v(Object(B),!0).forEach(function(V){(0,_.default)(x,V,B[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(B)):v(Object(B)).forEach(function(V){Object.defineProperty(x,V,Object.getOwnPropertyDescriptor(B,V))})}return x}var S=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,A=(I=(0,k.injectable)(),O=(0,k.inject)(j.TYPES.IShaderModuleService),I(D=(R=function(){function x(){(0,o.default)(this,x),(0,F.default)(this,"shaderModuleService",y,this),(0,_.default)(this,"rendererService",void 0),(0,_.default)(this,"config",void 0),(0,_.default)(this,"quad",S),(0,_.default)(this,"enabled",!0),(0,_.default)(this,"renderToScreen",!1),(0,_.default)(this,"model",void 0),(0,_.default)(this,"name",void 0),(0,_.default)(this,"optionsToUpdate",{})}return(0,w.default)(x,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(B){this.name=B}},{key:"getType",value:function(){return U.PassType.PostProcessing}},{key:"init",value:function(B,V){this.config=V,this.rendererService=B.getContainer().get(j.TYPES.IRendererService);var Q=this.rendererService,oe=Q.createAttribute,re=Q.createBuffer,Z=Q.createModel,ee=this.setupShaders(),H=ee.vs,ae=ee.fs,G=ee.uniforms;this.model=Z({vs:H,fs:ae,attributes:{a_Position:oe({buffer:re({data:[-4,-4,4,-4,0,4],type:M.gl.FLOAT}),size:2})},uniforms:h(h({u_Texture:null},G),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(B){var V=this,Q=B.multiPassRenderer.getPostProcessor(),oe=this.rendererService,re=oe.useFramebuffer,Z=oe.getViewportSize,ee=oe.clear,H=Z(),ae=H.width,G=H.height;re(this.renderToScreen?null:Q.getWriteFBO(),function(){ee({framebuffer:Q.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),V.model.draw({uniforms:h({u_Texture:Q.getReadFBO(),u_ViewportSize:[ae,G]},V.convertOptionsToUniforms(V.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(B){this.enabled=B}},{key:"setRenderToScreen",value:function(B){this.renderToScreen=B}},{key:"updateOptions",value:function(B){this.optionsToUpdate=h(h({},this.optionsToUpdate),B)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(B){var V={};return Object.keys(B).forEach(function(Q){(0,E.default)(B[Q])||(V["u_".concat((0,d.default)((0,g.default)(Q)))]=B[Q])}),V}}]),x}(),y=(0,P.default)(R.prototype,"shaderModuleService",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R))||D);c.default=A},82978:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(16525)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=n(86700);n(28660);var E=i(n(94080)),g,k;function M(I){var O=j();return function(){var R=(0,L.default)(I),y;if(O){var v=(0,L.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,P.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=(g=(0,d.injectable)(),g(k=function(I){(0,_.default)(D,I);var O=M(D);function D(){return(0,F.default)(this,D),O.apply(this,arguments)}return(0,o.default)(D,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(y,v){(0,w.default)((0,L.default)(D.prototype),"init",this).call(this,y,v)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),D}(E.default))||k);c.default=U},37911:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(48926)),w=i(n(21165)),_=i(n(34575)),P=i(n(93913)),L=i(n(59713)),d=i(n(33124)),E=i(n(67268)),g=n(86700);n(28660);var k=n(19403),M=n(45857),j,U,I,O,D;function R(S,A){var x=typeof Symbol!="undefined"&&S[Symbol.iterator]||S["@@iterator"];if(!x){if(Array.isArray(S)||(x=y(S))||A&&S&&typeof S.length=="number"){x&&(S=x);var z=0,B=function(){};return{s:B,n:function(){return z>=S.length?{done:!0}:{done:!1,value:S[z++]}},e:function(Z){throw Z},f:B}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V=!0,Q=!1,oe;return{s:function(){x=x.call(S)},n:function(){var Z=x.next();return V=Z.done,Z},e:function(Z){Q=!0,oe=Z},f:function(){try{!V&&x.return!=null&&x.return()}finally{if(Q)throw oe}}}}function y(S,A){if(!!S){if(typeof S=="string")return v(S,A);var x=Object.prototype.toString.call(S).slice(8,-1);if(x==="Object"&&S.constructor&&(x=S.constructor.name),x==="Map"||x==="Set")return Array.from(S);if(x==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(x))return v(S,A)}}function v(S,A){(A==null||A>S.length)&&(A=S.length);for(var x=0,z=new Array(A);x<A;x++)z[x]=S[x];return z}var h=(j=(0,g.injectable)(),U=(0,g.inject)(k.TYPES.IPostProcessor),j(I=(O=function(){function S(){(0,_.default)(this,S),(0,L.default)(this,"passes",[]),(0,w.default)(this,"postProcessor",D,this),(0,L.default)(this,"layer",void 0),(0,L.default)(this,"renderFlag",void 0),(0,L.default)(this,"width",0),(0,L.default)(this,"height",0)}return(0,P.default)(S,[{key:"setLayer",value:function(x){this.layer=x}},{key:"setRenderFlag",value:function(x){this.renderFlag=x}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var A=(0,o.default)(F.default.mark(function z(){var B,V,Q;return F.default.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:B=R(this.passes),re.prev=1,B.s();case 3:if((V=B.n()).done){re.next=9;break}return Q=V.value,re.next=7,Q.render(this.layer);case 7:re.next=3;break;case 9:re.next=14;break;case 11:re.prev=11,re.t0=re.catch(1),B.e(re.t0);case 14:return re.prev=14,B.f(),re.finish(14);case 17:this.layer.renderModels();case 18:case"end":return re.stop()}},z,this,[[1,11,14,17]])}));function x(){return A.apply(this,arguments)}return x}()},{key:"resize",value:function(x,z){(this.width!==x||this.height!==z)&&(this.width=x,this.height=z)}},{key:"add",value:function(x,z){x.getType()===M.PassType.PostProcessing?this.postProcessor.add(x,this.layer,z):(x.init(this.layer,z),this.passes.push(x))}},{key:"insert",value:function(x,z,B){x.init(this.layer,z),this.passes.splice(B,0,x)}},{key:"destroy",value:function(){this.passes.length=0}}]),S}(),D=(0,d.default)(O.prototype,"postProcessor",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O))||I);c.default=h},65528:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(81506)),P=i(n(16525)),L=i(n(2205)),d=i(n(78585)),E=i(n(29754)),g=i(n(59713)),k=n(82887),M=n(86700);n(28660);var j=n(77235),U=n(7403),I=n(45857),O=i(n(94080)),D,R;function y(x,z){var B=Object.keys(x);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(x);z&&(V=V.filter(function(Q){return Object.getOwnPropertyDescriptor(x,Q).enumerable})),B.push.apply(B,V)}return B}function v(x){for(var z=1;z<arguments.length;z++){var B=arguments[z]!=null?arguments[z]:{};z%2?y(Object(B),!0).forEach(function(V){(0,g.default)(x,V,B[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(B)):y(Object(B)).forEach(function(V){Object.defineProperty(x,V,Object.getOwnPropertyDescriptor(B,V))})}return x}function h(x){var z=S();return function(){var V=(0,E.default)(x),Q;if(z){var oe=(0,E.default)(this).constructor;Q=Reflect.construct(V,arguments,oe)}else Q=V.apply(this,arguments);return(0,d.default)(this,Q)}}function S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(x){return!1}}var A=(D=(0,M.injectable)(),D(R=function(x){(0,L.default)(B,x);var z=h(B);function B(){var V;(0,o.default)(this,B);for(var Q=arguments.length,oe=new Array(Q),re=0;re<Q;re++)oe[re]=arguments[re];return V=z.call.apply(z,[this].concat(oe)),(0,g.default)((0,_.default)(V),"pickingFBO",void 0),(0,g.default)((0,_.default)(V),"layer",void 0),(0,g.default)((0,_.default)(V),"width",0),(0,g.default)((0,_.default)(V),"height",0),(0,g.default)((0,_.default)(V),"alreadyInRendering",!1),(0,g.default)((0,_.default)(V),"pickFromPickingFBO",function(Z){var ee=Z.x,H=Z.y,ae=Z.lngLat,G=Z.type;if(!(!V.layer.isVisible()||!V.layer.needPick(G))){var ie=V.rendererService,le=ie.getViewportSize,Me=ie.readPixels,ge=ie.useFramebuffer,pe=le(),Ne=pe.width,Re=pe.height,he=V.layer.getLayerConfig(),se=he.enableHighlight,J=he.enableSelect,fe=ee*k.DOM.DPR,me=H*k.DOM.DPR;if(!(fe>Ne||fe<0||me>Re||me<0)){var Le;ge(V.pickingFBO,function(){var C;if(Le=Me({x:Math.round(fe),y:Math.round(Re-(H+1)*k.DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:V.pickingFBO}),Le[0]!==0||Le[1]!==0||Le[2]!==0){var X=(0,k.decodePickingColor)(Le),de=V.layer.getSource().getFeatureById(X),Ae={x:ee,y:H,type:G,lngLat:ae,featureId:X,feature:de};de&&(V.layer.setCurrentPickId(X),V.triggerHoverOnLayer(Ae))}else{var De={x:ee,y:H,lngLat:ae,type:V.layer.getCurrentPickId()===null?"un"+G:"mouseout",featureId:null,feature:null};V.triggerHoverOnLayer(v(v({},De),{},{type:"unpick"})),V.triggerHoverOnLayer(De),V.layer.setCurrentPickId(null)}se&&V.highlightPickedFeature(Le),J&&G==="click"&&((C=Le)===null||C===void 0?void 0:C.toString())!==[0,0,0,0].toString()&&V.selectFeature(Le)})}}}),V}return(0,w.default)(B,[{key:"getType",value:function(){return I.PassType.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(Q,oe){(0,P.default)((0,E.default)(B.prototype),"init",this).call(this,Q,oe),this.layer=Q;var re=this.rendererService,Z=re.createTexture2D,ee=re.createFramebuffer,H=re.getViewportSize,ae=H(),G=ae.width,ie=ae.height;this.pickingFBO=ee({color:Z({width:G,height:ie,wrapS:U.gl.CLAMP_TO_EDGE,wrapT:U.gl.CLAMP_TO_EDGE})}),this.interactionService.on(j.InteractionEvent.Hover,this.pickFromPickingFBO),this.interactionService.on(j.InteractionEvent.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(j.InteractionEvent.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(Q){var oe=this;if(!this.alreadyInRendering){var re=this.rendererService,Z=re.getViewportSize,ee=re.useFramebuffer,H=re.clear,ae=Z(),G=ae.width,ie=ae.height;this.alreadyInRendering=!0,(this.width!==G||this.height!==ie)&&(this.pickingFBO.resize({width:G,height:ie}),this.width=G,this.height=ie),ee(this.pickingFBO,function(){H({framebuffer:oe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var le=oe.layer.multiPassRenderer.getRenderFlag();oe.layer.multiPassRenderer.setRenderFlag(!1),Q.hooks.beforePickingEncode.call(),Q.render(),Q.hooks.afterPickingEncode.call(),oe.layer.multiPassRenderer.setRenderFlag(le),oe.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(Q){this.layer.emit(Q.type,Q)}},{key:"highlightPickedFeature",value:function(Q){var oe=(0,F.default)(Q,3),re=oe[0],Z=oe[1],ee=oe[2];this.layer.hooks.beforeHighlight.call([re,Z,ee]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(Q){var oe=(0,F.default)(Q,3),re=oe[0],Z=oe[1],ee=oe[2];this.layer.hooks.beforeSelect.call([re,Z,ee]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(Q){var oe=Q.featureId,re=(0,k.encodePickingColor)(oe);this.selectFeature(new Uint8Array(re))}},{key:"highlightFeatureHandle",value:function(Q){var oe=Q.featureId,re=(0,k.encodePickingColor)(oe);this.highlightPickedFeature(new Uint8Array(re))}}]),B}(O.default))||R);c.default=A},97985:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(48926)),w=i(n(21165)),_=i(n(34575)),P=i(n(93913)),L=i(n(59713)),d=i(n(33124)),E=i(n(67268)),g=n(86700);n(28660);var k=n(19403),M,j,U,I,O,D,R=(M=(0,g.injectable)(),j=(0,g.inject)(k.TYPES.IRendererService),U=(0,g.postConstruct)(),M(I=(O=function(){function y(){(0,_.default)(this,y),(0,w.default)(this,"rendererService",D,this),(0,L.default)(this,"passes",[]),(0,L.default)(this,"readFBO",void 0),(0,L.default)(this,"writeFBO",void 0)}return(0,P.default)(y,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var v=(0,o.default)(F.default.mark(function S(A){var x,z;return F.default.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:x=0;case 1:if(!(x<this.passes.length)){V.next=10;break}return z=this.passes[x],z.setRenderToScreen(this.isLastEnabledPass(x)),V.next=6,z.render(A);case 6:x!==this.passes.length-1&&this.swap();case 7:x++,V.next=1;break;case 10:case"end":return V.stop()}},S,this)}));function h(S){return v.apply(this,arguments)}return h}()},{key:"resize",value:function(h,S){this.readFBO.resize({width:h,height:S}),this.writeFBO.resize({width:h,height:S})}},{key:"add",value:function(h,S,A){h.init(S,A),this.passes.push(h)}},{key:"insert",value:function(h,S,A,x){h.init(A,x),this.passes.splice(S,0,h)}},{key:"getPostProcessingPassByName",value:function(h){return this.passes.find(function(S){return S.getName()===h})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(h){for(var S=h+1;S<this.passes.length;S++)if(this.passes[S].isEnabled())return!1;return!0}},{key:"swap",value:function(){var h=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=h}}]),y}(),D=(0,d.default)(O.prototype,"rendererService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,d.default)(O.prototype,"init",[U],Object.getOwnPropertyDescriptor(O.prototype,"init"),O.prototype),O))||I);c.default=R},74916:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(16525)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=n(86700);n(28660);var E=n(45857),g=i(n(94080)),k,M;function j(O){var D=U();return function(){var y=(0,L.default)(O),v;if(D){var h=(0,L.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,P.default)(this,v)}}function U(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var I=(k=(0,d.injectable)(),k(M=function(O){(0,_.default)(R,O);var D=j(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"getType",value:function(){return E.PassType.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(v,h){(0,w.default)((0,L.default)(R.prototype),"init",this).call(this,v,h)}},{key:"render",value:function(v){var h=this.rendererService,S=h.useFramebuffer,A=h.clear;S(null,function(){A({color:[0,0,0,0],depth:1,stencil:0}),v.multiPassRenderer.setRenderFlag(!1),v.render(),v.multiPassRenderer.setRenderFlag(!0)})}}]),R}(g.default))||M);c.default=I},89431:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(81506)),P=i(n(16525)),L=i(n(2205)),d=i(n(78585)),E=i(n(29754)),g=i(n(59713)),k=i(n(33124)),M=i(n(67268)),j=n(86700);n(28660);var U=n(19403),I=n(7403),O=n(45857),D=i(n(94080)),R,y,v,h,S;function A(H,ae){var G=Object.keys(H);if(Object.getOwnPropertySymbols){var ie=Object.getOwnPropertySymbols(H);ae&&(ie=ie.filter(function(le){return Object.getOwnPropertyDescriptor(H,le).enumerable})),G.push.apply(G,ie)}return G}function x(H){for(var ae=1;ae<arguments.length;ae++){var G=arguments[ae]!=null?arguments[ae]:{};ae%2?A(Object(G),!0).forEach(function(ie){(0,g.default)(H,ie,G[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(G)):A(Object(G)).forEach(function(ie){Object.defineProperty(H,ie,Object.getOwnPropertyDescriptor(G,ie))})}return H}function z(H){var ae=B();return function(){var ie=(0,E.default)(H),le;if(ae){var Me=(0,E.default)(this).constructor;le=Reflect.construct(ie,arguments,Me)}else le=ie.apply(this,arguments);return(0,d.default)(this,le)}}function B(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(H){return!1}}var V=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Q=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,oe=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function re(H,ae){for(var G=0,ie=1/ae,le=H;le>0;)G=G+ie*(le%ae),le=Math.floor(le/ae),ie=ie/ae;return G}var Z=1,ee=(R=(0,j.injectable)(),y=(0,j.inject)(U.TYPES.IShaderModuleService),R(v=(h=function(H){(0,L.default)(G,H);var ae=z(G);function G(){var ie;(0,o.default)(this,G);for(var le=arguments.length,Me=new Array(le),ge=0;ge<le;ge++)Me[ge]=arguments[ge];return ie=ae.call.apply(ae,[this].concat(Me)),(0,F.default)((0,_.default)(ie),"shaderModuleService",S,(0,_.default)(ie)),(0,g.default)((0,_.default)(ie),"haltonSequence",[]),(0,g.default)((0,_.default)(ie),"accumulatingId",0),(0,g.default)((0,_.default)(ie),"frame",0),(0,g.default)((0,_.default)(ie),"timer",void 0),(0,g.default)((0,_.default)(ie),"sampleRenderTarget",void 0),(0,g.default)((0,_.default)(ie),"prevRenderTarget",void 0),(0,g.default)((0,_.default)(ie),"outputRenderTarget",void 0),(0,g.default)((0,_.default)(ie),"copyRenderTarget",void 0),(0,g.default)((0,_.default)(ie),"blendModel",void 0),(0,g.default)((0,_.default)(ie),"outputModel",void 0),(0,g.default)((0,_.default)(ie),"copyModel",void 0),ie}return(0,w.default)(G,[{key:"getType",value:function(){return O.PassType.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(le,Me){(0,P.default)((0,E.default)(G.prototype),"init",this).call(this,le,Me);var ge=this.rendererService,pe=ge.createFramebuffer,Ne=ge.createTexture2D;this.sampleRenderTarget=pe({color:Ne({width:1,height:1,wrapS:I.gl.CLAMP_TO_EDGE,wrapT:I.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=pe({color:Ne({width:1,height:1,wrapS:I.gl.CLAMP_TO_EDGE,wrapT:I.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=pe({color:Ne({width:1,height:1,wrapS:I.gl.CLAMP_TO_EDGE,wrapT:I.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=pe({color:Ne({width:1,height:1,wrapS:I.gl.CLAMP_TO_EDGE,wrapT:I.gl.CLAMP_TO_EDGE})});for(var Re=0;Re<30;Re++)this.haltonSequence.push([re(Re,2),re(Re,3)]);this.blendModel=this.createTriangleModel("blend-pass",V),this.outputModel=this.createTriangleModel("copy-pass",Q,{blend:{enable:!0,func:{srcRGB:I.gl.ONE,dstRGB:I.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:I.gl.ONE,dstAlpha:I.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:I.gl.FUNC_ADD,alpha:I.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Q)}},{key:"render",value:function(le){var Me=this,ge=this.rendererService,pe=ge.clear,Ne=ge.getViewportSize,Re=ge.useFramebuffer,he=Ne(),se=he.width,J=he.height;this.sampleRenderTarget.resize({width:se,height:J}),this.prevRenderTarget.resize({width:se,height:J}),this.outputRenderTarget.resize({width:se,height:J}),this.copyRenderTarget.resize({width:se,height:J}),this.resetFrame(),this.stopAccumulating();var fe=le.multiPassRenderer.getPostProcessor().getReadFBO();Re(fe,function(){pe({color:[0,0,0,0],depth:1,stencil:0,framebuffer:fe}),le.multiPassRenderer.setRenderFlag(!1),le.render(),le.multiPassRenderer.setRenderFlag(!0)});var me=function Le(C){!Me.accumulatingId||C!==Me.accumulatingId||Me.isFinished()||(Me.doRender(le),requestAnimationFrame(function(){Le(C)}))};this.accumulatingId=Z++,this.timer=window.setTimeout(function(){me(Me.accumulatingId)},50)}},{key:"doRender",value:function(le){var Me=this,ge=this.rendererService,pe=ge.clear,Ne=ge.getViewportSize,Re=ge.useFramebuffer,he=Ne(),se=he.width,J=he.height,fe=le.getLayerConfig(),me=fe.jitterScale,Le=me===void 0?1:me,C=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((C[0]*2-1)/se*Le,(C[1]*2-1)/J*Le),le.multiPassRenderer.setRenderFlag(!1),le.hooks.beforeRender.call(),Re(this.sampleRenderTarget,function(){pe({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Me.sampleRenderTarget}),le.render()}),le.hooks.afterRender.call(),le.multiPassRenderer.setRenderFlag(!0);var X=le.getLayerConfig();Re(this.outputRenderTarget,function(){Me.blendModel.draw({uniforms:{u_opacity:X.opacity||1,u_MixRatio:Me.frame===0?1:.9,u_Diffuse1:Me.sampleRenderTarget,u_Diffuse2:Me.frame===0?le.multiPassRenderer.getPostProcessor().getReadFBO():Me.prevRenderTarget}})}),this.frame===0&&pe({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Re(this.copyRenderTarget,function(){Me.outputModel.draw({uniforms:{u_Texture:Me.outputRenderTarget}})}),Re(le.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Me.copyModel.draw({uniforms:{u_Texture:Me.copyRenderTarget}})}),le.multiPassRenderer.getPostProcessor().render(le));var de=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=de,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(le,Me,ge){this.shaderModuleService.registerModule(le,{vs:oe,fs:Me});var pe=this.shaderModuleService.getModule(le),Ne=pe.vs,Re=pe.fs,he=pe.uniforms,se=this.rendererService,J=se.createAttribute,fe=se.createBuffer,me=se.createModel;return me(x({vs:Ne,fs:Re,attributes:{a_Position:J({buffer:fe({data:[-4,-4,4,-4,0,4],type:I.gl.FLOAT}),size:2})},uniforms:x({},he),depth:{enable:!1},count:3},ge))}}]),G}(D.default),S=(0,k.default)(h.prototype,"shaderModuleService",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h))||v);c.default=ee},34945:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(59713)),o=i(n(34575)),w=i(n(93913)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(14293)),E=n(86700);n(28660);var g=i(n(36770)),k,M;function j(v,h){var S=Object.keys(v);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(v);h&&(A=A.filter(function(x){return Object.getOwnPropertyDescriptor(v,x).enumerable})),S.push.apply(S,A)}return S}function U(v){for(var h=1;h<arguments.length;h++){var S=arguments[h]!=null?arguments[h]:{};h%2?j(Object(S),!0).forEach(function(A){(0,F.default)(v,A,S[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(S)):j(Object(S)).forEach(function(A){Object.defineProperty(v,A,Object.getOwnPropertyDescriptor(S,A))})}return v}function I(v){var h=O();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var D=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,R=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,y=(k=(0,E.injectable)(),k(M=function(v){(0,_.default)(S,v);var h=I(S);function S(){return(0,o.default)(this,S),h.apply(this,arguments)}return(0,w.default)(S,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:R,fs:D});var x=this.shaderModuleService.getModule("blur-pass"),z=x.vs,B=x.fs,V=x.uniforms,Q=this.rendererService.getViewportSize(),oe=Q.width,re=Q.height;return{vs:z,fs:B,uniforms:U(U({},V),{},{u_ViewportSize:[oe,re]})}}},{key:"convertOptionsToUniforms",value:function(x){var z={};return(0,d.default)(x.blurRadius)||(z.u_BlurDir=[x.blurRadius,0]),z}}]),S}(g.default))||M);c.default=y},38800:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(59713)),o=i(n(34575)),w=i(n(93913)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(14293)),E=n(86700),g=i(n(36770)),k,M;function j(v,h){var S=Object.keys(v);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(v);h&&(A=A.filter(function(x){return Object.getOwnPropertyDescriptor(v,x).enumerable})),S.push.apply(S,A)}return S}function U(v){for(var h=1;h<arguments.length;h++){var S=arguments[h]!=null?arguments[h]:{};h%2?j(Object(S),!0).forEach(function(A){(0,F.default)(v,A,S[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(S)):j(Object(S)).forEach(function(A){Object.defineProperty(v,A,Object.getOwnPropertyDescriptor(S,A))})}return v}function I(v){var h=O();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var D=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,R=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,y=(k=(0,E.injectable)(),k(M=function(v){(0,_.default)(S,v);var h=I(S);function S(){return(0,o.default)(this,S),h.apply(this,arguments)}return(0,w.default)(S,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:R,fs:D});var x=this.shaderModuleService.getModule("blur-pass"),z=x.vs,B=x.fs,V=x.uniforms,Q=this.rendererService.getViewportSize(),oe=Q.width,re=Q.height;return{vs:z,fs:B,uniforms:U(U({},V),{},{u_ViewportSize:[oe,re]})}}},{key:"convertOptionsToUniforms",value:function(x){var z={};return(0,d.default)(x.blurRadius)||(z.u_BlurDir=[0,x.blurRadius]),z}}]),S}(g.default))||M);c.default=y},50797:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(59713)),o=i(n(34575)),w=i(n(93913)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=n(86700);n(28660);var E=i(n(36770)),g,k;function M(y,v){var h=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);v&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(y,A).enumerable})),h.push.apply(h,S)}return h}function j(y){for(var v=1;v<arguments.length;v++){var h=arguments[v]!=null?arguments[v]:{};v%2?M(Object(h),!0).forEach(function(S){(0,F.default)(y,S,h[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(h)):M(Object(h)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(h,S))})}return y}function U(y){var v=I();return function(){var S=(0,L.default)(y),A;if(v){var x=(0,L.default)(this).constructor;A=Reflect.construct(S,arguments,x)}else A=S.apply(this,arguments);return(0,P.default)(this,A)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}var O=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,D=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,R=(g=(0,d.injectable)(),g(k=function(y){(0,_.default)(h,y);var v=U(h);function h(){return(0,o.default)(this,h),v.apply(this,arguments)}return(0,w.default)(h,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:D,fs:O});var A=this.shaderModuleService.getModule("colorhalftone-pass"),x=A.vs,z=A.fs,B=A.uniforms,V=this.rendererService.getViewportSize(),Q=V.width,oe=V.height;return{vs:x,fs:z,uniforms:j(j({},B),{},{u_ViewportSize:[Q,oe]})}}}]),h}(E.default))||k);c.default=R},94358:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(86700);n(28660);var d=i(n(36770)),E,g;function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,U=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,I=(E=(0,L.injectable)(),E(g=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:U,fs:j}),this.shaderModuleService.getModule("copy-pass")}}]),R}(d.default))||g);c.default=I},86751:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(59713)),o=i(n(34575)),w=i(n(93913)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=n(86700);n(28660);var E=i(n(36770)),g,k;function M(y,v){var h=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);v&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(y,A).enumerable})),h.push.apply(h,S)}return h}function j(y){for(var v=1;v<arguments.length;v++){var h=arguments[v]!=null?arguments[v]:{};v%2?M(Object(h),!0).forEach(function(S){(0,F.default)(y,S,h[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(h)):M(Object(h)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(h,S))})}return y}function U(y){var v=I();return function(){var S=(0,L.default)(y),A;if(v){var x=(0,L.default)(this).constructor;A=Reflect.construct(S,arguments,x)}else A=S.apply(this,arguments);return(0,P.default)(this,A)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}var O=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,D=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,R=(g=(0,d.injectable)(),g(k=function(y){(0,_.default)(h,y);var v=U(h);function h(){return(0,o.default)(this,h),v.apply(this,arguments)}return(0,w.default)(h,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:D,fs:O});var A=this.shaderModuleService.getModule("hexagonalpixelate-pass"),x=A.vs,z=A.fs,B=A.uniforms,V=this.rendererService.getViewportSize(),Q=V.width,oe=V.height;return{vs:x,fs:z,uniforms:j(j({},B),{},{u_ViewportSize:[Q,oe]})}}}]),h}(E.default))||k);c.default=R},46359:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(59713)),o=i(n(34575)),w=i(n(93913)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=n(86700);n(28660);var E=i(n(36770)),g,k;function M(y,v){var h=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);v&&(S=S.filter(function(A){return Object.getOwnPropertyDescriptor(y,A).enumerable})),h.push.apply(h,S)}return h}function j(y){for(var v=1;v<arguments.length;v++){var h=arguments[v]!=null?arguments[v]:{};v%2?M(Object(h),!0).forEach(function(S){(0,F.default)(y,S,h[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(h)):M(Object(h)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(h,S))})}return y}function U(y){var v=I();return function(){var S=(0,L.default)(y),A;if(v){var x=(0,L.default)(this).constructor;A=Reflect.construct(S,arguments,x)}else A=S.apply(this,arguments);return(0,P.default)(this,A)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}var O=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,D=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,R=(g=(0,d.injectable)(),g(k=function(y){(0,_.default)(h,y);var v=U(h);function h(){return(0,o.default)(this,h),v.apply(this,arguments)}return(0,w.default)(h,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:D,fs:O});var A=this.shaderModuleService.getModule("ink-pass"),x=A.vs,z=A.fs,B=A.uniforms,V=this.rendererService.getViewportSize(),Q=V.width,oe=V.height;return{vs:x,fs:z,uniforms:j(j({},B),{},{u_ViewportSize:[Q,oe]})}}}]),h}(E.default))||k);c.default=R},67754:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(86700);n(28660);var d=i(n(36770)),E,g;function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,U=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,I=(E=(0,L.injectable)(),E(g=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:U,fs:j}),this.shaderModuleService.getModule("noise-pass")}}]),R}(d.default))||g);c.default=I},47100:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(86700);n(28660);var d=i(n(36770)),E,g;function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,U=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,I=(E=(0,L.injectable)(),E(g=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:j,fs:U}),this.shaderModuleService.getModule("sepia-pass")}}]),R}(d.default))||g);c.default=I},14989:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SceneEventList=void 0;var n=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];c.SceneEventList=n},17768:function(Te,c,n){"use strict";var i=n(95318),F=n(20862);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=i(n(87757)),w=i(n(48926)),_=i(n(21165)),P=i(n(34575)),L=i(n(93913)),d=i(n(81506)),E=i(n(2205)),g=i(n(78585)),k=i(n(29754)),M=i(n(59713)),j=i(n(33124)),U=i(n(67268)),I=n(46343),O=n(82887),D=F(n(67709)),R=n(26729),y=n(86700);n(28660);var v=n(19403),h=n(11204),S=n(77235),A,x,z,B,V,Q,oe,re,Z,ee,H,ae,G,ie,le,Me,ge,pe,Ne,Re,he,se,J,fe,me,Le,C,X,de,Ae,De,Ge,$e;function ct(xe){var Mt=gt();return function(){var At=(0,k.default)(xe),nt;if(Mt){var it=(0,k.default)(this).constructor;nt=Reflect.construct(At,arguments,it)}else nt=At.apply(this,arguments);return(0,g.default)(this,nt)}}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(xe){return!1}}var st=(A=(0,y.injectable)(),x=(0,y.inject)(v.TYPES.SceneID),z=(0,y.inject)(v.TYPES.IIconService),B=(0,y.inject)(v.TYPES.IFontService),V=(0,y.inject)(v.TYPES.IControlService),Q=(0,y.inject)(v.TYPES.IGlobalConfigService),oe=(0,y.inject)(v.TYPES.IMapService),re=(0,y.inject)(v.TYPES.ICoordinateSystemService),Z=(0,y.inject)(v.TYPES.IRendererService),ee=(0,y.inject)(v.TYPES.ILayerService),H=(0,y.inject)(v.TYPES.ICameraService),ae=(0,y.inject)(v.TYPES.IInteractionService),G=(0,y.inject)(v.TYPES.IPickingService),ie=(0,y.inject)(v.TYPES.IShaderModuleService),le=(0,y.inject)(v.TYPES.IMarkerService),Me=(0,y.inject)(v.TYPES.IPopupService),A(ge=(pe=function(xe){(0,E.default)(Ut,xe);var Mt=ct(Ut);function Ut(){var At;return(0,P.default)(this,Ut),At=Mt.call(this),(0,M.default)((0,d.default)(At),"destroyed",!1),(0,M.default)((0,d.default)(At),"loaded",!1),(0,M.default)((0,d.default)(At),"loadFont",!1),(0,M.default)((0,d.default)(At),"fontFamily",""),(0,_.default)((0,d.default)(At),"id",Ne,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"iconService",Re,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"fontService",he,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"controlService",se,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"configService",J,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"map",fe,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"coordinateSystemService",me,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"rendererService",Le,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"layerService",C,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"cameraService",X,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"interactionService",de,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"pickingService",Ae,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"shaderModuleService",De,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"markerService",Ge,(0,d.default)(At)),(0,_.default)((0,d.default)(At),"popupService",$e,(0,d.default)(At)),(0,M.default)((0,d.default)(At),"inited",!1),(0,M.default)((0,d.default)(At),"initPromise",void 0),(0,M.default)((0,d.default)(At),"rendering",!1),(0,M.default)((0,d.default)(At),"$container",void 0),(0,M.default)((0,d.default)(At),"canvas",void 0),(0,M.default)((0,d.default)(At),"markerContainer",void 0),(0,M.default)((0,d.default)(At),"hooks",void 0),(0,M.default)((0,d.default)(At),"handleWindowResized",function(){At.emit("resize"),At.$container&&(At.initContainer(),O.DOM.triggerResize(),At.coordinateSystemService.needRefresh=!0,At.render())}),(0,M.default)((0,d.default)(At),"handleMapCameraChanged",function(nt){At.cameraService.update(nt),At.render()}),At.hooks={init:new I.AsyncParallelHook},At}return(0,L.default)(Ut,[{key:"init",value:function(nt){var it=this;this.configService.setSceneConfig(this.id,nt),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,w.default)(o.default.mark(function pt(){return o.default.wrap(function(Er){for(;;)switch(Er.prev=Er.next){case 0:return Er.next=2,new Promise(function(mr){it.map.onCameraChanged(function(Br){it.cameraService.init(),it.cameraService.update(Br),it.map.version!=="GAODE2.x"&&mr()}),it.map.version!=="GAODE2.x"?it.map.init():mr()});case 2:if(!(it.map.version==="GAODE2.x"&&it.map.initViewPort)){Er.next=6;break}return Er.next=5,it.map.init();case 5:it.map.initViewPort();case 6:it.map.onCameraChanged(it.handleMapCameraChanged),it.map.addMarkerContainer(),it.markerService.addMarkers(),it.markerService.addMarkerLayers(),it.popupService.initPopup(),it.interactionService.init(),it.interactionService.on(S.InteractionEvent.Drag,it.addSceneEvent.bind(it));case 13:case"end":return Er.stop()}},pt)}))),this.hooks.init.tapPromise("initRenderer",(0,w.default)(o.default.mark(function pt(){var Vt;return o.default.wrap(function(mr){for(;;)switch(mr.prev=mr.next){case 0:if(Vt=(0,h.createRendererContainer)(it.configService.getSceneConfig(it.id).id||""),it.$container=Vt,!Vt){mr.next=11;break}return it.canvas=O.DOM.create("canvas","",Vt),it.setCanvas(),mr.next=7,it.rendererService.init(it.canvas,it.configService.getSceneConfig(it.id));case 7:(0,D.default)(it.$container,it.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(it.handleWindowResized),mr.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:it.pickingService.init(it.id);case 13:case"end":return mr.stop()}},pt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(nt){this.layerService.add(nt),this.render()}},{key:"render",value:function(){var At=(0,w.default)(o.default.mark(function it(){return o.default.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(!(this.rendering||this.destroyed)){Vt.next=2;break}return Vt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Vt.next=15;break}return Vt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Vt.next=10;break}return Vt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return Vt.stop()}},it,this)}));function nt(){return At.apply(this,arguments)}return nt}()},{key:"addFontFace",value:function(nt,it){this.fontFamily=nt;var pt=document.createElement("style");pt.type="text/css",pt.innerText=`
        @font-face{
            font-family: '`.concat(nt,`';
            src: url('`).concat(it,`') format('woff2'),
            url('`).concat(it,`') format('woff'),
            url('`).concat(it,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(pt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(nt){var it,pt=(it=this.$container)===null||it===void 0?void 0:it.getElementsByTagName("canvas")[0];this.render();var Vt=nt==="jpg"?pt==null?void 0:pt.toDataURL("image/jpeg"):pt==null?void 0:pt.toDataURL("image/png");return Vt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var nt=this.$container.parentElement;nt!==null&&(this.markerContainer=O.DOM.create("div","l7-marker-container",nt))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,D.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var nt,it,pt=O.DOM.DPR,Vt=((nt=this.$container)===null||nt===void 0?void 0:nt.clientWidth)||400,Er=((it=this.$container)===null||it===void 0?void 0:it.clientHeight)||300,mr=this.canvas;mr&&(mr.width=Vt*pt,mr.height=Er*pt,mr.style.width="".concat(Vt,"px"),mr.style.height="".concat(Er,"px")),this.rendererService.viewport({x:0,y:0,width:pt*Vt,height:pt*Er})}},{key:"setCanvas",value:function(){var nt,it,pt=O.DOM.DPR,Vt=((nt=this.$container)===null||nt===void 0?void 0:nt.clientWidth)||400,Er=((it=this.$container)===null||it===void 0?void 0:it.clientHeight)||300,mr=this.canvas;mr.width=Vt*pt,mr.height=Er*pt,mr.style.width="".concat(Vt,"px"),mr.style.height="".concat(Er,"px")}},{key:"addSceneEvent",value:function(nt){this.emit(nt.type,nt)}}]),Ut}(R.EventEmitter),Ne=(0,j.default)(pe.prototype,"id",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=(0,j.default)(pe.prototype,"iconService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=(0,j.default)(pe.prototype,"fontService",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=(0,j.default)(pe.prototype,"controlService",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=(0,j.default)(pe.prototype,"configService",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=(0,j.default)(pe.prototype,"map",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=(0,j.default)(pe.prototype,"coordinateSystemService",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Le=(0,j.default)(pe.prototype,"rendererService",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,j.default)(pe.prototype,"layerService",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=(0,j.default)(pe.prototype,"cameraService",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de=(0,j.default)(pe.prototype,"interactionService",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ae=(0,j.default)(pe.prototype,"pickingService",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=(0,j.default)(pe.prototype,"shaderModuleService",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge=(0,j.default)(pe.prototype,"markerService",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e=(0,j.default)(pe.prototype,"popupService",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe))||ge);c.default=st},8039:function(){"use strict"},71002:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(44908)),P=n(86700);n(28660);var L=n(29739),d,E;function g(oe,re){var Z=Object.keys(oe);if(Object.getOwnPropertySymbols){var ee=Object.getOwnPropertySymbols(oe);re&&(ee=ee.filter(function(H){return Object.getOwnPropertyDescriptor(oe,H).enumerable})),Z.push.apply(Z,ee)}return Z}function k(oe){for(var re=1;re<arguments.length;re++){var Z=arguments[re]!=null?arguments[re]:{};re%2?g(Object(Z),!0).forEach(function(ee){(0,w.default)(oe,ee,Z[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(oe,Object.getOwnPropertyDescriptors(Z)):g(Object(Z)).forEach(function(ee){Object.defineProperty(oe,ee,Object.getOwnPropertyDescriptor(Z,ee))})}return oe}var M="#define PI 3.14159265359",j=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,U=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,I=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,O=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,D=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,R=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,y=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,v=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,h=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,S=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,A=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,x=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,z=/precision\s+(high|low|medium)p\s+float/,B=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,V=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Q=(d=(0,P.injectable)(),d(E=function(){function oe(){(0,F.default)(this,oe),(0,w.default)(this,"moduleCache",{}),(0,w.default)(this,"rawContentCache",{})}return(0,o.default)(oe,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:M,fs:M}),this.registerModule("decode",{vs:j,fs:""}),this.registerModule("projection",{vs:y,fs:""}),this.registerModule("project",{vs:R,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:v}),this.registerModule("lighting",{vs:I,fs:""}),this.registerModule("light",{vs:U,fs:""}),this.registerModule("picking",{vs:D,fs:O}),this.registerModule("styleMapping",{vs:h,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:S,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:A,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:x,fs:""})}},{key:"registerModule",value:function(Z,ee){if(!this.rawContentCache[Z]){var H=ee.vs,ae=ee.fs,G=ee.uniforms,ie=(0,L.extractUniforms)(H),le=ie.content,Me=ie.uniforms,ge=(0,L.extractUniforms)(ae),pe=ge.content,Ne=ge.uniforms;this.rawContentCache[Z]={fs:pe,uniforms:k(k(k({},Me),Ne),G),vs:le}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(Z){var ee=this;if(this.moduleCache[Z])return this.moduleCache[Z];var H=this.rawContentCache[Z].vs,ae=this.rawContentCache[Z].fs,G=this.processModule(H,[],"vs"),ie=G.content,le=G.includeList,Me=this.processModule(ae,[],"fs"),ge=Me.content,pe=Me.includeList,Ne=ge,Re=(0,_.default)(le.concat(pe).concat(Z)).reduce(function(he,se){return k(k({},he),ee.rawContentCache[se].uniforms)},{});return z.test(ge)||(Ne=B+ge),this.moduleCache[Z]={fs:Ne.trim(),uniforms:Re,vs:ie.trim()},this.moduleCache[Z]}},{key:"processModule",value:function(Z,ee,H){var ae=this,G=Z.replace(V,function(ie,le){var Me=le.split(" "),ge=Me[0].replace(/"/g,"");if(ee.indexOf(ge)>-1)return"";var pe=ae.rawContentCache[ge][H];ee.push(ge);var Ne=ae.processModule(pe,ee,H),Re=Ne.content;return Re});return{content:G,includeList:ee}}}]),oe}())||E);c.default=Q},46770:function(){"use strict"},19403:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.TYPES=void 0;var n={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")};c.TYPES=n},65196:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,F.default)(this,P),(0,w.default)(this,"autoStart",void 0),(0,w.default)(this,"startTime",0),(0,w.default)(this,"oldTime",0),(0,w.default)(this,"running",!1),(0,w.default)(this,"elapsedTime",0),this.autoStart=L}return(0,o.default)(P,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var d=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var E=(typeof performance=="undefined"?Date:performance).now();d=(E-this.oldTime)/1e3,this.oldTime=E,this.elapsedTime+=d}return d}}]),P}();c.default=_},11204:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createRendererContainer=F;var n=window.document.documentElement.style,i=0;function F(o){var w=o;if(typeof o=="string"&&(w=document.getElementById(o)),w){var _=document.createElement("div");return _.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,_.id="l7-scene-".concat(i++),_.classList.add("l7-scene"),w.appendChild(_),_}return null}},28955:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.buildMapping=E,c.buildIconMaping=g,c.nextPowOfTwo=M;var F=i(n(59713));function o(j,U){var I=Object.keys(j);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(j);U&&(O=O.filter(function(D){return Object.getOwnPropertyDescriptor(j,D).enumerable})),I.push.apply(I,O)}return I}function w(j){for(var U=1;U<arguments.length;U++){var I=arguments[U]!=null?arguments[U]:{};U%2?o(Object(I),!0).forEach(function(O){(0,F.default)(j,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(I)):o(Object(I)).forEach(function(O){Object.defineProperty(j,O,Object.getOwnPropertyDescriptor(I,O))})}return j}function _(j,U){var I=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!I){if(Array.isArray(j)||(I=P(j))||U&&j&&typeof j.length=="number"){I&&(j=I);var O=0,D=function(){};return{s:D,n:function(){return O>=j.length?{done:!0}:{done:!1,value:j[O++]}},e:function(S){throw S},f:D}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R=!0,y=!1,v;return{s:function(){I=I.call(j)},n:function(){var S=I.next();return R=S.done,S},e:function(S){y=!0,v=S},f:function(){try{!R&&I.return!=null&&I.return()}finally{if(y)throw v}}}}function P(j,U){if(!!j){if(typeof j=="string")return L(j,U);var I=Object.prototype.toString.call(j).slice(8,-1);if(I==="Object"&&j.constructor&&(I=j.constructor.name),I==="Map"||I==="Set")return Array.from(j);if(I==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return L(j,U)}}function L(j,U){(U==null||U>j.length)&&(U=j.length);for(var I=0,O=new Array(U);I<U;I++)O[I]=j[I];return O}var d=30;function E(j){var U=j.characterSet,I=j.getFontWidth,O=j.fontHeight,D=j.buffer,R=j.maxCanvasWidth,y=j.mapping,v=y===void 0?{}:y,h=j.xOffset,S=h===void 0?0:h,A=j.yOffset,x=A===void 0?0:A,z=0,B=S;Array.from(U).forEach(function(Q,oe){if(!v[Q]){var re=I(Q,oe);B+d>R&&(B=0,z++),v[Q]={x:B,y:x+z*d,width:d,height:d,advance:re},B+=d}});var V=O+D*2;return{mapping:v,xOffset:B,yOffset:x+z*V,canvasHeight:M(x+(z+1)*V)}}function g(j,U,I){var O=0,D=0,R=0,y=[],v={},h=_(j),S;try{for(h.s();!(S=h.n()).done;){var A=S.value;if(!v[A.id]){var x=A.size;O+x+U>I&&(k(v,y,D),O=0,D=R+D+U,R=0,y=[]),y.push({icon:A,xOffset:O}),O=O+x+U,R=Math.max(R,x)}}}catch(B){h.e(B)}finally{h.f()}y.length>0&&k(v,y,D);var z=M(R+D+U);return{mapping:v,canvasHeight:z}}function k(j,U,I){var O=_(U),D;try{for(O.s();!(D=O.n()).done;){var R=D.value,y=R.icon,v=R.xOffset;j[y.id]=w(w({},y),{},{x:v,y:I,image:y.image,width:y.width,height:y.height})}}catch(h){O.e(h)}finally{O.f()}}function M(j){return Math.pow(2,Math.ceil(Math.log2(j)))}},29142:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getDistanceScales=o;var n=Math.PI/180,i=512,F=4003e4;function o(w){var _=w.latitude,P=_===void 0?0:_,L=w.zoom,d=L===void 0?0:L,E=w.scale,g=w.highPrecision,k=g===void 0?!1:g,M=w.flipY,j=M===void 0?!1:M;E=E!==void 0?E:Math.pow(2,d);var U={},I=i*E,O=Math.cos(P*n),D=I/360,R=D/O,y=I/F/O;if(U.pixelsPerMeter=[y,-y,y],U.metersPerPixel=[1/y,-1/y,1/y],U.pixelsPerDegree=[D,-R,y],U.degreesPerPixel=[1/D,-1/R,1/y],k){var v=n*Math.tan(P*n)/O,h=D*v/2,S=I/F*v,A=S/R*y;U.pixelsPerDegree2=[0,-h,S],U.pixelsPerMeter2=[A,0,A],j&&(U.pixelsPerDegree2[1]=-U.pixelsPerDegree2[1],U.pixelsPerMeter2[1]=-U.pixelsPerMeter2[1])}return j&&(U.pixelsPerMeter[1]=-U.pixelsPerMeter[1],U.metersPerPixel[1]=-U.metersPerPixel[1],U.pixelsPerDegree[1]=-U.pixelsPerDegree[1],U.degreesPerPixel[1]=-U.degreesPerPixel[1]),U}},66051:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getShapeIndex=i,c.sdf2DFunctions=void 0;var n=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];c.sdf2DFunctions=n;function i(F){return n.indexOf(F)}},29739:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getUniformLengthByType=n,c.extractUniforms=F;function n(o){var w=0;switch(o){case"vec2":case"ivec2":w=2;break;case"vec3":case"ivec3":w=3;break;case"vec4":case"ivec4":case"mat2":w=4;break;case"mat3":w=9;break;case"mat4":w=16;break;default:}return w}var i=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function F(o){var w={};return o=o.replace(i,function(_,P,L){var d=L.split(":"),E=d[0].trim(),g="";switch(d.length>1&&(g=d[1].trim()),P){case"bool":g=g==="true";break;case"float":case"int":g=Number(g);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":g?g=g.replace("[","").replace("]","").split(",").reduce(function(k,M){return k.push(Number(M.trim())),k},[]):g=new Array(n(P)).fill(0);break;default:}return w[E]=g,"uniform ".concat(P," ").concat(E,`;
`)}),{content:o,uniforms:w}}},4495:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.packUint8ToFloat=x,c.packCircleVertex=z,c.packOpacity=B,c.LEFT_SHIFT25=c.LEFT_SHIFT24=c.LEFT_SHIFT23=c.LEFT_SHIFT22=c.LEFT_SHIFT21=c.LEFT_SHIFT20=c.LEFT_SHIFT19=c.LEFT_SHIFT18=c.LEFT_SHIFT17=c.LEFT_SHIFT16=c.LEFT_SHIFT15=c.LEFT_SHIFT14=c.LEFT_SHIFT13=c.LEFT_SHIFT9=c.LEFT_SHIFT8=c.LEFT_SHIFT7=c.LEFT_SHIFT6=c.LEFT_SHIFT2=c.LEFT_SHIFT1=void 0;var F=i(n(63038)),o=i(n(74691)),w=n(66051),_=2;c.LEFT_SHIFT1=_;var P=4;c.LEFT_SHIFT2=P;var L=64;c.LEFT_SHIFT6=L;var d=128;c.LEFT_SHIFT7=d;var E=256;c.LEFT_SHIFT8=E;var g=512;c.LEFT_SHIFT9=g;var k=8192;c.LEFT_SHIFT13=k;var M=16384;c.LEFT_SHIFT14=M;var j=32768;c.LEFT_SHIFT15=j;var U=32768*2;c.LEFT_SHIFT16=U;var I=131072;c.LEFT_SHIFT17=I;var O=262144;c.LEFT_SHIFT18=O;var D=524288;c.LEFT_SHIFT19=D;var R=1048576;c.LEFT_SHIFT20=R;var y=2097152;c.LEFT_SHIFT21=y;var v=4194304;c.LEFT_SHIFT22=v;var h=8388608;c.LEFT_SHIFT23=h;var S=16777216;c.LEFT_SHIFT24=S;var A=16777216*2;c.LEFT_SHIFT25=A;function x(V,Q){return V=(0,o.default)(Math.floor(V),0,255),Q=(0,o.default)(Math.floor(Q),0,255),256*V+Q}function z(V){var Q=V.color,oe=V.radius,re=V.tileX,Z=V.tileY,ee=V.shape,H=V.opacity,ae=V.stroke,G=V.strokeWidth,ie=V.strokeOpacity,le=[],Me=[],ge=[],pe=[x(Q[0],Q[1]),x(Q[2],Q[3])],Ne=[x(ae[0],ae[1]),x(ae[2],ae[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Re){var he=(0,F.default)(Re,2),se=he[0],J=he[1];le.push([].concat(pe,[(se+1)*h+(J+1)*y+(0,w.getShapeIndex)(ee)*I+oe,(re+512)*D+(Z+512)*L])),Me.push([].concat(Ne,[G,ie])),ge.push([H,0,0,0])}),{packedBuffer:le,packedBuffer2:Me,packedBuffer3:ge}}function B(V,Q){if(V===0&&!Q)return 0;if(V===1&&Q)return 4294967295;var oe=Q?1:0,re=Math.floor(V*127);return re*A+oe*S+re*I+oe*U+re*g+oe*E+re*_+oe}},26501:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(77868));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","PolygonLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){this.layerModel=new g.default(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(R){this.updateLayerConfig({time:R})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),O}(E.default);c.default=j},77868:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(5602),d=n(82887),E=i(n(83712)),g=n(4520);function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,U=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,I=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"getUninforms",value:function(){var v=this.layer.getLayerConfig(),h=v.opacity,S=h===void 0?1:h,A=v.baseColor,x=A===void 0?"rgb(16,16,16)":A,z=v.brightColor,B=z===void 0?"rgb(255,176,38)":z,V=v.windowColor,Q=V===void 0?"rgb(30,60,89)":V,oe=v.time,re=oe===void 0?0:oe;return{u_opacity:S,u_baseColor:(0,d.rgb2arr)(x),u_brightColor:(0,d.rgb2arr)(B),u_windowColor:(0,d.rgb2arr)(Q),u_time:this.layer.getLayerAnimateTime()||re}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:U,fragmentShader:j,triangulation:g.PolygonExtrudeTriangulation})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(h,S,A,x,z){return z}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(h,S,A,x){var z=h.size,B=z===void 0?10:z;return Array.isArray(B)?[B[0]]:[B]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:L.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:2,update:function(h,S,A,x){var z=h.size;return[A[3],A[4]]}}})}}]),R}(E.default);c.default=I},32602:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(6479)),o=i(n(21165)),w=i(n(34575)),_=i(n(93913)),P=i(n(81506)),L=i(n(2205)),d=i(n(78585)),E=i(n(29754)),g=i(n(59713)),k=i(n(33124)),M=i(n(67268)),j=i(n(13218)),U=i(n(23560)),I=n(46343),O=n(5602),D=n(82887),R=n(26729),y=n(73307),v=n(39377),h=n(7203),S,A,x,z,B;function V(ie,le){var Me=typeof Symbol!="undefined"&&ie[Symbol.iterator]||ie["@@iterator"];if(!Me){if(Array.isArray(ie)||(Me=Q(ie))||le&&ie&&typeof ie.length=="number"){Me&&(ie=Me);var ge=0,pe=function(){};return{s:pe,n:function(){return ge>=ie.length?{done:!0}:{done:!1,value:ie[ge++]}},e:function(J){throw J},f:pe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ne=!0,Re=!1,he;return{s:function(){Me=Me.call(ie)},n:function(){var J=Me.next();return Ne=J.done,J},e:function(J){Re=!0,he=J},f:function(){try{!Ne&&Me.return!=null&&Me.return()}finally{if(Re)throw he}}}}function Q(ie,le){if(!!ie){if(typeof ie=="string")return oe(ie,le);var Me=Object.prototype.toString.call(ie).slice(8,-1);if(Me==="Object"&&ie.constructor&&(Me=ie.constructor.name),Me==="Map"||Me==="Set")return Array.from(ie);if(Me==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Me))return oe(ie,le)}}function oe(ie,le){(le==null||le>ie.length)&&(le=ie.length);for(var Me=0,ge=new Array(le);Me<le;Me++)ge[Me]=ie[Me];return ge}function re(ie,le){var Me=Object.keys(ie);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(ie);le&&(ge=ge.filter(function(pe){return Object.getOwnPropertyDescriptor(ie,pe).enumerable})),Me.push.apply(Me,ge)}return Me}function Z(ie){for(var le=1;le<arguments.length;le++){var Me=arguments[le]!=null?arguments[le]:{};le%2?re(Object(Me),!0).forEach(function(ge){(0,g.default)(ie,ge,Me[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ie,Object.getOwnPropertyDescriptors(Me)):re(Object(Me)).forEach(function(ge){Object.defineProperty(ie,ge,Object.getOwnPropertyDescriptor(Me,ge))})}return ie}function ee(ie){var le=H();return function(){var ge=(0,E.default)(ie),pe;if(le){var Ne=(0,E.default)(this).constructor;pe=Reflect.construct(ge,arguments,Ne)}else pe=ge.apply(this,arguments);return(0,d.default)(this,pe)}}function H(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(ie){return!1}}var ae=0,G=(S=(0,O.lazyInject)(O.TYPES.IGlobalConfigService),A=(0,O.lazyInject)(O.TYPES.IShaderModuleService),x=function(ie){(0,L.default)(Me,ie);var le=ee(Me);function Me(){var ge,pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,w.default)(this,Me),ge=le.call(this),(0,g.default)((0,P.default)(ge),"id","".concat(ae++)),(0,g.default)((0,P.default)(ge),"name","".concat(ae)),(0,g.default)((0,P.default)(ge),"type",void 0),(0,g.default)((0,P.default)(ge),"visible",!0),(0,g.default)((0,P.default)(ge),"zIndex",0),(0,g.default)((0,P.default)(ge),"minZoom",void 0),(0,g.default)((0,P.default)(ge),"maxZoom",void 0),(0,g.default)((0,P.default)(ge),"inited",!1),(0,g.default)((0,P.default)(ge),"layerModelNeedUpdate",!1),(0,g.default)((0,P.default)(ge),"pickedFeatureID",null),(0,g.default)((0,P.default)(ge),"selectedFeatureID",null),(0,g.default)((0,P.default)(ge),"styleNeedUpdate",!1),(0,g.default)((0,P.default)(ge),"rendering",void 0),(0,g.default)((0,P.default)(ge),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,g.default)((0,P.default)(ge),"hooks",{init:new I.SyncBailHook,afterInit:new I.SyncBailHook,beforeRender:new I.SyncBailHook,beforeRenderData:new I.SyncWaterfallHook,afterRender:new I.SyncHook,beforePickingEncode:new I.SyncHook,afterPickingEncode:new I.SyncHook,beforeHighlight:new I.SyncHook(["pickedColor"]),afterHighlight:new I.SyncHook,beforeSelect:new I.SyncHook(["pickedColor"]),afterSelect:new I.SyncHook,beforeDestroy:new I.SyncHook,afterDestroy:new I.SyncHook}),(0,g.default)((0,P.default)(ge),"models",[]),(0,g.default)((0,P.default)(ge),"multiPassRenderer",void 0),(0,g.default)((0,P.default)(ge),"plugins",void 0),(0,g.default)((0,P.default)(ge),"sourceOption",void 0),(0,g.default)((0,P.default)(ge),"layerModel",void 0),(0,o.default)((0,P.default)(ge),"configService",z,(0,P.default)(ge)),(0,o.default)((0,P.default)(ge),"shaderModuleService",B,(0,P.default)(ge)),(0,g.default)((0,P.default)(ge),"cameraService",void 0),(0,g.default)((0,P.default)(ge),"coordinateService",void 0),(0,g.default)((0,P.default)(ge),"iconService",void 0),(0,g.default)((0,P.default)(ge),"fontService",void 0),(0,g.default)((0,P.default)(ge),"pickingService",void 0),(0,g.default)((0,P.default)(ge),"rendererService",void 0),(0,g.default)((0,P.default)(ge),"layerService",void 0),(0,g.default)((0,P.default)(ge),"interactionService",void 0),(0,g.default)((0,P.default)(ge),"mapService",void 0),(0,g.default)((0,P.default)(ge),"styleAttributeService",void 0),(0,g.default)((0,P.default)(ge),"layerSource",void 0),(0,g.default)((0,P.default)(ge),"postProcessingPassFactory",void 0),(0,g.default)((0,P.default)(ge),"normalPassFactory",void 0),(0,g.default)((0,P.default)(ge),"animateOptions",{enable:!1}),(0,g.default)((0,P.default)(ge),"container",void 0),(0,g.default)((0,P.default)(ge),"encodedData",void 0),(0,g.default)((0,P.default)(ge),"configSchema",void 0),(0,g.default)((0,P.default)(ge),"currentPickId",null),(0,g.default)((0,P.default)(ge),"rawConfig",void 0),(0,g.default)((0,P.default)(ge),"needUpdateConfig",void 0),(0,g.default)((0,P.default)(ge),"pendingStyleAttributes",[]),(0,g.default)((0,P.default)(ge),"scaleOptions",{}),(0,g.default)((0,P.default)(ge),"animateStartTime",void 0),(0,g.default)((0,P.default)(ge),"aniamateStatus",!1),(0,g.default)((0,P.default)(ge),"sourceEvent",function(){ge.dataState.dataSourceNeedUpdate=!0;var Ne=ge.getLayerConfig(),Re=Ne.autoFit,he=Ne.fitBoundsOptions;Re&&ge.fitBounds(he),ge.emit("dataUpdate"),ge.reRender()}),ge.name=pe.name||ge.id,ge.zIndex=pe.zIndex||0,ge.rawConfig=pe,ge}return(0,_.default)(Me,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(pe){if(!this.inited)this.needUpdateConfig=Z(Z({},this.needUpdateConfig),pe);else{var Ne=this.container.get(O.TYPES.SceneID);(0,h.handleStyleDataMapping)(pe,this),this.configService.setLayerConfig(Ne,this.id,Z(Z(Z({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),pe)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(pe){this.container=pe}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(pe){return this.plugins.push(pe),this}},{key:"init",value:function(){var pe=this,Ne=this.container.get(O.TYPES.SceneID),Re=this.rawConfig.enableMultiPassRenderer,he=Re===void 0?!1:Re;this.configService.setLayerConfig(Ne,this.id,{enableMultiPassRenderer:he}),this.iconService=this.container.get(O.TYPES.IIconService),this.fontService=this.container.get(O.TYPES.IFontService),this.rendererService=this.container.get(O.TYPES.IRendererService),this.layerService=this.container.get(O.TYPES.ILayerService),this.interactionService=this.container.get(O.TYPES.IInteractionService),this.pickingService=this.container.get(O.TYPES.IPickingService),this.mapService=this.container.get(O.TYPES.IMapService),this.cameraService=this.container.get(O.TYPES.ICameraService),this.coordinateService=this.container.get(O.TYPES.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(O.TYPES.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(O.TYPES.IFactoryNormalPass),this.styleAttributeService=this.container.get(O.TYPES.IStyleAttributeService),this.multiPassRenderer=this.container.get(O.TYPES.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(me){var Le=me.attributeName,C=me.attributeField,X=me.attributeValues,de=me.updateOptions;pe.styleAttributeService.updateStyleAttribute(Le,{scale:Z({field:C},pe.splitValuesAndCallbackInAttribute(X,pe.getLayerConfig()[Le]))},de)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(O.TYPES.ILayerPlugin);var se=V(this.plugins),J;try{for(se.s();!(J=se.n()).done;){var fe=J.value;fe.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(me){se.e(me)}finally{se.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Z(Z({},this.getDefaultConfig()),this.rawConfig));var pe=this.getLayerConfig(),Ne=pe.animateOption;Ne!=null&&Ne.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(pe,Ne,Re){return this.updateStyleAttribute("color",pe,Ne,Re),this}},{key:"texture",value:function(pe,Ne,Re){return this.updateStyleAttribute("texture",pe,Ne,Re),this}},{key:"rotate",value:function(pe,Ne,Re){return this.updateStyleAttribute("rotate",pe,Ne,Re),this}},{key:"size",value:function(pe,Ne,Re){return this.updateStyleAttribute("size",pe,Ne,Re),this}},{key:"filter",value:function(pe,Ne,Re){return this.updateStyleAttribute("filter",pe,Ne,Re),this}},{key:"shape",value:function(pe,Ne,Re){return this.updateStyleAttribute("shape",pe,Ne,Re),this}},{key:"label",value:function(pe,Ne,Re){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:pe,attributeValues:Ne,updateOptions:Re}),this}},{key:"animate",value:function(pe){var Ne={};return(0,j.default)(pe)?(Ne.enable=!0,Ne=Z(Z({},Ne),pe)):Ne.enable=pe,this.updateLayerConfig({animateOption:Ne}),this}},{key:"source",value:function(pe,Ne){return this.sourceOption={data:pe,options:Ne},this}},{key:"setData",value:function(pe,Ne){var Re=this;return this.inited?this.layerSource.setData(pe,Ne):this.on("inited",function(){Re.layerSource.setData(pe,Ne)}),this}},{key:"style",value:function(pe){var Ne=this,Re=pe.passes,he=(0,F.default)(pe,["passes"]);return Re&&(0,y.normalizePasses)(Re).forEach(function(se){var J=Ne.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(se[0]);J&&J.updateOptions(se[1])}),this.rawConfig=Z(Z({},this.rawConfig),he),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(pe,Ne){return(0,j.default)(pe)?this.scaleOptions=Z(Z({},this.scaleOptions),pe):this.scaleOptions[pe]=Ne,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(pe){var Ne={};return Ne.enableHighlight=(0,j.default)(pe)?!0:pe,(0,j.default)(pe)?(Ne.enableHighlight=!0,pe.color&&(Ne.highlightColor=pe.color)):Ne.enableHighlight=!!pe,this.updateLayerConfig(Ne),this}},{key:"setActive",value:function(pe,Ne){var Re=this;if((0,j.default)(pe)){var he=pe.x,se=he===void 0?0:he,J=pe.y,fe=J===void 0?0:J;this.updateLayerConfig({highlightColor:(0,j.default)(Ne)?Ne.color:this.getLayerConfig().highlightColor}),this.pick({x:se,y:fe})}else this.updateLayerConfig({pickedFeatureID:pe,highlightColor:(0,j.default)(Ne)?Ne.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,D.encodePickingColor)(pe)).then(function(){setTimeout(function(){Re.reRender()},1)})}},{key:"select",value:function(pe){var Ne={};return Ne.enableSelect=(0,j.default)(pe)?!0:pe,(0,j.default)(pe)?(Ne.enableSelect=!0,pe.color&&(Ne.selectColor=pe.color)):Ne.enableSelect=!!pe,this.updateLayerConfig(Ne),this}},{key:"setSelect",value:function(pe,Ne){var Re=this;if((0,j.default)(pe)){var he=pe.x,se=he===void 0?0:he,J=pe.y,fe=J===void 0?0:J;this.updateLayerConfig({selectColor:(0,j.default)(Ne)?Ne.color:this.getLayerConfig().selectColor}),this.pick({x:se,y:fe})}else this.updateLayerConfig({pickedFeatureID:pe,selectColor:(0,j.default)(Ne)?Ne.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,D.encodePickingColor)(pe)).then(function(){setTimeout(function(){Re.reRender()},1)})}},{key:"setBlend",value:function(pe){this.updateLayerConfig({blend:pe}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(pe){return this.zIndex=pe,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(pe){this.currentPickId=pe}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(pe){this.selectedFeatureID=pe}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var pe=this.mapService.getZoom(),Ne=this.getLayerConfig(),Re=Ne.visible,he=Ne.minZoom,se=he===void 0?-Infinity:he,J=Ne.maxZoom,fe=J===void 0?Infinity:J;return!!Re&&pe>=se&&pe<=fe}},{key:"setMinZoom",value:function(pe){return this.updateLayerConfig({minZoom:pe}),this}},{key:"getMinZoom",value:function(){var pe=this.getLayerConfig(),Ne=pe.minZoom;return Ne}},{key:"getMaxZoom",value:function(){var pe=this.getLayerConfig(),Ne=pe.maxZoom;return Ne}},{key:"get",value:function(pe){var Ne=this.getLayerConfig();return Ne[pe]}},{key:"setMaxZoom",value:function(pe){return this.updateLayerConfig({maxZoom:pe}),this}},{key:"fitBounds",value:function(pe){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var Ne=this.getSource(),Re=Ne.extent,he=Re.some(function(se){return Math.abs(se)===Infinity});return he?this:(this.mapService.fitBounds([[Re[0],Re[1]],[Re[2],Re[3]]],pe),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(pe){return pe.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(pe){return pe.needRescale||pe.needRemapping||pe.needRegenerateVertices}).length}},{key:"setSource",value:function(pe){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=pe,this.inited&&this.layerSource.cluster){var Ne=this.mapService.getZoom();this.layerSource.updateClusterData(Ne)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(pe){this.encodedData=pe}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(pe){var Ne=this.styleAttributeService.getLayerAttributeScale(pe);if(Ne){if(Ne.ticks){var Re=Ne.ticks().map(function(se){return(0,g.default)({value:se},pe,Ne(se))});return Re}else if(Ne.invertExtent){var he=Ne.range().map(function(se){return(0,g.default)({value:Ne.invertExtent(se)},pe,se)});return he}}else return[]}},{key:"pick",value:function(pe){var Ne=pe.x,Re=pe.y;this.interactionService.triggerHover({x:Ne,y:Re})}},{key:"boxSelect",value:function(pe,Ne){this.pickingService.boxPickLayer(this,pe,Ne)}},{key:"buildLayerModel",value:function(pe){var Ne=pe.moduleName,Re=pe.vertexShader,he=pe.fragmentShader,se=pe.triangulation,J=(0,F.default)(pe,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(Ne,{vs:Re,fs:he});var fe=this.shaderModuleService.getModule(Ne),me=fe.vs,Le=fe.fs,C=fe.uniforms,X=this.rendererService.createModel,de=this.styleAttributeService.createAttributesAndIndices(this.encodedData,se),Ae=de.attributes,De=de.elements;return X(Z({attributes:Ae,uniforms:C,fs:Le,vs:me,elements:De,blend:v.BlendTypes[O.BlendType.normal]},J))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(pe){var Ne=this.getLayerConfig(),Re=Ne.enableHighlight,he=Re===void 0?!0:Re,se=Ne.enableSelect,J=se===void 0?!0:se,fe=this.eventNames().indexOf(pe)!==-1||this.eventNames().indexOf("un"+pe)!==-1;return(pe==="click"||pe==="dblclick")&&J&&(fe=!0),pe==="mousemove"&&(he||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(fe=!0),this.isVisible()&&fe}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var pe=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(Ne){Ne.draw({uniforms:pe.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(pe,Ne,Re,he){this.inited?this.styleAttributeService.updateStyleAttribute(pe,{scale:Z({field:Ne},this.splitValuesAndCallbackInAttribute(Re,this.getLayerConfig()[Ne]))},he):this.pendingStyleAttributes.push({attributeName:pe,attributeField:Ne,attributeValues:Re,updateOptions:he})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(pe,Ne){return{values:(0,U.default)(pe)?void 0:pe||Ne,callback:(0,U.default)(pe)?pe:void 0}}}]),Me}(R.EventEmitter),z=(0,k.default)(x.prototype,"configService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,k.default)(x.prototype,"shaderModuleService",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x);c.default=G},83712:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(319)),o=i(n(21165)),w=i(n(34575)),_=i(n(93913)),P=i(n(59713)),L=i(n(33124)),d=i(n(67268)),E=i(n(47037)),g=i(n(81763)),k=i(n(18446)),M=i(n(1469)),j=n(5602),U=n(82887),I=n(3054),O=n(39377),D,R,y,v,h;function S(B,V){var Q=typeof Symbol!="undefined"&&B[Symbol.iterator]||B["@@iterator"];if(!Q){if(Array.isArray(B)||(Q=A(B))||V&&B&&typeof B.length=="number"){Q&&(B=Q);var oe=0,re=function(){};return{s:re,n:function(){return oe>=B.length?{done:!0}:{done:!1,value:B[oe++]}},e:function(G){throw G},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Z=!0,ee=!1,H;return{s:function(){Q=Q.call(B)},n:function(){var G=Q.next();return Z=G.done,G},e:function(G){ee=!0,H=G},f:function(){try{!Z&&Q.return!=null&&Q.return()}finally{if(ee)throw H}}}}function A(B,V){if(!!B){if(typeof B=="string")return x(B,V);var Q=Object.prototype.toString.call(B).slice(8,-1);if(Q==="Object"&&B.constructor&&(Q=B.constructor.name),Q==="Map"||Q==="Set")return Array.from(B);if(Q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Q))return x(B,V)}}function x(B,V){(V==null||V>B.length)&&(V=B.length);for(var Q=0,oe=new Array(V);Q<V;Q++)oe[Q]=B[Q];return oe}var z=(D=(0,j.lazyInject)(j.TYPES.IGlobalConfigService),R=(0,j.lazyInject)(j.TYPES.IShaderModuleService),y=function(){function B(V){(0,w.default)(this,B),(0,P.default)(this,"triangulation",void 0),(0,P.default)(this,"createTexture2D",void 0),(0,P.default)(this,"layer",void 0),(0,P.default)(this,"dataTexture",void 0),(0,P.default)(this,"DATA_TEXTURE_WIDTH",void 0),(0,P.default)(this,"rowCount",void 0),(0,P.default)(this,"cacheStyleProperties",void 0),(0,P.default)(this,"cellLength",void 0),(0,P.default)(this,"cellProperties",void 0),(0,P.default)(this,"cellTypeLayout",void 0),(0,P.default)(this,"stylePropertyesExist",void 0),(0,P.default)(this,"dataTextureTest",void 0),(0,o.default)(this,"configService",v,this),(0,o.default)(this,"shaderModuleService",h,this),(0,P.default)(this,"rendererService",void 0),(0,P.default)(this,"iconService",void 0),(0,P.default)(this,"fontService",void 0),(0,P.default)(this,"styleAttributeService",void 0),(0,P.default)(this,"mapService",void 0),(0,P.default)(this,"cameraService",void 0),(0,P.default)(this,"layerService",void 0),this.layer=V,this.rendererService=V.getContainer().get(j.TYPES.IRendererService),this.styleAttributeService=V.getContainer().get(j.TYPES.IStyleAttributeService),this.mapService=V.getContainer().get(j.TYPES.IMapService),this.iconService=V.getContainer().get(j.TYPES.IIconService),this.fontService=V.getContainer().get(j.TYPES.IFontService),this.cameraService=V.getContainer().get(j.TYPES.ICameraService),this.layerService=V.getContainer().get(j.TYPES.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var Q=this.rendererService.createTexture2D;this.createTexture2D=Q,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:j.gl.NEAREST,min:j.gl.NEAREST,width:1,height:1}))}return(0,_.default)(B,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(Q){var oe=!1;return(0,k.default)(Q.opacity,this.cacheStyleProperties.opacity)||(oe=!0,this.cacheStyleProperties.opacity=Q.opacity),(0,k.default)(Q.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(oe=!0,this.cacheStyleProperties.strokeOpacity=Q.strokeOpacity),(0,k.default)(Q.strokeWidth,this.cacheStyleProperties.strokeWidth)||(oe=!0,this.cacheStyleProperties.strokeWidth=Q.strokeWidth),(0,k.default)(Q.stroke,this.cacheStyleProperties.stroke)||(oe=!0,this.cacheStyleProperties.stroke=Q.stroke),(0,k.default)(Q.offsets,this.cacheStyleProperties.offsets)||(oe=!0,this.cacheStyleProperties.offsets=Q.offsets),this.dataTexture===void 0&&(oe=!0),oe}},{key:"judgeStyleAttributes",value:function(Q){this.clearLastCalRes(),Q.opacity!==void 0&&!(0,g.default)(Q.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),Q.strokeOpacity!==void 0&&!(0,g.default)(Q.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),Q.strokeWidth!==void 0&&!(0,g.default)(Q.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),Q.stroke!==void 0&&!this.isStaticColor(Q.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),Q.offsets!==void 0&&!this.isOffsetStatic(Q.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(Q){return(0,E.default)(Q)?!!(0,I.color)(Q):!1}},{key:"getStrokeColor",value:function(Q){if(this.isStaticColor(Q)){var oe=(0,U.rgb2arr)(Q);return oe[0]=oe[0]?oe[0]:0,oe[1]=oe[1]?oe[1]:0,oe[2]=oe[2]?oe[2]:0,oe[3]=oe[3]?oe[3]:0,oe}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(Q){return!!((0,M.default)(Q)&&Q.length===2&&(0,g.default)(Q[0])&&(0,g.default)(Q[1]))}},{key:"patchMod",value:function(Q,oe){for(var re=0;re<oe;re++)Q.push(-1)}},{key:"patchData",value:function(Q,oe,re){var Z=S(re),ee;try{for(Z.s();!(ee=Z.n()).done;){var H=ee.value,ae=H.attr,G=H.count,ie=oe[ae];ie?ae==="stroke"?Q.push.apply(Q,(0,F.default)((0,U.rgb2arr)(ie))):ae==="offsets"?this.isOffsetStatic(ie)?Q.push(-ie[0],ie[1]):Q.push(0,0):Q.push((0,g.default)(ie)?ie:1):this.patchMod(Q,G)}}catch(le){Z.e(le)}finally{Z.f()}}},{key:"calDataFrame",value:function(Q,oe,re){for(var Z=oe.length,ee=Math.ceil(Z*Q/this.DATA_TEXTURE_WIDTH),H=ee*this.DATA_TEXTURE_WIDTH,ae=[],G=0;G<Z;G++){var ie=oe[G];this.patchData(ae,ie,re)}for(var le=ae.length;le<H;le++)ae.push(-1);return{data:ae,width:this.DATA_TEXTURE_WIDTH,height:ee}}},{key:"getBlend",value:function(){var Q=this.layer.getLayerConfig(),oe=Q.blend,re=oe===void 0?"normal":oe;return O.BlendTypes[j.BlendType[re]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(Q){return[Q.enable?0:1,Q.duration||4,Q.interval||.2,Q.trailLength||.1]}},{key:"startModelAnimate",value:function(){var Q=this.layer.getLayerConfig(),oe=Q.animateOption;oe.enable&&this.layer.setAnimateStartTime()}}]),B}(),v=(0,L.default)(y.prototype,"configService",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=(0,L.default)(y.prototype,"shaderModuleService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y);c.default=z},84595:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.polygonPath=P,c.circle=L,c.square=d,c.triangle=E,c.hexagon=g,c.pentagon=k,c.geometryShape=c.ShapeType2D=c.ShapeType3D=void 0;var F=i(n(59713)),o,w;c.ShapeType3D=w,function(j){j.CYLINDER="cylinder",j.SQUARECOLUMN="squareColumn",j.TRIANGLECOLUMN="triangleColumn",j.HEXAGONCOLUMN="hexagonColumn",j.PENTAGONCOLUMN="pentagonColumn"}(w||(c.ShapeType3D=w={}));var _;c.ShapeType2D=_,function(j){j.CIRCLE="circle",j.SQUARE="square",j.TRIANGLE="triangle",j.HEXAGON="hexagon",j.PENTAGON="pentagon"}(_||(c.ShapeType2D=_={}));function P(j){for(var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,I=Math.PI*2/j,O=[],D=0;D<j;D++)O.push(I*D+U*Math.PI/12);var R=O.map(function(y){var v=Math.sin(y+Math.PI/4),h=Math.cos(y+Math.PI/4);return[v,h,0]});return R}function L(){return P(30)}function d(){return P(4)}function E(){return P(3)}function g(){return P(6,1)}function k(){return P(5)}var M=(o={},(0,F.default)(o,_.CIRCLE,L),(0,F.default)(o,_.HEXAGON,g),(0,F.default)(o,_.TRIANGLE,E),(0,F.default)(o,_.SQUARE,d),(0,F.default)(o,_.PENTAGON,k),(0,F.default)(o,w.CYLINDER,L),(0,F.default)(o,w.HEXAGONCOLUMN,g),(0,F.default)(o,w.TRIANGLECOLUMN,E),(0,F.default)(o,w.SQUARECOLUMN,d),(0,F.default)(o,w.PENTAGONCOLUMN,k),o);c.geometryShape=M},44420:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=P,c.fillPolygon=L,c.extrude_PolygonNormal=d;var F=i(n(319)),o=n(82887),w=i(n(9187)),_=n(89568);function P(g){var k=g[0][0],M=g[0][g[0].length-1];k[0]===M[0]&&k[1]===M[1]&&(g[0]=g[0].slice(0,g[0].length-1));for(var j=g[0].length,U=w.default.flatten(g),I=U.vertices,O=U.dimensions,D=[],R=[],y=0;y<I.length/O;y++)O===2?D.push(I[y*2],I[y*2+1],1):D.push(I[y*3],I[y*3+1],1);var v=(0,w.default)(U.vertices,U.holes,U.dimensions);R.push.apply(R,(0,F.default)(v));for(var h=function(x){var z=U.vertices.slice(x*O,(x+1)*O),B=U.vertices.slice((x+1)*O,(x+2)*O);B.length===0&&(B=U.vertices.slice(0,O));var V=D.length/3;D.push(z[0],z[1],1,B[0],B[1],1,z[0],z[1],0,B[0],B[1],0),R.push.apply(R,(0,F.default)([0,2,1,2,3,1].map(function(Q){return Q+V})))},S=0;S<j;S++)h(S);return{positions:D,index:R}}function L(g){var k=w.default.flatten(g),M=(0,w.default)(k.vertices,k.holes,k.dimensions);return{positions:k.vertices,index:M}}function d(g){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,M=g[0][0],j=g[0][g[0].length-1];M[0]===j[0]&&M[1]===j[1]&&(g[0]=g[0].slice(0,g[0].length-1));for(var U=g[0].length,I=w.default.flatten(g),O=I.vertices,D=I.dimensions,R=[],y=[],v=[],h=0;h<O.length/D;h++)D===2?R.push(O[h*2],O[h*2+1],1,-1,-1):R.push(O[h*3],O[h*3+1],1,-1,-1),v.push(0,0,1);var S=(0,w.default)(I.vertices,I.holes,I.dimensions);y.push.apply(y,(0,F.default)(S));for(var A=function(B){var V=I.vertices.slice(B*D,(B+1)*D),Q=I.vertices.slice((B+1)*D,(B+2)*D);Q.length===0&&(Q=I.vertices.slice(0,D));var oe=R.length/5;R.push(V[0],V[1],1,0,0,Q[0],Q[1],1,.1,0,V[0],V[1],0,0,.8,Q[0],Q[1],0,.1,.8);var re=E([Q[0],Q[1],1],[V[0],V[1],0],[V[0],V[1],1],k);v.push.apply(v,(0,F.default)(re).concat((0,F.default)(re),(0,F.default)(re),(0,F.default)(re))),y.push.apply(y,(0,F.default)([1,2,0,3,2,1].map(function(Z){return Z+oe})))},x=0;x<U;x++)A(x);return{positions:R,index:y,normals:v}}function E(g,k,M){var j=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,U=_.vec3.create(),I=_.vec3.create(),O=_.vec3.create();j&&(g=(0,o.lngLatToMeters)(g),k=(0,o.lngLatToMeters)(k),M=(0,o.lngLatToMeters)(M));var D=_.vec3.fromValues.apply(_.vec3,(0,F.default)(g)),R=_.vec3.fromValues.apply(_.vec3,(0,F.default)(k)),y=_.vec3.fromValues.apply(_.vec3,(0,F.default)(M));_.vec3.sub(U,y,R),_.vec3.sub(I,D,R),_.vec3.cross(O,U,I);var v=_.vec3.create();return _.vec3.normalize(v,O),v}},4520:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.PointFillTriangulation=j,c.PointExtrudeTriangulation=U,c.PointImageTriangulation=I,c.LineTriangulation=O,c.polygonTriangulation=D,c.PolygonExtrudeTriangulation=R,c.HeatmapGridTriangulation=y,c.RasterImageTriangulation=v,c.LineArcTriangulation=h,c.HeatmapTriangulation=S;var o=F(n(63038)),w=F(n(319)),_=n(82887),P=F(n(9187)),L=n(89568),d=F(n(20216)),E=n(88030),g=i(n(44420)),k=n(84595),M={};function j(oe){var re=(0,E.calculteCentroid)(oe.coordinates);return{vertices:[].concat((0,w.default)(re),(0,w.default)(re),(0,w.default)(re),(0,w.default)(re)),indices:[0,1,2,2,3,0],size:re.length}}function U(oe){var re=oe.shape,Z=A(re,!1),ee=Z.positions,H=Z.index,ae=Z.normals;return{vertices:ee,indices:H,normals:ae,size:5}}function I(oe){var re=(0,E.calculteCentroid)(oe.coordinates);return{vertices:(0,w.default)(re),indices:[0],size:re.length}}function O(oe){var re=oe.coordinates,Z=oe.originCoordinates,ee=oe.version,H=new d.default({dash:!0,join:"bevel"});if(ee==="GAODE2.x"){var ae=re;Array.isArray(ae[0][0])||(ae=[re]);var G=Z;Array.isArray(G[0][0])||(G=[Z]);for(var ie=0;ie<ae.length;ie++){var le=ae[ie],Me=G[ie];H.extrude_gaode2(le,Me)}}else{var ge=re;Array.isArray(ge[0][0])||(ge=[re]),ge.forEach(function(Ne){H.extrude(Ne)})}var pe=H.complex;return{vertices:pe.positions,indices:pe.indices,normals:pe.normals,size:6}}function D(oe){var re=oe.coordinates,Z=P.default.flatten(re),ee=Z.vertices,H=Z.dimensions,ae=Z.holes;return{indices:(0,P.default)(ee,ae,H),vertices:ee,size:H}}function R(oe){var re=oe.coordinates,Z=(0,g.extrude_PolygonNormal)(re,!0),ee=Z.positions,H=Z.index,ae=Z.normals;return{vertices:ee,indices:H,normals:ae,size:5}}function y(oe){var re=oe.shape,Z=V(re),ee=Z.positions,H=Z.index;return{vertices:ee,indices:H,size:3}}function v(oe){var re=oe.coordinates,Z=[].concat((0,w.default)(re[0]),[0,0,1,re[1][0],re[0][1],0,1,1],(0,w.default)(re[1]),[0,1,0],(0,w.default)(re[0]),[0,0,1],(0,w.default)(re[1]),[0,1,0,re[0][0],re[1][1],0,0,0]),ee=[0,1,2,3,4,5];return{vertices:Z,indices:ee,size:5}}function h(oe){for(var re=30,Z=oe.coordinates,ee=[],H=[],ae=function(le){ee.push(le,1,le,Z[0][0],Z[0][1],Z[1][0],Z[1][1],le,-1,le,Z[0][0],Z[0][1],Z[1][0],Z[1][1]),le!==re-1&&H.push.apply(H,(0,w.default)([0,1,2,1,3,2].map(function(Me){return le*2+Me})))},G=0;G<re;G++)ae(G);return{vertices:ee,indices:H,size:7}}function S(oe){var re=oe.coordinates;re.length===2&&re.push(0);var Z=oe.size,ee=Q(-1,1),H=Q(1,1),ae=Q(-1,-1),G=Q(1,-1),ie=[].concat((0,w.default)(re),(0,w.default)(ee),(0,w.default)(re),(0,w.default)(ae),(0,w.default)(re),(0,w.default)(G),(0,w.default)(re),(0,w.default)(H)),le=[0,1,2,3,0,2];return{vertices:ie,indices:le,size:5}}function A(oe){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(M&&M[oe])return M[oe];var Z=k.geometryShape[oe]?k.geometryShape[oe]():k.geometryShape.cylinder(),ee=(0,g.extrude_PolygonNormal)([Z],re);return M[oe]=ee,ee}function x(oe,re){for(var Z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,ee=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,H=new Float32Array(oe.length/Z*3),ae,G,ie,le=L.vec3.create(),Me=L.vec3.create(),ge=L.vec3.create(),pe=0,Ne=re.length;pe<Ne;pe+=3){ae=re[pe+0]*3,G=re[pe+1]*3,ie=re[pe+2]*3;var Re=[oe[ae],oe[ae+1]],he=[oe[G],oe[G+1]],se=[oe[ie],oe[ie+1]];ee&&(Re=(0,_.lngLatToMeters)(Re),he=(0,_.lngLatToMeters)(he),se=(0,_.lngLatToMeters)(se));var J=Re,fe=(0,o.default)(J,2),me=fe[0],Le=fe[1],C=L.vec3.fromValues(me,Le,oe[ae+2]),X=he,de=(0,o.default)(X,2),Ae=de[0],De=de[1],Ge=L.vec3.fromValues(Ae,De,oe[G+2]),$e=se,ct=(0,o.default)($e,2),gt=ct[0],st=ct[1],xe=L.vec3.fromValues(gt,st,oe[ie+2]);L.vec3.sub(le,xe,Ge),L.vec3.sub(Me,C,Ge),L.vec3.cross(ge,le,Me),H[ae]+=le[0],H[ae+1]+=le[1],H[ae+2]+=le[2],H[G]+=le[0],H[G+1]+=le[1],H[G+2]+=le[2],H[ie]+=le[0],H[ie+1]+=le[1],H[ie+2]+=le[2]}return z(H),H}function z(oe){for(var re=0,Z=oe.length;re<Z;re+=3){var ee=L.vec3.fromValues(oe[re],oe[re+1],oe[re+2]),H=L.vec3.create();L.vec3.normalize(H,ee),oe.set(H,re)}}function B(oe){var re=oe[0][0],Z=oe[0][oe[0].length-1];return re[0]===Z[0]&&re[1]===Z[1]}function V(oe){var re=["cylinder","triangleColumn","hexagonColumn","squareColumn"],Z=k.geometryShape[oe]?k.geometryShape[oe]():k.geometryShape.circle(),ee=re.indexOf(oe)===-1?(0,g.fillPolygon)([Z]):(0,g.default)([Z]);return ee}function Q(oe,re){var Z=(oe+1)/2,ee=(re+1)/2;return[Z,ee]}},43603:function(){"use strict"},79019:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(46671));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","HeatMapLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var R=this,y=this.getModelType();return y==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(v){return v.draw({uniforms:R.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var R,y=this.styleAttributeService.getLayerStyleAttribute("shape"),v=this.getLayerConfig(),h=v.shape3d,S=this.getSource(),A=S.data.type,x=(y==null||(R=y.scale)===null||R===void 0?void 0:R.field)||"heatmap";return x==="heatmap"||x==="heatmap3d"?"heatmap":A==="hexagon"?(h==null?void 0:h.indexOf(x))===-1?"hexagon":"grid3d":A==="grid"?(h==null?void 0:h.indexOf(x))===-1?"grid":"grid3d":"heatmap"}}]),O}(E.default);c.default=j},55123:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(5602),d=i(n(83712)),E=n(4520);function g(I){var O=k();return function(){var R=(0,P.default)(I),y;if(O){var v=(0,P.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,_.default)(this,y)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var M=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,j=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,U=function(I){(0,w.default)(D,I);var O=g(D);function D(){return(0,F.default)(this,D),O.apply(this,arguments)}return(0,o.default)(D,[{key:"getUninforms",value:function(){var y=this.layer.getLayerConfig(),v=y.opacity,h=y.coverage,S=y.angle;return{u_opacity:v||1,u_coverage:h||.9,u_angle:S||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:M,fragmentShader:j,triangulation:E.HeatmapGridTriangulation,depth:{enable:!1},primitive:L.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(v,h){var S=v.version==="GAODE2.x"?v.originCoordinates:v.coordinates;return[S[0],S[1],0]}}})}}]),D}(d.default);c.default=U},99405:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(5602),d=i(n(83712)),E=n(4520);function g(I){var O=k();return function(){var R=(0,P.default)(I),y;if(O){var v=(0,P.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,_.default)(this,y)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var M=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,j=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,U=function(I){(0,w.default)(D,I);var O=g(D);function D(){return(0,F.default)(this,D),O.apply(this,arguments)}return(0,o.default)(D,[{key:"getUninforms",value:function(){var y=this.layer.getLayerConfig(),v=y.opacity,h=y.coverage,S=y.angle;return{u_opacity:v||1,u_coverage:h||1,u_angle:S||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:M,fragmentShader:j,triangulation:E.PointExtrudeTriangulation,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:L.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:1,update:function(v,h,S,A){var x=v.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:L.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.gl.STATIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(v,h,S,A,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(v,h){var S=v.version==="GAODE2.x"?v.originCoordinates:v.coordinates;return[S[0],S[1],0]}}})}}]),D}(d.default);c.default=U},86099:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(319)),o=i(n(34575)),w=i(n(93913)),_=i(n(81506)),P=i(n(2205)),L=i(n(78585)),d=i(n(29754)),E=i(n(59713)),g=n(5602),k=n(82887),M=n(89568),j=n(86700);n(28660);var U=i(n(83712)),I=n(4520),O=n(48665),D,R;function y(re,Z){var ee=Object.keys(re);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(re);Z&&(H=H.filter(function(ae){return Object.getOwnPropertyDescriptor(re,ae).enumerable})),ee.push.apply(ee,H)}return ee}function v(re){for(var Z=1;Z<arguments.length;Z++){var ee=arguments[Z]!=null?arguments[Z]:{};Z%2?y(Object(ee),!0).forEach(function(H){(0,E.default)(re,H,ee[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(re,Object.getOwnPropertyDescriptors(ee)):y(Object(ee)).forEach(function(H){Object.defineProperty(re,H,Object.getOwnPropertyDescriptor(ee,H))})}return re}function h(re){var Z=S();return function(){var H=(0,d.default)(re),ae;if(Z){var G=(0,d.default)(this).constructor;ae=Reflect.construct(H,arguments,G)}else ae=H.apply(this,arguments);return(0,L.default)(this,ae)}}function S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(re){return!1}}var A=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,x=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,z=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,B=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,V=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Q=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,oe=(D=(0,j.injectable)(),D(R=function(re){(0,P.default)(ee,re);var Z=h(ee);function ee(){var H;(0,o.default)(this,ee);for(var ae=arguments.length,G=new Array(ae),ie=0;ie<ae;ie++)G[ie]=arguments[ie];return H=Z.call.apply(Z,[this].concat(G)),(0,E.default)((0,_.default)(H),"texture",void 0),(0,E.default)((0,_.default)(H),"colorTexture",void 0),(0,E.default)((0,_.default)(H),"heatmapFramerBuffer",void 0),(0,E.default)((0,_.default)(H),"intensityModel",void 0),(0,E.default)((0,_.default)(H),"colorModel",void 0),(0,E.default)((0,_.default)(H),"shapeType",void 0),H}return(0,w.default)(ee,[{key:"render",value:function(){var ae=this,G=this.rendererService,ie=G.clear,le=G.useFramebuffer;le(this.heatmapFramerBuffer,function(){ie({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ae.heatmapFramerBuffer}),ae.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var ae,G=this.rendererService,ie=G.createFramebuffer,le=G.clear,Me=G.getViewportSize,ge=G.createTexture2D,pe=G.useFramebuffer,Ne=this.styleAttributeService.getLayerStyleAttribute("shape"),Re=(Ne==null||(ae=Ne.scale)===null||ae===void 0?void 0:ae.field)||"heatmap";this.shapeType=Re,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=Re==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var he=this.layer.getLayerConfig(),se=he.rampColors,J=(0,k.generateColorRamp)(se),fe=Me(),me=fe.width,Le=fe.height;return this.heatmapFramerBuffer=ie({color:ge({width:Math.floor(me/4),height:Math.floor(Le/4),wrapS:g.gl.CLAMP_TO_EDGE,wrapT:g.gl.CLAMP_TO_EDGE,min:g.gl.LINEAR,mag:g.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:g.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(G,ie,le,Me){return[le[3],le[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(G,ie,le,Me){var ge=G.size,pe=ge===void 0?1:ge;return[pe]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:V,fragmentShader:B,triangulation:I.HeatmapTriangulation,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:g.gl.ONE,srcAlpha:1,dstRGB:g.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:Q,fs:z});var ae=this.shaderModuleService.getModule("heatmapColor"),G=ae.vs,ie=ae.fs,le=ae.uniforms,Me=this.rendererService,ge=Me.createAttribute,pe=Me.createElements,Ne=Me.createBuffer,Re=Me.createModel;return Re({vs:G,fs:ie,attributes:{a_Position:ge({buffer:Ne({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:g.gl.FLOAT}),size:3}),a_Uv:ge({buffer:Ne({data:[0,1,1,1,0,0,1,0],type:g.gl.FLOAT}),size:2})},uniforms:v({},le),depth:{enable:!1},blend:this.getBlend(),count:6,elements:pe({data:[0,2,1,2,3,1],type:g.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var ae=this.layer.getLayerConfig(),G=ae.opacity,ie=ae.intensity,le=ie===void 0?10:ie,Me=ae.radius,ge=Me===void 0?5:Me;this.intensityModel.draw({uniforms:{u_opacity:G||1,u_radius:ge,u_intensity:le}})}},{key:"drawColorMode",value:function(){var ae=this.layer.getLayerConfig(),G=ae.opacity;this.colorModel.draw({uniforms:{u_opacity:G||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var ae=this.layer.getLayerConfig(),G=ae.opacity,ie=M.mat4.create();M.mat4.invert(ie,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:G||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,F.default)(ie)}})}},{key:"build3dHeatMap",value:function(){var ae=this.rendererService.getViewportSize,G=ae(),ie=G.width,le=G.height,Me=(0,O.heatMap3DTriangulation)(ie/4,le/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:x,fs:A});var ge=this.shaderModuleService.getModule("heatmap3dColor"),pe=ge.vs,Ne=ge.fs,Re=ge.uniforms,he=this.rendererService,se=he.createAttribute,J=he.createElements,fe=he.createBuffer,me=he.createModel;return me({vs:pe,fs:Ne,attributes:{a_Position:se({buffer:fe({data:Me.vertices,type:g.gl.FLOAT}),size:3}),a_Uv:se({buffer:fe({data:Me.uvs,type:g.gl.FLOAT}),size:2})},primitive:g.gl.TRIANGLES,uniforms:v({},Re),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:g.gl.SRC_ALPHA,srcAlpha:1,dstRGB:g.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:J({data:Me.indices,type:g.gl.UNSIGNED_INT,count:Me.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var ae=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var G=this.layer.getLayerConfig(),ie=G.rampColors,le=(0,k.generateColorRamp)(ie);this.colorTexture=ae({data:new Uint8Array(le.data),width:le.width,height:le.height,wrapS:g.gl.CLAMP_TO_EDGE,wrapT:g.gl.CLAMP_TO_EDGE,min:g.gl.NEAREST,mag:g.gl.NEAREST,flipY:!1})}}]),ee}(U.default))||R);c.default=oe},11450:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=n(5602),d=i(n(83712)),E=n(4520);function g(I){var O=k();return function(){var R=(0,P.default)(I),y;if(O){var v=(0,P.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,_.default)(this,y)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var M=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,j=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,U=function(I){(0,w.default)(D,I);var O=g(D);function D(){return(0,F.default)(this,D),O.apply(this,arguments)}return(0,o.default)(D,[{key:"getUninforms",value:function(){var y=this.layer.getLayerConfig(),v=y.opacity,h=y.coverage,S=y.angle;return{u_opacity:v||1,u_coverage:h||.9,u_angle:S||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:j,fragmentShader:M,triangulation:E.HeatmapGridTriangulation,depth:{enable:!1},primitive:L.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:L.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.gl.DYNAMIC_DRAW,data:[],type:L.gl.FLOAT},size:3,update:function(v,h){var S=v.version==="GAODE2.x"?v.originCoordinates:v.coordinates;return[S[0],S[1],0]}}})}}]),D}(d.default);c.default=U},46671:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(55123)),o=i(n(99405)),w=i(n(86099)),_=i(n(11450)),P={heatmap:w.default,heatmap3d:w.default,grid:F.default,grid3d:o.default,hexagon:_.default},L=P;c.default=L},48665:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.heatMap3DTriangulation=n;function n(i,F){for(var o=[],w=[],_=[],P=i+1,L=F+1,d=i/2,E=F/2,g=0;g<L;g++)for(var k=g-E,M=0;M<P;M++){var j=M-d;w.push(j/d,-k/E,0),_.push(M/i),_.push(1-g/F)}for(var U=0;U<F;U++)for(var I=0;I<i;I++){var O=I+P*U,D=I+P*(U+1),R=I+1+P*(U+1),y=I+1+P*U;o.push(O,D,y),o.push(D,R,y)}return{vertices:w,indices:o,uvs:_}}},31483:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(26252));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","ImageLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var R=this.getModelType(),y={image:{}};return y[R]}},{key:"getModelType",value:function(){return"image"}}]),O}(E.default);c.default=j},70707:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=i(n(83712)),k=n(4520);function M(D){var R=j();return function(){var v=(0,L.default)(D),h;if(R){var S=(0,L.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,P.default)(this,h)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var U=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,I=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,O=function(D){(0,_.default)(y,D);var R=M(y);function y(){var v;(0,F.default)(this,y);for(var h=arguments.length,S=new Array(h),A=0;A<h;A++)S[A]=arguments[A];return v=R.call.apply(R,[this].concat(S)),(0,d.default)((0,w.default)(v),"texture",void 0),v}return(0,o.default)(y,[{key:"getUninforms",value:function(){var h=this.layer.getLayerConfig(),S=h.opacity;return{u_opacity:S||1,u_texture:this.texture}}},{key:"initModels",value:function(){var h=this,S=this.layer.getSource(),A=this.rendererService.createTexture2D;return this.texture=A({height:0,width:0}),S.data.images.then(function(x){h.texture=A({data:x[0],width:x[0].width,height:x[0].height}),h.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:I,fragmentShader:U,triangulation:k.RasterImageTriangulation,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(S,A,x,z){return[x[3],x[4]]}}})}}]),y}(g.default);c.default=O},26252:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(70707)),o={image:F.default},w=o;c.default=w},81441:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"CityBuildingLayer",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"BaseLayer",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(c,"HeatmapLayer",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(c,"ImageLayer",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(c,"LineLayer",{enumerable:!0,get:function(){return L.default}}),Object.defineProperty(c,"PointLayer",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(c,"PolygonLayer",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(c,"RasterLayer",{enumerable:!0,get:function(){return g.default}});var F=n(5602),o=i(n(26501)),w=i(n(32602));n(43603);var _=i(n(79019)),P=i(n(31483)),L=i(n(64407)),d=i(n(38101)),E=i(n(3464)),g=i(n(30601)),k=i(n(79578)),M=i(n(37365)),j=i(n(74216)),U=i(n(9579)),I=i(n(39194)),O=i(n(53692)),D=i(n(90431)),R=i(n(73307)),y=i(n(13100)),v=i(n(23565)),h=i(n(10208)),S=i(n(40990)),A=i(n(974));F.container.bind(F.TYPES.ILayerPlugin).to(M.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(v.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(j.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(k.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(O.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(A.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(S.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(R.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(h.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(U.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(D.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(y.default).inRequestScope(),F.container.bind(F.TYPES.ILayerPlugin).to(I.default).inRequestScope()},64407:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(97555));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","LineLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var R=this.getModelType(),y={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return y[R]}},{key:"getModelType",value:function(){var R,y=this.styleAttributeService.getLayerStyleAttribute("shape"),v=y==null||(R=y.scale)===null||R===void 0?void 0:R.field;return v||"line"}}]),O}(E.default);c.default=j},79067:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(81763)),g=n(5602),k=n(82887),M=i(n(83712)),j=n(4520);function U(v){var h=I();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var O=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,D=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,R={solid:0,dash:1},y=function(v){(0,_.default)(S,v);var h=U(S);function S(){var A;(0,F.default)(this,S);for(var x=arguments.length,z=new Array(x),B=0;B<x;B++)z[B]=arguments[B];return A=h.call.apply(h,[this].concat(z)),(0,d.default)((0,w.default)(A),"texture",void 0),(0,d.default)((0,w.default)(A),"updateTexture",function(){var V=A.rendererService.createTexture2D;if(A.texture){A.texture.update({data:A.iconService.getCanvas()}),A.layer.render();return}A.texture=V({data:A.iconService.getCanvas(),mag:g.gl.NEAREST,min:g.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:A.iconService.canvasHeight||128})}),A}return(0,o.default)(S,[{key:"getUninforms",value:function(){var x=this.layer.getLayerConfig(),z=x.opacity,B=x.sourceColor,V=x.targetColor,Q=x.textureBlend,oe=Q===void 0?"normal":Q,re=x.lineType,Z=re===void 0?"solid":re,ee=x.dashArray,H=ee===void 0?[10,5]:ee,ae=x.forward,G=ae===void 0?!0:ae,ie=x.lineTexture,le=ie===void 0?!1:ie,Me=x.iconStep,ge=Me===void 0?100:Me;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:z})){this.judgeStyleAttributes({opacity:z});var pe=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,pe,this.cellProperties),Re=Ne.data,he=Ne.width,se=Ne.height;this.rowCount=se,this.dataTexture=this.cellLength>0&&Re.length>0?this.createTexture2D({flipY:!0,data:Re,format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:he,height:se}):this.createTexture2D({flipY:!0,data:[1],format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:1,height:1})}H.length===2&&H.push(0,0);var J=0,fe=[0,0,0,0],me=[0,0,0,0];return B&&V&&(fe=(0,k.rgb2arr)(B),me=(0,k.rgb2arr)(V),J=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.default)(z)?z:1,u_textureBlend:oe==="normal"?0:1,segmentNumber:30,u_line_type:R[Z||"solid"],u_dash_array:H,u_blur:.9,u_lineDir:G?1:-1,u_texture:this.texture,u_line_texture:le?1:0,u_icon_step:ge,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:J,u_sourceColor:fe,u_targetColor:me}}},{key:"getAnimateUniforms",value:function(){var x=this.layer.getLayerConfig(),z=x.animateOption;return{u_aimate:this.animateOption2Array(z),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var x,z;(x=this.texture)===null||x===void 0||x.destroy(),(z=this.dataTexture)===null||z===void 0||z.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:D,fragmentShader:O,triangulation:j.LineArcTriangulation,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var x=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(B,V,Q,oe){var re=B.size,Z=re===void 0?1:re;return Array.isArray(Z)?[Z[0]]:[Z]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:g.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:4,update:function(B,V,Q,oe){return[Q[3],Q[4],Q[5],Q[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:g.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(B,V,Q,oe){var re=x.iconService.getIconMap(),Z=B.texture,ee=re[Z]||{x:0,y:0},H=ee.x,ae=ee.y;return[H,ae]}}})}}]),S}(M.default);c.default=y},29471:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(81763)),g=n(5602),k=n(82887),M=i(n(83712)),j=n(4520);function U(v){var h=I();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var O=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,D=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,R={solid:0,dash:1},y=function(v){(0,_.default)(S,v);var h=U(S);function S(){var A;(0,F.default)(this,S);for(var x=arguments.length,z=new Array(x),B=0;B<x;B++)z[B]=arguments[B];return A=h.call.apply(h,[this].concat(z)),(0,d.default)((0,w.default)(A),"texture",void 0),(0,d.default)((0,w.default)(A),"updateTexture",function(){var V=A.rendererService.createTexture2D;if(A.texture){A.texture.update({data:A.iconService.getCanvas()}),A.layer.render();return}A.texture=V({data:A.iconService.getCanvas(),mag:g.gl.NEAREST,min:g.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:A.iconService.canvasHeight||128})}),A}return(0,o.default)(S,[{key:"getUninforms",value:function(){var x=this.layer.getLayerConfig(),z=x.opacity,B=x.sourceColor,V=x.targetColor,Q=x.textureBlend,oe=Q===void 0?"normal":Q,re=x.lineType,Z=re===void 0?"solid":re,ee=x.dashArray,H=ee===void 0?[10,5]:ee,ae=x.lineTexture,G=ae===void 0?!1:ae,ie=x.iconStep,le=ie===void 0?100:ie;H.length===2&&H.push(0,0);var Me=0,ge=[0,0,0,0],pe=[0,0,0,0];if(B&&V&&(ge=(0,k.rgb2arr)(B),pe=(0,k.rgb2arr)(V),Me=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:z})){this.judgeStyleAttributes({opacity:z});var Ne=this.layer.getEncodedData(),Re=this.calDataFrame(this.cellLength,Ne,this.cellProperties),he=Re.data,se=Re.width,J=Re.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&he.length>0?this.createTexture2D({flipY:!0,data:he,format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:se,height:J}):this.createTexture2D({flipY:!0,data:[1],format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.default)(z)?z:1,u_textureBlend:oe==="normal"?0:1,segmentNumber:30,u_line_type:R[Z]||0,u_dash_array:H,u_texture:this.texture,u_line_texture:G?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Me,u_sourceColor:ge,u_targetColor:pe}}},{key:"getAnimateUniforms",value:function(){var x=this.layer.getLayerConfig(),z=x.animateOption;return{u_aimate:this.animateOption2Array(z),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var x,z;(x=this.texture)===null||x===void 0||x.destroy(),(z=this.dataTexture)===null||z===void 0||z.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:D,fragmentShader:O,triangulation:j.LineArcTriangulation,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var x=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(B,V,Q,oe){var re=B.size,Z=re===void 0?1:re;return Array.isArray(Z)?[Z[0]]:[Z]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:g.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:4,update:function(B,V,Q,oe){return[Q[3],Q[4],Q[5],Q[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:g.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(B,V,Q,oe){var re=x.iconService.getIconMap(),Z=B.texture,ee=re[Z]||{x:0,y:0},H=ee.x,ae=ee.y;return[H,ae]}}})}}]),S}(M.default);c.default=y},59680:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(81763)),g=n(5602),k=n(82887),M=i(n(83712)),j=n(4520);function U(v){var h=I();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var O=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,D=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,R={solid:0,dash:1},y=function(v){(0,_.default)(S,v);var h=U(S);function S(){var A;(0,F.default)(this,S);for(var x=arguments.length,z=new Array(x),B=0;B<x;B++)z[B]=arguments[B];return A=h.call.apply(h,[this].concat(z)),(0,d.default)((0,w.default)(A),"texture",void 0),(0,d.default)((0,w.default)(A),"updateTexture",function(){var V=A.rendererService.createTexture2D;if(A.texture){A.texture.update({data:A.iconService.getCanvas()}),A.layer.render();return}A.texture=V({data:A.iconService.getCanvas(),mag:g.gl.NEAREST,min:g.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:A.iconService.canvasHeight||128})}),A}return(0,o.default)(S,[{key:"getUninforms",value:function(){var x=this.layer.getLayerConfig(),z=x.opacity,B=x.sourceColor,V=x.targetColor,Q=x.textureBlend,oe=Q===void 0?"normal":Q,re=x.lineType,Z=re===void 0?"solid":re,ee=x.dashArray,H=ee===void 0?[10,5]:ee,ae=x.lineTexture,G=ae===void 0?!1:ae,ie=x.iconStep,le=ie===void 0?100:ie;H.length===2&&H.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Me=0,ge=[0,0,0,0],pe=[0,0,0,0];if(B&&V&&(ge=(0,k.rgb2arr)(B),pe=(0,k.rgb2arr)(V),Me=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:z})){this.judgeStyleAttributes({opacity:z});var Ne=this.layer.getEncodedData(),Re=this.calDataFrame(this.cellLength,Ne,this.cellProperties),he=Re.data,se=Re.width,J=Re.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&he.length>0?this.createTexture2D({flipY:!0,data:he,format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:se,height:J}):this.createTexture2D({flipY:!0,data:[1],format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.default)(z)?z:1,u_textureBlend:oe==="normal"?0:1,segmentNumber:30,u_line_type:R[Z]||0,u_dash_array:H,u_texture:this.texture,u_line_texture:G?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Me,u_sourceColor:ge,u_targetColor:pe}}},{key:"getAnimateUniforms",value:function(){var x=this.layer.getLayerConfig(),z=x.animateOption;return{u_aimate:this.animateOption2Array(z),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var x,z;(x=this.texture)===null||x===void 0||x.destroy(),(z=this.dataTexture)===null||z===void 0||z.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:D,fragmentShader:O,triangulation:j.LineArcTriangulation,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var x=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(B,V,Q,oe){var re=B.size,Z=re===void 0?1:re;return Array.isArray(Z)?[Z[0]]:[Z]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:g.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:4,update:function(B,V,Q,oe){return[Q[3],Q[4],Q[5],Q[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:g.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(B,V,Q,oe){var re=x.iconService.getIconMap(),Z=B.texture,ee=re[Z]||{x:0,y:0},H=ee.x,ae=ee.y;return[H,ae]}}})}}]),S}(M.default);c.default=y},97555:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(79067)),o=i(n(29471)),w=i(n(59680)),_=i(n(83294)),P={arc:F.default,arc3d:o.default,greatcircle:w.default,line:_.default},L=P;c.default=L},83294:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(81763)),g=n(5602),k=n(82887),M=i(n(83712)),j=n(4520);function U(v){var h=I();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var O=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,D=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,R={solid:0,dash:1},y=function(v){(0,_.default)(S,v);var h=U(S);function S(){var A;(0,F.default)(this,S);for(var x=arguments.length,z=new Array(x),B=0;B<x;B++)z[B]=arguments[B];return A=h.call.apply(h,[this].concat(z)),(0,d.default)((0,w.default)(A),"texture",void 0),(0,d.default)((0,w.default)(A),"updateTexture",function(){var V=A.rendererService.createTexture2D;if(A.texture){A.texture.update({data:A.iconService.getCanvas()}),A.layer.render();return}A.texture=V({data:A.iconService.getCanvas(),mag:g.gl.NEAREST,min:g.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:A.iconService.canvasHeight||128})}),A}return(0,o.default)(S,[{key:"getUninforms",value:function(){var x=this.layer.getLayerConfig(),z=x.opacity,B=x.sourceColor,V=x.targetColor,Q=x.textureBlend,oe=Q===void 0?"normal":Q,re=x.lineType,Z=re===void 0?"solid":re,ee=x.dashArray,H=ee===void 0?[10,5,0,0]:ee,ae=x.lineTexture,G=ae===void 0?!1:ae,ie=x.iconStep,le=ie===void 0?100:ie;H.length===2&&H.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Me=0,ge=[0,0,0,0],pe=[0,0,0,0];if(B&&V&&(ge=(0,k.rgb2arr)(B),pe=(0,k.rgb2arr)(V),Me=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:z})){this.judgeStyleAttributes({opacity:z});var Ne=this.layer.getEncodedData(),Re=this.calDataFrame(this.cellLength,Ne,this.cellProperties),he=Re.data,se=Re.width,J=Re.height;this.rowCount=J,this.dataTexture=this.cellLength>0&&he.length>0?this.createTexture2D({flipY:!0,data:he,format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:se,height:J}):this.createTexture2D({flipY:!0,data:[1],format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,E.default)(z)?z:1,u_textureBlend:oe==="normal"?0:1,u_line_type:R[Z],u_dash_array:H,u_texture:this.texture,u_line_texture:G?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Me,u_sourceColor:ge,u_targetColor:pe}}},{key:"getAnimateUniforms",value:function(){var x=this.layer.getLayerConfig(),z=x.animateOption;return{u_aimate:this.animateOption2Array(z),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var x,z;(x=this.texture)===null||x===void 0||x.destroy(),(z=this.dataTexture)===null||z===void 0||z.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:D,fragmentShader:O,triangulation:j.LineTriangulation,primitive:g.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var x=this,z=this.layer.getLayerConfig(),B=z.lineType,V=B===void 0?"solid":B;this.styleAttributeService.registerStyleAttribute({name:"distance",type:g.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(oe,re,Z,ee){return[Z[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:g.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(oe,re,Z,ee){return[Z[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(oe,re,Z,ee){var H=oe.size,ae=H===void 0?1:H;return Array.isArray(ae)?[ae[0],ae[1]]:[ae,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:g.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:3,update:function(oe,re,Z,ee,H){return H}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:g.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:g.gl.STATIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(oe,re,Z,ee){return[Z[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:g.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(oe,re,Z,ee){var H=x.iconService.getIconMap(),ae=oe.texture,G=H[ae]||{x:0,y:0},ie=G.x,le=G.y;return[ie,le]}}})}},{key:"loadImage",value:function(x){return new Promise(function(z,B){if(x instanceof HTMLImageElement){z(x);return}var V=new Image;V.crossOrigin="anonymous",V.onload=function(){z(V)},V.onerror=function(){B(new Error("Could not load image at "+x))},V.src=x instanceof File?URL.createObjectURL(x):x})}}]),S}(M.default);c.default=y},79578:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=i(n(50361)),E=n(5602),g=n(82887),k=n(86700);n(28660);var M,j,U,I,O,D,R,y,v;function h(x,z){var B=Object.keys(x);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(x);z&&(V=V.filter(function(Q){return Object.getOwnPropertyDescriptor(x,Q).enumerable})),B.push.apply(B,V)}return B}function S(x){for(var z=1;z<arguments.length;z++){var B=arguments[z]!=null?arguments[z]:{};z%2?h(Object(B),!0).forEach(function(V){(0,_.default)(x,V,B[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(B)):h(Object(B)).forEach(function(V){Object.defineProperty(x,V,Object.getOwnPropertyDescriptor(B,V))})}return x}var A=(M=(0,k.injectable)(),j=(0,k.inject)(E.TYPES.IGlobalConfigService),U=(0,k.inject)(E.TYPES.IMapService),I=(0,k.inject)(E.TYPES.IFontService),M(O=(D=function(){function x(){(0,o.default)(this,x),(0,F.default)(this,"configService",R,this),(0,F.default)(this,"mapService",y,this),(0,F.default)(this,"fontService",v,this)}return(0,w.default)(x,[{key:"apply",value:function(B,V){var Q=this,oe=V.styleAttributeService;B.hooks.init.tap("DataMappingPlugin",function(){Q.generateMaping(B,{styleAttributeService:oe})}),B.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return B.dataState.dataMappingNeedUpdate=!1,Q.generateMaping(B,{styleAttributeService:oe}),!0}),B.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!B.layerModelNeedUpdate){var re=oe.getLayerStyleAttributes()||[],Z=oe.getLayerStyleAttribute("filter"),ee=B.getSource().data.dataArray,H=re.filter(function(G){return G.needRemapping}),ae=ee;Z!=null&&Z.needRemapping&&Z!==null&&Z!==void 0&&Z.scale&&(ae=ee.filter(function(G){return Q.applyAttributeMapping(Z,G)[0]})),H.length&&(Z!=null&&Z.needRemapping?(B.setEncodedData(Q.mapping(re,ae)),Z.needRemapping=!1):B.setEncodedData(Q.mapping(H,ae,B.getEncodedData())),B.emit("remapping",null))}})}},{key:"generateMaping",value:function(B,V){var Q=this,oe=V.styleAttributeService,re=oe.getLayerStyleAttributes()||[],Z=oe.getLayerStyleAttribute("filter"),ee=B.getSource().data.dataArray,H=ee;Z!=null&&Z.scale&&(H=ee.filter(function(ae){return Q.applyAttributeMapping(Z,ae)[0]})),B.setEncodedData(this.mapping(re,H))}},{key:"mapping",value:function(B,V,Q){var oe=this,re=V.map(function(Z,ee){var H=Q?Q[ee]:{},ae=S({id:Z._id,coordinates:Z.coordinates},H);return B.filter(function(G){return G.scale!==void 0}).forEach(function(G){var ie=oe.applyAttributeMapping(G,Z);G.needRemapping=!1,G.name==="color"&&(ie=ie.map(function(le){return(0,g.rgb2arr)(le)})),ae[G.name]=Array.isArray(ie)&&ie.length===1?ie[0]:ie,G.name==="shape"&&(ae.shape=oe.fontService.getIconFontKey(ae[G.name]))}),ae});return re.length>0&&this.mapService.version==="GAODE2.x"&&(typeof re[0].coordinates[0]=="number"?re.map(function(Z){Z.version="GAODE2.x",Z.originCoordinates=(0,d.default)(Z.coordinates),Z.coordinates=oe.mapService.lngLatToCoord(Z.coordinates)}):re.map(function(Z){Z.version="GAODE2.x",Z.originCoordinates=(0,d.default)(Z.coordinates),Z.coordinates=oe.mapService.lngLatToCoords(Z.coordinates)})),re}},{key:"applyAttributeMapping",value:function(B,V){var Q;if(!B.scale)return[];var oe=(B==null||(Q=B.scale)===null||Q===void 0?void 0:Q.scalers)||[],re=[];return oe.forEach(function(Z){var ee,H=Z.field;(V.hasOwnProperty(H)||((ee=B.scale)===null||ee===void 0?void 0:ee.type)==="variable")&&re.push(V[H])}),B.mapping?B.mapping(re):[]}}]),x}(),R=(0,P.default)(D.prototype,"configService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,P.default)(D.prototype,"mapService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=(0,P.default)(D.prototype,"fontService",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D))||O);c.default=A},37365:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(5602),P=i(n(14477)),L=n(86700);n(28660);var d,E,g=(d=(0,L.injectable)(),d(E=function(){function k(){(0,F.default)(this,k),(0,w.default)(this,"mapService",void 0)}return(0,o.default)(k,[{key:"apply",value:function(j){var U=this;this.mapService=j.getContainer().get(_.TYPES.IMapService),j.hooks.init.tap("DataSourcePlugin",function(){var I=j.getSource();if(!I){var O=j.sourceOption,D=O.data,R=O.options;j.setSource(new P.default(D,R))}U.updateClusterData(j)}),j.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var I=U.updateClusterData(j),O=j.dataState.dataSourceNeedUpdate;return j.dataState.dataSourceNeedUpdate=!1,I||O})}},{key:"updateClusterData",value:function(j){var U=j.getSource(),I=U.cluster,O=U.clusterOptions,D=O.zoom,R=D===void 0?0:D,y=O.maxZoom,v=y===void 0?16:y,h=this.mapService.getZoom()-1,S=j.dataState.dataSourceNeedUpdate;return I&&(S||Math.abs(R-h)>1)&&v>R?(U.updateClusterData(Math.floor(h)),!0):!1}}]),k}())||E);c.default=g},74216:function(Te,c,n){"use strict";var i=n(95318),F=n(20862);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=i(n(21165)),w=i(n(34575)),_=i(n(93913)),P=i(n(33124)),L=i(n(67268)),d=i(n(59713)),E=i(n(44908)),g=i(n(47037)),k=i(n(14293)),M=n(5602),j=n(4065),U=F(n(94644)),I=n(86700);n(28660);var O,D,R,y,v,h,S=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,A=(O={},(0,d.default)(O,M.ScaleTypes.LINEAR,U.scaleLinear),(0,d.default)(O,M.ScaleTypes.POWER,U.scalePow),(0,d.default)(O,M.ScaleTypes.LOG,U.scaleLog),(0,d.default)(O,M.ScaleTypes.IDENTITY,U.scaleIdentity),(0,d.default)(O,M.ScaleTypes.TIME,U.scaleTime),(0,d.default)(O,M.ScaleTypes.QUANTILE,U.scaleQuantile),(0,d.default)(O,M.ScaleTypes.QUANTIZE,U.scaleQuantize),(0,d.default)(O,M.ScaleTypes.THRESHOLD,U.scaleThreshold),(0,d.default)(O,M.ScaleTypes.CAT,U.scaleOrdinal),O),x=(D=(0,I.injectable)(),R=(0,I.inject)(M.TYPES.IGlobalConfigService),D(y=(v=function(){function z(){(0,w.default)(this,z),(0,o.default)(this,"configService",h,this),(0,d.default)(this,"scaleCache",{}),(0,d.default)(this,"scaleOptions",{})}return(0,_.default)(z,[{key:"apply",value:function(V,Q){var oe=this,re=Q.styleAttributeService;V.hooks.init.tap("FeatureScalePlugin",function(){oe.scaleOptions=V.getScaleOptions();var Z=re.getLayerStyleAttributes(),ee=V.getSource().data.dataArray;ee.length!==0&&oe.caculateScalesForAttributes(Z||[],ee)}),V.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){oe.scaleOptions=V.getScaleOptions();var Z=re.getLayerStyleAttributes(),ee=V.getSource().data.dataArray;return oe.caculateScalesForAttributes(Z||[],ee),V.layerModelNeedUpdate=!0,!0}),V.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!V.layerModelNeedUpdate){oe.scaleOptions=V.getScaleOptions();var Z=re.getLayerStyleAttributes();if(Z){var ee=V.getSource().data.dataArray;if(ee.length===0)return;var H=Z.filter(function(ae){return ae.needRescale});H.length&&oe.caculateScalesForAttributes(H,ee)}}})}},{key:"isNumber",value:function(V){return!isNaN(parseFloat(V))&&isFinite(V)}},{key:"caculateScalesForAttributes",value:function(V,Q){var oe=this;this.scaleCache={},V.forEach(function(re){if(re.scale){var Z=re.scale,ee=re.name;Z.names=oe.parseFields(re.scale.field||[]);var H=[];Z.names.forEach(function(ae){H.push(oe.getOrCreateScale(ae,re,Q))}),H.some(function(ae){return ae.type===M.StyleScaleType.VARIABLE})?(Z.type=M.StyleScaleType.VARIABLE,H.forEach(function(ae){if(!Z.callback){var G;if(Z.values&&Z.values!=="text"){var ie;if(((ie=ae.option)===null||ie===void 0?void 0:ie.type)==="linear"&&Z.values.length>2){var le=ae.scale.ticks(Z.values.length);ee==="color"&&ae.scale.domain(le)}ae.scale.range(Z.values)}else((G=ae.option)===null||G===void 0?void 0:G.type)==="cat"&&ae.scale.range(ae.option.domain)}})):(Z.type=M.StyleScaleType.CONSTANT,Z.defaultValues=H.map(function(ae,G){return ae.scale(Z.names[G])})),Z.scalers=H.map(function(ae){return{field:ae.field,func:ae.scale,option:ae.option}}),re.needRescale=!1}})}},{key:"getOrCreateScale",value:function(V,Q,oe){var re,Z=[V,Q.name].join("_"),ee=(re=Q.scale)===null||re===void 0?void 0:re.values,H=this.createScale(V,Q.name,ee,oe);return H}},{key:"parseFields",value:function(V){return Array.isArray(V)?V:(0,g.default)(V)?V.split("*"):[V]}},{key:"createScale",value:function(V,Q,oe,re){var Z,ee,H=this.scaleOptions[Q]&&((Z=this.scaleOptions[Q])===null||Z===void 0?void 0:Z.field)===V?this.scaleOptions[Q]:this.scaleOptions[V],ae={field:V,scale:void 0,type:M.StyleScaleType.VARIABLE,option:H};if(!re||!re.length)return H&&H.type?ae.scale=this.createDefaultScale(H):(ae.scale=U.scaleOrdinal([V]),ae.type=M.StyleScaleType.CONSTANT),ae;var G=(ee=re.find(function(Me){return!(0,k.default)(Me[V])}))===null||ee===void 0?void 0:ee[V];if(this.isNumber(V)||(0,k.default)(G)&&!H)ae.scale=U.scaleOrdinal([V]),ae.type=M.StyleScaleType.CONSTANT;else{var ie=H&&H.type||this.getDefaultType(G);oe==="text"&&(ie=M.ScaleTypes.CAT);var le=this.createDefaultScaleConfig(ie,V,re);Object.assign(le,H),ae.scale=this.createDefaultScale(le),ae.option=le}return ae}},{key:"getDefaultType",value:function(V){var Q=M.ScaleTypes.LINEAR;return typeof V=="string"&&(Q=S.test(V)?M.ScaleTypes.TIME:M.ScaleTypes.CAT),Q}},{key:"createDefaultScaleConfig",value:function(V,Q,oe){var re={type:V},Z=(oe==null?void 0:oe.map(function(ee){return ee[Q]}))||[];return V!==M.ScaleTypes.CAT&&V!==M.ScaleTypes.QUANTILE?re.domain=(0,j.extent)(Z):V===M.ScaleTypes.CAT?re.domain=(0,E.default)(Z):V===M.ScaleTypes.QUANTILE&&(re.domain=Z),re}},{key:"createDefaultScale",value:function(V){var Q=V.type,oe=V.domain,re=A[Q]();return oe&&re.domain(oe),re}}]),z}(),h=(0,P.default)(v.prototype,"configService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v))||y);c.default=x},9579:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(5602),E=n(86700);n(28660);var g,k,M,j,U,I,O;function D(v,h){var S=Object.keys(v);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(v);h&&(A=A.filter(function(x){return Object.getOwnPropertyDescriptor(v,x).enumerable})),S.push.apply(S,A)}return S}function R(v){for(var h=1;h<arguments.length;h++){var S=arguments[h]!=null?arguments[h]:{};h%2?D(Object(S),!0).forEach(function(A){(0,_.default)(v,A,S[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(S)):D(Object(S)).forEach(function(A){Object.defineProperty(v,A,Object.getOwnPropertyDescriptor(S,A))})}return v}var y=(g=(0,E.injectable)(),k=(0,E.inject)(d.TYPES.ICameraService),M=(0,E.inject)(d.TYPES.IRendererService),g(j=(U=function(){function v(){(0,o.default)(this,v),(0,F.default)(this,"cameraService",I,this),(0,F.default)(this,"rendererService",O,this)}return(0,w.default)(v,[{key:"apply",value:function(S){S.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){S.models.forEach(function(A){A.addUniforms(R({},S.layerModel.getAnimateUniforms()))})})}}]),v}(),I=(0,P.default)(U.prototype,"cameraService",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=(0,P.default)(U.prototype,"rendererService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U))||j);c.default=y},39194:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(86700);n(28660);var _,P,L=(_=(0,w.injectable)(),_(P=function(){function d(){(0,F.default)(this,d)}return(0,o.default)(d,[{key:"apply",value:function(g){g.hooks.init.tap("LayerModelPlugin",function(){g.prepareBuildModel(),g.buildModels(),g.styleNeedUpdate=!1}),g.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return g.prepareBuildModel(),g.clearModels(),g.buildModels(),g.layerModelNeedUpdate=!1,!1})}}]),d}())||P);c.default=L},53692:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(86700);n(28660);var _,P,L=(_=(0,w.injectable)(),_(P=function(){function d(){(0,F.default)(this,d)}return(0,o.default)(d,[{key:"apply",value:function(g){g.hooks.afterInit.tap("LayerStylePlugin",function(){g.updateLayerConfig({});var k=g.getLayerConfig(),M=k.autoFit,j=k.fitBoundsOptions;M&&setTimeout(function(){g.fitBounds(j)},100)})}}]),d}())||P);c.default=L},90431:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.generateLightingUniforms=O,c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(6479)),_=i(n(59713)),P=n(86700);n(28660);var L,d;function E(R,y){var v=Object.keys(R);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(R);y&&(h=h.filter(function(S){return Object.getOwnPropertyDescriptor(R,S).enumerable})),v.push.apply(v,h)}return v}function g(R){for(var y=1;y<arguments.length;y++){var v=arguments[y]!=null?arguments[y]:{};y%2?E(Object(v),!0).forEach(function(h){(0,_.default)(R,h,v[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(v)):E(Object(v)).forEach(function(h){Object.defineProperty(R,h,Object.getOwnPropertyDescriptor(v,h))})}return R}var k={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},M={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},j={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},U={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},I=null;function O(R){var y={u_DirectionalLights:new Array(3).fill(g({},j)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(g({},U)),u_NumOfSpotLights:0};return(!R||!R.length)&&(R=[M]),R.forEach(function(v,h){var S=v.type,A=S===void 0?"directional":S,x=(0,w.default)(v,["type"]),z=k[A].lights,B=k[A].num,V=y[B];y[z][V]=g(g({},y[z][V]),x),y[B]++}),y}var D=(L=(0,P.injectable)(),L(d=function(){function R(){(0,F.default)(this,R)}return(0,o.default)(R,[{key:"apply",value:function(v){v.hooks.beforeRender.tap("LightingPlugin",function(){var h=v.getLayerConfig(),S=h.enableLighting;S&&v.models.forEach(function(A){return A.addUniforms(g({},O()))})})}}]),R}())||d);c.default=D},73307:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.normalizePasses=I,c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(5602),E=n(86700);n(28660);var g,k,M,j,U;function I(D){return D.map(function(R){return typeof R=="string"&&(R=[R,{}]),R})}var O=(g=(0,E.injectable)(),k=(0,E.inject)(d.TYPES.IGlobalConfigService),g(M=(j=function(){function D(){(0,o.default)(this,D),(0,F.default)(this,"configService",U,this),(0,_.default)(this,"enabled",void 0)}return(0,w.default)(D,[{key:"apply",value:function(y,v){var h=this,S=v.rendererService,A=v.postProcessingPassFactory,x=v.normalPassFactory;y.hooks.init.tap("MultiPassRendererPlugin",function(){var z=y.getLayerConfig(),B=z.enableMultiPassRenderer,V=z.passes,Q=V===void 0?[]:V;h.enabled=!!B&&y.getLayerConfig().enableMultiPassRenderer!==!1,h.enabled&&(y.multiPassRenderer=h.createMultiPassRenderer(y,Q,A,x),y.multiPassRenderer.setRenderFlag(!0))}),y.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(y,v,h,S){var A=y.multiPassRenderer,x=y.getLayerConfig(),z=x.enablePicking,B=x.enableTAA;return z&&A.add(S("pixelPicking")),A}}]),D}(),U=(0,P.default)(j.prototype,"configService",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j))||M);c.default=O},13100:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(5602),_=n(82887),P=n(86700);n(28660);var L,d,E={NONE:0,ENCODE:1,HIGHLIGHT:2},g=(L=(0,P.injectable)(),L(d=function(){function k(){(0,F.default)(this,k)}return(0,o.default)(k,[{key:"apply",value:function(j,U){var I=U.rendererService,O=U.styleAttributeService;j.hooks.init.tap("PixelPickingPlugin",function(){var D=j.getLayerConfig(),R=D.enablePicking;O.registerStyleAttribute({name:"pickingColor",type:w.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(v,h){var S=v.id;return R?(0,_.encodePickingColor)(S):[0,0,0]}}})}),j.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var D=j.getLayerConfig(),R=D.enablePicking;R&&j.isVisible()&&j.models.forEach(function(y){return y.addUniforms({u_PickingStage:E.ENCODE})})}),j.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var D=j.getLayerConfig(),R=D.enablePicking;R&&j.isVisible()&&j.models.forEach(function(y){return y.addUniforms({u_PickingStage:E.HIGHLIGHT})})}),j.hooks.beforeHighlight.tap("PixelPickingPlugin",function(D){var R=j.getLayerConfig(),y=R.highlightColor,v=typeof y=="string"?(0,_.rgb2arr)(y):y||[1,0,0,1];j.updateLayerConfig({pickedFeatureID:(0,_.decodePickingColor)(new Uint8Array(D))}),j.models.forEach(function(h){return h.addUniforms({u_PickingStage:E.HIGHLIGHT,u_PickingColor:D,u_HighlightColor:v.map(function(S){return S*255})})})}),j.hooks.beforeSelect.tap("PixelPickingPlugin",function(D){var R=j.getLayerConfig(),y=R.selectColor,v=typeof y=="string"?(0,_.rgb2arr)(y):y||[1,0,0,1];j.updateLayerConfig({pickedFeatureID:(0,_.decodePickingColor)(new Uint8Array(D))}),j.models.forEach(function(h){return h.addUniforms({u_PickingStage:E.HIGHLIGHT,u_PickingColor:D,u_HighlightColor:v.map(function(S){return S*255})})})})}}]),k}())||d);c.default=g},23565:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(5602),_=n(86700);n(28660);var P,L,d=(P=(0,_.injectable)(),P(L=function(){function E(){(0,F.default)(this,E)}return(0,o.default)(E,[{key:"apply",value:function(k,M){var j=this,U=M.styleAttributeService;k.hooks.init.tap("RegisterStyleAttributePlugin",function(){j.registerBuiltinAttributes(U)})}},{key:"registerBuiltinAttributes",value:function(k){k.registerStyleAttribute({name:"position",type:w.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(j,U,I){return I.length===2?[I[0],I[1],0]:[I[0],I[1],I[2]]}}}),k.registerStyleAttribute({name:"filter",type:w.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(j,U){var I=j.filter;return I?[1]:[0]}}}),k.registerStyleAttribute({name:"color",type:w.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(j,U){var I=j.color;return!I||!I.length?[1,1,1,1]:I}}}),k.registerStyleAttribute({name:"vertexId",type:w.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(j,U,I,O){return[U]}}})}}]),E}())||L);c.default=d},10208:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(5602),E=n(86700);n(28660);var g,k,M,j,U,I,O,D,R,y,v,h=(g=(0,E.injectable)(),k=(0,E.inject)(d.TYPES.ICameraService),M=(0,E.inject)(d.TYPES.ICoordinateSystemService),j=(0,E.inject)(d.TYPES.IRendererService),U=(0,E.inject)(d.TYPES.IMapService),g(I=(O=function(){function S(){(0,o.default)(this,S),(0,F.default)(this,"cameraService",D,this),(0,F.default)(this,"coordinateSystemService",R,this),(0,F.default)(this,"rendererService",y,this),(0,F.default)(this,"mapService",v,this)}return(0,w.default)(S,[{key:"apply",value:function(x){var z=this,B=this.mapService.version,V=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Q=[0,0];x.hooks.beforeRender.tap("ShaderUniformPlugin",function(){z.coordinateSystemService.refresh(),B==="GAODE2.x"&&(V=z.mapService.map.customCoords.getMVPMatrix(),Q=z.mapService.getCustomCoordCenter());var oe=z.rendererService.getViewportSize(),re=oe.width,Z=oe.height;x.models.forEach(function(ee){var H;ee.addUniforms((H={},(0,_.default)(H,d.CameraUniform.ProjectionMatrix,z.cameraService.getProjectionMatrix()),(0,_.default)(H,d.CameraUniform.ViewMatrix,z.cameraService.getViewMatrix()),(0,_.default)(H,d.CameraUniform.ViewProjectionMatrix,z.cameraService.getViewProjectionMatrix()),(0,_.default)(H,d.CameraUniform.Zoom,z.cameraService.getZoom()),(0,_.default)(H,d.CameraUniform.ZoomScale,z.cameraService.getZoomScale()),(0,_.default)(H,d.CameraUniform.FocalDistance,z.cameraService.getFocalDistance()),(0,_.default)(H,d.CameraUniform.CameraPosition,z.cameraService.getCameraPosition()),(0,_.default)(H,d.CoordinateUniform.CoordinateSystem,z.coordinateSystemService.getCoordinateSystem()),(0,_.default)(H,d.CoordinateUniform.ViewportCenter,z.coordinateSystemService.getViewportCenter()),(0,_.default)(H,d.CoordinateUniform.ViewportCenterProjection,z.coordinateSystemService.getViewportCenterProjection()),(0,_.default)(H,d.CoordinateUniform.PixelsPerDegree,z.coordinateSystemService.getPixelsPerDegree()),(0,_.default)(H,d.CoordinateUniform.PixelsPerDegree2,z.coordinateSystemService.getPixelsPerDegree2()),(0,_.default)(H,d.CoordinateUniform.PixelsPerMeter,z.coordinateSystemService.getPixelsPerMeter()),(0,_.default)(H,d.CoordinateUniform.Mvp,V),(0,_.default)(H,"u_SceneCenterMKT",Q),(0,_.default)(H,"u_ViewportSize",[re,Z]),(0,_.default)(H,"u_DevicePixelRatio",window.devicePixelRatio),(0,_.default)(H,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,_.default)(H,"u_PickingBuffer",x.getLayerConfig().pickingBuffer||0),H))})})}}]),S}(),D=(0,P.default)(O.prototype,"cameraService",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=(0,P.default)(O.prototype,"coordinateSystemService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,P.default)(O.prototype,"rendererService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=(0,P.default)(O.prototype,"mapService",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O))||I);c.default=h},40990:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(86700);n(28660);var _,P,L=(_=(0,w.injectable)(),_(P=function(){function d(){(0,F.default)(this,d)}return(0,o.default)(d,[{key:"apply",value:function(g){g.hooks.beforeRender.tap("UpdateModelPlugin",function(){g.layerModel&&g.layerModel.needUpdate()})}}]),d}())||P);c.default=L},974:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=n(86700);n(28660);var _,P,L=(_=(0,w.injectable)(),_(P=function(){function d(){(0,F.default)(this,d)}return(0,o.default)(d,[{key:"apply",value:function(g,k){var M=this,j=k.styleAttributeService;g.hooks.init.tap("UpdateStyleAttributePlugin",function(){M.initStyleAttribute(g,{styleAttributeService:j})}),g.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){g.layerModelNeedUpdate||M.updateStyleAtrribute(g,{styleAttributeService:j})})}},{key:"updateStyleAtrribute",value:function(g,k){var M=k.styleAttributeService,j=M.getLayerStyleAttributes()||[],U=M.getLayerStyleAttribute("filter"),I=M.getLayerStyleAttribute("shape");if(U&&U.needRegenerateVertices||I&&I.needRegenerateVertices){g.layerModelNeedUpdate=!0,j.forEach(function(O){return O.needRegenerateVertices=!1});return}j.filter(function(O){return O.needRegenerateVertices}).forEach(function(O){M.updateAttributeByFeatureRange(O.name,g.getEncodedData(),O.featureRange.startIndex,O.featureRange.endIndex),O.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(g,k){var M=k.styleAttributeService,j=M.getLayerStyleAttributes()||[];j.filter(function(U){return U.needRegenerateVertices}).forEach(function(U){M.updateAttributeByFeatureRange(U.name,g.getEncodedData(),U.featureRange.startIndex,U.featureRange.endIndex),U.needRegenerateVertices=!1})}}]),d}())||P);c.default=L},38101:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(27083));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","PointLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var R=this.getModelType(),y={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return y[R]}},{key:"getModelType",value:function(){var R=this.getEncodedData(),y=this.getLayerConfig(),v=y.shape2d,h=y.shape3d,S=this.iconService.getIconMap(),A=R.find(function(z){return z.hasOwnProperty("shape")});if(A){var x=A.shape;return x==="dot"?"normal":(v==null?void 0:v.indexOf(x))!==-1?"fill":(h==null?void 0:h.indexOf(x))!==-1?"extrude":S.hasOwnProperty(x)?"image":this.fontService.getGlyph(x)!==""?"icon":"text"}else return"normal"}}]),O}(E.default);c.default=j},60314:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(81763)),d=n(5602),E=i(n(83712)),g=n(4520),k=n(88030);function M(D){var R=j();return function(){var v=(0,P.default)(D),h;if(R){var S=(0,P.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,_.default)(this,h)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var U=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,I=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,O=function(D){(0,w.default)(y,D);var R=M(y);function y(){return(0,F.default)(this,y),R.apply(this,arguments)}return(0,o.default)(y,[{key:"getUninforms",value:function(){var h=this.layer.getLayerConfig(),S=h.opacity,A=S===void 0?1:S;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:A})){this.judgeStyleAttributes({opacity:A});var x=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,x,this.cellProperties),B=z.data,V=z.width,Q=z.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:V,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,L.default)(A)?A:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:I,fragmentShader:U,triangulation:g.PointExtrudeTriangulation,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var h;(h=this.dataTexture)===null||h===void 0||h.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:d.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:3,update:function(S,A,x,z){var B=S.size;if(B){var V=[];return Array.isArray(B)&&(V=B.length===2?[B[0],B[0],B[1]]:B),Array.isArray(B)||(V=[B]),V}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:d.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.gl.STATIC_DRAW,data:[],type:d.gl.FLOAT},size:3,update:function(S,A,x,z,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:d.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:3,update:function(S,A){var x=(0,k.calculteCentroid)(S.coordinates);return[x[0],x[1],0]}}})}}]),y}(E.default);c.default=O},26347:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(81763)),d=n(5602),E=i(n(83712)),g=n(4520);function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,U=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,I=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"getUninforms",value:function(){var v=this.layer.getLayerConfig(),h=v.opacity,S=h===void 0?1:h,A=v.strokeOpacity,x=A===void 0?1:A,z=v.strokeWidth,B=z===void 0?0:z,V=v.stroke,Q=V===void 0?"rgba(0,0,0,0)":V,oe=v.offsets,re=oe===void 0?[0,0]:oe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:S,strokeOpacity:x,strokeWidth:B,stroke:Q,offsets:re})){this.judgeStyleAttributes({opacity:S,strokeOpacity:x,strokeWidth:B,stroke:Q,offsets:re});var Z=this.layer.getEncodedData(),ee=this.calDataFrame(this.cellLength,Z,this.cellProperties),H=ee.data,ae=ee.width,G=ee.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&H.length>0?this.createTexture2D({flipY:!0,data:H,format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:ae,height:G}):this.createTexture2D({flipY:!0,data:[1],format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,L.default)(S)?S:1,u_stroke_opacity:(0,L.default)(x)?x:1,u_stroke_width:(0,L.default)(B)?B:0,u_stroke_color:this.getStrokeColor(Q),u_offsets:this.isOffsetStatic(re)?re:[0,0]}}},{key:"getAnimateUniforms",value:function(){var v=this.layer.getLayerConfig(),h=v.animateOption;return{u_aimate:this.animateOption2Array(h),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),g.PointFillTriangulation)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:U,fragmentShader:j,triangulation:g.PointFillTriangulation,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var v;(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"animateOption2Array",value:function(v){return[v.enable?0:1,v.speed||1,v.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var v=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:d.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:2,update:function(S,A,x,z){var B=[1,1,-1,1,-1,-1,1,-1],V=z%4*2;return[B[V],B[V+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:d.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:1,update:function(S,A,x,z){var B=S.size,V=B===void 0?5:B;return Array.isArray(V)?[V[0]]:[V]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:d.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:1,update:function(S,A,x,z){var B=S.shape,V=B===void 0?2:B,Q=v.layer.getLayerConfig().shape2d,oe=Q.indexOf(V);return[oe]}}})}}]),R}(E.default);c.default=I},12064:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=i(n(83712)),k=n(4520);function M(D){var R=j();return function(){var v=(0,L.default)(D),h;if(R){var S=(0,L.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,P.default)(this,h)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var U=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,I=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,O=function(D){(0,_.default)(y,D);var R=M(y);function y(){var v;(0,F.default)(this,y);for(var h=arguments.length,S=new Array(h),A=0;A<h;A++)S[A]=arguments[A];return v=R.call.apply(R,[this].concat(S)),(0,d.default)((0,w.default)(v),"texture",void 0),v}return(0,o.default)(y,[{key:"getUninforms",value:function(){var h=this.layer.getLayerConfig(),S=h.opacity;return{u_opacity:S||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var h=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){h.updateTexture(),h.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:I,fragmentShader:U,triangulation:k.PointImageTriangulation,primitive:E.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var h;(h=this.dataTexture)===null||h===void 0||h.destroy()}},{key:"registerBuiltinAttributes",value:function(){var h=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(A,x,z,B){var V=A.size;return Array.isArray(V)?[V[0]]:[V]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(A,x,z,B){var V=h.fontService.mapping,Q=A.shape,oe=h.fontService.getGlyph(Q),re=V[oe],Z=re.x,ee=re.y;return[Z,ee]}}})}},{key:"updateTexture",value:function(){var h=this.rendererService.createTexture2D,S=this.fontService.canvas;this.texture=h({data:S,mag:E.gl.LINEAR,min:E.gl.LINEAR,width:S.width,height:S.height})}},{key:"initIconFontGlyphs",value:function(){var h=this,S=this.layer.getLayerConfig(),A=S.fontWeight,x=A===void 0?"normal":A,z=S.fontFamily,B=z===void 0?"sans-serif":z,V=this.layer.getEncodedData(),Q=[];V.forEach(function(oe){var re=oe.shape,Z=re===void 0?"":re;Z=Z.toString();var ee=h.fontService.getGlyph(Z);Q.indexOf(ee)===-1&&Q.push(ee)}),this.fontService.setFontOptions({characterSet:Q,fontWeight:x,fontFamily:B,fontSize:48})}}]),y}(g.default);c.default=O},23597:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(81763)),g=n(5602),k=i(n(83712)),M=n(4520);function j(R){var y=U();return function(){var h=(0,L.default)(R),S;if(y){var A=(0,L.default)(this).constructor;S=Reflect.construct(h,arguments,A)}else S=h.apply(this,arguments);return(0,P.default)(this,S)}}function U(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(R){return!1}}var I=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,O=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,D=function(R){(0,_.default)(v,R);var y=j(v);function v(){var h;(0,F.default)(this,v);for(var S=arguments.length,A=new Array(S),x=0;x<S;x++)A[x]=arguments[x];return h=y.call.apply(y,[this].concat(A)),(0,d.default)((0,w.default)(h),"texture",void 0),(0,d.default)((0,w.default)(h),"updateTexture",function(){var z=h.rendererService.createTexture2D;if(h.texture){h.texture.update({data:h.iconService.getCanvas()}),h.layer.renderLayers();return}h.texture=z({data:h.iconService.getCanvas(),mag:g.gl.NEAREST,min:g.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:h.iconService.canvasHeight||128})}),h}return(0,o.default)(v,[{key:"getUninforms",value:function(){var S=this.layer.getLayerConfig(),A=S.opacity,x=S.offsets,z=x===void 0?[0,0]:x;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:A,offsets:z})){this.judgeStyleAttributes({opacity:A,offsets:z});var B=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,B,this.cellProperties),Q=V.data,oe=V.width,re=V.height;this.rowCount=re,this.dataTexture=this.cellLength>0&&Q.length>0?this.createTexture2D({flipY:!0,data:Q,format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:oe,height:re}):this.createTexture2D({flipY:!0,data:[1],format:g.gl.LUMINANCE,type:g.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,E.default)(A)?A:1,u_offsets:this.isOffsetStatic(z)?z:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var S,A;(S=this.texture)===null||S===void 0||S.destroy(),(A=this.dataTexture)===null||A===void 0||A.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:O,fragmentShader:I,triangulation:M.PointImageTriangulation,primitive:g.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var S=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:g.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:1,update:function(x,z,B,V){var Q=x.size,oe=Q===void 0?5:Q;return Array.isArray(oe)?[oe[0]]:[oe]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:g.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:g.gl.DYNAMIC_DRAW,data:[],type:g.gl.FLOAT},size:2,update:function(x,z,B,V){var Q=S.iconService.getIconMap(),oe=x.shape,re=Q[oe]||{x:0,y:0},Z=re.x,ee=re.y;return[Z,ee]}}})}}]),v}(k.default);c.default=D},27083:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(60314)),o=i(n(26347)),w=i(n(12064)),_=i(n(23597)),P=i(n(48579)),L=i(n(97899)),d={fill:o.default,image:_.default,normal:P.default,extrude:F.default,text:L.default,icon:w.default},E=d;c.default=E},48579:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.PointTriangulation=I,c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(319)),d=i(n(81763)),E=n(5602),g=i(n(83712));function k(D){var R=M();return function(){var v=(0,P.default)(D),h;if(R){var S=(0,P.default)(this).constructor;h=Reflect.construct(v,arguments,S)}else h=v.apply(this,arguments);return(0,_.default)(this,h)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}var j=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,U=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function I(D){var R=D.coordinates;return{vertices:(0,L.default)(R),indices:[0],size:R.length}}var O=function(D){(0,w.default)(y,D);var R=k(y);function y(){return(0,F.default)(this,y),R.apply(this,arguments)}return(0,o.default)(y,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var h=this.layer.getLayerConfig(),S=h.opacity,A=S===void 0?1:S,x=h.offsets,z=x===void 0?[0,0]:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:A,offsets:z})){this.judgeStyleAttributes({opacity:A,offsets:z});var B=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,B,this.cellProperties),Q=V.data,oe=V.width,re=V.height;this.rowCount=re,this.dataTexture=this.cellLength>0&&Q.length>0?this.createTexture2D({flipY:!0,data:Q,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:oe,height:re}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.default)(A)?A:1,u_offsets:this.isOffsetStatic(z)?z:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:U,fragmentShader:j,triangulation:I,depth:{enable:!1},primitive:E.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var h;(h=this.dataTexture)===null||h===void 0||h.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(S,A,x,z){var B=S.size,V=B===void 0?1:B;return Array.isArray(V)?[V[0]]:[V]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:E.BlendType.additive}}}]),y}(g.default);c.default=O},97899:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.TextTriangulation=x,c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(319)),g=i(n(81763)),k=n(5602),M=n(82887),j=i(n(83712)),U=i(n(83027)),I=n(88030),O=n(75512);function D(B,V){var Q=typeof Symbol!="undefined"&&B[Symbol.iterator]||B["@@iterator"];if(!Q){if(Array.isArray(B)||(Q=R(B))||V&&B&&typeof B.length=="number"){Q&&(B=Q);var oe=0,re=function(){};return{s:re,n:function(){return oe>=B.length?{done:!0}:{done:!1,value:B[oe++]}},e:function(G){throw G},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Z=!0,ee=!1,H;return{s:function(){Q=Q.call(B)},n:function(){var G=Q.next();return Z=G.done,G},e:function(G){ee=!0,H=G},f:function(){try{!Z&&Q.return!=null&&Q.return()}finally{if(ee)throw H}}}}function R(B,V){if(!!B){if(typeof B=="string")return y(B,V);var Q=Object.prototype.toString.call(B).slice(8,-1);if(Q==="Object"&&B.constructor&&(Q=B.constructor.name),Q==="Map"||Q==="Set")return Array.from(B);if(Q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Q))return y(B,V)}}function y(B,V){(V==null||V>B.length)&&(V=B.length);for(var Q=0,oe=new Array(V);Q<V;Q++)oe[Q]=B[Q];return oe}function v(B){var V=h();return function(){var oe=(0,L.default)(B),re;if(V){var Z=(0,L.default)(this).constructor;re=Reflect.construct(oe,arguments,Z)}else re=oe.apply(this,arguments);return(0,P.default)(this,re)}}function h(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var S=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,A=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function x(B){var V=this,Q=B.id,oe=[],re=[];if(!V.glyphInfoMap||!V.glyphInfoMap[Q])return{vertices:[],indices:[],size:7};var Z=V.glyphInfoMap[Q].centroid,ee=Z.length===2?[Z[0],Z[1],0]:Z;return V.glyphInfoMap[Q].glyphQuads.forEach(function(H,ae){oe.push.apply(oe,(0,E.default)(ee).concat([H.tex.x,H.tex.y+H.tex.height,H.tl.x,H.tl.y],(0,E.default)(ee),[H.tex.x+H.tex.width,H.tex.y+H.tex.height,H.tr.x,H.tr.y],(0,E.default)(ee),[H.tex.x+H.tex.width,H.tex.y,H.br.x,H.br.y],(0,E.default)(ee),[H.tex.x,H.tex.y,H.bl.x,H.bl.y])),re.push(0+ae*4,1+ae*4,2+ae*4,2+ae*4,3+ae*4,0+ae*4)}),{vertices:oe,indices:re,size:7}}var z=function(B){(0,_.default)(Q,B);var V=v(Q);function Q(){var oe;(0,F.default)(this,Q);for(var re=arguments.length,Z=new Array(re),ee=0;ee<re;ee++)Z[ee]=arguments[ee];return oe=V.call.apply(V,[this].concat(Z)),(0,d.default)((0,w.default)(oe),"glyphInfo",void 0),(0,d.default)((0,w.default)(oe),"glyphInfoMap",{}),(0,d.default)((0,w.default)(oe),"texture",void 0),(0,d.default)((0,w.default)(oe),"currentZoom",-1),(0,d.default)((0,w.default)(oe),"extent",void 0),(0,d.default)((0,w.default)(oe),"textureHeight",0),(0,d.default)((0,w.default)(oe),"textCount",0),(0,d.default)((0,w.default)(oe),"preTextStyle",{}),(0,d.default)((0,w.default)(oe),"buildModels",function(){return oe.initGlyph(),oe.updateTexture(),oe.filterGlyphs(),oe.reBuildModel(),[oe.layer.buildLayerModel({moduleName:"pointText",vertexShader:A,fragmentShader:S,triangulation:x.bind((0,w.default)(oe)),depth:{enable:!1},blend:oe.getBlend()})]}),oe}return(0,o.default)(Q,[{key:"getUninforms",value:function(){var re=this.layer.getLayerConfig(),Z=re.opacity,ee=Z===void 0?1:Z,H=re.stroke,ae=H===void 0?"#fff":H,G=re.strokeWidth,ie=G===void 0?0:G,le=re.textAnchor,Me=le===void 0?"center":le,ge=re.textAllowOverlap,pe=ge===void 0?!1:ge,Ne=re.halo,Re=Ne===void 0?.5:Ne,he=re.gamma,se=he===void 0?2:he,J=this.fontService,fe=J.canvas,me=J.mapping;if(Object.keys(me).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(me).length),this.preTextStyle={textAnchor:Me,textAllowOverlap:pe},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:ee,strokeWidth:ie,stroke:ae})){this.judgeStyleAttributes({opacity:ee,strokeWidth:ie,stroke:ae});var Le=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,Le,this.cellProperties),X=C.data,de=C.width,Ae=C.height;this.rowCount=Ae,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:k.gl.LUMINANCE,type:k.gl.FLOAT,width:de,height:Ae}):this.createTexture2D({flipY:!0,data:[1],format:k.gl.LUMINANCE,type:k.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,g.default)(ee)?ee:1,u_stroke_width:(0,g.default)(ie)?ie:0,u_stroke_color:this.getStrokeColor(ae),u_sdf_map:this.texture,u_halo_blur:Re,u_gamma_scale:se,u_sdf_map_size:[fe.width,fe.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var re=this.layer.getLayerConfig(),Z=re.textAnchor,ee=Z===void 0?"center":Z,H=re.textAllowOverlap,ae=H===void 0?!0:H;return this.preTextStyle={textAnchor:ee,textAllowOverlap:ae},this.buildModels()}},{key:"needUpdate",value:function(){var re=this.layer.getLayerConfig(),Z=re.textAllowOverlap,ee=Z===void 0?!1:Z,H=this.mapService.getZoom(),ae=this.mapService.getBounds(),G=(0,M.boundsContains)(this.extent,ae);return!ee&&(Math.abs(this.currentZoom-H)>1||!G)||ee!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var re;(re=this.dataTexture)===null||re===void 0||re.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:k.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:k.gl.DYNAMIC_DRAW,data:[],type:k.gl.FLOAT},size:1,update:function(Z,ee,H,ae){var G=Z.rotate,ie=G===void 0?0:G;return Array.isArray(ie)?[ie[0]]:[ie]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:k.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:k.gl.STATIC_DRAW,data:[],type:k.gl.FLOAT},size:2,update:function(Z,ee,H,ae){return[H[5],H[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:k.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:k.gl.DYNAMIC_DRAW,data:[],type:k.gl.FLOAT},size:1,update:function(Z,ee,H,ae){var G=Z.size,ie=G===void 0?12:G;return Array.isArray(ie)?[ie[0]]:[ie]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:k.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:k.gl.DYNAMIC_DRAW,data:[],type:k.gl.FLOAT},size:2,update:function(Z,ee,H,ae){return[H[3],H[4]]}}})}},{key:"textExtent",value:function(){var re=this.mapService.getBounds();return(0,M.padBounds)(re,.5)}},{key:"initTextFont",value:function(){var re=this.layer.getLayerConfig(),Z=re.fontWeight,ee=Z===void 0?"400":Z,H=re.fontFamily,ae=H===void 0?"sans-serif":H,G=this.layer.getEncodedData(),ie=[];G.forEach(function(le){var Me=le.shape,ge=Me===void 0?"":Me;ge=ge.toString();var pe=D(ge),Ne;try{for(pe.s();!(Ne=pe.n()).done;){var Re=Ne.value;ie.indexOf(Re)===-1&&ie.push(Re)}}catch(he){pe.e(he)}finally{pe.f()}}),this.fontService.setFontOptions({characterSet:ie,fontWeight:ee,fontFamily:ae,iconfont:!1})}},{key:"initIconFontTex",value:function(){var re=this.layer.getLayerConfig(),Z=re.fontWeight,ee=Z===void 0?"400":Z,H=re.fontFamily,ae=H===void 0?"sans-serif":H,G=this.layer.getEncodedData(),ie=[];G.forEach(function(le){var Me=le.shape,ge=Me===void 0?"":Me;ge=ge.toString(),ie.indexOf(ge)===-1&&ie.push(ge)}),this.fontService.setFontOptions({characterSet:ie,fontWeight:ee,fontFamily:ae,iconfont:!0})}},{key:"generateGlyphLayout",value:function(re){var Z=this,ee=this.fontService.mapping,H=this.layer.getLayerConfig(),ae=H.spacing,G=ae===void 0?2:ae,ie=H.textAnchor,le=ie===void 0?"center":ie,Me=this.layer.getEncodedData();this.glyphInfo=Me.map(function(ge){var pe=ge.shape,Ne=pe===void 0?"":pe,Re=ge.id,he=ge.size,se=he===void 0?1:he,J=ge.textOffset,fe=J===void 0?[0,0]:J,me=(0,O.shapeText)(Ne.toString(),ee,se,le,"center",G,fe,re),Le=(0,O.getGlyphQuads)(me,fe,!1);return ge.shaping=me,ge.glyphQuads=Le,ge.centroid=(0,I.calculteCentroid)(ge.coordinates),ge.originCentroid=ge.version==="GAODE2.x"?(0,I.calculteCentroid)(ge.originCoordinates):ge.originCentroid=ge.centroid,Z.glyphInfoMap[Re]={shaping:me,glyphQuads:Le,centroid:(0,I.calculteCentroid)(ge.coordinates)},ge})}},{key:"filterGlyphs",value:function(){var re=this,Z=this.layer.getLayerConfig(),ee=Z.padding,H=ee===void 0?[4,4]:ee,ae=Z.textAllowOverlap,G=ae===void 0?!1:ae;if(!G){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var ie=this.rendererService.getViewportSize(),le=ie.width,Me=ie.height,ge=new U.default(le,Me),pe=this.glyphInfo.filter(function(Ne){var Re=Ne.shaping,he=Ne.id,se=he===void 0?0:he,J=Ne.version==="GAODE2.x"?Ne.originCentroid:Ne.centroid,fe=Ne.size,me=fe/24,Le=re.mapService.lngLatToContainer(J),C=ge.placeCollisionBox({x1:Re.left*me-H[0],x2:Re.right*me+H[0],y1:Re.top*me-H[1],y2:Re.bottom*me+H[1],anchorPointX:Le.x,anchorPointY:Le.y}),X=C.box;return X&&X.length?(ge.insertCollisionBox(X,se),!0):!1});pe.forEach(function(Ne){re.glyphInfoMap[Ne.id]=Ne})}}},{key:"initGlyph",value:function(){var re=this.layer.getLayerConfig(),Z=re.iconfont,ee=Z===void 0?!1:Z;ee?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(ee)}},{key:"updateTexture",value:function(){var re=this.rendererService.createTexture2D,Z=this.fontService.canvas;this.textureHeight=Z.height,this.texture&&this.texture.destroy(),this.texture=re({data:Z,mag:k.gl.LINEAR,min:k.gl.LINEAR,width:Z.width,height:Z.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:A,fragmentShader:S,triangulation:x.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),Q}(j.default);c.default=z},3464:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(53104));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","PolygonLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var R,y=this.styleAttributeService.getLayerStyleAttribute("shape"),v=y==null||(R=y.scale)===null||R===void 0?void 0:R.field;return v==="fill"?"fill":v==="extrude"?"extrude":v==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var R=this.getEncodedData(),y=this.getLayerConfig(),v=y.shape2d,h=y.shape3d,S=this.iconService.getIconMap(),A=R.find(function(z){return z.hasOwnProperty("shape")});if(A){var x=A.shape;return x==="dot"?"point_normal":(v==null?void 0:v.indexOf(x))!==-1?"point_fill":(h==null?void 0:h.indexOf(x))!==-1?"point_extrude":S.hasOwnProperty(x)?"point_image":"text"}else return"fill"}}]),O}(E.default);c.default=j},96694:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(81763)),d=n(5602),E=i(n(83712)),g=n(4520);function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,U=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,I=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"getUninforms",value:function(){var v=this.layer.getLayerConfig(),h=v.opacity,S=h===void 0?1:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:S})){this.judgeStyleAttributes({opacity:S});var A=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,A,this.cellProperties),z=x.data,B=x.width,V=x.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:B,height:V}):this.createTexture2D({flipY:!0,data:[1],format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,L.default)(S)?S:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:U,fragmentShader:j,triangulation:g.PolygonExtrudeTriangulation})]}},{key:"clearModels",value:function(){var v;(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:d.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:d.gl.STATIC_DRAW,data:[],type:d.gl.FLOAT},size:3,update:function(h,S,A,x,z){return z}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:d.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:d.gl.DYNAMIC_DRAW,data:[],type:d.gl.FLOAT},size:1,update:function(h,S,A,x){var z=h.size,B=z===void 0?10:z;return Array.isArray(B)?[B[0]]:[B]}}})}}]),R}(E.default);c.default=I},24191:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(81763)),d=n(5602),E=i(n(83712)),g=n(4520);function k(O){var D=M();return function(){var y=(0,P.default)(O),v;if(D){var h=(0,P.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,_.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,U=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,I=function(O){(0,w.default)(R,O);var D=k(R);function R(){return(0,F.default)(this,R),D.apply(this,arguments)}return(0,o.default)(R,[{key:"getUninforms",value:function(){var v=this.layer.getLayerConfig(),h=v.opacity,S=h===void 0?1:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:S})){this.judgeStyleAttributes({opacity:S});var A=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,A,this.cellProperties),z=x.data,B=x.width,V=x.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:B,height:V}):this.createTexture2D({flipY:!0,data:[1],format:d.gl.LUMINANCE,type:d.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,L.default)(S)?S:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:U,fragmentShader:j,triangulation:g.polygonTriangulation,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var v;(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),R}(E.default);c.default=I},53104:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(83294)),o=i(n(60314)),w=i(n(26347)),_=i(n(23597)),P=i(n(48579)),L=i(n(97899)),d=i(n(96694)),E=i(n(24191)),g={fill:E.default,line:F.default,extrude:d.default,text:L.default,point_fill:w.default,point_image:_.default,point_normal:P.default,point_extrude:o.default},k=g;c.default=k},30601:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(32602)),g=i(n(74053));function k(U){var I=M();return function(){var D=(0,L.default)(U),R;if(I){var y=(0,L.default)(this).constructor;R=Reflect.construct(D,arguments,y)}else R=D.apply(this,arguments);return(0,P.default)(this,R)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(U){return!1}}var j=function(U){(0,_.default)(O,U);var I=k(O);function O(){var D;(0,F.default)(this,O);for(var R=arguments.length,y=new Array(R),v=0;v<R;v++)y[v]=arguments[v];return D=I.call.apply(I,[this].concat(y)),(0,d.default)((0,w.default)(D),"type","RasterLayer"),D}return(0,o.default)(O,[{key:"buildModels",value:function(){var R=this.getModelType();this.layerModel=new g.default[R](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var R=this.getModelType(),y={raster:{},raster3d:{}};return y[R]}},{key:"getModelType",value:function(){return"raster"}}]),O}(E.default);c.default=j},74053:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(1478)),o={raster:F.default,raster3d:F.default},w=o;c.default=w},1478:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(5602),g=n(82887),k=i(n(83712)),M=n(4520);function j(R){var y=U();return function(){var h=(0,L.default)(R),S;if(y){var A=(0,L.default)(this).constructor;S=Reflect.construct(h,arguments,A)}else S=h.apply(this,arguments);return(0,P.default)(this,S)}}function U(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(R){return!1}}var I=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,O=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,D=function(R){(0,_.default)(v,R);var y=j(v);function v(){var h;(0,F.default)(this,v);for(var S=arguments.length,A=new Array(S),x=0;x<S;x++)A[x]=arguments[x];return h=y.call.apply(y,[this].concat(A)),(0,d.default)((0,w.default)(h),"texture",void 0),(0,d.default)((0,w.default)(h),"colorTexture",void 0),h}return(0,o.default)(v,[{key:"getUninforms",value:function(){var S=this.layer.getLayerConfig(),A=S.opacity,x=A===void 0?1:A,z=S.clampLow,B=z===void 0?!0:z,V=S.clampHigh,Q=V===void 0?!0:V,oe=S.noDataValue,re=oe===void 0?-9999999:oe,Z=S.domain,ee=Z===void 0?[0,1]:Z;return this.updateColorTexure(),{u_opacity:x||1,u_texture:this.texture,u_domain:ee,u_clampLow:B,u_clampHigh:typeof Q!="undefined"?Q:B,u_noDataValue:re,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var S=this.layer.getSource(),A=this.rendererService.createTexture2D,x=S.data.dataArray[0];this.texture=A({data:x.data,width:x.width,height:x.height,format:E.gl.LUMINANCE,type:E.gl.FLOAT});var z=this.layer.getLayerConfig(),B=z.rampColors,V=(0,g.generateColorRamp)(B);return this.colorTexture=A({data:V.data,width:V.width,height:V.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:O,fragmentShader:I,triangulation:M.RasterImageTriangulation,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(A,x,z,B){return[z[3],z[4]]}}})}},{key:"updateColorTexure",value:function(){var S=this.rendererService.createTexture2D,A=this.layer.getLayerConfig(),x=A.rampColors,z=(0,g.generateColorRamp)(x);this.colorTexture=S({data:z.data,width:z.width,height:z.height,flipY:!1})}}]),v}(k.default);c.default=D},39377:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.BlendTypes=void 0;var F=i(n(59713)),o=n(5602),w,_=(w={},(0,F.default)(w,o.BlendType.additive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.default)(w,o.BlendType.none,{enable:!1}),(0,F.default)(w,o.BlendType.normal,{enable:!0,func:{srcRGB:o.gl.SRC_ALPHA,dstRGB:o.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.default)(w,o.BlendType.subtractive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:o.gl.ZERO,dstAlpha:o.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:o.gl.FUNC_SUBTRACT,alpha:o.gl.FUNC_SUBTRACT}}),(0,F.default)(w,o.BlendType.max,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MAX_EXT}}),(0,F.default)(w,o.BlendType.min,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MIN_EXT}}),w);c.BlendTypes=_},83027:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(319)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=n(89568),L=i(n(48493)),d=function(){function E(g,k){(0,o.default)(this,E),(0,_.default)(this,"width",void 0),(0,_.default)(this,"height",void 0),(0,_.default)(this,"grid",void 0),(0,_.default)(this,"viewportPadding",100),(0,_.default)(this,"screenRightBoundary",void 0),(0,_.default)(this,"screenBottomBoundary",void 0),(0,_.default)(this,"gridRightBoundary",void 0),(0,_.default)(this,"gridBottomBoundary",void 0),this.width=g,this.height=k,this.viewportPadding=Math.max(g,k),this.grid=new L.default(g+this.viewportPadding,k+this.viewportPadding,25),this.screenRightBoundary=g+this.viewportPadding,this.screenBottomBoundary=k+this.viewportPadding,this.gridRightBoundary=g+2*this.viewportPadding,this.gridBottomBoundary=k+2*this.viewportPadding}return(0,w.default)(E,[{key:"placeCollisionBox",value:function(k){var M=k.x1+k.anchorPointX+this.viewportPadding,j=k.y1+k.anchorPointY+this.viewportPadding,U=k.x2+k.anchorPointX+this.viewportPadding,I=k.y2+k.anchorPointY+this.viewportPadding;return!this.isInsideGrid(M,j,U,I)||this.grid.hitTest(M,j,U,I)?{box:[]}:{box:[M,j,U,I]}}},{key:"insertCollisionBox",value:function(k,M){var j={featureIndex:M};this.grid.insert(j,k[0],k[1],k[2],k[3])}},{key:"project",value:function(k,M,j){var U=P.vec4.fromValues(M,j,0,1),I=P.vec4.create(),O=P.mat4.fromValues.apply(P.mat4,(0,F.default)(k));return P.vec4.transformMat4(I,U,O),{x:(I[0]/I[3]+1)/2*this.width+this.viewportPadding,y:(-I[1]/I[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(k,M,j,U){return j>=0&&k<this.gridRightBoundary&&U>=0&&M<this.gridBottomBoundary}}]),E}();c.default=d},7203:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.handleStyleDataMapping=d,c.handleStyleFloat=E,c.handleStyleColor=k;var F=i(n(47037)),o=i(n(81763)),w=i(n(23560)),_=i(n(1469)),P=1024;function L(M,j,U,I,O){j.updateStyleAttribute(M,U,I,O)}function d(M,j){M.opacity&&E("opacity",j,M.opacity),M.strokeWidth&&E("strokeWidth",j,M.strokeWidth),M.strokeOpacity&&E("strokeOpacity",j,M.strokeOpacity),M.stroke&&k("stroke",j,M.stroke),M.offsets&&g("offsets",j,M.offsets),M.textOffset&&g("textOffset",j,M.textOffset)}function E(M,j,U){(0,F.default)(U)?L(M,j,U,function(I){return I}):(0,o.default)(U)?L(M,j,[U],void 0):(0,_.default)(U)&&U.length===2?(0,F.default)(U[0])&&(0,w.default)(U[1])||(0,F.default)(U[0])&&(0,_.default)(U[1])&&(0,o.default)(U[1][0])&&(0,o.default)(U[1][1])?L(M,j,U[0],U[1]):L(M,j,[1],void 0):L(M,j,[1],void 0)}function g(M,j,U){(0,F.default)(U)?L(M,j,U,function(I){return I}):(0,_.default)(U)&&U.length===2&&(0,F.default)(U[0])&&(0,w.default)(U[1])?L(M,j,U[0],U[1]):(0,_.default)(U)&&U.length===2&&(0,o.default)(U[0])&&(0,o.default)(U[1])?L(M,j,U,void 0):L(M,j,[0,0],void 0)}function k(M,j,U){(0,F.default)(U)?L(M,j,U,void 0):(0,_.default)(U)&&U.length===2&&((0,F.default)(U[0])&&(0,w.default)(U[1])||(0,F.default)(U[0])&&(0,_.default)(U[1])&&U[1].length>0)?L(M,j,U[0],U[1]):L(M,j,"#fff",void 0)}},20216:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.computeMiter=U,c.computeNormal=I,c.direction=O,c.default=void 0;var F=i(n(63038)),o=i(n(319)),w=i(n(34575)),_=i(n(93913)),P=i(n(59713)),L=n(82887),d=n(89568),E=d.vec2.create(),g=d.vec2.create(),k=d.vec2.create(),M=d.vec2.create(),j=d.vec2.create();function U(v,h,S,A,x){d.vec2.add(v,S,A),d.vec2.normalize(v,v),h=d.vec2.fromValues(-v[1],v[0]);var z=d.vec2.fromValues(-S[1],S[0]);return[x/d.vec2.dot(h,z),h]}function I(v,h){return d.vec2.set(v,-h[1],h[0])}function O(v,h,S){return d.vec2.sub(v,h,S),d.vec2.normalize(v,v),v}function D(v,h){return v[0]===h[0]&&v[1]===h[1]}function R(v){for(var h=new Map,S=0;S<v.length;S++){var A=v[0].toString()+"-"+v[1].toString();h.get(A)?(v.splice(S,1),S++):h.set(A,A)}return v}var y=function(){function v(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,w.default)(this,v),(0,P.default)(this,"complex",void 0),(0,P.default)(this,"join",void 0),(0,P.default)(this,"cap",void 0),(0,P.default)(this,"miterLimit",void 0),(0,P.default)(this,"thickness",void 0),(0,P.default)(this,"normal",void 0),(0,P.default)(this,"lastFlip",-1),(0,P.default)(this,"miter",d.vec2.fromValues(0,0)),(0,P.default)(this,"started",!1),(0,P.default)(this,"dash",!1),(0,P.default)(this,"totalDistance",0),this.join=h.join||"miter",this.cap=h.cap||"butt",this.miterLimit=h.miterLimit||10,this.thickness=h.thickness||1,this.dash=h.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,_.default)(v,[{key:"extrude_gaode2",value:function(S,A){var x=this.complex;if(S.length<=1)return x;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var z=S.length,B=x.startIndex,V=1;V<z;V++){var Q=S[V-1],oe=A[V-1],re=S[V],Z=A[V],ee=V<S.length-1?S[V+1]:null,H=V<A.length-1?A[V+1]:null,ae=this.segment_gaode2(x,B,Q,re,ee,oe,Z,H);B+=ae}if(this.dash)for(var G=0;G<x.positions.length/6;G++)x.positions[G*6+5]=this.totalDistance;return x.startIndex=x.positions.length/6,x}},{key:"extrude",value:function(S){var A=this.complex;if(S.length<=1)return A;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var x=S.length,z=A.startIndex,B=1;B<x;B++){var V=S[B-1],Q=S[B],oe=B<S.length-1?S[B+1]:null,re=this.segment(A,z,V,Q,oe);z+=re}if(this.dash)for(var Z=0;Z<A.positions.length/6;Z++)A.positions[Z*6+5]=this.totalDistance;return A.startIndex=A.positions.length/6,A}},{key:"segment_gaode2",value:function(S,A,x,z,B,V,Q,oe){var re=0,Z=S.indices,ee=S.positions,H=S.normals,ae=this.cap==="square",G=this.join==="bevel",ie=(0,L.aProjectFlat)([Q[0],Q[1]]),le=(0,L.aProjectFlat)([V[0],V[1]]);O(k,z,x);var Me=0;if(this.dash&&(Me=this.lineSegmentDistance(ie,le),this.totalDistance+=Me),this.normal||(this.normal=d.vec2.create(),I(this.normal,k)),!this.started)if(this.started=!0,ae){var ge=d.vec2.create(),pe=d.vec2.create();d.vec2.add(ge,this.normal,k),d.vec2.add(pe,this.normal,k),H.push(pe[0],pe[1],0),H.push(ge[0],ge[1],0),ee.push(x[0],x[1],0,this.totalDistance-Me,-this.thickness,0),ee.push(x[0],x[1],0,this.totalDistance-Me,this.thickness,0)}else this.extrusions(ee,H,x,this.normal,this.thickness,this.totalDistance-Me);if(Z.push(A+0,A+1,A+2),B){D(z,B)&&d.vec2.add(B,z,d.vec2.normalize(B,d.vec2.subtract(B,z,x))),O(M,B,z);var he=U(j,d.vec2.create(),k,M,this.thickness),se=(0,F.default)(he,2),J=se[0],fe=se[1],me=d.vec2.dot(j,this.normal)<0?-1:1,Le=G;if(!Le&&this.join==="miter"){var C=J;C>this.miterLimit&&(Le=!0)}Le?(H.push(this.normal[0],this.normal[1],0),H.push(fe[0],fe[1],0),ee.push(z[0],z[1],0,this.totalDistance,-this.thickness*me,0),ee.push(z[0],z[1],0,this.totalDistance,this.thickness*me,0),Z.push.apply(Z,(0,o.default)(this.lastFlip!==-me?[A,A+2,A+3]:[A+2,A+1,A+3])),Z.push(A+2,A+3,A+4),I(E,M),d.vec2.copy(this.normal,E),H.push(this.normal[0],this.normal[1],0),ee.push(z[0],z[1],0,this.totalDistance,-this.thickness*me,0),re+=3):(this.extrusions(ee,H,z,fe,J,this.totalDistance),Z.push.apply(Z,(0,o.default)(this.lastFlip===1?[A,A+2,A+3]:[A+2,A+1,A+3])),me=-1,d.vec2.copy(this.normal,fe),re+=2),this.lastFlip=me}else{if(I(this.normal,k),ae){var Ne=d.vec2.create(),Re=d.vec2.create();d.vec2.sub(Re,k,this.normal),d.vec2.add(Ne,k,this.normal),H.push(Re[0],Re[1],0),H.push(Ne[0],Ne[1],0),ee.push(z[0],z[1],0,this.totalDistance,this.thickness,0),ee.push(z[0],z[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ee,H,z,this.normal,this.thickness,this.totalDistance);Z.push.apply(Z,(0,o.default)(this.lastFlip===1?[A,A+2,A+3]:[A+2,A+1,A+3])),re+=2}return re}},{key:"segment",value:function(S,A,x,z,B){var V=0,Q=S.indices,oe=S.positions,re=S.normals,Z=this.cap==="square",ee=this.join==="bevel",H=(0,L.aProjectFlat)([z[0],z[1]]),ae=(0,L.aProjectFlat)([x[0],x[1]]);O(k,H,ae);var G=0;if(this.dash&&(G=this.lineSegmentDistance(H,ae),this.totalDistance+=G),this.normal||(this.normal=d.vec2.create(),I(this.normal,k)),!this.started)if(this.started=!0,Z){var ie=d.vec2.create(),le=d.vec2.create();d.vec2.add(ie,this.normal,k),d.vec2.add(le,this.normal,k),re.push(le[0],le[1],0),re.push(ie[0],ie[1],0),oe.push(x[0],x[1],0,this.totalDistance-G,-this.thickness,0),oe.push(x[0],x[1],0,this.totalDistance-G,this.thickness,0)}else this.extrusions(oe,re,x,this.normal,this.thickness,this.totalDistance-G);if(Q.push(A+0,A+1,A+2),B){var pe=(0,L.aProjectFlat)([B[0],B[1]]);D(H,pe)&&d.vec2.add(pe,H,d.vec2.normalize(pe,d.vec2.subtract(pe,H,ae))),O(M,pe,H);var Ne=U(j,d.vec2.create(),k,M,this.thickness),Re=(0,F.default)(Ne,2),he=Re[0],se=Re[1],J=d.vec2.dot(j,this.normal)<0?-1:1,fe=ee;if(!fe&&this.join==="miter"){var me=he;me>this.miterLimit&&(fe=!0)}fe?(re.push(this.normal[0],this.normal[1],0),re.push(se[0],se[1],0),oe.push(z[0],z[1],0,this.totalDistance,-this.thickness*J,0),oe.push(z[0],z[1],0,this.totalDistance,this.thickness*J,0),Q.push.apply(Q,(0,o.default)(this.lastFlip!==-J?[A,A+2,A+3]:[A+2,A+1,A+3])),Q.push(A+2,A+3,A+4),I(E,M),d.vec2.copy(this.normal,E),re.push(this.normal[0],this.normal[1],0),oe.push(z[0],z[1],0,this.totalDistance,-this.thickness*J,0),V+=3):(this.extrusions(oe,re,z,se,he,this.totalDistance),Q.push.apply(Q,(0,o.default)(this.lastFlip===1?[A,A+2,A+3]:[A+2,A+1,A+3])),J=-1,d.vec2.copy(this.normal,se),V+=2),this.lastFlip=J}else{if(I(this.normal,k),Z){var Me=d.vec2.create(),ge=d.vec2.create();d.vec2.sub(ge,k,this.normal),d.vec2.add(Me,k,this.normal),re.push(ge[0],ge[1],0),re.push(Me[0],Me[1],0),oe.push(z[0],z[1],0,this.totalDistance,this.thickness,0),oe.push(z[0],z[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(oe,re,z,this.normal,this.thickness,this.totalDistance);Q.push.apply(Q,(0,o.default)(this.lastFlip===1?[A,A+2,A+3]:[A+2,A+1,A+3])),V+=2}return V}},{key:"extrusions",value:function(S,A,x,z,B,V){A.push(z[0],z[1],0),A.push(z[0],z[1],0),S.push(x[0],x[1],0,V,-B,0),S.push(x[0],x[1],0,V,B,0)}},{key:"lineSegmentDistance",value:function(S,A){var x=A[0]-S[0],z=A[1]-S[1];return Math.sqrt(x*x+z*z)}}]),v}();c.default=y},88030:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.calculteCentroid=o;var F=i(n(81763));function o(w){if((0,F.default)(w[0]))return w;if((0,F.default)(w[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if((0,F.default)(w[0][0][0])){var _=w,P=0,L=0,d=0;return _.forEach(function(E){E.forEach(function(g){P+=g[0],L+=g[1],d++})}),[P/d,L/d,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}},48493:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713));function _(g,k){var M=typeof Symbol!="undefined"&&g[Symbol.iterator]||g["@@iterator"];if(!M){if(Array.isArray(g)||(M=P(g))||k&&g&&typeof g.length=="number"){M&&(g=M);var j=0,U=function(){};return{s:U,n:function(){return j>=g.length?{done:!0}:{done:!1,value:g[j++]}},e:function(y){throw y},f:U}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I=!0,O=!1,D;return{s:function(){M=M.call(g)},n:function(){var y=M.next();return I=y.done,y},e:function(y){O=!0,D=y},f:function(){try{!I&&M.return!=null&&M.return()}finally{if(O)throw D}}}}function P(g,k){if(!!g){if(typeof g=="string")return L(g,k);var M=Object.prototype.toString.call(g).slice(8,-1);if(M==="Object"&&g.constructor&&(M=g.constructor.name),M==="Map"||M==="Set")return Array.from(g);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return L(g,k)}}function L(g,k){(k==null||k>g.length)&&(k=g.length);for(var M=0,j=new Array(k);M<k;M++)j[M]=g[M];return j}var d=function(){function g(k,M,j){(0,F.default)(this,g),(0,w.default)(this,"boxCells",[]),(0,w.default)(this,"xCellCount",void 0),(0,w.default)(this,"yCellCount",void 0),(0,w.default)(this,"boxKeys",void 0),(0,w.default)(this,"bboxes",void 0),(0,w.default)(this,"width",void 0),(0,w.default)(this,"height",void 0),(0,w.default)(this,"xScale",void 0),(0,w.default)(this,"yScale",void 0),(0,w.default)(this,"boxUid",void 0);var U=this.boxCells;this.xCellCount=Math.ceil(k/j),this.yCellCount=Math.ceil(M/j);for(var I=0;I<this.xCellCount*this.yCellCount;I++)U.push([]);this.boxKeys=[],this.bboxes=[],this.width=k,this.height=M,this.xScale=this.xCellCount/k,this.yScale=this.yCellCount/M,this.boxUid=0}return(0,o.default)(g,[{key:"insert",value:function(M,j,U,I,O){this.forEachCell(j,U,I,O,this.insertBoxCell,this.boxUid++),this.boxKeys.push(M),this.bboxes.push(j),this.bboxes.push(U),this.bboxes.push(I),this.bboxes.push(O)}},{key:"query",value:function(M,j,U,I,O){return this.queryHitTest(M,j,U,I,!1,O)}},{key:"hitTest",value:function(M,j,U,I,O){return this.queryHitTest(M,j,U,I,!0,O)}},{key:"insertBoxCell",value:function(M,j,U,I,O,D){this.boxCells[O].push(D)}},{key:"queryHitTest",value:function(M,j,U,I,O,D){if(U<0||M>this.width||I<0||j>this.height)return O?!1:[];var R=[];if(M<=0&&j<=0&&this.width<=U&&this.height<=I){if(O)return!0;for(var y=0;y<this.boxKeys.length;y++)R.push({key:this.boxKeys[y],x1:this.bboxes[y*4],y1:this.bboxes[y*4+1],x2:this.bboxes[y*4+2],y2:this.bboxes[y*4+3]});return D?R.filter(D):R}var v={hitTest:O,seenUids:{box:{},circle:{}}};return this.forEachCell(M,j,U,I,this.queryCell,R,v,D),O?R.length>0:R}},{key:"queryCell",value:function(M,j,U,I,O,D,R,y){var v=R.seenUids,h=this.boxCells[O];if(h!==null){var S=this.bboxes,A=_(h),x;try{for(A.s();!(x=A.n()).done;){var z=x.value;if(!v.box[z]){v.box[z]=!0;var B=z*4;if(M<=S[B+2]&&j<=S[B+3]&&U>=S[B+0]&&I>=S[B+1]&&(!y||y(this.boxKeys[z]))){if(R.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[z],x1:S[B],y1:S[B+1],x2:S[B+2],y2:S[B+3]})}}}}catch(V){A.e(V)}finally{A.f()}}return!1}},{key:"forEachCell",value:function(M,j,U,I,O,D,R,y){for(var v=this.convertToXCellCoord(M),h=this.convertToYCellCoord(j),S=this.convertToXCellCoord(U),A=this.convertToYCellCoord(I),x=v;x<=S;x++)for(var z=h;z<=A;z++){var B=this.xCellCount*z+x;if(O.call(this,M,j,U,I,B,D,R,y))return}}},{key:"convertToXCellCoord",value:function(M){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(M*this.xScale)))}},{key:"convertToYCellCoord",value:function(M){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(M*this.yScale)))}}]),g}(),E=d;c.default=E},75512:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.shapeText=d,c.getGlyphQuads=E;function n(g,k){var M=typeof Symbol!="undefined"&&g[Symbol.iterator]||g["@@iterator"];if(!M){if(Array.isArray(g)||(M=i(g))||k&&g&&typeof g.length=="number"){M&&(g=M);var j=0,U=function(){};return{s:U,n:function(){return j>=g.length?{done:!0}:{done:!1,value:g[j++]}},e:function(y){throw y},f:U}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I=!0,O=!1,D;return{s:function(){M=M.call(g)},n:function(){var y=M.next();return I=y.done,y},e:function(y){O=!0,D=y},f:function(){try{!I&&M.return!=null&&M.return()}finally{if(O)throw D}}}}function i(g,k){if(!!g){if(typeof g=="string")return F(g,k);var M=Object.prototype.toString.call(g).slice(8,-1);if(M==="Object"&&g.constructor&&(M=g.constructor.name),M==="Map"||M==="Set")return Array.from(g);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return F(g,k)}}function F(g,k){(k==null||k>g.length)&&(k=g.length);for(var M=0,j=new Array(k);M<k;M++)j[M]=g[M];return j}function o(g){var k=.5,M=.5;switch(g){case"right":case"top-right":case"bottom-right":k=1;break;case"left":case"top-left":case"bottom-left":k=0;break;default:k=.5}switch(g){case"bottom":case"bottom-right":case"bottom-left":M=1;break;case"top":case"top-right":case"top-left":M=0;break;default:M=.5}return{horizontalAlign:k,verticalAlign:M}}function w(g,k,M,j,U){if(!!U){var I=g[j],O=I.glyph;if(O)for(var D=k[O].advance*I.scale,R=(g[j].x+D)*U,y=M;y<=j;y++)g[y].x-=R}}function _(g,k,M,j,U,I,O){var D=(k-M)*U,R=(-j*O+.5)*I,y=n(g),v;try{for(y.s();!(v=y.n()).done;){var h=v.value;h.x+=D,h.y+=R}}catch(S){y.e(S)}finally{y.f()}}function P(g,k,M,j,U,I,O){var D=-8,R=0,y=D,v=0,h=g.positionedGlyphs,S=I==="right"?1:I==="left"?0:.5,A=h.length;M.forEach(function(Q){if(Q.split("").forEach(function(re){var Z=k[re],ee=0;Z&&(h.push({glyph:re,x:R,y:y+ee,vertical:!1,scale:1,metrics:Z}),R+=Z.advance+O)}),h.length!==A){var oe=R-O;v=Math.max(oe,v),w(h,k,A,h.length-1,S)}R=0,y+=j});var x=o(U),z=x.horizontalAlign,B=x.verticalAlign;_(h,S,z,B,v,j,M.length);var V=y-D;g.top+=-B*V,g.bottom=g.top+V,g.left+=-z*v,g.right=g.left+v}function L(g,k,M,j,U,I,O){var D=-8,R=0,y=D,v=0,h=g.positionedGlyphs,S=I==="right"?1:I==="left"?0:.5,A=h.length;M.forEach(function(Q){var oe=k[Q],re=0;if(oe&&(h.push({glyph:Q,x:R,y:y+re,vertical:!1,scale:1,metrics:oe}),R+=oe.advance+O),h.length!==A){var Z=R-O;v=Math.max(Z,v),w(h,k,A,h.length-1,S)}R=0,y+=j});var x=o(U),z=x.horizontalAlign,B=x.verticalAlign;_(h,S,z,B,v,j,M.length);var V=y-D;g.top+=-B*V,g.bottom=g.top+V,g.left+=-z*v,g.right=g.left+v}function d(g,k,M,j,U,I){var O=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],D=arguments.length>7?arguments[7]:void 0,R=g.split(`
`),y=[],v={positionedGlyphs:y,top:O[1],bottom:O[1],left:O[0],right:O[0],lineCount:R.length,text:g};return D?L(v,k,R,M,j,U,I):P(v,k,R,M,j,U,I),y.length?v:!1}function E(g){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],M=arguments.length>2?arguments[2]:void 0,j=g.positionedGlyphs,U=j===void 0?[]:j,I=[],O=n(U),D;try{for(O.s();!(D=O.n()).done;){var R=D.value,y=R.metrics,v=4,h=y.advance*R.scale/2,S=M?[R.x+h,R.y]:[0,0],A=M?[0,0]:[R.x+h+k[0],R.y+k[1]],x=(0-v)*R.scale-h+A[0],z=(0-v)*R.scale+A[1],B=x+y.width*R.scale,V=z+y.height*R.scale,Q={x,y:z},oe={x:B,y:z},re={x,y:V},Z={x:B,y:V};I.push({tl:Q,tr:oe,bl:re,br:Z,tex:y,glyphOffset:S})}}catch(ee){O.e(ee)}finally{O.f()}return I}},78059:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(82492)),g=n(26729),k=i(n(5077)),M=i(n(44033)),j=i(n(72057)),U=i(n(36450)),I=n(34710),O=n(6253);function D(v){var h=R();return function(){var A=(0,L.default)(v),x;if(h){var z=(0,L.default)(this).constructor;x=Reflect.construct(A,arguments,z)}else x=A.apply(this,arguments);return(0,P.default)(this,x)}}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}var y=function(v){(0,_.default)(S,v);var h=D(S);function S(A){var x;(0,F.default)(this,S),x=h.call(this),(0,d.default)((0,w.default)(x),"transform",void 0),(0,d.default)((0,w.default)(x),"options",void 0),(0,d.default)((0,w.default)(x),"moving",void 0),(0,d.default)((0,w.default)(x),"zooming",void 0),(0,d.default)((0,w.default)(x),"rotating",void 0),(0,d.default)((0,w.default)(x),"pitching",void 0),(0,d.default)((0,w.default)(x),"padding",void 0),(0,d.default)((0,w.default)(x),"bearingSnap",void 0),(0,d.default)((0,w.default)(x),"easeEndTimeoutID",void 0),(0,d.default)((0,w.default)(x),"easeStart",void 0),(0,d.default)((0,w.default)(x),"easeOptions",void 0),(0,d.default)((0,w.default)(x),"easeId",void 0),(0,d.default)((0,w.default)(x),"onEaseFrame",void 0),(0,d.default)((0,w.default)(x),"onEaseEnd",void 0),(0,d.default)((0,w.default)(x),"easeFrameId",void 0),(0,d.default)((0,w.default)(x),"renderFrameCallback",function(){var re=Math.min(((0,O.now)()-x.easeStart)/x.easeOptions.duration,1);x.onEaseFrame(x.easeOptions.easing(re)),re<1?x.easeFrameId=x.requestRenderFrame(x.renderFrameCallback):x.stop()}),x.options=A;var z=A.minZoom,B=A.maxZoom,V=A.minPitch,Q=A.maxPitch,oe=A.renderWorldCopies;return x.moving=!1,x.zooming=!1,x.bearingSnap=A.bearingSnap,x.transform=new U.default(z,B,V,Q,oe),x}return(0,o.default)(S,[{key:"requestRenderFrame",value:function(x){return 0}},{key:"cancelRenderFrame",value:function(x){}},{key:"getCenter",value:function(){var x=this.transform.center,z=x.lng,B=x.lat;return new k.default(z,B)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(x,z){return this.jumpTo({center:x},z)}},{key:"setPitch",value:function(x,z){return this.jumpTo({pitch:x},z),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(x,z,B){return this.easeTo((0,E.default)({center:x},z),B)}},{key:"zoomOut",value:function(x,z){return this.zoomTo(this.getZoom()-1,x,z),this}},{key:"setBearing",value:function(x,z){return this.jumpTo({bearing:x},z),this}},{key:"setZoom",value:function(x,z){return this.jumpTo({zoom:x},z),this}},{key:"zoomIn",value:function(x,z){return this.zoomTo(this.getZoom()+1,x,z),this}},{key:"zoomTo",value:function(x,z,B){return this.easeTo((0,E.default)({zoom:x},z),B)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(x,z){return this.jumpTo({padding:x},z),this}},{key:"rotateTo",value:function(x,z,B){return this.easeTo((0,E.default)({bearing:x},z),B)}},{key:"resetNorth",value:function(x,z){return this.rotateTo(0,(0,E.default)({duration:1e3},x),z),this}},{key:"resetNorthPitch",value:function(x,z){return this.easeTo((0,E.default)({bearing:0,pitch:0,duration:1e3},x),z),this}},{key:"fitBounds",value:function(x,z,B){return this.fitInternal(this.cameraForBounds(x,z),z,B)}},{key:"cameraForBounds",value:function(x,z){return x=M.default.convert(x),this.cameraForBoxAndBearing(x.getNorthWest(),x.getSouthEast(),0,z)}},{key:"snapToNorth",value:function(x,z){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(x,z):this}},{key:"jumpTo",value:function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=arguments.length>1?arguments[1]:void 0;this.stop();var B=this.transform,V=!1,Q=!1,oe=!1;return x.zoom&&B.zoom!==+x.zoom&&(V=!0,B.zoom=+x.zoom),x.center!==void 0&&(B.center=k.default.convert(x.center)),x.bearing&&B.bearing!==+x.bearing&&(Q=!0,B.bearing=+x.bearing),x.pitch&&B.pitch!==+x.pitch&&(oe=!0,B.pitch=+x.pitch),x.padding!=null&&!B.isPaddingEqual(x.padding)&&(B.padding=x.padding),this.emit("movestart",new I.Event("movestart",z)),this.emit("move",new I.Event("move",z)),V&&(this.emit("zoomstart",new I.Event("zoomstart",z)),this.emit("zoom",new I.Event("zoom",z)),this.emit("zoomend",new I.Event("zoomend",z))),Q&&(this.emit("rotatestart",new I.Event("rotatestart",z)),this.emit("rotate",new I.Event("rotate",z)),this.emit("rotateend",new I.Event("rotateend",z))),oe&&(this.emit("pitchstart",new I.Event("pitchstart",z)),this.emit("pitch",new I.Event("pitch",z)),this.emit("pitchend",new I.Event("pitchend",z))),this.emit("moveend",new I.Event("moveend",z))}},{key:"easeTo",value:function(){var x=this,z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=arguments.length>1?arguments[1]:void 0;z=(0,E.default)({offset:[0,0],duration:500,easing:O.ease},z),(z.animate===!1||!z.essential&&(0,O.prefersReducedMotion)())&&(z.duration=0);var V=this.transform,Q=this.getZoom(),oe=this.getBearing(),re=this.getPitch(),Z=this.getPadding(),ee=z.zoom?+z.zoom:Q,H=z.bearing?this.normalizeBearing(z.bearing,oe):oe,ae=z.pitch?+z.pitch:re,G=z.padding?z.padding:V.padding,ie=j.default.convert(z.offset),le=V.centerPoint.add(ie),Me=V.pointLocation(le),ge=k.default.convert(z.center||Me);this.normalizeCenter(ge);var pe=V.project(Me),Ne=V.project(ge).sub(pe),Re=V.zoomScale(ee-Q),he,se;z.around&&(he=k.default.convert(z.around),se=V.locationPoint(he));var J={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||ee!==Q,this.rotating=this.rotating||oe!==H,this.pitching=this.pitching||ae!==re,this.padding=!V.isPaddingEqual(G),this.easeId=z.easeId,this.prepareEase(B,z.noMoveStart,J),clearTimeout(this.easeEndTimeoutID),this.ease(function(fe){if(x.zooming&&(V.zoom=(0,O.interpolate)(Q,ee,fe)),x.rotating&&(V.bearing=(0,O.interpolate)(oe,H,fe)),x.pitching&&(V.pitch=(0,O.interpolate)(re,ae,fe)),x.padding&&(V.interpolatePadding(Z,G,fe),le=V.centerPoint.add(ie)),he)V.setLocationAtPoint(he,se);else{var me=V.zoomScale(V.zoom-Q),Le=ee>Q?Math.min(2,Re):Math.max(.5,Re),C=Math.pow(Le,1-fe),X=V.unproject(pe.add(Ne.mult(fe*C)).mult(me));V.setLocationAtPoint(V.renderWorldCopies?X.wrap():X,le)}x.fireMoveEvents(B)},function(fe){x.afterEase(B,fe)},z),this}},{key:"flyTo",value:function(){var x=this,z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=arguments.length>1?arguments[1]:void 0;if(!z.essential&&(0,O.prefersReducedMotion)()){var V=(0,O.pick)(z,["center","zoom","bearing","pitch","around"]);return this.jumpTo(V,B)}this.stop(),z=(0,E.default)({offset:[0,0],speed:1.2,curve:1.42,easing:O.ease},z);var Q=this.transform,oe=this.getZoom(),re=this.getBearing(),Z=this.getPitch(),ee=this.getPadding(),H=z.zoom?(0,O.clamp)(+z.zoom,Q.minZoom,Q.maxZoom):oe,ae=z.bearing?this.normalizeBearing(z.bearing,re):re,G=z.pitch?+z.pitch:Z,ie="padding"in z?z.padding:Q.padding,le=Q.zoomScale(H-oe),Me=j.default.convert(z.offset),ge=Q.centerPoint.add(Me),pe=Q.pointLocation(ge),Ne=k.default.convert(z.center||pe);this.normalizeCenter(Ne);var Re=Q.project(pe),he=Q.project(Ne).sub(Re),se=z.curve,J=Math.max(Q.width,Q.height),fe=J/le,me=he.mag();if("minZoom"in z){var Le=(0,O.clamp)(Math.min(z.minZoom,oe,H),Q.minZoom,Q.maxZoom),C=J/Q.zoomScale(Le-oe);se=Math.sqrt(C/me*2)}var X=se*se;function de(Ut){var At=(fe*fe-J*J+(Ut?-1:1)*X*X*me*me)/(2*(Ut?fe:J)*X*me);return Math.log(Math.sqrt(At*At+1)-At)}function Ae(Ut){return(Math.exp(Ut)-Math.exp(-Ut))/2}function De(Ut){return(Math.exp(Ut)+Math.exp(-Ut))/2}function Ge(Ut){return Ae(Ut)/De(Ut)}var $e=de(0),ct=function(At){return De($e)/De($e+se*At)},gt=function(At){return J*((De($e)*Ge($e+se*At)-Ae($e))/X)/me},st=(de(1)-$e)/se;if(Math.abs(me)<1e-6||!isFinite(st)){if(Math.abs(J-fe)<1e-6)return this.easeTo(z,B);var xe=fe<J?-1:1;st=Math.abs(Math.log(fe/J))/se,gt=function(){return 0},ct=function(At){return Math.exp(xe*se*At)}}if("duration"in z)z.duration=+z.duration;else{var Mt="screenSpeed"in z?+z.screenSpeed/se:+z.speed;z.duration=1e3*st/Mt}return z.maxDuration&&z.duration>z.maxDuration&&(z.duration=0),this.zooming=!0,this.rotating=re!==ae,this.pitching=G!==Z,this.padding=!Q.isPaddingEqual(ie),this.prepareEase(B,!1),this.ease(function(Ut){var At=Ut*st,nt=1/ct(At);Q.zoom=Ut===1?H:oe+Q.scaleZoom(nt),x.rotating&&(Q.bearing=(0,O.interpolate)(re,ae,Ut)),x.pitching&&(Q.pitch=(0,O.interpolate)(Z,G,Ut)),x.padding&&(Q.interpolatePadding(ee,ie,Ut),ge=Q.centerPoint.add(Me));var it=Ut===1?Ne:Q.unproject(Re.add(he.mult(gt(At))).mult(nt));Q.setLocationAtPoint(Q.renderWorldCopies?it.wrap():it,ge),x.fireMoveEvents(B)},function(){return x.afterEase(B)},z),this}},{key:"fitScreenCoordinates",value:function(x,z,B,V,Q){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(j.default.convert(x)),this.transform.pointLocation(j.default.convert(z)),B,V),V,Q)}},{key:"stop",value:function(x,z){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var B=this.onEaseEnd;delete this.onEaseEnd,B.call(this,z)}return this}},{key:"normalizeBearing",value:function(x,z){x=(0,O.wrap)(x,-180,180);var B=Math.abs(x-z);return Math.abs(x-360-z)<B&&(x-=360),Math.abs(x+360-z)<B&&(x+=360),x}},{key:"normalizeCenter",value:function(x){var z=this.transform;if(!(!z.renderWorldCopies||z.lngRange)){var B=x.lng-z.center.lng;x.lng+=B>180?-360:B<-180?360:0}}},{key:"fireMoveEvents",value:function(x){this.emit("move",new I.Event("move",x)),this.zooming&&this.emit("zoom",new I.Event("zoom",x)),this.rotating&&this.emit("rotate",new I.Event("rotate",x)),this.pitching&&this.emit("rotate",new I.Event("pitch",x))}},{key:"prepareEase",value:function(x){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.moving=!0,!z&&!B.moving&&this.emit("movestart",new I.Event("movestart",x)),this.zooming&&!B.zooming&&this.emit("zoomstart",new I.Event("zoomstart",x)),this.rotating&&!B.rotating&&this.emit("rotatestart",new I.Event("rotatestart",x)),this.pitching&&!B.pitching&&this.emit("pitchstart",new I.Event("pitchstart",x))}},{key:"afterEase",value:function(x,z){if(!(this.easeId&&z&&this.easeId===z)){delete this.easeId;var B=this.zooming,V=this.rotating,Q=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,B&&this.emit("zoomend",new I.Event("zoomend",x)),V&&this.emit("rotateend",new I.Event("rotateend",x)),Q&&this.emit("pitchend",new I.Event("pitchend",x)),this.emit("moveend",new I.Event("moveend",x))}}},{key:"ease",value:function(x,z,B){B.animate===!1||B.duration===0?(x(1),z()):(this.easeStart=(0,O.now)(),this.easeOptions=B,this.onEaseFrame=x,this.onEaseEnd=z,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(x,z,B,V){var Q={top:0,bottom:0,right:0,left:0};if(V=(0,E.default)({padding:Q,offset:[0,0],maxZoom:this.transform.maxZoom},V),typeof V.padding=="number"){var oe=V.padding;V.padding={top:oe,bottom:oe,right:oe,left:oe}}V.padding=(0,E.default)(Q,V.padding);var re=this.transform,Z=re.padding,ee=re.project(k.default.convert(x)),H=re.project(k.default.convert(z)),ae=ee.rotate(-B*Math.PI/180),G=H.rotate(-B*Math.PI/180),ie=new j.default(Math.max(ae.x,G.x),Math.max(ae.y,G.y)),le=new j.default(Math.min(ae.x,G.x),Math.min(ae.y,G.y)),Me=ie.sub(le),ge=(re.width-(Z.left+Z.right+V.padding.left+V.padding.right))/Me.x,pe=(re.height-(Z.top+Z.bottom+V.padding.top+V.padding.bottom))/Me.y;if(!(pe<0||ge<0)){var Ne=Math.min(re.scaleZoom(re.scale*Math.min(ge,pe)),V.maxZoom),Re=j.default.convert(V.offset),he=(V.padding.left-V.padding.right)/2,se=(V.padding.top-V.padding.bottom)/2,J=new j.default(Re.x+he,Re.y+se),fe=J.mult(re.scale/re.zoomScale(Ne)),me=re.unproject(ee.add(H).div(2).sub(fe));return{center:me,zoom:Ne,bearing:B}}}},{key:"fitInternal",value:function(x,z,B){return x?(z=(0,E.default)(x,z),delete z.padding,z.linear?this.easeTo(z,B):this.flyTo(z,B)):this}}]),S}(g.EventEmitter);c.default=y},30518:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(6253),P=i(n(72057)),L=function(){function d(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if((0,F.default)(this,d),(0,w.default)(this,"top",void 0),(0,w.default)(this,"bottom",void 0),(0,w.default)(this,"left",void 0),(0,w.default)(this,"right",void 0),isNaN(E)||E<0||isNaN(g)||g<0||isNaN(k)||k<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=E,this.bottom=g,this.left=k,this.right=M}return(0,o.default)(d,[{key:"interpolate",value:function(g,k,M){return k.top!=null&&g.top!=null&&(this.top=(0,_.interpolate)(g.top,k.top,M)),k.bottom!=null&&g.bottom!=null&&(this.bottom=(0,_.interpolate)(g.bottom,k.bottom,M)),k.left!=null&&g.left!=null&&(this.left=(0,_.interpolate)(g.left,k.left,M)),k.right!=null&&g.right!=null&&(this.right=(0,_.interpolate)(g.right,k.right,M)),this}},{key:"getCenter",value:function(g,k){var M=(0,_.clamp)((this.left+g-this.right)/2,0,g),j=(0,_.clamp)((this.top+k-this.bottom)/2,0,k);return new P.default(M,j)}},{key:"equals",value:function(g){return this.top===g.top&&this.bottom===g.bottom&&this.left===g.left&&this.right===g.right}},{key:"clone",value:function(){return new d(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),d}();c.default=L},5077:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.earthRadius=void 0;var F=i(n(50008)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=n(6253),L=63710088e-1;c.earthRadius=L;var d=function(){function E(g,k){if((0,o.default)(this,E),(0,_.default)(this,"lng",void 0),(0,_.default)(this,"lat",void 0),isNaN(g)||isNaN(k))throw new Error("Invalid LngLat object: (".concat(g,", ").concat(k,")"));if(this.lng=+g,this.lat=+k,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return(0,w.default)(E,[{key:"wrap",value:function(){return new E((0,P.wrap)(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(k){var M=Math.PI/180,j=this.lat*M,U=k.lat*M,I=Math.sin(j)*Math.sin(U)+Math.cos(j)*Math.cos(U)*Math.cos((k.lng-this.lng)*M),O=L*Math.acos(Math.min(I,1));return O}}],[{key:"convert",value:function(k){if(k instanceof E)return k;if(Array.isArray(k)&&(k.length===2||k.length===3))return new E(Number(k[0]),Number(k[1]));if(!Array.isArray(k)&&(0,F.default)(k)==="object"&&k!==null){var M="lng"in k?k.lng:k.lon;return new E(Number(M),Number(k.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),E}();c.default=d},44033:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(5077)),P=function(){function L(d,E){(0,F.default)(this,L),(0,w.default)(this,"ne",void 0),(0,w.default)(this,"sw",void 0),d&&(E?this.setSouthWest(d).setNorthEast(E):d.length===4?this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]]):this.setSouthWest(d[0]).setNorthEast(d[1]))}return(0,o.default)(L,[{key:"setNorthEast",value:function(E){return this.ne=E instanceof _.default?new _.default(E.lng,E.lat):_.default.convert(E),this}},{key:"setSouthWest",value:function(E){return this.sw=E instanceof _.default?new _.default(E.lng,E.lat):_.default.convert(E),this}},{key:"extend",value:function(E){var g=this.sw,k=this.ne,M,j;if(E instanceof _.default)M=E,j=E;else if(E instanceof L){if(M=E.sw,j=E.ne,!M||!j)return this}else{if(Array.isArray(E))if(E.length===4||E.every(Array.isArray)){var U=E;return this.extend(L.convert(U))}else{var I=E;return this.extend(_.default.convert(I))}return this}return!g&&!k?(this.sw=new _.default(M.lng,M.lat),this.ne=new _.default(j.lng,j.lat)):(g.lng=Math.min(M.lng,g.lng),g.lat=Math.min(M.lat,g.lat),k.lng=Math.max(j.lng,k.lng),k.lat=Math.max(j.lat,k.lat)),this}},{key:"getCenter",value:function(){return new _.default((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new _.default(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new _.default(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(E){var g=_.default.convert(E),k=g.lng,M=g.lat,j=this.sw.lat<=M&&M<=this.ne.lat,U=this.sw.lng<=k&&k<=this.ne.lng;return this.sw.lng>this.ne.lng&&(U=this.sw.lng>=k&&k>=this.ne.lng),j&&U}}],[{key:"convert",value:function(E){return E instanceof L?E:new L(E)}}]),L}();c.default=P},45157:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.mercatorXfromLng=E,c.mercatorYfromLat=g,c.mercatorZfromAltitude=k,c.lngFromMercatorX=M,c.latFromMercatorY=j,c.altitudeFromMercatorZ=U,c.mercatorScale=I,c.default=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(59713)),P=i(n(5077)),L=2*Math.PI*P.earthRadius;function d(D){return L*Math.cos(D*Math.PI/180)}function E(D){return(180+D)/360}function g(D){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+D*Math.PI/360)))/360}function k(D,R){return D/d(R)}function M(D){return D*360-180}function j(D){var R=180-D*360;return 360/Math.PI*Math.atan(Math.exp(R*Math.PI/180))-90}function U(D,R){return D*d(j(R))}function I(D){return 1/Math.cos(D*Math.PI/180)}var O=function(){function D(R,y){var v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;(0,o.default)(this,D),(0,_.default)(this,"x",void 0),(0,_.default)(this,"y",void 0),(0,_.default)(this,"z",void 0),this.x=+R,this.y=+y,this.z=+v}return(0,w.default)(D,[{key:"toLngLat",value:function(){return new P.default(M(this.x),j(this.y))}},{key:"toAltitude",value:function(){return U(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/L*I(j(this.y))}}],[{key:"fromLngLat",value:function(y){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=P.default.convert(y);return new D(E(h.lng),g(h.lat),k(v,h.lat))}}]),D}();c.default=O},72057:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d){(0,F.default)(this,P),(0,w.default)(this,"x",void 0),(0,w.default)(this,"y",void 0),this.x=L,this.y=d}return(0,o.default)(P,[{key:"clone",value:function(){return new P(this.x,this.y)}},{key:"_add",value:function(d){return this.x+=d.x,this.y+=d.y,this}},{key:"add",value:function(d){return this.clone()._add(d)}},{key:"_sub",value:function(d){return this.x-=d.x,this.y-=d.y,this}},{key:"sub",value:function(d){return this.clone()._sub(d)}},{key:"_multByPoint",value:function(d){return this.x*=d.x,this.y*=d.y,this}},{key:"multByPoint",value:function(d){return this.clone()._multByPoint(d)}},{key:"_divByPoint",value:function(d){return this.x/=d.x,this.y/=d.y,this}},{key:"divByPoint",value:function(d){return this.clone()._divByPoint(d)}},{key:"_mult",value:function(d){return this.x*=d,this.y*=d,this}},{key:"mult",value:function(d){return this.clone()._mult(d)}},{key:"_div",value:function(d){return this.x/=d,this.y/=d,this}},{key:"div",value:function(d){return this.clone()._div(d)}},{key:"_rotate",value:function(d){var E=Math.cos(d),g=Math.sin(d),k=E*this.x-g*this.y,M=g*this.x+E*this.y;return this.x=k,this.y=M,this}},{key:"rotate",value:function(d){return this.clone()._rotate(d)}},{key:"_rotateAround",value:function(d,E){var g=Math.cos(d),k=Math.sin(d),M=E.x+g*(this.x-E.x)-k*(this.y-E.y),j=E.y+k*(this.x-E.x)+g*(this.y-E.y);return this.x=M,this.y=j,this}},{key:"roateAround",value:function(d,E){return this.clone()._rotateAround(d,E)}},{key:"_matMult",value:function(d){var E=d[0]*this.x+d[1]*this.y,g=d[2]*this.x+d[3]*this.y;return this.x=E,this.y=g,this}},{key:"matMult",value:function(d){return this.clone()._matMult(d)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var d=this.y;return this.y=this.x,this.x=-d,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(d){return this.x===d.x&&this.y===d.y}},{key:"dist",value:function(d){return Math.sqrt(this.distSqr(d))}},{key:"distSqr",value:function(d){var E=d.x-this.x,g=d.y-this.y;return E*E+g*g}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(d){return Math.atan2(this.y-d.y,this.x-d.x)}},{key:"angleWith",value:function(d){return this.angleWithSep(d.x,d.y)}},{key:"angleWithSep",value:function(d,E){return Math.atan2(this.x*E-this.y*d,this.x*d+this.y*E)}}],[{key:"convert",value:function(d){return d instanceof P?d:Array.isArray(d)?new P(d[0],d[1]):d}}]),P}();c.default=_},36450:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.EXTENT=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(59713)),P=n(89568),L=F(n(72057)),d=n(6253),E=F(n(30518)),g=F(n(5077)),k=F(n(44033)),M=i(n(45157));function j(R,y){var v=typeof Symbol!="undefined"&&R[Symbol.iterator]||R["@@iterator"];if(!v){if(Array.isArray(R)||(v=U(R))||y&&R&&typeof R.length=="number"){v&&(R=v);var h=0,S=function(){};return{s:S,n:function(){return h>=R.length?{done:!0}:{done:!1,value:R[h++]}},e:function(V){throw V},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var A=!0,x=!1,z;return{s:function(){v=v.call(R)},n:function(){var V=v.next();return A=V.done,V},e:function(V){x=!0,z=V},f:function(){try{!A&&v.return!=null&&v.return()}finally{if(x)throw z}}}}function U(R,y){if(!!R){if(typeof R=="string")return I(R,y);var v=Object.prototype.toString.call(R).slice(8,-1);if(v==="Object"&&R.constructor&&(v=R.constructor.name),v==="Map"||v==="Set")return Array.from(R);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return I(R,y)}}function I(R,y){(y==null||y>R.length)&&(y=R.length);for(var v=0,h=new Array(y);v<y;v++)h[v]=R[v];return h}var O=8192;c.EXTENT=O;var D=function(){function R(y,v,h,S,A){(0,o.default)(this,R),(0,_.default)(this,"tileSize",void 0),(0,_.default)(this,"tileZoom",void 0),(0,_.default)(this,"lngRange",void 0),(0,_.default)(this,"latRange",void 0),(0,_.default)(this,"maxValidLatitude",void 0),(0,_.default)(this,"scale",void 0),(0,_.default)(this,"width",void 0),(0,_.default)(this,"height",void 0),(0,_.default)(this,"angle",void 0),(0,_.default)(this,"rotationMatrix",void 0),(0,_.default)(this,"pixelsToGLUnits",void 0),(0,_.default)(this,"cameraToCenterDistance",void 0),(0,_.default)(this,"mercatorMatrix",void 0),(0,_.default)(this,"projMatrix",void 0),(0,_.default)(this,"invProjMatrix",void 0),(0,_.default)(this,"alignedProjMatrix",void 0),(0,_.default)(this,"pixelMatrix",void 0),(0,_.default)(this,"pixelMatrixInverse",void 0),(0,_.default)(this,"glCoordMatrix",void 0),(0,_.default)(this,"labelPlaneMatrix",void 0),(0,_.default)(this,"_fov",void 0),(0,_.default)(this,"_pitch",void 0),(0,_.default)(this,"_zoom",void 0),(0,_.default)(this,"_renderWorldCopies",void 0),(0,_.default)(this,"_minZoom",void 0),(0,_.default)(this,"_maxZoom",void 0),(0,_.default)(this,"_minPitch",void 0),(0,_.default)(this,"_maxPitch",void 0),(0,_.default)(this,"_center",void 0),(0,_.default)(this,"zoomFraction",void 0),(0,_.default)(this,"unmodified",void 0),(0,_.default)(this,"edgeInsets",void 0),(0,_.default)(this,"constraining",void 0),(0,_.default)(this,"posMatrixCache",void 0),(0,_.default)(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=A===void 0?!0:A,this._minZoom=y||0,this._maxZoom=v||22,this._minPitch=h==null?0:h,this._maxPitch=S==null?60:S,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.default(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new E.default,this.posMatrixCache={},this.alignedPosMatrixCache={}}return(0,w.default)(R,[{key:"minZoom",get:function(){return this._minZoom},set:function(v){this._minZoom!==v&&(this._minZoom=v,this.zoom=Math.max(this.zoom,v))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(v){this._maxZoom!==v&&(this._maxZoom=v,this.zoom=Math.min(this.zoom,v))}},{key:"minPitch",get:function(){return this._minPitch},set:function(v){this._minPitch!==v&&(this._minPitch=v,this._pitch=Math.max(this._pitch,v))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(v){this._maxPitch!==v&&(this._maxPitch=v,this._pitch=Math.min(this._pitch,v))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(v){v===void 0?v=!0:v===null&&(v=!1),this._renderWorldCopies=v}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new L.default(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(v){var h=-(0,d.wrap)(v,-180,180)*Math.PI/180;this.angle!==h&&(this.unmodified=!1,this.angle=h,this.calcMatrices(),this.rotationMatrix=P.mat2.create(),P.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(v){var h=(0,d.clamp)(v,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==h&&(this.unmodified=!1,this._pitch=h,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(v){v=Math.max(.01,Math.min(60,v)),this._fov!==v&&(this.unmodified=!1,this._fov=v/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(v){var h=Math.min(Math.max(v,this._minZoom),this._maxZoom);this._zoom!==h&&(this.unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(v){v.lat===this._center.lat&&v.lng===this._center.lng||(this.unmodified=!1,this._center=v,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(v){this.edgeInsets.equals(v)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,v,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var v=new R(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return v.tileSize=this.tileSize,v.latRange=this.latRange,v.width=this.width,v.height=this.height,v.center=this._center,v.zoom=this.zoom,v.angle=this.angle,v.fov=this._fov,v.pitch=this._pitch,v.unmodified=this.unmodified,v.edgeInsets=this.edgeInsets.clone(),v.calcMatrices(),v}},{key:"isPaddingEqual",value:function(v){return this.edgeInsets.equals(v)}},{key:"interpolatePadding",value:function(v,h,S){this.unmodified=!1,this.edgeInsets.interpolate(v,h,S),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(v){var h=(v.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/v.tileSize));return Math.max(0,h)}},{key:"resize",value:function(v,h){this.width=v,this.height=h,this.pixelsToGLUnits=[2/v,-2/h],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(v){return Math.pow(2,v)}},{key:"scaleZoom",value:function(v){return Math.log(v)/Math.LN2}},{key:"project",value:function(v){var h=(0,d.clamp)(v.lat,-this.maxValidLatitude,this.maxValidLatitude);return new L.default((0,M.mercatorXfromLng)(v.lng)*this.worldSize,(0,M.mercatorYfromLat)(h)*this.worldSize)}},{key:"unproject",value:function(v){return new M.default(v.x/this.worldSize,v.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(v,h){var S=this.pointCoordinate(h),A=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(v),z=new M.default(x.x-(S.x-A.x),x.y-(S.y-A.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(v){var h=0,S=new Float32Array([v.x,v.y,0,1]),A=new Float32Array([v.x,v.y,1,1]);P.vec4.transformMat4(S,S,this.pixelMatrixInverse),P.vec4.transformMat4(A,A,this.pixelMatrixInverse);var x=S[3],z=A[3],B=S[0]/x,V=A[0]/z,Q=S[1]/x,oe=A[1]/z,re=S[2]/x,Z=A[2]/z,ee=re===Z?0:(h-re)/(Z-re);return new M.default((0,d.interpolate)(B,V,ee)/this.worldSize,(0,d.interpolate)(Q,oe,ee)/this.worldSize)}},{key:"getBounds",value:function(){return new k.default().extend(this.pointLocation(new L.default(0,0))).extend(this.pointLocation(new L.default(this.width,0))).extend(this.pointLocation(new L.default(this.width,this.height))).extend(this.pointLocation(new L.default(0,this.height)))}},{key:"getMaxBounds",value:function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new k.default([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}},{key:"setMaxBounds",value:function(v){v?(this.lngRange=[v.getWest(),v.getEast()],this.latRange=[v.getSouth(),v.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var v=this.pointCoordinate(new L.default(0,0)),h=new Float32Array([v.x*this.worldSize,v.y*this.worldSize,0,1]),S=P.vec4.transformMat4(h,h,this.pixelMatrix);return S[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var v=this._pitch,h=Math.tan(v)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new L.default(0,h))}},{key:"getCameraQueryGeometry",value:function(v){var h=this.getCameraPoint();if(v.length===1)return[v[0],h];var S=h.x,A=h.y,x=h.x,z=h.y,B=j(v),V;try{for(B.s();!(V=B.n()).done;){var Q=V.value;S=Math.min(S,Q.x),A=Math.min(A,Q.y),x=Math.max(x,Q.x),z=Math.max(z,Q.y)}}catch(oe){B.e(oe)}finally{B.f()}return[new L.default(S,A),new L.default(x,A),new L.default(x,z),new L.default(S,z),new L.default(S,A)]}},{key:"coordinatePoint",value:function(v){var h=P.vec4.fromValues(v.x*this.worldSize,v.y*this.worldSize,0,1);return P.vec4.transformMat4(h,h,this.pixelMatrix),new L.default(h[0]/h[3],h[1]/h[3])}},{key:"locationPoint",value:function(v){return this.coordinatePoint(this.locationCoordinate(v))}},{key:"pointLocation",value:function(v){return this.coordinateLocation(this.pointCoordinate(v))}},{key:"locationCoordinate",value:function(v){return M.default.fromLngLat(v)}},{key:"coordinateLocation",value:function(v){return v.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(!(!this.center||!this.width||!this.height||this.constraining)){this.constraining=!0;var v=-90,h=90,S=-180,A=180,x,z,B,V,Q=this.size,oe=this.unmodified;if(this.latRange){var re=this.latRange;v=(0,M.mercatorYfromLat)(re[1])*this.worldSize,h=(0,M.mercatorYfromLat)(re[0])*this.worldSize,x=h-v<Q.y?Q.y/(h-v):0}if(this.lngRange){var Z=this.lngRange;S=(0,M.mercatorXfromLng)(Z[0])*this.worldSize,A=(0,M.mercatorXfromLng)(Z[1])*this.worldSize,z=A-S<Q.x?Q.x/(A-S):0}var ee=this.point,H=Math.max(z||0,x||0);if(H){this.center=this.unproject(new L.default(z?(A+S)/2:ee.x,x?(h+v)/2:ee.y)),this.zoom+=this.scaleZoom(H),this.unmodified=oe,this.constraining=!1;return}if(this.latRange){var ae=ee.y,G=Q.y/2;ae-G<v&&(V=v+G),ae+G>h&&(V=h-G)}if(this.lngRange){var ie=ee.x,le=Q.x/2;ie-le<S&&(B=S+le),ie+le>A&&(B=A-le)}(B!==void 0||V!==void 0)&&(this.center=this.unproject(new L.default(B!==void 0?B:ee.x,V!==void 0?V:ee.y))),this.unmodified=oe,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(!!this.height){var v=this._fov/2,h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(v)*this.height;var S=Math.PI/2+this._pitch,A=this._fov*(.5+h.y/this.height),x=Math.sin(A)*this.cameraToCenterDistance/Math.sin((0,d.clamp)(Math.PI-S-A,.01,Math.PI-.01)),z=this.point,B=z.x,V=z.y,Q=Math.cos(Math.PI/2-this._pitch)*x+this.cameraToCenterDistance,oe=Q*1.01,re=this.height/50,Z=P.mat4.create();P.mat4.perspective(Z,this._fov,this.width/this.height,re,oe),Z[8]=-h.x*2/this.width,Z[9]=h.y*2/this.height,P.mat4.scale(Z,Z,[1,-1,1]),P.mat4.translate(Z,Z,[0,0,-this.cameraToCenterDistance]),P.mat4.rotateX(Z,Z,this._pitch),P.mat4.rotateZ(Z,Z,this.angle),P.mat4.translate(Z,Z,[-B,-V,0]),this.mercatorMatrix=P.mat4.scale(P.mat4.create(),Z,[this.worldSize,this.worldSize,this.worldSize]),P.mat4.scale(Z,Z,P.vec3.fromValues(1,1,(0,M.mercatorZfromAltitude)(1,this.center.lat)*this.worldSize)),this.projMatrix=Z,this.invProjMatrix=P.mat4.invert(P.mat4.create(),this.projMatrix);var ee=this.width%2/2,H=this.height%2/2,ae=Math.cos(this.angle),G=Math.sin(this.angle),ie=B-Math.round(B)+ae*ee+G*H,le=V-Math.round(V)+ae*H+G*ee,Me=P.mat4.clone(Z);if(P.mat4.translate(Me,Me,[ie>.5?ie-1:ie,le>.5?le-1:le,0]),this.alignedProjMatrix=Me,Z=P.mat4.create(),P.mat4.scale(Z,Z,[this.width/2,-this.height/2,1]),P.mat4.translate(Z,Z,[1,-1,0]),this.labelPlaneMatrix=Z,Z=P.mat4.create(),P.mat4.scale(Z,Z,[1,-1,1]),P.mat4.translate(Z,Z,[-1,-1,0]),P.mat4.scale(Z,Z,[2/this.width,2/this.height,1]),this.glCoordMatrix=Z,this.pixelMatrix=P.mat4.multiply(P.mat4.create(),this.labelPlaneMatrix,this.projMatrix),Z=P.mat4.invert(P.mat4.create(),this.pixelMatrix),!Z)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Z,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),R}();c.default=D},43630:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(22345),P=function(){function L(d){(0,F.default)(this,L),(0,w.default)(this,"map",void 0),(0,w.default)(this,"delayContextMenu",void 0),(0,w.default)(this,"contextMenuEvent",void 0),this.map=d}return(0,o.default)(L,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(E){this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new _.MapMouseEvent("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(E){this.delayContextMenu?this.contextMenuEvent=E:this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E)),this.map.listeners("contextmenu")&&E.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),L}();c.default=P},59132:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(8376)),P=n(34710),L=function(){function E(g,k){(0,F.default)(this,E),(0,w.default)(this,"map",void 0),(0,w.default)(this,"el",void 0),(0,w.default)(this,"container",void 0),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"startPos",void 0),(0,w.default)(this,"lastPos",void 0),(0,w.default)(this,"box",void 0),(0,w.default)(this,"clickTolerance",void 0),this.map=g,this.el=g.getCanvasContainer(),this.container=g.getContainer(),this.clickTolerance=k.clickTolerance||1}return(0,o.default)(E,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"mousedown",value:function(k,M){!this.isEnabled()||!(k.shiftKey&&k.button===0)||(_.default.disableDrag(),this.startPos=this.lastPos=M,this.active=!0)}},{key:"mousemoveWindow",value:function(k,M){if(!!this.active){var j=M;if(!(this.lastPos.equals(j)||!this.box&&j.dist(this.startPos)<this.clickTolerance)){var U=this.startPos;this.lastPos=j,this.box||(this.box=_.default.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",k));var I=Math.min(U.x,j.x),O=Math.max(U.x,j.x),D=Math.min(U.y,j.y),R=Math.max(U.y,j.y);_.default.setTransform(this.box,"translate(".concat(I,"px,").concat(D,"px)")),this.box&&(this.box.style.width="".concat(O-I,"px"),this.box.style.height="".concat(R-D,"px"))}}}},{key:"mouseupWindow",value:function(k,M){var j=this;if(!!this.active&&k.button===0){var U=this.startPos,I=M;if(this.reset(),_.default.suppressClick(),U.x===I.x&&U.y===I.y)this.fireEvent("boxzoomcancel",k);else return this.map.emit("boxzoomend",new P.Event("boxzoomend",{originalEvent:k})),{cameraAnimation:function(D){return D.fitScreenCoordinates(U,I,j.map.getBearing(),{linear:!0})}}}}},{key:"keydown",value:function(k){!this.active||k.keyCode===27&&(this.reset(),this.fireEvent("boxzoomcancel",k))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(_.default.remove(this.box),this.box=null),_.default.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(k,M){return this.map.emit(k,new P.Event(k,{originalEvent:M}))}}]),E}(),d=L;c.default=d},53041:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(){(0,F.default)(this,P),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),this.reset()}return(0,o.default)(P,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(d,E){return d.preventDefault(),{cameraAnimation:function(k){k.easeTo({duration:300,zoom:k.getZoom()+(d.shiftKey?-1:1),around:k.unproject(E)},{originalEvent:d})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),P}();c.default=_},34710:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.Event=void 0;var F=i(n(34575)),o=i(n(59713)),w=i(n(82492)),_=function P(L){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,F.default)(this,P),(0,o.default)(this,"type",void 0),(0,w.default)(this,d),this.type=L};c.Event=_},22345:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"MapMouseEvent",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(c,"MapTouchEvent",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"MapWheelEvent",{enumerable:!0,get:function(){return w.default}});var F=i(n(20623)),o=i(n(31428)),w=i(n(2237))},20623:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(82492)),g=i(n(8376)),k=n(34710);function M(I){var O=j();return function(){var R=(0,L.default)(I),y;if(O){var v=(0,L.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,P.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=function(I){(0,_.default)(D,I);var O=M(D);function D(R,y,v){var h,S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};(0,F.default)(this,D);var A=g.default.mousePos(y.getCanvasContainer(),v),x=y.unproject(A);return h=O.call(this,R,(0,E.default)({point:A,lngLat:x,originalEvent:v},S)),(0,d.default)((0,w.default)(h),"type",void 0),(0,d.default)((0,w.default)(h),"target",void 0),(0,d.default)((0,w.default)(h),"originalEvent",void 0),(0,d.default)((0,w.default)(h),"point",void 0),(0,d.default)((0,w.default)(h),"lngLat",void 0),(0,d.default)((0,w.default)(h),"defaultPrevented",void 0),h.defaultPrevented=!1,h.target=y,h}return(0,o.default)(D,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),D}(k.Event);c.default=U},31428:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(72057)),g=i(n(8376)),k=n(34710);function M(I){var O=j();return function(){var R=(0,L.default)(I),y;if(O){var v=(0,L.default)(this).constructor;y=Reflect.construct(R,arguments,v)}else y=R.apply(this,arguments);return(0,P.default)(this,y)}}function j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var U=function(I){(0,_.default)(D,I);var O=M(D);function D(R,y,v){var h;(0,F.default)(this,D);var S=R==="touchend"?v.changedTouches:v.touches,A=g.default.touchPos(y.getCanvasContainer(),S),x=A.map(function(V){return y.unproject(V)}),z=A.reduce(function(V,Q,oe,re){return V.add(Q.div(re.length))},new E.default(0,0)),B=y.unproject(z);return h=O.call(this,R,{points:A,point:z,lngLats:x,lngLat:B,originalEvent:v}),(0,d.default)((0,w.default)(h),"type",void 0),(0,d.default)((0,w.default)(h),"target",void 0),(0,d.default)((0,w.default)(h),"originalEvent",void 0),(0,d.default)((0,w.default)(h),"lngLat",void 0),(0,d.default)((0,w.default)(h),"point",void 0),(0,d.default)((0,w.default)(h),"points",void 0),(0,d.default)((0,w.default)(h),"lngLats",void 0),(0,d.default)((0,w.default)(h),"defaultPrevented",void 0),h.defaultPrevented=!1,h}return(0,o.default)(D,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),D}(k.Event);c.default=U},2237:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=n(34710);function g(j){var U=k();return function(){var O=(0,L.default)(j),D;if(U){var R=(0,L.default)(this).constructor;D=Reflect.construct(O,arguments,R)}else D=O.apply(this,arguments);return(0,P.default)(this,D)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var M=function(j){(0,_.default)(I,j);var U=g(I);function I(O,D,R){var y;return(0,F.default)(this,I),y=U.call(this,O,{originalEvent:R}),(0,d.default)((0,w.default)(y),"type",void 0),(0,d.default)((0,w.default)(y),"originalEvent",void 0),(0,d.default)((0,w.default)(y),"defaultPrevented",void 0),(0,d.default)((0,w.default)(y),"target",void 0),y.defaultPrevented=!1,y}return(0,o.default)(I,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),I}(E.Event);c.default=M},89058:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(81506)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(59713)),d=n(34710);function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){var I;(0,F.default)(this,U);for(var O=arguments.length,D=new Array(O),R=0;R<O;R++)D[R]=arguments[R];return I=j.call.apply(j,[this].concat(D)),(0,L.default)((0,o.default)(I),"type","renderFrame"),(0,L.default)((0,o.default)(I),"timeStamp",void 0),I}return U}(d.Event);c.default=k},29923:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(72057)),P=i(n(82492)),L=n(6253);function d(y,v){var h=typeof Symbol!="undefined"&&y[Symbol.iterator]||y["@@iterator"];if(!h){if(Array.isArray(y)||(h=E(y))||v&&y&&typeof y.length=="number"){h&&(y=h);var S=0,A=function(){};return{s:A,n:function(){return S>=y.length?{done:!0}:{done:!1,value:y[S++]}},e:function(Q){throw Q},f:A}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=!0,z=!1,B;return{s:function(){h=h.call(y)},n:function(){var Q=h.next();return x=Q.done,Q},e:function(Q){z=!0,B=Q},f:function(){try{!x&&h.return!=null&&h.return()}finally{if(z)throw B}}}}function E(y,v){if(!!y){if(typeof y=="string")return g(y,v);var h=Object.prototype.toString.call(y).slice(8,-1);if(h==="Object"&&y.constructor&&(h=y.constructor.name),h==="Map"||h==="Set")return Array.from(y);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return g(y,v)}}function g(y,v){(v==null||v>y.length)&&(v=y.length);for(var h=0,S=new Array(v);h<v;h++)S[h]=y[h];return S}var k={linearity:.3,easing:(0,L.bezier)(0,0,.3,1)},M=(0,P.default)({deceleration:2500,maxSpeed:1400},k),j=(0,P.default)({deceleration:20,maxSpeed:1400},k),U=(0,P.default)({deceleration:1e3,maxSpeed:360},k),I=(0,P.default)({deceleration:1e3,maxSpeed:90},k),O=function(){function y(v){(0,F.default)(this,y),(0,w.default)(this,"map",void 0),(0,w.default)(this,"inertiaBuffer",void 0),this.map=v,this.clear()}return(0,o.default)(y,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(h){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:(0,L.now)(),settings:h})}},{key:"drainInertiaBuffer",value:function(){for(var h=this.inertiaBuffer,S=(0,L.now)(),A=160;h.length>0&&S-h[0].time>A;)h.shift()}},{key:"onMoveEnd",value:function(h){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var S={zoom:0,bearing:0,pitch:0,pan:new _.default(0,0),pinchAround:void 0,around:void 0},A=d(this.inertiaBuffer),x;try{for(A.s();!(x=A.n()).done;){var z=x.value.settings;S.zoom+=z.zoomDelta||0,S.bearing+=z.bearingDelta||0,S.pitch+=z.pitchDelta||0,z.panDelta&&S.pan._add(z.panDelta),z.around&&(S.around=z.around),z.pinchAround&&(S.pinchAround=z.pinchAround)}}catch(ae){A.e(ae)}finally{A.f()}var B=this.inertiaBuffer[this.inertiaBuffer.length-1],V=B.time-this.inertiaBuffer[0].time,Q={};if(S.pan.mag()){var oe=R(S.pan.mag(),V,(0,P.default)({},M,h||{}));Q.offset=S.pan.mult(oe.amount/S.pan.mag()),Q.center=this.map.transform.center,D(Q,oe)}if(S.zoom){var re=R(S.zoom,V,j);Q.zoom=this.map.transform.zoom+re.amount,D(Q,re)}if(S.bearing){var Z=R(S.bearing,V,U);Q.bearing=this.map.transform.bearing+(0,L.clamp)(Z.amount,-179,179),D(Q,Z)}if(S.pitch){var ee=R(S.pitch,V,I);Q.pitch=this.map.transform.pitch+ee.amount,D(Q,ee)}if(Q.zoom||Q.bearing){var H=S.pinchAround===void 0?S.around:S.pinchAround;Q.around=H?this.map.unproject(H):this.map.getCenter()}return this.clear(),(0,P.default)(Q,{noMoveStart:!0})}}}]),y}();c.default=O;function D(y,v){(!y.duration||y.duration<v.duration)&&(y.duration=v.duration,y.easing=v.easing)}function R(y,v,h){var S=h.maxSpeed,A=h.linearity,x=h.deceleration,z=(0,L.clamp)(y*A/(v/1e3),-S,S),B=Math.abs(z)/(x*A);return{easing:h.easing,duration:B*1e3,amount:z*(B/2)}}},32320:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(82492)),L=i(n(72057)),d=i(n(8376)),E=i(n(43630)),g=i(n(59132)),k=i(n(53041)),M=n(34710),j=i(n(89058)),U=i(n(29923)),I=i(n(60157)),O=i(n(51750)),D=n(20289),R=i(n(92936)),y=i(n(42517)),v=i(n(53320)),h=i(n(72707)),S=i(n(9809)),A=i(n(7714)),x=i(n(47982)),z=n(27357);function B(H,ae){var G=typeof Symbol!="undefined"&&H[Symbol.iterator]||H["@@iterator"];if(!G){if(Array.isArray(H)||(G=V(H))||ae&&H&&typeof H.length=="number"){G&&(H=G);var ie=0,le=function(){};return{s:le,n:function(){return ie>=H.length?{done:!0}:{done:!1,value:H[ie++]}},e:function(Re){throw Re},f:le}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Me=!0,ge=!1,pe;return{s:function(){G=G.call(H)},n:function(){var Re=G.next();return Me=Re.done,Re},e:function(Re){ge=!0,pe=Re},f:function(){try{!Me&&G.return!=null&&G.return()}finally{if(ge)throw pe}}}}function V(H,ae){if(!!H){if(typeof H=="string")return Q(H,ae);var G=Object.prototype.toString.call(H).slice(8,-1);if(G==="Object"&&H.constructor&&(G=H.constructor.name),G==="Map"||G==="Set")return Array.from(H);if(G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G))return Q(H,ae)}}function Q(H,ae){(ae==null||ae>H.length)&&(ae=H.length);for(var G=0,ie=new Array(ae);G<ae;G++)ie[G]=H[G];return ie}var oe=function(ae){return ae.zoom||ae.drag||ae.pitch||ae.rotate};function re(H){return H.panDelta&&H.panDelta.mag()||H.zoomDelta||H.bearingDelta||H.pitchDelta}var Z=function(){function H(ae,G){var ie=this;(0,o.default)(this,H),(0,_.default)(this,"map",void 0),(0,_.default)(this,"el",void 0),(0,_.default)(this,"handlers",void 0),(0,_.default)(this,"eventsInProgress",void 0),(0,_.default)(this,"frameId",void 0),(0,_.default)(this,"inertia",void 0),(0,_.default)(this,"bearingSnap",void 0),(0,_.default)(this,"handlersById",void 0),(0,_.default)(this,"updatingCamera",void 0),(0,_.default)(this,"changes",void 0),(0,_.default)(this,"previousActiveHandlers",void 0),(0,_.default)(this,"bearingChanged",void 0),(0,_.default)(this,"listeners",void 0),(0,_.default)(this,"handleWindowEvent",function(se){ie.handleEvent(se,"".concat(se.type,"Window"))}),(0,_.default)(this,"handleEvent",function(se,J){if(se.type==="blur"){ie.stop();return}ie.updatingCamera=!0;var fe=se.type==="renderFrame"?void 0:se,me={needsRenderFrame:!1},Le={},C={},X=se.touches?ie.getMapTouches(se.touches):void 0,de=X?d.default.touchPos(ie.el,X):d.default.mousePos(ie.el,se),Ae=B(ie.handlers),De;try{for(Ae.s();!(De=Ae.n()).done;){var Ge=De.value,$e=Ge.handlerName,ct=Ge.handler,gt=Ge.allowed;if(!!ct.isEnabled()){var st=void 0;if(ie.blockedByActive(C,gt,$e))ct.reset();else{var xe=J||se.type;ct&&ct[xe]&&(st=ct[xe](se,de,X),ie.mergeIHandlerResult(me,Le,st,$e,fe),st&&st.needsRenderFrame&&ie.triggerRenderFrame())}(st||ct.isActive())&&(C[$e]=ct)}}}catch(nt){Ae.e(nt)}finally{Ae.f()}var Mt={};for(var Ut in ie.previousActiveHandlers)C[Ut]||(Mt[Ut]=fe);ie.previousActiveHandlers=C,(Object.keys(Mt).length||re(me))&&(ie.changes.push([me,Le,Mt]),ie.triggerRenderFrame()),(Object.keys(C).length||re(me))&&ie.map.stop(!0),ie.updatingCamera=!1;var At=me.cameraAnimation;At&&(ie.inertia.clear(),ie.fireEvents({},{}),ie.changes=[],At(ie.map))}),this.map=ae,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new U.default(ae),this.bearingSnap=G.bearingSnap,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(G);var le=this.el;this.listeners=[[le,"touchstart",{passive:!1}],[le,"touchmove",{passive:!1}],[le,"touchend",void 0],[le,"touchcancel",void 0],[le,"mousedown",void 0],[le,"mousemove",void 0],[le,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[le,"mouseover",void 0],[le,"mouseout",void 0],[le,"dblclick",void 0],[le,"click",void 0],[le,"keydown",{capture:!1}],[le,"keyup",void 0],[le,"wheel",{passive:!1}],[le,"contextmenu",void 0],[window,"blur",void 0]];var Me=B(this.listeners),ge;try{for(Me.s();!(ge=Me.n()).done;){var pe=(0,F.default)(ge.value,3),Ne=pe[0],Re=pe[1],he=pe[2];d.default.addEventListener(Ne,Re,Ne===window.document?this.handleWindowEvent:this.handleEvent,he)}}catch(se){Me.e(se)}finally{Me.f()}}return(0,w.default)(H,[{key:"destroy",value:function(){var G=B(this.listeners),ie;try{for(G.s();!(ie=G.n()).done;){var le=(0,F.default)(ie.value,3),Me=le[0],ge=le[1],pe=le[2];d.default.removeEventListener(Me,ge,Me===window.document?this.handleWindowEvent:this.handleEvent,pe)}}catch(Ne){G.e(Ne)}finally{G.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var G=B(this.handlers),ie;try{for(G.s();!(ie=G.n()).done;){var le=ie.value.handler;le.reset()}}catch(Me){G.e(Me)}finally{G.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var G=B(this.handlers),ie;try{for(G.s();!(ie=G.n()).done;){var le=ie.value.handler;if(le.isActive())return!0}}catch(Me){G.e(Me)}finally{G.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(oe(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(G,ie,le,Me,ge){if(!!le){(0,P.default)(G,le);var pe={handlerName:Me,originalEvent:le.originalEvent||ge};le.zoomDelta!==void 0&&(ie.zoom=pe),le.panDelta!==void 0&&(ie.drag=pe),le.pitchDelta!==void 0&&(ie.pitch=pe),le.bearingDelta!==void 0&&(ie.rotate=pe)}}},{key:"triggerRenderFrame",value:function(){var G=this;this.frameId===void 0&&(this.frameId=this.map.requestRenderFrame(function(ie){delete G.frameId,G.handleEvent(new j.default("renderFrame",{timeStamp:ie})),G.applyChanges()}))}},{key:"addDefaultHandlers",value:function(G){var ie=this.map,le=ie.getCanvasContainer();this.add("mapEvent",new O.default(ie,G));var Me=ie.boxZoom=new g.default(ie,G);this.add("boxZoom",Me);var ge=new x.default,pe=new k.default;ie.doubleClickZoom=new y.default(pe,ge),this.add("tapZoom",ge),this.add("clickZoom",pe);var Ne=new A.default;this.add("tapDragZoom",Ne);var Re=ie.touchPitch=new z.TouchPitchHandler;this.add("touchPitch",Re);var he=new D.MouseRotateHandler(G),se=new D.MousePitchHandler(G);ie.dragRotate=new h.default(G,he,se),this.add("mouseRotate",he,["mousePitch"]),this.add("mousePitch",se,["mouseRotate"]);var J=new D.MousePanHandler(G),fe=new z.TouchPanHandler(G);ie.dragPan=new v.default(le,J,fe),this.add("mousePan",J),this.add("touchPan",fe,["touchZoom","touchRotate"]);var me=new z.TouchRotateHandler,Le=new z.TouchZoomHandler;ie.touchZoomRotate=new S.default(le,Le,me,Ne),this.add("touchRotate",me,["touchPan","touchZoom"]),this.add("touchZoom",Le,["touchPan","touchRotate"]);var C=ie.scrollZoom=new R.default(ie,this);this.add("scrollZoom",C,["mousePan"]);var X=ie.keyboard=new I.default;this.add("keyboard",X),this.add("blockableMapEvent",new E.default(ie));for(var de=0,Ae=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];de<Ae.length;de++){var De=Ae[de];G.interactive&&G[De]&&ie[De].enable(G[De])}}},{key:"add",value:function(G,ie,le){this.handlers.push({handlerName:G,handler:ie,allowed:le}),this.handlersById[G]=ie}},{key:"blockedByActive",value:function(G,ie,le){for(var Me in G)if(Me!==le&&(!ie||ie.indexOf(Me)<0))return!0;return!1}},{key:"getMapTouches",value:function(G){var ie=[],le=B(G),Me;try{for(le.s();!(Me=le.n()).done;){var ge=Me.value,pe=ge.target;this.el.contains(pe)&&ie.push(ge)}}catch(Ne){le.e(Ne)}finally{le.f()}return ie}},{key:"applyChanges",value:function(){var G={},ie={},le={},Me=B(this.changes),ge;try{for(Me.s();!(ge=Me.n()).done;){var pe=(0,F.default)(ge.value,3),Ne=pe[0],Re=pe[1],he=pe[2];Ne.panDelta&&(G.panDelta=(G.panDelta||new L.default(0,0))._add(Ne.panDelta)),Ne.zoomDelta&&(G.zoomDelta=(G.zoomDelta||0)+Ne.zoomDelta),Ne.bearingDelta&&(G.bearingDelta=(G.bearingDelta||0)+Ne.bearingDelta),Ne.pitchDelta&&(G.pitchDelta=(G.pitchDelta||0)+Ne.pitchDelta),Ne.around!==void 0&&(G.around=Ne.around),Ne.pinchAround!==void 0&&(G.pinchAround=Ne.pinchAround),Ne.noInertia&&(G.noInertia=Ne.noInertia),(0,P.default)(ie,Re),(0,P.default)(le,he)}}catch(se){Me.e(se)}finally{Me.f()}this.updateMapTransform(G,ie,le),this.changes=[]}},{key:"updateMapTransform",value:function(G,ie,le){var Me=this.map,ge=Me.transform;if(!re(G))return this.fireEvents(ie,le);var pe=G.panDelta,Ne=G.zoomDelta,Re=G.bearingDelta,he=G.pitchDelta,se=G.pinchAround,J=G.around;se!==void 0&&(J=se),Me.stop(!0),J=J||Me.transform.centerPoint;var fe=ge.pointLocation(pe?J.sub(pe):J);Re&&(ge.bearing+=Re),he&&(ge.pitch+=he),Ne&&(ge.zoom+=Ne),ge.setLocationAtPoint(fe,J),this.map.update(),G.noInertia||this.inertia.record(G),this.fireEvents(ie,le)}},{key:"fireEvents",value:function(G,ie){var le=this,Me=oe(this.eventsInProgress),ge=oe(G),pe={};for(var Ne in G)if(G[Ne]){var Re=G[Ne].originalEvent;this.eventsInProgress[Ne]||(pe["".concat(Ne,"start")]=Re),this.eventsInProgress[Ne]=G[Ne]}!Me&&ge&&this.fireEvent("movestart",ge.originalEvent);for(var he in pe)pe[he]&&this.fireEvent(he,pe[he]);G.rotate&&(this.bearingChanged=!0),ge&&this.fireEvent("move",ge.originalEvent);for(var se in G)if(G[se]){var J=G[se].originalEvent;this.fireEvent(se,J)}var fe={},me;for(var Le in this.eventsInProgress)if(this.eventsInProgress[Le]){var C=this.eventsInProgress[Le],X=C.handlerName,de=C.originalEvent;this.handlersById[X].isActive()||(delete this.eventsInProgress[Le],me=ie[X]||de,fe["".concat(Le,"end")]=me)}for(var Ae in fe)fe[Ae]&&this.fireEvent(Ae,fe[Ae]);var De=oe(this.eventsInProgress);if((Me||ge)&&!De){this.updatingCamera=!0;var Ge=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),$e=function(gt){return gt!==0&&-le.bearingSnap<gt&&gt<le.bearingSnap};Ge?($e(Ge.bearing||this.map.getBearing())&&(Ge.bearing=0),this.map.easeTo(Ge,{originalEvent:me})):(this.map.emit("moveend",new M.Event("moveend",{originalEvent:me})),$e(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(G,ie){this.map.emit(G,new M.Event(G,ie?{originalEvent:ie}:{}))}}]),H}(),ee=Z;c.default=ee},40623:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.indexTouches=n;function n(i,F){for(var o={},w=0;w<i.length;w++)o[i[w].identifier]=F[w];return o}},60157:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_={panStep:100,bearingStep:15,pitchStep:10},P=function(){function E(){(0,F.default)(this,E),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"panStep",void 0),(0,w.default)(this,"bearingStep",void 0),(0,w.default)(this,"pitchStep",void 0);var g=_;this.panStep=g.panStep,this.bearingStep=g.bearingStep,this.pitchStep=g.pitchStep}return(0,o.default)(E,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(k){var M=this;if(!(k.altKey||k.ctrlKey||k.metaKey)){var j=0,U=0,I=0,O=0,D=0;switch(k.keyCode){case 61:case 107:case 171:case 187:j=1;break;case 189:case 109:case 173:j=-1;break;case 37:k.shiftKey?U=-1:(k.preventDefault(),O=-1);break;case 39:k.shiftKey?U=1:(k.preventDefault(),O=1);break;case 38:k.shiftKey?I=1:(k.preventDefault(),D=-1);break;case 40:k.shiftKey?I=-1:(k.preventDefault(),D=1);break;default:return}return{cameraAnimation:function(y){var v=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:L,zoom:j?Math.round(v)+j*(k.shiftKey?2:1):v,bearing:y.getBearing()+U*M.bearingStep,pitch:y.getPitch()+I*M.pitchStep,offset:[-O*M.panStep,-D*M.panStep],center:y.getCenter()},{originalEvent:k})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),E}();function L(E){return E*(2-E)}var d=P;c.default=d},51750:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(22345),P=function(){function L(d,E){(0,F.default)(this,L),(0,w.default)(this,"mousedownPos",void 0),(0,w.default)(this,"clickTolerance",void 0),(0,w.default)(this,"map",void 0),this.map=d,this.clickTolerance=E.clickTolerance}return(0,o.default)(L,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(E){return this.firePreventable(new _.MapWheelEvent(E.type,this.map,E))}},{key:"mousedown",value:function(E,g){return this.mousedownPos=g,this.firePreventable(new _.MapMouseEvent(E.type,this.map,E))}},{key:"mouseup",value:function(E){this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E))}},{key:"click",value:function(E,g){this.mousedownPos&&this.mousedownPos.dist(g)>=this.clickTolerance||this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E))}},{key:"dblclick",value:function(E){return this.firePreventable(new _.MapMouseEvent(E.type,this.map,E))}},{key:"mouseover",value:function(E){this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E))}},{key:"mouseout",value:function(E){this.map.emit(E.type,new _.MapMouseEvent(E.type,this.map,E))}},{key:"touchstart",value:function(E){return this.firePreventable(new _.MapTouchEvent(E.type,this.map,E))}},{key:"touchmove",value:function(E){this.map.emit(E.type,new _.MapTouchEvent(E.type,this.map,E))}},{key:"touchend",value:function(E){this.map.emit(E.type,new _.MapTouchEvent(E.type,this.map,E))}},{key:"touchcancel",value:function(E){this.map.emit(E.type,new _.MapTouchEvent(E.type,this.map,E))}},{key:"firePreventable",value:function(E){if(this.map.emit(E.type,E),E.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),L}();c.default=P},20289:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"MousePanHandler",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(c,"MouseRotateHandler",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"MousePitchHandler",{enumerable:!0,get:function(){return w.default}});var F=i(n(13968)),o=i(n(24375)),w=i(n(46011))},30661:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(8376)),P=n(12620),L=function(){function d(E){(0,F.default)(this,d),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"lastPoint",void 0),(0,w.default)(this,"eventButton",void 0),(0,w.default)(this,"moved",void 0),(0,w.default)(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=E.clickTolerance||1}return(0,o.default)(d,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(g,k){if(!this.lastPoint){var M=_.default.mouseButton(g);!this.correctButton(g,M)||(this.lastPoint=k,this.eventButton=M)}}},{key:"mousemoveWindow",value:function(g,k){var M=this.lastPoint;if(!!M){if(g.preventDefault(),(0,P.buttonStillPressed)(g,this.eventButton)){this.reset();return}if(!(!this.moved&&k.dist(M)<this.clickTolerance))return this.moved=!0,this.lastPoint=k,this.move(M,k)}}},{key:"mouseupWindow",value:function(g){if(!!this.lastPoint){var k=_.default.mouseButton(g);k===this.eventButton&&(this.moved&&_.default.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(g,k){return!1}},{key:"move",value:function(g,k){}}]),d}();c.default=L},13968:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(16525)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(30661)),E=n(12620);function g(j){var U=k();return function(){var O=(0,L.default)(j),D;if(U){var R=(0,L.default)(this).constructor;D=Reflect.construct(O,arguments,R)}else D=O.apply(this,arguments);return(0,P.default)(this,D)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var M=function(j){(0,_.default)(I,j);var U=g(I);function I(){return(0,F.default)(this,I),U.apply(this,arguments)}return(0,o.default)(I,[{key:"mousedown",value:function(D,R){(0,w.default)((0,L.default)(I.prototype),"mousedown",this).call(this,D,R),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(D,R){return{around:R,panDelta:R.sub(D)}}},{key:"correctButton",value:function(D,R){return R===E.LEFT_BUTTON&&!D.ctrlKey}}]),I}(d.default);c.default=M},24375:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(30661)),d=n(12620);function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){return(0,F.default)(this,U),j.apply(this,arguments)}return(0,o.default)(U,[{key:"correctButton",value:function(O,D){return D===d.LEFT_BUTTON&&O.ctrlKey||D===d.RIGHT_BUTTON}},{key:"move",value:function(O,D){var R=-.5,y=(D.y-O.y)*R;if(y)return this.active=!0,{pitchDelta:y}}},{key:"contextmenu",value:function(O){O.preventDefault()}}]),U}(L.default);c.default=k},46011:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(30661)),d=n(12620);function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){return(0,F.default)(this,U),j.apply(this,arguments)}return(0,o.default)(U,[{key:"contextmenu",value:function(O){O.preventDefault()}},{key:"correctButton",value:function(O,D){return D===d.LEFT_BUTTON&&O.ctrlKey||D===d.RIGHT_BUTTON}},{key:"move",value:function(O,D){var R=.8,y=(D.x-O.x)*R;if(y)return this.active=!0,{bearingDelta:y}}}]),U}(L.default);c.default=k},12620:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.buttonStillPressed=L,c.BUTTONS_FLAGS=c.RIGHT_BUTTON=c.LEFT_BUTTON=void 0;var F=i(n(59713)),o,w=0;c.LEFT_BUTTON=w;var _=2;c.RIGHT_BUTTON=_;var P=(o={},(0,F.default)(o,w,1),(0,F.default)(o,_,2),o);c.BUTTONS_FLAGS=P;function L(d,E){var g=P[E];return d.buttons===void 0||(d.buttons&g)!==g}},92936:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(5077)),P=n(6253),L=i(n(8376)),d=4.000244140625,E=1/100,g=1/450,k=2,M=function(){function U(I,O){var D=this;(0,F.default)(this,U),(0,w.default)(this,"map",void 0),(0,w.default)(this,"el",void 0),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"zooming",void 0),(0,w.default)(this,"aroundCenter",void 0),(0,w.default)(this,"around",void 0),(0,w.default)(this,"aroundPoint",void 0),(0,w.default)(this,"type",void 0),(0,w.default)(this,"lastValue",void 0),(0,w.default)(this,"timeout",void 0),(0,w.default)(this,"finishTimeout",void 0),(0,w.default)(this,"lastWheelEvent",void 0),(0,w.default)(this,"lastWheelEventTime",void 0),(0,w.default)(this,"startZoom",void 0),(0,w.default)(this,"targetZoom",void 0),(0,w.default)(this,"delta",void 0),(0,w.default)(this,"easing",void 0),(0,w.default)(this,"prevEase",void 0),(0,w.default)(this,"frameId",void 0),(0,w.default)(this,"handler",void 0),(0,w.default)(this,"defaultZoomRate",void 0),(0,w.default)(this,"wheelZoomRate",void 0),(0,w.default)(this,"onScrollFrame",function(){if(!!D.frameId&&(D.frameId=null,!!D.isActive())){var R=D.map.transform;if(D.delta!==0){var y=D.type==="wheel"&&Math.abs(D.delta)>d?D.wheelZoomRate:D.defaultZoomRate,v=k/(1+Math.exp(-Math.abs(D.delta*y)));D.delta<0&&v!==0&&(v=1/v);var h=typeof D.targetZoom=="number"?R.zoomScale(D.targetZoom):R.scale;D.targetZoom=Math.min(R.maxZoom,Math.max(R.minZoom,R.scaleZoom(h*v))),D.type==="wheel"&&(D.startZoom=R.zoom,D.easing=D.smoothOutEasing(200)),D.delta=0}var S=typeof D.targetZoom=="number"?D.targetZoom:R.zoom,A=D.startZoom,x=D.easing,z=!1,B;if(D.type==="wheel"&&A&&x){var V=Math.min(((0,P.now)()-D.lastWheelEventTime)/200,1),Q=x(V);B=(0,P.interpolate)(A,S,Q),V<1?D.frameId||(D.frameId=!0):z=!0}else B=S,z=!0;return D.active=!0,z&&(D.active=!1,D.finishTimeout=setTimeout(function(){D.zooming=!1,D.handler.triggerRenderFrame(),delete D.targetZoom,delete D.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:B-R.zoom,around:D.aroundPoint,originalEvent:D.lastWheelEvent}}}),this.map=I,this.el=I.getCanvasContainer(),this.handler=O,this.delta=0,this.defaultZoomRate=E,this.wheelZoomRate=g}return(0,o.default)(U,[{key:"setZoomRate",value:function(O){this.defaultZoomRate=O}},{key:"setWheelZoomRate",value:function(O){this.wheelZoomRate=O}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||this.finishTimeout!==void 0}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(O){this.isEnabled()||(this.enabled=!0,this.aroundCenter=O&&O.around==="center")}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"wheel",value:function(O){if(!!this.isEnabled()){var D=O.deltaMode===window.WheelEvent.DOM_DELTA_LINE?O.deltaY*40:O.deltaY,R=(0,P.now)(),y=R-(this.lastWheelEventTime||0);this.lastWheelEventTime=R,D!==0&&D%d==0?this.type="wheel":D!==0&&Math.abs(D)<4?this.type="trackpad":y>400?(this.type=null,this.lastValue=D,this.timeout=setTimeout(this.onTimeout,40,O)):this.type||(this.type=Math.abs(y*D)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,D+=this.lastValue)),O.shiftKey&&D&&(D=D/4),this.type&&(this.lastWheelEvent=O,this.delta-=D,this.active||this.start(O)),O.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(O){this.type="wheel",this.delta-=this.lastValue,this.active||this.start(O)}},{key:"start",value:function(O){if(!!this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var D=L.default.mousePos(this.el,O);this.around=_.default.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(D)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(O){var D=P.ease;if(this.prevEase){var R=this.prevEase,y=((0,P.now)()-R.start)/R.duration,v=R.easing(y+.01)-R.easing(y),h=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.27*.27-h*h);D=(0,P.bezier)(h,S,.25,1)}return this.prevEase={start:(0,P.now)(),duration:O,easing:D},D}}]),U}(),j=M;c.default=j},42517:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d){(0,F.default)(this,P),(0,w.default)(this,"clickZoom",void 0),(0,w.default)(this,"tapZoom",void 0),this.clickZoom=L,this.tapZoom=d}return(0,o.default)(P,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),P}();c.default=_},53320:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d,E){(0,F.default)(this,P),(0,w.default)(this,"inertiaOptions",void 0),(0,w.default)(this,"el",void 0),(0,w.default)(this,"mousePan",void 0),(0,w.default)(this,"touchPan",void 0),this.el=L,this.mousePan=d,this.touchPan=E}return(0,o.default)(P,[{key:"enable",value:function(d){this.inertiaOptions=d||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),P}();c.default=_},72707:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d,E){(0,F.default)(this,P),(0,w.default)(this,"mouseRotate",void 0),(0,w.default)(this,"mousePitch",void 0),(0,w.default)(this,"pitchWithRotate",void 0),this.pitchWithRotate=L.pitchWithRotate,this.mouseRotate=d,this.mousePitch=E}return(0,o.default)(P,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),P}();c.default=_},9809:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d,E,g){(0,F.default)(this,P),(0,w.default)(this,"el",void 0),(0,w.default)(this,"touchZoom",void 0),(0,w.default)(this,"touchRotate",void 0),(0,w.default)(this,"tapDragZoom",void 0),(0,w.default)(this,"rotationDisabled",void 0),(0,w.default)(this,"enabled",void 0),this.el=L,this.touchZoom=d,this.touchRotate=E,this.tapDragZoom=g,this.rotationDisabled=!1,this.enabled=!0}return(0,o.default)(P,[{key:"enable",value:function(d){this.touchZoom.enable(d),this.rotationDisabled||this.touchRotate.enable(d),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),P}();c.default=_},74802:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=c.MAX_DIST=c.MAX_TOUCH_TIME=c.MAX_TAP_INTERVAL=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(72057)),P=n(40623);function L(I,O){var D=typeof Symbol!="undefined"&&I[Symbol.iterator]||I["@@iterator"];if(!D){if(Array.isArray(I)||(D=d(I))||O&&I&&typeof I.length=="number"){D&&(I=D);var R=0,y=function(){};return{s:y,n:function(){return R>=I.length?{done:!0}:{done:!1,value:I[R++]}},e:function(x){throw x},f:y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,h=!1,S;return{s:function(){D=D.call(I)},n:function(){var x=D.next();return v=x.done,x},e:function(x){h=!0,S=x},f:function(){try{!v&&D.return!=null&&D.return()}finally{if(h)throw S}}}}function d(I,O){if(!!I){if(typeof I=="string")return E(I,O);var D=Object.prototype.toString.call(I).slice(8,-1);if(D==="Object"&&I.constructor&&(D=I.constructor.name),D==="Map"||D==="Set")return Array.from(I);if(D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D))return E(I,O)}}function E(I,O){(O==null||O>I.length)&&(O=I.length);for(var D=0,R=new Array(O);D<O;D++)R[D]=I[D];return R}function g(I){var O=new _.default(0,0),D=L(I),R;try{for(D.s();!(R=D.n()).done;){var y=R.value;O._add(y)}}catch(v){D.e(v)}finally{D.f()}return O.div(I.length)}var k=500;c.MAX_TAP_INTERVAL=k;var M=500;c.MAX_TOUCH_TIME=M;var j=30;c.MAX_DIST=j;var U=function(){function I(O){(0,F.default)(this,I),(0,w.default)(this,"numTouches",void 0),(0,w.default)(this,"centroid",void 0),(0,w.default)(this,"startTime",void 0),(0,w.default)(this,"aborted",void 0),(0,w.default)(this,"touches",void 0),this.reset(),this.numTouches=O.numTouches}return(0,o.default)(I,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(D,R,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=D.timeStamp),y.length===this.numTouches&&(this.centroid=g(R),this.touches=(0,P.indexTouches)(y,R)))}},{key:"touchmove",value:function(D,R,y){if(!(this.aborted||!this.centroid)){var v=(0,P.indexTouches)(y,R);for(var h in this.touches)if(this.touches[h]){var S=this.touches[h],A=v[h];(!A||A.dist(S)>j)&&(this.aborted=!0)}}}},{key:"touchend",value:function(D,R,y){if((!this.centroid||D.timeStamp-this.startTime>M)&&(this.aborted=!0),y.length===0){var v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}]),I}();c.default=U},7714:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(74802),P=i(n(95736)),L=function(){function d(){(0,F.default)(this,d),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"swipePoint",void 0),(0,w.default)(this,"swipeTouch",void 0),(0,w.default)(this,"tapTime",void 0),(0,w.default)(this,"tap",void 0),this.tap=new P.default({numTouches:1,numTaps:1}),this.reset()}return(0,o.default)(d,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(g,k,M){this.swipePoint||(this.tapTime&&g.timeStamp-this.tapTime>_.MAX_TAP_INTERVAL&&this.reset(),this.tapTime?M.length>0&&(this.swipePoint=k[0],this.swipeTouch=M[0].identifier):this.tap.touchstart(g,k,M))}},{key:"touchmove",value:function(g,k,M){if(!this.tapTime)this.tap.touchmove(g,k,M);else if(this.swipePoint){if(M[0].identifier!==this.swipeTouch)return;var j=k[0],U=j.y-this.swipePoint.y;return this.swipePoint=j,g.preventDefault(),this.active=!0,{zoomDelta:U/128}}}},{key:"touchend",value:function(g,k,M){if(this.tapTime)this.swipePoint&&M.length===0&&this.reset();else{var j=this.tap.touchend(g,k,M);j&&(this.tapTime=g.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),d}();c.default=L},95736:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var o=F(n(34575)),w=F(n(93913)),_=F(n(59713)),P=i(n(74802)),L=function(){function d(E){(0,o.default)(this,d),(0,_.default)(this,"singleTap",void 0),(0,_.default)(this,"numTaps",void 0),(0,_.default)(this,"lastTime",void 0),(0,_.default)(this,"lastTap",void 0),(0,_.default)(this,"count",void 0),this.singleTap=new P.default(E),this.numTaps=E.numTaps,this.reset()}return(0,w.default)(d,[{key:"reset",value:function(){this.lastTime=Infinity,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(g,k,M){this.singleTap.touchstart(g,k,M)}},{key:"touchmove",value:function(g,k,M){this.singleTap.touchmove(g,k,M)}},{key:"touchend",value:function(g,k,M){var j=this.singleTap.touchend(g,k,M);if(j){var U=g.timeStamp-this.lastTime<P.MAX_TAP_INTERVAL,I=!this.lastTap||this.lastTap.dist(j)<P.MAX_DIST;if((!U||!I)&&this.reset(),this.count++,this.lastTime=g.timeStamp,this.lastTap=j,this.count===this.numTaps)return this.reset(),j}}}]),d}();c.default=L},47982:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(95736)),P=function(){function L(){(0,F.default)(this,L),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"zoomIn",void 0),(0,w.default)(this,"zoomOut",void 0),this.zoomIn=new _.default({numTouches:1,numTaps:2}),this.zoomOut=new _.default({numTouches:2,numTaps:1}),this.reset()}return(0,o.default)(L,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(E,g,k){this.zoomIn.touchstart(E,g,k),this.zoomOut.touchstart(E,g,k)}},{key:"touchmove",value:function(E,g,k){this.zoomIn.touchmove(E,g,k),this.zoomOut.touchmove(E,g,k)}},{key:"touchend",value:function(E,g,k){var M=this,j=this.zoomIn.touchend(E,g,k),U=this.zoomOut.touchend(E,g,k);if(j)return this.active=!0,E.preventDefault(),setTimeout(function(){return M.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(j)},{originalEvent:E})}};if(U)return this.active=!0,E.preventDefault(),setTimeout(function(){return M.reset()},0),{cameraAnimation:function(O){return O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(U)},{originalEvent:E})}}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),L}();c.default=P},27357:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"TouchPanHandler",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(c,"TouchPitchHandler",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"TouchRotateHandler",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(c,"TouchZoomHandler",{enumerable:!0,get:function(){return _.default}});var F=i(n(69761)),o=i(n(80653)),w=i(n(38988)),_=i(n(40704))},69761:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(72057)),P=n(40623),L=function(){function d(E){(0,F.default)(this,d),(0,w.default)(this,"enabled",void 0),(0,w.default)(this,"active",void 0),(0,w.default)(this,"touches",void 0),(0,w.default)(this,"minTouches",void 0),(0,w.default)(this,"clickTolerance",void 0),(0,w.default)(this,"sum",void 0),this.minTouches=1,this.clickTolerance=E.clickTolerance||1,this.reset()}return(0,o.default)(d,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new _.default(0,0)}},{key:"touchstart",value:function(g,k,M){return this.calculateTransform(g,k,M)}},{key:"touchmove",value:function(g,k,M){if(!!this.active)return g.preventDefault(),this.calculateTransform(g,k,M)}},{key:"touchend",value:function(g,k,M){this.calculateTransform(g,k,M),this.active&&M.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(g,k,M){M.length>0&&(this.active=!0);var j=(0,P.indexTouches)(M,k),U=new _.default(0,0),I=new _.default(0,0),O=0;for(var D in j)if(j[D]){var R=j[D],y=this.touches[D];y&&(U._add(R),I._add(R.sub(y)),O++,j[D]=R)}if(this.touches=j,!(O<this.minTouches||!I.mag())){var v=I.div(O);if(this.sum._add(v),!(this.sum.mag()<this.clickTolerance)){var h=U.div(O);return{around:h,panDelta:v}}}}}]),d}();c.default=L},80653:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(16525)),P=i(n(2205)),L=i(n(78585)),d=i(n(29754)),E=i(n(59713)),g=i(n(19559));function k(O){var D=M();return function(){var y=(0,d.default)(O),v;if(D){var h=(0,d.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,L.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}function j(O){return Math.abs(O.y)>Math.abs(O.x)}var U=100,I=function(O){(0,P.default)(R,O);var D=k(R);function R(){var y;(0,F.default)(this,R);for(var v=arguments.length,h=new Array(v),S=0;S<v;S++)h[S]=arguments[S];return y=D.call.apply(D,[this].concat(h)),(0,E.default)((0,w.default)(y),"valid",void 0),(0,E.default)((0,w.default)(y),"firstMove",void 0),(0,E.default)((0,w.default)(y),"lastPoints",void 0),y}return(0,o.default)(R,[{key:"reset",value:function(){(0,_.default)((0,d.default)(R.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(v){this.lastPoints=v,j(v[0].sub(v[1]))&&(this.valid=!1)}},{key:"move",value:function(v,h,S){var A=v[0].sub(this.lastPoints[0]),x=v[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(A,x,S.timeStamp),!!this.valid){this.lastPoints=v,this.active=!0;var z=(A.y+x.y)/2,B=-.5;return{pitchDelta:z*B}}}},{key:"gestureBeginsVertically",value:function(v,h,S){if(this.valid!==void 0)return this.valid;var A=2,x=v.mag()>=A,z=h.mag()>=A;if(!(!x&&!z)){if(!x||!z)return this.firstMove===void 0&&(this.firstMove=S),S-this.firstMove<U?void 0:!1;var B=v.y>0==h.y>0;return j(v)&&j(h)&&B}}}]),R}(g.default);c.default=I},38988:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(16525)),P=i(n(2205)),L=i(n(78585)),d=i(n(29754)),E=i(n(59713)),g=i(n(19559));function k(O){var D=M();return function(){var y=(0,d.default)(O),v;if(D){var h=(0,d.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,L.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=25;function U(O,D){return O.angleWith(D)*180/Math.PI}var I=function(O){(0,P.default)(R,O);var D=k(R);function R(){var y;(0,F.default)(this,R);for(var v=arguments.length,h=new Array(v),S=0;S<v;S++)h[S]=arguments[S];return y=D.call.apply(D,[this].concat(h)),(0,E.default)((0,w.default)(y),"minDiameter",void 0),y}return(0,o.default)(R,[{key:"reset",value:function(){(0,_.default)((0,d.default)(R.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(v){this.startVector=this.vector=v[0].sub(v[1]),this.minDiameter=v[0].dist(v[1])}},{key:"move",value:function(v,h){var S=this.vector;if(this.vector=v[0].sub(v[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:U(this.vector,S),pinchAround:h}}},{key:"isBelowThreshold",value:function(v){this.minDiameter=Math.min(this.minDiameter,v.mag());var h=Math.PI*this.minDiameter,S=j/h*360,A=U(v,this.startVector);return Math.abs(A)<S}}]),R}(g.default);c.default=I},40704:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(16525)),P=i(n(2205)),L=i(n(78585)),d=i(n(29754)),E=i(n(59713)),g=i(n(19559));function k(O){var D=M();return function(){var y=(0,d.default)(O),v;if(D){var h=(0,d.default)(this).constructor;v=Reflect.construct(y,arguments,h)}else v=y.apply(this,arguments);return(0,L.default)(this,v)}}function M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(O){return!1}}var j=.1;function U(O,D){return Math.log(O/D)/Math.LN2}var I=function(O){(0,P.default)(R,O);var D=k(R);function R(){var y;(0,F.default)(this,R);for(var v=arguments.length,h=new Array(v),S=0;S<v;S++)h[S]=arguments[S];return y=D.call.apply(D,[this].concat(h)),(0,E.default)((0,w.default)(y),"distance",void 0),(0,E.default)((0,w.default)(y),"startDistance",void 0),y}return(0,o.default)(R,[{key:"reset",value:function(){(0,_.default)((0,d.default)(R.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(v){this.startDistance=this.distance=v[0].dist(v[1])}},{key:"move",value:function(v,h){var S=this.distance;if(this.distance=v[0].dist(v[1]),!(!this.active&&Math.abs(U(this.distance,this.startDistance))<j))return this.active=!0,{zoomDelta:U(this.distance,S),pinchAround:h}}}]),R}(g.default);c.default=I},19559:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(8376)),L=function(){function E(){(0,o.default)(this,E),(0,_.default)(this,"enabled",void 0),(0,_.default)(this,"active",void 0),(0,_.default)(this,"firstTwoTouches",void 0),(0,_.default)(this,"vector",void 0),(0,_.default)(this,"startVector",void 0),(0,_.default)(this,"aroundCenter",void 0),this.reset()}return(0,w.default)(E,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(k){}},{key:"move",value:function(k,M,j){}},{key:"touchstart",value:function(k,M,j){this.firstTwoTouches||j.length<2||(this.firstTwoTouches=[j[0].identifier,j[1].identifier],this.start([M[0],M[1]]))}},{key:"touchmove",value:function(k,M,j){if(!!this.firstTwoTouches){k.preventDefault();var U=(0,F.default)(this.firstTwoTouches,2),I=U[0],O=U[1],D=d(j,M,I),R=d(j,M,O);if(!(!D||!R)){var y=this.aroundCenter?null:D.add(R).div(2);return this.move([D,R],y,k)}}}},{key:"touchend",value:function(k,M,j){if(!!this.firstTwoTouches){var U=(0,F.default)(this.firstTwoTouches,2),I=U[0],O=U[1],D=d(j,M,I),R=d(j,M,O);D&&R||(this.active&&P.default.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(k){this.enabled=!0,this.aroundCenter=!!k&&k.around==="center"}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),E}();c.default=L;function d(E,g,k){for(var M=0;M<E.length;M++)if(E[M].identifier===k)return g[M]}},52576:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(23493)),P=function(){function d(E){var g=this;(0,F.default)(this,d),(0,w.default)(this,"map",void 0),(0,w.default)(this,"updateHash",void 0),(0,w.default)(this,"hashName",void 0),(0,w.default)(this,"onHashChange",function(){var k=g.getCurrentHash();if(k.length>=3&&!k.some(function(j){return isNaN(+j)})){var M=g.map.dragRotate.isEnabled()&&g.map.touchZoomRotate.isEnabled()?+(k[3]||0):g.map.getBearing();return g.map.jumpTo({center:[+k[2],+k[1]],zoom:+k[0],bearing:M,pitch:+(k[4]||0)}),!0}return!1}),(0,w.default)(this,"getCurrentHash",function(){var k=window.location.hash.replace("#","");if(g.hashName){var M;return k.split("&").map(function(j){return j.split("=")}).forEach(function(j){j[0]===g.hashName&&(M=j)}),(M&&M[1]||"").split("/")}return k.split("/")}),(0,w.default)(this,"updateHashUnthrottled",function(){var k=g.getHashString();try{window.history.replaceState(window.history.state,"",k)}catch(M){}}),this.hashName=E&&encodeURIComponent(E),this.updateHash=(0,_.default)(this.updateHashUnthrottled,30*1e3/100)}return(0,o.default)(d,[{key:"addTo",value:function(g){return this.map=g,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(g){var k=this.map.getCenter(),M=Math.round(this.map.getZoom()*100)/100,j=Math.ceil((M*Math.LN2+Math.log(512/360/.5))/Math.LN10),U=Math.pow(10,j),I=Math.round(k.lng*U)/U,O=Math.round(k.lat*U)/U,D=this.map.getBearing(),R=this.map.getPitch(),y="";if(g?y+="/".concat(I,"/").concat(O,"/").concat(M):y+="".concat(M,"/").concat(O,"/").concat(I),(D||R)&&(y+="/".concat(Math.round(D*10)/10)),R&&(y+="/".concat(Math.round(R))),this.hashName){var v=this.hashName,h=!1,S=window.location.hash.slice(1).split("&").map(function(A){var x=A.split("=")[0];return x===v?(h=!0,"".concat(x,"=").concat(y)):A}).filter(function(A){return A});return h||S.push("".concat(v,"=").concat(y)),"#".concat(S.join("&"))}return"#".concat(y)}}]),d}(),L=P;c.default=L},33899:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var i=n(20373);Object.keys(i).forEach(function(F){F==="default"||F==="__esModule"||F in c&&c[F]===i[F]||Object.defineProperty(c,F,{enumerable:!0,get:function(){return i[F]}})})},20373:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.Map=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(82492)),g=n(82887),k=i(n(78059)),M=i(n(5077)),j=i(n(44033)),U=i(n(72057)),I=i(n(32320)),O=i(n(52576)),D=n(6253),R=n(80790),y=i(n(46314));function v(oe){var re=h();return function(){var ee=(0,L.default)(oe),H;if(re){var ae=(0,L.default)(this).constructor;H=Reflect.construct(ee,arguments,ae)}else H=ee.apply(this,arguments);return(0,P.default)(this,H)}}function h(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(oe){return!1}}function S(oe,re){if(re||(re=document),!!re){var Z=re.head||re.getElementsByTagName("head")[0];if(!Z){Z=re.createElement("head");var ee=re.body||re.getElementsByTagName("body")[0];ee?ee.parentNode.insertBefore(Z,ee):re.documentElement.appendChild(Z)}var H=re.createElement("style");return H.type="text/css",H.styleSheet?H.styleSheet.cssText=oe:H.appendChild(re.createTextNode(oe)),Z.appendChild(H),H}}S(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var A=-2,x=22,z=0,B=60,V={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:A,maxZoom:x,minPitch:z,maxPitch:B,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},Q=function(oe){(0,_.default)(Z,oe);var re=v(Z);function Z(ee){var H;(0,F.default)(this,Z),H=re.call(this,(0,E.default)({},V,ee)),(0,d.default)((0,w.default)(H),"doubleClickZoom",void 0),(0,d.default)((0,w.default)(H),"dragRotate",void 0),(0,d.default)((0,w.default)(H),"dragPan",void 0),(0,d.default)((0,w.default)(H),"touchZoomRotate",void 0),(0,d.default)((0,w.default)(H),"scrollZoom",void 0),(0,d.default)((0,w.default)(H),"keyboard",void 0),(0,d.default)((0,w.default)(H),"touchPitch",void 0),(0,d.default)((0,w.default)(H),"boxZoom",void 0),(0,d.default)((0,w.default)(H),"handlers",void 0),(0,d.default)((0,w.default)(H),"container",void 0),(0,d.default)((0,w.default)(H),"canvas",void 0),(0,d.default)((0,w.default)(H),"canvasContainer",void 0),(0,d.default)((0,w.default)(H),"renderTaskQueue",new y.default),(0,d.default)((0,w.default)(H),"frame",void 0),(0,d.default)((0,w.default)(H),"trackResize",!0),(0,d.default)((0,w.default)(H),"hash",void 0),(0,d.default)((0,w.default)(H),"onWindowOnline",function(){H.update()}),(0,d.default)((0,w.default)(H),"onWindowResize",function(G){H.trackResize&&H.resize({originalEvent:G}).update()}),H.initContainer(),H.resize(),H.handlers=new I.default((0,w.default)(H),H.options),typeof window!="undefined"&&(window.addEventListener("online",H.onWindowOnline,!1),window.addEventListener("resize",H.onWindowResize,!1),window.addEventListener("orientationchange",H.onWindowResize,!1));var ae=typeof ee.hash=="string"&&ee.hash||void 0;return ee.hash&&(H.hash=new O.default(ae).addTo((0,w.default)(H))),(!H.hash||!H.hash.onHashChange())&&(H.jumpTo({center:ee.center,zoom:ee.zoom,bearing:ee.bearing,pitch:ee.pitch}),ee.bounds&&(H.resize(),H.fitBounds(ee.bounds,(0,E.default)({},ee.fitBoundsOptions,{duration:0})))),H}return(0,o.default)(Z,[{key:"resize",value:function(H){var ae=this.containerDimensions(),G=ae[0],ie=ae[1];this.transform.resize(G,ie);var le=!this.moving;return le&&(this.stop(),this.emit("movestart",new Event("movestart",H)),this.emit("move",new Event("move",H))),this.emit("resize",new Event("resize",H)),le&&this.emit("moveend",new Event("moveend",H)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(H){return this.transform.locationPoint(M.default.convert(H))}},{key:"unproject",value:function(H){return this.transform.pointLocation(U.default.convert(H))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(H){this.transform.setMaxBounds(j.default.convert(H))}},{key:"setStyle",value:function(H){}},{key:"setMinZoom",value:function(H){if(H=H==null?A:H,H>=A&&H<=this.transform.maxZoom)return this.transform.minZoom=H,this.getZoom()<H&&this.setZoom(H),this;throw new Error("minZoom must be between ".concat(A," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(H){if(H=H==null?x:H,H>=this.transform.minZoom)return this.transform.maxZoom=H,this.getZoom()>H&&this.setZoom(H),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(H){if(H=H==null?z:H,H<z)throw new Error("minPitch must be greater than or equal to ".concat(z));if(H>=z&&H<=this.transform.maxPitch)return this.transform.minPitch=H,this.getPitch()<H&&this.setPitch(H),this;throw new Error("minPitch must be between ".concat(z," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(H){if(H=H==null?B:H,H>B)throw new Error("maxPitch must be less than or equal to ".concat(B));if(H>=this.transform.minPitch)return this.transform.maxPitch=H,this.getPitch()>H&&this.setPitch(H),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(H){this.transform.renderWorldCopies=!!H}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(H){return this.update(),this.renderTaskQueue.add(H)}},{key:"cancelRenderFrame",value:function(H){return this.renderTaskQueue.remove(H)}},{key:"triggerRepaint",value:function(){var H=this;this.frame||(this.frame=(0,D.renderframe)(function(ae){R.PerformanceUtils.frame(ae),H.frame=null,H.update(ae)}))}},{key:"update",value:function(H){var ae=this;this.frame||(this.frame=(0,D.renderframe)(function(G){R.PerformanceUtils.frame(G),ae.frame=null,ae.renderTaskQueue.run(H)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var H=this.container;H.classList.add("l7-map");var ae=this.canvasContainer=g.DOM.create("div","l7-canvas-container",H);this.options.interactive&&ae.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var H=0,ae=0;return this.container&&(H=this.container.clientWidth||400,ae=this.container.clientHeight||300),[H,ae]}},{key:"resizeCanvas",value:function(H,ae){var G=g.DOM.DPR||1;this.canvas.width=G*H,this.canvas.height=G*ae,this.canvas.style.width="".concat(H,"px"),this.canvas.style.height="".concat(ae,"px")}}]),Z}(k.default);c.Map=Q},6253:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.wrap=L,c.clamp=d,c.interpolate=E,c.bezier=g,c.prefersReducedMotion=M,c.pick=j,c.renderframe=D,c.cancel=c.raf=c.now=c.ease=void 0;var F=i(n(99874));function o(R,y){var v=typeof Symbol!="undefined"&&R[Symbol.iterator]||R["@@iterator"];if(!v){if(Array.isArray(R)||(v=w(R))||y&&R&&typeof R.length=="number"){v&&(R=v);var h=0,S=function(){};return{s:S,n:function(){return h>=R.length?{done:!0}:{done:!1,value:R[h++]}},e:function(V){throw V},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var A=!0,x=!1,z;return{s:function(){v=v.call(R)},n:function(){var V=v.next();return A=V.done,V},e:function(V){x=!0,z=V},f:function(){try{!A&&v.return!=null&&v.return()}finally{if(x)throw z}}}}function w(R,y){if(!!R){if(typeof R=="string")return _(R,y);var v=Object.prototype.toString.call(R).slice(8,-1);if(v==="Object"&&R.constructor&&(v=R.constructor.name),v==="Map"||v==="Set")return Array.from(R);if(v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v))return _(R,y)}}function _(R,y){(y==null||y>R.length)&&(y=R.length);for(var v=0,h=new Array(y);v<y;v++)h[v]=R[v];return h}var P;function L(R,y,v){var h=v-y,S=((R-y)%h+h)%h+y;return S===y?v:S}function d(R,y,v){return Math.min(v,Math.max(y,R))}function E(R,y,v){return R*(1-v)+y*v}function g(R,y,v,h){var S=new F.default(R,y,v,h);return function(A){return S.solve(A)}}var k=g(.25,.1,.25,1);c.ease=k;function M(){return window.matchMedia?(P==null&&(P=window.matchMedia("(prefers-reduced-motion: reduce)")),P.matches):!1}function j(R,y){var v={},h=o(y),S;try{for(h.s();!(S=h.n()).done;){var A=S.value;A in R&&(v[A]=R[A])}}catch(x){h.e(x)}finally{h.f()}return v}var U=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);c.now=U;var I=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;c.raf=I;var O=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;c.cancel=O;function D(R){var y=I(R);return{cancel:function(){return O(y)}}}},8376:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(72057));function o(O,D){var R=typeof Symbol!="undefined"&&O[Symbol.iterator]||O["@@iterator"];if(!R){if(Array.isArray(O)||(R=w(O))||D&&O&&typeof O.length=="number"){R&&(O=R);var y=0,v=function(){};return{s:v,n:function(){return y>=O.length?{done:!0}:{done:!1,value:O[y++]}},e:function(z){throw z},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,S=!1,A;return{s:function(){R=R.call(O)},n:function(){var z=R.next();return h=z.done,z},e:function(z){S=!0,A=z},f:function(){try{!h&&R.return!=null&&R.return()}finally{if(S)throw A}}}}function w(O,D){if(!!O){if(typeof O=="string")return _(O,D);var R=Object.prototype.toString.call(O).slice(8,-1);if(R==="Object"&&O.constructor&&(R=O.constructor.name),R==="Map"||R==="Set")return Array.from(O);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return _(O,D)}}function _(O,D){(D==null||D>O.length)&&(D=O.length);for(var R=0,y=new Array(D);R<D;R++)y[R]=O[R];return y}var P={},L=P;c.default=L,P.create=function(O,D,R){var y=window.document.createElement(O);return D!==void 0&&(y.className=D),R&&R.appendChild(y),y},P.createNS=function(O,D){var R=window.document.createElementNS(O,D);return R};var d=window.document&&window.document.documentElement.style;function E(O){if(!d)return O[0];var D=o(O),R;try{for(D.s();!(R=D.n()).done;){var y=R.value;if(y in d)return y}}catch(v){D.e(v)}finally{D.f()}return O[0]}var g=E(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k;P.disableDrag=function(){d&&g&&(k=d[g],d[g]="none")},P.enableDrag=function(){d&&g&&(d[g]=k)};var M=E(["transform","WebkitTransform"]);P.setTransform=function(O,D){O.style[M]=D};var j=!1;try{var U=Object.defineProperty({},"passive",{get:function(){j=!0}});window.addEventListener("test",U,U),window.removeEventListener("test",U,U)}catch(O){j=!1}P.addEventListener=function(O,D,R){var y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in y&&j?O.addEventListener(D,R,y):O.addEventListener(D,R,y.capture)},P.removeEventListener=function(O,D,R){var y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in y&&j?O.removeEventListener(D,R,y):O.removeEventListener(D,R,y.capture)};var I=function O(D){D.preventDefault(),D.stopPropagation(),window.removeEventListener("click",O,!0)};P.suppressClick=function(){window.addEventListener("click",I,!0),window.setTimeout(function(){window.removeEventListener("click",I,!0)},0)},P.mousePos=function(O,D){var R=O.getBoundingClientRect();return new F.default(D.clientX-R.left-O.clientLeft,D.clientY-R.top-O.clientTop)},P.touchPos=function(O,D){var R=O.getBoundingClientRect(),y=[],v=o(D),h;try{for(v.s();!(h=v.n()).done;){var S=h.value;y.push(new F.default(S.clientX-R.left-O.clientLeft,S.clientY-R.top-O.clientTop))}}catch(A){v.e(A)}finally{v.f()}return y},P.mouseButton=function(O){return typeof window.InstallTrigger!="undefined"&&O.button===2&&O.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:O.button},P.remove=function(O){O.parentNode&&O.parentNode.removeChild(O)}},80790:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PerformanceUtils=c.PerformanceMarkers=void 0;var n=null,i=[],F=30,o=1e3/F,w=window.performance,_={create:"create",load:"load",fullLoad:"fullLoad"};c.PerformanceMarkers=_;var P={mark:function(d){w.mark(d)},frame:function(d){var E=d;if(n!=null){var g=E-n;i.push(g)}n=E},clearMetrics:function(){n=null,i=[],w.clearMeasures("loadTime"),w.clearMeasures("fullLoadTime");for(var d in _)w.clearMarks(_[d])},getPerformanceMetrics:function(){var d=w.measure("loadTime",_.create,_.load).duration,E=w.measure("fullLoadTime",_.create,_.fullLoad).duration,g=i.length,k=i.reduce(function(I,O){return I+O},0)/g/1e3,M=1/k,j=i.filter(function(I){return I>o}).reduce(function(I,O){return I+(O-o)/o},0),U=j/(g+j)*100;return{loadTime:d,fullLoadTime:E,fps:M,percentDroppedFrames:U}}};c.PerformanceUtils=P},46314:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713));function _(g,k){var M=typeof Symbol!="undefined"&&g[Symbol.iterator]||g["@@iterator"];if(!M){if(Array.isArray(g)||(M=P(g))||k&&g&&typeof g.length=="number"){M&&(g=M);var j=0,U=function(){};return{s:U,n:function(){return j>=g.length?{done:!0}:{done:!1,value:g[j++]}},e:function(y){throw y},f:U}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var I=!0,O=!1,D;return{s:function(){M=M.call(g)},n:function(){var y=M.next();return I=y.done,y},e:function(y){O=!0,D=y},f:function(){try{!I&&M.return!=null&&M.return()}finally{if(O)throw D}}}}function P(g,k){if(!!g){if(typeof g=="string")return L(g,k);var M=Object.prototype.toString.call(g).slice(8,-1);if(M==="Object"&&g.constructor&&(M=g.constructor.name),M==="Map"||M==="Set")return Array.from(g);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return L(g,k)}}function L(g,k){(k==null||k>g.length)&&(k=g.length);for(var M=0,j=new Array(k);M<k;M++)j[M]=g[M];return j}var d=function(){function g(){(0,F.default)(this,g),(0,w.default)(this,"queue",void 0),(0,w.default)(this,"id",void 0),(0,w.default)(this,"cleared",void 0),(0,w.default)(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return(0,o.default)(g,[{key:"add",value:function(M){var j=++this.id,U=this.queue;return U.push({callback:M,id:j,cancelled:!1}),j}},{key:"remove",value:function(M){var j=this.currentlyRunning,U=j?this.queue.concat(j):this.queue,I=_(U),O;try{for(I.s();!(O=I.n()).done;){var D=O.value;if(D.id===M){D.cancelled=!0;return}}}catch(R){I.e(R)}finally{I.f()}}},{key:"run",value:function(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,j=this.currentlyRunning=this.queue;this.queue=[];var U=_(j),I;try{for(U.s();!(I=U.n()).done;){var O=I.value;if(!O.cancelled&&(O.callback(M),this.cleared))break}}catch(D){U.e(D)}finally{U.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),g}(),E=d;c.default=E},82182:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(21165)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(33124)),L=i(n(67268)),d=n(5602),E,g,k;function M(I,O){var D=Object.keys(I);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(I);O&&(R=R.filter(function(y){return Object.getOwnPropertyDescriptor(I,y).enumerable})),D.push.apply(D,R)}return D}function j(I){for(var O=1;O<arguments.length;O++){var D=arguments[O]!=null?arguments[O]:{};O%2?M(Object(D),!0).forEach(function(R){(0,_.default)(I,R,D[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(D)):M(Object(D)).forEach(function(R){Object.defineProperty(I,R,Object.getOwnPropertyDescriptor(D,R))})}return I}var U=(E=(0,d.lazyInject)(d.TYPES.IGlobalConfigService),g=function(){function I(O){(0,o.default)(this,I),(0,F.default)(this,"configService",k,this),(0,_.default)(this,"config",void 0),this.config=O}return(0,w.default)(I,[{key:"setContainer",value:function(D,R){D.bind(d.TYPES.MapConfig).toConstantValue(j(j({},this.config),{},{id:R})),D.bind(d.TYPES.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),I}(),k=(0,P.default)(g.prototype,"configService",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g);c.default=U},55928:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=n(89568),L=Math.PI/180,d=function(){function E(){(0,o.default)(this,E),(0,_.default)(this,"projectionMatrix",P.mat4.create()),(0,_.default)(this,"viewMatrix",P.mat4.create()),(0,_.default)(this,"viewProjectionMatrix",P.mat4.create()),(0,_.default)(this,"ViewProjectionMatrixUncentered",P.mat4.create()),(0,_.default)(this,"viewUncenteredMatrix",P.mat4.create()),(0,_.default)(this,"zoom",void 0),(0,_.default)(this,"center",void 0)}return(0,w.default)(E,[{key:"syncWithMapCamera",value:function(k){var M=k.zoom,j=M===void 0?1:M,U=k.pitch,I=U===void 0?0:U,O=k.bearing,D=O===void 0?0:O,R=k.center,y=R===void 0?[0,0]:R,v=k.offsetOrigin,h=v===void 0?[0,0]:v,S=k.cameraHeight,A=S===void 0?1:S,x=k.aspect,z=x===void 0?1:x,B=k.near,V=B===void 0?.1:B,Q=k.far,oe=Q===void 0?1e3:Q,re=k.fov,Z=re===void 0?0:re;this.zoom=j,this.center=y;var ee=I*L,H=(360-D)*L;P.mat4.perspective(this.projectionMatrix,Z,z,V,oe);var ae=P.vec3.fromValues(A*Math.sin(ee)*Math.sin(H),-A*Math.sin(ee)*Math.cos(H),A*Math.cos(ee)),G=P.vec3.fromValues(-Math.cos(ee)*Math.sin(H),Math.cos(ee)*Math.cos(H),Math.sin(ee));P.mat4.lookAt(this.viewMatrix,ae,P.vec3.fromValues(0,0,0),G),this.viewUncenteredMatrix=P.mat4.clone(this.viewMatrix),P.mat4.translate(this.viewMatrix,this.viewMatrix,P.vec3.fromValues(-h[0],h[1],0)),P.mat4.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),P.mat4.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var k=(0,F.default)(this.center,2),M=k[0],j=k[1];return[M,j]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(k,M){var j=85.0511287798,U=Math.max(Math.min(j,k[1]),-j),I=256<<20,O=Math.PI/180,D=k[0]*O,R=U*O;R=Math.log(Math.tan(Math.PI/4+R/2));var y=.5/Math.PI,v=.5,h=-.5/Math.PI;return O=.5,D=I*(y*D+v)-215440491,R=-(I*(h*R+O)-106744817),[D,R]}}]),E}();c.default=d},43332:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(82182)),d=i(n(13252));function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){return(0,F.default)(this,U),j.apply(this,arguments)}return(0,o.default)(U,[{key:"getServiceConstructor",value:function(){return d.default}}]),U}(L.default);c.default=k},13252:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(6479)),w=i(n(48926)),_=i(n(63038)),P=i(n(21165)),L=i(n(34575)),d=i(n(93913)),E=i(n(59713)),g=i(n(33124)),k=i(n(67268)),M=i(n(81618)),j=n(5602),U=n(82887),I=n(89568),O=n(86700);n(28660);var D=n(36290),R=n(71777),y=n(11299),v=i(n(55928)),h,S,A,x,z,B,V,Q,oe,re,Z;function ee(he,se){var J=Object.keys(he);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(he);se&&(fe=fe.filter(function(me){return Object.getOwnPropertyDescriptor(he,me).enumerable})),J.push.apply(J,fe)}return J}function H(he){for(var se=1;se<arguments.length;se++){var J=arguments[se]!=null?arguments[se]:{};se%2?ee(Object(J),!0).forEach(function(fe){(0,E.default)(he,fe,J[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(he,Object.getOwnPropertyDescriptors(J)):ee(Object(J)).forEach(function(fe){Object.defineProperty(he,fe,Object.getOwnPropertyDescriptor(J,fe))})}return he}function ae(he,se){if(se||(se=document),!!se){var J=se.head||se.getElementsByTagName("head")[0];if(!J){J=se.createElement("head");var fe=se.body||se.getElementsByTagName("body")[0];fe?fe.parentNode.insertBefore(J,fe):se.documentElement.appendChild(J)}var me=se.createElement("style");return me.type="text/css",me.styleSheet?me.styleSheet.cssText=he:me.appendChild(se.createTextNode(he)),J.appendChild(me),me}}ae(`.amap-logo{
 display: none !important;
}
`);var G=0;window.forceWebGL=!0;var ie="15cd8a57710d40c9b7c0e3cc120f1200",le="1.4.15",Me="amap-script",ge=!1,pe=[],Ne=12,Re=(h=(0,O.injectable)(),S=(0,O.inject)(j.TYPES.IGlobalConfigService),A=(0,O.inject)(j.TYPES.MapConfig),x=(0,O.inject)(j.TYPES.ICoordinateSystemService),z=(0,O.inject)(j.TYPES.IEventEmitter),h(B=(V=function(){function he(){var se=this;(0,L.default)(this,he),(0,E.default)(this,"version",R.Version["GAODE1.x"]),(0,E.default)(this,"map",void 0),(0,P.default)(this,"configService",Q,this),(0,P.default)(this,"config",oe,this),(0,P.default)(this,"coordinateSystemService",re,this),(0,P.default)(this,"eventEmitter",Z,this),(0,E.default)(this,"markerContainer",void 0),(0,E.default)(this,"$mapContainer",void 0),(0,E.default)(this,"viewport",void 0),(0,E.default)(this,"cameraChangedCallback",void 0),(0,E.default)(this,"handleCameraChanged",function(J){var fe=J.camera,me=fe.fov,Le=fe.near,C=fe.far,X=fe.height,de=fe.pitch,Ae=fe.rotation,De=fe.aspect,Ge=fe.position,$e=se.getCenter(),ct=$e.lng,gt=$e.lat;if(se.cameraChangedCallback){se.viewport.syncWithMapCamera({aspect:De,bearing:360-Ae,far:C,fov:me,cameraHeight:X,near:Le,pitch:de,zoom:se.map.getZoom()-1,center:[ct,gt],offsetOrigin:[Ge.x,Ge.y]});var st=se.config.offsetZoom,xe=st===void 0?Ne:st;se.viewport.getZoom()>xe?se.coordinateSystemService.setCoordinateSystem(j.CoordinateSystem.P20_OFFSET):se.coordinateSystemService.setCoordinateSystem(j.CoordinateSystem.P20),se.cameraChangedCallback(se.viewport)}})}return(0,d.default)(he,[{key:"addMarkerContainer",value:function(){var J=this.map.getContainer();if(J!==null){var fe=J.getElementsByClassName("amap-maps")[0];this.markerContainer=U.DOM.create("div","l7-marker-container",fe)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(J,fe){j.MapServiceEvent.indexOf(J)!==-1?this.eventEmitter.on(J,fe):this.map.on(J,fe)}},{key:"off",value:function(J,fe){j.MapServiceEvent.indexOf(J)!==-1?this.eventEmitter.off(J,fe):this.map.off(J,fe)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var J;return(J=this.map.getContainer())===null||J===void 0?void 0:J.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var J=this.map.getSize();return[J.getWidth(),J.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(J){return this.map.setZoom(J)}},{key:"getCenter",value:function(J){if(J!=null&&J.padding){var fe=this.getCenter(),me=this.getSize(),Le=(0,_.default)(me,2),C=Le[0],X=Le[1],de=(0,D.toPaddingOptions)(J.padding),Ae=this.lngLatToPixel([fe.lng,fe.lat]),De=[(de.right-de.left)/2,(de.bottom-de.top)/2],Ge=this.pixelToLngLat([Ae.x-De[0],Ae.y-De[1]]);return Ge}var $e=this.map.getCenter();return{lng:$e.getLng(),lat:$e.getLat()}}},{key:"setCenter",value:function(J,fe){if(fe!=null&&fe.padding){var me=(0,D.toPaddingOptions)(fe.padding),Le=this.lngLatToPixel(J),C=[(me.right-me.left)/2,(me.bottom-me.top)/2],X=this.pixelToLngLat([Le.x+C[0],Le.y+C[1]]);this.map.setCenter([X.lng,X.lat])}else this.map.setCenter(J)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var J=this.map.getBounds().toBounds(),fe=J.getNorthEast(),me=J.getSouthWest(),Le=this.getCenter(),C=Le.lng>fe.getLng()||Le.lng<me.getLng()?180-fe.getLng():fe.getLng(),X=Le.lng<me.getLng()?me.getLng()-180:me.getLng();return[[X,me.getLat()],[C,fe.getLat()]]}},{key:"getMinZoom",value:function(){var J=this.map.get("zooms");return J[0]-1}},{key:"getMaxZoom",value:function(){var J=this.map.get("zooms");return J[1]-1}},{key:"setRotation",value:function(J){return this.map.setRotation(J)}},{key:"setPitch",value:function(J){return this.map.setPitch(J)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(J){this.map.panTo(J)}},{key:"panBy",value:function(J){this.map.panTo(J)}},{key:"fitBounds",value:function(J){this.map.setBounds(new AMap.Bounds([J[0][0],J[0][1],J[1][0],J[1][1]]))}},{key:"setZoomAndCenter",value:function(J,fe){this.map.setZoomAndCenter(J,fe)}},{key:"setMapStyle",value:function(J){this.map.setMapStyle(this.getMapStyle(J))}},{key:"setMapStatus",value:function(J){this.map.setStatus(J)}},{key:"pixelToLngLat",value:function(J){var fe=this.map.pixelToLngLat(new AMap.Pixel(J[0],J[1]));return{lng:fe.getLng(),lat:fe.getLat()}}},{key:"lngLatToPixel",value:function(J){var fe=this.map.lnglatToPixel(new AMap.LngLat(J[0],J[1]));return{x:fe.getX(),y:fe.getY()}}},{key:"containerToLngLat",value:function(J){var fe=new AMap.Pixel(J[0],J[1]),me=this.map.containerToLngLat(fe);return{lng:me==null?void 0:me.getLng(),lat:me==null?void 0:me.getLat()}}},{key:"lngLatToContainer",value:function(J){var fe=new AMap.LngLat(J[0],J[1]),me=this.map.lngLatToContainer(fe);return{x:me.getX(),y:me.getY()}}},{key:"lngLatToMercator",value:function(J,fe){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(J,fe,me){var Le=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},X=this.viewport.projectFlat(J),de=I.mat4.create();return I.mat4.translate(de,de,I.vec3.fromValues(X[0],X[1],fe)),I.mat4.scale(de,de,I.vec3.fromValues(Le[0],Le[1],Le[2])),I.mat4.rotateX(de,de,me[0]),I.mat4.rotateY(de,de,me[1]),I.mat4.rotateZ(de,de,me[2]),de}},{key:"init",value:function(){var se=(0,w.default)(F.default.mark(function fe(){var me=this,Le,C,X,de,Ae,De,Ge,$e,ct,gt,st,xe,Mt,Ut;return F.default.wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return Le=this.config,C=Le.id,X=Le.style,de=X===void 0?"light":X,Ae=Le.minZoom,De=Ae===void 0?0:Ae,Ge=Le.maxZoom,$e=Ge===void 0?18:Ge,ct=Le.token,gt=ct===void 0?ie:ct,st=Le.mapInstance,xe=Le.plugin,Mt=xe===void 0?[]:xe,Ut=(0,o.default)(Le,["id","style","minZoom","maxZoom","token","mapInstance","plugin"]),nt.next=3,new Promise(function(it){var pt=function(){if(st)me.map=st,me.$mapContainer=me.map.getContainer(),setTimeout(function(){me.map.on("camerachange",me.handleCameraChanged),it()},30);else{me.$mapContainer=me.creatAmapContainer(C);var Er=new AMap.Map(me.$mapContainer,H({mapStyle:me.getMapStyle(de),zooms:[De,$e],viewMode:"3D"},Ut));Er.on("camerachange",me.handleCameraChanged),me.map=Er,setTimeout(function(){it()},10)}};!ge&&!st?(gt===ie&&console.warn(me.configService.getSceneWarninfo("MapToken")),ge=!0,Mt.push("Map3D"),M.default.load({key:gt,version:le,plugins:Mt}).then(function(Vt){pt(),pe.length&&(pe.forEach(function(Er){return Er()}),pe=[])}).catch(function(Vt){throw new Error(Vt)})):ge&&window.AMap||st?pt():pe.push(pt)});case 3:this.viewport=new v.default;case 4:case"end":return nt.stop()}},fe,this)}));function J(){return se.apply(this,arguments)}return J}()},{key:"exportMap",value:function(J){var fe,me=(fe=this.getContainer())===null||fe===void 0?void 0:fe.getElementsByClassName("amap-layer")[0],Le=J==="jpg"?me==null?void 0:me.toDataURL("image/jpeg"):me==null?void 0:me.toDataURL("image/png");return Le}},{key:"emit",value:function(J){for(var fe,me=arguments.length,Le=new Array(me>1?me-1:0),C=1;C<me;C++)Le[C-1]=arguments[C];(fe=this.eventEmitter).emit.apply(fe,[J].concat(Le))}},{key:"once",value:function(J){for(var fe,me=arguments.length,Le=new Array(me>1?me-1:0),C=1;C<me;C++)Le[C-1]=arguments[C];(fe=this.eventEmitter).once.apply(fe,[J].concat(Le))}},{key:"destroy",value:function(){this.map.destroy(),delete window.initAMap;var J=document.getElementById(Me);J&&document.head.removeChild(J)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(J){this.cameraChangedCallback=J}},{key:"getMapStyle",value:function(J){return y.MapTheme[J]?y.MapTheme[J]:J}},{key:"creatAmapContainer",value:function(J){var fe=J;typeof J=="string"&&(fe=document.getElementById(J));var me=document.createElement("div");return me.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,me.id="l7_amap_div"+G++,fe.appendChild(me),me}}]),he}(),Q=(0,g.default)(V.prototype,"configService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=(0,g.default)(V.prototype,"config",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=(0,g.default)(V.prototype,"coordinateSystemService",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=(0,g.default)(V.prototype,"eventEmitter",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V))||B);c.default=Re},11299:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MapTheme=void 0;var n={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"};c.MapTheme=n},2208:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(63038)),o=i(n(319)),w=i(n(34575)),_=i(n(93913)),P=i(n(59713)),L=n(89568),d=function(){function E(){(0,w.default)(this,E),(0,P.default)(this,"projectionMatrix",L.mat4.create()),(0,P.default)(this,"viewMatrix",L.mat4.create()),(0,P.default)(this,"viewProjectionMatrix",L.mat4.create()),(0,P.default)(this,"ViewProjectionMatrixUncentered",L.mat4.create()),(0,P.default)(this,"viewUncenteredMatrix",L.mat4.create()),(0,P.default)(this,"zoom",void 0),(0,P.default)(this,"center",void 0)}return(0,_.default)(E,[{key:"syncWithMapCamera",value:function(k){var M=k.zoom,j=M===void 0?1:M,U=k.center,I=U===void 0?[0,0]:U,O=k.offsetOrigin,D=O===void 0?[0,0]:O,R=k.cameraPosition,y=R===void 0?[0,0,0]:R,v=k.up,h=v===void 0?[0,1,0]:v,S=k.lookAt,A=S===void 0?[0,0,0]:S,x=k.aspect,z=x===void 0?1:x,B=k.near,V=B===void 0?.1:B,Q=k.far,oe=Q===void 0?1e3:Q,re=k.fov,Z=re===void 0?45:re;this.zoom=j,this.center=I,L.mat4.perspective(this.projectionMatrix,Z/180*Math.PI,z,V,oe);var ee=L.vec3.fromValues.apply(L.vec3,(0,o.default)(y)),H=L.vec3.fromValues.apply(L.vec3,(0,o.default)(A)),ae=L.vec3.fromValues.apply(L.vec3,(0,o.default)(h));L.mat4.lookAt(this.viewMatrix,ee,H,ae),this.viewUncenteredMatrix=L.mat4.clone(this.viewMatrix),L.mat4.translate(this.viewMatrix,this.viewMatrix,L.vec3.fromValues(-D[0],D[1],0)),L.mat4.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),L.mat4.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var k=(0,F.default)(this.center,2),M=k[0],j=k[1];return[M,j]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(k,M){var j=85.0511287798,U=Math.max(Math.min(j,k[1]),-j),I=256<<20,O=Math.PI/180,D=k[0]*O,R=U*O;R=Math.log(Math.tan(Math.PI/4+R/2));var y=.5/Math.PI,v=.5,h=-.5/Math.PI;return O=.5,D=I*(y*D+v)-215440491,R=-(I*(h*R+O)-106744817),[D,R]}}]),E}();c.default=d},47144:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(82182)),d=i(n(95889));function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){return(0,F.default)(this,U),j.apply(this,arguments)}return(0,o.default)(U,[{key:"getServiceConstructor",value:function(){return d.default}}]),U}(L.default);c.default=k},95889:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(6479)),w=i(n(48926)),_=i(n(63038)),P=i(n(319)),L=i(n(21165)),d=i(n(34575)),E=i(n(93913)),g=i(n(59713)),k=i(n(33124)),M=i(n(67268)),j=i(n(81618)),U=n(5602),I=n(82887),O=n(89568),D=n(86700);n(28660);var R=n(36290),y=n(71777),v=n(4872),h=i(n(2208)),S,A,x,z,B,V,Q,oe,re,Z,ee;function H(he,se){var J=Object.keys(he);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(he);se&&(fe=fe.filter(function(me){return Object.getOwnPropertyDescriptor(he,me).enumerable})),J.push.apply(J,fe)}return J}function ae(he){for(var se=1;se<arguments.length;se++){var J=arguments[se]!=null?arguments[se]:{};se%2?H(Object(J),!0).forEach(function(fe){(0,g.default)(he,fe,J[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(he,Object.getOwnPropertyDescriptors(J)):H(Object(J)).forEach(function(fe){Object.defineProperty(he,fe,Object.getOwnPropertyDescriptor(J,fe))})}return he}function G(he,se){if(se||(se=document),!!se){var J=se.head||se.getElementsByTagName("head")[0];if(!J){J=se.createElement("head");var fe=se.body||se.getElementsByTagName("body")[0];fe?fe.parentNode.insertBefore(J,fe):se.documentElement.appendChild(J)}var me=se.createElement("style");return me.type="text/css",me.styleSheet?me.styleSheet.cssText=he:me.appendChild(se.createTextNode(he)),J.appendChild(me),me}}G(`.amap-logo{
 display: none !important;
}
`);var ie=0;window.forceWebGL=!0;var le="ff533602d57df6f8ab3b0fea226ae52f",Me="2.0",ge="amap-script",pe=!1,Ne=[],Re=(S=(0,D.injectable)(),A=(0,D.inject)(U.TYPES.IGlobalConfigService),x=(0,D.inject)(U.TYPES.MapConfig),z=(0,D.inject)(U.TYPES.ICoordinateSystemService),B=(0,D.inject)(U.TYPES.IEventEmitter),S(V=(Q=function(){function he(){var se=this;(0,d.default)(this,he),(0,g.default)(this,"version",y.Version["GAODE2.x"]),(0,g.default)(this,"map",void 0),(0,g.default)(this,"sceneCenter",void 0),(0,g.default)(this,"sceneCenterMKT",void 0),(0,L.default)(this,"configService",oe,this),(0,L.default)(this,"config",re,this),(0,L.default)(this,"coordinateSystemService",Z,this),(0,L.default)(this,"eventEmitter",ee,this),(0,g.default)(this,"markerContainer",void 0),(0,g.default)(this,"$mapContainer",void 0),(0,g.default)(this,"viewport",void 0),(0,g.default)(this,"cameraChangedCallback",void 0),(0,g.default)(this,"handleViewChanged",function(J){var fe=se.map.customCoords.getCameraParams(),me=fe.fov,Le=fe.near,C=fe.far,X=fe.aspect,de=fe.position,Ae=fe.lookAt,De=fe.up,Ge=J.zoom,$e=se.map.customCoords.getCenter();se.cameraChangedCallback&&(se.viewport.syncWithMapCamera({aspect:X,far:C,fov:me,cameraPosition:de,lookAt:Ae,up:De,near:Le,zoom:Ge-1,center:$e,offsetOrigin:[de[0],de[1]]}),se.coordinateSystemService.setCoordinateSystem(U.CoordinateSystem.P20_2),se.cameraChangedCallback(se.viewport))})}return(0,E.default)(he,[{key:"setCustomCoordCenter",value:function(J){var fe;this.sceneCenter=J,this.sceneCenterMKT=(fe=this.map.getProjection()).project.apply(fe,(0,P.default)(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(J){var fe=this.map.getProjection(),me=fe.project;return this.sceneCenter||(this.map.customCoords.setCenter(J),this.setCustomCoordCenter(J)),this._sub(me(J[0],J[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(J){var fe=this;return J.map(function(me){return typeof me[0]=="number"?fe.lngLatToCoord(me):me.map(function(Le){return fe.lngLatToCoord(Le)})})}},{key:"addMarkerContainer",value:function(){if(!!this.map){var J=this.map.getContainer();J!==null&&(this.markerContainer=I.DOM.create("div","l7-marker-container2",J))}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(J,fe){U.MapServiceEvent.indexOf(J)!==-1?this.eventEmitter.on(J,fe):this.map.on(J,fe)}},{key:"off",value:function(J,fe){U.MapServiceEvent.indexOf(J)!==-1?this.eventEmitter.off(J,fe):this.map.off(J,fe)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var J;return(J=this.map.getContainer())===null||J===void 0?void 0:J.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var J=this.map.getSize();return[J.getWidth(),J.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(J){return this.map.setZoom(J)}},{key:"getCenter",value:function(J){if(J!=null&&J.padding){var fe=this.getCenter(),me=this.getSize(),Le=(0,_.default)(me,2),C=Le[0],X=Le[1],de=(0,R.toPaddingOptions)(J.padding),Ae=this.lngLatToPixel([fe.lng,fe.lat]),De=[(de.right-de.left)/2,(de.bottom-de.top)/2],Ge=this.pixelToLngLat([Ae.x-De[0],Ae.y-De[1]]);return Ge}var $e=this.map.getCenter();return{lng:$e.getLng(),lat:$e.getLat()}}},{key:"setCenter",value:function(J,fe){if(fe!=null&&fe.padding){var me=(0,R.toPaddingOptions)(fe.padding),Le=this.lngLatToPixel(J),C=[(me.right-me.left)/2,(me.bottom-me.top)/2],X=this.pixelToLngLat([Le.x+C[0],Le.y+C[1]]);this.map.setCenter([X.lng,X.lat])}else this.map.setCenter(J)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var J=this.map.getBounds(),fe=J.getNorthEast(),me=J.getSouthWest(),Le=this.getCenter(),C=Le.lng>fe.getLng()||Le.lng<me.getLng()?180-fe.getLng():fe.getLng(),X=Le.lng<me.getLng()?me.getLng()-180:me.getLng();return[[X,me.getLat()],[C,fe.getLat()]]}},{key:"getMinZoom",value:function(){var J=this.map.getZooms();return J[0]-1}},{key:"getMaxZoom",value:function(){var J=this.map.getZooms();return J[1]-1}},{key:"setRotation",value:function(J){return this.map.setRotation(J)}},{key:"setPitch",value:function(J){return this.map.setPitch(J)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(J){this.map.panTo(J)}},{key:"panBy",value:function(J){this.map.panTo(J)}},{key:"fitBounds",value:function(J){this.map.setBounds(new AMap.Bounds([J[0][0],J[0][1],J[1][0],J[1][1]]))}},{key:"setZoomAndCenter",value:function(J,fe){this.map.setZoomAndCenter(J,fe)}},{key:"setMapStyle",value:function(J){this.map.setMapStyle(this.getMapStyle(J))}},{key:"setMapStatus",value:function(J){this.map.setStatus(J)}},{key:"pixelToLngLat",value:function(J){var fe=this.map.pixelToLngLat(new AMap.Pixel(J[0],J[1]));return{lng:fe.getLng(),lat:fe.getLat()}}},{key:"lngLatToPixel",value:function(J){var fe=this.map.lnglatToPixel(new AMap.LngLat(J[0],J[1]));return{x:fe.getX(),y:fe.getY()}}},{key:"containerToLngLat",value:function(J){var fe=new AMap.Pixel(J[0],J[1]),me=this.map.containerToLngLat(fe);return{lng:me==null?void 0:me.getLng(),lat:me==null?void 0:me.getLat()}}},{key:"lngLatToContainer",value:function(J){var fe=new AMap.LngLat(J[0],J[1]),me=this.map.lngLatToContainer(fe);return{x:me.getX(),y:me.getY()}}},{key:"lngLatToMercator",value:function(J,fe){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(J,fe,me){var Le=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},X=this.viewport.projectFlat(J),de=O.mat4.create();return O.mat4.translate(de,de,O.vec3.fromValues(X[0],X[1],fe)),O.mat4.scale(de,de,O.vec3.fromValues(Le[0],Le[1],Le[2])),O.mat4.rotateX(de,de,me[0]),O.mat4.rotateY(de,de,me[1]),O.mat4.rotateZ(de,de,me[2]),de}},{key:"init",value:function(){var se=(0,w.default)(F.default.mark(function fe(){var me=this,Le,C,X,de,Ae,De,Ge,$e,ct,gt,st,xe,Mt,Ut,At,nt;return F.default.wrap(function(pt){for(;;)switch(pt.prev=pt.next){case 0:return Le=this.config,C=Le.id,X=Le.style,de=X===void 0?"light":X,Ae=Le.minZoom,De=Ae===void 0?0:Ae,Ge=Le.maxZoom,$e=Ge===void 0?18:Ge,ct=Le.token,gt=ct===void 0?le:ct,st=Le.mapInstance,xe=Le.plugin,Mt=xe===void 0?[]:xe,Ut=Le.version,At=Ut===void 0?Me:Ut,nt=(0,o.default)(Le,["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"]),pt.next=3,new Promise(function(Vt){var Er=function(){if(st){var Br;me.map=st,me.$mapContainer=me.map.getContainer();var Ur=me.map.getCenter();(Br=me.map.customCoords)===null||Br===void 0||Br.setCenter([Ur.lng,Ur.lat]),me.setCustomCoordCenter([Ur.lng,Ur.lat]),setTimeout(function(){me.map.on("viewchange",me.handleViewChanged),Vt()},30)}else{me.$mapContainer=me.creatAmapContainer(C);var Ar=new AMap.Map(me.$mapContainer,ae({mapStyle:me.getMapStyle(de),zooms:[De,$e],viewMode:"3D"},nt));me.map=Ar;var Nn=Ar.getCenter();Ar.customCoords.setCenter([Nn.lng,Nn.lat]),me.setCustomCoordCenter([Nn.lng,Nn.lat]),Ar.on("viewchange",me.handleViewChanged),setTimeout(function(){Vt()},10)}};me.viewport=new h.default,!pe&&!st?(gt===le&&console.warn(me.configService.getSceneWarninfo("MapToken")),pe=!0,Mt.push("Map3D"),j.default.load({key:gt,version:At,plugins:Mt}).then(function(mr){Er(),Ne.length&&(Ne.forEach(function(Br){return Br()}),Ne=[])}).catch(function(mr){throw new Error(mr)})):pe&&window.AMap||st?Er():Ne.push(Er)});case 3:case"end":return pt.stop()}},fe,this)}));function J(){return se.apply(this,arguments)}return J}()},{key:"exportMap",value:function(J){var fe,me=(fe=this.getContainer())===null||fe===void 0?void 0:fe.getElementsByClassName("amap-layer")[0],Le=J==="jpg"?me==null?void 0:me.toDataURL("image/jpeg"):me==null?void 0:me.toDataURL("image/png");return Le}},{key:"emit",value:function(J){for(var fe,me=arguments.length,Le=new Array(me>1?me-1:0),C=1;C<me;C++)Le[C-1]=arguments[C];(fe=this.eventEmitter).emit.apply(fe,[J].concat(Le))}},{key:"once",value:function(J){for(var fe,me=arguments.length,Le=new Array(me>1?me-1:0),C=1;C<me;C++)Le[C-1]=arguments[C];(fe=this.eventEmitter).once.apply(fe,[J].concat(Le))}},{key:"destroy",value:function(){this.map.destroy(),delete window.initAMap;var J=document.getElementById(ge);J&&document.head.removeChild(J)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(J){this.cameraChangedCallback=J}},{key:"initViewPort",value:function(){var J,fe=(J=this.map.customCoords)===null||J===void 0?void 0:J.getCameraParams(),me=fe.fov,Le=fe.near,C=fe.far,X=fe.aspect,de=fe.position,Ae=fe.lookAt,De=fe.up,Ge=this.map.customCoords.getCenter(),$e=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:X,far:C,fov:me,cameraPosition:de,lookAt:Ae,near:Le,up:De,zoom:$e-1,center:Ge,offsetOrigin:[de[0],de[1]]}),this.coordinateSystemService.setCoordinateSystem(U.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(J,fe){var me=[0,0];return me[0]=J[0]-fe[0],me[1]=J[1]-fe[1],me}},{key:"getMapStyle",value:function(J){return v.MapTheme[J]?v.MapTheme[J]:J}},{key:"creatAmapContainer",value:function(J){var fe=J;typeof J=="string"&&(fe=document.getElementById(J));var me=document.createElement("div");return me.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,me.id="l7_amap_div"+ie++,fe.appendChild(me),me}}]),he}(),oe=(0,k.default)(Q.prototype,"configService",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),re=(0,k.default)(Q.prototype,"config",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=(0,k.default)(Q.prototype,"coordinateSystemService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=(0,k.default)(Q.prototype,"eventEmitter",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q))||V);c.default=Re},4872:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MapTheme=void 0;var n={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"};c.MapTheme=n},76971:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"GaodeMap",{enumerable:!0,get:function(){return F.default}}),Object.defineProperty(c,"GaodeMapV2",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(c,"Map",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(c,"Mapbox",{enumerable:!0,get:function(){return _.default}});var F=i(n(43332)),o=i(n(47144)),w=i(n(99691)),_=i(n(93808))},69893:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(71884)),P=function(){function L(){(0,F.default)(this,L),(0,w.default)(this,"viewport",void 0)}return(0,o.default)(L,[{key:"syncWithMapCamera",value:function(E){var g=E.center,k=E.zoom,M=E.pitch,j=E.bearing,U=E.viewportHeight,I=E.viewportWidth;this.viewport=new _.default({width:I,height:U,longitude:g&&g[0],latitude:g&&g[1],zoom:k,pitch:M,bearing:j})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(E,g){return this.viewport.projectFlat(E,g)}}]),L}();c.default=P},99691:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(82182)),d=i(n(64660));function E(M){var j=g();return function(){var I=(0,P.default)(M),O;if(j){var D=(0,P.default)(this).constructor;O=Reflect.construct(I,arguments,D)}else O=I.apply(this,arguments);return(0,_.default)(this,O)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}var k=function(M){(0,w.default)(U,M);var j=E(U);function U(){return(0,F.default)(this,U),j.apply(this,arguments)}return(0,o.default)(U,[{key:"getServiceConstructor",value:function(){return d.default}}]),U}(L.default);c.default=k},64660:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(6479)),w=i(n(48926)),_=i(n(21165)),P=i(n(34575)),L=i(n(93913)),d=i(n(59713)),E=i(n(33124)),g=i(n(67268)),k=n(5602),M=n(33899),j=n(82887),U=n(86700);n(28660);var I=n(71777),O=i(n(69893)),D=n(94763),R,y,v,h,S,A,x,z,B,V,Q;function oe(ae,G){var ie=Object.keys(ae);if(Object.getOwnPropertySymbols){var le=Object.getOwnPropertySymbols(ae);G&&(le=le.filter(function(Me){return Object.getOwnPropertyDescriptor(ae,Me).enumerable})),ie.push.apply(ie,le)}return ie}function re(ae){for(var G=1;G<arguments.length;G++){var ie=arguments[G]!=null?arguments[G]:{};G%2?oe(Object(ie),!0).forEach(function(le){(0,d.default)(ae,le,ie[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ae,Object.getOwnPropertyDescriptors(ie)):oe(Object(ie)).forEach(function(le){Object.defineProperty(ae,le,Object.getOwnPropertyDescriptor(ie,le))})}return ae}var Z={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},ee=12,H=(R=(0,U.injectable)(),y=(0,U.inject)(k.TYPES.MapConfig),v=(0,U.inject)(k.TYPES.IGlobalConfigService),h=(0,U.inject)(k.TYPES.ICoordinateSystemService),S=(0,U.inject)(k.TYPES.IEventEmitter),R(A=(x=function(){function ae(){var G=this;(0,P.default)(this,ae),(0,d.default)(this,"version",I.Version.L7MAP),(0,d.default)(this,"map",void 0),(0,_.default)(this,"config",z,this),(0,_.default)(this,"configService",B,this),(0,_.default)(this,"coordinateSystemService",V,this),(0,_.default)(this,"eventEmitter",Q,this),(0,d.default)(this,"viewport",void 0),(0,d.default)(this,"markerContainer",void 0),(0,d.default)(this,"cameraChangedCallback",void 0),(0,d.default)(this,"$mapContainer",void 0),(0,d.default)(this,"handleCameraChanged",function(){var ie=G.map.getCenter(),le=ie.lat,Me=ie.lng,ge=G.config.offsetCoordinate,pe=ge===void 0?!0:ge;G.viewport.syncWithMapCamera({bearing:G.map.getBearing(),center:[Me,le],viewportHeight:G.map.transform.height,pitch:G.map.getPitch(),viewportWidth:G.map.transform.width,zoom:G.map.getZoom(),cameraHeight:0}),G.viewport.getZoom()>ee&&pe?G.coordinateSystemService.setCoordinateSystem(k.CoordinateSystem.LNGLAT_OFFSET):G.coordinateSystemService.setCoordinateSystem(k.CoordinateSystem.LNGLAT),G.cameraChangedCallback(G.viewport)})}return(0,L.default)(ae,[{key:"addMarkerContainer",value:function(){var ie=this.map.getCanvasContainer();this.markerContainer=j.DOM.create("div","l7-marker-container",ie),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(ie,le){k.MapServiceEvent.indexOf(ie)!==-1?this.eventEmitter.on(ie,le):this.map.on(Z[ie]||ie,le)}},{key:"off",value:function(ie,le){this.map.off(Z[ie]||ie,le)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var ie=this.map.transform;return[ie.width,ie.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(ie){return this.map.setZoom(ie)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(ie){this.map.setCenter(ie)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(ie){this.map.setBearing(ie)}},{key:"zoomIn",value:function(ie,le){this.map.zoomIn(ie,le)}},{key:"zoomOut",value:function(ie,le){this.map.zoomOut(ie,le)}},{key:"setPitch",value:function(ie){return this.map.setPitch(ie)}},{key:"panTo",value:function(ie){this.map.panTo(ie)}},{key:"panBy",value:function(ie){this.panTo(ie)}},{key:"fitBounds",value:function(ie,le){this.map.fitBounds(ie,le)}},{key:"setMaxZoom",value:function(ie){this.map.setMaxZoom(ie)}},{key:"setMinZoom",value:function(ie){this.map.setMinZoom(ie)}},{key:"setMapStatus",value:function(ie){ie.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),ie.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),ie.dragEnable===!1&&this.map.dragPan.disable(),ie.dragEnable===!0&&this.map.dragPan.enable(),ie.rotateEnable===!1&&this.map.dragRotate.disable(),ie.dragEnable===!0&&this.map.dragRotate.enable(),ie.keyboardEnable===!1&&this.map.keyboard.disable(),ie.keyboardEnable===!0&&this.map.keyboard.enable(),ie.zoomEnable===!1&&this.map.scrollZoom.disable(),ie.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(ie,le){this.map.flyTo({zoom:ie,center:le})}},{key:"setMapStyle",value:function(ie){this.map.setStyle(this.getMapStyle(ie))}},{key:"pixelToLngLat",value:function(ie){return this.map.unproject(ie)}},{key:"lngLatToPixel",value:function(ie){return this.map.project(ie)}},{key:"containerToLngLat",value:function(ie){return this.map.unproject(ie)}},{key:"lngLatToContainer",value:function(ie){return this.map.project(ie)}},{key:"lngLatToMercator",value:function(ie,le){throw new Error("not implement")}},{key:"getModelMatrix",value:function(ie,le,Me){var ge=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],pe=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0};throw new Error("not implement")}},{key:"init",value:function(){var G=(0,w.default)(F.default.mark(function le(){var Me,ge,pe,Ne,Re,he,se,J,fe,me,Le;return F.default.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:Me=this.config,ge=Me.id,pe=ge===void 0?"map":ge,Ne=Me.attributionControl,Re=Ne===void 0?!1:Ne,he=Me.style,se=he===void 0?"light":he,J=Me.rotation,fe=J===void 0?0:J,me=Me.mapInstance,Le=(0,o.default)(Me,["id","attributionControl","style","rotation","mapInstance"]),this.viewport=new O.default,me?(this.map=me,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(pe),this.map=new M.Map(re({container:this.$mapContainer,style:this.getMapStyle(se),bearing:fe},Le))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 6:case"end":return X.stop()}},le,this)}));function ie(){return G.apply(this,arguments)}return ie}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(ie){for(var le,Me=arguments.length,ge=new Array(Me>1?Me-1:0),pe=1;pe<Me;pe++)ge[pe-1]=arguments[pe];(le=this.eventEmitter).emit.apply(le,[ie].concat(ge))}},{key:"once",value:function(ie){for(var le,Me=arguments.length,ge=new Array(Me>1?Me-1:0),pe=1;pe<Me;pe++)ge[pe-1]=arguments[pe];(le=this.eventEmitter).once.apply(le,[ie].concat(ge))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(ie){var le=this.map.getCanvas(),Me=ie==="jpg"?le==null?void 0:le.toDataURL("image/jpeg"):le==null?void 0:le.toDataURL("image/png");return Me}},{key:"onCameraChanged",value:function(ie){this.cameraChangedCallback=ie}},{key:"creatAmapContainer",value:function(ie){var le=ie;return typeof ie=="string"&&(le=document.getElementById(ie)),le}},{key:"getMapStyle",value:function(ie){return typeof ie!="string"?ie:D.MapTheme[ie]?D.MapTheme[ie]:ie}}]),ae}(),z=(0,E.default)(x.prototype,"config",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,E.default)(x.prototype,"configService",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=(0,E.default)(x.prototype,"coordinateSystemService",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=(0,E.default)(x.prototype,"eventEmitter",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x))||A);c.default=H},94763:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MapTheme=void 0;var n={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}};c.MapTheme=n},66246:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=i(n(71884)),P=function(){function L(){(0,F.default)(this,L),(0,w.default)(this,"viewport",void 0)}return(0,o.default)(L,[{key:"syncWithMapCamera",value:function(E){var g=E.center,k=E.zoom,M=E.pitch,j=E.bearing,U=E.viewportHeight,I=E.viewportWidth;this.viewport=new _.default({width:I,height:U,longitude:g&&g[0],latitude:g&&g[1],zoom:k,pitch:M,bearing:j})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(E,g){return this.viewport.projectFlat(E,g)}}]),L}();c.default=P},93808:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(2205)),_=i(n(78585)),P=i(n(29754)),L=i(n(82182)),d=i(n(73740));function E(j){var U=g();return function(){var O=(0,P.default)(j),D;if(U){var R=(0,P.default)(this).constructor;D=Reflect.construct(O,arguments,R)}else D=O.apply(this,arguments);return(0,_.default)(this,D)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}function k(j,U){if(U||(U=document),!!U){var I=U.head||U.getElementsByTagName("head")[0];if(!I){I=U.createElement("head");var O=U.body||U.getElementsByTagName("body")[0];O?O.parentNode.insertBefore(I,O):U.documentElement.appendChild(I)}var D=U.createElement("style");return D.type="text/css",D.styleSheet?D.styleSheet.cssText=j:D.appendChild(U.createTextNode(j)),I.appendChild(D),D}}k(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var M=function(j){(0,w.default)(I,j);var U=E(I);function I(){return(0,F.default)(this,I),U.apply(this,arguments)}return(0,o.default)(I,[{key:"getServiceConstructor",value:function(){return d.default}}]),I}(L.default);c.default=M},73740:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(6479)),w=i(n(48926)),_=i(n(21165)),P=i(n(34575)),L=i(n(93913)),d=i(n(59713)),E=i(n(33124)),g=i(n(67268)),k=n(5602),M=n(82887),j=n(89568),U=n(86700),I=i(n(6158));n(28660);var O=n(71777),D=i(n(66246)),R=n(27277),y,v,h,S,A,x,z,B,V,Q,oe;function re(Me,ge){var pe=Object.keys(Me);if(Object.getOwnPropertySymbols){var Ne=Object.getOwnPropertySymbols(Me);ge&&(Ne=Ne.filter(function(Re){return Object.getOwnPropertyDescriptor(Me,Re).enumerable})),pe.push.apply(pe,Ne)}return pe}function Z(Me){for(var ge=1;ge<arguments.length;ge++){var pe=arguments[ge]!=null?arguments[ge]:{};ge%2?re(Object(pe),!0).forEach(function(Ne){(0,d.default)(Me,Ne,pe[Ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Me,Object.getOwnPropertyDescriptors(pe)):re(Object(pe)).forEach(function(Ne){Object.defineProperty(Me,Ne,Object.getOwnPropertyDescriptor(pe,Ne))})}return Me}function ee(Me,ge){if(ge||(ge=document),!!ge){var pe=ge.head||ge.getElementsByTagName("head")[0];if(!pe){pe=ge.createElement("head");var Ne=ge.body||ge.getElementsByTagName("body")[0];Ne?Ne.parentNode.insertBefore(pe,Ne):ge.documentElement.appendChild(pe)}var Re=ge.createElement("style");return Re.type="text/css",Re.styleSheet?Re.styleSheet.cssText=Me:Re.appendChild(ge.createTextNode(Me)),pe.appendChild(Re),Re}}ee(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=I.default;var H={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},ae=0,G=12,ie="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",le=(y=(0,U.injectable)(),v=(0,U.inject)(k.TYPES.MapConfig),h=(0,U.inject)(k.TYPES.IGlobalConfigService),S=(0,U.inject)(k.TYPES.ICoordinateSystemService),A=(0,U.inject)(k.TYPES.IEventEmitter),y(x=(z=function(){function Me(){var ge=this;(0,P.default)(this,Me),(0,d.default)(this,"version",O.Version.MAPBOX),(0,d.default)(this,"map",void 0),(0,_.default)(this,"config",B,this),(0,_.default)(this,"configService",V,this),(0,_.default)(this,"coordinateSystemService",Q,this),(0,_.default)(this,"eventEmitter",oe,this),(0,d.default)(this,"viewport",void 0),(0,d.default)(this,"markerContainer",void 0),(0,d.default)(this,"cameraChangedCallback",void 0),(0,d.default)(this,"$mapContainer",void 0),(0,d.default)(this,"handleCameraChanged",function(){var pe=ge.map.getCenter().wrap(),Ne=pe.lat,Re=pe.lng;ge.viewport.syncWithMapCamera({bearing:ge.map.getBearing(),center:[Re,Ne],viewportHeight:ge.map.transform.height,pitch:ge.map.getPitch(),viewportWidth:ge.map.transform.width,zoom:ge.map.getZoom(),cameraHeight:0});var he=ge.config.offsetZoom,se=he===void 0?G:he;ge.viewport.getZoom()>se?ge.coordinateSystemService.setCoordinateSystem(k.CoordinateSystem.LNGLAT_OFFSET):ge.coordinateSystemService.setCoordinateSystem(k.CoordinateSystem.LNGLAT),ge.cameraChangedCallback(ge.viewport)})}return(0,L.default)(Me,[{key:"addMarkerContainer",value:function(){var pe=this.map.getCanvasContainer();this.markerContainer=M.DOM.create("div","l7-marker-container",pe),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(pe,Ne){k.MapServiceEvent.indexOf(pe)!==-1?this.eventEmitter.on(pe,Ne):this.map.on(H[pe]||pe,Ne)}},{key:"off",value:function(pe,Ne){this.map.off(H[pe]||pe,Ne)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var pe=this.map.transform;return[pe.width,pe.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(pe){return this.map.setZoom(pe)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(pe){this.map.setCenter(pe)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(pe){this.map.setBearing(pe)}},{key:"zoomIn",value:function(pe,Ne){this.map.zoomIn(pe,Ne)}},{key:"zoomOut",value:function(pe,Ne){this.map.zoomOut(pe,Ne)}},{key:"setPitch",value:function(pe){return this.map.setPitch(pe)}},{key:"panTo",value:function(pe){this.map.panTo(pe)}},{key:"panBy",value:function(pe){this.panTo(pe)}},{key:"fitBounds",value:function(pe,Ne){this.map.fitBounds(pe,Ne)}},{key:"setMaxZoom",value:function(pe){this.map.setMaxZoom(pe)}},{key:"setMinZoom",value:function(pe){this.map.setMinZoom(pe)}},{key:"setMapStatus",value:function(pe){pe.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),pe.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),pe.dragEnable===!1&&this.map.dragPan.disable(),pe.dragEnable===!0&&this.map.dragPan.enable(),pe.rotateEnable===!1&&this.map.dragRotate.disable(),pe.rotateEnable===!0&&this.map.dragRotate.enable(),pe.keyboardEnable===!1&&this.map.keyboard.disable(),pe.keyboardEnable===!0&&this.map.keyboard.enable(),pe.zoomEnable===!1&&this.map.scrollZoom.disable(),pe.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(pe,Ne){this.map.flyTo({zoom:pe,center:Ne})}},{key:"setMapStyle",value:function(pe){this.map.setStyle(this.getMapStyle(pe))}},{key:"pixelToLngLat",value:function(pe){return this.map.unproject(pe)}},{key:"lngLatToPixel",value:function(pe){return this.map.project(pe)}},{key:"containerToLngLat",value:function(pe){return this.map.unproject(pe)}},{key:"lngLatToContainer",value:function(pe){return this.map.project(pe)}},{key:"lngLatToMercator",value:function(pe,Ne){var Re=window.mapboxgl.MercatorCoordinate.fromLngLat(pe,Ne),he=Re.x,se=he===void 0?0:he,J=Re.y,fe=J===void 0?0:J,me=Re.z,Le=me===void 0?0:me;return{x:se,y:fe,z:Le}}},{key:"getModelMatrix",value:function(pe,Ne,Re){var he=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],se=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},J=window.mapboxgl.MercatorCoordinate.fromLngLat(pe,Ne),fe=J.meterInMercatorCoordinateUnits(),me=j.mat4.create();return j.mat4.translate(me,me,j.vec3.fromValues(J.x-se.x,J.y-se.y,J.z||0-se.z)),j.mat4.scale(me,me,j.vec3.fromValues(fe*he[0],-fe*he[1],fe*he[2])),j.mat4.rotateX(me,me,Re[0]),j.mat4.rotateY(me,me,Re[1]),j.mat4.rotateZ(me,me,Re[2]),me}},{key:"init",value:function(){var ge=(0,w.default)(F.default.mark(function Ne(){var Re,he,se,J,fe,me,Le,C,X,de,Ae,De,Ge;return F.default.wrap(function(ct){for(;;)switch(ct.prev=ct.next){case 0:Re=this.config,he=Re.id,se=he===void 0?"map":he,J=Re.attributionControl,fe=J===void 0?!1:J,me=Re.style,Le=me===void 0?"light":me,C=Re.token,X=C===void 0?ie:C,de=Re.rotation,Ae=de===void 0?0:de,De=Re.mapInstance,Ge=(0,o.default)(Re,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new D.default,!De&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),X===ie&&Le!=="blank"&&!window.mapboxgl.accessToken&&!De&&console.warn(this.configService.getSceneWarninfo("MapToken")),!De&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=X),De?(this.map=De,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(se),this.map=new window.mapboxgl.Map(Z({container:this.$mapContainer,style:this.getMapStyle(Le),attributionControl:fe,bearing:Ae},Ge))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return ct.stop()}},Ne,this)}));function pe(){return ge.apply(this,arguments)}return pe}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(pe){for(var Ne,Re=arguments.length,he=new Array(Re>1?Re-1:0),se=1;se<Re;se++)he[se-1]=arguments[se];(Ne=this.eventEmitter).emit.apply(Ne,[pe].concat(he))}},{key:"once",value:function(pe){for(var Ne,Re=arguments.length,he=new Array(Re>1?Re-1:0),se=1;se<Re;se++)he[se-1]=arguments[se];(Ne=this.eventEmitter).once.apply(Ne,[pe].concat(he))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(pe){var Ne=this.map.getCanvas(),Re=pe==="jpg"?Ne==null?void 0:Ne.toDataURL("image/jpeg"):Ne==null?void 0:Ne.toDataURL("image/png");return Re}},{key:"onCameraChanged",value:function(pe){this.cameraChangedCallback=pe}},{key:"creatAmapContainer",value:function(pe){var Ne=pe;typeof pe=="string"&&(Ne=document.getElementById(pe));var Re=document.createElement("div");return Re.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,Re.id="l7_mapbox_div"+ae++,Ne.appendChild(Re),Re}},{key:"getMapStyle",value:function(pe){return typeof pe!="string"?pe:R.MapTheme[pe]?R.MapTheme[pe]:pe}}]),Me}(),B=(0,E.default)(z.prototype,"config",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V=(0,E.default)(z.prototype,"configService",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=(0,E.default)(z.prototype,"coordinateSystemService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=(0,E.default)(z.prototype,"eventEmitter",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z))||x);c.default=le},27277:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MapTheme=void 0;var n={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}};c.MapTheme=n},36290:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.toPaddingOptions=_;var F=i(n(59713));function o(P,L){var d=Object.keys(P);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(P);L&&(E=E.filter(function(g){return Object.getOwnPropertyDescriptor(P,g).enumerable})),d.push.apply(d,E)}return d}function w(P){for(var L=1;L<arguments.length;L++){var d=arguments[L]!=null?arguments[L]:{};L%2?o(Object(d),!0).forEach(function(E){(0,F.default)(P,E,d[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(d)):o(Object(d)).forEach(function(E){Object.defineProperty(P,E,Object.getOwnPropertyDescriptor(d,E))})}return P}function _(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},L={top:0,right:0,bottom:0,left:0};if(typeof P=="number")return{top:P,right:P,bottom:P,left:P};if(Array.isArray(P)){if(P.length===4)return{top:P[0],right:P[1],bottom:P[2],left:P[3]};if(P.length===2)return{top:P[0],right:P[1],bottom:P[0],left:P[1]}}return w(w({},L),P)}},71777:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Version=void 0;var n;c.Version=n,function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"}(n||(c.Version=n={}))},96784:function(Te,c,n){"use strict";n.d(c,{zP:function(){return Ii},JE:function(){return V},ns:function(){return hi}});var i=n(67294),F=(0,i.createContext)({});function o(){return(0,i.useContext)(F)}var w=n(87768);function _(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function P(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?_(Object(Ue),!0).forEach(function(ut){L(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):_(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function L(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function d(we,je){return j(we)||M(we,je)||g(we,je)||E()}function E(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g(we,je){if(!!we){if(typeof we=="string")return k(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return k(we,je)}}function k(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function M(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function j(we){if(Array.isArray(we))return we}var U=null,I=null,O=n(76971);function D(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function R(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?D(Object(Ue),!0).forEach(function(ut){y(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):D(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function y(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function v(we,je){return z(we)||x(we,je)||S(we,je)||h()}function h(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(we,je){if(!!we){if(typeof we=="string")return A(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return A(we,je)}}function A(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function x(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function z(we){if(Array.isArray(we))return we}var B=i.memo(function(we){var je=we.style,Ue=we.className,ut=we.map,Xt=we.option,Mr=we.onSceneLoaded,bn=(0,i.createRef)(),ei=(0,i.useState)(),Ci=v(ei,2),Xi=Ci[0],Fa=Ci[1];return(0,i.useEffect)(function(){var aa=new w.Scene(R(R({id:bn.current},Xt),{},{map:new O.Mapbox(ut)}));return aa.on("loaded",function(){Fa(aa),Mr&&Mr(aa)}),function(){aa.destroy()}},[]),(0,i.useEffect)(function(){Xi&&ut.style&&Xi.setMapStyle(ut.style)},[JSON.stringify(ut.style)]),(0,i.useEffect)(function(){Xi&&ut.zoom&&Xi.setZoom(ut.zoom)},[ut.zoom]),(0,i.useEffect)(function(){Xi&&ut.center&&Xi.setCenter(ut.center)},[JSON.stringify(ut.center)]),(0,i.useEffect)(function(){Xi&&ut.pitch!==void 0&&Xi.setPitch(ut.pitch||0)},[ut.pitch]),(0,i.useEffect)(function(){Xi&&ut.rotation&&Xi.setRotation(ut.rotation)},[ut.rotation]),i.createElement(F.Provider,{value:Xi},(0,i.createElement)("div",{ref:bn,style:je,className:Ue},Xi&&we.children))}),V=B;function Q(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function oe(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?Q(Object(Ue),!0).forEach(function(ut){re(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):Q(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function re(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function Z(we,je){return ie(we)||G(we,je)||H(we,je)||ee()}function ee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H(we,je){if(!!we){if(typeof we=="string")return ae(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return ae(we,je)}}function ae(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function G(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function ie(we){if(Array.isArray(we))return we}var le=null,Me=null;function ge(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function pe(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?ge(Object(Ue),!0).forEach(function(ut){Ne(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):ge(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function Ne(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function Re(we,je){return me(we)||fe(we,je)||se(we,je)||he()}function he(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function se(we,je){if(!!we){if(typeof we=="string")return J(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return J(we,je)}}function J(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function fe(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function me(we){if(Array.isArray(we))return we}var Le=null,C=null;function X(we,je){return $e(we)||Ge(we,je)||Ae(we,je)||de()}function de(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ae(we,je){if(!!we){if(typeof we=="string")return De(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return De(we,je)}}function De(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function Ge(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function $e(we){if(Array.isArray(we))return we}var ct=null,gt=null;function st(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function xe(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?st(Object(Ue),!0).forEach(function(ut){Mt(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):st(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function Mt(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function Ut(we,je){if(we==null)return{};var Ue=At(we,je),ut,Xt;if(Object.getOwnPropertySymbols){var Mr=Object.getOwnPropertySymbols(we);for(Xt=0;Xt<Mr.length;Xt++)ut=Mr[Xt],!(je.indexOf(ut)>=0)&&(!Object.prototype.propertyIsEnumerable.call(we,ut)||(Ue[ut]=we[ut]))}return Ue}function At(we,je){if(we==null)return{};var Ue={},ut=Object.keys(we),Xt,Mr;for(Mr=0;Mr<ut.length;Mr++)Xt=ut[Mr],!(je.indexOf(Xt)>=0)&&(Ue[Xt]=we[Xt]);return Ue}var nt=null,it=n(73935);function pt(we,je){return Ur(we)||Br(we,je)||Er(we,je)||Vt()}function Vt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Er(we,je){if(!!we){if(typeof we=="string")return mr(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return mr(we,je)}}function mr(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function Br(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function Ur(we){if(Array.isArray(we))return we}var Ar=i.useEffect,Nn=i.useState;function Rn(we){var je=we.className,Ue=we.style,ut=we.children,Xt=we.position,Mr=useSceneValue(),bn=Nn(function(){return document.createElement("div")}),ei=pt(bn,1),Ci=ei[0];return Ar(function(){var Xi=new Control({position:Xt});return Xi.onAdd=function(){if(je&&(Ci.className=je),Ue){var Fa=Object.keys(Ue).map(function(aa){return"".concat(aa,":").concat(Ue[aa])}).join(";");Ci.style.cssText=Fa}return Ci},Mr.addControl(Xi),function(){Mr.removeControl(Xi)}},[]),createPortal(ut,Ci)}var ci=(0,i.createContext)({});function Fi(){return useContext(ci)}var ji=i.useEffect,Si=i.memo(function(je){var Ue=je.layer,ut=je.active;return ji(function(){Ue.active(ut.option)},[JSON.stringify(ut)]),null}),xi=i.useEffect,Ee=i.memo(function(je){var Ue=je.layer,ut=je.animate;return xi(function(){Ue.animate(ut)},[JSON.stringify(ut)]),null}),ke=i.useEffect,ze=i.memo(function(je){var Ue=je.layer,ut=je.color;return ke(function(){ut.field?Ue.color(ut.field,ut.values):Ue.color(ut.values)},[ut.field,ut.scale,JSON.stringify(ut.values),JSON.stringify(ut.options)]),null}),Ke=i.useEffect,ot=i.memo(function(je){var Ue=je.layer,ut=je.filter;return Ke(function(){ut.field&&Ue.filter(ut.field,ut.values)},[ut.field,ut.values,JSON.stringify(ut.values),JSON.stringify(ut.options)]),null}),Rt=i.useEffect,Nt=i.memo(function(je){var Ue=je.layer,ut=je.scale;return Rt(function(){Ue.scale(ut.values)},[ut.values]),null}),Ye=i.useEffect,Et=i.memo(function(je){var Ue=je.layer,ut=je.select;return Ye(function(){Ue.select(ut.option)},[JSON.stringify(ut)]),null}),Zt=i.useEffect,Lr=i.memo(function(je){var Ue=je.layer,ut=je.shape;return Zt(function(){ut.field?Ue.shape(ut.field,ut.values):Ue.shape(ut.values)},[ut.field,JSON.stringify(ut.values),JSON.stringify(ut.options)]),null}),ir=i.useEffect,ur=i.memo(function(je){var Ue=je.layer,ut=je.size;return ir(function(){ut.field?Ue.size(ut.field,ut.values):Ue.size(ut.values)},[ut.field,ut.scale,JSON.stringify(ut.values),JSON.stringify(ut.options)]),null}),Or=["data"];function nn(we,je){if(we==null)return{};var Ue=Hr(we,je),ut,Xt;if(Object.getOwnPropertySymbols){var Mr=Object.getOwnPropertySymbols(we);for(Xt=0;Xt<Mr.length;Xt++)ut=Mr[Xt],!(je.indexOf(ut)>=0)&&(!Object.prototype.propertyIsEnumerable.call(we,ut)||(Ue[ut]=we[ut]))}return Ue}function Hr(we,je){if(we==null)return{};var Ue={},ut=Object.keys(we),Xt,Mr;for(Mr=0;Mr<ut.length;Mr++)Xt=ut[Mr],!(je.indexOf(Xt)>=0)&&(Ue[Xt]=we[Xt]);return Ue}var gr=i.useEffect,vn=i.memo(function(je){var Ue=je.layer,ut=je.source,Xt=ut.data,Mr=nn(ut,Or);return gr(function(){Ue.inited?Ue.setData(Xt,Mr):Ue.source(Xt,Mr),Mr.autoFit&&Ue.fitBounds(Mr&&Mr.fitBoundsOptions)},[Xt,JSON.stringify(Mr)]),null}),an=i.useEffect,sn=i.memo(function(je){var Ue=je.layer,ut=je.style;return an(function(){Ue.style(ut)},Object.keys(ut).map(function(Xt){return ut[Xt]})),null});function Ei(we,je){return Li(we)||mi(we,je)||ni(we,je)||fn()}function fn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ni(we,je){if(!!we){if(typeof we=="string")return Ui(we,je);var Ue=Object.prototype.toString.call(we).slice(8,-1);if(Ue==="Object"&&we.constructor&&(Ue=we.constructor.name),Ue==="Map"||Ue==="Set")return Array.from(we);if(Ue==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ue))return Ui(we,je)}}function Ui(we,je){(je==null||je>we.length)&&(je=we.length);for(var Ue=0,ut=new Array(je);Ue<je;Ue++)ut[Ue]=we[Ue];return ut}function mi(we,je){var Ue=we==null?null:typeof Symbol!="undefined"&&we[Symbol.iterator]||we["@@iterator"];if(Ue!=null){var ut=[],Xt=!0,Mr=!1,bn,ei;try{for(Ue=Ue.call(we);!(Xt=(bn=Ue.next()).done)&&(ut.push(bn.value),!(je&&ut.length===je));Xt=!0);}catch(Ci){Mr=!0,ei=Ci}finally{try{!Xt&&Ue.return!=null&&Ue.return()}finally{if(Mr)throw ei}}return ut}}function Li(we){if(Array.isArray(we))return we}var ui=i.useEffect,fi=i.useState;function Wi(we,je){var Ue=je.source,ut=je.color,Xt=je.shape,Mr=je.style,bn=je.size,ei=je.scale,Ci=je.active,Xi=je.select,Fa=je.filter,aa=je.animate,Oi=je.options,vs=je.onLayerLoaded,Yi=o(),m=fi(function(){var ne;switch(we){case"polygonLayer":ne=new w.PolygonLayer(Oi);break;case"lineLayer":ne=new w.LineLayer(Oi);break;case"pointLayer":ne=new w.PointLayer(Oi);break;case"heatmapLayer":ne=new w.HeatmapLayer(Oi);break;case"rasterLayer":ne=new w.RasterLayer(Oi);break;case"imageLayer":ne=new w.ImageLayer(Oi);break;case"citybuildingLayer":ne=new w.CityBuildingLayer(Oi);break;default:ne=new w.PolygonLayer(Oi)}return ne.on("inited",function(){vs&&vs(ne,Yi)}),ne}),Y=Ei(m,1),ve=Y[0];return ui(function(){return Yi.addLayer(ve),function(){Yi.removeLayer(ve)}},[]),ui(function(){ve.inited&&Oi&&ve.updateLayerConfig(Oi)},[Oi==null?void 0:Oi.minZoom,Oi==null?void 0:Oi.maxZoom,Oi==null?void 0:Oi.visible]),ui(function(){ve.inited&&(Oi==null?void 0:Oi.zIndex)&&ve.setIndex(Oi.zIndex)},[Oi==null?void 0:Oi.zIndex]),ui(function(){ve.inited&&(Oi==null?void 0:Oi.blend)&&ve.setBlend(Oi.blend)},[Oi==null?void 0:Oi.blend]),ui(function(){Yi.render()}),i.createElement(ci.Provider,{value:ve},i.createElement(vn,{layer:ve,source:Ue}),ei&&i.createElement(Nt,{layer:ve,scale:ei}),ut&&i.createElement(ze,{layer:ve,color:ut}),bn&&i.createElement(ur,{layer:ve,size:bn}),Xt&&i.createElement(Lr,{layer:ve,shape:Xt}),Mr&&i.createElement(sn,{layer:ve,style:Mr}),Ci&&i.createElement(Si,{layer:ve,active:Ci}),Xi&&i.createElement(Et,{layer:ve,select:Xi}),Fa&&i.createElement(ot,{layer:ve,filter:Fa}),aa&&i.createElement(Ee,{layer:ve,animate:aa}),je.children)}var va=null,Pi=null,hi=i.memo(function(je){return Wi("pointLayer",je)}),Ii=i.memo(function(je){return Wi("heatmapLayer",je)}),La=null,ls=null,Ta=null,ma=i.useEffect,Qo=null,Es=null;function sa(we){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?sa=function(Ue){return typeof Ue}:sa=function(Ue){return Ue&&typeof Symbol=="function"&&Ue.constructor===Symbol&&Ue!==Symbol.prototype?"symbol":typeof Ue},sa(we)}function to(we,je){var Ue=Object.keys(we);if(Object.getOwnPropertySymbols){var ut=Object.getOwnPropertySymbols(we);je&&(ut=ut.filter(function(Xt){return Object.getOwnPropertyDescriptor(we,Xt).enumerable})),Ue.push.apply(Ue,ut)}return Ue}function _a(we){for(var je=1;je<arguments.length;je++){var Ue=arguments[je]!=null?arguments[je]:{};je%2?to(Object(Ue),!0).forEach(function(ut){wa(we,ut,Ue[ut])}):Object.getOwnPropertyDescriptors?Object.defineProperties(we,Object.getOwnPropertyDescriptors(Ue)):to(Object(Ue)).forEach(function(ut){Object.defineProperty(we,ut,Object.getOwnPropertyDescriptor(Ue,ut))})}return we}function wa(we,je,Ue){return je in we?Object.defineProperty(we,je,{value:Ue,enumerable:!0,configurable:!0,writable:!0}):we[je]=Ue,we}function $a(we,je){if(!(we instanceof je))throw new TypeError("Cannot call a class as a function")}function ia(we,je){for(var Ue=0;Ue<je.length;Ue++){var ut=je[Ue];ut.enumerable=ut.enumerable||!1,ut.configurable=!0,"value"in ut&&(ut.writable=!0),Object.defineProperty(we,ut.key,ut)}}function Ja(we,je,Ue){return je&&ia(we.prototype,je),Ue&&ia(we,Ue),we}function ro(we,je){if(typeof je!="function"&&je!==null)throw new TypeError("Super expression must either be null or a function");we.prototype=Object.create(je&&je.prototype,{constructor:{value:we,writable:!0,configurable:!0}}),je&&Xa(we,je)}function Xa(we,je){return Xa=Object.setPrototypeOf||function(ut,Xt){return ut.__proto__=Xt,ut},Xa(we,je)}function no(we){var je=ja();return function(){var ut=Qa(we),Xt;if(je){var Mr=Qa(this).constructor;Xt=Reflect.construct(ut,arguments,Mr)}else Xt=ut.apply(this,arguments);return go(this,Xt)}}function go(we,je){return je&&(sa(je)==="object"||typeof je=="function")?je:fa(we)}function fa(we){if(we===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return we}function ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(we){return!1}}function Qa(we){return Qa=Object.setPrototypeOf?Object.getPrototypeOf:function(Ue){return Ue.__proto__||Object.getPrototypeOf(Ue)},Qa(we)}var Ua=function(we){ro(Ue,we);var je=no(Ue);function Ue(ut){var Xt;return $a(this,Ue),Xt=je.call(this,ut),Xt.el=void 0,Xt.scene=void 0,Xt.popup=void 0,Xt.el=document.createElement("div"),Xt}return Ja(Ue,[{key:"componentDidMount",value:function(){var Xt,Mr=this.props,bn=Mr.lnglat,ei=Mr.children,Ci=Mr.option,Xi=Mr.lngLat,Fa=new w.Popup(_a(_a({},Ci),{},{stopPropagation:(Xt=this.props.option)===null||Xt===void 0?void 0:Xt.stopPropagation}));bn&&Fa.setLnglat(bn),Xi&&Fa.setLnglat(Xi),ei&&Fa.setDOMContent(this.el),this.popup=Fa,this.scene.addPopup(Fa)}},{key:"componentDidUpdate",value:function(Xt){var Mr,bn,ei,Ci,Xi,Fa,aa=Array.isArray(Xt.lnglat)?Xt.lnglat:[Xt==null||(Mr=Xt.lnglat)===null||Mr===void 0?void 0:Mr.lng,Xt==null||(bn=Xt.lnglat)===null||bn===void 0?void 0:bn.lat],Oi=Array.isArray(this.props.lnglat)?this.props.lnglat:[(ei=this.props)===null||ei===void 0||(Ci=ei.lnglat)===null||Ci===void 0?void 0:Ci.lng,(Xi=this.props)===null||Xi===void 0||(Fa=Xi.lnglat)===null||Fa===void 0?void 0:Fa.lat],vs=aa.toString()!==Oi.toString();if(vs){var Yi;this.popup.remove(),this.popup=new w.Popup(_a(_a({},this.props.option),{},{stopPropagation:(Yi=this.props.option)===null||Yi===void 0?void 0:Yi.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var Xt=this;return i.createElement(F.Consumer,{},function(Mr){return Mr&&(Xt.scene=Mr),(0,it.createPortal)(Xt.props.children,Xt.el)})}}]),Ue}(i.PureComponent);function Ve(we){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ve=function(Ue){return typeof Ue}:Ve=function(Ue){return Ue&&typeof Symbol=="function"&&Ue.constructor===Symbol&&Ue!==Symbol.prototype?"symbol":typeof Ue},Ve(we)}function rt(we,je){if(!(we instanceof je))throw new TypeError("Cannot call a class as a function")}function wt(we,je){for(var Ue=0;Ue<je.length;Ue++){var ut=je[Ue];ut.enumerable=ut.enumerable||!1,ut.configurable=!0,"value"in ut&&(ut.writable=!0),Object.defineProperty(we,ut.key,ut)}}function lr(we,je,Ue){return je&&wt(we.prototype,je),Ue&&wt(we,Ue),we}function Zr(we,je){if(typeof je!="function"&&je!==null)throw new TypeError("Super expression must either be null or a function");we.prototype=Object.create(je&&je.prototype,{constructor:{value:we,writable:!0,configurable:!0}}),je&&Un(we,je)}function Un(we,je){return Un=Object.setPrototypeOf||function(ut,Xt){return ut.__proto__=Xt,ut},Un(we,je)}function oi(we){var je=tt();return function(){var ut=yt(we),Xt;if(je){var Mr=yt(this).constructor;Xt=Reflect.construct(ut,arguments,Mr)}else Xt=ut.apply(this,arguments);return te(this,Xt)}}function te(we,je){return je&&(Ve(je)==="object"||typeof je=="function")?je:be(we)}function be(we){if(we===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return we}function tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(we){return!1}}function yt(we){return yt=Object.setPrototypeOf?Object.getPrototypeOf:function(Ue){return Ue.__proto__||Object.getPrototypeOf(Ue)},yt(we)}var Bt=function(we){Zr(Ue,we);var je=oi(Ue);function Ue(ut){var Xt;return rt(this,Ue),Xt=je.call(this,ut),Xt.el=void 0,Xt.scene=void 0,Xt.marker=void 0,Xt.el=document.createElement("div"),Xt}return lr(Ue,[{key:"componentDidMount",value:function(){var Xt=this.props,Mr=Xt.lnglat,bn=Xt.children,ei=Xt.option,Ci=Xt.onMarkerLoaded,Xi=new w.Marker(ei);Mr&&Xi.setLnglat(Mr),bn&&Xi.setElement(this.el),this.marker=Xi,Ci&&Ci(Xi),this.scene.addMarker(Xi)}},{key:"componentDidUpdate",value:function(Xt){var Mr,bn=(Xt==null?void 0:Xt.lnglat.toString())!==((Mr=this.props)===null||Mr===void 0?void 0:Mr.lnglat.toString());bn&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var Xt=this;return i.createElement(F.Consumer,{},function(Mr){return Mr&&(Xt.scene=Mr),(0,it.createPortal)(Xt.props.children,Xt.el)})}}]),Ue}(i.PureComponent),qt=i.useEffect,Wt=null,or=null,ar=i.useEffect,kr=null},59423:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ReglRendererService",{enumerable:!0,get:function(){return F.default}});var F=i(n(16553))},91278:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d){(0,F.default)(this,P),(0,w.default)(this,"attribute",void 0),(0,w.default)(this,"buffer",void 0);var E=d.buffer,g=d.offset,k=d.stride,M=d.normalized,j=d.size,U=d.divisor;this.buffer=E,this.attribute={buffer:E.get(),offset:g||0,stride:k||0,normalized:M||!1,divisor:U||0},j&&(this.attribute.size=j)}return(0,o.default)(P,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(d){this.buffer.subData(d)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),P}();c.default=_},64807:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(5602),P=n(97774),L=function(){function d(E,g){(0,F.default)(this,d),(0,w.default)(this,"buffer",void 0);var k=g.data,M=g.usage,j=g.type;this.buffer=E.buffer({data:k,usage:P.usageMap[M||_.gl.STATIC_DRAW],type:P.dataTypeMap[j||_.gl.UNSIGNED_BYTE]})}return(0,o.default)(d,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(g){var k=g.data,M=g.offset;this.buffer.subdata(k,M)}}]),d}();c.default=L},43381:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(5602),P=n(97774),L=function(){function d(E,g){(0,F.default)(this,d),(0,w.default)(this,"elements",void 0);var k=g.data,M=g.usage,j=g.type,U=g.count;this.elements=E.elements({data:k,usage:P.usageMap[M||_.gl.STATIC_DRAW],type:P.dataTypeMap[j||_.gl.UNSIGNED_BYTE],count:U})}return(0,o.default)(d,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(g){var k=g.data;this.elements.subdata(k)}},{key:"destroy",value:function(){}}]),d}();c.default=L},17501:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(L,d){(0,F.default)(this,P),(0,w.default)(this,"framebuffer",void 0);var E=d.width,g=d.height,k=d.color,M=d.colors,j=d.depth,U=d.stencil,I={width:E,height:g};Array.isArray(M)&&(I.colors=M.map(function(O){return O.get()})),k&&typeof k!="boolean"&&(I.color=k.get()),this.framebuffer=L.framebuffer(I)}return(0,o.default)(P,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(d){var E=d.width,g=d.height;this.framebuffer.resize(E,g)}}]),P}();c.default=_},82311:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(50008)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=i(n(36719)),L=i(n(68630)),d=n(5602),E=n(97774);function g(j,U){var I=Object.keys(j);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(j);U&&(O=O.filter(function(D){return Object.getOwnPropertyDescriptor(j,D).enumerable})),I.push.apply(I,O)}return I}function k(j){for(var U=1;U<arguments.length;U++){var I=arguments[U]!=null?arguments[U]:{};U%2?g(Object(I),!0).forEach(function(O){(0,_.default)(j,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(I)):g(Object(I)).forEach(function(O){Object.defineProperty(j,O,Object.getOwnPropertyDescriptor(I,O))})}return j}var M=function(){function j(U,I){(0,o.default)(this,j),(0,_.default)(this,"reGl",void 0),(0,_.default)(this,"destroyed",!1),(0,_.default)(this,"drawCommand",void 0),(0,_.default)(this,"drawParams",void 0),(0,_.default)(this,"options",void 0),(0,_.default)(this,"uniforms",{}),this.reGl=U;var O=I.vs,D=I.fs,R=I.attributes,y=I.uniforms,v=I.primitive,h=I.count,S=I.elements,A=I.depth,x=I.blend,z=I.stencil,B=I.cull,V=I.instances,Q={};this.options=I,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(Z){Q[Z]=U.prop(Z)}));var oe={};Object.keys(R).forEach(function(Z){oe[Z]=R[Z].get()});var re={attributes:oe,frag:D,uniforms:Q,vert:O,primitive:E.primitiveMap[v===void 0?d.gl.TRIANGLES:v]};V&&(re.instances=V),h&&(re.count=h),S&&(re.elements=S.get()),this.initDepthDrawParams({depth:A},re),this.initBlendDrawParams({blend:x},re),this.initStencilDrawParams({stencil:z},re),this.initCullDrawParams({cull:B},re),this.drawCommand=U(re),this.drawParams=re}return(0,w.default)(j,[{key:"addUniforms",value:function(I){this.uniforms=k(k({},this.uniforms),this.extractUniforms(I))}},{key:"draw",value:function(I){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var O=k(k({},this.uniforms),this.extractUniforms(I.uniforms||{})),D={};Object.keys(O).forEach(function(R){var y=(0,F.default)(O[R]);y==="boolean"||y==="number"||Array.isArray(O[R])||O[R].BYTES_PER_ELEMENT?D[R]=O[R]:D[R]=O[R].get()}),this.drawCommand(D)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(I){I.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(I,O){var D=I.depth;D&&(O.depth={enable:D.enable===void 0?!0:!!D.enable,mask:D.mask===void 0?!0:!!D.mask,func:E.depthFuncMap[D.func||d.gl.LESS],range:D.range||[0,1]})}},{key:"initBlendDrawParams",value:function(I,O){var D=I.blend;if(D){var R=D.enable,y=D.func,v=D.equation,h=D.color,S=h===void 0?[0,0,0,0]:h;O.blend={enable:!!R,func:{srcRGB:E.blendFuncMap[y&&y.srcRGB||d.gl.SRC_ALPHA],srcAlpha:E.blendFuncMap[y&&y.srcAlpha||d.gl.SRC_ALPHA],dstRGB:E.blendFuncMap[y&&y.dstRGB||d.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:E.blendFuncMap[y&&y.dstAlpha||d.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:E.blendEquationMap[v&&v.rgb||d.gl.FUNC_ADD],alpha:E.blendEquationMap[v&&v.alpha||d.gl.FUNC_ADD]},color:S}}}},{key:"initStencilDrawParams",value:function(I,O){var D=I.stencil;if(D){var R=D.enable,y=D.mask,v=y===void 0?-1:y,h=D.func,S=h===void 0?{cmp:d.gl.ALWAYS,ref:0,mask:-1}:h,A=D.opFront,x=A===void 0?{fail:d.gl.KEEP,zfail:d.gl.KEEP,zpass:d.gl.KEEP}:A,z=D.opBack,B=z===void 0?{fail:d.gl.KEEP,zfail:d.gl.KEEP,zpass:d.gl.KEEP}:z;O.stencil={enable:!!R,mask:v,func:k(k({},S),{},{cmp:E.stencilFuncMap[S.cmp]}),opFront:{fail:E.stencilOpMap[x.fail],zfail:E.stencilOpMap[x.zfail],zpass:E.stencilOpMap[x.zpass]},opBack:{fail:E.stencilOpMap[B.fail],zfail:E.stencilOpMap[B.zfail],zpass:E.stencilOpMap[B.zpass]}}}}},{key:"initCullDrawParams",value:function(I,O){var D=I.cull;if(D){var R=D.enable,y=D.face,v=y===void 0?d.gl.BACK:y;O.cull={enable:!!R,face:E.cullFaceMap[v]}}}},{key:"extractUniforms",value:function(I){var O=this,D={};return Object.keys(I).forEach(function(R){O.extractUniformsRecursively(R,I[R],D,"")}),D}},{key:"extractUniformsRecursively",value:function(I,O,D,R){var y=this;if(O===null||typeof O=="number"||typeof O=="boolean"||Array.isArray(O)&&typeof O[0]=="number"||(0,P.default)(O)||O===""||"resize"in O){D["".concat(R&&R+".").concat(I)]=O;return}(0,L.default)(O)&&Object.keys(O).forEach(function(v){y.extractUniformsRecursively(v,O[v],D,"".concat(R&&R+".").concat(I))}),Array.isArray(O)&&O.forEach(function(v,h){Object.keys(v).forEach(function(S){y.extractUniformsRecursively(S,v[S],D,"".concat(R&&R+".").concat(I,"[").concat(h,"]"))})})}}]),j}();c.default=M},84035:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=n(5602),P=n(97774),L=function(){function d(E,g){(0,F.default)(this,d),(0,w.default)(this,"texture",void 0),(0,w.default)(this,"width",void 0),(0,w.default)(this,"height",void 0);var k=g.data,M=g.type,j=M===void 0?_.gl.UNSIGNED_BYTE:M,U=g.width,I=g.height,O=g.flipY,D=O===void 0?!1:O,R=g.format,y=R===void 0?_.gl.RGBA:R,v=g.mipmap,h=v===void 0?!1:v,S=g.wrapS,A=S===void 0?_.gl.CLAMP_TO_EDGE:S,x=g.wrapT,z=x===void 0?_.gl.CLAMP_TO_EDGE:x,B=g.aniso,V=B===void 0?0:B,Q=g.alignment,oe=Q===void 0?1:Q,re=g.premultiplyAlpha,Z=re===void 0?!1:re,ee=g.mag,H=ee===void 0?_.gl.NEAREST:ee,ae=g.min,G=ae===void 0?_.gl.NEAREST:ae,ie=g.colorSpace,le=ie===void 0?_.gl.BROWSER_DEFAULT_WEBGL:ie;this.width=U,this.height=I;var Me={width:U,height:I,type:P.dataTypeMap[j],format:P.formatMap[y],wrapS:P.wrapModeMap[A],wrapT:P.wrapModeMap[z],mag:P.filterMap[H],min:P.filterMap[G],alignment:oe,flipY:D,colorSpace:P.colorSpaceMap[le],premultiplyAlpha:Z,aniso:V};k&&(Me.data=k),typeof h=="number"?Me.mipmap=P.mipmapMap[h]:typeof h=="boolean"&&(Me.mipmap=h),this.texture=E.texture(Me)}return(0,o.default)(d,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(g)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(g){var k=g.width,M=g.height;this.texture.resize(k,M),this.width=k,this.height=M}},{key:"destroy",value:function(){this.texture.destroy()}}]),d}();c.default=L},97774:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.cullFaceMap=c.stencilOpMap=c.stencilFuncMap=c.blendFuncMap=c.blendEquationMap=c.depthFuncMap=c.colorSpaceMap=c.wrapModeMap=c.filterMap=c.mipmapMap=c.formatMap=c.dataTypeMap=c.usageMap=c.primitiveMap=void 0;var F=i(n(59713)),o=n(5602),w,_,P,L,d,E,g,k,M,j,U,I,O,D,R=(w={},(0,F.default)(w,o.gl.POINTS,"points"),(0,F.default)(w,o.gl.LINES,"lines"),(0,F.default)(w,o.gl.LINE_LOOP,"line loop"),(0,F.default)(w,o.gl.LINE_STRIP,"line strip"),(0,F.default)(w,o.gl.TRIANGLES,"triangles"),(0,F.default)(w,o.gl.TRIANGLE_FAN,"triangle fan"),(0,F.default)(w,o.gl.TRIANGLE_STRIP,"triangle strip"),w);c.primitiveMap=R;var y=(_={},(0,F.default)(_,o.gl.STATIC_DRAW,"static"),(0,F.default)(_,o.gl.DYNAMIC_DRAW,"dynamic"),(0,F.default)(_,o.gl.STREAM_DRAW,"stream"),_);c.usageMap=y;var v=(P={},(0,F.default)(P,o.gl.BYTE,"int8"),(0,F.default)(P,o.gl.UNSIGNED_INT,"int16"),(0,F.default)(P,o.gl.INT,"int32"),(0,F.default)(P,o.gl.UNSIGNED_BYTE,"uint8"),(0,F.default)(P,o.gl.UNSIGNED_SHORT,"uint16"),(0,F.default)(P,o.gl.UNSIGNED_INT,"uint32"),(0,F.default)(P,o.gl.FLOAT,"float"),P);c.dataTypeMap=v;var h=(L={},(0,F.default)(L,o.gl.ALPHA,"alpha"),(0,F.default)(L,o.gl.LUMINANCE,"luminance"),(0,F.default)(L,o.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,F.default)(L,o.gl.RGB,"rgb"),(0,F.default)(L,o.gl.RGBA,"rgba"),(0,F.default)(L,o.gl.RGBA4,"rgba4"),(0,F.default)(L,o.gl.RGB5_A1,"rgb5 a1"),(0,F.default)(L,o.gl.RGB565,"rgb565"),(0,F.default)(L,o.gl.DEPTH_COMPONENT,"depth"),(0,F.default)(L,o.gl.DEPTH_STENCIL,"depth stencil"),L);c.formatMap=h;var S=(d={},(0,F.default)(d,o.gl.DONT_CARE,"dont care"),(0,F.default)(d,o.gl.NICEST,"nice"),(0,F.default)(d,o.gl.FASTEST,"fast"),d);c.mipmapMap=S;var A=(E={},(0,F.default)(E,o.gl.NEAREST,"nearest"),(0,F.default)(E,o.gl.LINEAR,"linear"),(0,F.default)(E,o.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.default)(E,o.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.default)(E,o.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.default)(E,o.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),E);c.filterMap=A;var x=(g={},(0,F.default)(g,o.gl.REPEAT,"repeat"),(0,F.default)(g,o.gl.CLAMP_TO_EDGE,"clamp"),(0,F.default)(g,o.gl.MIRRORED_REPEAT,"mirror"),g);c.wrapModeMap=x;var z=(k={},(0,F.default)(k,o.gl.NONE,"none"),(0,F.default)(k,o.gl.BROWSER_DEFAULT_WEBGL,"browser"),k);c.colorSpaceMap=z;var B=(M={},(0,F.default)(M,o.gl.NEVER,"never"),(0,F.default)(M,o.gl.ALWAYS,"always"),(0,F.default)(M,o.gl.LESS,"less"),(0,F.default)(M,o.gl.LEQUAL,"lequal"),(0,F.default)(M,o.gl.GREATER,"greater"),(0,F.default)(M,o.gl.GEQUAL,"gequal"),(0,F.default)(M,o.gl.EQUAL,"equal"),(0,F.default)(M,o.gl.NOTEQUAL,"notequal"),M);c.depthFuncMap=B;var V=(j={},(0,F.default)(j,o.gl.FUNC_ADD,"add"),(0,F.default)(j,o.gl.MIN_EXT,"min"),(0,F.default)(j,o.gl.MAX_EXT,"max"),(0,F.default)(j,o.gl.FUNC_SUBTRACT,"subtract"),(0,F.default)(j,o.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),j);c.blendEquationMap=V;var Q=(U={},(0,F.default)(U,o.gl.ZERO,"zero"),(0,F.default)(U,o.gl.ONE,"one"),(0,F.default)(U,o.gl.SRC_COLOR,"src color"),(0,F.default)(U,o.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.default)(U,o.gl.SRC_ALPHA,"src alpha"),(0,F.default)(U,o.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.default)(U,o.gl.DST_COLOR,"dst color"),(0,F.default)(U,o.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.default)(U,o.gl.DST_ALPHA,"dst alpha"),(0,F.default)(U,o.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.default)(U,o.gl.CONSTANT_COLOR,"constant color"),(0,F.default)(U,o.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.default)(U,o.gl.CONSTANT_ALPHA,"constant alpha"),(0,F.default)(U,o.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.default)(U,o.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),U);c.blendFuncMap=Q;var oe=(I={},(0,F.default)(I,o.gl.NEVER,"never"),(0,F.default)(I,o.gl.ALWAYS,"always"),(0,F.default)(I,o.gl.LESS,"less"),(0,F.default)(I,o.gl.LEQUAL,"lequal"),(0,F.default)(I,o.gl.GREATER,"greater"),(0,F.default)(I,o.gl.GEQUAL,"gequal"),(0,F.default)(I,o.gl.EQUAL,"equal"),(0,F.default)(I,o.gl.NOTEQUAL,"notequal"),I);c.stencilFuncMap=oe;var re=(O={},(0,F.default)(O,o.gl.ZERO,"zero"),(0,F.default)(O,o.gl.KEEP,"keep"),(0,F.default)(O,o.gl.REPLACE,"replace"),(0,F.default)(O,o.gl.INVERT,"invert"),(0,F.default)(O,o.gl.INCR,"increment"),(0,F.default)(O,o.gl.DECR,"decrement"),(0,F.default)(O,o.gl.INCR_WRAP,"increment wrap"),(0,F.default)(O,o.gl.DECR_WRAP,"decrement wrap"),O);c.stencilOpMap=re;var Z=(D={},(0,F.default)(D,o.gl.FRONT,"front"),(0,F.default)(D,o.gl.BACK,"back"),D);c.cullFaceMap=Z},16553:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(87757)),o=i(n(48926)),w=i(n(34575)),_=i(n(93913)),P=i(n(59713)),L=n(86700),d=i(n(88307));n(28660);var E=i(n(91278)),g=i(n(64807)),k=i(n(43381)),M=i(n(17501)),j=i(n(82311)),U=i(n(84035)),I,O,D=(I=(0,L.injectable)(),I(O=function(){function R(){var y=this;(0,w.default)(this,R),(0,P.default)(this,"extensionObject",void 0),(0,P.default)(this,"gl",void 0),(0,P.default)(this,"$container",void 0),(0,P.default)(this,"canvas",void 0),(0,P.default)(this,"width",void 0),(0,P.default)(this,"height",void 0),(0,P.default)(this,"isDirty",void 0),(0,P.default)(this,"createModel",function(v){return new j.default(y.gl,v)}),(0,P.default)(this,"createAttribute",function(v){return new E.default(y.gl,v)}),(0,P.default)(this,"createBuffer",function(v){return new g.default(y.gl,v)}),(0,P.default)(this,"createElements",function(v){return new k.default(y.gl,v)}),(0,P.default)(this,"createTexture2D",function(v){return new U.default(y.gl,v)}),(0,P.default)(this,"createFramebuffer",function(v){return new M.default(y.gl,v)}),(0,P.default)(this,"useFramebuffer",function(v,h){y.gl({framebuffer:v?v.get():null})(h)}),(0,P.default)(this,"clear",function(v){var h=v.color,S=v.depth,A=v.stencil,x=v.framebuffer,z=x===void 0?null:x,B={color:h,depth:S,stencil:A};B.framebuffer=z===null?z:z.get(),y.gl.clear(B)}),(0,P.default)(this,"viewport",function(v){var h=v.x,S=v.y,A=v.width,x=v.height;y.gl._gl.viewport(h,S,A,x),y.width=A,y.height=x,y.gl._refresh()}),(0,P.default)(this,"readPixels",function(v){var h=v.framebuffer,S=v.x,A=v.y,x=v.width,z=v.height,B={x:S,y:A,width:x,height:z};return h&&(B.framebuffer=h.get()),y.gl.read(B)}),(0,P.default)(this,"getViewportSize",function(){return{width:y.gl._gl.drawingBufferWidth,height:y.gl._gl.drawingBufferHeight}}),(0,P.default)(this,"getContainer",function(){var v;return(v=y.canvas)===null||v===void 0?void 0:v.parentElement}),(0,P.default)(this,"getCanvas",function(){return y.canvas}),(0,P.default)(this,"getGLContext",function(){return y.gl._gl}),(0,P.default)(this,"destroy",function(){y.gl.destroy()})}return(0,_.default)(R,[{key:"init",value:function(){var y=(0,o.default)(F.default.mark(function h(S,A){var x=this;return F.default.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return this.canvas=S,B.next=3,new Promise(function(V,Q){(0,d.default)({canvas:x.canvas,attributes:{alpha:!0,antialias:A.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:A.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(re,Z){(re||!Z)&&Q(re),V(Z)}})});case 3:this.gl=B.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return B.stop()}},h,this)}));function v(h,S){return y.apply(this,arguments)}return v}()},{key:"testExtension",value:function(v){return!!this.getGLContext().getExtension(v)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var v=this.getGLContext();v.disable(v.CULL_FACE)}},{key:"setDirty",value:function(v){this.isDirty=v}},{key:"getDirty",value:function(){return this.isDirty}}]),R}())||O);c.default=D},17365:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.Scene=void 0;var F=i(n(63038)),o=i(n(34575)),w=i(n(93913)),_=i(n(59713)),P=n(58722),L=n(5602),d=n(59423),E=n(82887);function g(j,U){var I=Object.keys(j);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(j);U&&(O=O.filter(function(D){return Object.getOwnPropertyDescriptor(j,D).enumerable})),I.push.apply(I,O)}return I}function k(j){for(var U=1;U<arguments.length;U++){var I=arguments[U]!=null?arguments[U]:{};U%2?g(Object(I),!0).forEach(function(O){(0,_.default)(j,O,I[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(I)):g(Object(I)).forEach(function(O){Object.defineProperty(j,O,Object.getOwnPropertyDescriptor(I,O))})}return j}var M=function(){function j(U){(0,o.default)(this,j),(0,_.default)(this,"sceneService",void 0),(0,_.default)(this,"mapService",void 0),(0,_.default)(this,"controlService",void 0),(0,_.default)(this,"layerService",void 0),(0,_.default)(this,"iconService",void 0),(0,_.default)(this,"markerService",void 0),(0,_.default)(this,"popupService",void 0),(0,_.default)(this,"fontService",void 0),(0,_.default)(this,"interactionService",void 0),(0,_.default)(this,"container",void 0);var I=U.id,O=U.map,D=(0,L.createSceneContainer)();this.container=D,O.setContainer(D,I),D.bind(L.TYPES.IRendererService).to(d.ReglRendererService).inSingletonScope(),this.sceneService=D.get(L.TYPES.ISceneService),this.mapService=D.get(L.TYPES.IMapService),this.iconService=D.get(L.TYPES.IIconService),this.fontService=D.get(L.TYPES.IFontService),this.controlService=D.get(L.TYPES.IControlService),this.layerService=D.get(L.TYPES.ILayerService),this.markerService=D.get(L.TYPES.IMarkerService),this.interactionService=D.get(L.TYPES.IInteractionService),this.popupService=D.get(L.TYPES.IPopupService),this.initComponent(I),this.sceneService.init(U),this.initControl()}return(0,w.default)(j,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(I){return this.sceneService.exportPng(I)}},{key:"exportMap",value:function(I){return this.sceneService.exportPng(I)}},{key:"registerRenderService",value:function(I){var O=this;if(this.sceneService.loaded){var D=new I(this);D.init()}else this.on("loaded",function(){var R=new I(O);R.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(I){var O=(0,L.createLayerContainer)(this.container);I.setContainer(O),this.sceneService.addLayer(I)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(I){return this.layerService.getLayer(I)}},{key:"getLayerByName",value:function(I){return this.layerService.getLayerByName(I)}},{key:"removeLayer",value:function(I){this.layerService.remove(I)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(I,O){this.fontService.addIconFont(I,O)}},{key:"addIconFonts",value:function(I){var O=this;I.forEach(function(D){var R=(0,F.default)(D,2),y=R[0],v=R[1];O.fontService.addIconFont(y,v)})}},{key:"addFontFace",value:function(I,O){this.sceneService.addFontFace(I,O)}},{key:"addImage",value:function(I,O){this.iconService.addImage(I,O)}},{key:"hasImage",value:function(I){return this.iconService.hasImage(I)}},{key:"removeImage",value:function(I){this.iconService.removeImage(I)}},{key:"addIconFontGlyphs",value:function(I,O){this.fontService.addIconGlyphs(O)}},{key:"addControl",value:function(I){this.controlService.addControl(I,this.container)}},{key:"removeControl",value:function(I){this.controlService.removeControl(I)}},{key:"getControlByName",value:function(I){return this.controlService.getControlByName(I)}},{key:"addMarker",value:function(I){this.markerService.addMarker(I)}},{key:"addMarkerLayer",value:function(I){this.markerService.addMarkerLayer(I)}},{key:"removeMarkerLayer",value:function(I){this.markerService.removeMarkerLayer(I)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(I){this.popupService.addPopup(I)}},{key:"on",value:function(I,O){L.SceneEventList.indexOf(I)===-1?this.mapService.on(I,O):this.sceneService.on(I,O)}},{key:"once",value:function(I,O){L.SceneEventList.indexOf(I)===-1?this.mapService.once(I,O):this.sceneService.once(I,O)}},{key:"off",value:function(I,O){L.SceneEventList.indexOf(I)===-1?this.mapService.off(I,O):this.sceneService.off(I,O)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(I){return this.mapService.getCenter(I)}},{key:"setCenter",value:function(I,O){return this.mapService.setCenter(I,O)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(I){return this.mapService.setPitch(I)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(I){this.mapService.setRotation(I)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(I){this.mapService.panTo(I)}},{key:"panBy",value:function(I){this.mapService.panBy(I)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(I){this.mapService.setZoom(I)}},{key:"fitBounds",value:function(I,O){var D=this.sceneService.getSceneConfig(),R=D.fitBoundsOptions,y=D.animate;this.mapService.fitBounds(I,O||k(k({},R),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(I,O){this.mapService.setZoomAndCenter(I,O)}},{key:"setMapStyle",value:function(I){this.mapService.setMapStyle(I)}},{key:"setMapStatus",value:function(I){this.mapService.setMapStatus(I)}},{key:"pixelToLngLat",value:function(I){return this.mapService.pixelToLngLat(I)}},{key:"lngLatToPixel",value:function(I){return this.mapService.lngLatToPixel(I)}},{key:"containerToLngLat",value:function(I){return this.mapService.containerToLngLat(I)}},{key:"lngLatToContainer",value:function(I){return this.mapService.lngLatToContainer(I)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(I,O){this.container.bind(L.TYPES.IPostProcessingPass).to(I).whenTargetNamed(O)}},{key:"initComponent",value:function(I){this.controlService.init({container:E.DOM.getContainer(I)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var I=this.sceneService.getSceneConfig(),O=I.logoVisible,D=I.logoPosition;O&&this.addControl(new P.Logo({position:D}))}}]),j}();c.Scene=M},11078:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.registerTransform=c.getTransform=c.registerParser=c.getParser=void 0;var n={},i={},F=function(L){return i[L]};c.getParser=F;var o=function(L,d){i[L]=d};c.registerParser=o;var w=function(L){return n[L]};c.getTransform=w;var _=function(L,d){n[L]=d};c.registerTransform=_},14477:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0});var F={getTransform:!0,registerTransform:!0,getParser:!0,registerParser:!0};Object.defineProperty(c,"getTransform",{enumerable:!0,get:function(){return o.getTransform}}),Object.defineProperty(c,"registerTransform",{enumerable:!0,get:function(){return o.registerTransform}}),Object.defineProperty(c,"getParser",{enumerable:!0,get:function(){return o.getParser}}),Object.defineProperty(c,"registerParser",{enumerable:!0,get:function(){return o.registerParser}}),c.default=void 0;var o=n(11078),w=i(n(14610)),_=i(n(26065)),P=i(n(41642)),L=i(n(44583)),d=i(n(65400)),E=i(n(80988)),g=n(16074),k=n(36492),M=n(454),j=n(18391),U=n(60706),I=n(80158),O=n(21229);Object.keys(O).forEach(function(R){R==="default"||R==="__esModule"||Object.prototype.hasOwnProperty.call(F,R)||R in c&&c[R]===O[R]||Object.defineProperty(c,R,{enumerable:!0,get:function(){return O[R]}})});var D=E.default;c.default=D,(0,o.registerParser)("geojson",_.default),(0,o.registerParser)("image",P.default),(0,o.registerParser)("csv",w.default),(0,o.registerParser)("json",L.default),(0,o.registerParser)("raster",d.default),(0,o.registerTransform)("cluster",g.cluster),(0,o.registerTransform)("filter",k.filter),(0,o.registerTransform)("join",U.join),(0,o.registerTransform)("map",I.map),(0,o.registerTransform)("grid",M.aggregatorToGrid),(0,o.registerTransform)("hexagon",j.pointToHexbin)},21229:function(){"use strict"},14610:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=w;var F=n(12647),o=i(n(44583));function w(_,P){var L=(0,F.csvParse)(_);return(0,o.default)(L,P)}},26065:function(Te,c,n){"use strict";var i=n(20862),F=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=E;var o=F(n(59713)),w=F(n(6563)),_=n(56530),P=i(n(31540));function L(g,k){var M=Object.keys(g);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(g);k&&(j=j.filter(function(U){return Object.getOwnPropertyDescriptor(g,U).enumerable})),M.push.apply(M,j)}return M}function d(g){for(var k=1;k<arguments.length;k++){var M=arguments[k]!=null?arguments[k]:{};k%2?L(Object(M),!0).forEach(function(j){(0,o.default)(g,j,M[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(M)):L(Object(M)).forEach(function(j){Object.defineProperty(g,j,Object.getOwnPropertyDescriptor(M,j))})}return g}function E(g,k){var M=[],j={};if(g.features=g.features.filter(function(I){var O=I.geometry;return I!=null&&O&&O.type&&O.coordinates&&O.coordinates.length>0}),(0,w.default)(g,!0),g.features.length===0)return{dataArray:[],featureKeys:j};var U=0;return P.flattenEach(g,function(I,O){var D=(0,_.getCoords)(I),R=O,y=d(d({},I.properties),{},{coordinates:D,_id:R});M.push(y)}),{dataArray:M,featureKeys:j}}},41642:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=F;var i=n(82887);function F(w,_){var P=_.extent,L=new Promise(function(E){o(w,function(g){E(g)})}),d={images:L,_id:1,dataArray:[{_id:0,coordinates:[[P[0],P[1]],[P[2],P[3]]]}]};return d}function o(w,_){var P=w,L=[];if(typeof P=="string")(0,i.getImage)({url:P},function(g,k){L.push(k),_(L)});else{var d=P.length,E=0;P.forEach(function(g){(0,i.getImage)({url:g},function(k,M){E++,L.push(M),E===d&&_(L)})})}return F}},44583:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=L;var F=i(n(59713)),o=i(n(319)),w=i(n(6563));function _(d,E){var g=Object.keys(d);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(d);E&&(k=k.filter(function(M){return Object.getOwnPropertyDescriptor(d,M).enumerable})),g.push.apply(g,k)}return g}function P(d){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?_(Object(g),!0).forEach(function(k){(0,F.default)(d,k,g[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(g)):_(Object(g)).forEach(function(k){Object.defineProperty(d,k,Object.getOwnPropertyDescriptor(g,k))})}return d}function L(d,E){var g=E.x,k=E.y,M=E.x1,j=E.y1,U=E.coordinates,I=[];return d.forEach(function(O,D){var R=[];if(g&&k&&(R=[parseFloat(O[g]),parseFloat(O[k])]),g&&k&&M&&j){var y=[parseFloat(O[g]),parseFloat(O[k])],v=[parseFloat(O[M]),parseFloat(O[j])];R=[y,v]}if(U){var h="Polygon";Array.isArray(U[0])||(h="Point"),Array.isArray(U[0])&&!Array.isArray(U[0][0])&&(h="LineString");var S={type:h,coordinates:(0,o.default)(O[U])};(0,w.default)(S,!0),R=S.coordinates}var A=P(P({},O),{},{_id:D,coordinates:R});I.push(A)}),{dataArray:I}}},65400:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=n;function n(i,F){var o=F.extent,w=F.width,_=F.height,P=F.min,L=F.max,d={_id:1,dataArray:[{_id:1,data:Array.from(i),width:w,height:_,min:P,max:L,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return d}},80988:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(59713)),E=i(n(30236)),g=i(n(47037)),k=i(n(23560)),M=i(n(50361)),j=n(46343),U=n(82887),I=n(26729),O=n(14477),D=n(16074),R=n(41965),y=n(58438);function v(B,V){var Q=Object.keys(B);if(Object.getOwnPropertySymbols){var oe=Object.getOwnPropertySymbols(B);V&&(oe=oe.filter(function(re){return Object.getOwnPropertyDescriptor(B,re).enumerable})),Q.push.apply(Q,oe)}return Q}function h(B){for(var V=1;V<arguments.length;V++){var Q=arguments[V]!=null?arguments[V]:{};V%2?v(Object(Q),!0).forEach(function(oe){(0,d.default)(B,oe,Q[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Q)):v(Object(Q)).forEach(function(oe){Object.defineProperty(B,oe,Object.getOwnPropertyDescriptor(Q,oe))})}return B}function S(B){var V=A();return function(){var oe=(0,L.default)(B),re;if(V){var Z=(0,L.default)(this).constructor;re=Reflect.construct(oe,arguments,Z)}else re=oe.apply(this,arguments);return(0,P.default)(this,re)}}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}function x(B,V){if(Array.isArray(V))return V}var z=function(B){(0,_.default)(Q,B);var V=S(Q);function Q(oe,re){var Z;return(0,F.default)(this,Q),Z=V.call(this),(0,d.default)((0,w.default)(Z),"data",void 0),(0,d.default)((0,w.default)(Z),"extent",void 0),(0,d.default)((0,w.default)(Z),"hooks",{init:new j.SyncHook}),(0,d.default)((0,w.default)(Z),"parser",{type:"geojson"}),(0,d.default)((0,w.default)(Z),"transforms",[]),(0,d.default)((0,w.default)(Z),"cluster",!1),(0,d.default)((0,w.default)(Z),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,d.default)((0,w.default)(Z),"mapService",void 0),(0,d.default)((0,w.default)(Z),"invalidExtent",!1),(0,d.default)((0,w.default)(Z),"originData",void 0),(0,d.default)((0,w.default)(Z),"rawData",void 0),(0,d.default)((0,w.default)(Z),"cfg",{}),(0,d.default)((0,w.default)(Z),"clusterIndex",void 0),Z.originData=oe,Z.initCfg(re),Z.hooks.init.tap("parser",function(){Z.excuteParser()}),Z.hooks.init.tap("cluster",function(){Z.initCluster()}),Z.hooks.init.tap("transform",function(){Z.executeTrans()}),Z.init(),Z}return(0,o.default)(Q,[{key:"setData",value:function(re,Z){this.rawData=re,this.originData=re,this.initCfg(Z),this.init(),this.emit("update")}},{key:"getClusters",value:function(re){return this.clusterIndex.getClusters(this.caculClusterExtent(2),re)}},{key:"getClustersLeaves",value:function(re){return this.clusterIndex.getLeaves(re,Infinity)}},{key:"updateClusterData",value:function(re){var Z=this,ee=this.clusterOptions,H=ee.method,ae=H===void 0?"sum":H,G=ee.field,ie=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(re));this.clusterOptions.zoom=re,ie.forEach(function(le){le.id||(le.properties.point_count=1)}),(G||(0,k.default)(ae))&&(ie=ie.map(function(le){var Me=le.id;if(Me){var ge=Z.clusterIndex.getLeaves(Me,Infinity),pe=ge.map(function(he){return he.properties}),Ne;if((0,g.default)(ae)&&G){var Re=(0,y.getColumn)(pe,G);Ne=R.statMap[ae](Re)}(0,k.default)(ae)&&(Ne=ae(pe)),le.properties.stat=Ne}else le.properties.point_count=1;return le})),this.data=(0,O.getParser)("geojson")({type:"FeatureCollection",features:ie}),this.executeTrans()}},{key:"getFeatureById",value:function(re){var Z=this.parser.type,ee=Z===void 0?"geojson":Z;if(ee==="geojson"&&!this.cluster){var H=re<this.originData.features.length?this.originData.features[re]:"null",ae=(0,M.default)(H);if(this.transforms.length!==0){var G=this.data.dataArray.find(function(ie){return ie._id===re});ae.properties=G}return ae}else return re<this.data.dataArray.length?this.data.dataArray[re]:"null"}},{key:"getFeatureId",value:function(re,Z){var ee=this.data.dataArray.find(function(H){return H[re]===name});return ee==null?void 0:ee._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(re){var Z=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(Z=(0,U.padBounds)((0,U.bBoxToBounds)(this.extent),re)),Z[0].concat(Z[1])}},{key:"initCfg",value:function(re){this.cfg=(0,E.default)(this.cfg,re,x);var Z=this.cfg;Z&&(Z.parser&&(this.parser=Z.parser),Z.transforms&&(this.transforms=Z.transforms),this.cluster=Z.cluster||!1,Z.clusterOptions&&(this.cluster=!0,this.clusterOptions=h(h({},this.clusterOptions),Z.clusterOptions)))}},{key:"excuteParser",value:function(){var re=this.parser,Z=re.type||"geojson",ee=(0,O.getParser)(Z);this.data=ee(this.originData,re),this.extent=(0,U.extent)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var re=this,Z=this.transforms;Z.forEach(function(ee){var H=ee.type,ae=(0,O.getTransform)(H)(re.data,ee);Object.assign(re.data,ae)})}},{key:"initCluster",value:function(){if(!!this.cluster){var re=this.clusterOptions||{};this.clusterIndex=(0,D.cluster)(this.data,re)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),Q}(I.EventEmitter);c.default=z},16074:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.cluster=P,c.formatData=L;var F=i(n(59713)),o=i(n(69848));function w(d,E){var g=Object.keys(d);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(d);E&&(k=k.filter(function(M){return Object.getOwnPropertyDescriptor(d,M).enumerable})),g.push.apply(g,k)}return g}function _(d){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?w(Object(g),!0).forEach(function(k){(0,F.default)(d,k,g[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(g)):w(Object(g)).forEach(function(k){Object.defineProperty(d,k,Object.getOwnPropertyDescriptor(g,k))})}return d}function P(d,E){var g=E.radius,k=g===void 0?40:g,M=E.maxZoom,j=M===void 0?18:M,U=E.minZoom,I=U===void 0?0:U,O=E.zoom,D=O===void 0?2:O;if(d.pointIndex){var R=d.pointIndex.getClusters(d.extent,Math.floor(D));return d.dataArray=L(R),d}var y=new o.default({radius:k,minZoom:I,maxZoom:j}),v={type:"FeatureCollection",features:[]};return v.features=d.dataArray.map(function(h){return{type:"Feature",geometry:{type:"Point",coordinates:h.coordinates},properties:_({},h)}}),y.load(v.features),y}function L(d){return d.map(function(E,g){return _({coordinates:E.geometry.coordinates,_id:g+1},E.properties)})}},36492:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.filter=n;function n(i,F){var o=F.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}},454:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.aggregatorToGrid=P;var i=n(82887);function F(M,j){var U=typeof Symbol!="undefined"&&M[Symbol.iterator]||M["@@iterator"];if(!U){if(Array.isArray(M)||(U=o(M))||j&&M&&typeof M.length=="number"){U&&(M=U);var I=0,O=function(){};return{s:O,n:function(){return I>=M.length?{done:!0}:{done:!1,value:M[I++]}},e:function(h){throw h},f:O}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D=!0,R=!1,y;return{s:function(){U=U.call(M)},n:function(){var h=U.next();return D=h.done,h},e:function(h){R=!0,y=h},f:function(){try{!D&&U.return!=null&&U.return()}finally{if(R)throw y}}}}function o(M,j){if(!!M){if(typeof M=="string")return w(M,j);var U=Object.prototype.toString.call(M).slice(8,-1);if(U==="Object"&&M.constructor&&(U=M.constructor.name),U==="Map"||U==="Set")return Array.from(M);if(U==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(U))return w(M,j)}}function w(M,j){(j==null||j>M.length)&&(j=M.length);for(var U=0,I=new Array(j);U<j;U++)I[U]=M[U];return I}var _=6378e3;function P(M,j){var U=M.dataArray,I=j.size,O=I===void 0?10:I,D=O/(2*Math.PI*_)*(256<<20)/2,R=L(U,O),y=R.gridHash,v=R.gridOffset,h=k(y,v,j);return{yOffset:D,xOffset:D,radius:D,type:"grid",dataArray:h}}function L(M,j){var U=Infinity,I=-Infinity,O,D=F(M),R;try{for(D.s();!(R=D.n()).done;){var y=R.value;O=y.coordinates[1],Number.isFinite(O)&&(U=O<U?O:U,I=O>I?O:I)}}catch(Z){D.e(Z)}finally{D.f()}var v=(U+I)/2,h=d(j,v);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var S={},A=F(M),x;try{for(A.s();!(x=A.n()).done;){var z=x.value,B=z.coordinates[1],V=z.coordinates[0];if(Number.isFinite(B)&&Number.isFinite(V)){var Q=Math.floor((B+90)/h.yOffset),oe=Math.floor((V+180)/h.xOffset),re="".concat(Q,"-").concat(oe);S[re]=S[re]||{count:0,points:[]},S[re].count+=1,S[re].points.push(z)}}}catch(Z){A.e(Z)}finally{A.f()}return{gridHash:S,gridOffset:h}}function d(M,j){var U=E(M),I=g(j,M);return{yOffset:U,xOffset:I}}function E(M){return M/_*(180/Math.PI)}function g(M,j){return j/_*(180/Math.PI)/Math.cos(M*Math.PI/180)}function k(M,j,U){return Object.keys(M).reduce(function(I,O,D){var R=O.split("-"),y=parseInt(R[0],10),v=parseInt(R[1],10),h={};if(U.field&&U.method){var S=i.Satistics.getColumn(M[O].points,U.field);h[U.method]=i.Satistics.statMap[U.method](S)}return Object.assign(h,{_id:D,coordinates:(0,i.aProjectFlat)([-180+j.xOffset*(v+.5),-90+j.yOffset*(y+.5)]),rawData:M[O].points,count:M[O].count}),I.push(h),I},[])}},18391:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.pointToHexbin=E;var F=i(n(59713)),o=i(n(63038)),w=n(82887),_=n(43774);function P(g,k){var M=Object.keys(g);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(g);k&&(j=j.filter(function(U){return Object.getOwnPropertyDescriptor(g,U).enumerable})),M.push.apply(M,j)}return M}function L(g){for(var k=1;k<arguments.length;k++){var M=arguments[k]!=null?arguments[k]:{};k%2?P(Object(M),!0).forEach(function(j){(0,F.default)(g,j,M[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(M)):P(Object(M)).forEach(function(j){Object.defineProperty(g,j,Object.getOwnPropertyDescriptor(M,j))})}return g}var d=6378e3;function E(g,k){var M=g.dataArray,j=k.size,U=j===void 0?10:j,I=k.method,O=I===void 0?"sum":I,D=U/(2*Math.PI*d)*(256<<20)/2,R=M.map(function(S){var A=(0,w.aProjectFlat)(S.coordinates),x=(0,o.default)(A,2),z=x[0],B=x[1];return L(L({},S),{},{coordinates:[z,B]})}),y=(0,_.hexbin)().radius(D).x(function(S){return S.coordinates[0]}).y(function(S){return S.coordinates[1]}),v=y(R),h={dataArray:v.map(function(S,A){var x;if(k.field&&O){var z=w.Satistics.getColumn(S,k.field);S[O]=w.Satistics.statMap[O](z)}return x={},(0,F.default)(x,k.method,S[O]),(0,F.default)(x,"count",S.length),(0,F.default)(x,"rawData",S),(0,F.default)(x,"coordinates",[S.x,S.y]),(0,F.default)(x,"_id",A),x}),radius:D,xOffset:D,yOffset:D,type:"hexagon"};return h}},60706:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.join=_;var F=i(n(59713));function o(P,L){var d=Object.keys(P);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(P);L&&(E=E.filter(function(g){return Object.getOwnPropertyDescriptor(P,g).enumerable})),d.push.apply(d,E)}return d}function w(P){for(var L=1;L<arguments.length;L++){var d=arguments[L]!=null?arguments[L]:{};L%2?o(Object(d),!0).forEach(function(E){(0,F.default)(P,E,d[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(d)):o(Object(d)).forEach(function(E){Object.defineProperty(P,E,Object.getOwnPropertyDescriptor(d,E))})}return P}function _(P,L){var d=L.sourceField,E=L.targetField,g=L.data,k={};return g.forEach(function(M){k[M[d]]=M}),P.dataArray=P.dataArray.map(function(M){var j=M[E];return w(w({},M),k[j])}),P}},80158:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.map=n;function n(i,F){var o=F.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}},41965:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.sum=F,c.max=n,c.min=i,c.mean=o,c.statMap=void 0;function n(_){if(_.length===0)throw new Error("max requires at least one data point");for(var P=_[0],L=1;L<_.length;L++)_[L]>P&&(P=_[L]);return P}function i(_){if(_.length===0)throw new Error("min requires at least one data point");for(var P=_[0],L=1;L<_.length;L++)_[L]<P&&(P=_[L]);return P}function F(_){if(_.length===0)return 0;for(var P=_[0],L=0,d,E=1;E<_.length;E++)d=P+_[E]*1,Math.abs(P)>=Math.abs(_[E])?L+=P-d+_[E]:L+=_[E]-d+P,P=d;return P+L*1}function o(_){if(_.length===0)throw new Error("mean requires at least one data point");return F(_)/_.length}var w={min:i,max:n,mean:o,sum:F};c.statMap=w},58438:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getColumn=n;function n(i,F){return i.map(function(o){return o[F]*1})}},6563:function(Te,c,n){var i=n(31795);Te.exports=F;function F(d,E){switch(d&&d.type||null){case"FeatureCollection":return d.features=d.features.map(o(F,E)),d;case"GeometryCollection":return d.geometries=d.geometries.map(o(F,E)),d;case"Feature":return d.geometry=F(d.geometry,E),d;case"Polygon":case"MultiPolygon":return w(d,E);default:return d}}function o(d,E){return function(g){return d(g,E)}}function w(d,E){return d.type==="Polygon"?d.coordinates=_(d.coordinates,E):d.type==="MultiPolygon"&&(d.coordinates=d.coordinates.map(o(_,E))),d}function _(d,E){E=!!E,d[0]=P(d[0],E);for(var g=1;g<d.length;g++)d[g]=P(d[g],!E);return d}function P(d,E){return L(d)===E?d:d.reverse()}function L(d){return i.ring(d)>=0}},22936:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.applyAnchorClass=F,c.anchorTranslate=c.anchorType=void 0;var n;c.anchorType=n,function(o){o.CENTER="center",o.TOP="top",o["TOP-LEFT"]="top-left",o["TOP-RIGHT"]="top-right",o.BOTTOM="bottom",o["BOTTOM-LEFT"]="bottom-left",o.LEFT="left",o.RIGHT="right"}(n||(c.anchorType=n={}));var i={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};c.anchorTranslate=i;function F(o,w,_){var P=o.classList;for(var L in i)i.hasOwnProperty(L)&&P.remove("l7-".concat(_,"-anchor-").concat(L));P.add("l7-".concat(_,"-anchor-").concat(w))}},11736:function(Te,c,n){"use strict";var i=n(20862);Object.defineProperty(c,"__esModule",{value:!0}),c.rgb2arr=o,c.decodePickingColor=w,c.encodePickingColor=_,c.generateColorRamp=P;var F=i(n(3054));function o(L){var d=F.color(L),E=[0,0,0,0];return d!=null&&(E[0]=d.r/255,E[1]=d.g/255,E[2]=d.b/255,E[3]=d.opacity),E}function w(L){var d=L&&L[0],E=L&&L[1],g=L&&L[2],k=d+E*256+g*65536-1;return k}function _(L){return[L+1&255,L+1>>8&255,L+1>>8>>8&255]}function P(L){var d=document.createElement("canvas"),E=d.getContext("2d");d.width=256,d.height=1;for(var g=E.createLinearGradient(0,0,256,1),k=null,M=L.positions[0],j=L.positions[L.positions.length-1],U=0;U<L.colors.length;++U){var I=(L.positions[U]-M)/(j-M);g.addColorStop(I,L.colors[U])}return E.fillStyle=g,E.fillRect(0,0,256,1),k=new Uint8ClampedArray(E.getImageData(0,0,256,1).data),new ImageData(k,256,1)}},98570:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.getContainer=w,c.trim=_,c.splitWords=P,c.create=d,c.remove=E,c.addClass=g,c.removeClass=k,c.hasClass=M,c.setClass=j,c.getClass=U,c.empty=I,c.setTransform=D,c.triggerResize=R,c.printCanvas=y,c.getViewPortScale=v,c.DPR=void 0;var F=i(n(63038)),o=window.document.documentElement.style;function w(S){var A=S;return typeof S=="string"&&(A=document.getElementById(S)),A}function _(S){return S.trim?S.trim():S.replace(/^\s+|\s+$/g,"")}function P(S){return _(S).split(/\s+/)}function L(S){if(!o)return S[0];for(var A in S)if(S[A]&&S[A]in o)return S[A];return S[0]}function d(S,A,x){var z=document.createElement(S);return z.className=A||"",x&&x.appendChild(z),z}function E(S){var A=S.parentNode;A&&A.removeChild(S)}function g(S,A){if(S.classList!==void 0)for(var x=P(A),z=0,B=x.length;z<B;z++)S.classList.add(x[z]);else if(!M(S,A)){var V=U(S);j(S,(V?V+" ":"")+A)}}function k(S,A){S.classList!==void 0?S.classList.remove(A):j(S,_((" "+U(S)+" ").replace(" "+A+" "," ")))}function M(S,A){if(S.classList!==void 0)return S.classList.contains(A);var x=U(S);return x.length>0&&new RegExp("(^|\\s)"+A+"(\\s|$)").test(x)}function j(S,A){S instanceof HTMLElement?S.className=A:S.className.baseVal=A}function U(S){return S instanceof SVGElement&&(S=S.correspondingElement),S.className.baseVal===void 0?S.className:S.className.baseVal}function I(S){for(;S&&S.firstChild;)S.removeChild(S.firstChild)}var O=L(["transform","WebkitTransform"]);function D(S,A){S.style[O]=A}function R(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var S=window.document.createEvent("UIEvents");S.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(S)}}function y(S){var A=["padding: "+(S.height/2-8)+"px "+S.width/2+"px;","line-height: "+S.height+"px;","background-image: url("+S.toDataURL()+");"];console.log(`%c
`,A.join(""))}function v(){var S,A=document.querySelector('meta[name="viewport"]');if(!A)return 1;var x=(S=A.content)===null||S===void 0?void 0:S.split(","),z=x.find(function(B){var V=B.split("="),Q=(0,F.default)(V,2),oe=Q[0],re=Q[1];return oe==="initial-scale"});return z?z.split("=")[1]*1:1}var h=v()<1?1:window.devicePixelRatio;c.DPR=h},19969:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.bindAll=n;function n(i,F){i.forEach(function(o){!F[o]||(F[o]=F[o].bind(F))})}},29469:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.getImage=c.getArrayBuffer=c.getJSON=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(81506)),_=i(n(2205)),P=i(n(78585)),L=i(n(29754)),d=i(n(65957)),E=i(n(59713));function g(y){var v=k();return function(){var S=(0,L.default)(y),A;if(v){var x=(0,L.default)(this).constructor;A=Reflect.construct(S,arguments,x)}else A=S.apply(this,arguments);return(0,P.default)(this,A)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}var M=function(y){(0,_.default)(h,y);var v=g(h);function h(S,A,x){var z;return(0,F.default)(this,h),z=v.call(this,S),(0,E.default)((0,w.default)(z),"status",void 0),(0,E.default)((0,w.default)(z),"url",void 0),z.status=A,z.url=x,z.name=z.constructor.name,z.message=S,z}return(0,o.default)(h,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),h}((0,d.default)(Error));function j(y){var v=new XMLHttpRequest;v.open("GET",y.url,!0);for(var h in y.headers)y.headers.hasOwnProperty(h)&&v.setRequestHeader(h,y.headers[h]);return v.withCredentials=y.credentials==="include",v}var U=function(v,h){var S=j(v);return S.setRequestHeader("Accept","application/json"),S.onerror=function(){h(new Error(S.statusText))},S.onload=function(){if(S.status>=200&&S.status<300&&S.response){var A;try{A=JSON.parse(S.response)}catch(x){return h(x)}h(null,A)}else S.status===401?h(new M("".concat(S.statusText),S.status,v.url)):h(new M(S.statusText,S.status,v.url))},S.send(),S};c.getJSON=U;var I=function(v,h){var S=j(v);return S.responseType="arraybuffer",S.onerror=function(){h(new Error(S.statusText))},S.onload=function(){var A=S.response;if(A.byteLength===0&&S.status===200)return h(new Error("http status 200 returned without content."));S.status>=200&&S.status<300&&S.response?h(null,{data:A,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")}):h(new M(S.statusText,S.status,v.url))},S.send(),S};c.getArrayBuffer=I;function O(y){var v=window.document.createElement("a");return v.href=y,v.protocol===window.document.location.protocol&&v.host===window.document.location.host}var D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",R=function(v,h){return I(v,function(S,A){if(S)h(S);else if(A){var x=new window.Image;x.crossOrigin="anonymous";var z=window.URL||window.webkitURL;x.onload=function(){h(null,x),z.revokeObjectURL(x.src)};var B=new window.Blob([new Uint8Array(A.data)],{type:"image/png"});x.src=A.data.byteLength?z.createObjectURL(B):D}})};c.getImage=R},22194:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.extent=_,c.tranfrormCoord=L,c.lngLatToMeters=E,c.metersToLngLat=g,c.longitude=k,c.latitude=M,c.validateLngLat=j,c.aProjectFlat=U,c.unProjectFlat=I,c.lnglatDistance=O,c.project=D,c.padBounds=R,c.boundsContains=y,c.bBoxToBounds=v;var F=i(n(63038)),o=n(84102),w=2*Math.PI*6378137/2;function _(h){var S=[Infinity,Infinity,-Infinity,-Infinity];return h.forEach(function(A){var x=A.coordinates;P(S,x)}),S}function P(h,S){return Array.isArray(S[0])?S.forEach(function(A){P(h,A)}):(h[0]>S[0]&&(h[0]=S[0]),h[1]>S[1]&&(h[1]=S[1]),h[2]<S[0]&&(h[2]=S[0]),h[3]<S[1]&&(h[3]=S[1])),h}function L(h,S){return d(h,S)}function d(h,S){return Array.isArray(h[0])?h.map(function(A){return d(A,S)}):S(h)}function E(h){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};h=j(h,S);var x=h[0],z=h[1],B=x*w/180,V=Math.log(Math.tan((90+z)*Math.PI/360))/(Math.PI/180);return V=V*w/180,A.enable&&(B=Number(B.toFixed(A.decimal)),V=Number(V.toFixed(A.decimal))),h.length===3?[B,V,h[2]]:[B,V]}function g(h){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,A=h[0],x=h[1],z=A/w*180,B=x/w*180;return B=180/Math.PI*(2*Math.atan(Math.exp(B*Math.PI/180))-Math.PI/2),S!=null&&(z=Number(z.toFixed(S)),B=Number(B.toFixed(S))),h.length===3?[z,B,h[2]]:[z,B]}function k(h){if(h==null)throw new Error("lng is required");return(h>180||h<-180)&&(h=h%360,h>180&&(h=-360+h),h<-180&&(h=360+h),h===0&&(h=0)),h}function M(h){if(h==null)throw new Error("lat is required");return(h>90||h<-90)&&(h=h%180,h>90&&(h=-180+h),h<-90&&(h=180+h),h===0&&(h=0)),h}function j(h,S){if(S===!1)return h;var A=k(h[0]),x=M(h[1]);return x>85&&(x=85),x<-85&&(x=-85),h.length===3?[A,x,h[2]]:[A,x]}function U(h){var S=85.0511287798,A=Math.max(Math.min(S,h[1]),-S),x=256<<20,z=Math.PI/180,B=h[0]*z,V=A*z;V=Math.log(Math.tan(Math.PI/4+V/2));var Q=.5/Math.PI,oe=.5,re=-.5/Math.PI;return z=.5,B=x*(Q*B+oe),V=x*(re*V+z),[Math.floor(B),Math.floor(V)]}function I(h){var S=.5/Math.PI,A=.5,x=-.5/Math.PI,z=.5,B=256<<20,V=(0,F.default)(h,2),Q=V[0],oe=V[1];Q=(Q/B-A)/S,oe=(oe/B-z)/x,oe=(Math.atan(Math.pow(Math.E,oe))-Math.PI/4)*2,z=Math.PI/180;var re=oe/z,Z=Q/z;return[Z,re]}function O(h,S,A){var x=(0,o.degreesToRadians)(S[1]-h[1]),z=(0,o.degreesToRadians)(S[0]-h[0]),B=(0,o.degreesToRadians)(h[1]),V=(0,o.degreesToRadians)(S[1]),Q=Math.pow(Math.sin(x/2),2)+Math.pow(Math.sin(z/2),2)*Math.cos(B)*Math.cos(V);return(0,o.radiansToLength)(2*Math.atan2(Math.sqrt(Q),Math.sqrt(1-Q)),A="meters")}function D(h){var S=Math.PI/180,A=85.0511287798,x=6378137,z=Math.max(Math.min(A,h[1]),-A),B=Math.sin(z*S),V=x*h[0]*S,Q=x*Math.log((1+B)/(1-B))/2;return[V,Q]}function R(h,S){var A=Math.abs(h[1][1]-h[0][1])*S,x=Math.abs(h[1][0]-h[0][0])*S;return[[h[0][0]-x,h[0][1]-A],[h[1][0]+x,h[1][1]+A]]}function y(h,S){return h[0][0]<=S[0][0]&&h[0][1]<=S[0][1]&&h[1][0]>=S[1][0]&&h[1][1]>=S[1][1]}function v(h){return[[h[0],h[1]],[h[2],h[3]]]}},21605:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BKDRHash=n,c.djb2hash=i;function n(F){var o=131,w=137,_=0;F+="x";for(var P=Math.floor(9007199254740991/w),L=0;L<F.length;L++)_>P&&(_=Math.floor(_/w)),_=_*o+F.charCodeAt(L);return _}function i(F){F=F.toString();for(var o=5381,w=F.length;w;)o=o*33^F.charCodeAt(--w);return o>>>0}},82887:function(Te,c,n){"use strict";var i=n(20862);Object.defineProperty(c,"__esModule",{value:!0});var F={djb2hash:!0,BKDRHash:!0,DOM:!0,Satistics:!0};Object.defineProperty(c,"djb2hash",{enumerable:!0,get:function(){return o.djb2hash}}),Object.defineProperty(c,"BKDRHash",{enumerable:!0,get:function(){return o.BKDRHash}}),c.Satistics=c.DOM=void 0;var o=n(21605),w=i(n(98570));c.DOM=w;var _=n(29469);Object.keys(_).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===_[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return _[M]}})});var P=n(22194);Object.keys(P).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===P[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return P[M]}})});var L=n(74866);Object.keys(L).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===L[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return L[M]}})});var d=n(19969);Object.keys(d).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===d[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return d[M]}})});var E=n(11736);Object.keys(E).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===E[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return E[M]}})});var g=n(22936);Object.keys(g).forEach(function(M){M==="default"||M==="__esModule"||Object.prototype.hasOwnProperty.call(F,M)||M in c&&c[M]===g[M]||Object.defineProperty(c,M,{enumerable:!0,get:function(){return g[M]}})});var k=i(n(39256));c.Satistics=k},74866:function(Te,c,n){"use strict";var i=n(95318);Object.defineProperty(c,"__esModule",{value:!0}),c.LRUCache=void 0;var F=i(n(34575)),o=i(n(93913)),w=i(n(59713)),_=function(){function P(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,d=arguments.length>1?arguments[1]:void 0;(0,F.default)(this,P),(0,w.default)(this,"limit",void 0),(0,w.default)(this,"cache",void 0),(0,w.default)(this,"destroy",void 0),(0,w.default)(this,"order",void 0),this.limit=L,this.destroy=d||this.defaultDestroy,this.order=[],this.clear()}return(0,o.default)(P,[{key:"clear",value:function(){var d=this;this.order.forEach(function(E){d.delete(E)}),this.cache={},this.order=[]}},{key:"get",value:function(d){var E=this.cache[d];return E&&(this.deleteOrder(d),this.appendOrder(d)),E}},{key:"set",value:function(d,E){this.cache[d]?(this.delete(d),this.cache[d]=E,this.appendOrder(d)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[d]=E,this.appendOrder(d))}},{key:"delete",value:function(d){var E=this.cache[d];E&&(this.deleteCache(d),this.deleteOrder(d),this.destroy(E,d))}},{key:"deleteCache",value:function(d){delete this.cache[d]}},{key:"deleteOrder",value:function(d){var E=this.order.findIndex(function(g){return g===d});E>=0&&this.order.splice(E,1)}},{key:"appendOrder",value:function(d){this.order.push(d)}},{key:"defaultDestroy",value:function(d,E){return null}}]),P}();c.LRUCache=_},39256:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.sum=F,c.max=n,c.min=i,c.mean=o,c.mode=w,c.getColumn=P,c.getSatByColumn=L,c.statMap=void 0;function n(d){if(d.length===0)throw new Error("max requires at least one data point");for(var E=d[0],g=1;g<d.length;g++)d[g]>E&&(E=d[g]);return E*1}function i(d){if(d.length===0)throw new Error("min requires at least one data point");for(var E=d[0],g=1;g<d.length;g++)d[g]<E&&(E=d[g]);return E*1}function F(d){if(d.length===0)return 0;for(var E=d[0]*1,g=1;g<d.length;g++)E+=d[g]*1;return E}function o(d){if(d.length===0)throw new Error("mean requires at least one data point");return F(d)/d.length}function w(d){if(d.length===0)throw new Error("mean requires at least one data point");if(d.length<3)return d[0];d.sort();for(var E=d[0],g=NaN,k=0,M=1,j=1;j<d.length+1;j++)d[j]!==E?(M>k&&(k=M,g=E),M=1,E=d[j]):M++;return g*1}var _={min:i,max:n,mean:o,sum:F,mode:w};c.statMap=_;function P(d,E){return d.map(function(g){return g[E]})}function L(d,E){return _[d](E)}},87768:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var i=n(5602);Object.keys(i).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===i[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return i[d]}})});var F=n(17365);Object.keys(F).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===F[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return F[d]}})});var o=n(76971);Object.keys(o).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===o[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return o[d]}})});var w=n(81441);Object.keys(w).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===w[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return w[d]}})});var _=n(58722);Object.keys(_).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===_[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return _[d]}})});var P=n(82887);Object.keys(P).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===P[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return P[d]}})});var L=n(64977);Object.keys(L).forEach(function(d){d==="default"||d==="__esModule"||d in c&&c[d]===L[d]||Object.defineProperty(c,d,{enumerable:!0,get:function(){return L[d]}})})},64977:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.version=void 0;var n="2.5.9";c.version=n},33124:function(Te){function c(n,i,F,o,w){var _={};return Object.keys(o).forEach(function(P){_[P]=o[P]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=F.slice().reverse().reduce(function(P,L){return L(n,i,P)||P},_),w&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(w):void 0,_.initializer=void 0),_.initializer===void 0&&(Object.defineProperty(n,i,_),_=null),_}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},59873:function(Te,c,n){var i=n(67228);function F(o){if(Array.isArray(o))return i(o)}Te.exports=F,Te.exports.default=Te.exports,Te.exports.__esModule=!0},81506:function(Te){function c(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},48926:function(Te){function c(i,F,o,w,_,P,L){try{var d=i[P](L),E=d.value}catch(g){o(g);return}d.done?F(E):Promise.resolve(E).then(w,_)}function n(i){return function(){var F=this,o=arguments;return new Promise(function(w,_){var P=i.apply(F,o);function L(E){c(P,w,_,L,d,"next",E)}function d(E){c(P,w,_,L,d,"throw",E)}L(void 0)})}}Te.exports=n,Te.exports.default=Te.exports,Te.exports.__esModule=!0},34575:function(Te){function c(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},69100:function(Te,c,n){var i=n(99489),F=n(57067);function o(w,_,P){return F()?(Te.exports=o=Reflect.construct,Te.exports.default=Te.exports,Te.exports.__esModule=!0):(Te.exports=o=function(d,E,g){var k=[null];k.push.apply(k,E);var M=Function.bind.apply(d,k),j=new M;return g&&i(j,g.prototype),j},Te.exports.default=Te.exports,Te.exports.__esModule=!0),o.apply(null,arguments)}Te.exports=o,Te.exports.default=Te.exports,Te.exports.__esModule=!0},93913:function(Te){function c(i,F){for(var o=0;o<F.length;o++){var w=F[o];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(i,w.key,w)}}function n(i,F,o){return F&&c(i.prototype,F),o&&c(i,o),i}Te.exports=n,Te.exports.default=Te.exports,Te.exports.__esModule=!0},16525:function(Te,c,n){var i=n(58331);function F(o,w,_){return typeof Reflect!="undefined"&&Reflect.get?(Te.exports=F=Reflect.get,Te.exports.default=Te.exports,Te.exports.__esModule=!0):(Te.exports=F=function(L,d,E){var g=i(L,d);if(!!g){var k=Object.getOwnPropertyDescriptor(g,d);return k.get?k.get.call(E):k.value}},Te.exports.default=Te.exports,Te.exports.__esModule=!0),F(o,w,_||o)}Te.exports=F,Te.exports.default=Te.exports,Te.exports.__esModule=!0},29754:function(Te){function c(n){return Te.exports=c=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Te.exports.default=Te.exports,Te.exports.__esModule=!0,c(n)}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},2205:function(Te,c,n){var i=n(99489);function F(o,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(w&&w.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),w&&i(o,w)}Te.exports=F,Te.exports.default=Te.exports,Te.exports.__esModule=!0},21165:function(Te){function c(n,i,F,o){!F||Object.defineProperty(n,i,{enumerable:F.enumerable,configurable:F.configurable,writable:F.writable,value:F.initializer?F.initializer.call(o):void 0})}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},67268:function(Te){function c(n,i){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},70430:function(Te){function c(n){return Function.toString.call(n).indexOf("[native code]")!==-1}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},57067:function(Te){function c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},46860:function(Te){function c(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},98206:function(Te){function c(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},78585:function(Te,c,n){var i=n(50008).default,F=n(81506);function o(w,_){if(_&&(i(_)==="object"||typeof _=="function"))return _;if(_!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return F(w)}Te.exports=o,Te.exports.default=Te.exports,Te.exports.__esModule=!0},99489:function(Te){function c(n,i){return Te.exports=c=Object.setPrototypeOf||function(o,w){return o.__proto__=w,o},Te.exports.default=Te.exports,Te.exports.__esModule=!0,c(n,i)}Te.exports=c,Te.exports.default=Te.exports,Te.exports.__esModule=!0},58331:function(Te,c,n){var i=n(29754);function F(o,w){for(;!Object.prototype.hasOwnProperty.call(o,w)&&(o=i(o),o!==null););return o}Te.exports=F,Te.exports.default=Te.exports,Te.exports.__esModule=!0},319:function(Te,c,n){var i=n(59873),F=n(46860),o=n(60379),w=n(98206);function _(P){return i(P)||F(P)||o(P)||w()}Te.exports=_,Te.exports.default=Te.exports,Te.exports.__esModule=!0},65957:function(Te,c,n){var i=n(29754),F=n(99489),o=n(70430),w=n(69100);function _(P){var L=typeof Map=="function"?new Map:void 0;return Te.exports=_=function(E){if(E===null||!o(E))return E;if(typeof E!="function")throw new TypeError("Super expression must either be null or a function");if(typeof L!="undefined"){if(L.has(E))return L.get(E);L.set(E,g)}function g(){return w(E,arguments,i(this).constructor)}return g.prototype=Object.create(E.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),F(g,E)},Te.exports.default=Te.exports,Te.exports.__esModule=!0,_(P)}Te.exports=_,Te.exports.default=Te.exports,Te.exports.__esModule=!0},31795:function(Te,c,n){var i=n(75752);Te.exports.geometry=F,Te.exports.ring=w;function F(P){var L=0,d;switch(P.type){case"Polygon":return o(P.coordinates);case"MultiPolygon":for(d=0;d<P.coordinates.length;d++)L+=o(P.coordinates[d]);return L;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(d=0;d<P.geometries.length;d++)L+=F(P.geometries[d]);return L}}function o(P){var L=0;if(P&&P.length>0){L+=Math.abs(w(P[0]));for(var d=1;d<P.length;d++)L-=Math.abs(w(P[d]))}return L}function w(P){var L,d,E,g,k,M,j,U=0,I=P.length;if(I>2){for(j=0;j<I;j++)j===I-2?(g=I-2,k=I-1,M=0):j===I-1?(g=I-1,k=0,M=1):(g=j,k=j+1,M=j+2),L=P[g],d=P[k],E=P[M],U+=(_(E[0])-_(L[0]))*Math.sin(_(d[1]));U=U*i.RADIUS*i.RADIUS/2}return U}function _(P){return P*Math.PI/180}},49296:function(Te){"use strict";Te.exports=n,Te.exports.default=n;var c=1e20;function n(_,P,L,d,E,g){this.fontSize=_||24,this.buffer=P===void 0?3:P,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=g||"normal",this.radius=L||8;var k=this.size=this.fontSize+this.buffer*2,M=k+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=k,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(k/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function i(_,P,L,d,E,g,k){g.fill(c,0,P*L),k.fill(0,0,P*L);for(var M=(P-d)/2,j=0;j<E;j++)for(var U=0;U<d;U++){var I=(j+M)*P+U+M,O=_.data[4*(j*d+U)+3]/255;if(O===1)g[I]=0,k[I]=c;else if(O===0)g[I]=c,k[I]=0;else{var D=Math.max(0,.5-O),R=Math.max(0,O-.5);g[I]=D*D,k[I]=R*R}}}function F(_,P,L,d,E,g,k){for(var M=0;M<P*L;M++){var j=Math.sqrt(d[M])-Math.sqrt(E[M]);_[M]=Math.round(255-255*(j/g+k))}}n.prototype._draw=function(_,P){var L=this.ctx.measureText(_),d=L.width,E=2*this.buffer,g,k,M,j,U,I,O,D;P&&this.useMetrics?(U=Math.floor(L.actualBoundingBoxAscent),D=this.buffer+Math.ceil(L.actualBoundingBoxAscent),I=this.buffer,O=this.buffer,k=Math.min(this.size,Math.ceil(L.actualBoundingBoxRight-L.actualBoundingBoxLeft)),j=Math.min(this.size-I,Math.ceil(L.actualBoundingBoxAscent+L.actualBoundingBoxDescent)),g=k+E,M=j+E,this.ctx.textBaseline="alphabetic"):(g=k=this.size,M=j=this.size,U=19*this.fontSize/24,I=O=0,D=this.middle,this.ctx.textBaseline="middle");var R;k&&j&&(this.ctx.clearRect(O,I,k,j),this.ctx.fillText(_,this.buffer,D),R=this.ctx.getImageData(O,I,k,j));var y=new Uint8ClampedArray(g*M);return i(R,g,M,k,j,this.gridOuter,this.gridInner),o(this.gridOuter,g,M,this.f,this.v,this.z),o(this.gridInner,g,M,this.f,this.v,this.z),F(y,g,M,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:y,metrics:{width:k,height:j,sdfWidth:g,sdfHeight:M,top:U,left:0,advance:d}}},n.prototype.draw=function(_){return this._draw(_,!1).data},n.prototype.drawWithMetrics=function(_){return this._draw(_,!0)};function o(_,P,L,d,E,g){for(var k=0;k<P;k++)w(_,k,P,L,d,E,g);for(var M=0;M<L;M++)w(_,M*P,1,P,d,E,g)}function w(_,P,L,d,E,g,k){var M,j,U,I;for(g[0]=0,k[0]=-c,k[1]=c,M=0;M<d;M++)E[M]=_[P+M*L];for(M=1,j=0,U=0;M<d;M++){do I=g[j],U=(E[M]-E[I]+M*M-I*I)/(M-I)/2;while(U<=k[j]&&--j>-1);j++,g[j]=M,k[j]=U,k[j+1]=c}for(M=0,j=0;M<d;M++){for(;k[j+1]<M;)j++;I=g[j],_[P+M*L]=E[I]+(M-I)*(M-I)}}},99874:function(Te){Te.exports=c;function c(n,i,F,o){this.cx=3*n,this.bx=3*(F-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(o-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=F,this.p2y=o}c.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},c.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},c.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},c.prototype.solveCurveX=function(n,i){typeof i=="undefined"&&(i=1e-6);var F,o,w,_,P;for(w=n,P=0;P<8;P++){if(_=this.sampleCurveX(w)-n,Math.abs(_)<i)return w;var L=this.sampleCurveDerivativeX(w);if(Math.abs(L)<1e-6)break;w=w-_/L}if(F=0,o=1,w=n,w<F)return F;if(w>o)return o;for(;F<o;){if(_=this.sampleCurveX(w),Math.abs(_-n)<i)return w;n>_?F=w:o=w,w=(o-F)*.5+F}return w},c.prototype.solve=function(n,i){return this.sampleCurveY(this.solveCurveX(n,i))}},84102:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.earthRadius=63710088e-1,c.factors={centimeters:c.earthRadius*100,centimetres:c.earthRadius*100,degrees:c.earthRadius/111325,feet:c.earthRadius*3.28084,inches:c.earthRadius*39.37,kilometers:c.earthRadius/1e3,kilometres:c.earthRadius/1e3,meters:c.earthRadius,metres:c.earthRadius,miles:c.earthRadius/1609.344,millimeters:c.earthRadius*1e3,millimetres:c.earthRadius*1e3,nauticalmiles:c.earthRadius/1852,radians:1,yards:c.earthRadius*1.0936},c.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/c.earthRadius,yards:1.0936133},c.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function n(B,V,Q){Q===void 0&&(Q={});var oe={type:"Feature"};return(Q.id===0||Q.id)&&(oe.id=Q.id),Q.bbox&&(oe.bbox=Q.bbox),oe.properties=V||{},oe.geometry=B,oe}c.feature=n;function i(B,V,Q){switch(Q===void 0&&(Q={}),B){case"Point":return F(V).geometry;case"LineString":return P(V).geometry;case"Polygon":return w(V).geometry;case"MultiPoint":return g(V).geometry;case"MultiLineString":return E(V).geometry;case"MultiPolygon":return k(V).geometry;default:throw new Error(B+" is invalid")}}c.geometry=i;function F(B,V,Q){if(Q===void 0&&(Q={}),!B)throw new Error("coordinates is required");if(!Array.isArray(B))throw new Error("coordinates must be an Array");if(B.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!S(B[0])||!S(B[1]))throw new Error("coordinates must contain numbers");var oe={type:"Point",coordinates:B};return n(oe,V,Q)}c.point=F;function o(B,V,Q){return Q===void 0&&(Q={}),d(B.map(function(oe){return F(oe,V)}),Q)}c.points=o;function w(B,V,Q){Q===void 0&&(Q={});for(var oe=0,re=B;oe<re.length;oe++){var Z=re[oe];if(Z.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ee=0;ee<Z[Z.length-1].length;ee++)if(Z[Z.length-1][ee]!==Z[0][ee])throw new Error("First and last Position are not equivalent.")}var H={type:"Polygon",coordinates:B};return n(H,V,Q)}c.polygon=w;function _(B,V,Q){return Q===void 0&&(Q={}),d(B.map(function(oe){return w(oe,V)}),Q)}c.polygons=_;function P(B,V,Q){if(Q===void 0&&(Q={}),B.length<2)throw new Error("coordinates must be an array of two or more positions");var oe={type:"LineString",coordinates:B};return n(oe,V,Q)}c.lineString=P;function L(B,V,Q){return Q===void 0&&(Q={}),d(B.map(function(oe){return P(oe,V)}),Q)}c.lineStrings=L;function d(B,V){V===void 0&&(V={});var Q={type:"FeatureCollection"};return V.id&&(Q.id=V.id),V.bbox&&(Q.bbox=V.bbox),Q.features=B,Q}c.featureCollection=d;function E(B,V,Q){Q===void 0&&(Q={});var oe={type:"MultiLineString",coordinates:B};return n(oe,V,Q)}c.multiLineString=E;function g(B,V,Q){Q===void 0&&(Q={});var oe={type:"MultiPoint",coordinates:B};return n(oe,V,Q)}c.multiPoint=g;function k(B,V,Q){Q===void 0&&(Q={});var oe={type:"MultiPolygon",coordinates:B};return n(oe,V,Q)}c.multiPolygon=k;function M(B,V,Q){Q===void 0&&(Q={});var oe={type:"GeometryCollection",geometries:B};return n(oe,V,Q)}c.geometryCollection=M;function j(B,V){if(V===void 0&&(V=0),V&&!(V>=0))throw new Error("precision must be a positive number");var Q=Math.pow(10,V||0);return Math.round(B*Q)/Q}c.round=j;function U(B,V){V===void 0&&(V="kilometers");var Q=c.factors[V];if(!Q)throw new Error(V+" units is invalid");return B*Q}c.radiansToLength=U;function I(B,V){V===void 0&&(V="kilometers");var Q=c.factors[V];if(!Q)throw new Error(V+" units is invalid");return B/Q}c.lengthToRadians=I;function O(B,V){return R(I(B,V))}c.lengthToDegrees=O;function D(B){var V=B%360;return V<0&&(V+=360),V}c.bearingToAzimuth=D;function R(B){var V=B%(2*Math.PI);return V*180/Math.PI}c.radiansToDegrees=R;function y(B){var V=B%360;return V*Math.PI/180}c.degreesToRadians=y;function v(B,V,Q){if(V===void 0&&(V="kilometers"),Q===void 0&&(Q="kilometers"),!(B>=0))throw new Error("length must be a positive number");return U(I(B,V),Q)}c.convertLength=v;function h(B,V,Q){if(V===void 0&&(V="meters"),Q===void 0&&(Q="kilometers"),!(B>=0))throw new Error("area must be a positive number");var oe=c.areaFactors[V];if(!oe)throw new Error("invalid original units");var re=c.areaFactors[Q];if(!re)throw new Error("invalid final units");return B/oe*re}c.convertArea=h;function S(B){return!isNaN(B)&&B!==null&&!Array.isArray(B)}c.isNumber=S;function A(B){return!!B&&B.constructor===Object}c.isObject=A;function x(B){if(!B)throw new Error("bbox is required");if(!Array.isArray(B))throw new Error("bbox must be an Array");if(B.length!==4&&B.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");B.forEach(function(V){if(!S(V))throw new Error("bbox must only contain numbers")})}c.validateBBox=x;function z(B){if(!B)throw new Error("id is required");if(["string","number"].indexOf(typeof B)===-1)throw new Error("id must be a number or a string")}c.validateId=z},56530:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var i=n(84102);function F(g){if(!g)throw new Error("coord is required");if(!Array.isArray(g)){if(g.type==="Feature"&&g.geometry!==null&&g.geometry.type==="Point")return g.geometry.coordinates;if(g.type==="Point")return g.coordinates}if(Array.isArray(g)&&g.length>=2&&!Array.isArray(g[0])&&!Array.isArray(g[1]))return g;throw new Error("coord must be GeoJSON Point or an Array of numbers")}c.getCoord=F;function o(g){if(Array.isArray(g))return g;if(g.type==="Feature"){if(g.geometry!==null)return g.geometry.coordinates}else if(g.coordinates)return g.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}c.getCoords=o;function w(g){if(g.length>1&&i.isNumber(g[0])&&i.isNumber(g[1]))return!0;if(Array.isArray(g[0])&&g[0].length)return w(g[0]);throw new Error("coordinates must only contain numbers")}c.containsNumber=w;function _(g,k,M){if(!k||!M)throw new Error("type and name required");if(!g||g.type!==k)throw new Error("Invalid input to "+M+": must be a "+k+", given "+g.type)}c.geojsonType=_;function P(g,k,M){if(!g)throw new Error("No feature passed");if(!M)throw new Error(".featureOf() requires a name");if(!g||g.type!=="Feature"||!g.geometry)throw new Error("Invalid input to "+M+", Feature with geometry required");if(!g.geometry||g.geometry.type!==k)throw new Error("Invalid input to "+M+": must be a "+k+", given "+g.geometry.type)}c.featureOf=P;function L(g,k,M){if(!g)throw new Error("No featureCollection passed");if(!M)throw new Error(".collectionOf() requires a name");if(!g||g.type!=="FeatureCollection")throw new Error("Invalid input to "+M+", FeatureCollection required");for(var j=0,U=g.features;j<U.length;j++){var I=U[j];if(!I||I.type!=="Feature"||!I.geometry)throw new Error("Invalid input to "+M+", Feature with geometry required");if(!I.geometry||I.geometry.type!==k)throw new Error("Invalid input to "+M+": must be a "+k+", given "+I.geometry.type)}}c.collectionOf=L;function d(g){return g.type==="Feature"?g.geometry:g}c.getGeom=d;function E(g,k){return g.type==="FeatureCollection"?"FeatureCollection":g.type==="GeometryCollection"?"GeometryCollection":g.type==="Feature"&&g.geometry!==null?g.geometry.type:g.type}c.getType=E},31540:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var i=n(84102);function F(y,v,h){if(y!==null)for(var S,A,x,z,B,V,Q,oe=0,re=0,Z,ee=y.type,H=ee==="FeatureCollection",ae=ee==="Feature",G=H?y.features.length:1,ie=0;ie<G;ie++){Q=H?y.features[ie].geometry:ae?y.geometry:y,Z=Q?Q.type==="GeometryCollection":!1,B=Z?Q.geometries.length:1;for(var le=0;le<B;le++){var Me=0,ge=0;if(z=Z?Q.geometries[le]:Q,z!==null){V=z.coordinates;var pe=z.type;switch(oe=h&&(pe==="Polygon"||pe==="MultiPolygon")?1:0,pe){case null:break;case"Point":if(v(V,re,ie,Me,ge)===!1)return!1;re++,Me++;break;case"LineString":case"MultiPoint":for(S=0;S<V.length;S++){if(v(V[S],re,ie,Me,ge)===!1)return!1;re++,pe==="MultiPoint"&&Me++}pe==="LineString"&&Me++;break;case"Polygon":case"MultiLineString":for(S=0;S<V.length;S++){for(A=0;A<V[S].length-oe;A++){if(v(V[S][A],re,ie,Me,ge)===!1)return!1;re++}pe==="MultiLineString"&&Me++,pe==="Polygon"&&ge++}pe==="Polygon"&&Me++;break;case"MultiPolygon":for(S=0;S<V.length;S++){for(ge=0,A=0;A<V[S].length;A++){for(x=0;x<V[S][A].length-oe;x++){if(v(V[S][A][x],re,ie,Me,ge)===!1)return!1;re++}ge++}Me++}break;case"GeometryCollection":for(S=0;S<z.geometries.length;S++)if(F(z.geometries[S],v,h)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(y,v,h,S){var A=h;return F(y,function(x,z,B,V,Q){z===0&&h===void 0?A=x:A=v(A,x,z,B,V,Q)},S),A}function w(y,v){var h;switch(y.type){case"FeatureCollection":for(h=0;h<y.features.length&&v(y.features[h].properties,h)!==!1;h++);break;case"Feature":v(y.properties,0);break}}function _(y,v,h){var S=h;return w(y,function(A,x){x===0&&h===void 0?S=A:S=v(S,A,x)}),S}function P(y,v){if(y.type==="Feature")v(y,0);else if(y.type==="FeatureCollection")for(var h=0;h<y.features.length&&v(y.features[h],h)!==!1;h++);}function L(y,v,h){var S=h;return P(y,function(A,x){x===0&&h===void 0?S=A:S=v(S,A,x)}),S}function d(y){var v=[];return F(y,function(h){v.push(h)}),v}function E(y,v){var h,S,A,x,z,B,V,Q,oe,re,Z=0,ee=y.type==="FeatureCollection",H=y.type==="Feature",ae=ee?y.features.length:1;for(h=0;h<ae;h++){for(B=ee?y.features[h].geometry:H?y.geometry:y,Q=ee?y.features[h].properties:H?y.properties:{},oe=ee?y.features[h].bbox:H?y.bbox:void 0,re=ee?y.features[h].id:H?y.id:void 0,V=B?B.type==="GeometryCollection":!1,z=V?B.geometries.length:1,A=0;A<z;A++){if(x=V?B.geometries[A]:B,x===null){if(v(null,Z,Q,oe,re)===!1)return!1;continue}switch(x.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(v(x,Z,Q,oe,re)===!1)return!1;break}case"GeometryCollection":{for(S=0;S<x.geometries.length;S++)if(v(x.geometries[S],Z,Q,oe,re)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Z++}}function g(y,v,h){var S=h;return E(y,function(A,x,z,B,V){x===0&&h===void 0?S=A:S=v(S,A,x,z,B,V)}),S}function k(y,v){E(y,function(h,S,A,x,z){var B=h===null?null:h.type;switch(B){case null:case"Point":case"LineString":case"Polygon":return v(i.feature(h,A,{bbox:x,id:z}),S,0)===!1?!1:void 0}var V;switch(B){case"MultiPoint":V="Point";break;case"MultiLineString":V="LineString";break;case"MultiPolygon":V="Polygon";break}for(var Q=0;Q<h.coordinates.length;Q++){var oe=h.coordinates[Q],re={type:V,coordinates:oe};if(v(i.feature(re,A),S,Q)===!1)return!1}})}function M(y,v,h){var S=h;return k(y,function(A,x,z){x===0&&z===0&&h===void 0?S=A:S=v(S,A,x,z)}),S}function j(y,v){k(y,function(h,S,A){var x=0;if(!!h.geometry){var z=h.geometry.type;if(!(z==="Point"||z==="MultiPoint")){var B,V=0,Q=0,oe=0;if(F(h,function(re,Z,ee,H,ae){if(B===void 0||S>V||H>Q||ae>oe){B=re,V=S,Q=H,oe=ae,x=0;return}var G=i.lineString([B,re],h.properties);if(v(G,S,A,ae,x)===!1)return!1;x++,B=re})===!1)return!1}}})}function U(y,v,h){var S=h,A=!1;return j(y,function(x,z,B,V,Q){A===!1&&h===void 0?S=x:S=v(S,x,z,B,V,Q),A=!0}),S}function I(y,v){if(!y)throw new Error("geojson is required");k(y,function(h,S,A){if(h.geometry!==null){var x=h.geometry.type,z=h.geometry.coordinates;switch(x){case"LineString":if(v(h,S,A,0,0)===!1)return!1;break;case"Polygon":for(var B=0;B<z.length;B++)if(v(i.lineString(z[B],h.properties),S,A,B)===!1)return!1;break}}})}function O(y,v,h){var S=h;return I(y,function(A,x,z,B){x===0&&h===void 0?S=A:S=v(S,A,x,z,B)}),S}function D(y,v){if(v=v||{},!i.isObject(v))throw new Error("options is invalid");var h=v.featureIndex||0,S=v.multiFeatureIndex||0,A=v.geometryIndex||0,x=v.segmentIndex||0,z=v.properties,B;switch(y.type){case"FeatureCollection":h<0&&(h=y.features.length+h),z=z||y.features[h].properties,B=y.features[h].geometry;break;case"Feature":z=z||y.properties,B=y.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":B=y;break;default:throw new Error("geojson is invalid")}if(B===null)return null;var V=B.coordinates;switch(B.type){case"Point":case"MultiPoint":return null;case"LineString":return x<0&&(x=V.length+x-1),i.lineString([V[x],V[x+1]],z,v);case"Polygon":return A<0&&(A=V.length+A),x<0&&(x=V[A].length+x-1),i.lineString([V[A][x],V[A][x+1]],z,v);case"MultiLineString":return S<0&&(S=V.length+S),x<0&&(x=V[S].length+x-1),i.lineString([V[S][x],V[S][x+1]],z,v);case"MultiPolygon":return S<0&&(S=V.length+S),A<0&&(A=V[S].length+A),x<0&&(x=V[S][A].length-x-1),i.lineString([V[S][A][x],V[S][A][x+1]],z,v)}throw new Error("geojson is invalid")}function R(y,v){if(v=v||{},!i.isObject(v))throw new Error("options is invalid");var h=v.featureIndex||0,S=v.multiFeatureIndex||0,A=v.geometryIndex||0,x=v.coordIndex||0,z=v.properties,B;switch(y.type){case"FeatureCollection":h<0&&(h=y.features.length+h),z=z||y.features[h].properties,B=y.features[h].geometry;break;case"Feature":z=z||y.properties,B=y.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":B=y;break;default:throw new Error("geojson is invalid")}if(B===null)return null;var V=B.coordinates;switch(B.type){case"Point":return i.point(V,z,v);case"MultiPoint":return S<0&&(S=V.length+S),i.point(V[S],z,v);case"LineString":return x<0&&(x=V.length+x),i.point(V[x],z,v);case"Polygon":return A<0&&(A=V.length+A),x<0&&(x=V[A].length+x),i.point(V[A][x],z,v);case"MultiLineString":return S<0&&(S=V.length+S),x<0&&(x=V[S].length+x),i.point(V[S][x],z,v);case"MultiPolygon":return S<0&&(S=V.length+S),A<0&&(A=V[S].length+A),x<0&&(x=V[S][A].length-x),i.point(V[S][A][x],z,v)}throw new Error("geojson is invalid")}c.coordAll=d,c.coordEach=F,c.coordReduce=o,c.featureEach=P,c.featureReduce=L,c.findPoint=R,c.findSegment=D,c.flattenEach=k,c.flattenReduce=M,c.geomEach=E,c.geomReduce=g,c.lineEach=I,c.lineReduce=O,c.propEach=w,c.propReduce=_,c.segmentEach=j,c.segmentReduce=U},17781:function(){},4065:function(Te,c,n){"use strict";n.r(c),n.d(c,{ascending:function(){return i},bisect:function(){return L},bisectLeft:function(){return P},bisectRight:function(){return _},bisector:function(){return F},cross:function(){return g},descending:function(){return k},deviation:function(){return U},extent:function(){return I},histogram:function(){return oe},max:function(){return H},mean:function(){return ae},median:function(){return G},merge:function(){return ie},min:function(){return le},pairs:function(){return d},permute:function(){return Me},quantile:function(){return re},range:function(){return h},scan:function(){return ge},shuffle:function(){return pe},sum:function(){return Ne},thresholdFreedmanDiaconis:function(){return Z},thresholdScott:function(){return ee},thresholdSturges:function(){return Q},tickIncrement:function(){return B},tickStep:function(){return V},ticks:function(){return z},transpose:function(){return Re},variance:function(){return j},zip:function(){return se}});function i(J,fe){return J<fe?-1:J>fe?1:J>=fe?0:NaN}function F(J){return J.length===1&&(J=o(J)),{left:function(fe,me,Le,C){for(Le==null&&(Le=0),C==null&&(C=fe.length);Le<C;){var X=Le+C>>>1;J(fe[X],me)<0?Le=X+1:C=X}return Le},right:function(fe,me,Le,C){for(Le==null&&(Le=0),C==null&&(C=fe.length);Le<C;){var X=Le+C>>>1;J(fe[X],me)>0?C=X:Le=X+1}return Le}}}function o(J){return function(fe,me){return i(J(fe),me)}}var w=F(i),_=w.right,P=w.left,L=_;function d(J,fe){fe==null&&(fe=E);for(var me=0,Le=J.length-1,C=J[0],X=new Array(Le<0?0:Le);me<Le;)X[me]=fe(C,C=J[++me]);return X}function E(J,fe){return[J,fe]}function g(J,fe,me){var Le=J.length,C=fe.length,X=new Array(Le*C),de,Ae,De,Ge;for(me==null&&(me=E),de=De=0;de<Le;++de)for(Ge=J[de],Ae=0;Ae<C;++Ae,++De)X[De]=me(Ge,fe[Ae]);return X}function k(J,fe){return fe<J?-1:fe>J?1:fe>=J?0:NaN}function M(J){return J===null?NaN:+J}function j(J,fe){var me=J.length,Le=0,C=-1,X=0,de,Ae,De=0;if(fe==null)for(;++C<me;)isNaN(de=M(J[C]))||(Ae=de-X,X+=Ae/++Le,De+=Ae*(de-X));else for(;++C<me;)isNaN(de=M(fe(J[C],C,J)))||(Ae=de-X,X+=Ae/++Le,De+=Ae*(de-X));if(Le>1)return De/(Le-1)}function U(J,fe){var me=j(J,fe);return me&&Math.sqrt(me)}function I(J,fe){var me=J.length,Le=-1,C,X,de;if(fe==null){for(;++Le<me;)if((C=J[Le])!=null&&C>=C)for(X=de=C;++Le<me;)(C=J[Le])!=null&&(X>C&&(X=C),de<C&&(de=C))}else for(;++Le<me;)if((C=fe(J[Le],Le,J))!=null&&C>=C)for(X=de=C;++Le<me;)(C=fe(J[Le],Le,J))!=null&&(X>C&&(X=C),de<C&&(de=C));return[X,de]}var O=Array.prototype,D=O.slice,R=O.map;function y(J){return function(){return J}}function v(J){return J}function h(J,fe,me){J=+J,fe=+fe,me=(C=arguments.length)<2?(fe=J,J=0,1):C<3?1:+me;for(var Le=-1,C=Math.max(0,Math.ceil((fe-J)/me))|0,X=new Array(C);++Le<C;)X[Le]=J+Le*me;return X}var S=Math.sqrt(50),A=Math.sqrt(10),x=Math.sqrt(2);function z(J,fe,me){var Le,C=-1,X,de,Ae;if(fe=+fe,J=+J,me=+me,J===fe&&me>0)return[J];if((Le=fe<J)&&(X=J,J=fe,fe=X),(Ae=B(J,fe,me))===0||!isFinite(Ae))return[];if(Ae>0)for(J=Math.ceil(J/Ae),fe=Math.floor(fe/Ae),de=new Array(X=Math.ceil(fe-J+1));++C<X;)de[C]=(J+C)*Ae;else for(J=Math.floor(J*Ae),fe=Math.ceil(fe*Ae),de=new Array(X=Math.ceil(J-fe+1));++C<X;)de[C]=(J-C)/Ae;return Le&&de.reverse(),de}function B(J,fe,me){var Le=(fe-J)/Math.max(0,me),C=Math.floor(Math.log(Le)/Math.LN10),X=Le/Math.pow(10,C);return C>=0?(X>=S?10:X>=A?5:X>=x?2:1)*Math.pow(10,C):-Math.pow(10,-C)/(X>=S?10:X>=A?5:X>=x?2:1)}function V(J,fe,me){var Le=Math.abs(fe-J)/Math.max(0,me),C=Math.pow(10,Math.floor(Math.log(Le)/Math.LN10)),X=Le/C;return X>=S?C*=10:X>=A?C*=5:X>=x&&(C*=2),fe<J?-C:C}function Q(J){return Math.ceil(Math.log(J.length)/Math.LN2)+1}function oe(){var J=v,fe=I,me=Q;function Le(C){var X,de=C.length,Ae,De=new Array(de);for(X=0;X<de;++X)De[X]=J(C[X],X,C);var Ge=fe(De),$e=Ge[0],ct=Ge[1],gt=me(De,$e,ct);Array.isArray(gt)||(gt=V($e,ct,gt),gt=h(Math.ceil($e/gt)*gt,ct,gt));for(var st=gt.length;gt[0]<=$e;)gt.shift(),--st;for(;gt[st-1]>ct;)gt.pop(),--st;var xe=new Array(st+1),Mt;for(X=0;X<=st;++X)Mt=xe[X]=[],Mt.x0=X>0?gt[X-1]:$e,Mt.x1=X<st?gt[X]:ct;for(X=0;X<de;++X)Ae=De[X],$e<=Ae&&Ae<=ct&&xe[L(gt,Ae,0,st)].push(C[X]);return xe}return Le.value=function(C){return arguments.length?(J=typeof C=="function"?C:y(C),Le):J},Le.domain=function(C){return arguments.length?(fe=typeof C=="function"?C:y([C[0],C[1]]),Le):fe},Le.thresholds=function(C){return arguments.length?(me=typeof C=="function"?C:Array.isArray(C)?y(D.call(C)):y(C),Le):me},Le}function re(J,fe,me){if(me==null&&(me=M),!!(Le=J.length)){if((fe=+fe)<=0||Le<2)return+me(J[0],0,J);if(fe>=1)return+me(J[Le-1],Le-1,J);var Le,C=(Le-1)*fe,X=Math.floor(C),de=+me(J[X],X,J),Ae=+me(J[X+1],X+1,J);return de+(Ae-de)*(C-X)}}function Z(J,fe,me){return J=R.call(J,M).sort(i),Math.ceil((me-fe)/(2*(re(J,.75)-re(J,.25))*Math.pow(J.length,-1/3)))}function ee(J,fe,me){return Math.ceil((me-fe)/(3.5*U(J)*Math.pow(J.length,-1/3)))}function H(J,fe){var me=J.length,Le=-1,C,X;if(fe==null){for(;++Le<me;)if((C=J[Le])!=null&&C>=C)for(X=C;++Le<me;)(C=J[Le])!=null&&C>X&&(X=C)}else for(;++Le<me;)if((C=fe(J[Le],Le,J))!=null&&C>=C)for(X=C;++Le<me;)(C=fe(J[Le],Le,J))!=null&&C>X&&(X=C);return X}function ae(J,fe){var me=J.length,Le=me,C=-1,X,de=0;if(fe==null)for(;++C<me;)isNaN(X=M(J[C]))?--Le:de+=X;else for(;++C<me;)isNaN(X=M(fe(J[C],C,J)))?--Le:de+=X;if(Le)return de/Le}function G(J,fe){var me=J.length,Le=-1,C,X=[];if(fe==null)for(;++Le<me;)isNaN(C=M(J[Le]))||X.push(C);else for(;++Le<me;)isNaN(C=M(fe(J[Le],Le,J)))||X.push(C);return re(X.sort(i),.5)}function ie(J){for(var fe=J.length,me,Le=-1,C=0,X,de;++Le<fe;)C+=J[Le].length;for(X=new Array(C);--fe>=0;)for(de=J[fe],me=de.length;--me>=0;)X[--C]=de[me];return X}function le(J,fe){var me=J.length,Le=-1,C,X;if(fe==null){for(;++Le<me;)if((C=J[Le])!=null&&C>=C)for(X=C;++Le<me;)(C=J[Le])!=null&&X>C&&(X=C)}else for(;++Le<me;)if((C=fe(J[Le],Le,J))!=null&&C>=C)for(X=C;++Le<me;)(C=fe(J[Le],Le,J))!=null&&X>C&&(X=C);return X}function Me(J,fe){for(var me=fe.length,Le=new Array(me);me--;)Le[me]=J[fe[me]];return Le}function ge(J,fe){if(!!(me=J.length)){var me,Le=0,C=0,X,de=J[C];for(fe==null&&(fe=i);++Le<me;)(fe(X=J[Le],de)<0||fe(de,de)!==0)&&(de=X,C=Le);if(fe(de,de)===0)return C}}function pe(J,fe,me){for(var Le=(me==null?J.length:me)-(fe=fe==null?0:+fe),C,X;Le;)X=Math.random()*Le--|0,C=J[Le+fe],J[Le+fe]=J[X+fe],J[X+fe]=C;return J}function Ne(J,fe){var me=J.length,Le=-1,C,X=0;if(fe==null)for(;++Le<me;)(C=+J[Le])&&(X+=C);else for(;++Le<me;)(C=+fe(J[Le],Le,J))&&(X+=C);return X}function Re(J){if(!(X=J.length))return[];for(var fe=-1,me=le(J,he),Le=new Array(me);++fe<me;)for(var C=-1,X,de=Le[fe]=new Array(X);++C<X;)de[C]=J[C][fe];return Le}function he(J){return J.length}function se(){return Re(arguments)}},3054:function(Te,c,n){"use strict";n.r(c),n.d(c,{color:function(){return i.ZP},cubehelix:function(){return G},gray:function(){return U},hcl:function(){return A},hsl:function(){return i.Ym},lab:function(){return I},lch:function(){return S},rgb:function(){return i.B8}});var i=n(16372),F=n(44087),o=Math.PI/180,w=180/Math.PI,_=18,P=.96422,L=1,d=.82521,E=4/29,g=6/29,k=3*g*g,M=g*g*g;function j(le){if(le instanceof O)return new O(le.l,le.a,le.b,le.opacity);if(le instanceof x)return z(le);le instanceof i.Ss||(le=(0,i.SU)(le));var Me=v(le.r),ge=v(le.g),pe=v(le.b),Ne=D((.2225045*Me+.7168786*ge+.0606169*pe)/L),Re,he;return Me===ge&&ge===pe?Re=he=Ne:(Re=D((.4360747*Me+.3850649*ge+.1430804*pe)/P),he=D((.0139322*Me+.0971045*ge+.7141733*pe)/d)),new O(116*Ne-16,500*(Re-Ne),200*(Ne-he),le.opacity)}function U(le,Me){return new O(le,0,0,Me==null?1:Me)}function I(le,Me,ge,pe){return arguments.length===1?j(le):new O(le,Me,ge,pe==null?1:pe)}function O(le,Me,ge,pe){this.l=+le,this.a=+Me,this.b=+ge,this.opacity=+pe}(0,F.Z)(O,I,(0,F.l)(i.Il,{brighter:function(le){return new O(this.l+_*(le==null?1:le),this.a,this.b,this.opacity)},darker:function(le){return new O(this.l-_*(le==null?1:le),this.a,this.b,this.opacity)},rgb:function(){var le=(this.l+16)/116,Me=isNaN(this.a)?le:le+this.a/500,ge=isNaN(this.b)?le:le-this.b/200;return Me=P*R(Me),le=L*R(le),ge=d*R(ge),new i.Ss(y(3.1338561*Me-1.6168667*le-.4906146*ge),y(-.9787684*Me+1.9161415*le+.033454*ge),y(.0719453*Me-.2289914*le+1.4052427*ge),this.opacity)}}));function D(le){return le>M?Math.pow(le,1/3):le/k+E}function R(le){return le>g?le*le*le:k*(le-E)}function y(le){return 255*(le<=.0031308?12.92*le:1.055*Math.pow(le,1/2.4)-.055)}function v(le){return(le/=255)<=.04045?le/12.92:Math.pow((le+.055)/1.055,2.4)}function h(le){if(le instanceof x)return new x(le.h,le.c,le.l,le.opacity);if(le instanceof O||(le=j(le)),le.a===0&&le.b===0)return new x(NaN,0<le.l&&le.l<100?0:NaN,le.l,le.opacity);var Me=Math.atan2(le.b,le.a)*w;return new x(Me<0?Me+360:Me,Math.sqrt(le.a*le.a+le.b*le.b),le.l,le.opacity)}function S(le,Me,ge,pe){return arguments.length===1?h(le):new x(ge,Me,le,pe==null?1:pe)}function A(le,Me,ge,pe){return arguments.length===1?h(le):new x(le,Me,ge,pe==null?1:pe)}function x(le,Me,ge,pe){this.h=+le,this.c=+Me,this.l=+ge,this.opacity=+pe}function z(le){if(isNaN(le.h))return new O(le.l,0,0,le.opacity);var Me=le.h*o;return new O(le.l,Math.cos(Me)*le.c,Math.sin(Me)*le.c,le.opacity)}(0,F.Z)(x,A,(0,F.l)(i.Il,{brighter:function(le){return new x(this.h,this.c,this.l+_*(le==null?1:le),this.opacity)},darker:function(le){return new x(this.h,this.c,this.l-_*(le==null?1:le),this.opacity)},rgb:function(){return z(this).rgb()}}));var B=-.14861,V=1.78277,Q=-.29227,oe=-.90649,re=1.97294,Z=re*oe,ee=re*V,H=V*Q-oe*B;function ae(le){if(le instanceof ie)return new ie(le.h,le.s,le.l,le.opacity);le instanceof i.Ss||(le=(0,i.SU)(le));var Me=le.r/255,ge=le.g/255,pe=le.b/255,Ne=(H*pe+Z*Me-ee*ge)/(H+Z-ee),Re=pe-Ne,he=(re*(ge-Ne)-Q*Re)/oe,se=Math.sqrt(he*he+Re*Re)/(re*Ne*(1-Ne)),J=se?Math.atan2(he,Re)*w-120:NaN;return new ie(J<0?J+360:J,se,Ne,le.opacity)}function G(le,Me,ge,pe){return arguments.length===1?ae(le):new ie(le,Me,ge,pe==null?1:pe)}function ie(le,Me,ge,pe){this.h=+le,this.s=+Me,this.l=+ge,this.opacity=+pe}(0,F.Z)(ie,G,(0,F.l)(i.Il,{brighter:function(le){return le=le==null?i.J5:Math.pow(i.J5,le),new ie(this.h,this.s,this.l*le,this.opacity)},darker:function(le){return le=le==null?i.xV:Math.pow(i.xV,le),new ie(this.h,this.s,this.l*le,this.opacity)},rgb:function(){var le=isNaN(this.h)?0:(this.h+120)*o,Me=+this.l,ge=isNaN(this.s)?0:this.s*Me*(1-Me),pe=Math.cos(le),Ne=Math.sin(le);return new i.Ss(255*(Me+ge*(B*pe+V*Ne)),255*(Me+ge*(Q*pe+oe*Ne)),255*(Me+ge*(re*pe)),this.opacity)}}))},12647:function(Te,c,n){"use strict";n.r(c),n.d(c,{autoType:function(){return oe},csvFormat:function(){return O},csvFormatBody:function(){return D},csvFormatRow:function(){return y},csvFormatRows:function(){return R},csvFormatValue:function(){return v},csvParse:function(){return U},csvParseRows:function(){return I},dsvFormat:function(){return M},tsvFormat:function(){return x},tsvFormatBody:function(){return z},tsvFormatRow:function(){return V},tsvFormatRows:function(){return B},tsvFormatValue:function(){return Q},tsvParse:function(){return S},tsvParseRows:function(){return A}});var i={},F={},o=34,w=10,_=13;function P(Z){return new Function("d","return {"+Z.map(function(ee,H){return JSON.stringify(ee)+": d["+H+'] || ""'}).join(",")+"}")}function L(Z,ee){var H=P(Z);return function(ae,G){return ee(H(ae),G,Z)}}function d(Z){var ee=Object.create(null),H=[];return Z.forEach(function(ae){for(var G in ae)G in ee||H.push(ee[G]=G)}),H}function E(Z,ee){var H=Z+"",ae=H.length;return ae<ee?new Array(ee-ae+1).join(0)+H:H}function g(Z){return Z<0?"-"+E(-Z,6):Z>9999?"+"+E(Z,6):E(Z,4)}function k(Z){var ee=Z.getUTCHours(),H=Z.getUTCMinutes(),ae=Z.getUTCSeconds(),G=Z.getUTCMilliseconds();return isNaN(Z)?"Invalid Date":g(Z.getUTCFullYear(),4)+"-"+E(Z.getUTCMonth()+1,2)+"-"+E(Z.getUTCDate(),2)+(G?"T"+E(ee,2)+":"+E(H,2)+":"+E(ae,2)+"."+E(G,3)+"Z":ae?"T"+E(ee,2)+":"+E(H,2)+":"+E(ae,2)+"Z":H||ee?"T"+E(ee,2)+":"+E(H,2)+"Z":"")}function M(Z){var ee=new RegExp('["'+Z+`
\r]`),H=Z.charCodeAt(0);function ae(Re,he){var se,J,fe=G(Re,function(me,Le){if(se)return se(me,Le-1);J=me,se=he?L(me,he):P(me)});return fe.columns=J||[],fe}function G(Re,he){var se=[],J=Re.length,fe=0,me=0,Le,C=J<=0,X=!1;Re.charCodeAt(J-1)===w&&--J,Re.charCodeAt(J-1)===_&&--J;function de(){if(C)return F;if(X)return X=!1,i;var De,Ge=fe,$e;if(Re.charCodeAt(Ge)===o){for(;fe++<J&&Re.charCodeAt(fe)!==o||Re.charCodeAt(++fe)===o;);return(De=fe)>=J?C=!0:($e=Re.charCodeAt(fe++))===w?X=!0:$e===_&&(X=!0,Re.charCodeAt(fe)===w&&++fe),Re.slice(Ge+1,De-1).replace(/""/g,'"')}for(;fe<J;){if(($e=Re.charCodeAt(De=fe++))===w)X=!0;else if($e===_)X=!0,Re.charCodeAt(fe)===w&&++fe;else if($e!==H)continue;return Re.slice(Ge,De)}return C=!0,Re.slice(Ge,J)}for(;(Le=de())!==F;){for(var Ae=[];Le!==i&&Le!==F;)Ae.push(Le),Le=de();he&&(Ae=he(Ae,me++))==null||se.push(Ae)}return se}function ie(Re,he){return Re.map(function(se){return he.map(function(J){return Ne(se[J])}).join(Z)})}function le(Re,he){return he==null&&(he=d(Re)),[he.map(Ne).join(Z)].concat(ie(Re,he)).join(`
`)}function Me(Re,he){return he==null&&(he=d(Re)),ie(Re,he).join(`
`)}function ge(Re){return Re.map(pe).join(`
`)}function pe(Re){return Re.map(Ne).join(Z)}function Ne(Re){return Re==null?"":Re instanceof Date?k(Re):ee.test(Re+="")?'"'+Re.replace(/"/g,'""')+'"':Re}return{parse:ae,parseRows:G,format:le,formatBody:Me,formatRows:ge,formatRow:pe,formatValue:Ne}}var j=M(","),U=j.parse,I=j.parseRows,O=j.format,D=j.formatBody,R=j.formatRows,y=j.formatRow,v=j.formatValue,h=M("	"),S=h.parse,A=h.parseRows,x=h.format,z=h.formatBody,B=h.formatRows,V=h.formatRow,Q=h.formatValue;function oe(Z){for(var ee in Z){var H=Z[ee].trim(),ae,G;if(!H)H=null;else if(H==="true")H=!0;else if(H==="false")H=!1;else if(H==="NaN")H=NaN;else if(!isNaN(ae=+H))H=ae;else if(G=H.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))re&&!!G[4]&&!G[7]&&(H=H.replace(/-/g,"/").replace(/T/," ")),H=new Date(H);else continue;Z[ee]=H}return Z}var re=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours()},43774:function(Te,c,n){"use strict";n.r(c),n.d(c,{hexbin:function(){return _}});var i=Math.PI/3,F=[0,i,2*i,3*i,4*i,5*i];function o(P){return P[0]}function w(P){return P[1]}function _(){var P=0,L=0,d=1,E=1,g=o,k=w,M,j,U;function I(D){var R={},y=[],v,h=D.length;for(v=0;v<h;++v)if(!(isNaN(A=+g.call(null,S=D[v],v,D))||isNaN(x=+k.call(null,S,v,D)))){var S,A,x,z=Math.round(x=x/U),B=Math.round(A=A/j-(z&1)/2),V=x-z;if(Math.abs(V)*3>1){var Q=A-B,oe=B+(A<B?-1:1)/2,re=z+(x<z?-1:1),Z=A-oe,ee=x-re;Q*Q+V*V>Z*Z+ee*ee&&(B=oe+(z&1?1:-1)/2,z=re)}var H=B+"-"+z,ae=R[H];ae?ae.push(S):(y.push(ae=R[H]=[S]),ae.x=(B+(z&1)/2)*j,ae.y=z*U)}return y}function O(D){var R=0,y=0;return F.map(function(v){var h=Math.sin(v)*D,S=-Math.cos(v)*D,A=h-R,x=S-y;return R=h,y=S,[A,x]})}return I.hexagon=function(D){return"m"+O(D==null?M:+D).join("l")+"z"},I.centers=function(){for(var D=[],R=Math.round(L/U),y=Math.round(P/j),v=R*U;v<E+M;v+=U,++R)for(var h=y*j+(R&1)*j/2;h<d+j/2;h+=j)D.push([h,v]);return D},I.mesh=function(){var D=O(M).slice(0,4).join("l");return I.centers().map(function(R){return"M"+R+"m"+D}).join("")},I.x=function(D){return arguments.length?(g=D,I):g},I.y=function(D){return arguments.length?(k=D,I):k},I.radius=function(D){return arguments.length?(M=+D,j=M*2*Math.sin(i),U=M*1.5,I):M},I.size=function(D){return arguments.length?(P=L=0,d=+D[0],E=+D[1],I):[d-P,E-L]},I.extent=function(D){return arguments.length?(P=+D[0][0],L=+D[0][1],d=+D[1][0],E=+D[1][1],I):[[P,L],[d,E]]},I.radius(1)}},94644:function(Te,c,n){"use strict";n.r(c),n.d(c,{scaleBand:function(){return S},scaleDiverging:function(){return fs},scaleDivergingLog:function(){return Uo},scaleDivergingPow:function(){return Su},scaleDivergingSqrt:function(){return es},scaleDivergingSymlog:function(){return Rs},scaleIdentity:function(){return Vt},scaleImplicit:function(){return v},scaleLinear:function(){return pt},scaleLog:function(){return Si},scaleOrdinal:function(){return h},scalePoint:function(){return x},scalePow:function(){return Ye},scaleQuantile:function(){return Zt},scaleQuantize:function(){return Lr},scaleSequential:function(){return xs},scaleSequentialLog:function(){return jo},scaleSequentialPow:function(){return pn},scaleSequentialQuantile:function(){return Ns},scaleSequentialSqrt:function(){return Nl},scaleSequentialSymlog:function(){return qu},scaleSqrt:function(){return Et},scaleSymlog:function(){return ze},scaleThreshold:function(){return ir},scaleTime:function(){return mc},scaleUtc:function(){return Io},tickFormat:function(){return nt}});var i=n(4065);function F(q,Oe){switch(arguments.length){case 0:break;case 1:this.range(q);break;default:this.range(Oe).domain(q);break}return this}function o(q,Oe){switch(arguments.length){case 0:break;case 1:this.interpolator(q);break;default:this.interpolator(Oe).domain(q);break}return this}var w="$";function _(){}_.prototype=P.prototype={constructor:_,has:function(q){return w+q in this},get:function(q){return this[w+q]},set:function(q,Oe){return this[w+q]=Oe,this},remove:function(q){var Oe=w+q;return Oe in this&&delete this[Oe]},clear:function(){for(var q in this)q[0]===w&&delete this[q]},keys:function(){var q=[];for(var Oe in this)Oe[0]===w&&q.push(Oe.slice(1));return q},values:function(){var q=[];for(var Oe in this)Oe[0]===w&&q.push(this[Oe]);return q},entries:function(){var q=[];for(var Oe in this)Oe[0]===w&&q.push({key:Oe.slice(1),value:this[Oe]});return q},size:function(){var q=0;for(var Oe in this)Oe[0]===w&&++q;return q},empty:function(){for(var q in this)if(q[0]===w)return!1;return!0},each:function(q){for(var Oe in this)Oe[0]===w&&q(this[Oe],Oe.slice(1),this)}};function P(q,Oe){var vt=new _;if(q instanceof _)q.each(function(nr,Dr){vt.set(Dr,nr)});else if(Array.isArray(q)){var ht=-1,cr=q.length,Qt;if(Oe==null)for(;++ht<cr;)vt.set(ht,q[ht]);else for(;++ht<cr;)vt.set(Oe(Qt=q[ht],ht,q),Qt)}else if(q)for(var hr in q)vt.set(hr,q[hr]);return vt}var L=P;function d(){var q=[],Oe=[],vt,ht,cr;function Qt(nr,Dr,An,Bn){if(Dr>=q.length)return vt!=null&&nr.sort(vt),ht!=null?ht(nr):nr;for(var Ln=-1,Wn=nr.length,ri=q[Dr++],ta,Da,gn=map(),yn,yo=An();++Ln<Wn;)(yn=gn.get(ta=ri(Da=nr[Ln])+""))?yn.push(Da):gn.set(ta,[Da]);return gn.each(function(ga,Na){Bn(yo,Na,Qt(ga,Dr,An,Bn))}),yo}function hr(nr,Dr){if(++Dr>q.length)return nr;var An,Bn=Oe[Dr-1];return ht!=null&&Dr>=q.length?An=nr.entries():(An=[],nr.each(function(Ln,Wn){An.push({key:Wn,values:hr(Ln,Dr)})})),Bn!=null?An.sort(function(Ln,Wn){return Bn(Ln.key,Wn.key)}):An}return cr={object:function(nr){return Qt(nr,0,E,g)},map:function(nr){return Qt(nr,0,k,M)},entries:function(nr){return hr(Qt(nr,0,k,M),0)},key:function(nr){return q.push(nr),cr},sortKeys:function(nr){return Oe[q.length-1]=nr,cr},sortValues:function(nr){return vt=nr,cr},rollup:function(nr){return ht=nr,cr}}}function E(){return{}}function g(q,Oe,vt){q[Oe]=vt}function k(){return map()}function M(q,Oe,vt){q.set(Oe,vt)}function j(){}var U=L.prototype;j.prototype=I.prototype={constructor:j,has:U.has,add:function(q){return q+="",this[w+q]=q,this},remove:U.remove,clear:U.clear,values:U.keys,size:U.size,empty:U.empty,each:U.each};function I(q,Oe){var vt=new j;if(q instanceof j)q.each(function(Qt){vt.add(Qt)});else if(q){var ht=-1,cr=q.length;if(Oe==null)for(;++ht<cr;)vt.add(q[ht]);else for(;++ht<cr;)vt.add(Oe(q[ht],ht,q))}return vt}var O=null,D=Array.prototype,R=D.map,y=D.slice,v={name:"implicit"};function h(){var q=L(),Oe=[],vt=[],ht=v;function cr(Qt){var hr=Qt+"",nr=q.get(hr);if(!nr){if(ht!==v)return ht;q.set(hr,nr=Oe.push(Qt))}return vt[(nr-1)%vt.length]}return cr.domain=function(Qt){if(!arguments.length)return Oe.slice();Oe=[],q=L();for(var hr=-1,nr=Qt.length,Dr,An;++hr<nr;)q.has(An=(Dr=Qt[hr])+"")||q.set(An,Oe.push(Dr));return cr},cr.range=function(Qt){return arguments.length?(vt=y.call(Qt),cr):vt.slice()},cr.unknown=function(Qt){return arguments.length?(ht=Qt,cr):ht},cr.copy=function(){return h(Oe,vt).unknown(ht)},F.apply(cr,arguments),cr}function S(){var q=h().unknown(void 0),Oe=q.domain,vt=q.range,ht=[0,1],cr,Qt,hr=!1,nr=0,Dr=0,An=.5;delete q.unknown;function Bn(){var Ln=Oe().length,Wn=ht[1]<ht[0],ri=ht[Wn-0],ta=ht[1-Wn];cr=(ta-ri)/Math.max(1,Ln-nr+Dr*2),hr&&(cr=Math.floor(cr)),ri+=(ta-ri-cr*(Ln-nr))*An,Qt=cr*(1-nr),hr&&(ri=Math.round(ri),Qt=Math.round(Qt));var Da=(0,i.range)(Ln).map(function(gn){return ri+cr*gn});return vt(Wn?Da.reverse():Da)}return q.domain=function(Ln){return arguments.length?(Oe(Ln),Bn()):Oe()},q.range=function(Ln){return arguments.length?(ht=[+Ln[0],+Ln[1]],Bn()):ht.slice()},q.rangeRound=function(Ln){return ht=[+Ln[0],+Ln[1]],hr=!0,Bn()},q.bandwidth=function(){return Qt},q.step=function(){return cr},q.round=function(Ln){return arguments.length?(hr=!!Ln,Bn()):hr},q.padding=function(Ln){return arguments.length?(nr=Math.min(1,Dr=+Ln),Bn()):nr},q.paddingInner=function(Ln){return arguments.length?(nr=Math.min(1,Ln),Bn()):nr},q.paddingOuter=function(Ln){return arguments.length?(Dr=+Ln,Bn()):Dr},q.align=function(Ln){return arguments.length?(An=Math.max(0,Math.min(1,Ln)),Bn()):An},q.copy=function(){return S(Oe(),ht).round(hr).paddingInner(nr).paddingOuter(Dr).align(An)},F.apply(Bn(),arguments)}function A(q){var Oe=q.copy;return q.padding=q.paddingOuter,delete q.paddingInner,delete q.paddingOuter,q.copy=function(){return A(Oe())},q}function x(){return A(S.apply(null,arguments).paddingInner(1))}var z=n(26257),B=n(73626);function V(q,Oe){return q=+q,Oe=+Oe,function(vt){return Math.round(q*(1-vt)+Oe*vt)}}function Q(q){return function(){return q}}function oe(q){return+q}var re=[0,1];function Z(q){return q}function ee(q,Oe){return(Oe-=q=+q)?function(vt){return(vt-q)/Oe}:Q(isNaN(Oe)?NaN:.5)}function H(q){var Oe=q[0],vt=q[q.length-1],ht;return Oe>vt&&(ht=Oe,Oe=vt,vt=ht),function(cr){return Math.max(Oe,Math.min(vt,cr))}}function ae(q,Oe,vt){var ht=q[0],cr=q[1],Qt=Oe[0],hr=Oe[1];return cr<ht?(ht=ee(cr,ht),Qt=vt(hr,Qt)):(ht=ee(ht,cr),Qt=vt(Qt,hr)),function(nr){return Qt(ht(nr))}}function G(q,Oe,vt){var ht=Math.min(q.length,Oe.length)-1,cr=new Array(ht),Qt=new Array(ht),hr=-1;for(q[ht]<q[0]&&(q=q.slice().reverse(),Oe=Oe.slice().reverse());++hr<ht;)cr[hr]=ee(q[hr],q[hr+1]),Qt[hr]=vt(Oe[hr],Oe[hr+1]);return function(nr){var Dr=(0,i.bisect)(q,nr,1,ht)-1;return Qt[Dr](cr[Dr](nr))}}function ie(q,Oe){return Oe.domain(q.domain()).range(q.range()).interpolate(q.interpolate()).clamp(q.clamp()).unknown(q.unknown())}function le(){var q=re,Oe=re,vt=z.Z,ht,cr,Qt,hr=Z,nr,Dr,An;function Bn(){return nr=Math.min(q.length,Oe.length)>2?G:ae,Dr=An=null,Ln}function Ln(Wn){return isNaN(Wn=+Wn)?Qt:(Dr||(Dr=nr(q.map(ht),Oe,vt)))(ht(hr(Wn)))}return Ln.invert=function(Wn){return hr(cr((An||(An=nr(Oe,q.map(ht),B.Z)))(Wn)))},Ln.domain=function(Wn){return arguments.length?(q=R.call(Wn,oe),hr===Z||(hr=H(q)),Bn()):q.slice()},Ln.range=function(Wn){return arguments.length?(Oe=y.call(Wn),Bn()):Oe.slice()},Ln.rangeRound=function(Wn){return Oe=y.call(Wn),vt=V,Bn()},Ln.clamp=function(Wn){return arguments.length?(hr=Wn?H(q):Z,Ln):hr!==Z},Ln.interpolate=function(Wn){return arguments.length?(vt=Wn,Bn()):vt},Ln.unknown=function(Wn){return arguments.length?(Qt=Wn,Ln):Qt},function(Wn,ri){return ht=Wn,cr=ri,Bn()}}function Me(q,Oe){return le()(q,Oe)}var ge=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pe(q){if(!(Oe=ge.exec(q)))throw new Error("invalid format: "+q);var Oe;return new Ne({fill:Oe[1],align:Oe[2],sign:Oe[3],symbol:Oe[4],zero:Oe[5],width:Oe[6],comma:Oe[7],precision:Oe[8]&&Oe[8].slice(1),trim:Oe[9],type:Oe[10]})}pe.prototype=Ne.prototype;function Ne(q){this.fill=q.fill===void 0?" ":q.fill+"",this.align=q.align===void 0?">":q.align+"",this.sign=q.sign===void 0?"-":q.sign+"",this.symbol=q.symbol===void 0?"":q.symbol+"",this.zero=!!q.zero,this.width=q.width===void 0?void 0:+q.width,this.comma=!!q.comma,this.precision=q.precision===void 0?void 0:+q.precision,this.trim=!!q.trim,this.type=q.type===void 0?"":q.type+""}Ne.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Re(q){return Math.abs(q=Math.round(q))>=1e21?q.toLocaleString("en").replace(/,/g,""):q.toString(10)}function he(q,Oe){if((vt=(q=Oe?q.toExponential(Oe-1):q.toExponential()).indexOf("e"))<0)return null;var vt,ht=q.slice(0,vt);return[ht.length>1?ht[0]+ht.slice(2):ht,+q.slice(vt+1)]}function se(q){return q=he(Math.abs(q)),q?q[1]:NaN}function J(q,Oe){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(se(Oe)/3)))*3-se(Math.abs(q)))}function fe(q,Oe){return function(vt,ht){for(var cr=vt.length,Qt=[],hr=0,nr=q[0],Dr=0;cr>0&&nr>0&&(Dr+nr+1>ht&&(nr=Math.max(1,ht-Dr)),Qt.push(vt.substring(cr-=nr,cr+nr)),!((Dr+=nr+1)>ht));)nr=q[hr=(hr+1)%q.length];return Qt.reverse().join(Oe)}}function me(q){return function(Oe){return Oe.replace(/[0-9]/g,function(vt){return q[+vt]})}}function Le(q){e:for(var Oe=q.length,vt=1,ht=-1,cr;vt<Oe;++vt)switch(q[vt]){case".":ht=cr=vt;break;case"0":ht===0&&(ht=vt),cr=vt;break;default:if(!+q[vt])break e;ht>0&&(ht=0);break}return ht>0?q.slice(0,ht)+q.slice(cr+1):q}var C;function X(q,Oe){var vt=he(q,Oe);if(!vt)return q+"";var ht=vt[0],cr=vt[1],Qt=cr-(C=Math.max(-8,Math.min(8,Math.floor(cr/3)))*3)+1,hr=ht.length;return Qt===hr?ht:Qt>hr?ht+new Array(Qt-hr+1).join("0"):Qt>0?ht.slice(0,Qt)+"."+ht.slice(Qt):"0."+new Array(1-Qt).join("0")+he(q,Math.max(0,Oe+Qt-1))[0]}function de(q,Oe){var vt=he(q,Oe);if(!vt)return q+"";var ht=vt[0],cr=vt[1];return cr<0?"0."+new Array(-cr).join("0")+ht:ht.length>cr+1?ht.slice(0,cr+1)+"."+ht.slice(cr+1):ht+new Array(cr-ht.length+2).join("0")}var Ae={"%":function(q,Oe){return(q*100).toFixed(Oe)},b:function(q){return Math.round(q).toString(2)},c:function(q){return q+""},d:Re,e:function(q,Oe){return q.toExponential(Oe)},f:function(q,Oe){return q.toFixed(Oe)},g:function(q,Oe){return q.toPrecision(Oe)},o:function(q){return Math.round(q).toString(8)},p:function(q,Oe){return de(q*100,Oe)},r:de,s:X,X:function(q){return Math.round(q).toString(16).toUpperCase()},x:function(q){return Math.round(q).toString(16)}};function De(q){return q}var Ge=Array.prototype.map,$e=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function ct(q){var Oe=q.grouping===void 0||q.thousands===void 0?De:fe(Ge.call(q.grouping,Number),q.thousands+""),vt=q.currency===void 0?"":q.currency[0]+"",ht=q.currency===void 0?"":q.currency[1]+"",cr=q.decimal===void 0?".":q.decimal+"",Qt=q.numerals===void 0?De:me(Ge.call(q.numerals,String)),hr=q.percent===void 0?"%":q.percent+"",nr=q.minus===void 0?"-":q.minus+"",Dr=q.nan===void 0?"NaN":q.nan+"";function An(Ln){Ln=pe(Ln);var Wn=Ln.fill,ri=Ln.align,ta=Ln.sign,Da=Ln.symbol,gn=Ln.zero,yn=Ln.width,yo=Ln.comma,ga=Ln.precision,Na=Ln.trim,xa=Ln.type;xa==="n"?(yo=!0,xa="g"):Ae[xa]||(ga===void 0&&(ga=12),Na=!0,xa="g"),(gn||Wn==="0"&&ri==="=")&&(gn=!0,Wn="0",ri="=");var ao=Da==="$"?vt:Da==="#"&&/[boxX]/.test(xa)?"0"+xa.toLowerCase():"",Mi=Da==="$"?ht:/[%p]/.test(xa)?hr:"",ho=Ae[xa],Ni=/[defgprs%]/.test(xa);ga=ga===void 0?6:/[gprs]/.test(xa)?Math.max(1,Math.min(21,ga)):Math.max(0,Math.min(20,ga));function Qi(Gi){var ba=ao,ka=Mi,No,Ro,ws;if(xa==="c")ka=ho(Gi)+ka,Gi="";else{Gi=+Gi;var Vo=Gi<0||1/Gi<0;if(Gi=isNaN(Gi)?Dr:ho(Math.abs(Gi),ga),Na&&(Gi=Le(Gi)),Vo&&+Gi==0&&ta!=="+"&&(Vo=!1),ba=(Vo?ta==="("?ta:nr:ta==="-"||ta==="("?"":ta)+ba,ka=(xa==="s"?$e[8+C/3]:"")+ka+(Vo&&ta==="("?")":""),Ni){for(No=-1,Ro=Gi.length;++No<Ro;)if(ws=Gi.charCodeAt(No),48>ws||ws>57){ka=(ws===46?cr+Gi.slice(No+1):Gi.slice(No))+ka,Gi=Gi.slice(0,No);break}}}yo&&!gn&&(Gi=Oe(Gi,Infinity));var Bs=ba.length+Gi.length+ka.length,Go=Bs<yn?new Array(yn-Bs+1).join(Wn):"";switch(yo&&gn&&(Gi=Oe(Go+Gi,Go.length?yn-ka.length:Infinity),Go=""),ri){case"<":Gi=ba+Gi+ka+Go;break;case"=":Gi=ba+Go+Gi+ka;break;case"^":Gi=Go.slice(0,Bs=Go.length>>1)+ba+Gi+ka+Go.slice(Bs);break;default:Gi=Go+ba+Gi+ka;break}return Qt(Gi)}return Qi.toString=function(){return Ln+""},Qi}function Bn(Ln,Wn){var ri=An((Ln=pe(Ln),Ln.type="f",Ln)),ta=Math.max(-8,Math.min(8,Math.floor(se(Wn)/3)))*3,Da=Math.pow(10,-ta),gn=$e[8+ta/3];return function(yn){return ri(Da*yn)+gn}}return{format:An,formatPrefix:Bn}}var gt,st,xe;Mt({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Mt(q){return gt=ct(q),st=gt.format,xe=gt.formatPrefix,gt}function Ut(q,Oe){return q=Math.abs(q),Oe=Math.abs(Oe)-q,Math.max(0,se(Oe)-se(q))+1}function At(q){return Math.max(0,-se(Math.abs(q)))}function nt(q,Oe,vt,ht){var cr=(0,i.tickStep)(q,Oe,vt),Qt;switch(ht=pe(ht==null?",f":ht),ht.type){case"s":{var hr=Math.max(Math.abs(q),Math.abs(Oe));return ht.precision==null&&!isNaN(Qt=J(cr,hr))&&(ht.precision=Qt),xe(ht,hr)}case"":case"e":case"g":case"p":case"r":{ht.precision==null&&!isNaN(Qt=Ut(cr,Math.max(Math.abs(q),Math.abs(Oe))))&&(ht.precision=Qt-(ht.type==="e"));break}case"f":case"%":{ht.precision==null&&!isNaN(Qt=At(cr))&&(ht.precision=Qt-(ht.type==="%")*2);break}}return st(ht)}function it(q){var Oe=q.domain;return q.ticks=function(vt){var ht=Oe();return(0,i.ticks)(ht[0],ht[ht.length-1],vt==null?10:vt)},q.tickFormat=function(vt,ht){var cr=Oe();return nt(cr[0],cr[cr.length-1],vt==null?10:vt,ht)},q.nice=function(vt){vt==null&&(vt=10);var ht=Oe(),cr=0,Qt=ht.length-1,hr=ht[cr],nr=ht[Qt],Dr;return nr<hr&&(Dr=hr,hr=nr,nr=Dr,Dr=cr,cr=Qt,Qt=Dr),Dr=(0,i.tickIncrement)(hr,nr,vt),Dr>0?(hr=Math.floor(hr/Dr)*Dr,nr=Math.ceil(nr/Dr)*Dr,Dr=(0,i.tickIncrement)(hr,nr,vt)):Dr<0&&(hr=Math.ceil(hr*Dr)/Dr,nr=Math.floor(nr*Dr)/Dr,Dr=(0,i.tickIncrement)(hr,nr,vt)),Dr>0?(ht[cr]=Math.floor(hr/Dr)*Dr,ht[Qt]=Math.ceil(nr/Dr)*Dr,Oe(ht)):Dr<0&&(ht[cr]=Math.ceil(hr*Dr)/Dr,ht[Qt]=Math.floor(nr*Dr)/Dr,Oe(ht)),q},q}function pt(){var q=Me(Z,Z);return q.copy=function(){return ie(q,pt())},F.apply(q,arguments),it(q)}function Vt(q){var Oe;function vt(ht){return isNaN(ht=+ht)?Oe:ht}return vt.invert=vt,vt.domain=vt.range=function(ht){return arguments.length?(q=R.call(ht,oe),vt):q.slice()},vt.unknown=function(ht){return arguments.length?(Oe=ht,vt):Oe},vt.copy=function(){return Vt(q).unknown(Oe)},q=arguments.length?R.call(q,oe):[0,1],it(vt)}function Er(q,Oe){q=q.slice();var vt=0,ht=q.length-1,cr=q[vt],Qt=q[ht],hr;return Qt<cr&&(hr=vt,vt=ht,ht=hr,hr=cr,cr=Qt,Qt=hr),q[vt]=Oe.floor(cr),q[ht]=Oe.ceil(Qt),q}function mr(q){return Math.log(q)}function Br(q){return Math.exp(q)}function Ur(q){return-Math.log(-q)}function Ar(q){return-Math.exp(-q)}function Nn(q){return isFinite(q)?+("1e"+q):q<0?0:q}function Rn(q){return q===10?Nn:q===Math.E?Math.exp:function(Oe){return Math.pow(q,Oe)}}function ci(q){return q===Math.E?Math.log:q===10&&Math.log10||q===2&&Math.log2||(q=Math.log(q),function(Oe){return Math.log(Oe)/q})}function Fi(q){return function(Oe){return-q(-Oe)}}function ji(q){var Oe=q(mr,Br),vt=Oe.domain,ht=10,cr,Qt;function hr(){return cr=ci(ht),Qt=Rn(ht),vt()[0]<0?(cr=Fi(cr),Qt=Fi(Qt),q(Ur,Ar)):q(mr,Br),Oe}return Oe.base=function(nr){return arguments.length?(ht=+nr,hr()):ht},Oe.domain=function(nr){return arguments.length?(vt(nr),hr()):vt()},Oe.ticks=function(nr){var Dr=vt(),An=Dr[0],Bn=Dr[Dr.length-1],Ln;(Ln=Bn<An)&&(Wn=An,An=Bn,Bn=Wn);var Wn=cr(An),ri=cr(Bn),ta,Da,gn,yn=nr==null?10:+nr,yo=[];if(!(ht%1)&&ri-Wn<yn){if(Wn=Math.round(Wn)-1,ri=Math.round(ri)+1,An>0){for(;Wn<ri;++Wn)for(Da=1,ta=Qt(Wn);Da<ht;++Da)if(gn=ta*Da,!(gn<An)){if(gn>Bn)break;yo.push(gn)}}else for(;Wn<ri;++Wn)for(Da=ht-1,ta=Qt(Wn);Da>=1;--Da)if(gn=ta*Da,!(gn<An)){if(gn>Bn)break;yo.push(gn)}}else yo=(0,i.ticks)(Wn,ri,Math.min(ri-Wn,yn)).map(Qt);return Ln?yo.reverse():yo},Oe.tickFormat=function(nr,Dr){if(Dr==null&&(Dr=ht===10?".0e":","),typeof Dr!="function"&&(Dr=st(Dr)),nr===Infinity)return Dr;nr==null&&(nr=10);var An=Math.max(1,ht*nr/Oe.ticks().length);return function(Bn){var Ln=Bn/Qt(Math.round(cr(Bn)));return Ln*ht<ht-.5&&(Ln*=ht),Ln<=An?Dr(Bn):""}},Oe.nice=function(){return vt(Er(vt(),{floor:function(nr){return Qt(Math.floor(cr(nr)))},ceil:function(nr){return Qt(Math.ceil(cr(nr)))}}))},Oe}function Si(){var q=ji(le()).domain([1,10]);return q.copy=function(){return ie(q,Si()).base(q.base())},F.apply(q,arguments),q}function xi(q){return function(Oe){return Math.sign(Oe)*Math.log1p(Math.abs(Oe/q))}}function Ee(q){return function(Oe){return Math.sign(Oe)*Math.expm1(Math.abs(Oe))*q}}function ke(q){var Oe=1,vt=q(xi(Oe),Ee(Oe));return vt.constant=function(ht){return arguments.length?q(xi(Oe=+ht),Ee(Oe)):Oe},it(vt)}function ze(){var q=ke(le());return q.copy=function(){return ie(q,ze()).constant(q.constant())},F.apply(q,arguments)}function Ke(q){return function(Oe){return Oe<0?-Math.pow(-Oe,q):Math.pow(Oe,q)}}function ot(q){return q<0?-Math.sqrt(-q):Math.sqrt(q)}function Rt(q){return q<0?-q*q:q*q}function Nt(q){var Oe=q(Z,Z),vt=1;function ht(){return vt===1?q(Z,Z):vt===.5?q(ot,Rt):q(Ke(vt),Ke(1/vt))}return Oe.exponent=function(cr){return arguments.length?(vt=+cr,ht()):vt},it(Oe)}function Ye(){var q=Nt(le());return q.copy=function(){return ie(q,Ye()).exponent(q.exponent())},F.apply(q,arguments),q}function Et(){return Ye.apply(null,arguments).exponent(.5)}function Zt(){var q=[],Oe=[],vt=[],ht;function cr(){var hr=0,nr=Math.max(1,Oe.length);for(vt=new Array(nr-1);++hr<nr;)vt[hr-1]=(0,i.quantile)(q,hr/nr);return Qt}function Qt(hr){return isNaN(hr=+hr)?ht:Oe[(0,i.bisect)(vt,hr)]}return Qt.invertExtent=function(hr){var nr=Oe.indexOf(hr);return nr<0?[NaN,NaN]:[nr>0?vt[nr-1]:q[0],nr<vt.length?vt[nr]:q[q.length-1]]},Qt.domain=function(hr){if(!arguments.length)return q.slice();q=[];for(var nr=0,Dr=hr.length,An;nr<Dr;++nr)An=hr[nr],An!=null&&!isNaN(An=+An)&&q.push(An);return q.sort(i.ascending),cr()},Qt.range=function(hr){return arguments.length?(Oe=y.call(hr),cr()):Oe.slice()},Qt.unknown=function(hr){return arguments.length?(ht=hr,Qt):ht},Qt.quantiles=function(){return vt.slice()},Qt.copy=function(){return Zt().domain(q).range(Oe).unknown(ht)},F.apply(Qt,arguments)}function Lr(){var q=0,Oe=1,vt=1,ht=[.5],cr=[0,1],Qt;function hr(Dr){return Dr<=Dr?cr[(0,i.bisect)(ht,Dr,0,vt)]:Qt}function nr(){var Dr=-1;for(ht=new Array(vt);++Dr<vt;)ht[Dr]=((Dr+1)*Oe-(Dr-vt)*q)/(vt+1);return hr}return hr.domain=function(Dr){return arguments.length?(q=+Dr[0],Oe=+Dr[1],nr()):[q,Oe]},hr.range=function(Dr){return arguments.length?(vt=(cr=y.call(Dr)).length-1,nr()):cr.slice()},hr.invertExtent=function(Dr){var An=cr.indexOf(Dr);return An<0?[NaN,NaN]:An<1?[q,ht[0]]:An>=vt?[ht[vt-1],Oe]:[ht[An-1],ht[An]]},hr.unknown=function(Dr){return arguments.length&&(Qt=Dr),hr},hr.thresholds=function(){return ht.slice()},hr.copy=function(){return Lr().domain([q,Oe]).range(cr).unknown(Qt)},F.apply(it(hr),arguments)}function ir(){var q=[.5],Oe=[0,1],vt,ht=1;function cr(Qt){return Qt<=Qt?Oe[(0,i.bisect)(q,Qt,0,ht)]:vt}return cr.domain=function(Qt){return arguments.length?(q=y.call(Qt),ht=Math.min(q.length,Oe.length-1),cr):q.slice()},cr.range=function(Qt){return arguments.length?(Oe=y.call(Qt),ht=Math.min(q.length,Oe.length-1),cr):Oe.slice()},cr.invertExtent=function(Qt){var hr=Oe.indexOf(Qt);return[q[hr-1],q[hr]]},cr.unknown=function(Qt){return arguments.length?(vt=Qt,cr):vt},cr.copy=function(){return ir().domain(q).range(Oe).unknown(vt)},F.apply(cr,arguments)}var ur=new Date,Or=new Date;function nn(q,Oe,vt,ht){function cr(Qt){return q(Qt=arguments.length===0?new Date:new Date(+Qt)),Qt}return cr.floor=function(Qt){return q(Qt=new Date(+Qt)),Qt},cr.ceil=function(Qt){return q(Qt=new Date(Qt-1)),Oe(Qt,1),q(Qt),Qt},cr.round=function(Qt){var hr=cr(Qt),nr=cr.ceil(Qt);return Qt-hr<nr-Qt?hr:nr},cr.offset=function(Qt,hr){return Oe(Qt=new Date(+Qt),hr==null?1:Math.floor(hr)),Qt},cr.range=function(Qt,hr,nr){var Dr=[],An;if(Qt=cr.ceil(Qt),nr=nr==null?1:Math.floor(nr),!(Qt<hr)||!(nr>0))return Dr;do Dr.push(An=new Date(+Qt)),Oe(Qt,nr),q(Qt);while(An<Qt&&Qt<hr);return Dr},cr.filter=function(Qt){return nn(function(hr){if(hr>=hr)for(;q(hr),!Qt(hr);)hr.setTime(hr-1)},function(hr,nr){if(hr>=hr)if(nr<0)for(;++nr<=0;)for(;Oe(hr,-1),!Qt(hr););else for(;--nr>=0;)for(;Oe(hr,1),!Qt(hr););})},vt&&(cr.count=function(Qt,hr){return ur.setTime(+Qt),Or.setTime(+hr),q(ur),q(Or),Math.floor(vt(ur,Or))},cr.every=function(Qt){return Qt=Math.floor(Qt),!isFinite(Qt)||!(Qt>0)?null:Qt>1?cr.filter(ht?function(hr){return ht(hr)%Qt==0}:function(hr){return cr.count(0,hr)%Qt==0}):cr}),cr}var Hr=nn(function(q){q.setMonth(0,1),q.setHours(0,0,0,0)},function(q,Oe){q.setFullYear(q.getFullYear()+Oe)},function(q,Oe){return Oe.getFullYear()-q.getFullYear()},function(q){return q.getFullYear()});Hr.every=function(q){return!isFinite(q=Math.floor(q))||!(q>0)?null:nn(function(Oe){Oe.setFullYear(Math.floor(Oe.getFullYear()/q)*q),Oe.setMonth(0,1),Oe.setHours(0,0,0,0)},function(Oe,vt){Oe.setFullYear(Oe.getFullYear()+vt*q)})};var gr=Hr,vn=Hr.range,an=nn(function(q){q.setDate(1),q.setHours(0,0,0,0)},function(q,Oe){q.setMonth(q.getMonth()+Oe)},function(q,Oe){return Oe.getMonth()-q.getMonth()+(Oe.getFullYear()-q.getFullYear())*12},function(q){return q.getMonth()}),sn=an,Ei=an.range,fn=1e3,ni=6e4,Ui=36e5,mi=864e5,Li=6048e5;function ui(q){return nn(function(Oe){Oe.setDate(Oe.getDate()-(Oe.getDay()+7-q)%7),Oe.setHours(0,0,0,0)},function(Oe,vt){Oe.setDate(Oe.getDate()+vt*7)},function(Oe,vt){return(vt-Oe-(vt.getTimezoneOffset()-Oe.getTimezoneOffset())*ni)/Li})}var fi=ui(0),Wi=ui(1),va=ui(2),Pi=ui(3),hi=ui(4),Ii=ui(5),La=ui(6),ls=fi.range,Ta=Wi.range,ma=va.range,Qo=Pi.range,Es=hi.range,sa=Ii.range,to=La.range,_a=nn(function(q){q.setHours(0,0,0,0)},function(q,Oe){q.setDate(q.getDate()+Oe)},function(q,Oe){return(Oe-q-(Oe.getTimezoneOffset()-q.getTimezoneOffset())*ni)/mi},function(q){return q.getDate()-1}),wa=_a,$a=_a.range,ia=nn(function(q){q.setTime(q-q.getMilliseconds()-q.getSeconds()*fn-q.getMinutes()*ni)},function(q,Oe){q.setTime(+q+Oe*Ui)},function(q,Oe){return(Oe-q)/Ui},function(q){return q.getHours()}),Ja=ia,ro=ia.range,Xa=nn(function(q){q.setTime(q-q.getMilliseconds()-q.getSeconds()*fn)},function(q,Oe){q.setTime(+q+Oe*ni)},function(q,Oe){return(Oe-q)/ni},function(q){return q.getMinutes()}),no=Xa,go=Xa.range,fa=nn(function(q){q.setTime(q-q.getMilliseconds())},function(q,Oe){q.setTime(+q+Oe*fn)},function(q,Oe){return(Oe-q)/fn},function(q){return q.getUTCSeconds()}),ja=fa,Qa=fa.range,Ua=nn(function(){},function(q,Oe){q.setTime(+q+Oe)},function(q,Oe){return Oe-q});Ua.every=function(q){return q=Math.floor(q),!isFinite(q)||!(q>0)?null:q>1?nn(function(Oe){Oe.setTime(Math.floor(Oe/q)*q)},function(Oe,vt){Oe.setTime(+Oe+vt*q)},function(Oe,vt){return(vt-Oe)/q}):Ua};var Ve=Ua,rt=Ua.range;function wt(q){return nn(function(Oe){Oe.setUTCDate(Oe.getUTCDate()-(Oe.getUTCDay()+7-q)%7),Oe.setUTCHours(0,0,0,0)},function(Oe,vt){Oe.setUTCDate(Oe.getUTCDate()+vt*7)},function(Oe,vt){return(vt-Oe)/Li})}var lr=wt(0),Zr=wt(1),Un=wt(2),oi=wt(3),te=wt(4),be=wt(5),tt=wt(6),yt=lr.range,Bt=Zr.range,qt=Un.range,Wt=oi.range,or=te.range,ar=be.range,kr=tt.range,we=nn(function(q){q.setUTCHours(0,0,0,0)},function(q,Oe){q.setUTCDate(q.getUTCDate()+Oe)},function(q,Oe){return(Oe-q)/mi},function(q){return q.getUTCDate()-1}),je=we,Ue=we.range,ut=nn(function(q){q.setUTCMonth(0,1),q.setUTCHours(0,0,0,0)},function(q,Oe){q.setUTCFullYear(q.getUTCFullYear()+Oe)},function(q,Oe){return Oe.getUTCFullYear()-q.getUTCFullYear()},function(q){return q.getUTCFullYear()});ut.every=function(q){return!isFinite(q=Math.floor(q))||!(q>0)?null:nn(function(Oe){Oe.setUTCFullYear(Math.floor(Oe.getUTCFullYear()/q)*q),Oe.setUTCMonth(0,1),Oe.setUTCHours(0,0,0,0)},function(Oe,vt){Oe.setUTCFullYear(Oe.getUTCFullYear()+vt*q)})};var Xt=ut,Mr=ut.range;function bn(q){if(0<=q.y&&q.y<100){var Oe=new Date(-1,q.m,q.d,q.H,q.M,q.S,q.L);return Oe.setFullYear(q.y),Oe}return new Date(q.y,q.m,q.d,q.H,q.M,q.S,q.L)}function ei(q){if(0<=q.y&&q.y<100){var Oe=new Date(Date.UTC(-1,q.m,q.d,q.H,q.M,q.S,q.L));return Oe.setUTCFullYear(q.y),Oe}return new Date(Date.UTC(q.y,q.m,q.d,q.H,q.M,q.S,q.L))}function Ci(q,Oe,vt){return{y:q,m:Oe,d:vt,H:0,M:0,S:0,L:0}}function Xi(q){var Oe=q.dateTime,vt=q.date,ht=q.time,cr=q.periods,Qt=q.days,hr=q.shortDays,nr=q.months,Dr=q.shortMonths,An=Y(cr),Bn=ve(cr),Ln=Y(Qt),Wn=ve(Qt),ri=Y(hr),ta=ve(hr),Da=Y(nr),gn=ve(nr),yn=Y(Dr),yo=ve(Dr),ga={a:Vo,A:Bs,b:Go,B:el,c:null,d:Vu,e:Vu,f:$l,g:yu,G:vc,H:ks,I:Os,j:Ra,L:cl,m:Ts,M:Zs,p:Bl,q:ku,Q:_u,s:$u,S:Gu,u:ms,U:Ws,V:Ys,w:Oa,W:Hu,x:null,X:null,y:Dl,Y:Jl,Z:Ql,"%":Ku},Na={a:Eu,A:zl,b:lu,B:Ks,c:null,d:Zu,e:Zu,f:Is,g:Yu,G:Xs,H:qs,I:eu,j:Iu,L:tu,m:fl,M:ru,p:tl,q:cu,Q:_u,s:$u,S:gs,u:hl,U:kl,V:nu,w:Ru,W:Wu,x:null,X:null,y:pl,Y:ql,Z:Xu,"%":Ku},xa={a:Qi,A:Gi,b:ba,B:ka,c:No,d:ti,e:ti,f:Gs,g:Fr,G:Gt,H:ua,I:ua,j:ha,L:Cs,m:Ri,M:Ga,p:Ni,q:Zn,Q:ll,s:Hs,S:Vi,u:Fe,U:et,V:Lt,w:ne,W:Kt,x:Ro,X:ws,y:Fr,Y:Gt,Z:Vr,"%":Qs};ga.x=ao(vt,ga),ga.X=ao(ht,ga),ga.c=ao(Oe,ga),Na.x=ao(vt,Na),Na.X=ao(ht,Na),Na.c=ao(Oe,Na);function ao(Xn,oa){return function(la){var _n=[],Bo=-1,a=0,u=Xn.length,s,f,T;for(la instanceof Date||(la=new Date(+la));++Bo<u;)Xn.charCodeAt(Bo)===37&&(_n.push(Xn.slice(a,Bo)),(f=Fa[s=Xn.charAt(++Bo)])!=null?s=Xn.charAt(++Bo):f=s==="e"?" ":"0",(T=oa[s])&&(s=T(la,f)),_n.push(s),a=Bo+1);return _n.push(Xn.slice(a,Bo)),_n.join("")}}function Mi(Xn,oa){return function(la){var _n=Ci(1900,void 0,1),Bo=ho(_n,Xn,la+="",0),a,u;if(Bo!=la.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(oa&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(a=ei(Ci(_n.y,0,1)),u=a.getUTCDay(),a=u>4||u===0?Zr.ceil(a):Zr(a),a=je.offset(a,(_n.V-1)*7),_n.y=a.getUTCFullYear(),_n.m=a.getUTCMonth(),_n.d=a.getUTCDate()+(_n.w+6)%7):(a=bn(Ci(_n.y,0,1)),u=a.getDay(),a=u>4||u===0?Wi.ceil(a):Wi(a),a=wa.offset(a,(_n.V-1)*7),_n.y=a.getFullYear(),_n.m=a.getMonth(),_n.d=a.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),u="Z"in _n?ei(Ci(_n.y,0,1)).getUTCDay():bn(Ci(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(u+5)%7:_n.w+_n.U*7-(u+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,ei(_n)):bn(_n)}}function ho(Xn,oa,la,_n){for(var Bo=0,a=oa.length,u=la.length,s,f;Bo<a;){if(_n>=u)return-1;if(s=oa.charCodeAt(Bo++),s===37){if(s=oa.charAt(Bo++),f=xa[s in Fa?oa.charAt(Bo++):s],!f||(_n=f(Xn,la,_n))<0)return-1}else if(s!=la.charCodeAt(_n++))return-1}return _n}function Ni(Xn,oa,la){var _n=An.exec(oa.slice(la));return _n?(Xn.p=Bn[_n[0].toLowerCase()],la+_n[0].length):-1}function Qi(Xn,oa,la){var _n=ri.exec(oa.slice(la));return _n?(Xn.w=ta[_n[0].toLowerCase()],la+_n[0].length):-1}function Gi(Xn,oa,la){var _n=Ln.exec(oa.slice(la));return _n?(Xn.w=Wn[_n[0].toLowerCase()],la+_n[0].length):-1}function ba(Xn,oa,la){var _n=yn.exec(oa.slice(la));return _n?(Xn.m=yo[_n[0].toLowerCase()],la+_n[0].length):-1}function ka(Xn,oa,la){var _n=Da.exec(oa.slice(la));return _n?(Xn.m=gn[_n[0].toLowerCase()],la+_n[0].length):-1}function No(Xn,oa,la){return ho(Xn,Oe,oa,la)}function Ro(Xn,oa,la){return ho(Xn,vt,oa,la)}function ws(Xn,oa,la){return ho(Xn,ht,oa,la)}function Vo(Xn){return hr[Xn.getDay()]}function Bs(Xn){return Qt[Xn.getDay()]}function Go(Xn){return Dr[Xn.getMonth()]}function el(Xn){return nr[Xn.getMonth()]}function Bl(Xn){return cr[+(Xn.getHours()>=12)]}function ku(Xn){return 1+~~(Xn.getMonth()/3)}function Eu(Xn){return hr[Xn.getUTCDay()]}function zl(Xn){return Qt[Xn.getUTCDay()]}function lu(Xn){return Dr[Xn.getUTCMonth()]}function Ks(Xn){return nr[Xn.getUTCMonth()]}function tl(Xn){return cr[+(Xn.getUTCHours()>=12)]}function cu(Xn){return 1+~~(Xn.getUTCMonth()/3)}return{format:function(Xn){var oa=ao(Xn+="",ga);return oa.toString=function(){return Xn},oa},parse:function(Xn){var oa=Mi(Xn+="",!1);return oa.toString=function(){return Xn},oa},utcFormat:function(Xn){var oa=ao(Xn+="",Na);return oa.toString=function(){return Xn},oa},utcParse:function(Xn){var oa=Mi(Xn+="",!0);return oa.toString=function(){return Xn},oa}}}var Fa={"-":"",_:" ","0":"0"},aa=/^\s*\d+/,Oi=/^%/,vs=/[\\^$*+?|[\]().{}]/g;function Yi(q,Oe,vt){var ht=q<0?"-":"",cr=(ht?-q:q)+"",Qt=cr.length;return ht+(Qt<vt?new Array(vt-Qt+1).join(Oe)+cr:cr)}function m(q){return q.replace(vs,"\\$&")}function Y(q){return new RegExp("^(?:"+q.map(m).join("|")+")","i")}function ve(q){for(var Oe={},vt=-1,ht=q.length;++vt<ht;)Oe[q[vt].toLowerCase()]=vt;return Oe}function ne(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+1));return ht?(q.w=+ht[0],vt+ht[0].length):-1}function Fe(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+1));return ht?(q.u=+ht[0],vt+ht[0].length):-1}function et(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.U=+ht[0],vt+ht[0].length):-1}function Lt(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.V=+ht[0],vt+ht[0].length):-1}function Kt(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.W=+ht[0],vt+ht[0].length):-1}function Gt(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+4));return ht?(q.y=+ht[0],vt+ht[0].length):-1}function Fr(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.y=+ht[0]+(+ht[0]>68?1900:2e3),vt+ht[0].length):-1}function Vr(q,Oe,vt){var ht=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(Oe.slice(vt,vt+6));return ht?(q.Z=ht[1]?0:-(ht[2]+(ht[3]||"00")),vt+ht[0].length):-1}function Zn(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+1));return ht?(q.q=ht[0]*3-3,vt+ht[0].length):-1}function Ri(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.m=ht[0]-1,vt+ht[0].length):-1}function ti(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.d=+ht[0],vt+ht[0].length):-1}function ha(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+3));return ht?(q.m=0,q.d=+ht[0],vt+ht[0].length):-1}function ua(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.H=+ht[0],vt+ht[0].length):-1}function Ga(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.M=+ht[0],vt+ht[0].length):-1}function Vi(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+2));return ht?(q.S=+ht[0],vt+ht[0].length):-1}function Cs(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+3));return ht?(q.L=+ht[0],vt+ht[0].length):-1}function Gs(q,Oe,vt){var ht=aa.exec(Oe.slice(vt,vt+6));return ht?(q.L=Math.floor(ht[0]/1e3),vt+ht[0].length):-1}function Qs(q,Oe,vt){var ht=Oi.exec(Oe.slice(vt,vt+1));return ht?vt+ht[0].length:-1}function ll(q,Oe,vt){var ht=aa.exec(Oe.slice(vt));return ht?(q.Q=+ht[0],vt+ht[0].length):-1}function Hs(q,Oe,vt){var ht=aa.exec(Oe.slice(vt));return ht?(q.s=+ht[0],vt+ht[0].length):-1}function Vu(q,Oe){return Yi(q.getDate(),Oe,2)}function ks(q,Oe){return Yi(q.getHours(),Oe,2)}function Os(q,Oe){return Yi(q.getHours()%12||12,Oe,2)}function Ra(q,Oe){return Yi(1+wa.count(gr(q),q),Oe,3)}function cl(q,Oe){return Yi(q.getMilliseconds(),Oe,3)}function $l(q,Oe){return cl(q,Oe)+"000"}function Ts(q,Oe){return Yi(q.getMonth()+1,Oe,2)}function Zs(q,Oe){return Yi(q.getMinutes(),Oe,2)}function Gu(q,Oe){return Yi(q.getSeconds(),Oe,2)}function ms(q){var Oe=q.getDay();return Oe===0?7:Oe}function Ws(q,Oe){return Yi(fi.count(gr(q)-1,q),Oe,2)}function Ou(q){var Oe=q.getDay();return Oe>=4||Oe===0?hi(q):hi.ceil(q)}function Ys(q,Oe){return q=Ou(q),Yi(hi.count(gr(q),q)+(gr(q).getDay()===4),Oe,2)}function Oa(q){return q.getDay()}function Hu(q,Oe){return Yi(Wi.count(gr(q)-1,q),Oe,2)}function Dl(q,Oe){return Yi(q.getFullYear()%100,Oe,2)}function yu(q,Oe){return q=Ou(q),Yi(q.getFullYear()%100,Oe,2)}function Jl(q,Oe){return Yi(q.getFullYear()%1e4,Oe,4)}function vc(q,Oe){var vt=q.getDay();return q=vt>=4||vt===0?hi(q):hi.ceil(q),Yi(q.getFullYear()%1e4,Oe,4)}function Ql(q){var Oe=q.getTimezoneOffset();return(Oe>0?"-":(Oe*=-1,"+"))+Yi(Oe/60|0,"0",2)+Yi(Oe%60,"0",2)}function Zu(q,Oe){return Yi(q.getUTCDate(),Oe,2)}function qs(q,Oe){return Yi(q.getUTCHours(),Oe,2)}function eu(q,Oe){return Yi(q.getUTCHours()%12||12,Oe,2)}function Iu(q,Oe){return Yi(1+je.count(Xt(q),q),Oe,3)}function tu(q,Oe){return Yi(q.getUTCMilliseconds(),Oe,3)}function Is(q,Oe){return tu(q,Oe)+"000"}function fl(q,Oe){return Yi(q.getUTCMonth()+1,Oe,2)}function ru(q,Oe){return Yi(q.getUTCMinutes(),Oe,2)}function gs(q,Oe){return Yi(q.getUTCSeconds(),Oe,2)}function hl(q){var Oe=q.getUTCDay();return Oe===0?7:Oe}function kl(q,Oe){return Yi(lr.count(Xt(q)-1,q),Oe,2)}function dl(q){var Oe=q.getUTCDay();return Oe>=4||Oe===0?te(q):te.ceil(q)}function nu(q,Oe){return q=dl(q),Yi(te.count(Xt(q),q)+(Xt(q).getUTCDay()===4),Oe,2)}function Ru(q){return q.getUTCDay()}function Wu(q,Oe){return Yi(Zr.count(Xt(q)-1,q),Oe,2)}function pl(q,Oe){return Yi(q.getUTCFullYear()%100,Oe,2)}function Yu(q,Oe){return q=dl(q),Yi(q.getUTCFullYear()%100,Oe,2)}function ql(q,Oe){return Yi(q.getUTCFullYear()%1e4,Oe,4)}function Xs(q,Oe){var vt=q.getUTCDay();return q=vt>=4||vt===0?te(q):te.ceil(q),Yi(q.getUTCFullYear()%1e4,Oe,4)}function Xu(){return"+0000"}function Ku(){return"%"}function _u(q){return+q}function $u(q){return Math.floor(+q/1e3)}var iu,vl,Ju,Lu,ec;xu({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function xu(q){return iu=Xi(q),vl=iu.format,Ju=iu.parse,Lu=iu.utcFormat,ec=iu.utcParse,iu}var Aa=1e3,au=Aa*60,ys=au*60,_s=ys*24,Ji=_s*7,Ia=_s*30,qo=_s*365;function ou(q){return new Date(q)}function Du(q){return q instanceof Date?+q:+new Date(+q)}function bu(q,Oe,vt,ht,cr,Qt,hr,nr,Dr){var An=Me(Z,Z),Bn=An.invert,Ln=An.domain,Wn=Dr(".%L"),ri=Dr(":%S"),ta=Dr("%I:%M"),Da=Dr("%I %p"),gn=Dr("%a %d"),yn=Dr("%b %d"),yo=Dr("%B"),ga=Dr("%Y"),Na=[[hr,1,Aa],[hr,5,5*Aa],[hr,15,15*Aa],[hr,30,30*Aa],[Qt,1,au],[Qt,5,5*au],[Qt,15,15*au],[Qt,30,30*au],[cr,1,ys],[cr,3,3*ys],[cr,6,6*ys],[cr,12,12*ys],[ht,1,_s],[ht,2,2*_s],[vt,1,Ji],[Oe,1,Ia],[Oe,3,3*Ia],[q,1,qo]];function xa(Mi){return(hr(Mi)<Mi?Wn:Qt(Mi)<Mi?ri:cr(Mi)<Mi?ta:ht(Mi)<Mi?Da:Oe(Mi)<Mi?vt(Mi)<Mi?gn:yn:q(Mi)<Mi?yo:ga)(Mi)}function ao(Mi,ho,Ni,Qi){if(Mi==null&&(Mi=10),typeof Mi=="number"){var Gi=Math.abs(Ni-ho)/Mi,ba=(0,i.bisector)(function(ka){return ka[2]}).right(Na,Gi);ba===Na.length?(Qi=(0,i.tickStep)(ho/qo,Ni/qo,Mi),Mi=q):ba?(ba=Na[Gi/Na[ba-1][2]<Na[ba][2]/Gi?ba-1:ba],Qi=ba[1],Mi=ba[0]):(Qi=Math.max((0,i.tickStep)(ho,Ni,Mi),1),Mi=nr)}return Qi==null?Mi:Mi.every(Qi)}return An.invert=function(Mi){return new Date(Bn(Mi))},An.domain=function(Mi){return arguments.length?Ln(R.call(Mi,Du)):Ln().map(ou)},An.ticks=function(Mi,ho){var Ni=Ln(),Qi=Ni[0],Gi=Ni[Ni.length-1],ba=Gi<Qi,ka;return ba&&(ka=Qi,Qi=Gi,Gi=ka),ka=ao(Mi,Qi,Gi,ho),ka=ka?ka.range(Qi,Gi+1):[],ba?ka.reverse():ka},An.tickFormat=function(Mi,ho){return ho==null?xa:Dr(ho)},An.nice=function(Mi,ho){var Ni=Ln();return(Mi=ao(Mi,Ni[0],Ni[Ni.length-1],ho))?Ln(Er(Ni,Mi)):An},An.copy=function(){return ie(An,bu(q,Oe,vt,ht,cr,Qt,hr,nr,Dr))},An}function mc(){return F.apply(bu(gr,sn,fi,wa,Ja,no,ja,Ve,vl).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}var tc=nn(function(q){q.setUTCDate(1),q.setUTCHours(0,0,0,0)},function(q,Oe){q.setUTCMonth(q.getUTCMonth()+Oe)},function(q,Oe){return Oe.getUTCMonth()-q.getUTCMonth()+(Oe.getUTCFullYear()-q.getUTCFullYear())*12},function(q){return q.getUTCMonth()}),Qu=tc,ml=tc.range,Fs=nn(function(q){q.setUTCMinutes(0,0,0)},function(q,Oe){q.setTime(+q+Oe*Ui)},function(q,Oe){return(Oe-q)/Ui},function(q){return q.getUTCHours()}),fo=Fs,su=Fs.range,Fl=nn(function(q){q.setUTCSeconds(0,0)},function(q,Oe){q.setTime(+q+Oe*ni)},function(q,Oe){return(Oe-q)/ni},function(q){return q.getUTCMinutes()}),Ka=Fl,Sn=Fl.range;function Io(){return F.apply(bu(Xt,Qu,lr,je,fo,Ka,ja,Ve,Lu).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function uu(){var q=0,Oe=1,vt,ht,cr,Qt,hr=Z,nr=!1,Dr;function An(Bn){return isNaN(Bn=+Bn)?Dr:hr(cr===0?.5:(Bn=(Qt(Bn)-vt)*cr,nr?Math.max(0,Math.min(1,Bn)):Bn))}return An.domain=function(Bn){return arguments.length?(vt=Qt(q=+Bn[0]),ht=Qt(Oe=+Bn[1]),cr=vt===ht?0:1/(ht-vt),An):[q,Oe]},An.clamp=function(Bn){return arguments.length?(nr=!!Bn,An):nr},An.interpolator=function(Bn){return arguments.length?(hr=Bn,An):hr},An.unknown=function(Bn){return arguments.length?(Dr=Bn,An):Dr},function(Bn){return Qt=Bn,vt=Bn(q),ht=Bn(Oe),cr=vt===ht?0:1/(ht-vt),An}}function cs(q,Oe){return Oe.domain(q.domain()).interpolator(q.interpolator()).clamp(q.clamp()).unknown(q.unknown())}function xs(){var q=it(uu()(Z));return q.copy=function(){return cs(q,xs())},o.apply(q,arguments)}function jo(){var q=ji(uu()).domain([1,10]);return q.copy=function(){return cs(q,jo()).base(q.base())},o.apply(q,arguments)}function qu(){var q=ke(uu());return q.copy=function(){return cs(q,qu()).constant(q.constant())},o.apply(q,arguments)}function pn(){var q=Nt(uu());return q.copy=function(){return cs(q,pn()).exponent(q.exponent())},o.apply(q,arguments)}function Nl(){return pn.apply(null,arguments).exponent(.5)}function Ns(){var q=[],Oe=Z;function vt(ht){if(!isNaN(ht=+ht))return Oe(((0,i.bisect)(q,ht)-1)/(q.length-1))}return vt.domain=function(ht){if(!arguments.length)return q.slice();q=[];for(var cr=0,Qt=ht.length,hr;cr<Qt;++cr)hr=ht[cr],hr!=null&&!isNaN(hr=+hr)&&q.push(hr);return q.sort(i.ascending),vt},vt.interpolator=function(ht){return arguments.length?(Oe=ht,vt):Oe},vt.copy=function(){return Ns(Oe).domain(q)},o.apply(vt,arguments)}function io(){var q=0,Oe=.5,vt=1,ht,cr,Qt,hr,nr,Dr=Z,An,Bn=!1,Ln;function Wn(ri){return isNaN(ri=+ri)?Ln:(ri=.5+((ri=+An(ri))-cr)*(ri<cr?hr:nr),Dr(Bn?Math.max(0,Math.min(1,ri)):ri))}return Wn.domain=function(ri){return arguments.length?(ht=An(q=+ri[0]),cr=An(Oe=+ri[1]),Qt=An(vt=+ri[2]),hr=ht===cr?0:.5/(cr-ht),nr=cr===Qt?0:.5/(Qt-cr),Wn):[q,Oe,vt]},Wn.clamp=function(ri){return arguments.length?(Bn=!!ri,Wn):Bn},Wn.interpolator=function(ri){return arguments.length?(Dr=ri,Wn):Dr},Wn.unknown=function(ri){return arguments.length?(Ln=ri,Wn):Ln},function(ri){return An=ri,ht=ri(q),cr=ri(Oe),Qt=ri(vt),hr=ht===cr?0:.5/(cr-ht),nr=cr===Qt?0:.5/(Qt-cr),Wn}}function fs(){var q=it(io()(Z));return q.copy=function(){return cs(q,fs())},o.apply(q,arguments)}function Uo(){var q=ji(io()).domain([.1,1,10]);return q.copy=function(){return cs(q,Uo()).base(q.base())},o.apply(q,arguments)}function Rs(){var q=ke(io());return q.copy=function(){return cs(q,Rs()).constant(q.constant())},o.apply(q,arguments)}function Su(){var q=Nt(io());return q.copy=function(){return cs(q,Su()).exponent(q.exponent())},o.apply(q,arguments)}function es(){return Su.apply(null,arguments).exponent(.5)}},9187:function(Te){"use strict";Te.exports=c,Te.exports.default=c;function c(Z,ee,H){H=H||2;var ae=ee&&ee.length,G=ae?ee[0]*H:Z.length,ie=n(Z,0,G,H,!0),le=[];if(!ie||ie.next===ie.prev)return le;var Me,ge,pe,Ne,Re,he,se;if(ae&&(ie=L(Z,ee,ie,H)),Z.length>80*H){Me=pe=Z[0],ge=Ne=Z[1];for(var J=H;J<G;J+=H)Re=Z[J],he=Z[J+1],Re<Me&&(Me=Re),he<ge&&(ge=he),Re>pe&&(pe=Re),he>Ne&&(Ne=he);se=Math.max(pe-Me,Ne-ge),se=se!==0?1/se:0}return F(ie,le,H,Me,ge,se),le}function n(Z,ee,H,ae,G){var ie,le;if(G===re(Z,ee,H,ae)>0)for(ie=ee;ie<H;ie+=ae)le=V(ie,Z[ie],Z[ie+1],le);else for(ie=H-ae;ie>=ee;ie-=ae)le=V(ie,Z[ie],Z[ie+1],le);return le&&y(le,le.next)&&(Q(le),le=le.next),le}function i(Z,ee){if(!Z)return Z;ee||(ee=Z);var H=Z,ae;do if(ae=!1,!H.steiner&&(y(H,H.next)||R(H.prev,H,H.next)===0)){if(Q(H),H=ee=H.prev,H===H.next)break;ae=!0}else H=H.next;while(ae||H!==ee);return ee}function F(Z,ee,H,ae,G,ie,le){if(!!Z){!le&&ie&&M(Z,ae,G,ie);for(var Me=Z,ge,pe;Z.prev!==Z.next;){if(ge=Z.prev,pe=Z.next,ie?w(Z,ae,G,ie):o(Z)){ee.push(ge.i/H),ee.push(Z.i/H),ee.push(pe.i/H),Q(Z),Z=pe.next,Me=pe.next;continue}if(Z=pe,Z===Me){le?le===1?(Z=_(i(Z),ee,H),F(Z,ee,H,ae,G,ie,2)):le===2&&P(Z,ee,H,ae,G,ie):F(i(Z),ee,H,ae,G,ie,1);break}}}}function o(Z){var ee=Z.prev,H=Z,ae=Z.next;if(R(ee,H,ae)>=0)return!1;for(var G=Z.next.next;G!==Z.prev;){if(O(ee.x,ee.y,H.x,H.y,ae.x,ae.y,G.x,G.y)&&R(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function w(Z,ee,H,ae){var G=Z.prev,ie=Z,le=Z.next;if(R(G,ie,le)>=0)return!1;for(var Me=G.x<ie.x?G.x<le.x?G.x:le.x:ie.x<le.x?ie.x:le.x,ge=G.y<ie.y?G.y<le.y?G.y:le.y:ie.y<le.y?ie.y:le.y,pe=G.x>ie.x?G.x>le.x?G.x:le.x:ie.x>le.x?ie.x:le.x,Ne=G.y>ie.y?G.y>le.y?G.y:le.y:ie.y>le.y?ie.y:le.y,Re=U(Me,ge,ee,H,ae),he=U(pe,Ne,ee,H,ae),se=Z.prevZ,J=Z.nextZ;se&&se.z>=Re&&J&&J.z<=he;){if(se!==Z.prev&&se!==Z.next&&O(G.x,G.y,ie.x,ie.y,le.x,le.y,se.x,se.y)&&R(se.prev,se,se.next)>=0||(se=se.prevZ,J!==Z.prev&&J!==Z.next&&O(G.x,G.y,ie.x,ie.y,le.x,le.y,J.x,J.y)&&R(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;se&&se.z>=Re;){if(se!==Z.prev&&se!==Z.next&&O(G.x,G.y,ie.x,ie.y,le.x,le.y,se.x,se.y)&&R(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;J&&J.z<=he;){if(J!==Z.prev&&J!==Z.next&&O(G.x,G.y,ie.x,ie.y,le.x,le.y,J.x,J.y)&&R(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function _(Z,ee,H){var ae=Z;do{var G=ae.prev,ie=ae.next.next;!y(G,ie)&&v(G,ae,ae.next,ie)&&x(G,ie)&&x(ie,G)&&(ee.push(G.i/H),ee.push(ae.i/H),ee.push(ie.i/H),Q(ae),Q(ae.next),ae=Z=ie),ae=ae.next}while(ae!==Z);return i(ae)}function P(Z,ee,H,ae,G,ie){var le=Z;do{for(var Me=le.next.next;Me!==le.prev;){if(le.i!==Me.i&&D(le,Me)){var ge=B(le,Me);le=i(le,le.next),ge=i(ge,ge.next),F(le,ee,H,ae,G,ie),F(ge,ee,H,ae,G,ie);return}Me=Me.next}le=le.next}while(le!==Z)}function L(Z,ee,H,ae){var G=[],ie,le,Me,ge,pe;for(ie=0,le=ee.length;ie<le;ie++)Me=ee[ie]*ae,ge=ie<le-1?ee[ie+1]*ae:Z.length,pe=n(Z,Me,ge,ae,!1),pe===pe.next&&(pe.steiner=!0),G.push(I(pe));for(G.sort(d),ie=0;ie<G.length;ie++)H=E(G[ie],H),H=i(H,H.next);return H}function d(Z,ee){return Z.x-ee.x}function E(Z,ee){var H=g(Z,ee);if(!H)return ee;var ae=B(H,Z),G=i(H,H.next);return i(ae,ae.next),ee===H?G:ee}function g(Z,ee){var H=ee,ae=Z.x,G=Z.y,ie=-Infinity,le;do{if(G<=H.y&&G>=H.next.y&&H.next.y!==H.y){var Me=H.x+(G-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(Me<=ae&&Me>ie){if(ie=Me,Me===ae){if(G===H.y)return H;if(G===H.next.y)return H.next}le=H.x<H.next.x?H:H.next}}H=H.next}while(H!==ee);if(!le)return null;if(ae===ie)return le;var ge=le,pe=le.x,Ne=le.y,Re=Infinity,he;H=le;do ae>=H.x&&H.x>=pe&&ae!==H.x&&O(G<Ne?ae:ie,G,pe,Ne,G<Ne?ie:ae,G,H.x,H.y)&&(he=Math.abs(G-H.y)/(ae-H.x),x(H,Z)&&(he<Re||he===Re&&(H.x>le.x||H.x===le.x&&k(le,H)))&&(le=H,Re=he)),H=H.next;while(H!==ge);return le}function k(Z,ee){return R(Z.prev,Z,ee.prev)<0&&R(ee.next,Z,Z.next)<0}function M(Z,ee,H,ae){var G=Z;do G.z===null&&(G.z=U(G.x,G.y,ee,H,ae)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==Z);G.prevZ.nextZ=null,G.prevZ=null,j(G)}function j(Z){var ee,H,ae,G,ie,le,Me,ge,pe=1;do{for(H=Z,Z=null,ie=null,le=0;H;){for(le++,ae=H,Me=0,ee=0;ee<pe&&(Me++,ae=ae.nextZ,!!ae);ee++);for(ge=pe;Me>0||ge>0&&ae;)Me!==0&&(ge===0||!ae||H.z<=ae.z)?(G=H,H=H.nextZ,Me--):(G=ae,ae=ae.nextZ,ge--),ie?ie.nextZ=G:Z=G,G.prevZ=ie,ie=G;H=ae}ie.nextZ=null,pe*=2}while(le>1);return Z}function U(Z,ee,H,ae,G){return Z=32767*(Z-H)*G,ee=32767*(ee-ae)*G,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,ee=(ee|ee<<8)&16711935,ee=(ee|ee<<4)&252645135,ee=(ee|ee<<2)&858993459,ee=(ee|ee<<1)&1431655765,Z|ee<<1}function I(Z){var ee=Z,H=Z;do(ee.x<H.x||ee.x===H.x&&ee.y<H.y)&&(H=ee),ee=ee.next;while(ee!==Z);return H}function O(Z,ee,H,ae,G,ie,le,Me){return(G-le)*(ee-Me)-(Z-le)*(ie-Me)>=0&&(Z-le)*(ae-Me)-(H-le)*(ee-Me)>=0&&(H-le)*(ie-Me)-(G-le)*(ae-Me)>=0}function D(Z,ee){return Z.next.i!==ee.i&&Z.prev.i!==ee.i&&!A(Z,ee)&&(x(Z,ee)&&x(ee,Z)&&z(Z,ee)&&(R(Z.prev,Z,ee.prev)||R(Z,ee.prev,ee))||y(Z,ee)&&R(Z.prev,Z,Z.next)>0&&R(ee.prev,ee,ee.next)>0)}function R(Z,ee,H){return(ee.y-Z.y)*(H.x-ee.x)-(ee.x-Z.x)*(H.y-ee.y)}function y(Z,ee){return Z.x===ee.x&&Z.y===ee.y}function v(Z,ee,H,ae){var G=S(R(Z,ee,H)),ie=S(R(Z,ee,ae)),le=S(R(H,ae,Z)),Me=S(R(H,ae,ee));return!!(G!==ie&&le!==Me||G===0&&h(Z,H,ee)||ie===0&&h(Z,ae,ee)||le===0&&h(H,Z,ae)||Me===0&&h(H,ee,ae))}function h(Z,ee,H){return ee.x<=Math.max(Z.x,H.x)&&ee.x>=Math.min(Z.x,H.x)&&ee.y<=Math.max(Z.y,H.y)&&ee.y>=Math.min(Z.y,H.y)}function S(Z){return Z>0?1:Z<0?-1:0}function A(Z,ee){var H=Z;do{if(H.i!==Z.i&&H.next.i!==Z.i&&H.i!==ee.i&&H.next.i!==ee.i&&v(H,H.next,Z,ee))return!0;H=H.next}while(H!==Z);return!1}function x(Z,ee){return R(Z.prev,Z,Z.next)<0?R(Z,ee,Z.next)>=0&&R(Z,Z.prev,ee)>=0:R(Z,ee,Z.prev)<0||R(Z,Z.next,ee)<0}function z(Z,ee){var H=Z,ae=!1,G=(Z.x+ee.x)/2,ie=(Z.y+ee.y)/2;do H.y>ie!=H.next.y>ie&&H.next.y!==H.y&&G<(H.next.x-H.x)*(ie-H.y)/(H.next.y-H.y)+H.x&&(ae=!ae),H=H.next;while(H!==Z);return ae}function B(Z,ee){var H=new oe(Z.i,Z.x,Z.y),ae=new oe(ee.i,ee.x,ee.y),G=Z.next,ie=ee.prev;return Z.next=ee,ee.prev=Z,H.next=G,G.prev=H,ae.next=H,H.prev=ae,ie.next=ae,ae.prev=ie,ae}function V(Z,ee,H,ae){var G=new oe(Z,ee,H);return ae?(G.next=ae.next,G.prev=ae,ae.next.prev=G,ae.next=G):(G.prev=G,G.next=G),G}function Q(Z){Z.next.prev=Z.prev,Z.prev.next=Z.next,Z.prevZ&&(Z.prevZ.nextZ=Z.nextZ),Z.nextZ&&(Z.nextZ.prevZ=Z.prevZ)}function oe(Z,ee,H){this.i=Z,this.x=ee,this.y=H,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}c.deviation=function(Z,ee,H,ae){var G=ee&&ee.length,ie=G?ee[0]*H:Z.length,le=Math.abs(re(Z,0,ie,H));if(G)for(var Me=0,ge=ee.length;Me<ge;Me++){var pe=ee[Me]*H,Ne=Me<ge-1?ee[Me+1]*H:Z.length;le-=Math.abs(re(Z,pe,Ne,H))}var Re=0;for(Me=0;Me<ae.length;Me+=3){var he=ae[Me]*H,se=ae[Me+1]*H,J=ae[Me+2]*H;Re+=Math.abs((Z[he]-Z[J])*(Z[se+1]-Z[he+1])-(Z[he]-Z[se])*(Z[J+1]-Z[he+1]))}return le===0&&Re===0?0:Math.abs((Re-le)/le)};function re(Z,ee,H,ae){for(var G=0,ie=ee,le=H-ae;ie<H;ie+=ae)G+=(Z[le]-Z[ie])*(Z[ie+1]+Z[le+1]),le=ie;return G}c.flatten=function(Z){for(var ee=Z[0][0].length,H={vertices:[],holes:[],dimensions:ee},ae=0,G=0;G<Z.length;G++){for(var ie=0;ie<Z[G].length;ie++)for(var le=0;le<ee;le++)H.vertices.push(Z[G][ie][le]);G>0&&(ae+=Z[G-1].length,H.holes.push(ae))}return H}},67709:function(Te){function c(i){var F=i.target||i.srcElement;F.__resizeRAF__&&cancelAnimationFrame(F.__resizeRAF__),F.__resizeRAF__=requestAnimationFrame(function(){var o=F.__resizeTrigger__,w=o&&o.__resizeListeners__;w&&w.forEach(function(_){_.call(o,i)})})}var n=function(F,o){var w=this,_=w.document,P,L=_.attachEvent;typeof navigator!="undefined"&&(P=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function d(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",c)}if(!F.__resizeListeners__)if(F.__resizeListeners__=[],L)F.__resizeTrigger__=F,F.attachEvent("onresize",c);else{getComputedStyle(F).position==="static"&&(F.style.position="relative");var E=F.__resizeTrigger__=_.createElement("object");E.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),E.setAttribute("class","resize-sensor"),E.setAttribute("tabindex","-1"),E.setAttribute("title",""),E.__resizeElement__=F,E.onload=d,E.type="text/html",P&&F.appendChild(E),E.data="about:blank",P||F.appendChild(E)}F.__resizeListeners__.push(o)};Te.exports=typeof window=="undefined"?n:n.bind(window),Te.exports.unbind=function(i,F){var o=document.attachEvent,w=i.__resizeListeners__||[];if(F){var _=w.indexOf(F);_!==-1&&w.splice(_,1)}else w=i.__resizeListeners__=[];if(!w.length){if(o)i.detachEvent("onresize",c);else if(i.__resizeTrigger__){var P=i.__resizeTrigger__.contentDocument,L=P&&P.defaultView;L&&(L.removeEventListener("resize",c),delete L.__resizeTrigger__),i.__resizeTrigger__=!i.removeChild(i.__resizeTrigger__)}delete i.__resizeListeners__}}},26729:function(Te){"use strict";var c=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function F(P,L,d){this.fn=P,this.context=L,this.once=d||!1}function o(P,L,d,E,g){if(typeof d!="function")throw new TypeError("The listener must be a function");var k=new F(d,E||P,g),M=n?n+L:L;return P._events[M]?P._events[M].fn?P._events[M]=[P._events[M],k]:P._events[M].push(k):(P._events[M]=k,P._eventsCount++),P}function w(P,L){--P._eventsCount==0?P._events=new i:delete P._events[L]}function _(){this._events=new i,this._eventsCount=0}_.prototype.eventNames=function(){var L=[],d,E;if(this._eventsCount===0)return L;for(E in d=this._events)c.call(d,E)&&L.push(n?E.slice(1):E);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols(d)):L},_.prototype.listeners=function(L){var d=n?n+L:L,E=this._events[d];if(!E)return[];if(E.fn)return[E.fn];for(var g=0,k=E.length,M=new Array(k);g<k;g++)M[g]=E[g].fn;return M},_.prototype.listenerCount=function(L){var d=n?n+L:L,E=this._events[d];return E?E.fn?1:E.length:0},_.prototype.emit=function(L,d,E,g,k,M){var j=n?n+L:L;if(!this._events[j])return!1;var U=this._events[j],I=arguments.length,O,D;if(U.fn){switch(U.once&&this.removeListener(L,U.fn,void 0,!0),I){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,d),!0;case 3:return U.fn.call(U.context,d,E),!0;case 4:return U.fn.call(U.context,d,E,g),!0;case 5:return U.fn.call(U.context,d,E,g,k),!0;case 6:return U.fn.call(U.context,d,E,g,k,M),!0}for(D=1,O=new Array(I-1);D<I;D++)O[D-1]=arguments[D];U.fn.apply(U.context,O)}else{var R=U.length,y;for(D=0;D<R;D++)switch(U[D].once&&this.removeListener(L,U[D].fn,void 0,!0),I){case 1:U[D].fn.call(U[D].context);break;case 2:U[D].fn.call(U[D].context,d);break;case 3:U[D].fn.call(U[D].context,d,E);break;case 4:U[D].fn.call(U[D].context,d,E,g);break;default:if(!O)for(y=1,O=new Array(I-1);y<I;y++)O[y-1]=arguments[y];U[D].fn.apply(U[D].context,O)}}return!0},_.prototype.on=function(L,d,E){return o(this,L,d,E,!1)},_.prototype.once=function(L,d,E){return o(this,L,d,E,!0)},_.prototype.removeListener=function(L,d,E,g){var k=n?n+L:L;if(!this._events[k])return this;if(!d)return w(this,k),this;var M=this._events[k];if(M.fn)M.fn===d&&(!g||M.once)&&(!E||M.context===E)&&w(this,k);else{for(var j=0,U=[],I=M.length;j<I;j++)(M[j].fn!==d||g&&!M[j].once||E&&M[j].context!==E)&&U.push(M[j]);U.length?this._events[k]=U.length===1?U[0]:U:w(this,k)}return this},_.prototype.removeAllListeners=function(L){var d;return L?(d=n?n+L:L,this._events[d]&&w(this,d)):(this._events=new i,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=n,_.EventEmitter=_,Te.exports=_},89568:function(Te,c,n){"use strict";n.r(c),n.d(c,{glMatrix:function(){return _},mat2:function(){return i},mat2d:function(){return F},mat3:function(){return gt},mat4:function(){return st},quat:function(){return o},quat2:function(){return w},vec2:function(){return oi},vec3:function(){return xe},vec4:function(){return Mt}});var i={};n.r(i),n.d(i,{LDU:function(){return A},add:function(){return x},adjoint:function(){return U},clone:function(){return L},copy:function(){return d},create:function(){return P},determinant:function(){return I},equals:function(){return V},exactEquals:function(){return B},frob:function(){return S},fromRotation:function(){return y},fromScaling:function(){return v},fromValues:function(){return g},identity:function(){return E},invert:function(){return j},mul:function(){return re},multiply:function(){return O},multiplyScalar:function(){return Q},multiplyScalarAndAdd:function(){return oe},rotate:function(){return D},scale:function(){return R},set:function(){return k},str:function(){return h},sub:function(){return Z},subtract:function(){return z},transpose:function(){return M}});var F={};n.r(F),n.d(F,{add:function(){return C},clone:function(){return H},copy:function(){return ae},create:function(){return ee},determinant:function(){return ge},equals:function(){return Ge},exactEquals:function(){return De},frob:function(){return Le},fromRotation:function(){return se},fromScaling:function(){return J},fromTranslation:function(){return fe},fromValues:function(){return ie},identity:function(){return G},invert:function(){return Me},mul:function(){return $e},multiply:function(){return pe},multiplyScalar:function(){return de},multiplyScalarAndAdd:function(){return Ae},rotate:function(){return Ne},scale:function(){return Re},set:function(){return le},str:function(){return me},sub:function(){return ct},subtract:function(){return X},translate:function(){return he}});var o={};n.r(o),n.d(o,{add:function(){return Nt},calculateW:function(){return Ur},clone:function(){return ze},conjugate:function(){return Si},copy:function(){return ot},create:function(){return Ut},dot:function(){return Zt},equals:function(){return vn},exactEquals:function(){return gr},exp:function(){return Ar},fromEuler:function(){return Ee},fromMat3:function(){return xi},fromValues:function(){return Ke},getAngle:function(){return pt},getAxisAngle:function(){return it},identity:function(){return At},invert:function(){return ji},len:function(){return ur},length:function(){return ir},lerp:function(){return Lr},ln:function(){return Nn},mul:function(){return Ye},multiply:function(){return Vt},normalize:function(){return Hr},pow:function(){return Rn},random:function(){return Fi},rotateX:function(){return Er},rotateY:function(){return mr},rotateZ:function(){return Br},rotationTo:function(){return an},scale:function(){return Et},set:function(){return Rt},setAxes:function(){return Ei},setAxisAngle:function(){return nt},slerp:function(){return ci},sqlerp:function(){return sn},sqrLen:function(){return nn},squaredLength:function(){return Or},str:function(){return ke}});var w={};n.r(w),n.d(w,{add:function(){return ia},clone:function(){return ni},conjugate:function(){return ja},copy:function(){return va},create:function(){return fn},dot:function(){return no},equals:function(){return Un},exactEquals:function(){return Zr},fromMat4:function(){return Wi},fromRotation:function(){return fi},fromRotationTranslation:function(){return Li},fromRotationTranslationValues:function(){return mi},fromTranslation:function(){return ui},fromValues:function(){return Ui},getDual:function(){return La},getReal:function(){return Ii},getTranslation:function(){return ma},identity:function(){return Pi},invert:function(){return fa},len:function(){return Ua},length:function(){return Qa},lerp:function(){return go},mul:function(){return ro},multiply:function(){return Ja},normalize:function(){return wt},rotateAroundAxis:function(){return $a},rotateByQuatAppend:function(){return _a},rotateByQuatPrepend:function(){return wa},rotateX:function(){return Es},rotateY:function(){return sa},rotateZ:function(){return to},scale:function(){return Xa},set:function(){return hi},setDual:function(){return Ta},setReal:function(){return ls},sqrLen:function(){return rt},squaredLength:function(){return Ve},str:function(){return lr},translate:function(){return Qo}});var _=n(49685);function P(){var te=new _.ARRAY_TYPE(4);return _.ARRAY_TYPE!=Float32Array&&(te[1]=0,te[2]=0),te[0]=1,te[3]=1,te}function L(te){var be=new _.ARRAY_TYPE(4);return be[0]=te[0],be[1]=te[1],be[2]=te[2],be[3]=te[3],be}function d(te,be){return te[0]=be[0],te[1]=be[1],te[2]=be[2],te[3]=be[3],te}function E(te){return te[0]=1,te[1]=0,te[2]=0,te[3]=1,te}function g(te,be,tt,yt){var Bt=new _.ARRAY_TYPE(4);return Bt[0]=te,Bt[1]=be,Bt[2]=tt,Bt[3]=yt,Bt}function k(te,be,tt,yt,Bt){return te[0]=be,te[1]=tt,te[2]=yt,te[3]=Bt,te}function M(te,be){if(te===be){var tt=be[1];te[1]=be[2],te[2]=tt}else te[0]=be[0],te[1]=be[2],te[2]=be[1],te[3]=be[3];return te}function j(te,be){var tt=be[0],yt=be[1],Bt=be[2],qt=be[3],Wt=tt*qt-Bt*yt;return Wt?(Wt=1/Wt,te[0]=qt*Wt,te[1]=-yt*Wt,te[2]=-Bt*Wt,te[3]=tt*Wt,te):null}function U(te,be){var tt=be[0];return te[0]=be[3],te[1]=-be[1],te[2]=-be[2],te[3]=tt,te}function I(te){return te[0]*te[3]-te[2]*te[1]}function O(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[0],ar=tt[1],kr=tt[2],we=tt[3];return te[0]=yt*or+qt*ar,te[1]=Bt*or+Wt*ar,te[2]=yt*kr+qt*we,te[3]=Bt*kr+Wt*we,te}function D(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=Math.sin(tt),ar=Math.cos(tt);return te[0]=yt*ar+qt*or,te[1]=Bt*ar+Wt*or,te[2]=yt*-or+qt*ar,te[3]=Bt*-or+Wt*ar,te}function R(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[0],ar=tt[1];return te[0]=yt*or,te[1]=Bt*or,te[2]=qt*ar,te[3]=Wt*ar,te}function y(te,be){var tt=Math.sin(be),yt=Math.cos(be);return te[0]=yt,te[1]=tt,te[2]=-tt,te[3]=yt,te}function v(te,be){return te[0]=be[0],te[1]=0,te[2]=0,te[3]=be[1],te}function h(te){return"mat2("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+")"}function S(te){return Math.hypot(te[0],te[1],te[2],te[3])}function A(te,be,tt,yt){return te[2]=yt[2]/yt[0],tt[0]=yt[0],tt[1]=yt[1],tt[3]=yt[3]-te[2]*tt[1],[te,be,tt]}function x(te,be,tt){return te[0]=be[0]+tt[0],te[1]=be[1]+tt[1],te[2]=be[2]+tt[2],te[3]=be[3]+tt[3],te}function z(te,be,tt){return te[0]=be[0]-tt[0],te[1]=be[1]-tt[1],te[2]=be[2]-tt[2],te[3]=be[3]-tt[3],te}function B(te,be){return te[0]===be[0]&&te[1]===be[1]&&te[2]===be[2]&&te[3]===be[3]}function V(te,be){var tt=te[0],yt=te[1],Bt=te[2],qt=te[3],Wt=be[0],or=be[1],ar=be[2],kr=be[3];return Math.abs(tt-Wt)<=_.EPSILON*Math.max(1,Math.abs(tt),Math.abs(Wt))&&Math.abs(yt-or)<=_.EPSILON*Math.max(1,Math.abs(yt),Math.abs(or))&&Math.abs(Bt-ar)<=_.EPSILON*Math.max(1,Math.abs(Bt),Math.abs(ar))&&Math.abs(qt-kr)<=_.EPSILON*Math.max(1,Math.abs(qt),Math.abs(kr))}function Q(te,be,tt){return te[0]=be[0]*tt,te[1]=be[1]*tt,te[2]=be[2]*tt,te[3]=be[3]*tt,te}function oe(te,be,tt,yt){return te[0]=be[0]+tt[0]*yt,te[1]=be[1]+tt[1]*yt,te[2]=be[2]+tt[2]*yt,te[3]=be[3]+tt[3]*yt,te}var re=O,Z=z;function ee(){var te=new _.ARRAY_TYPE(6);return _.ARRAY_TYPE!=Float32Array&&(te[1]=0,te[2]=0,te[4]=0,te[5]=0),te[0]=1,te[3]=1,te}function H(te){var be=new _.ARRAY_TYPE(6);return be[0]=te[0],be[1]=te[1],be[2]=te[2],be[3]=te[3],be[4]=te[4],be[5]=te[5],be}function ae(te,be){return te[0]=be[0],te[1]=be[1],te[2]=be[2],te[3]=be[3],te[4]=be[4],te[5]=be[5],te}function G(te){return te[0]=1,te[1]=0,te[2]=0,te[3]=1,te[4]=0,te[5]=0,te}function ie(te,be,tt,yt,Bt,qt){var Wt=new _.ARRAY_TYPE(6);return Wt[0]=te,Wt[1]=be,Wt[2]=tt,Wt[3]=yt,Wt[4]=Bt,Wt[5]=qt,Wt}function le(te,be,tt,yt,Bt,qt,Wt){return te[0]=be,te[1]=tt,te[2]=yt,te[3]=Bt,te[4]=qt,te[5]=Wt,te}function Me(te,be){var tt=be[0],yt=be[1],Bt=be[2],qt=be[3],Wt=be[4],or=be[5],ar=tt*qt-yt*Bt;return ar?(ar=1/ar,te[0]=qt*ar,te[1]=-yt*ar,te[2]=-Bt*ar,te[3]=tt*ar,te[4]=(Bt*or-qt*Wt)*ar,te[5]=(yt*Wt-tt*or)*ar,te):null}function ge(te){return te[0]*te[3]-te[1]*te[2]}function pe(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=be[4],ar=be[5],kr=tt[0],we=tt[1],je=tt[2],Ue=tt[3],ut=tt[4],Xt=tt[5];return te[0]=yt*kr+qt*we,te[1]=Bt*kr+Wt*we,te[2]=yt*je+qt*Ue,te[3]=Bt*je+Wt*Ue,te[4]=yt*ut+qt*Xt+or,te[5]=Bt*ut+Wt*Xt+ar,te}function Ne(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=be[4],ar=be[5],kr=Math.sin(tt),we=Math.cos(tt);return te[0]=yt*we+qt*kr,te[1]=Bt*we+Wt*kr,te[2]=yt*-kr+qt*we,te[3]=Bt*-kr+Wt*we,te[4]=or,te[5]=ar,te}function Re(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=be[4],ar=be[5],kr=tt[0],we=tt[1];return te[0]=yt*kr,te[1]=Bt*kr,te[2]=qt*we,te[3]=Wt*we,te[4]=or,te[5]=ar,te}function he(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=be[4],ar=be[5],kr=tt[0],we=tt[1];return te[0]=yt,te[1]=Bt,te[2]=qt,te[3]=Wt,te[4]=yt*kr+qt*we+or,te[5]=Bt*kr+Wt*we+ar,te}function se(te,be){var tt=Math.sin(be),yt=Math.cos(be);return te[0]=yt,te[1]=tt,te[2]=-tt,te[3]=yt,te[4]=0,te[5]=0,te}function J(te,be){return te[0]=be[0],te[1]=0,te[2]=0,te[3]=be[1],te[4]=0,te[5]=0,te}function fe(te,be){return te[0]=1,te[1]=0,te[2]=0,te[3]=1,te[4]=be[0],te[5]=be[1],te}function me(te){return"mat2d("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+", "+te[4]+", "+te[5]+")"}function Le(te){return Math.hypot(te[0],te[1],te[2],te[3],te[4],te[5],1)}function C(te,be,tt){return te[0]=be[0]+tt[0],te[1]=be[1]+tt[1],te[2]=be[2]+tt[2],te[3]=be[3]+tt[3],te[4]=be[4]+tt[4],te[5]=be[5]+tt[5],te}function X(te,be,tt){return te[0]=be[0]-tt[0],te[1]=be[1]-tt[1],te[2]=be[2]-tt[2],te[3]=be[3]-tt[3],te[4]=be[4]-tt[4],te[5]=be[5]-tt[5],te}function de(te,be,tt){return te[0]=be[0]*tt,te[1]=be[1]*tt,te[2]=be[2]*tt,te[3]=be[3]*tt,te[4]=be[4]*tt,te[5]=be[5]*tt,te}function Ae(te,be,tt,yt){return te[0]=be[0]+tt[0]*yt,te[1]=be[1]+tt[1]*yt,te[2]=be[2]+tt[2]*yt,te[3]=be[3]+tt[3]*yt,te[4]=be[4]+tt[4]*yt,te[5]=be[5]+tt[5]*yt,te}function De(te,be){return te[0]===be[0]&&te[1]===be[1]&&te[2]===be[2]&&te[3]===be[3]&&te[4]===be[4]&&te[5]===be[5]}function Ge(te,be){var tt=te[0],yt=te[1],Bt=te[2],qt=te[3],Wt=te[4],or=te[5],ar=be[0],kr=be[1],we=be[2],je=be[3],Ue=be[4],ut=be[5];return Math.abs(tt-ar)<=_.EPSILON*Math.max(1,Math.abs(tt),Math.abs(ar))&&Math.abs(yt-kr)<=_.EPSILON*Math.max(1,Math.abs(yt),Math.abs(kr))&&Math.abs(Bt-we)<=_.EPSILON*Math.max(1,Math.abs(Bt),Math.abs(we))&&Math.abs(qt-je)<=_.EPSILON*Math.max(1,Math.abs(qt),Math.abs(je))&&Math.abs(Wt-Ue)<=_.EPSILON*Math.max(1,Math.abs(Wt),Math.abs(Ue))&&Math.abs(or-ut)<=_.EPSILON*Math.max(1,Math.abs(or),Math.abs(ut))}var $e=pe,ct=X,gt=n(35600),st=n(85975),xe=n(77160),Mt=n(98333);function Ut(){var te=new _.ARRAY_TYPE(4);return _.ARRAY_TYPE!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0),te[3]=1,te}function At(te){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te}function nt(te,be,tt){tt=tt*.5;var yt=Math.sin(tt);return te[0]=yt*be[0],te[1]=yt*be[1],te[2]=yt*be[2],te[3]=Math.cos(tt),te}function it(te,be){var tt=Math.acos(be[3])*2,yt=Math.sin(tt/2);return yt>_.EPSILON?(te[0]=be[0]/yt,te[1]=be[1]/yt,te[2]=be[2]/yt):(te[0]=1,te[1]=0,te[2]=0),tt}function pt(te,be){var tt=Zt(te,be);return Math.acos(2*tt*tt-1)}function Vt(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[0],ar=tt[1],kr=tt[2],we=tt[3];return te[0]=yt*we+Wt*or+Bt*kr-qt*ar,te[1]=Bt*we+Wt*ar+qt*or-yt*kr,te[2]=qt*we+Wt*kr+yt*ar-Bt*or,te[3]=Wt*we-yt*or-Bt*ar-qt*kr,te}function Er(te,be,tt){tt*=.5;var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=Math.sin(tt),ar=Math.cos(tt);return te[0]=yt*ar+Wt*or,te[1]=Bt*ar+qt*or,te[2]=qt*ar-Bt*or,te[3]=Wt*ar-yt*or,te}function mr(te,be,tt){tt*=.5;var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=Math.sin(tt),ar=Math.cos(tt);return te[0]=yt*ar-qt*or,te[1]=Bt*ar+Wt*or,te[2]=qt*ar+yt*or,te[3]=Wt*ar-Bt*or,te}function Br(te,be,tt){tt*=.5;var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=Math.sin(tt),ar=Math.cos(tt);return te[0]=yt*ar+Bt*or,te[1]=Bt*ar-yt*or,te[2]=qt*ar+Wt*or,te[3]=Wt*ar-qt*or,te}function Ur(te,be){var tt=be[0],yt=be[1],Bt=be[2];return te[0]=tt,te[1]=yt,te[2]=Bt,te[3]=Math.sqrt(Math.abs(1-tt*tt-yt*yt-Bt*Bt)),te}function Ar(te,be){var tt=be[0],yt=be[1],Bt=be[2],qt=be[3],Wt=Math.sqrt(tt*tt+yt*yt+Bt*Bt),or=Math.exp(qt),ar=Wt>0?or*Math.sin(Wt)/Wt:0;return te[0]=tt*ar,te[1]=yt*ar,te[2]=Bt*ar,te[3]=or*Math.cos(Wt),te}function Nn(te,be){var tt=be[0],yt=be[1],Bt=be[2],qt=be[3],Wt=Math.sqrt(tt*tt+yt*yt+Bt*Bt),or=Wt>0?Math.atan2(Wt,qt)/Wt:0;return te[0]=tt*or,te[1]=yt*or,te[2]=Bt*or,te[3]=.5*Math.log(tt*tt+yt*yt+Bt*Bt+qt*qt),te}function Rn(te,be,tt){return Nn(te,be),Et(te,te,tt),Ar(te,te),te}function ci(te,be,tt,yt){var Bt=be[0],qt=be[1],Wt=be[2],or=be[3],ar=tt[0],kr=tt[1],we=tt[2],je=tt[3],Ue,ut,Xt,Mr,bn;return ut=Bt*ar+qt*kr+Wt*we+or*je,ut<0&&(ut=-ut,ar=-ar,kr=-kr,we=-we,je=-je),1-ut>_.EPSILON?(Ue=Math.acos(ut),Xt=Math.sin(Ue),Mr=Math.sin((1-yt)*Ue)/Xt,bn=Math.sin(yt*Ue)/Xt):(Mr=1-yt,bn=yt),te[0]=Mr*Bt+bn*ar,te[1]=Mr*qt+bn*kr,te[2]=Mr*Wt+bn*we,te[3]=Mr*or+bn*je,te}function Fi(te){var be=_.RANDOM(),tt=_.RANDOM(),yt=_.RANDOM(),Bt=Math.sqrt(1-be),qt=Math.sqrt(be);return te[0]=Bt*Math.sin(2*Math.PI*tt),te[1]=Bt*Math.cos(2*Math.PI*tt),te[2]=qt*Math.sin(2*Math.PI*yt),te[3]=qt*Math.cos(2*Math.PI*yt),te}function ji(te,be){var tt=be[0],yt=be[1],Bt=be[2],qt=be[3],Wt=tt*tt+yt*yt+Bt*Bt+qt*qt,or=Wt?1/Wt:0;return te[0]=-tt*or,te[1]=-yt*or,te[2]=-Bt*or,te[3]=qt*or,te}function Si(te,be){return te[0]=-be[0],te[1]=-be[1],te[2]=-be[2],te[3]=be[3],te}function xi(te,be){var tt=be[0]+be[4]+be[8],yt;if(tt>0)yt=Math.sqrt(tt+1),te[3]=.5*yt,yt=.5/yt,te[0]=(be[5]-be[7])*yt,te[1]=(be[6]-be[2])*yt,te[2]=(be[1]-be[3])*yt;else{var Bt=0;be[4]>be[0]&&(Bt=1),be[8]>be[Bt*3+Bt]&&(Bt=2);var qt=(Bt+1)%3,Wt=(Bt+2)%3;yt=Math.sqrt(be[Bt*3+Bt]-be[qt*3+qt]-be[Wt*3+Wt]+1),te[Bt]=.5*yt,yt=.5/yt,te[3]=(be[qt*3+Wt]-be[Wt*3+qt])*yt,te[qt]=(be[qt*3+Bt]+be[Bt*3+qt])*yt,te[Wt]=(be[Wt*3+Bt]+be[Bt*3+Wt])*yt}return te}function Ee(te,be,tt,yt){var Bt=.5*Math.PI/180;be*=Bt,tt*=Bt,yt*=Bt;var qt=Math.sin(be),Wt=Math.cos(be),or=Math.sin(tt),ar=Math.cos(tt),kr=Math.sin(yt),we=Math.cos(yt);return te[0]=qt*ar*we-Wt*or*kr,te[1]=Wt*or*we+qt*ar*kr,te[2]=Wt*ar*kr-qt*or*we,te[3]=Wt*ar*we+qt*or*kr,te}function ke(te){return"quat("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+")"}var ze=Mt.clone,Ke=Mt.fromValues,ot=Mt.copy,Rt=Mt.set,Nt=Mt.add,Ye=Vt,Et=Mt.scale,Zt=Mt.dot,Lr=Mt.lerp,ir=Mt.length,ur=ir,Or=Mt.squaredLength,nn=Or,Hr=Mt.normalize,gr=Mt.exactEquals,vn=Mt.equals,an=function(){var te=xe.create(),be=xe.fromValues(1,0,0),tt=xe.fromValues(0,1,0);return function(yt,Bt,qt){var Wt=xe.dot(Bt,qt);return Wt<-.999999?(xe.cross(te,be,Bt),xe.len(te)<1e-6&&xe.cross(te,tt,Bt),xe.normalize(te,te),nt(yt,te,Math.PI),yt):Wt>.999999?(yt[0]=0,yt[1]=0,yt[2]=0,yt[3]=1,yt):(xe.cross(te,Bt,qt),yt[0]=te[0],yt[1]=te[1],yt[2]=te[2],yt[3]=1+Wt,Hr(yt,yt))}}(),sn=function(){var te=Ut(),be=Ut();return function(tt,yt,Bt,qt,Wt,or){return ci(te,yt,Wt,or),ci(be,Bt,qt,or),ci(tt,te,be,2*or*(1-or)),tt}}(),Ei=function(){var te=gt.create();return function(be,tt,yt,Bt){return te[0]=yt[0],te[3]=yt[1],te[6]=yt[2],te[1]=Bt[0],te[4]=Bt[1],te[7]=Bt[2],te[2]=-tt[0],te[5]=-tt[1],te[8]=-tt[2],Hr(be,xi(be,te))}}();function fn(){var te=new _.ARRAY_TYPE(8);return _.ARRAY_TYPE!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0,te[4]=0,te[5]=0,te[6]=0,te[7]=0),te[3]=1,te}function ni(te){var be=new _.ARRAY_TYPE(8);return be[0]=te[0],be[1]=te[1],be[2]=te[2],be[3]=te[3],be[4]=te[4],be[5]=te[5],be[6]=te[6],be[7]=te[7],be}function Ui(te,be,tt,yt,Bt,qt,Wt,or){var ar=new _.ARRAY_TYPE(8);return ar[0]=te,ar[1]=be,ar[2]=tt,ar[3]=yt,ar[4]=Bt,ar[5]=qt,ar[6]=Wt,ar[7]=or,ar}function mi(te,be,tt,yt,Bt,qt,Wt){var or=new _.ARRAY_TYPE(8);or[0]=te,or[1]=be,or[2]=tt,or[3]=yt;var ar=Bt*.5,kr=qt*.5,we=Wt*.5;return or[4]=ar*yt+kr*tt-we*be,or[5]=kr*yt+we*te-ar*tt,or[6]=we*yt+ar*be-kr*te,or[7]=-ar*te-kr*be-we*tt,or}function Li(te,be,tt){var yt=tt[0]*.5,Bt=tt[1]*.5,qt=tt[2]*.5,Wt=be[0],or=be[1],ar=be[2],kr=be[3];return te[0]=Wt,te[1]=or,te[2]=ar,te[3]=kr,te[4]=yt*kr+Bt*ar-qt*or,te[5]=Bt*kr+qt*Wt-yt*ar,te[6]=qt*kr+yt*or-Bt*Wt,te[7]=-yt*Wt-Bt*or-qt*ar,te}function ui(te,be){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=be[0]*.5,te[5]=be[1]*.5,te[6]=be[2]*.5,te[7]=0,te}function fi(te,be){return te[0]=be[0],te[1]=be[1],te[2]=be[2],te[3]=be[3],te[4]=0,te[5]=0,te[6]=0,te[7]=0,te}function Wi(te,be){var tt=Ut();st.getRotation(tt,be);var yt=new _.ARRAY_TYPE(3);return st.getTranslation(yt,be),Li(te,tt,yt),te}function va(te,be){return te[0]=be[0],te[1]=be[1],te[2]=be[2],te[3]=be[3],te[4]=be[4],te[5]=be[5],te[6]=be[6],te[7]=be[7],te}function Pi(te){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te[4]=0,te[5]=0,te[6]=0,te[7]=0,te}function hi(te,be,tt,yt,Bt,qt,Wt,or,ar){return te[0]=be,te[1]=tt,te[2]=yt,te[3]=Bt,te[4]=qt,te[5]=Wt,te[6]=or,te[7]=ar,te}var Ii=ot;function La(te,be){return te[0]=be[4],te[1]=be[5],te[2]=be[6],te[3]=be[7],te}var ls=ot;function Ta(te,be){return te[4]=be[0],te[5]=be[1],te[6]=be[2],te[7]=be[3],te}function ma(te,be){var tt=be[4],yt=be[5],Bt=be[6],qt=be[7],Wt=-be[0],or=-be[1],ar=-be[2],kr=be[3];return te[0]=(tt*kr+qt*Wt+yt*ar-Bt*or)*2,te[1]=(yt*kr+qt*or+Bt*Wt-tt*ar)*2,te[2]=(Bt*kr+qt*ar+tt*or-yt*Wt)*2,te}function Qo(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[0]*.5,ar=tt[1]*.5,kr=tt[2]*.5,we=be[4],je=be[5],Ue=be[6],ut=be[7];return te[0]=yt,te[1]=Bt,te[2]=qt,te[3]=Wt,te[4]=Wt*or+Bt*kr-qt*ar+we,te[5]=Wt*ar+qt*or-yt*kr+je,te[6]=Wt*kr+yt*ar-Bt*or+Ue,te[7]=-yt*or-Bt*ar-qt*kr+ut,te}function Es(te,be,tt){var yt=-be[0],Bt=-be[1],qt=-be[2],Wt=be[3],or=be[4],ar=be[5],kr=be[6],we=be[7],je=or*Wt+we*yt+ar*qt-kr*Bt,Ue=ar*Wt+we*Bt+kr*yt-or*qt,ut=kr*Wt+we*qt+or*Bt-ar*yt,Xt=we*Wt-or*yt-ar*Bt-kr*qt;return Er(te,be,tt),yt=te[0],Bt=te[1],qt=te[2],Wt=te[3],te[4]=je*Wt+Xt*yt+Ue*qt-ut*Bt,te[5]=Ue*Wt+Xt*Bt+ut*yt-je*qt,te[6]=ut*Wt+Xt*qt+je*Bt-Ue*yt,te[7]=Xt*Wt-je*yt-Ue*Bt-ut*qt,te}function sa(te,be,tt){var yt=-be[0],Bt=-be[1],qt=-be[2],Wt=be[3],or=be[4],ar=be[5],kr=be[6],we=be[7],je=or*Wt+we*yt+ar*qt-kr*Bt,Ue=ar*Wt+we*Bt+kr*yt-or*qt,ut=kr*Wt+we*qt+or*Bt-ar*yt,Xt=we*Wt-or*yt-ar*Bt-kr*qt;return mr(te,be,tt),yt=te[0],Bt=te[1],qt=te[2],Wt=te[3],te[4]=je*Wt+Xt*yt+Ue*qt-ut*Bt,te[5]=Ue*Wt+Xt*Bt+ut*yt-je*qt,te[6]=ut*Wt+Xt*qt+je*Bt-Ue*yt,te[7]=Xt*Wt-je*yt-Ue*Bt-ut*qt,te}function to(te,be,tt){var yt=-be[0],Bt=-be[1],qt=-be[2],Wt=be[3],or=be[4],ar=be[5],kr=be[6],we=be[7],je=or*Wt+we*yt+ar*qt-kr*Bt,Ue=ar*Wt+we*Bt+kr*yt-or*qt,ut=kr*Wt+we*qt+or*Bt-ar*yt,Xt=we*Wt-or*yt-ar*Bt-kr*qt;return Br(te,be,tt),yt=te[0],Bt=te[1],qt=te[2],Wt=te[3],te[4]=je*Wt+Xt*yt+Ue*qt-ut*Bt,te[5]=Ue*Wt+Xt*Bt+ut*yt-je*qt,te[6]=ut*Wt+Xt*qt+je*Bt-Ue*yt,te[7]=Xt*Wt-je*yt-Ue*Bt-ut*qt,te}function _a(te,be,tt){var yt=tt[0],Bt=tt[1],qt=tt[2],Wt=tt[3],or=be[0],ar=be[1],kr=be[2],we=be[3];return te[0]=or*Wt+we*yt+ar*qt-kr*Bt,te[1]=ar*Wt+we*Bt+kr*yt-or*qt,te[2]=kr*Wt+we*qt+or*Bt-ar*yt,te[3]=we*Wt-or*yt-ar*Bt-kr*qt,or=be[4],ar=be[5],kr=be[6],we=be[7],te[4]=or*Wt+we*yt+ar*qt-kr*Bt,te[5]=ar*Wt+we*Bt+kr*yt-or*qt,te[6]=kr*Wt+we*qt+or*Bt-ar*yt,te[7]=we*Wt-or*yt-ar*Bt-kr*qt,te}function wa(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[0],ar=tt[1],kr=tt[2],we=tt[3];return te[0]=yt*we+Wt*or+Bt*kr-qt*ar,te[1]=Bt*we+Wt*ar+qt*or-yt*kr,te[2]=qt*we+Wt*kr+yt*ar-Bt*or,te[3]=Wt*we-yt*or-Bt*ar-qt*kr,or=tt[4],ar=tt[5],kr=tt[6],we=tt[7],te[4]=yt*we+Wt*or+Bt*kr-qt*ar,te[5]=Bt*we+Wt*ar+qt*or-yt*kr,te[6]=qt*we+Wt*kr+yt*ar-Bt*or,te[7]=Wt*we-yt*or-Bt*ar-qt*kr,te}function $a(te,be,tt,yt){if(Math.abs(yt)<_.EPSILON)return va(te,be);var Bt=Math.hypot(tt[0],tt[1],tt[2]);yt=yt*.5;var qt=Math.sin(yt),Wt=qt*tt[0]/Bt,or=qt*tt[1]/Bt,ar=qt*tt[2]/Bt,kr=Math.cos(yt),we=be[0],je=be[1],Ue=be[2],ut=be[3];te[0]=we*kr+ut*Wt+je*ar-Ue*or,te[1]=je*kr+ut*or+Ue*Wt-we*ar,te[2]=Ue*kr+ut*ar+we*or-je*Wt,te[3]=ut*kr-we*Wt-je*or-Ue*ar;var Xt=be[4],Mr=be[5],bn=be[6],ei=be[7];return te[4]=Xt*kr+ei*Wt+Mr*ar-bn*or,te[5]=Mr*kr+ei*or+bn*Wt-Xt*ar,te[6]=bn*kr+ei*ar+Xt*or-Mr*Wt,te[7]=ei*kr-Xt*Wt-Mr*or-bn*ar,te}function ia(te,be,tt){return te[0]=be[0]+tt[0],te[1]=be[1]+tt[1],te[2]=be[2]+tt[2],te[3]=be[3]+tt[3],te[4]=be[4]+tt[4],te[5]=be[5]+tt[5],te[6]=be[6]+tt[6],te[7]=be[7]+tt[7],te}function Ja(te,be,tt){var yt=be[0],Bt=be[1],qt=be[2],Wt=be[3],or=tt[4],ar=tt[5],kr=tt[6],we=tt[7],je=be[4],Ue=be[5],ut=be[6],Xt=be[7],Mr=tt[0],bn=tt[1],ei=tt[2],Ci=tt[3];return te[0]=yt*Ci+Wt*Mr+Bt*ei-qt*bn,te[1]=Bt*Ci+Wt*bn+qt*Mr-yt*ei,te[2]=qt*Ci+Wt*ei+yt*bn-Bt*Mr,te[3]=Wt*Ci-yt*Mr-Bt*bn-qt*ei,te[4]=yt*we+Wt*or+Bt*kr-qt*ar+je*Ci+Xt*Mr+Ue*ei-ut*bn,te[5]=Bt*we+Wt*ar+qt*or-yt*kr+Ue*Ci+Xt*bn+ut*Mr-je*ei,te[6]=qt*we+Wt*kr+yt*ar-Bt*or+ut*Ci+Xt*ei+je*bn-Ue*Mr,te[7]=Wt*we-yt*or-Bt*ar-qt*kr+Xt*Ci-je*Mr-Ue*bn-ut*ei,te}var ro=Ja;function Xa(te,be,tt){return te[0]=be[0]*tt,te[1]=be[1]*tt,te[2]=be[2]*tt,te[3]=be[3]*tt,te[4]=be[4]*tt,te[5]=be[5]*tt,te[6]=be[6]*tt,te[7]=be[7]*tt,te}var no=Zt;function go(te,be,tt,yt){var Bt=1-yt;return no(be,tt)<0&&(yt=-yt),te[0]=be[0]*Bt+tt[0]*yt,te[1]=be[1]*Bt+tt[1]*yt,te[2]=be[2]*Bt+tt[2]*yt,te[3]=be[3]*Bt+tt[3]*yt,te[4]=be[4]*Bt+tt[4]*yt,te[5]=be[5]*Bt+tt[5]*yt,te[6]=be[6]*Bt+tt[6]*yt,te[7]=be[7]*Bt+tt[7]*yt,te}function fa(te,be){var tt=Ve(be);return te[0]=-be[0]/tt,te[1]=-be[1]/tt,te[2]=-be[2]/tt,te[3]=be[3]/tt,te[4]=-be[4]/tt,te[5]=-be[5]/tt,te[6]=-be[6]/tt,te[7]=be[7]/tt,te}function ja(te,be){return te[0]=-be[0],te[1]=-be[1],te[2]=-be[2],te[3]=be[3],te[4]=-be[4],te[5]=-be[5],te[6]=-be[6],te[7]=be[7],te}var Qa=ir,Ua=Qa,Ve=Or,rt=Ve;function wt(te,be){var tt=Ve(be);if(tt>0){tt=Math.sqrt(tt);var yt=be[0]/tt,Bt=be[1]/tt,qt=be[2]/tt,Wt=be[3]/tt,or=be[4],ar=be[5],kr=be[6],we=be[7],je=yt*or+Bt*ar+qt*kr+Wt*we;te[0]=yt,te[1]=Bt,te[2]=qt,te[3]=Wt,te[4]=(or-yt*je)/tt,te[5]=(ar-Bt*je)/tt,te[6]=(kr-qt*je)/tt,te[7]=(we-Wt*je)/tt}return te}function lr(te){return"quat2("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+", "+te[4]+", "+te[5]+", "+te[6]+", "+te[7]+")"}function Zr(te,be){return te[0]===be[0]&&te[1]===be[1]&&te[2]===be[2]&&te[3]===be[3]&&te[4]===be[4]&&te[5]===be[5]&&te[6]===be[6]&&te[7]===be[7]}function Un(te,be){var tt=te[0],yt=te[1],Bt=te[2],qt=te[3],Wt=te[4],or=te[5],ar=te[6],kr=te[7],we=be[0],je=be[1],Ue=be[2],ut=be[3],Xt=be[4],Mr=be[5],bn=be[6],ei=be[7];return Math.abs(tt-we)<=_.EPSILON*Math.max(1,Math.abs(tt),Math.abs(we))&&Math.abs(yt-je)<=_.EPSILON*Math.max(1,Math.abs(yt),Math.abs(je))&&Math.abs(Bt-Ue)<=_.EPSILON*Math.max(1,Math.abs(Bt),Math.abs(Ue))&&Math.abs(qt-ut)<=_.EPSILON*Math.max(1,Math.abs(qt),Math.abs(ut))&&Math.abs(Wt-Xt)<=_.EPSILON*Math.max(1,Math.abs(Wt),Math.abs(Xt))&&Math.abs(or-Mr)<=_.EPSILON*Math.max(1,Math.abs(or),Math.abs(Mr))&&Math.abs(ar-bn)<=_.EPSILON*Math.max(1,Math.abs(ar),Math.abs(bn))&&Math.abs(kr-ei)<=_.EPSILON*Math.max(1,Math.abs(kr),Math.abs(ei))}var oi=n(31437)},85975:function(Te,c,n){"use strict";n.r(c),n.d(c,{create:function(){return F},clone:function(){return o},copy:function(){return w},fromValues:function(){return _},set:function(){return P},identity:function(){return L},transpose:function(){return d},invert:function(){return E},adjoint:function(){return g},determinant:function(){return k},multiply:function(){return M},translate:function(){return j},scale:function(){return U},rotate:function(){return I},rotateX:function(){return O},rotateY:function(){return D},rotateZ:function(){return R},fromTranslation:function(){return y},fromScaling:function(){return v},fromRotation:function(){return h},fromXRotation:function(){return S},fromYRotation:function(){return A},fromZRotation:function(){return x},fromRotationTranslation:function(){return z},fromQuat2:function(){return B},getTranslation:function(){return V},getScaling:function(){return Q},getRotation:function(){return oe},fromRotationTranslationScale:function(){return re},fromRotationTranslationScaleOrigin:function(){return Z},fromQuat:function(){return ee},frustum:function(){return H},perspective:function(){return ae},perspectiveFromFieldOfView:function(){return G},ortho:function(){return ie},lookAt:function(){return le},targetTo:function(){return Me},str:function(){return ge},frob:function(){return pe},add:function(){return Ne},subtract:function(){return Re},multiplyScalar:function(){return he},multiplyScalarAndAdd:function(){return se},exactEquals:function(){return J},equals:function(){return fe},mul:function(){return me},sub:function(){return Le}});var i=n(49685);function F(){var C=new i.ARRAY_TYPE(16);return i.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=0,C[12]=0,C[13]=0,C[14]=0),C[0]=1,C[5]=1,C[10]=1,C[15]=1,C}function o(C){var X=new i.ARRAY_TYPE(16);return X[0]=C[0],X[1]=C[1],X[2]=C[2],X[3]=C[3],X[4]=C[4],X[5]=C[5],X[6]=C[6],X[7]=C[7],X[8]=C[8],X[9]=C[9],X[10]=C[10],X[11]=C[11],X[12]=C[12],X[13]=C[13],X[14]=C[14],X[15]=C[15],X}function w(C,X){return C[0]=X[0],C[1]=X[1],C[2]=X[2],C[3]=X[3],C[4]=X[4],C[5]=X[5],C[6]=X[6],C[7]=X[7],C[8]=X[8],C[9]=X[9],C[10]=X[10],C[11]=X[11],C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15],C}function _(C,X,de,Ae,De,Ge,$e,ct,gt,st,xe,Mt,Ut,At,nt,it){var pt=new i.ARRAY_TYPE(16);return pt[0]=C,pt[1]=X,pt[2]=de,pt[3]=Ae,pt[4]=De,pt[5]=Ge,pt[6]=$e,pt[7]=ct,pt[8]=gt,pt[9]=st,pt[10]=xe,pt[11]=Mt,pt[12]=Ut,pt[13]=At,pt[14]=nt,pt[15]=it,pt}function P(C,X,de,Ae,De,Ge,$e,ct,gt,st,xe,Mt,Ut,At,nt,it,pt){return C[0]=X,C[1]=de,C[2]=Ae,C[3]=De,C[4]=Ge,C[5]=$e,C[6]=ct,C[7]=gt,C[8]=st,C[9]=xe,C[10]=Mt,C[11]=Ut,C[12]=At,C[13]=nt,C[14]=it,C[15]=pt,C}function L(C){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function d(C,X){if(C===X){var de=X[1],Ae=X[2],De=X[3],Ge=X[6],$e=X[7],ct=X[11];C[1]=X[4],C[2]=X[8],C[3]=X[12],C[4]=de,C[6]=X[9],C[7]=X[13],C[8]=Ae,C[9]=Ge,C[11]=X[14],C[12]=De,C[13]=$e,C[14]=ct}else C[0]=X[0],C[1]=X[4],C[2]=X[8],C[3]=X[12],C[4]=X[1],C[5]=X[5],C[6]=X[9],C[7]=X[13],C[8]=X[2],C[9]=X[6],C[10]=X[10],C[11]=X[14],C[12]=X[3],C[13]=X[7],C[14]=X[11],C[15]=X[15];return C}function E(C,X){var de=X[0],Ae=X[1],De=X[2],Ge=X[3],$e=X[4],ct=X[5],gt=X[6],st=X[7],xe=X[8],Mt=X[9],Ut=X[10],At=X[11],nt=X[12],it=X[13],pt=X[14],Vt=X[15],Er=de*ct-Ae*$e,mr=de*gt-De*$e,Br=de*st-Ge*$e,Ur=Ae*gt-De*ct,Ar=Ae*st-Ge*ct,Nn=De*st-Ge*gt,Rn=xe*it-Mt*nt,ci=xe*pt-Ut*nt,Fi=xe*Vt-At*nt,ji=Mt*pt-Ut*it,Si=Mt*Vt-At*it,xi=Ut*Vt-At*pt,Ee=Er*xi-mr*Si+Br*ji+Ur*Fi-Ar*ci+Nn*Rn;return Ee?(Ee=1/Ee,C[0]=(ct*xi-gt*Si+st*ji)*Ee,C[1]=(De*Si-Ae*xi-Ge*ji)*Ee,C[2]=(it*Nn-pt*Ar+Vt*Ur)*Ee,C[3]=(Ut*Ar-Mt*Nn-At*Ur)*Ee,C[4]=(gt*Fi-$e*xi-st*ci)*Ee,C[5]=(de*xi-De*Fi+Ge*ci)*Ee,C[6]=(pt*Br-nt*Nn-Vt*mr)*Ee,C[7]=(xe*Nn-Ut*Br+At*mr)*Ee,C[8]=($e*Si-ct*Fi+st*Rn)*Ee,C[9]=(Ae*Fi-de*Si-Ge*Rn)*Ee,C[10]=(nt*Ar-it*Br+Vt*Er)*Ee,C[11]=(Mt*Br-xe*Ar-At*Er)*Ee,C[12]=(ct*ci-$e*ji-gt*Rn)*Ee,C[13]=(de*ji-Ae*ci+De*Rn)*Ee,C[14]=(it*mr-nt*Ur-pt*Er)*Ee,C[15]=(xe*Ur-Mt*mr+Ut*Er)*Ee,C):null}function g(C,X){var de=X[0],Ae=X[1],De=X[2],Ge=X[3],$e=X[4],ct=X[5],gt=X[6],st=X[7],xe=X[8],Mt=X[9],Ut=X[10],At=X[11],nt=X[12],it=X[13],pt=X[14],Vt=X[15];return C[0]=ct*(Ut*Vt-At*pt)-Mt*(gt*Vt-st*pt)+it*(gt*At-st*Ut),C[1]=-(Ae*(Ut*Vt-At*pt)-Mt*(De*Vt-Ge*pt)+it*(De*At-Ge*Ut)),C[2]=Ae*(gt*Vt-st*pt)-ct*(De*Vt-Ge*pt)+it*(De*st-Ge*gt),C[3]=-(Ae*(gt*At-st*Ut)-ct*(De*At-Ge*Ut)+Mt*(De*st-Ge*gt)),C[4]=-($e*(Ut*Vt-At*pt)-xe*(gt*Vt-st*pt)+nt*(gt*At-st*Ut)),C[5]=de*(Ut*Vt-At*pt)-xe*(De*Vt-Ge*pt)+nt*(De*At-Ge*Ut),C[6]=-(de*(gt*Vt-st*pt)-$e*(De*Vt-Ge*pt)+nt*(De*st-Ge*gt)),C[7]=de*(gt*At-st*Ut)-$e*(De*At-Ge*Ut)+xe*(De*st-Ge*gt),C[8]=$e*(Mt*Vt-At*it)-xe*(ct*Vt-st*it)+nt*(ct*At-st*Mt),C[9]=-(de*(Mt*Vt-At*it)-xe*(Ae*Vt-Ge*it)+nt*(Ae*At-Ge*Mt)),C[10]=de*(ct*Vt-st*it)-$e*(Ae*Vt-Ge*it)+nt*(Ae*st-Ge*ct),C[11]=-(de*(ct*At-st*Mt)-$e*(Ae*At-Ge*Mt)+xe*(Ae*st-Ge*ct)),C[12]=-($e*(Mt*pt-Ut*it)-xe*(ct*pt-gt*it)+nt*(ct*Ut-gt*Mt)),C[13]=de*(Mt*pt-Ut*it)-xe*(Ae*pt-De*it)+nt*(Ae*Ut-De*Mt),C[14]=-(de*(ct*pt-gt*it)-$e*(Ae*pt-De*it)+nt*(Ae*gt-De*ct)),C[15]=de*(ct*Ut-gt*Mt)-$e*(Ae*Ut-De*Mt)+xe*(Ae*gt-De*ct),C}function k(C){var X=C[0],de=C[1],Ae=C[2],De=C[3],Ge=C[4],$e=C[5],ct=C[6],gt=C[7],st=C[8],xe=C[9],Mt=C[10],Ut=C[11],At=C[12],nt=C[13],it=C[14],pt=C[15],Vt=X*$e-de*Ge,Er=X*ct-Ae*Ge,mr=X*gt-De*Ge,Br=de*ct-Ae*$e,Ur=de*gt-De*$e,Ar=Ae*gt-De*ct,Nn=st*nt-xe*At,Rn=st*it-Mt*At,ci=st*pt-Ut*At,Fi=xe*it-Mt*nt,ji=xe*pt-Ut*nt,Si=Mt*pt-Ut*it;return Vt*Si-Er*ji+mr*Fi+Br*ci-Ur*Rn+Ar*Nn}function M(C,X,de){var Ae=X[0],De=X[1],Ge=X[2],$e=X[3],ct=X[4],gt=X[5],st=X[6],xe=X[7],Mt=X[8],Ut=X[9],At=X[10],nt=X[11],it=X[12],pt=X[13],Vt=X[14],Er=X[15],mr=de[0],Br=de[1],Ur=de[2],Ar=de[3];return C[0]=mr*Ae+Br*ct+Ur*Mt+Ar*it,C[1]=mr*De+Br*gt+Ur*Ut+Ar*pt,C[2]=mr*Ge+Br*st+Ur*At+Ar*Vt,C[3]=mr*$e+Br*xe+Ur*nt+Ar*Er,mr=de[4],Br=de[5],Ur=de[6],Ar=de[7],C[4]=mr*Ae+Br*ct+Ur*Mt+Ar*it,C[5]=mr*De+Br*gt+Ur*Ut+Ar*pt,C[6]=mr*Ge+Br*st+Ur*At+Ar*Vt,C[7]=mr*$e+Br*xe+Ur*nt+Ar*Er,mr=de[8],Br=de[9],Ur=de[10],Ar=de[11],C[8]=mr*Ae+Br*ct+Ur*Mt+Ar*it,C[9]=mr*De+Br*gt+Ur*Ut+Ar*pt,C[10]=mr*Ge+Br*st+Ur*At+Ar*Vt,C[11]=mr*$e+Br*xe+Ur*nt+Ar*Er,mr=de[12],Br=de[13],Ur=de[14],Ar=de[15],C[12]=mr*Ae+Br*ct+Ur*Mt+Ar*it,C[13]=mr*De+Br*gt+Ur*Ut+Ar*pt,C[14]=mr*Ge+Br*st+Ur*At+Ar*Vt,C[15]=mr*$e+Br*xe+Ur*nt+Ar*Er,C}function j(C,X,de){var Ae=de[0],De=de[1],Ge=de[2],$e,ct,gt,st,xe,Mt,Ut,At,nt,it,pt,Vt;return X===C?(C[12]=X[0]*Ae+X[4]*De+X[8]*Ge+X[12],C[13]=X[1]*Ae+X[5]*De+X[9]*Ge+X[13],C[14]=X[2]*Ae+X[6]*De+X[10]*Ge+X[14],C[15]=X[3]*Ae+X[7]*De+X[11]*Ge+X[15]):($e=X[0],ct=X[1],gt=X[2],st=X[3],xe=X[4],Mt=X[5],Ut=X[6],At=X[7],nt=X[8],it=X[9],pt=X[10],Vt=X[11],C[0]=$e,C[1]=ct,C[2]=gt,C[3]=st,C[4]=xe,C[5]=Mt,C[6]=Ut,C[7]=At,C[8]=nt,C[9]=it,C[10]=pt,C[11]=Vt,C[12]=$e*Ae+xe*De+nt*Ge+X[12],C[13]=ct*Ae+Mt*De+it*Ge+X[13],C[14]=gt*Ae+Ut*De+pt*Ge+X[14],C[15]=st*Ae+At*De+Vt*Ge+X[15]),C}function U(C,X,de){var Ae=de[0],De=de[1],Ge=de[2];return C[0]=X[0]*Ae,C[1]=X[1]*Ae,C[2]=X[2]*Ae,C[3]=X[3]*Ae,C[4]=X[4]*De,C[5]=X[5]*De,C[6]=X[6]*De,C[7]=X[7]*De,C[8]=X[8]*Ge,C[9]=X[9]*Ge,C[10]=X[10]*Ge,C[11]=X[11]*Ge,C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15],C}function I(C,X,de,Ae){var De=Ae[0],Ge=Ae[1],$e=Ae[2],ct=Math.hypot(De,Ge,$e),gt,st,xe,Mt,Ut,At,nt,it,pt,Vt,Er,mr,Br,Ur,Ar,Nn,Rn,ci,Fi,ji,Si,xi,Ee,ke;return ct<i.EPSILON?null:(ct=1/ct,De*=ct,Ge*=ct,$e*=ct,gt=Math.sin(de),st=Math.cos(de),xe=1-st,Mt=X[0],Ut=X[1],At=X[2],nt=X[3],it=X[4],pt=X[5],Vt=X[6],Er=X[7],mr=X[8],Br=X[9],Ur=X[10],Ar=X[11],Nn=De*De*xe+st,Rn=Ge*De*xe+$e*gt,ci=$e*De*xe-Ge*gt,Fi=De*Ge*xe-$e*gt,ji=Ge*Ge*xe+st,Si=$e*Ge*xe+De*gt,xi=De*$e*xe+Ge*gt,Ee=Ge*$e*xe-De*gt,ke=$e*$e*xe+st,C[0]=Mt*Nn+it*Rn+mr*ci,C[1]=Ut*Nn+pt*Rn+Br*ci,C[2]=At*Nn+Vt*Rn+Ur*ci,C[3]=nt*Nn+Er*Rn+Ar*ci,C[4]=Mt*Fi+it*ji+mr*Si,C[5]=Ut*Fi+pt*ji+Br*Si,C[6]=At*Fi+Vt*ji+Ur*Si,C[7]=nt*Fi+Er*ji+Ar*Si,C[8]=Mt*xi+it*Ee+mr*ke,C[9]=Ut*xi+pt*Ee+Br*ke,C[10]=At*xi+Vt*Ee+Ur*ke,C[11]=nt*xi+Er*Ee+Ar*ke,X!==C&&(C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15]),C)}function O(C,X,de){var Ae=Math.sin(de),De=Math.cos(de),Ge=X[4],$e=X[5],ct=X[6],gt=X[7],st=X[8],xe=X[9],Mt=X[10],Ut=X[11];return X!==C&&(C[0]=X[0],C[1]=X[1],C[2]=X[2],C[3]=X[3],C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15]),C[4]=Ge*De+st*Ae,C[5]=$e*De+xe*Ae,C[6]=ct*De+Mt*Ae,C[7]=gt*De+Ut*Ae,C[8]=st*De-Ge*Ae,C[9]=xe*De-$e*Ae,C[10]=Mt*De-ct*Ae,C[11]=Ut*De-gt*Ae,C}function D(C,X,de){var Ae=Math.sin(de),De=Math.cos(de),Ge=X[0],$e=X[1],ct=X[2],gt=X[3],st=X[8],xe=X[9],Mt=X[10],Ut=X[11];return X!==C&&(C[4]=X[4],C[5]=X[5],C[6]=X[6],C[7]=X[7],C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15]),C[0]=Ge*De-st*Ae,C[1]=$e*De-xe*Ae,C[2]=ct*De-Mt*Ae,C[3]=gt*De-Ut*Ae,C[8]=Ge*Ae+st*De,C[9]=$e*Ae+xe*De,C[10]=ct*Ae+Mt*De,C[11]=gt*Ae+Ut*De,C}function R(C,X,de){var Ae=Math.sin(de),De=Math.cos(de),Ge=X[0],$e=X[1],ct=X[2],gt=X[3],st=X[4],xe=X[5],Mt=X[6],Ut=X[7];return X!==C&&(C[8]=X[8],C[9]=X[9],C[10]=X[10],C[11]=X[11],C[12]=X[12],C[13]=X[13],C[14]=X[14],C[15]=X[15]),C[0]=Ge*De+st*Ae,C[1]=$e*De+xe*Ae,C[2]=ct*De+Mt*Ae,C[3]=gt*De+Ut*Ae,C[4]=st*De-Ge*Ae,C[5]=xe*De-$e*Ae,C[6]=Mt*De-ct*Ae,C[7]=Ut*De-gt*Ae,C}function y(C,X){return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=X[0],C[13]=X[1],C[14]=X[2],C[15]=1,C}function v(C,X){return C[0]=X[0],C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=X[1],C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=X[2],C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function h(C,X,de){var Ae=de[0],De=de[1],Ge=de[2],$e=Math.hypot(Ae,De,Ge),ct,gt,st;return $e<i.EPSILON?null:($e=1/$e,Ae*=$e,De*=$e,Ge*=$e,ct=Math.sin(X),gt=Math.cos(X),st=1-gt,C[0]=Ae*Ae*st+gt,C[1]=De*Ae*st+Ge*ct,C[2]=Ge*Ae*st-De*ct,C[3]=0,C[4]=Ae*De*st-Ge*ct,C[5]=De*De*st+gt,C[6]=Ge*De*st+Ae*ct,C[7]=0,C[8]=Ae*Ge*st+De*ct,C[9]=De*Ge*st-Ae*ct,C[10]=Ge*Ge*st+gt,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C)}function S(C,X){var de=Math.sin(X),Ae=Math.cos(X);return C[0]=1,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ae,C[6]=de,C[7]=0,C[8]=0,C[9]=-de,C[10]=Ae,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function A(C,X){var de=Math.sin(X),Ae=Math.cos(X);return C[0]=Ae,C[1]=0,C[2]=-de,C[3]=0,C[4]=0,C[5]=1,C[6]=0,C[7]=0,C[8]=de,C[9]=0,C[10]=Ae,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function x(C,X){var de=Math.sin(X),Ae=Math.cos(X);return C[0]=Ae,C[1]=de,C[2]=0,C[3]=0,C[4]=-de,C[5]=Ae,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=1,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function z(C,X,de){var Ae=X[0],De=X[1],Ge=X[2],$e=X[3],ct=Ae+Ae,gt=De+De,st=Ge+Ge,xe=Ae*ct,Mt=Ae*gt,Ut=Ae*st,At=De*gt,nt=De*st,it=Ge*st,pt=$e*ct,Vt=$e*gt,Er=$e*st;return C[0]=1-(At+it),C[1]=Mt+Er,C[2]=Ut-Vt,C[3]=0,C[4]=Mt-Er,C[5]=1-(xe+it),C[6]=nt+pt,C[7]=0,C[8]=Ut+Vt,C[9]=nt-pt,C[10]=1-(xe+At),C[11]=0,C[12]=de[0],C[13]=de[1],C[14]=de[2],C[15]=1,C}function B(C,X){var de=new i.ARRAY_TYPE(3),Ae=-X[0],De=-X[1],Ge=-X[2],$e=X[3],ct=X[4],gt=X[5],st=X[6],xe=X[7],Mt=Ae*Ae+De*De+Ge*Ge+$e*$e;return Mt>0?(de[0]=(ct*$e+xe*Ae+gt*Ge-st*De)*2/Mt,de[1]=(gt*$e+xe*De+st*Ae-ct*Ge)*2/Mt,de[2]=(st*$e+xe*Ge+ct*De-gt*Ae)*2/Mt):(de[0]=(ct*$e+xe*Ae+gt*Ge-st*De)*2,de[1]=(gt*$e+xe*De+st*Ae-ct*Ge)*2,de[2]=(st*$e+xe*Ge+ct*De-gt*Ae)*2),z(C,X,de),C}function V(C,X){return C[0]=X[12],C[1]=X[13],C[2]=X[14],C}function Q(C,X){var de=X[0],Ae=X[1],De=X[2],Ge=X[4],$e=X[5],ct=X[6],gt=X[8],st=X[9],xe=X[10];return C[0]=Math.hypot(de,Ae,De),C[1]=Math.hypot(Ge,$e,ct),C[2]=Math.hypot(gt,st,xe),C}function oe(C,X){var de=new i.ARRAY_TYPE(3);Q(de,X);var Ae=1/de[0],De=1/de[1],Ge=1/de[2],$e=X[0]*Ae,ct=X[1]*De,gt=X[2]*Ge,st=X[4]*Ae,xe=X[5]*De,Mt=X[6]*Ge,Ut=X[8]*Ae,At=X[9]*De,nt=X[10]*Ge,it=$e+xe+nt,pt=0;return it>0?(pt=Math.sqrt(it+1)*2,C[3]=.25*pt,C[0]=(Mt-At)/pt,C[1]=(Ut-gt)/pt,C[2]=(ct-st)/pt):$e>xe&&$e>nt?(pt=Math.sqrt(1+$e-xe-nt)*2,C[3]=(Mt-At)/pt,C[0]=.25*pt,C[1]=(ct+st)/pt,C[2]=(Ut+gt)/pt):xe>nt?(pt=Math.sqrt(1+xe-$e-nt)*2,C[3]=(Ut-gt)/pt,C[0]=(ct+st)/pt,C[1]=.25*pt,C[2]=(Mt+At)/pt):(pt=Math.sqrt(1+nt-$e-xe)*2,C[3]=(ct-st)/pt,C[0]=(Ut+gt)/pt,C[1]=(Mt+At)/pt,C[2]=.25*pt),C}function re(C,X,de,Ae){var De=X[0],Ge=X[1],$e=X[2],ct=X[3],gt=De+De,st=Ge+Ge,xe=$e+$e,Mt=De*gt,Ut=De*st,At=De*xe,nt=Ge*st,it=Ge*xe,pt=$e*xe,Vt=ct*gt,Er=ct*st,mr=ct*xe,Br=Ae[0],Ur=Ae[1],Ar=Ae[2];return C[0]=(1-(nt+pt))*Br,C[1]=(Ut+mr)*Br,C[2]=(At-Er)*Br,C[3]=0,C[4]=(Ut-mr)*Ur,C[5]=(1-(Mt+pt))*Ur,C[6]=(it+Vt)*Ur,C[7]=0,C[8]=(At+Er)*Ar,C[9]=(it-Vt)*Ar,C[10]=(1-(Mt+nt))*Ar,C[11]=0,C[12]=de[0],C[13]=de[1],C[14]=de[2],C[15]=1,C}function Z(C,X,de,Ae,De){var Ge=X[0],$e=X[1],ct=X[2],gt=X[3],st=Ge+Ge,xe=$e+$e,Mt=ct+ct,Ut=Ge*st,At=Ge*xe,nt=Ge*Mt,it=$e*xe,pt=$e*Mt,Vt=ct*Mt,Er=gt*st,mr=gt*xe,Br=gt*Mt,Ur=Ae[0],Ar=Ae[1],Nn=Ae[2],Rn=De[0],ci=De[1],Fi=De[2],ji=(1-(it+Vt))*Ur,Si=(At+Br)*Ur,xi=(nt-mr)*Ur,Ee=(At-Br)*Ar,ke=(1-(Ut+Vt))*Ar,ze=(pt+Er)*Ar,Ke=(nt+mr)*Nn,ot=(pt-Er)*Nn,Rt=(1-(Ut+it))*Nn;return C[0]=ji,C[1]=Si,C[2]=xi,C[3]=0,C[4]=Ee,C[5]=ke,C[6]=ze,C[7]=0,C[8]=Ke,C[9]=ot,C[10]=Rt,C[11]=0,C[12]=de[0]+Rn-(ji*Rn+Ee*ci+Ke*Fi),C[13]=de[1]+ci-(Si*Rn+ke*ci+ot*Fi),C[14]=de[2]+Fi-(xi*Rn+ze*ci+Rt*Fi),C[15]=1,C}function ee(C,X){var de=X[0],Ae=X[1],De=X[2],Ge=X[3],$e=de+de,ct=Ae+Ae,gt=De+De,st=de*$e,xe=Ae*$e,Mt=Ae*ct,Ut=De*$e,At=De*ct,nt=De*gt,it=Ge*$e,pt=Ge*ct,Vt=Ge*gt;return C[0]=1-Mt-nt,C[1]=xe+Vt,C[2]=Ut-pt,C[3]=0,C[4]=xe-Vt,C[5]=1-st-nt,C[6]=At+it,C[7]=0,C[8]=Ut+pt,C[9]=At-it,C[10]=1-st-Mt,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,C}function H(C,X,de,Ae,De,Ge,$e){var ct=1/(de-X),gt=1/(De-Ae),st=1/(Ge-$e);return C[0]=Ge*2*ct,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ge*2*gt,C[6]=0,C[7]=0,C[8]=(de+X)*ct,C[9]=(De+Ae)*gt,C[10]=($e+Ge)*st,C[11]=-1,C[12]=0,C[13]=0,C[14]=$e*Ge*2*st,C[15]=0,C}function ae(C,X,de,Ae,De){var Ge=1/Math.tan(X/2),$e;return C[0]=Ge/de,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=Ge,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[11]=-1,C[12]=0,C[13]=0,C[15]=0,De!=null&&De!==Infinity?($e=1/(Ae-De),C[10]=(De+Ae)*$e,C[14]=2*De*Ae*$e):(C[10]=-1,C[14]=-2*Ae),C}function G(C,X,de,Ae){var De=Math.tan(X.upDegrees*Math.PI/180),Ge=Math.tan(X.downDegrees*Math.PI/180),$e=Math.tan(X.leftDegrees*Math.PI/180),ct=Math.tan(X.rightDegrees*Math.PI/180),gt=2/($e+ct),st=2/(De+Ge);return C[0]=gt,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=st,C[6]=0,C[7]=0,C[8]=-(($e-ct)*gt*.5),C[9]=(De-Ge)*st*.5,C[10]=Ae/(de-Ae),C[11]=-1,C[12]=0,C[13]=0,C[14]=Ae*de/(de-Ae),C[15]=0,C}function ie(C,X,de,Ae,De,Ge,$e){var ct=1/(X-de),gt=1/(Ae-De),st=1/(Ge-$e);return C[0]=-2*ct,C[1]=0,C[2]=0,C[3]=0,C[4]=0,C[5]=-2*gt,C[6]=0,C[7]=0,C[8]=0,C[9]=0,C[10]=2*st,C[11]=0,C[12]=(X+de)*ct,C[13]=(De+Ae)*gt,C[14]=($e+Ge)*st,C[15]=1,C}function le(C,X,de,Ae){var De,Ge,$e,ct,gt,st,xe,Mt,Ut,At,nt=X[0],it=X[1],pt=X[2],Vt=Ae[0],Er=Ae[1],mr=Ae[2],Br=de[0],Ur=de[1],Ar=de[2];return Math.abs(nt-Br)<i.EPSILON&&Math.abs(it-Ur)<i.EPSILON&&Math.abs(pt-Ar)<i.EPSILON?L(C):(xe=nt-Br,Mt=it-Ur,Ut=pt-Ar,At=1/Math.hypot(xe,Mt,Ut),xe*=At,Mt*=At,Ut*=At,De=Er*Ut-mr*Mt,Ge=mr*xe-Vt*Ut,$e=Vt*Mt-Er*xe,At=Math.hypot(De,Ge,$e),At?(At=1/At,De*=At,Ge*=At,$e*=At):(De=0,Ge=0,$e=0),ct=Mt*$e-Ut*Ge,gt=Ut*De-xe*$e,st=xe*Ge-Mt*De,At=Math.hypot(ct,gt,st),At?(At=1/At,ct*=At,gt*=At,st*=At):(ct=0,gt=0,st=0),C[0]=De,C[1]=ct,C[2]=xe,C[3]=0,C[4]=Ge,C[5]=gt,C[6]=Mt,C[7]=0,C[8]=$e,C[9]=st,C[10]=Ut,C[11]=0,C[12]=-(De*nt+Ge*it+$e*pt),C[13]=-(ct*nt+gt*it+st*pt),C[14]=-(xe*nt+Mt*it+Ut*pt),C[15]=1,C)}function Me(C,X,de,Ae){var De=X[0],Ge=X[1],$e=X[2],ct=Ae[0],gt=Ae[1],st=Ae[2],xe=De-de[0],Mt=Ge-de[1],Ut=$e-de[2],At=xe*xe+Mt*Mt+Ut*Ut;At>0&&(At=1/Math.sqrt(At),xe*=At,Mt*=At,Ut*=At);var nt=gt*Ut-st*Mt,it=st*xe-ct*Ut,pt=ct*Mt-gt*xe;return At=nt*nt+it*it+pt*pt,At>0&&(At=1/Math.sqrt(At),nt*=At,it*=At,pt*=At),C[0]=nt,C[1]=it,C[2]=pt,C[3]=0,C[4]=Mt*pt-Ut*it,C[5]=Ut*nt-xe*pt,C[6]=xe*it-Mt*nt,C[7]=0,C[8]=xe,C[9]=Mt,C[10]=Ut,C[11]=0,C[12]=De,C[13]=Ge,C[14]=$e,C[15]=1,C}function ge(C){return"mat4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+", "+C[8]+", "+C[9]+", "+C[10]+", "+C[11]+", "+C[12]+", "+C[13]+", "+C[14]+", "+C[15]+")"}function pe(C){return Math.hypot(C[0],C[1],C[2],C[3],C[4],C[5],C[6],C[7],C[8],C[9],C[10],C[11],C[12],C[13],C[14],C[15])}function Ne(C,X,de){return C[0]=X[0]+de[0],C[1]=X[1]+de[1],C[2]=X[2]+de[2],C[3]=X[3]+de[3],C[4]=X[4]+de[4],C[5]=X[5]+de[5],C[6]=X[6]+de[6],C[7]=X[7]+de[7],C[8]=X[8]+de[8],C[9]=X[9]+de[9],C[10]=X[10]+de[10],C[11]=X[11]+de[11],C[12]=X[12]+de[12],C[13]=X[13]+de[13],C[14]=X[14]+de[14],C[15]=X[15]+de[15],C}function Re(C,X,de){return C[0]=X[0]-de[0],C[1]=X[1]-de[1],C[2]=X[2]-de[2],C[3]=X[3]-de[3],C[4]=X[4]-de[4],C[5]=X[5]-de[5],C[6]=X[6]-de[6],C[7]=X[7]-de[7],C[8]=X[8]-de[8],C[9]=X[9]-de[9],C[10]=X[10]-de[10],C[11]=X[11]-de[11],C[12]=X[12]-de[12],C[13]=X[13]-de[13],C[14]=X[14]-de[14],C[15]=X[15]-de[15],C}function he(C,X,de){return C[0]=X[0]*de,C[1]=X[1]*de,C[2]=X[2]*de,C[3]=X[3]*de,C[4]=X[4]*de,C[5]=X[5]*de,C[6]=X[6]*de,C[7]=X[7]*de,C[8]=X[8]*de,C[9]=X[9]*de,C[10]=X[10]*de,C[11]=X[11]*de,C[12]=X[12]*de,C[13]=X[13]*de,C[14]=X[14]*de,C[15]=X[15]*de,C}function se(C,X,de,Ae){return C[0]=X[0]+de[0]*Ae,C[1]=X[1]+de[1]*Ae,C[2]=X[2]+de[2]*Ae,C[3]=X[3]+de[3]*Ae,C[4]=X[4]+de[4]*Ae,C[5]=X[5]+de[5]*Ae,C[6]=X[6]+de[6]*Ae,C[7]=X[7]+de[7]*Ae,C[8]=X[8]+de[8]*Ae,C[9]=X[9]+de[9]*Ae,C[10]=X[10]+de[10]*Ae,C[11]=X[11]+de[11]*Ae,C[12]=X[12]+de[12]*Ae,C[13]=X[13]+de[13]*Ae,C[14]=X[14]+de[14]*Ae,C[15]=X[15]+de[15]*Ae,C}function J(C,X){return C[0]===X[0]&&C[1]===X[1]&&C[2]===X[2]&&C[3]===X[3]&&C[4]===X[4]&&C[5]===X[5]&&C[6]===X[6]&&C[7]===X[7]&&C[8]===X[8]&&C[9]===X[9]&&C[10]===X[10]&&C[11]===X[11]&&C[12]===X[12]&&C[13]===X[13]&&C[14]===X[14]&&C[15]===X[15]}function fe(C,X){var de=C[0],Ae=C[1],De=C[2],Ge=C[3],$e=C[4],ct=C[5],gt=C[6],st=C[7],xe=C[8],Mt=C[9],Ut=C[10],At=C[11],nt=C[12],it=C[13],pt=C[14],Vt=C[15],Er=X[0],mr=X[1],Br=X[2],Ur=X[3],Ar=X[4],Nn=X[5],Rn=X[6],ci=X[7],Fi=X[8],ji=X[9],Si=X[10],xi=X[11],Ee=X[12],ke=X[13],ze=X[14],Ke=X[15];return Math.abs(de-Er)<=i.EPSILON*Math.max(1,Math.abs(de),Math.abs(Er))&&Math.abs(Ae-mr)<=i.EPSILON*Math.max(1,Math.abs(Ae),Math.abs(mr))&&Math.abs(De-Br)<=i.EPSILON*Math.max(1,Math.abs(De),Math.abs(Br))&&Math.abs(Ge-Ur)<=i.EPSILON*Math.max(1,Math.abs(Ge),Math.abs(Ur))&&Math.abs($e-Ar)<=i.EPSILON*Math.max(1,Math.abs($e),Math.abs(Ar))&&Math.abs(ct-Nn)<=i.EPSILON*Math.max(1,Math.abs(ct),Math.abs(Nn))&&Math.abs(gt-Rn)<=i.EPSILON*Math.max(1,Math.abs(gt),Math.abs(Rn))&&Math.abs(st-ci)<=i.EPSILON*Math.max(1,Math.abs(st),Math.abs(ci))&&Math.abs(xe-Fi)<=i.EPSILON*Math.max(1,Math.abs(xe),Math.abs(Fi))&&Math.abs(Mt-ji)<=i.EPSILON*Math.max(1,Math.abs(Mt),Math.abs(ji))&&Math.abs(Ut-Si)<=i.EPSILON*Math.max(1,Math.abs(Ut),Math.abs(Si))&&Math.abs(At-xi)<=i.EPSILON*Math.max(1,Math.abs(At),Math.abs(xi))&&Math.abs(nt-Ee)<=i.EPSILON*Math.max(1,Math.abs(nt),Math.abs(Ee))&&Math.abs(it-ke)<=i.EPSILON*Math.max(1,Math.abs(it),Math.abs(ke))&&Math.abs(pt-ze)<=i.EPSILON*Math.max(1,Math.abs(pt),Math.abs(ze))&&Math.abs(Vt-Ke)<=i.EPSILON*Math.max(1,Math.abs(Vt),Math.abs(Ke))}var me=M,Le=Re},98333:function(Te,c,n){"use strict";n.r(c),n.d(c,{create:function(){return F},clone:function(){return o},fromValues:function(){return w},copy:function(){return _},set:function(){return P},add:function(){return L},subtract:function(){return d},multiply:function(){return E},divide:function(){return g},ceil:function(){return k},floor:function(){return M},min:function(){return j},max:function(){return U},round:function(){return I},scale:function(){return O},scaleAndAdd:function(){return D},distance:function(){return R},squaredDistance:function(){return y},length:function(){return v},squaredLength:function(){return h},negate:function(){return S},inverse:function(){return A},normalize:function(){return x},dot:function(){return z},cross:function(){return B},lerp:function(){return V},random:function(){return Q},transformMat4:function(){return oe},transformQuat:function(){return re},zero:function(){return Z},str:function(){return ee},exactEquals:function(){return H},equals:function(){return ae},sub:function(){return G},mul:function(){return ie},div:function(){return le},dist:function(){return Me},sqrDist:function(){return ge},len:function(){return pe},sqrLen:function(){return Ne},forEach:function(){return Re}});var i=n(49685);function F(){var he=new i.ARRAY_TYPE(4);return i.ARRAY_TYPE!=Float32Array&&(he[0]=0,he[1]=0,he[2]=0,he[3]=0),he}function o(he){var se=new i.ARRAY_TYPE(4);return se[0]=he[0],se[1]=he[1],se[2]=he[2],se[3]=he[3],se}function w(he,se,J,fe){var me=new i.ARRAY_TYPE(4);return me[0]=he,me[1]=se,me[2]=J,me[3]=fe,me}function _(he,se){return he[0]=se[0],he[1]=se[1],he[2]=se[2],he[3]=se[3],he}function P(he,se,J,fe,me){return he[0]=se,he[1]=J,he[2]=fe,he[3]=me,he}function L(he,se,J){return he[0]=se[0]+J[0],he[1]=se[1]+J[1],he[2]=se[2]+J[2],he[3]=se[3]+J[3],he}function d(he,se,J){return he[0]=se[0]-J[0],he[1]=se[1]-J[1],he[2]=se[2]-J[2],he[3]=se[3]-J[3],he}function E(he,se,J){return he[0]=se[0]*J[0],he[1]=se[1]*J[1],he[2]=se[2]*J[2],he[3]=se[3]*J[3],he}function g(he,se,J){return he[0]=se[0]/J[0],he[1]=se[1]/J[1],he[2]=se[2]/J[2],he[3]=se[3]/J[3],he}function k(he,se){return he[0]=Math.ceil(se[0]),he[1]=Math.ceil(se[1]),he[2]=Math.ceil(se[2]),he[3]=Math.ceil(se[3]),he}function M(he,se){return he[0]=Math.floor(se[0]),he[1]=Math.floor(se[1]),he[2]=Math.floor(se[2]),he[3]=Math.floor(se[3]),he}function j(he,se,J){return he[0]=Math.min(se[0],J[0]),he[1]=Math.min(se[1],J[1]),he[2]=Math.min(se[2],J[2]),he[3]=Math.min(se[3],J[3]),he}function U(he,se,J){return he[0]=Math.max(se[0],J[0]),he[1]=Math.max(se[1],J[1]),he[2]=Math.max(se[2],J[2]),he[3]=Math.max(se[3],J[3]),he}function I(he,se){return he[0]=Math.round(se[0]),he[1]=Math.round(se[1]),he[2]=Math.round(se[2]),he[3]=Math.round(se[3]),he}function O(he,se,J){return he[0]=se[0]*J,he[1]=se[1]*J,he[2]=se[2]*J,he[3]=se[3]*J,he}function D(he,se,J,fe){return he[0]=se[0]+J[0]*fe,he[1]=se[1]+J[1]*fe,he[2]=se[2]+J[2]*fe,he[3]=se[3]+J[3]*fe,he}function R(he,se){var J=se[0]-he[0],fe=se[1]-he[1],me=se[2]-he[2],Le=se[3]-he[3];return Math.hypot(J,fe,me,Le)}function y(he,se){var J=se[0]-he[0],fe=se[1]-he[1],me=se[2]-he[2],Le=se[3]-he[3];return J*J+fe*fe+me*me+Le*Le}function v(he){var se=he[0],J=he[1],fe=he[2],me=he[3];return Math.hypot(se,J,fe,me)}function h(he){var se=he[0],J=he[1],fe=he[2],me=he[3];return se*se+J*J+fe*fe+me*me}function S(he,se){return he[0]=-se[0],he[1]=-se[1],he[2]=-se[2],he[3]=-se[3],he}function A(he,se){return he[0]=1/se[0],he[1]=1/se[1],he[2]=1/se[2],he[3]=1/se[3],he}function x(he,se){var J=se[0],fe=se[1],me=se[2],Le=se[3],C=J*J+fe*fe+me*me+Le*Le;return C>0&&(C=1/Math.sqrt(C)),he[0]=J*C,he[1]=fe*C,he[2]=me*C,he[3]=Le*C,he}function z(he,se){return he[0]*se[0]+he[1]*se[1]+he[2]*se[2]+he[3]*se[3]}function B(he,se,J,fe){var me=J[0]*fe[1]-J[1]*fe[0],Le=J[0]*fe[2]-J[2]*fe[0],C=J[0]*fe[3]-J[3]*fe[0],X=J[1]*fe[2]-J[2]*fe[1],de=J[1]*fe[3]-J[3]*fe[1],Ae=J[2]*fe[3]-J[3]*fe[2],De=se[0],Ge=se[1],$e=se[2],ct=se[3];return he[0]=Ge*Ae-$e*de+ct*X,he[1]=-(De*Ae)+$e*C-ct*Le,he[2]=De*de-Ge*C+ct*me,he[3]=-(De*X)+Ge*Le-$e*me,he}function V(he,se,J,fe){var me=se[0],Le=se[1],C=se[2],X=se[3];return he[0]=me+fe*(J[0]-me),he[1]=Le+fe*(J[1]-Le),he[2]=C+fe*(J[2]-C),he[3]=X+fe*(J[3]-X),he}function Q(he,se){se=se||1;var J,fe,me,Le,C,X;do J=i.RANDOM()*2-1,fe=i.RANDOM()*2-1,C=J*J+fe*fe;while(C>=1);do me=i.RANDOM()*2-1,Le=i.RANDOM()*2-1,X=me*me+Le*Le;while(X>=1);var de=Math.sqrt((1-C)/X);return he[0]=se*J,he[1]=se*fe,he[2]=se*me*de,he[3]=se*Le*de,he}function oe(he,se,J){var fe=se[0],me=se[1],Le=se[2],C=se[3];return he[0]=J[0]*fe+J[4]*me+J[8]*Le+J[12]*C,he[1]=J[1]*fe+J[5]*me+J[9]*Le+J[13]*C,he[2]=J[2]*fe+J[6]*me+J[10]*Le+J[14]*C,he[3]=J[3]*fe+J[7]*me+J[11]*Le+J[15]*C,he}function re(he,se,J){var fe=se[0],me=se[1],Le=se[2],C=J[0],X=J[1],de=J[2],Ae=J[3],De=Ae*fe+X*Le-de*me,Ge=Ae*me+de*fe-C*Le,$e=Ae*Le+C*me-X*fe,ct=-C*fe-X*me-de*Le;return he[0]=De*Ae+ct*-C+Ge*-de-$e*-X,he[1]=Ge*Ae+ct*-X+$e*-C-De*-de,he[2]=$e*Ae+ct*-de+De*-X-Ge*-C,he[3]=se[3],he}function Z(he){return he[0]=0,he[1]=0,he[2]=0,he[3]=0,he}function ee(he){return"vec4("+he[0]+", "+he[1]+", "+he[2]+", "+he[3]+")"}function H(he,se){return he[0]===se[0]&&he[1]===se[1]&&he[2]===se[2]&&he[3]===se[3]}function ae(he,se){var J=he[0],fe=he[1],me=he[2],Le=he[3],C=se[0],X=se[1],de=se[2],Ae=se[3];return Math.abs(J-C)<=i.EPSILON*Math.max(1,Math.abs(J),Math.abs(C))&&Math.abs(fe-X)<=i.EPSILON*Math.max(1,Math.abs(fe),Math.abs(X))&&Math.abs(me-de)<=i.EPSILON*Math.max(1,Math.abs(me),Math.abs(de))&&Math.abs(Le-Ae)<=i.EPSILON*Math.max(1,Math.abs(Le),Math.abs(Ae))}var G=d,ie=E,le=g,Me=R,ge=y,pe=v,Ne=h,Re=function(){var he=F();return function(se,J,fe,me,Le,C){var X,de;for(J||(J=4),fe||(fe=0),me?de=Math.min(me*J+fe,se.length):de=se.length,X=fe;X<de;X+=J)he[0]=se[X],he[1]=se[X+1],he[2]=se[X+2],he[3]=se[X+3],Le(he,he,C),se[X]=he[0],se[X+1]=he[1],se[X+2]=he[2],se[X+3]=he[3];return se}}()},50840:function(Te,c,n){var i;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(F,o,w,_){"use strict";var P=["","webkit","Moz","MS","ms","o"],L=o.createElement("div"),d="function",E=Math.round,g=Math.abs,k=Date.now;function M(Ve,rt,wt){return setTimeout(v(Ve,wt),rt)}function j(Ve,rt,wt){return Array.isArray(Ve)?(U(Ve,wt[rt],wt),!0):!1}function U(Ve,rt,wt){var lr;if(!!Ve)if(Ve.forEach)Ve.forEach(rt,wt);else if(Ve.length!==_)for(lr=0;lr<Ve.length;)rt.call(wt,Ve[lr],lr,Ve),lr++;else for(lr in Ve)Ve.hasOwnProperty(lr)&&rt.call(wt,Ve[lr],lr,Ve)}function I(Ve,rt,wt){var lr="DEPRECATED METHOD: "+rt+`
`+wt+` AT 
`;return function(){var Zr=new Error("get-stack-trace"),Un=Zr&&Zr.stack?Zr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",oi=F.console&&(F.console.warn||F.console.log);return oi&&oi.call(F.console,lr,Un),Ve.apply(this,arguments)}}var O;typeof Object.assign!="function"?O=function(rt){if(rt===_||rt===null)throw new TypeError("Cannot convert undefined or null to object");for(var wt=Object(rt),lr=1;lr<arguments.length;lr++){var Zr=arguments[lr];if(Zr!==_&&Zr!==null)for(var Un in Zr)Zr.hasOwnProperty(Un)&&(wt[Un]=Zr[Un])}return wt}:O=Object.assign;var D=I(function(rt,wt,lr){for(var Zr=Object.keys(wt),Un=0;Un<Zr.length;)(!lr||lr&&rt[Zr[Un]]===_)&&(rt[Zr[Un]]=wt[Zr[Un]]),Un++;return rt},"extend","Use `assign`."),R=I(function(rt,wt){return D(rt,wt,!0)},"merge","Use `assign`.");function y(Ve,rt,wt){var lr=rt.prototype,Zr;Zr=Ve.prototype=Object.create(lr),Zr.constructor=Ve,Zr._super=lr,wt&&O(Zr,wt)}function v(Ve,rt){return function(){return Ve.apply(rt,arguments)}}function h(Ve,rt){return typeof Ve==d?Ve.apply(rt&&rt[0]||_,rt):Ve}function S(Ve,rt){return Ve===_?rt:Ve}function A(Ve,rt,wt){U(V(rt),function(lr){Ve.addEventListener(lr,wt,!1)})}function x(Ve,rt,wt){U(V(rt),function(lr){Ve.removeEventListener(lr,wt,!1)})}function z(Ve,rt){for(;Ve;){if(Ve==rt)return!0;Ve=Ve.parentNode}return!1}function B(Ve,rt){return Ve.indexOf(rt)>-1}function V(Ve){return Ve.trim().split(/\s+/g)}function Q(Ve,rt,wt){if(Ve.indexOf&&!wt)return Ve.indexOf(rt);for(var lr=0;lr<Ve.length;){if(wt&&Ve[lr][wt]==rt||!wt&&Ve[lr]===rt)return lr;lr++}return-1}function oe(Ve){return Array.prototype.slice.call(Ve,0)}function re(Ve,rt,wt){for(var lr=[],Zr=[],Un=0;Un<Ve.length;){var oi=rt?Ve[Un][rt]:Ve[Un];Q(Zr,oi)<0&&lr.push(Ve[Un]),Zr[Un]=oi,Un++}return wt&&(rt?lr=lr.sort(function(be,tt){return be[rt]>tt[rt]}):lr=lr.sort()),lr}function Z(Ve,rt){for(var wt,lr,Zr=rt[0].toUpperCase()+rt.slice(1),Un=0;Un<P.length;){if(wt=P[Un],lr=wt?wt+Zr:rt,lr in Ve)return lr;Un++}return _}var ee=1;function H(){return ee++}function ae(Ve){var rt=Ve.ownerDocument||Ve;return rt.defaultView||rt.parentWindow||F}var G=/mobile|tablet|ip(ad|hone|od)|android/i,ie="ontouchstart"in F,le=Z(F,"PointerEvent")!==_,Me=ie&&G.test(navigator.userAgent),ge="touch",pe="pen",Ne="mouse",Re="kinect",he=25,se=1,J=2,fe=4,me=8,Le=1,C=2,X=4,de=8,Ae=16,De=C|X,Ge=de|Ae,$e=De|Ge,ct=["x","y"],gt=["clientX","clientY"];function st(Ve,rt){var wt=this;this.manager=Ve,this.callback=rt,this.element=Ve.element,this.target=Ve.options.inputTarget,this.domHandler=function(lr){h(Ve.options.enable,[Ve])&&wt.handler(lr)},this.init()}st.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(ae(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(ae(this.element),this.evWin,this.domHandler)}};function xe(Ve){var rt,wt=Ve.options.inputClass;return wt?rt=wt:le?rt=ke:Me?rt=Zt:ie?rt=Or:rt=Fi,new rt(Ve,Mt)}function Mt(Ve,rt,wt){var lr=wt.pointers.length,Zr=wt.changedPointers.length,Un=rt&se&&lr-Zr==0,oi=rt&(fe|me)&&lr-Zr==0;wt.isFirst=!!Un,wt.isFinal=!!oi,Un&&(Ve.session={}),wt.eventType=rt,Ut(Ve,wt),Ve.emit("hammer.input",wt),Ve.recognize(wt),Ve.session.prevInput=wt}function Ut(Ve,rt){var wt=Ve.session,lr=rt.pointers,Zr=lr.length;wt.firstInput||(wt.firstInput=it(rt)),Zr>1&&!wt.firstMultiple?wt.firstMultiple=it(rt):Zr===1&&(wt.firstMultiple=!1);var Un=wt.firstInput,oi=wt.firstMultiple,te=oi?oi.center:Un.center,be=rt.center=pt(lr);rt.timeStamp=k(),rt.deltaTime=rt.timeStamp-Un.timeStamp,rt.angle=Br(te,be),rt.distance=mr(te,be),At(wt,rt),rt.offsetDirection=Er(rt.deltaX,rt.deltaY);var tt=Vt(rt.deltaTime,rt.deltaX,rt.deltaY);rt.overallVelocityX=tt.x,rt.overallVelocityY=tt.y,rt.overallVelocity=g(tt.x)>g(tt.y)?tt.x:tt.y,rt.scale=oi?Ar(oi.pointers,lr):1,rt.rotation=oi?Ur(oi.pointers,lr):0,rt.maxPointers=wt.prevInput?rt.pointers.length>wt.prevInput.maxPointers?rt.pointers.length:wt.prevInput.maxPointers:rt.pointers.length,nt(wt,rt);var yt=Ve.element;z(rt.srcEvent.target,yt)&&(yt=rt.srcEvent.target),rt.target=yt}function At(Ve,rt){var wt=rt.center,lr=Ve.offsetDelta||{},Zr=Ve.prevDelta||{},Un=Ve.prevInput||{};(rt.eventType===se||Un.eventType===fe)&&(Zr=Ve.prevDelta={x:Un.deltaX||0,y:Un.deltaY||0},lr=Ve.offsetDelta={x:wt.x,y:wt.y}),rt.deltaX=Zr.x+(wt.x-lr.x),rt.deltaY=Zr.y+(wt.y-lr.y)}function nt(Ve,rt){var wt=Ve.lastInterval||rt,lr=rt.timeStamp-wt.timeStamp,Zr,Un,oi,te;if(rt.eventType!=me&&(lr>he||wt.velocity===_)){var be=rt.deltaX-wt.deltaX,tt=rt.deltaY-wt.deltaY,yt=Vt(lr,be,tt);Un=yt.x,oi=yt.y,Zr=g(yt.x)>g(yt.y)?yt.x:yt.y,te=Er(be,tt),Ve.lastInterval=rt}else Zr=wt.velocity,Un=wt.velocityX,oi=wt.velocityY,te=wt.direction;rt.velocity=Zr,rt.velocityX=Un,rt.velocityY=oi,rt.direction=te}function it(Ve){for(var rt=[],wt=0;wt<Ve.pointers.length;)rt[wt]={clientX:E(Ve.pointers[wt].clientX),clientY:E(Ve.pointers[wt].clientY)},wt++;return{timeStamp:k(),pointers:rt,center:pt(rt),deltaX:Ve.deltaX,deltaY:Ve.deltaY}}function pt(Ve){var rt=Ve.length;if(rt===1)return{x:E(Ve[0].clientX),y:E(Ve[0].clientY)};for(var wt=0,lr=0,Zr=0;Zr<rt;)wt+=Ve[Zr].clientX,lr+=Ve[Zr].clientY,Zr++;return{x:E(wt/rt),y:E(lr/rt)}}function Vt(Ve,rt,wt){return{x:rt/Ve||0,y:wt/Ve||0}}function Er(Ve,rt){return Ve===rt?Le:g(Ve)>=g(rt)?Ve<0?C:X:rt<0?de:Ae}function mr(Ve,rt,wt){wt||(wt=ct);var lr=rt[wt[0]]-Ve[wt[0]],Zr=rt[wt[1]]-Ve[wt[1]];return Math.sqrt(lr*lr+Zr*Zr)}function Br(Ve,rt,wt){wt||(wt=ct);var lr=rt[wt[0]]-Ve[wt[0]],Zr=rt[wt[1]]-Ve[wt[1]];return Math.atan2(Zr,lr)*180/Math.PI}function Ur(Ve,rt){return Br(rt[1],rt[0],gt)+Br(Ve[1],Ve[0],gt)}function Ar(Ve,rt){return mr(rt[0],rt[1],gt)/mr(Ve[0],Ve[1],gt)}var Nn={mousedown:se,mousemove:J,mouseup:fe},Rn="mousedown",ci="mousemove mouseup";function Fi(){this.evEl=Rn,this.evWin=ci,this.pressed=!1,st.apply(this,arguments)}y(Fi,st,{handler:function(rt){var wt=Nn[rt.type];wt&se&&rt.button===0&&(this.pressed=!0),wt&J&&rt.which!==1&&(wt=fe),!!this.pressed&&(wt&fe&&(this.pressed=!1),this.callback(this.manager,wt,{pointers:[rt],changedPointers:[rt],pointerType:Ne,srcEvent:rt}))}});var ji={pointerdown:se,pointermove:J,pointerup:fe,pointercancel:me,pointerout:me},Si={2:ge,3:pe,4:Ne,5:Re},xi="pointerdown",Ee="pointermove pointerup pointercancel";F.MSPointerEvent&&!F.PointerEvent&&(xi="MSPointerDown",Ee="MSPointerMove MSPointerUp MSPointerCancel");function ke(){this.evEl=xi,this.evWin=Ee,st.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}y(ke,st,{handler:function(rt){var wt=this.store,lr=!1,Zr=rt.type.toLowerCase().replace("ms",""),Un=ji[Zr],oi=Si[rt.pointerType]||rt.pointerType,te=oi==ge,be=Q(wt,rt.pointerId,"pointerId");Un&se&&(rt.button===0||te)?be<0&&(wt.push(rt),be=wt.length-1):Un&(fe|me)&&(lr=!0),!(be<0)&&(wt[be]=rt,this.callback(this.manager,Un,{pointers:wt,changedPointers:[rt],pointerType:oi,srcEvent:rt}),lr&&wt.splice(be,1))}});var ze={touchstart:se,touchmove:J,touchend:fe,touchcancel:me},Ke="touchstart",ot="touchstart touchmove touchend touchcancel";function Rt(){this.evTarget=Ke,this.evWin=ot,this.started=!1,st.apply(this,arguments)}y(Rt,st,{handler:function(rt){var wt=ze[rt.type];if(wt===se&&(this.started=!0),!!this.started){var lr=Nt.call(this,rt,wt);wt&(fe|me)&&lr[0].length-lr[1].length==0&&(this.started=!1),this.callback(this.manager,wt,{pointers:lr[0],changedPointers:lr[1],pointerType:ge,srcEvent:rt})}}});function Nt(Ve,rt){var wt=oe(Ve.touches),lr=oe(Ve.changedTouches);return rt&(fe|me)&&(wt=re(wt.concat(lr),"identifier",!0)),[wt,lr]}var Ye={touchstart:se,touchmove:J,touchend:fe,touchcancel:me},Et="touchstart touchmove touchend touchcancel";function Zt(){this.evTarget=Et,this.targetIds={},st.apply(this,arguments)}y(Zt,st,{handler:function(rt){var wt=Ye[rt.type],lr=Lr.call(this,rt,wt);!lr||this.callback(this.manager,wt,{pointers:lr[0],changedPointers:lr[1],pointerType:ge,srcEvent:rt})}});function Lr(Ve,rt){var wt=oe(Ve.touches),lr=this.targetIds;if(rt&(se|J)&&wt.length===1)return lr[wt[0].identifier]=!0,[wt,wt];var Zr,Un,oi=oe(Ve.changedTouches),te=[],be=this.target;if(Un=wt.filter(function(tt){return z(tt.target,be)}),rt===se)for(Zr=0;Zr<Un.length;)lr[Un[Zr].identifier]=!0,Zr++;for(Zr=0;Zr<oi.length;)lr[oi[Zr].identifier]&&te.push(oi[Zr]),rt&(fe|me)&&delete lr[oi[Zr].identifier],Zr++;if(!!te.length)return[re(Un.concat(te),"identifier",!0),te]}var ir=2500,ur=25;function Or(){st.apply(this,arguments);var Ve=v(this.handler,this);this.touch=new Zt(this.manager,Ve),this.mouse=new Fi(this.manager,Ve),this.primaryTouch=null,this.lastTouches=[]}y(Or,st,{handler:function(rt,wt,lr){var Zr=lr.pointerType==ge,Un=lr.pointerType==Ne;if(!(Un&&lr.sourceCapabilities&&lr.sourceCapabilities.firesTouchEvents)){if(Zr)nn.call(this,wt,lr);else if(Un&&gr.call(this,lr))return;this.callback(rt,wt,lr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function nn(Ve,rt){Ve&se?(this.primaryTouch=rt.changedPointers[0].identifier,Hr.call(this,rt)):Ve&(fe|me)&&Hr.call(this,rt)}function Hr(Ve){var rt=Ve.changedPointers[0];if(rt.identifier===this.primaryTouch){var wt={x:rt.clientX,y:rt.clientY};this.lastTouches.push(wt);var lr=this.lastTouches,Zr=function(){var Un=lr.indexOf(wt);Un>-1&&lr.splice(Un,1)};setTimeout(Zr,ir)}}function gr(Ve){for(var rt=Ve.srcEvent.clientX,wt=Ve.srcEvent.clientY,lr=0;lr<this.lastTouches.length;lr++){var Zr=this.lastTouches[lr],Un=Math.abs(rt-Zr.x),oi=Math.abs(wt-Zr.y);if(Un<=ur&&oi<=ur)return!0}return!1}var vn=Z(L.style,"touchAction"),an=vn!==_,sn="compute",Ei="auto",fn="manipulation",ni="none",Ui="pan-x",mi="pan-y",Li=Wi();function ui(Ve,rt){this.manager=Ve,this.set(rt)}ui.prototype={set:function(Ve){Ve==sn&&(Ve=this.compute()),an&&this.manager.element.style&&Li[Ve]&&(this.manager.element.style[vn]=Ve),this.actions=Ve.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ve=[];return U(this.manager.recognizers,function(rt){h(rt.options.enable,[rt])&&(Ve=Ve.concat(rt.getTouchAction()))}),fi(Ve.join(" "))},preventDefaults:function(Ve){var rt=Ve.srcEvent,wt=Ve.offsetDirection;if(this.manager.session.prevented){rt.preventDefault();return}var lr=this.actions,Zr=B(lr,ni)&&!Li[ni],Un=B(lr,mi)&&!Li[mi],oi=B(lr,Ui)&&!Li[Ui];if(Zr){var te=Ve.pointers.length===1,be=Ve.distance<2,tt=Ve.deltaTime<250;if(te&&be&&tt)return}if(!(oi&&Un)&&(Zr||Un&&wt&De||oi&&wt&Ge))return this.preventSrc(rt)},preventSrc:function(Ve){this.manager.session.prevented=!0,Ve.preventDefault()}};function fi(Ve){if(B(Ve,ni))return ni;var rt=B(Ve,Ui),wt=B(Ve,mi);return rt&&wt?ni:rt||wt?rt?Ui:mi:B(Ve,fn)?fn:Ei}function Wi(){if(!an)return!1;var Ve={},rt=F.CSS&&F.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(wt){Ve[wt]=rt?F.CSS.supports("touch-action",wt):!0}),Ve}var va=1,Pi=2,hi=4,Ii=8,La=Ii,ls=16,Ta=32;function ma(Ve){this.options=O({},this.defaults,Ve||{}),this.id=H(),this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=va,this.simultaneous={},this.requireFail=[]}ma.prototype={defaults:{},set:function(Ve){return O(this.options,Ve),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ve){if(j(Ve,"recognizeWith",this))return this;var rt=this.simultaneous;return Ve=sa(Ve,this),rt[Ve.id]||(rt[Ve.id]=Ve,Ve.recognizeWith(this)),this},dropRecognizeWith:function(Ve){return j(Ve,"dropRecognizeWith",this)?this:(Ve=sa(Ve,this),delete this.simultaneous[Ve.id],this)},requireFailure:function(Ve){if(j(Ve,"requireFailure",this))return this;var rt=this.requireFail;return Ve=sa(Ve,this),Q(rt,Ve)===-1&&(rt.push(Ve),Ve.requireFailure(this)),this},dropRequireFailure:function(Ve){if(j(Ve,"dropRequireFailure",this))return this;Ve=sa(Ve,this);var rt=Q(this.requireFail,Ve);return rt>-1&&this.requireFail.splice(rt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ve){return!!this.simultaneous[Ve.id]},emit:function(Ve){var rt=this,wt=this.state;function lr(Zr){rt.manager.emit(Zr,Ve)}wt<Ii&&lr(rt.options.event+Qo(wt)),lr(rt.options.event),Ve.additionalEvent&&lr(Ve.additionalEvent),wt>=Ii&&lr(rt.options.event+Qo(wt))},tryEmit:function(Ve){if(this.canEmit())return this.emit(Ve);this.state=Ta},canEmit:function(){for(var Ve=0;Ve<this.requireFail.length;){if(!(this.requireFail[Ve].state&(Ta|va)))return!1;Ve++}return!0},recognize:function(Ve){var rt=O({},Ve);if(!h(this.options.enable,[this,rt])){this.reset(),this.state=Ta;return}this.state&(La|ls|Ta)&&(this.state=va),this.state=this.process(rt),this.state&(Pi|hi|Ii|ls)&&this.tryEmit(rt)},process:function(Ve){},getTouchAction:function(){},reset:function(){}};function Qo(Ve){return Ve&ls?"cancel":Ve&Ii?"end":Ve&hi?"move":Ve&Pi?"start":""}function Es(Ve){return Ve==Ae?"down":Ve==de?"up":Ve==C?"left":Ve==X?"right":""}function sa(Ve,rt){var wt=rt.manager;return wt?wt.get(Ve):Ve}function to(){ma.apply(this,arguments)}y(to,ma,{defaults:{pointers:1},attrTest:function(Ve){var rt=this.options.pointers;return rt===0||Ve.pointers.length===rt},process:function(Ve){var rt=this.state,wt=Ve.eventType,lr=rt&(Pi|hi),Zr=this.attrTest(Ve);return lr&&(wt&me||!Zr)?rt|ls:lr||Zr?wt&fe?rt|Ii:rt&Pi?rt|hi:Pi:Ta}});function _a(){to.apply(this,arguments),this.pX=null,this.pY=null}y(_a,to,{defaults:{event:"pan",threshold:10,pointers:1,direction:$e},getTouchAction:function(){var Ve=this.options.direction,rt=[];return Ve&De&&rt.push(mi),Ve&Ge&&rt.push(Ui),rt},directionTest:function(Ve){var rt=this.options,wt=!0,lr=Ve.distance,Zr=Ve.direction,Un=Ve.deltaX,oi=Ve.deltaY;return Zr&rt.direction||(rt.direction&De?(Zr=Un===0?Le:Un<0?C:X,wt=Un!=this.pX,lr=Math.abs(Ve.deltaX)):(Zr=oi===0?Le:oi<0?de:Ae,wt=oi!=this.pY,lr=Math.abs(Ve.deltaY))),Ve.direction=Zr,wt&&lr>rt.threshold&&Zr&rt.direction},attrTest:function(Ve){return to.prototype.attrTest.call(this,Ve)&&(this.state&Pi||!(this.state&Pi)&&this.directionTest(Ve))},emit:function(Ve){this.pX=Ve.deltaX,this.pY=Ve.deltaY;var rt=Es(Ve.direction);rt&&(Ve.additionalEvent=this.options.event+rt),this._super.emit.call(this,Ve)}});function wa(){to.apply(this,arguments)}y(wa,to,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ni]},attrTest:function(Ve){return this._super.attrTest.call(this,Ve)&&(Math.abs(Ve.scale-1)>this.options.threshold||this.state&Pi)},emit:function(Ve){if(Ve.scale!==1){var rt=Ve.scale<1?"in":"out";Ve.additionalEvent=this.options.event+rt}this._super.emit.call(this,Ve)}});function $a(){ma.apply(this,arguments),this._timer=null,this._input=null}y($a,ma,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ei]},process:function(Ve){var rt=this.options,wt=Ve.pointers.length===rt.pointers,lr=Ve.distance<rt.threshold,Zr=Ve.deltaTime>rt.time;if(this._input=Ve,!lr||!wt||Ve.eventType&(fe|me)&&!Zr)this.reset();else if(Ve.eventType&se)this.reset(),this._timer=M(function(){this.state=La,this.tryEmit()},rt.time,this);else if(Ve.eventType&fe)return La;return Ta},reset:function(){clearTimeout(this._timer)},emit:function(Ve){this.state===La&&(Ve&&Ve.eventType&fe?this.manager.emit(this.options.event+"up",Ve):(this._input.timeStamp=k(),this.manager.emit(this.options.event,this._input)))}});function ia(){to.apply(this,arguments)}y(ia,to,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ni]},attrTest:function(Ve){return this._super.attrTest.call(this,Ve)&&(Math.abs(Ve.rotation)>this.options.threshold||this.state&Pi)}});function Ja(){to.apply(this,arguments)}y(Ja,to,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:De|Ge,pointers:1},getTouchAction:function(){return _a.prototype.getTouchAction.call(this)},attrTest:function(Ve){var rt=this.options.direction,wt;return rt&(De|Ge)?wt=Ve.overallVelocity:rt&De?wt=Ve.overallVelocityX:rt&Ge&&(wt=Ve.overallVelocityY),this._super.attrTest.call(this,Ve)&&rt&Ve.offsetDirection&&Ve.distance>this.options.threshold&&Ve.maxPointers==this.options.pointers&&g(wt)>this.options.velocity&&Ve.eventType&fe},emit:function(Ve){var rt=Es(Ve.offsetDirection);rt&&this.manager.emit(this.options.event+rt,Ve),this.manager.emit(this.options.event,Ve)}});function ro(){ma.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}y(ro,ma,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fn]},process:function(Ve){var rt=this.options,wt=Ve.pointers.length===rt.pointers,lr=Ve.distance<rt.threshold,Zr=Ve.deltaTime<rt.time;if(this.reset(),Ve.eventType&se&&this.count===0)return this.failTimeout();if(lr&&Zr&&wt){if(Ve.eventType!=fe)return this.failTimeout();var Un=this.pTime?Ve.timeStamp-this.pTime<rt.interval:!0,oi=!this.pCenter||mr(this.pCenter,Ve.center)<rt.posThreshold;this.pTime=Ve.timeStamp,this.pCenter=Ve.center,!oi||!Un?this.count=1:this.count+=1,this._input=Ve;var te=this.count%rt.taps;if(te===0)return this.hasRequireFailures()?(this._timer=M(function(){this.state=La,this.tryEmit()},rt.interval,this),Pi):La}return Ta},failTimeout:function(){return this._timer=M(function(){this.state=Ta},this.options.interval,this),Ta},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==La&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Xa(Ve,rt){return rt=rt||{},rt.recognizers=S(rt.recognizers,Xa.defaults.preset),new fa(Ve,rt)}Xa.VERSION="2.0.7",Xa.defaults={domEvents:!1,touchAction:sn,enable:!0,inputTarget:null,inputClass:null,preset:[[ia,{enable:!1}],[wa,{enable:!1},["rotate"]],[Ja,{direction:De}],[_a,{direction:De},["swipe"]],[ro],[ro,{event:"doubletap",taps:2},["tap"]],[$a]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var no=1,go=2;function fa(Ve,rt){this.options=O({},Xa.defaults,rt||{}),this.options.inputTarget=this.options.inputTarget||Ve,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ve,this.input=xe(this),this.touchAction=new ui(this,this.options.touchAction),ja(this,!0),U(this.options.recognizers,function(wt){var lr=this.add(new wt[0](wt[1]));wt[2]&&lr.recognizeWith(wt[2]),wt[3]&&lr.requireFailure(wt[3])},this)}fa.prototype={set:function(Ve){return O(this.options,Ve),Ve.touchAction&&this.touchAction.update(),Ve.inputTarget&&(this.input.destroy(),this.input.target=Ve.inputTarget,this.input.init()),this},stop:function(Ve){this.session.stopped=Ve?go:no},recognize:function(Ve){var rt=this.session;if(!rt.stopped){this.touchAction.preventDefaults(Ve);var wt,lr=this.recognizers,Zr=rt.curRecognizer;(!Zr||Zr&&Zr.state&La)&&(Zr=rt.curRecognizer=null);for(var Un=0;Un<lr.length;)wt=lr[Un],rt.stopped!==go&&(!Zr||wt==Zr||wt.canRecognizeWith(Zr))?wt.recognize(Ve):wt.reset(),!Zr&&wt.state&(Pi|hi|Ii)&&(Zr=rt.curRecognizer=wt),Un++}},get:function(Ve){if(Ve instanceof ma)return Ve;for(var rt=this.recognizers,wt=0;wt<rt.length;wt++)if(rt[wt].options.event==Ve)return rt[wt];return null},add:function(Ve){if(j(Ve,"add",this))return this;var rt=this.get(Ve.options.event);return rt&&this.remove(rt),this.recognizers.push(Ve),Ve.manager=this,this.touchAction.update(),Ve},remove:function(Ve){if(j(Ve,"remove",this))return this;if(Ve=this.get(Ve),Ve){var rt=this.recognizers,wt=Q(rt,Ve);wt!==-1&&(rt.splice(wt,1),this.touchAction.update())}return this},on:function(Ve,rt){if(Ve!==_&&rt!==_){var wt=this.handlers;return U(V(Ve),function(lr){wt[lr]=wt[lr]||[],wt[lr].push(rt)}),this}},off:function(Ve,rt){if(Ve!==_){var wt=this.handlers;return U(V(Ve),function(lr){rt?wt[lr]&&wt[lr].splice(Q(wt[lr],rt),1):delete wt[lr]}),this}},emit:function(Ve,rt){this.options.domEvents&&Qa(Ve,rt);var wt=this.handlers[Ve]&&this.handlers[Ve].slice();if(!(!wt||!wt.length)){rt.type=Ve,rt.preventDefault=function(){rt.srcEvent.preventDefault()};for(var lr=0;lr<wt.length;)wt[lr](rt),lr++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ja(Ve,rt){var wt=Ve.element;if(!!wt.style){var lr;U(Ve.options.cssProps,function(Zr,Un){lr=Z(wt.style,Un),rt?(Ve.oldCssProps[lr]=wt.style[lr],wt.style[lr]=Zr):wt.style[lr]=Ve.oldCssProps[lr]||""}),rt||(Ve.oldCssProps={})}}function Qa(Ve,rt){var wt=o.createEvent("Event");wt.initEvent(Ve,!0,!0),wt.gesture=rt,rt.target.dispatchEvent(wt)}O(Xa,{INPUT_START:se,INPUT_MOVE:J,INPUT_END:fe,INPUT_CANCEL:me,STATE_POSSIBLE:va,STATE_BEGAN:Pi,STATE_CHANGED:hi,STATE_ENDED:Ii,STATE_RECOGNIZED:La,STATE_CANCELLED:ls,STATE_FAILED:Ta,DIRECTION_NONE:Le,DIRECTION_LEFT:C,DIRECTION_RIGHT:X,DIRECTION_UP:de,DIRECTION_DOWN:Ae,DIRECTION_HORIZONTAL:De,DIRECTION_VERTICAL:Ge,DIRECTION_ALL:$e,Manager:fa,Input:st,TouchAction:ui,TouchInput:Zt,MouseInput:Fi,PointerEventInput:ke,TouchMouseInput:Or,SingleTouchInput:Rt,Recognizer:ma,AttrRecognizer:to,Tap:ro,Pan:_a,Swipe:Ja,Pinch:wa,Rotate:ia,Press:$a,on:A,off:x,each:U,merge:R,extend:D,assign:O,inherit:y,bindFn:v,prefixed:Z});var Ua=typeof F!="undefined"?F:typeof self!="undefined"?self:{};Ua.Hammer=Xa,i=function(){return Xa}.call(c,n,c,Te),i!==_&&(Te.exports=i)})(window,document,"Hammer")},7375:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function i(P,L,d,E){function g(){return E&&!Reflect.hasMetadata(n,this,L)&&Reflect.defineMetadata(n,d(),this,L),Reflect.hasMetadata(n,this,L)?Reflect.getMetadata(n,this,L):d()}function k(M){Reflect.defineMetadata(n,M,this,L)}Object.defineProperty(P,L,{configurable:!0,enumerable:!0,get:g,set:k})}function F(P,L){return function(d){return function(E,g){var k=function(){return P.get(d)};i(E,g,k,L)}}}c.makePropertyInjectDecorator=F;function o(P,L){return function(d,E){return function(g,k){var M=function(){return P.getNamed(d,E)};i(g,k,M,L)}}}c.makePropertyInjectNamedDecorator=o;function w(P,L){return function(d,E,g){return function(k,M){var j=function(){return P.getTagged(d,E,g)};i(k,M,j,L)}}}c.makePropertyInjectTaggedDecorator=w;function _(P,L){return function(d){return function(E,g){var k=function(){return P.getAll(d)};i(E,g,k,L)}}}c.makePropertyMultiInjectDecorator=_},84879:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var i=n(7375);function F(o,w){w===void 0&&(w=!0);var _=i.makePropertyInjectDecorator(o,w),P=i.makePropertyInjectNamedDecorator(o,w),L=i.makePropertyInjectTaggedDecorator(o,w),d=i.makePropertyMultiInjectDecorator(o,w);return{lazyInject:_,lazyInjectNamed:P,lazyInjectTagged:L,lazyMultiInject:d}}c.default=F},99934:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.tagProperty=c.tagParameter=c.decorate=void 0;var i=n(16674),F=n(6867);function o(E,g,k,M){var j=F.TAGGED;_(j,E,g,M,k)}c.tagParameter=o;function w(E,g,k){var M=F.TAGGED_PROP;_(M,E.constructor,g,k)}c.tagProperty=w;function _(E,g,k,M,j){var U={},I=typeof j=="number",O=j!==void 0&&I?j.toString():k;if(I&&k!==void 0)throw new Error(i.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(E,g)&&(U=Reflect.getMetadata(E,g));var D=U[O];if(!Array.isArray(D))D=[];else for(var R=0,y=D;R<y.length;R++){var v=y[R];if(v.key===M.key)throw new Error(i.DUPLICATED_METADATA+" "+v.key.toString())}D.push(M),U[O]=D,Reflect.defineMetadata(E,U,g)}function P(E,g){Reflect.decorate(E,g)}function L(E,g){return function(k,M){g(k,M,E)}}function d(E,g,k){typeof k=="number"?P([L(k,E)],g):typeof k=="string"?Reflect.decorate([E],g,k):P([E],g)}c.decorate=d},5744:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.inject=c.LazyServiceIdentifer=void 0;var i=n(16674),F=n(6867),o=n(47738),w=n(99934),_=function(){function L(d){this._cb=d}return L.prototype.unwrap=function(){return this._cb()},L}();c.LazyServiceIdentifer=_;function P(L){return function(d,E,g){if(L===void 0)throw new Error(i.UNDEFINED_INJECT_ANNOTATION(d.name));var k=new o.Metadata(F.INJECT_TAG,L);typeof g=="number"?w.tagParameter(d,E,g,k):w.tagProperty(d,E,k)}}c.inject=P},64315:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.injectable=void 0;var i=n(16674),F=n(6867);function o(){return function(w){if(Reflect.hasOwnMetadata(F.PARAM_TYPES,w))throw new Error(i.DUPLICATED_INJECTABLE_DECORATOR);var _=Reflect.getMetadata(F.DESIGN_PARAM_TYPES,w)||[];return Reflect.defineMetadata(F.PARAM_TYPES,_,w),w}}c.injectable=o},71693:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.multiInject=void 0;var i=n(6867),F=n(47738),o=n(99934);function w(_){return function(P,L,d){var E=new F.Metadata(i.MULTI_INJECT_TAG,_);typeof d=="number"?o.tagParameter(P,L,d,E):o.tagProperty(P,L,E)}}c.multiInject=w},38085:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.named=void 0;var i=n(6867),F=n(47738),o=n(99934);function w(_){return function(P,L,d){var E=new F.Metadata(i.NAMED_TAG,_);typeof d=="number"?o.tagParameter(P,L,d,E):o.tagProperty(P,L,E)}}c.named=w},6515:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.optional=void 0;var i=n(6867),F=n(47738),o=n(99934);function w(){return function(_,P,L){var d=new F.Metadata(i.OPTIONAL_TAG,!0);typeof L=="number"?o.tagParameter(_,P,L,d):o.tagProperty(_,P,d)}}c.optional=w},7014:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.postConstruct=void 0;var i=n(16674),F=n(6867),o=n(47738);function w(){return function(_,P,L){var d=new o.Metadata(F.POST_CONSTRUCT,P);if(Reflect.hasOwnMetadata(F.POST_CONSTRUCT,_.constructor))throw new Error(i.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(F.POST_CONSTRUCT,d,_.constructor)}}c.postConstruct=w},32052:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.tagged=void 0;var i=n(47738),F=n(99934);function o(w,_){return function(P,L,d){var E=new i.Metadata(w,_);typeof d=="number"?F.tagParameter(P,L,d,E):F.tagProperty(P,L,E)}}c.tagged=o},55638:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.targetName=void 0;var i=n(6867),F=n(47738),o=n(99934);function w(_){return function(P,L,d){var E=new F.Metadata(i.NAME_TAG,_);o.tagParameter(P,L,d,E)}}c.targetName=w},86757:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.unmanaged=void 0;var i=n(6867),F=n(47738),o=n(99934);function w(){return function(_,P,L){var d=new F.Metadata(i.UNMANAGED_TAG,!0);o.tagParameter(_,P,L,d)}}c.unmanaged=w},44290:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Binding=void 0;var i=n(28421),F=n(37791),o=function(){function w(_,P){this.id=F.id(),this.activated=!1,this.serviceIdentifier=_,this.scope=P,this.type=i.BindingTypeEnum.Invalid,this.constraint=function(L){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return w.prototype.clone=function(){var _=new w(this.serviceIdentifier,this.scope);return _.activated=_.scope===i.BindingScopeEnum.Singleton?this.activated:!1,_.implementationType=this.implementationType,_.dynamicValue=this.dynamicValue,_.scope=this.scope,_.type=this.type,_.factory=this.factory,_.provider=this.provider,_.constraint=this.constraint,_.onActivation=this.onActivation,_.cache=this.cache,_},w}();c.Binding=o},23184:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingCount=void 0;var n={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};c.BindingCount=n},16674:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.STACK_OVERFLOW=c.CIRCULAR_DEPENDENCY_IN_FACTORY=c.POST_CONSTRUCT_ERROR=c.MULTIPLE_POST_CONSTRUCT_METHODS=c.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=c.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=c.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=c.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=c.ARGUMENTS_LENGTH_MISMATCH=c.INVALID_DECORATOR_OPERATION=c.INVALID_TO_SELF_VALUE=c.INVALID_FUNCTION_BINDING=c.INVALID_MIDDLEWARE_RETURN=c.NO_MORE_SNAPSHOTS_AVAILABLE=c.INVALID_BINDING_TYPE=c.NOT_IMPLEMENTED=c.CIRCULAR_DEPENDENCY=c.UNDEFINED_INJECT_ANNOTATION=c.MISSING_INJECT_ANNOTATION=c.MISSING_INJECTABLE_ANNOTATION=c.NOT_REGISTERED=c.CANNOT_UNBIND=c.AMBIGUOUS_MATCH=c.KEY_NOT_FOUND=c.NULL_ARGUMENT=c.DUPLICATED_METADATA=c.DUPLICATED_INJECTABLE_DECORATOR=void 0,c.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",c.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",c.NULL_ARGUMENT="NULL argument",c.KEY_NOT_FOUND="Key Not Found",c.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",c.CANNOT_UNBIND="Could not unbind serviceIdentifier:",c.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",c.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",c.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var n=function(w){return"@inject called with undefined this could mean that the class "+w+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};c.UNDEFINED_INJECT_ANNOTATION=n,c.CIRCULAR_DEPENDENCY="Circular dependency found:",c.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",c.INVALID_BINDING_TYPE="Invalid binding type:",c.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",c.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",c.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",c.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",c.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var i=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];return"The number of constructor arguments in the derived class "+(w[0]+" must be >= than the number of constructor arguments of its base class.")};c.ARGUMENTS_LENGTH_MISMATCH=i,c.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",c.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",c.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",c.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",c.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var F=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];return"@postConstruct error in class "+w[0]+": "+w[1]};c.POST_CONSTRUCT_ERROR=F;var o=function(){for(var w=[],_=0;_<arguments.length;_++)w[_]=arguments[_];return"It looks like there is a circular dependency "+("in one of the '"+w[0]+"' bindings. Please investigate bindings with")+("service identifier '"+w[1]+"'.")};c.CIRCULAR_DEPENDENCY_IN_FACTORY=o,c.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.TargetTypeEnum=c.BindingTypeEnum=c.BindingScopeEnum=void 0;var n={Request:"Request",Singleton:"Singleton",Transient:"Transient"};c.BindingScopeEnum=n;var i={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};c.BindingTypeEnum=i;var F={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};c.TargetTypeEnum=F},6867:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NON_CUSTOM_TAG_KEYS=c.POST_CONSTRUCT=c.DESIGN_PARAM_TYPES=c.PARAM_TYPES=c.TAGGED_PROP=c.TAGGED=c.MULTI_INJECT_TAG=c.INJECT_TAG=c.OPTIONAL_TAG=c.UNMANAGED_TAG=c.NAME_TAG=c.NAMED_TAG=void 0,c.NAMED_TAG="named",c.NAME_TAG="name",c.UNMANAGED_TAG="unmanaged",c.OPTIONAL_TAG="optional",c.INJECT_TAG="inject",c.MULTI_INJECT_TAG="multi_inject",c.TAGGED="inversify:tagged",c.TAGGED_PROP="inversify:tagged_props",c.PARAM_TYPES="inversify:paramtypes",c.DESIGN_PARAM_TYPES="design:paramtypes",c.POST_CONSTRUCT="post_construct";function n(){return[c.INJECT_TAG,c.MULTI_INJECT_TAG,c.NAME_TAG,c.UNMANAGED_TAG,c.NAMED_TAG,c.OPTIONAL_TAG]}c.NON_CUSTOM_TAG_KEYS=n()},51389:function(Te,c,n){"use strict";var i=this&&this.__awaiter||function(D,R,y,v){function h(S){return S instanceof y?S:new y(function(A){A(S)})}return new(y||(y=Promise))(function(S,A){function x(V){try{B(v.next(V))}catch(Q){A(Q)}}function z(V){try{B(v.throw(V))}catch(Q){A(Q)}}function B(V){V.done?S(V.value):h(V.value).then(x,z)}B((v=v.apply(D,R||[])).next())})},F=this&&this.__generator||function(D,R){var y={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},v,h,S,A;return A={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(A[Symbol.iterator]=function(){return this}),A;function x(B){return function(V){return z([B,V])}}function z(B){if(v)throw new TypeError("Generator is already executing.");for(;y;)try{if(v=1,h&&(S=B[0]&2?h.return:B[0]?h.throw||((S=h.return)&&S.call(h),0):h.next)&&!(S=S.call(h,B[1])).done)return S;switch(h=0,S&&(B=[B[0]&2,S.value]),B[0]){case 0:case 1:S=B;break;case 4:return y.label++,{value:B[1],done:!1};case 5:y.label++,h=B[1],B=[0];continue;case 7:B=y.ops.pop(),y.trys.pop();continue;default:if(S=y.trys,!(S=S.length>0&&S[S.length-1])&&(B[0]===6||B[0]===2)){y=0;continue}if(B[0]===3&&(!S||B[1]>S[0]&&B[1]<S[3])){y.label=B[1];break}if(B[0]===6&&y.label<S[1]){y.label=S[1],S=B;break}if(S&&y.label<S[2]){y.label=S[2],y.ops.push(B);break}S[2]&&y.ops.pop(),y.trys.pop();continue}B=R.call(D,y)}catch(V){B=[6,V],h=0}finally{v=S=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}},o=this&&this.__spreadArray||function(D,R){for(var y=0,v=R.length,h=D.length;y<v;y++,h++)D[h]=R[y];return D};Object.defineProperty(c,"__esModule",{value:!0}),c.Container=void 0;var w=n(44290),_=n(16674),P=n(28421),L=n(6867),d=n(51377),E=n(86311),g=n(31927),k=n(15451),M=n(37791),j=n(55800),U=n(85700),I=n(80175),O=function(){function D(R){this._appliedMiddleware=[];var y=R||{};if(typeof y!="object")throw new Error(""+_.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(y.defaultScope===void 0)y.defaultScope=P.BindingScopeEnum.Transient;else if(y.defaultScope!==P.BindingScopeEnum.Singleton&&y.defaultScope!==P.BindingScopeEnum.Transient&&y.defaultScope!==P.BindingScopeEnum.Request)throw new Error(""+_.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(y.autoBindInjectable===void 0)y.autoBindInjectable=!1;else if(typeof y.autoBindInjectable!="boolean")throw new Error(""+_.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(y.skipBaseClassChecks===void 0)y.skipBaseClassChecks=!1;else if(typeof y.skipBaseClassChecks!="boolean")throw new Error(""+_.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:y.autoBindInjectable,defaultScope:y.defaultScope,skipBaseClassChecks:y.skipBaseClassChecks},this.id=M.id(),this._bindingDictionary=new I.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new d.MetadataReader}return D.merge=function(R,y){for(var v=[],h=2;h<arguments.length;h++)v[h-2]=arguments[h];var S=new D,A=o([R,y],v).map(function(B){return E.getBindingDictionary(B)}),x=E.getBindingDictionary(S);function z(B,V){B.traverse(function(Q,oe){oe.forEach(function(re){V.add(re.serviceIdentifier,re.clone())})})}return A.forEach(function(B){z(B,x)}),S},D.prototype.load=function(){for(var R=[],y=0;y<arguments.length;y++)R[y]=arguments[y];for(var v=this._getContainerModuleHelpersFactory(),h=0,S=R;h<S.length;h++){var A=S[h],x=v(A.id);A.registry(x.bindFunction,x.unbindFunction,x.isboundFunction,x.rebindFunction)}},D.prototype.loadAsync=function(){for(var R=[],y=0;y<arguments.length;y++)R[y]=arguments[y];return i(this,void 0,void 0,function(){var v,h,S,A,x;return F(this,function(z){switch(z.label){case 0:v=this._getContainerModuleHelpersFactory(),h=0,S=R,z.label=1;case 1:return h<S.length?(A=S[h],x=v(A.id),[4,A.registry(x.bindFunction,x.unbindFunction,x.isboundFunction,x.rebindFunction)]):[3,4];case 2:z.sent(),z.label=3;case 3:return h++,[3,1];case 4:return[2]}})})},D.prototype.unload=function(){for(var R=this,y=[],v=0;v<arguments.length;v++)y[v]=arguments[v];var h=function(S){return function(A){return A.moduleId===S}};y.forEach(function(S){var A=h(S.id);R._bindingDictionary.removeByCondition(A)})},D.prototype.bind=function(R){var y=this.options.defaultScope||P.BindingScopeEnum.Transient,v=new w.Binding(R,y);return this._bindingDictionary.add(R,v),new k.BindingToSyntax(v)},D.prototype.rebind=function(R){return this.unbind(R),this.bind(R)},D.prototype.unbind=function(R){try{this._bindingDictionary.remove(R)}catch(y){throw new Error(_.CANNOT_UNBIND+" "+j.getServiceIdentifierAsString(R))}},D.prototype.unbindAll=function(){this._bindingDictionary=new I.Lookup},D.prototype.isBound=function(R){var y=this._bindingDictionary.hasKey(R);return!y&&this.parent&&(y=this.parent.isBound(R)),y},D.prototype.isBoundNamed=function(R,y){return this.isBoundTagged(R,L.NAMED_TAG,y)},D.prototype.isBoundTagged=function(R,y,v){var h=!1;if(this._bindingDictionary.hasKey(R)){var S=this._bindingDictionary.get(R),A=E.createMockRequest(this,R,y,v);h=S.some(function(x){return x.constraint(A)})}return!h&&this.parent&&(h=this.parent.isBoundTagged(R,y,v)),h},D.prototype.snapshot=function(){this._snapshots.push(U.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},D.prototype.restore=function(){var R=this._snapshots.pop();if(R===void 0)throw new Error(_.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=R.bindings,this._middleware=R.middleware},D.prototype.createChild=function(R){var y=new D(R||this.options);return y.parent=this,y},D.prototype.applyMiddleware=function(){for(var R=[],y=0;y<arguments.length;y++)R[y]=arguments[y];this._appliedMiddleware=this._appliedMiddleware.concat(R);var v=this._middleware?this._middleware:this._planAndResolve();this._middleware=R.reduce(function(h,S){return S(h)},v)},D.prototype.applyCustomMetadataReader=function(R){this._metadataReader=R},D.prototype.get=function(R){return this._get(!1,!1,P.TargetTypeEnum.Variable,R)},D.prototype.getTagged=function(R,y,v){return this._get(!1,!1,P.TargetTypeEnum.Variable,R,y,v)},D.prototype.getNamed=function(R,y){return this.getTagged(R,L.NAMED_TAG,y)},D.prototype.getAll=function(R){return this._get(!0,!0,P.TargetTypeEnum.Variable,R)},D.prototype.getAllTagged=function(R,y,v){return this._get(!1,!0,P.TargetTypeEnum.Variable,R,y,v)},D.prototype.getAllNamed=function(R,y){return this.getAllTagged(R,L.NAMED_TAG,y)},D.prototype.resolve=function(R){var y=this.createChild();return y.bind(R).toSelf(),this._appliedMiddleware.forEach(function(v){y.applyMiddleware(v)}),y.get(R)},D.prototype._getContainerModuleHelpersFactory=function(){var R=this,y=function(x,z){x._binding.moduleId=z},v=function(x){return function(z){var B=R.bind.bind(R),V=B(z);return y(V,x),V}},h=function(x){return function(z){var B=R.unbind.bind(R);B(z)}},S=function(x){return function(z){var B=R.isBound.bind(R);return B(z)}},A=function(x){return function(z){var B=R.rebind.bind(R),V=B(z);return y(V,x),V}};return function(x){return{bindFunction:v(x),isboundFunction:S(x),rebindFunction:A(x),unbindFunction:h(x)}}},D.prototype._get=function(R,y,v,h,S,A){var x=null,z={avoidConstraints:R,contextInterceptor:function(B){return B},isMultiInject:y,key:S,serviceIdentifier:h,targetType:v,value:A};if(this._middleware){if(x=this._middleware(z),x==null)throw new Error(_.INVALID_MIDDLEWARE_RETURN)}else x=this._planAndResolve()(z);return x},D.prototype._planAndResolve=function(){var R=this;return function(y){var v=E.plan(R._metadataReader,R,y.isMultiInject,y.targetType,y.serviceIdentifier,y.key,y.value,y.avoidConstraints);v=y.contextInterceptor(v);var h=g.resolve(v);return h}},D}();c.Container=O},33244:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AsyncContainerModule=c.ContainerModule=void 0;var i=n(37791),F=function(){function w(_){this.id=i.id(),this.registry=_}return w}();c.ContainerModule=F;var o=function(){function w(_){this.id=i.id(),this.registry=_}return w}();c.AsyncContainerModule=o},85700:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ContainerSnapshot=void 0;var n=function(){function i(){}return i.of=function(F,o){var w=new i;return w.bindings=F,w.middleware=o,w},i}();c.ContainerSnapshot=n},80175:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Lookup=void 0;var i=n(16674),F=function(){function o(){this._map=new Map}return o.prototype.getMap=function(){return this._map},o.prototype.add=function(w,_){if(w==null)throw new Error(i.NULL_ARGUMENT);if(_==null)throw new Error(i.NULL_ARGUMENT);var P=this._map.get(w);P!==void 0?(P.push(_),this._map.set(w,P)):this._map.set(w,[_])},o.prototype.get=function(w){if(w==null)throw new Error(i.NULL_ARGUMENT);var _=this._map.get(w);if(_!==void 0)return _;throw new Error(i.KEY_NOT_FOUND)},o.prototype.remove=function(w){if(w==null)throw new Error(i.NULL_ARGUMENT);if(!this._map.delete(w))throw new Error(i.KEY_NOT_FOUND)},o.prototype.removeByCondition=function(w){var _=this;this._map.forEach(function(P,L){var d=P.filter(function(E){return!w(E)});d.length>0?_._map.set(L,d):_._map.delete(L)})},o.prototype.hasKey=function(w){if(w==null)throw new Error(i.NULL_ARGUMENT);return this._map.has(w)},o.prototype.clone=function(){var w=new o;return this._map.forEach(function(_,P){_.forEach(function(L){return w.add(P,L.clone())})}),w},o.prototype.traverse=function(w){this._map.forEach(function(_,P){w(P,_)})},o}();c.Lookup=F},86700:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.multiBindToService=c.getServiceIdentifierAsString=c.typeConstraint=c.namedConstraint=c.taggedConstraint=c.traverseAncerstors=c.decorate=c.id=c.MetadataReader=c.postConstruct=c.targetName=c.multiInject=c.unmanaged=c.optional=c.LazyServiceIdentifer=c.inject=c.named=c.tagged=c.injectable=c.ContainerModule=c.AsyncContainerModule=c.TargetTypeEnum=c.BindingTypeEnum=c.BindingScopeEnum=c.Container=c.METADATA_KEY=void 0;var i=n(6867);c.METADATA_KEY=i;var F=n(51389);Object.defineProperty(c,"Container",{enumerable:!0,get:function(){return F.Container}});var o=n(28421);Object.defineProperty(c,"BindingScopeEnum",{enumerable:!0,get:function(){return o.BindingScopeEnum}}),Object.defineProperty(c,"BindingTypeEnum",{enumerable:!0,get:function(){return o.BindingTypeEnum}}),Object.defineProperty(c,"TargetTypeEnum",{enumerable:!0,get:function(){return o.TargetTypeEnum}});var w=n(33244);Object.defineProperty(c,"AsyncContainerModule",{enumerable:!0,get:function(){return w.AsyncContainerModule}}),Object.defineProperty(c,"ContainerModule",{enumerable:!0,get:function(){return w.ContainerModule}});var _=n(64315);Object.defineProperty(c,"injectable",{enumerable:!0,get:function(){return _.injectable}});var P=n(32052);Object.defineProperty(c,"tagged",{enumerable:!0,get:function(){return P.tagged}});var L=n(38085);Object.defineProperty(c,"named",{enumerable:!0,get:function(){return L.named}});var d=n(5744);Object.defineProperty(c,"inject",{enumerable:!0,get:function(){return d.inject}}),Object.defineProperty(c,"LazyServiceIdentifer",{enumerable:!0,get:function(){return d.LazyServiceIdentifer}});var E=n(6515);Object.defineProperty(c,"optional",{enumerable:!0,get:function(){return E.optional}});var g=n(86757);Object.defineProperty(c,"unmanaged",{enumerable:!0,get:function(){return g.unmanaged}});var k=n(71693);Object.defineProperty(c,"multiInject",{enumerable:!0,get:function(){return k.multiInject}});var M=n(55638);Object.defineProperty(c,"targetName",{enumerable:!0,get:function(){return M.targetName}});var j=n(7014);Object.defineProperty(c,"postConstruct",{enumerable:!0,get:function(){return j.postConstruct}});var U=n(51377);Object.defineProperty(c,"MetadataReader",{enumerable:!0,get:function(){return U.MetadataReader}});var I=n(37791);Object.defineProperty(c,"id",{enumerable:!0,get:function(){return I.id}});var O=n(99934);Object.defineProperty(c,"decorate",{enumerable:!0,get:function(){return O.decorate}});var D=n(80758);Object.defineProperty(c,"traverseAncerstors",{enumerable:!0,get:function(){return D.traverseAncerstors}}),Object.defineProperty(c,"taggedConstraint",{enumerable:!0,get:function(){return D.taggedConstraint}}),Object.defineProperty(c,"namedConstraint",{enumerable:!0,get:function(){return D.namedConstraint}}),Object.defineProperty(c,"typeConstraint",{enumerable:!0,get:function(){return D.typeConstraint}});var R=n(55800);Object.defineProperty(c,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return R.getServiceIdentifierAsString}});var y=n(70600);Object.defineProperty(c,"multiBindToService",{enumerable:!0,get:function(){return y.multiBindToService}})},95228:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Context=void 0;var i=n(37791),F=function(){function o(w){this.id=i.id(),this.container=w}return o.prototype.addPlan=function(w){this.plan=w},o.prototype.setCurrentRequest=function(w){this.currentRequest=w},o}();c.Context=F},47738:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Metadata=void 0;var i=n(6867),F=function(){function o(w,_){this.key=w,this.value=_}return o.prototype.toString=function(){return this.key===i.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},o}();c.Metadata=F},51377:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.MetadataReader=void 0;var i=n(6867),F=function(){function o(){}return o.prototype.getConstructorMetadata=function(w){var _=Reflect.getMetadata(i.PARAM_TYPES,w),P=Reflect.getMetadata(i.TAGGED,w);return{compilerGeneratedMetadata:_,userGeneratedMetadata:P||{}}},o.prototype.getPropertiesMetadata=function(w){var _=Reflect.getMetadata(i.TAGGED_PROP,w)||[];return _},o}();c.MetadataReader=F},55314:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Plan=void 0;var n=function(){function i(F,o){this.parentContext=F,this.rootRequest=o}return i}();c.Plan=n},86311:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getBindingDictionary=c.createMockRequest=c.plan=void 0;var i=n(23184),F=n(16674),o=n(28421),w=n(6867),_=n(85265),P=n(55800),L=n(95228),d=n(47738),E=n(55314),g=n(6e3),k=n(6748),M=n(18924);function j(h){return h._bindingDictionary}c.getBindingDictionary=j;function U(h,S,A,x,z,B){var V=h?w.MULTI_INJECT_TAG:w.INJECT_TAG,Q=new d.Metadata(V,A),oe=new M.Target(S,x,A,Q);if(z!==void 0){var re=new d.Metadata(z,B);oe.metadata.push(re)}return oe}function I(h,S,A,x,z){var B=R(A.container,z.serviceIdentifier),V=[];return B.length===i.BindingCount.NoBindingsAvailable&&A.container.options.autoBindInjectable&&typeof z.serviceIdentifier=="function"&&h.getConstructorMetadata(z.serviceIdentifier).compilerGeneratedMetadata&&(A.container.bind(z.serviceIdentifier).toSelf(),B=R(A.container,z.serviceIdentifier)),S?V=B:V=B.filter(function(Q){var oe=new k.Request(Q.serviceIdentifier,A,x,Q,z);return Q.constraint(oe)}),O(z.serviceIdentifier,V,z,A.container),V}function O(h,S,A,x){switch(S.length){case i.BindingCount.NoBindingsAvailable:if(A.isOptional())return S;var z=P.getServiceIdentifierAsString(h),B=F.NOT_REGISTERED;throw B+=P.listMetadataForTarget(z,A),B+=P.listRegisteredBindingsForServiceIdentifier(x,z,R),new Error(B);case i.BindingCount.OnlyOneBindingAvailable:if(!A.isArray())return S;case i.BindingCount.MultipleBindingsAvailable:default:if(A.isArray())return S;var z=P.getServiceIdentifierAsString(h),B=F.AMBIGUOUS_MATCH+" "+z;throw B+=P.listRegisteredBindingsForServiceIdentifier(x,z,R),new Error(B)}}function D(h,S,A,x,z,B){var V,Q;if(z===null){V=I(h,S,x,null,B),Q=new k.Request(A,x,null,V,B);var oe=new E.Plan(x,Q);x.addPlan(oe)}else V=I(h,S,x,z,B),Q=z.addChildRequest(B.serviceIdentifier,V,B);V.forEach(function(re){var Z=null;if(B.isArray())Z=Q.addChildRequest(re.serviceIdentifier,re,B);else{if(re.cache)return;Z=Q}if(re.type===o.BindingTypeEnum.Instance&&re.implementationType!==null){var ee=g.getDependencies(h,re.implementationType);if(!x.container.options.skipBaseClassChecks){var H=g.getBaseClassDependencyCount(h,re.implementationType);if(ee.length<H){var ae=F.ARGUMENTS_LENGTH_MISMATCH(g.getFunctionName(re.implementationType));throw new Error(ae)}}ee.forEach(function(G){D(h,!1,G.serviceIdentifier,x,Z,G)})}})}function R(h,S){var A=[],x=j(h);return x.hasKey(S)?A=x.get(S):h.parent!==null&&(A=R(h.parent,S)),A}function y(h,S,A,x,z,B,V,Q){Q===void 0&&(Q=!1);var oe=new L.Context(S),re=U(A,x,z,"",B,V);try{return D(h,Q,z,oe,null,re),oe}catch(Z){throw _.isStackOverflowExeption(Z)&&oe.plan&&P.circularDependencyToException(oe.plan.rootRequest),Z}}c.plan=y;function v(h,S,A,x){var z=new M.Target(o.TargetTypeEnum.Variable,"",S,new d.Metadata(A,x)),B=new L.Context(h),V=new k.Request(S,B,null,[],z);return V}c.createMockRequest=v},88460:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.QueryableString=void 0;var n=function(){function i(F){this.str=F}return i.prototype.startsWith=function(F){return this.str.indexOf(F)===0},i.prototype.endsWith=function(F){var o="",w=F.split("").reverse().join("");return o=this.str.split("").reverse().join(""),this.startsWith.call({str:o},w)},i.prototype.contains=function(F){return this.str.indexOf(F)!==-1},i.prototype.equals=function(F){return this.str===F},i.prototype.value=function(){return this.str},i}();c.QueryableString=n},6e3:function(Te,c,n){"use strict";var i=this&&this.__spreadArray||function(I,O){for(var D=0,R=O.length,y=I.length;D<R;D++,y++)I[y]=O[D];return I};Object.defineProperty(c,"__esModule",{value:!0}),c.getFunctionName=c.getBaseClassDependencyCount=c.getDependencies=void 0;var F=n(5744),o=n(16674),w=n(28421),_=n(6867),P=n(55800);Object.defineProperty(c,"getFunctionName",{enumerable:!0,get:function(){return P.getFunctionName}});var L=n(18924);function d(I,O){var D=P.getFunctionName(O),R=E(I,D,O,!1);return R}c.getDependencies=d;function E(I,O,D,R){var y=I.getConstructorMetadata(D),v=y.compilerGeneratedMetadata;if(v===void 0){var h=o.MISSING_INJECTABLE_ANNOTATION+" "+O+".";throw new Error(h)}var S=y.userGeneratedMetadata,A=Object.keys(S),x=D.length===0&&A.length>0,z=A.length>D.length,B=x||z?A.length:D.length,V=k(R,O,v,S,B),Q=M(I,D),oe=i(i([],V),Q);return oe}function g(I,O,D,R,y){var v=y[I.toString()]||[],h=U(v),S=h.unmanaged!==!0,A=R[I],x=h.inject||h.multiInject;if(A=x||A,A instanceof F.LazyServiceIdentifer&&(A=A.unwrap()),S){var z=A===Object,B=A===Function,V=A===void 0,Q=z||B||V;if(!O&&Q){var oe=o.MISSING_INJECT_ANNOTATION+" argument "+I+" in class "+D+".";throw new Error(oe)}var re=new L.Target(w.TargetTypeEnum.ConstructorArgument,h.targetName,A);return re.metadata=v,re}return null}function k(I,O,D,R,y){for(var v=[],h=0;h<y;h++){var S=h,A=g(S,I,O,D,R);A!==null&&v.push(A)}return v}function M(I,O){for(var D=I.getPropertiesMetadata(O),R=[],y=Object.keys(D),v=0,h=y;v<h.length;v++){var S=h[v],A=D[S],x=U(D[S]),z=x.targetName||S,B=x.inject||x.multiInject,V=new L.Target(w.TargetTypeEnum.ClassProperty,z,B);V.metadata=A,R.push(V)}var Q=Object.getPrototypeOf(O.prototype).constructor;if(Q!==Object){var oe=M(I,Q);R=i(i([],R),oe)}return R}function j(I,O){var D=Object.getPrototypeOf(O.prototype).constructor;if(D!==Object){var R=P.getFunctionName(D),y=E(I,R,D,!0),v=y.map(function(A){return A.metadata.filter(function(x){return x.key===_.UNMANAGED_TAG})}),h=[].concat.apply([],v).length,S=y.length-h;return S>0?S:j(I,D)}else return 0}c.getBaseClassDependencyCount=j;function U(I){var O={};return I.forEach(function(D){O[D.key.toString()]=D.value}),{inject:O[_.INJECT_TAG],multiInject:O[_.MULTI_INJECT_TAG],targetName:O[_.NAME_TAG],unmanaged:O[_.UNMANAGED_TAG]}}},6748:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Request=void 0;var i=n(37791),F=function(){function o(w,_,P,L,d){this.id=i.id(),this.serviceIdentifier=w,this.parentContext=_,this.parentRequest=P,this.target=d,this.childRequests=[],this.bindings=Array.isArray(L)?L:[L],this.requestScope=P===null?new Map:null}return o.prototype.addChildRequest=function(w,_,P){var L=new o(w,this.parentContext,this,_,P);return this.childRequests.push(L),L},o}();c.Request=F},18924:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Target=void 0;var i=n(6867),F=n(37791),o=n(47738),w=n(88460),_=function(){function P(L,d,E,g){this.id=F.id(),this.type=L,this.serviceIdentifier=E,this.name=new w.QueryableString(d||""),this.metadata=new Array;var k=null;typeof g=="string"?k=new o.Metadata(i.NAMED_TAG,g):g instanceof o.Metadata&&(k=g),k!==null&&this.metadata.push(k)}return P.prototype.hasTag=function(L){for(var d=0,E=this.metadata;d<E.length;d++){var g=E[d];if(g.key===L)return!0}return!1},P.prototype.isArray=function(){return this.hasTag(i.MULTI_INJECT_TAG)},P.prototype.matchesArray=function(L){return this.matchesTag(i.MULTI_INJECT_TAG)(L)},P.prototype.isNamed=function(){return this.hasTag(i.NAMED_TAG)},P.prototype.isTagged=function(){return this.metadata.some(function(L){return i.NON_CUSTOM_TAG_KEYS.every(function(d){return L.key!==d})})},P.prototype.isOptional=function(){return this.matchesTag(i.OPTIONAL_TAG)(!0)},P.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(L){return L.key===i.NAMED_TAG})[0]:null},P.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(L){return i.NON_CUSTOM_TAG_KEYS.every(function(d){return L.key!==d})}):null},P.prototype.matchesNamedTag=function(L){return this.matchesTag(i.NAMED_TAG)(L)},P.prototype.matchesTag=function(L){var d=this;return function(E){for(var g=0,k=d.metadata;g<k.length;g++){var M=k[g];if(M.key===L&&M.value===E)return!0}return!1}},P}();c.Target=_},52279:function(Te,c,n){"use strict";var i=this&&this.__spreadArray||function(E,g){for(var k=0,M=g.length,j=E.length;k<M;k++,j++)E[j]=g[k];return E};Object.defineProperty(c,"__esModule",{value:!0}),c.resolveInstance=void 0;var F=n(16674),o=n(28421),w=n(6867);function _(E,g,k){var M=g.filter(function(U){return U.target!==null&&U.target.type===o.TargetTypeEnum.ClassProperty}),j=M.map(k);return M.forEach(function(U,I){var O="";O=U.target.name.value();var D=j[I];E[O]=D}),E}function P(E,g){return new(E.bind.apply(E,i([void 0],g)))}function L(E,g){if(Reflect.hasMetadata(w.POST_CONSTRUCT,E)){var k=Reflect.getMetadata(w.POST_CONSTRUCT,E);try{g[k.value]()}catch(M){throw new Error(F.POST_CONSTRUCT_ERROR(E.name,M.message))}}}function d(E,g,k){var M=null;if(g.length>0){var j=g.filter(function(I){return I.target!==null&&I.target.type===o.TargetTypeEnum.ConstructorArgument}),U=j.map(k);M=P(E,U),M=_(M,g,k)}else M=new E;return L(E,M),M}c.resolveInstance=d},31927:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.resolve=void 0;var i=n(16674),F=n(28421),o=n(85265),w=n(55800),_=n(52279),P=function(E,g,k){try{return k()}catch(M){throw o.isStackOverflowExeption(M)?new Error(i.CIRCULAR_DEPENDENCY_IN_FACTORY(E,g.toString())):M}},L=function(E){return function(g){g.parentContext.setCurrentRequest(g);var k=g.bindings,M=g.childRequests,j=g.target&&g.target.isArray(),U=!g.parentRequest||!g.parentRequest.target||!g.target||!g.parentRequest.target.matchesArray(g.target.serviceIdentifier);if(j&&U)return M.map(function(v){var h=L(E);return h(v)});var I=null;if(g.target.isOptional()&&k.length===0)return;var O=k[0],D=O.scope===F.BindingScopeEnum.Singleton,R=O.scope===F.BindingScopeEnum.Request;if(D&&O.activated)return O.cache;if(R&&E!==null&&E.has(O.id))return E.get(O.id);if(O.type===F.BindingTypeEnum.ConstantValue)I=O.cache,O.activated=!0;else if(O.type===F.BindingTypeEnum.Function)I=O.cache,O.activated=!0;else if(O.type===F.BindingTypeEnum.Constructor)I=O.implementationType;else if(O.type===F.BindingTypeEnum.DynamicValue&&O.dynamicValue!==null)I=P("toDynamicValue",O.serviceIdentifier,function(){return O.dynamicValue(g.parentContext)});else if(O.type===F.BindingTypeEnum.Factory&&O.factory!==null)I=P("toFactory",O.serviceIdentifier,function(){return O.factory(g.parentContext)});else if(O.type===F.BindingTypeEnum.Provider&&O.provider!==null)I=P("toProvider",O.serviceIdentifier,function(){return O.provider(g.parentContext)});else if(O.type===F.BindingTypeEnum.Instance&&O.implementationType!==null)I=_.resolveInstance(O.implementationType,M,L(E));else{var y=w.getServiceIdentifierAsString(g.serviceIdentifier);throw new Error(i.INVALID_BINDING_TYPE+" "+y)}return typeof O.onActivation=="function"&&(I=O.onActivation(g.parentContext,I)),D&&(O.cache=I,O.activated=!0),R&&E!==null&&!E.has(O.id)&&E.set(O.id,I),I}};function d(E){var g=L(E.plan.rootRequest.requestScope);return g(E.plan.rootRequest)}c.resolve=d},83366:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingInSyntax=void 0;var i=n(28421),F=n(71325),o=function(){function w(_){this._binding=_}return w.prototype.inRequestScope=function(){return this._binding.scope=i.BindingScopeEnum.Request,new F.BindingWhenOnSyntax(this._binding)},w.prototype.inSingletonScope=function(){return this._binding.scope=i.BindingScopeEnum.Singleton,new F.BindingWhenOnSyntax(this._binding)},w.prototype.inTransientScope=function(){return this._binding.scope=i.BindingScopeEnum.Transient,new F.BindingWhenOnSyntax(this._binding)},w}();c.BindingInSyntax=o},74889:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingInWhenOnSyntax=void 0;var i=n(83366),F=n(51811),o=n(98370),w=function(){function _(P){this._binding=P,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new F.BindingOnSyntax(this._binding),this._bindingInSyntax=new i.BindingInSyntax(P)}return _.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},_.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},_.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},_.prototype.when=function(P){return this._bindingWhenSyntax.when(P)},_.prototype.whenTargetNamed=function(P){return this._bindingWhenSyntax.whenTargetNamed(P)},_.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},_.prototype.whenTargetTagged=function(P,L){return this._bindingWhenSyntax.whenTargetTagged(P,L)},_.prototype.whenInjectedInto=function(P){return this._bindingWhenSyntax.whenInjectedInto(P)},_.prototype.whenParentNamed=function(P){return this._bindingWhenSyntax.whenParentNamed(P)},_.prototype.whenParentTagged=function(P,L){return this._bindingWhenSyntax.whenParentTagged(P,L)},_.prototype.whenAnyAncestorIs=function(P){return this._bindingWhenSyntax.whenAnyAncestorIs(P)},_.prototype.whenNoAncestorIs=function(P){return this._bindingWhenSyntax.whenNoAncestorIs(P)},_.prototype.whenAnyAncestorNamed=function(P){return this._bindingWhenSyntax.whenAnyAncestorNamed(P)},_.prototype.whenAnyAncestorTagged=function(P,L){return this._bindingWhenSyntax.whenAnyAncestorTagged(P,L)},_.prototype.whenNoAncestorNamed=function(P){return this._bindingWhenSyntax.whenNoAncestorNamed(P)},_.prototype.whenNoAncestorTagged=function(P,L){return this._bindingWhenSyntax.whenNoAncestorTagged(P,L)},_.prototype.whenAnyAncestorMatches=function(P){return this._bindingWhenSyntax.whenAnyAncestorMatches(P)},_.prototype.whenNoAncestorMatches=function(P){return this._bindingWhenSyntax.whenNoAncestorMatches(P)},_.prototype.onActivation=function(P){return this._bindingOnSyntax.onActivation(P)},_}();c.BindingInWhenOnSyntax=w},51811:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingOnSyntax=void 0;var i=n(98370),F=function(){function o(w){this._binding=w}return o.prototype.onActivation=function(w){return this._binding.onActivation=w,new i.BindingWhenSyntax(this._binding)},o}();c.BindingOnSyntax=F},15451:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingToSyntax=void 0;var i=n(16674),F=n(28421),o=n(74889),w=n(71325),_=function(){function P(L){this._binding=L}return P.prototype.to=function(L){return this._binding.type=F.BindingTypeEnum.Instance,this._binding.implementationType=L,new o.BindingInWhenOnSyntax(this._binding)},P.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+i.INVALID_TO_SELF_VALUE);var L=this._binding.serviceIdentifier;return this.to(L)},P.prototype.toConstantValue=function(L){return this._binding.type=F.BindingTypeEnum.ConstantValue,this._binding.cache=L,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=F.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},P.prototype.toDynamicValue=function(L){return this._binding.type=F.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=L,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},P.prototype.toConstructor=function(L){return this._binding.type=F.BindingTypeEnum.Constructor,this._binding.implementationType=L,this._binding.scope=F.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},P.prototype.toFactory=function(L){return this._binding.type=F.BindingTypeEnum.Factory,this._binding.factory=L,this._binding.scope=F.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},P.prototype.toFunction=function(L){if(typeof L!="function")throw new Error(i.INVALID_FUNCTION_BINDING);var d=this.toConstantValue(L);return this._binding.type=F.BindingTypeEnum.Function,this._binding.scope=F.BindingScopeEnum.Singleton,d},P.prototype.toAutoFactory=function(L){return this._binding.type=F.BindingTypeEnum.Factory,this._binding.factory=function(d){var E=function(){return d.container.get(L)};return E},this._binding.scope=F.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},P.prototype.toProvider=function(L){return this._binding.type=F.BindingTypeEnum.Provider,this._binding.provider=L,this._binding.scope=F.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},P.prototype.toService=function(L){this.toDynamicValue(function(d){return d.container.get(L)})},P}();c.BindingToSyntax=_},71325:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingWhenOnSyntax=void 0;var i=n(51811),F=n(98370),o=function(){function w(_){this._binding=_,this._bindingWhenSyntax=new F.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding)}return w.prototype.when=function(_){return this._bindingWhenSyntax.when(_)},w.prototype.whenTargetNamed=function(_){return this._bindingWhenSyntax.whenTargetNamed(_)},w.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},w.prototype.whenTargetTagged=function(_,P){return this._bindingWhenSyntax.whenTargetTagged(_,P)},w.prototype.whenInjectedInto=function(_){return this._bindingWhenSyntax.whenInjectedInto(_)},w.prototype.whenParentNamed=function(_){return this._bindingWhenSyntax.whenParentNamed(_)},w.prototype.whenParentTagged=function(_,P){return this._bindingWhenSyntax.whenParentTagged(_,P)},w.prototype.whenAnyAncestorIs=function(_){return this._bindingWhenSyntax.whenAnyAncestorIs(_)},w.prototype.whenNoAncestorIs=function(_){return this._bindingWhenSyntax.whenNoAncestorIs(_)},w.prototype.whenAnyAncestorNamed=function(_){return this._bindingWhenSyntax.whenAnyAncestorNamed(_)},w.prototype.whenAnyAncestorTagged=function(_,P){return this._bindingWhenSyntax.whenAnyAncestorTagged(_,P)},w.prototype.whenNoAncestorNamed=function(_){return this._bindingWhenSyntax.whenNoAncestorNamed(_)},w.prototype.whenNoAncestorTagged=function(_,P){return this._bindingWhenSyntax.whenNoAncestorTagged(_,P)},w.prototype.whenAnyAncestorMatches=function(_){return this._bindingWhenSyntax.whenAnyAncestorMatches(_)},w.prototype.whenNoAncestorMatches=function(_){return this._bindingWhenSyntax.whenNoAncestorMatches(_)},w.prototype.onActivation=function(_){return this._bindingOnSyntax.onActivation(_)},w}();c.BindingWhenOnSyntax=o},98370:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BindingWhenSyntax=void 0;var i=n(51811),F=n(80758),o=function(){function w(_){this._binding=_}return w.prototype.when=function(_){return this._binding.constraint=_,new i.BindingOnSyntax(this._binding)},w.prototype.whenTargetNamed=function(_){return this._binding.constraint=F.namedConstraint(_),new i.BindingOnSyntax(this._binding)},w.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(_){var P=_.target!==null&&!_.target.isNamed()&&!_.target.isTagged();return P},new i.BindingOnSyntax(this._binding)},w.prototype.whenTargetTagged=function(_,P){return this._binding.constraint=F.taggedConstraint(_)(P),new i.BindingOnSyntax(this._binding)},w.prototype.whenInjectedInto=function(_){return this._binding.constraint=function(P){return F.typeConstraint(_)(P.parentRequest)},new i.BindingOnSyntax(this._binding)},w.prototype.whenParentNamed=function(_){return this._binding.constraint=function(P){return F.namedConstraint(_)(P.parentRequest)},new i.BindingOnSyntax(this._binding)},w.prototype.whenParentTagged=function(_,P){return this._binding.constraint=function(L){return F.taggedConstraint(_)(P)(L.parentRequest)},new i.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorIs=function(_){return this._binding.constraint=function(P){return F.traverseAncerstors(P,F.typeConstraint(_))},new i.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorIs=function(_){return this._binding.constraint=function(P){return!F.traverseAncerstors(P,F.typeConstraint(_))},new i.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorNamed=function(_){return this._binding.constraint=function(P){return F.traverseAncerstors(P,F.namedConstraint(_))},new i.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorNamed=function(_){return this._binding.constraint=function(P){return!F.traverseAncerstors(P,F.namedConstraint(_))},new i.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorTagged=function(_,P){return this._binding.constraint=function(L){return F.traverseAncerstors(L,F.taggedConstraint(_)(P))},new i.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorTagged=function(_,P){return this._binding.constraint=function(L){return!F.traverseAncerstors(L,F.taggedConstraint(_)(P))},new i.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorMatches=function(_){return this._binding.constraint=function(P){return F.traverseAncerstors(P,_)},new i.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorMatches=function(_){return this._binding.constraint=function(P){return!F.traverseAncerstors(P,_)},new i.BindingOnSyntax(this._binding)},w}();c.BindingWhenSyntax=o},80758:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.typeConstraint=c.namedConstraint=c.taggedConstraint=c.traverseAncerstors=void 0;var i=n(6867),F=n(47738),o=function(L,d){var E=L.parentRequest;return E!==null?d(E)?!0:o(E,d):!1};c.traverseAncerstors=o;var w=function(L){return function(d){var E=function(g){return g!==null&&g.target!==null&&g.target.matchesTag(L)(d)};return E.metaData=new F.Metadata(L,d),E}};c.taggedConstraint=w;var _=w(i.NAMED_TAG);c.namedConstraint=_;var P=function(L){return function(d){var E=null;if(d!==null)if(E=d.bindings[0],typeof L=="string"){var g=E.serviceIdentifier;return g===L}else{var k=d.bindings[0].implementationType;return L===k}return!1}};c.typeConstraint=P},70600:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.multiBindToService=void 0;var n=function(i){return function(F){return function(){for(var o=[],w=0;w<arguments.length;w++)o[w]=arguments[w];return o.forEach(function(_){return i.bind(_).toService(F)})}}};c.multiBindToService=n},85265:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.isStackOverflowExeption=void 0;var i=n(16674);function F(o){return o instanceof RangeError||o.message===i.STACK_OVERFLOW}c.isStackOverflowExeption=F},37791:function(Te,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.id=void 0;var n=0;function i(){return n++}c.id=i},55800:function(Te,c,n){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.circularDependencyToException=c.listMetadataForTarget=c.listRegisteredBindingsForServiceIdentifier=c.getServiceIdentifierAsString=c.getFunctionName=void 0;var i=n(16674);function F(E){if(typeof E=="function"){var g=E;return g.name}else{if(typeof E=="symbol")return E.toString();var g=E;return g}}c.getServiceIdentifierAsString=F;function o(E,g,k){var M="",j=k(E,g);return j.length!==0&&(M=`
Registered bindings:`,j.forEach(function(U){var I="Object";U.implementationType!==null&&(I=d(U.implementationType)),M=M+`
 `+I,U.constraint.metaData&&(M=M+" - "+U.constraint.metaData)})),M}c.listRegisteredBindingsForServiceIdentifier=o;function w(E,g){return E.parentRequest===null?!1:E.parentRequest.serviceIdentifier===g?!0:w(E.parentRequest,g)}function _(E){function g(M,j){j===void 0&&(j=[]);var U=F(M.serviceIdentifier);return j.push(U),M.parentRequest!==null?g(M.parentRequest,j):j}var k=g(E);return k.reverse().join(" --> ")}function P(E){E.childRequests.forEach(function(g){if(w(g,g.serviceIdentifier)){var k=_(g);throw new Error(i.CIRCULAR_DEPENDENCY+" "+k)}else P(g)})}c.circularDependencyToException=P;function L(E,g){if(g.isTagged()||g.isNamed()){var k="",M=g.getNamedTag(),j=g.getCustomTags();return M!==null&&(k+=M.toString()+`
`),j!==null&&j.forEach(function(U){k+=U.toString()+`
`})," "+E+`
 `+E+" - "+k}else return" "+E}c.listMetadataForTarget=L;function d(E){if(E.name)return E.name;var g=E.toString(),k=g.match(/^function\s*([^\s(]+)/);return k?k[1]:"Anonymous function: "+g}c.getFunctionName=d},18857:function(Te,c,n){"use strict";n.r(c),n.d(c,{Function:function(){return vs},Interpreter:function(){return bn},default:function(){return Yi},evaluate:function(){return Oi},vm:function(){return i}});var i={};n.r(i),n.d(i,{Script:function(){return aa},compileFunction:function(){return Ci},createContext:function(){return ei},runInContext:function(){return Xi},runInNewContext:function(){return Fa}});var F={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},o="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",w={5:o,"5module":o+" export import",6:o+" const class extends export import super"},_=/^in(stanceof)?$/,P="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",L="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",d=new RegExp("["+P+"]"),E=new RegExp("["+P+L+"]");P=L=null;var g=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],k=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function M(m,Y){for(var ve=65536,ne=0;ne<Y.length;ne+=2){if(ve+=Y[ne],ve>m)return!1;if(ve+=Y[ne+1],ve>=m)return!0}}function j(m,Y){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&d.test(String.fromCharCode(m)):Y===!1?!1:M(m,g)}function U(m,Y){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&E.test(String.fromCharCode(m)):Y===!1?!1:M(m,g)||M(m,k)}var I=function(Y,ve){ve===void 0&&(ve={}),this.label=Y,this.keyword=ve.keyword,this.beforeExpr=!!ve.beforeExpr,this.startsExpr=!!ve.startsExpr,this.isLoop=!!ve.isLoop,this.isAssign=!!ve.isAssign,this.prefix=!!ve.prefix,this.postfix=!!ve.postfix,this.binop=ve.binop||null,this.updateContext=null};function O(m,Y){return new I(m,{beforeExpr:!0,binop:Y})}var D={beforeExpr:!0},R={startsExpr:!0},y={};function v(m,Y){return Y===void 0&&(Y={}),Y.keyword=m,y[m]=new I(m,Y)}var h={num:new I("num",R),regexp:new I("regexp",R),string:new I("string",R),name:new I("name",R),eof:new I("eof"),bracketL:new I("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new I("]"),braceL:new I("{",{beforeExpr:!0,startsExpr:!0}),braceR:new I("}"),parenL:new I("(",{beforeExpr:!0,startsExpr:!0}),parenR:new I(")"),comma:new I(",",D),semi:new I(";",D),colon:new I(":",D),dot:new I("."),question:new I("?",D),questionDot:new I("?."),arrow:new I("=>",D),template:new I("template"),invalidTemplate:new I("invalidTemplate"),ellipsis:new I("...",D),backQuote:new I("`",R),dollarBraceL:new I("${",{beforeExpr:!0,startsExpr:!0}),eq:new I("=",{beforeExpr:!0,isAssign:!0}),assign:new I("_=",{beforeExpr:!0,isAssign:!0}),incDec:new I("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new I("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:O("||",1),logicalAND:O("&&",2),bitwiseOR:O("|",3),bitwiseXOR:O("^",4),bitwiseAND:O("&",5),equality:O("==/!=/===/!==",6),relational:O("</>/<=/>=",7),bitShift:O("<</>>/>>>",8),plusMin:new I("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:O("%",10),star:O("*",10),slash:O("/",10),starstar:new I("**",{beforeExpr:!0}),coalesce:O("??",1),_break:v("break"),_case:v("case",D),_catch:v("catch"),_continue:v("continue"),_debugger:v("debugger"),_default:v("default",D),_do:v("do",{isLoop:!0,beforeExpr:!0}),_else:v("else",D),_finally:v("finally"),_for:v("for",{isLoop:!0}),_function:v("function",R),_if:v("if"),_return:v("return",D),_switch:v("switch"),_throw:v("throw",D),_try:v("try"),_var:v("var"),_const:v("const"),_while:v("while",{isLoop:!0}),_with:v("with"),_new:v("new",{beforeExpr:!0,startsExpr:!0}),_this:v("this",R),_super:v("super",R),_class:v("class",R),_extends:v("extends",D),_export:v("export"),_import:v("import",R),_null:v("null",R),_true:v("true",R),_false:v("false",R),_in:v("in",{beforeExpr:!0,binop:7}),_instanceof:v("instanceof",{beforeExpr:!0,binop:7}),_typeof:v("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:v("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:v("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},S=/\r\n?|\n|\u2028|\u2029/,A=new RegExp(S.source,"g");function x(m,Y){return m===10||m===13||!Y&&(m===8232||m===8233)}var z=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,B=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,V=Object.prototype,Q=V.hasOwnProperty,oe=V.toString;function re(m,Y){return Q.call(m,Y)}var Z=Array.isArray||function(m){return oe.call(m)==="[object Array]"};function ee(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var H=function(Y,ve){this.line=Y,this.column=ve};H.prototype.offset=function(Y){return new H(this.line,this.column+Y)};var ae=function(Y,ve,ne){this.start=ve,this.end=ne,Y.sourceFile!==null&&(this.source=Y.sourceFile)};function G(m,Y){for(var ve=1,ne=0;;){A.lastIndex=ne;var Fe=A.exec(m);if(Fe&&Fe.index<Y)++ve,ne=Fe.index+Fe[0].length;else return new H(ve,Y-ne)}}var ie={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function le(m){var Y={};for(var ve in ie)Y[ve]=m&&re(m,ve)?m[ve]:ie[ve];if(Y.ecmaVersion>=2015&&(Y.ecmaVersion-=2009),Y.allowReserved==null&&(Y.allowReserved=Y.ecmaVersion<5),Z(Y.onToken)){var ne=Y.onToken;Y.onToken=function(Fe){return ne.push(Fe)}}return Z(Y.onComment)&&(Y.onComment=Me(Y,Y.onComment)),Y}function Me(m,Y){return function(ve,ne,Fe,et,Lt,Kt){var Gt={type:ve?"Block":"Line",value:ne,start:Fe,end:et};m.locations&&(Gt.loc=new ae(this,Lt,Kt)),m.ranges&&(Gt.range=[Fe,et]),Y.push(Gt)}}var ge=1,pe=2,Ne=ge|pe,Re=4,he=8,se=16,J=32,fe=64,me=128;function Le(m,Y){return pe|(m?Re:0)|(Y?he:0)}var C=0,X=1,de=2,Ae=3,De=4,Ge=5,$e=function(Y,ve,ne){this.options=Y=le(Y),this.sourceFile=Y.sourceFile,this.keywords=ee(w[Y.ecmaVersion>=6?6:Y.sourceType==="module"?"5module":5]);var Fe="";if(Y.allowReserved!==!0){for(var et=Y.ecmaVersion;!(Fe=F[et]);et--);Y.sourceType==="module"&&(Fe+=" await")}this.reservedWords=ee(Fe);var Lt=(Fe?Fe+" ":"")+F.strict;this.reservedWordsStrict=ee(Lt),this.reservedWordsStrictBind=ee(Lt+" "+F.strictBind),this.input=String(ve),this.containsEsc=!1,ne?(this.pos=ne,this.lineStart=this.input.lastIndexOf(`
`,ne-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(S).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=h.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=Y.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&Y.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ge),this.regexpState=null},ct={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};$e.prototype.parse=function(){var Y=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(Y)},ct.inFunction.get=function(){return(this.currentVarScope().flags&pe)>0},ct.inGenerator.get=function(){return(this.currentVarScope().flags&he)>0},ct.inAsync.get=function(){return(this.currentVarScope().flags&Re)>0},ct.allowSuper.get=function(){return(this.currentThisScope().flags&fe)>0},ct.allowDirectSuper.get=function(){return(this.currentThisScope().flags&me)>0},ct.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},$e.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&pe)>0},$e.extend=function(){for(var Y=[],ve=arguments.length;ve--;)Y[ve]=arguments[ve];for(var ne=this,Fe=0;Fe<Y.length;Fe++)ne=Y[Fe](ne);return ne},$e.parse=function(Y,ve){return new this(ve,Y).parse()},$e.parseExpressionAt=function(Y,ve,ne){var Fe=new this(ne,Y,ve);return Fe.nextToken(),Fe.parseExpression()},$e.tokenizer=function(Y,ve){return new this(ve,Y)},Object.defineProperties($e.prototype,ct);var gt=$e.prototype,st=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;gt.strictDirective=function(m){for(;;){B.lastIndex=m,m+=B.exec(this.input)[0].length;var Y=st.exec(this.input.slice(m));if(!Y)return!1;if((Y[1]||Y[2])==="use strict"){B.lastIndex=m+Y[0].length;var ve=B.exec(this.input),ne=ve.index+ve[0].length,Fe=this.input.charAt(ne);return Fe===";"||Fe==="}"||S.test(ve[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Fe)||Fe==="!"&&this.input.charAt(ne+1)==="=")}m+=Y[0].length,B.lastIndex=m,m+=B.exec(this.input)[0].length,this.input[m]===";"&&m++}},gt.eat=function(m){return this.type===m?(this.next(),!0):!1},gt.isContextual=function(m){return this.type===h.name&&this.value===m&&!this.containsEsc},gt.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},gt.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},gt.canInsertSemicolon=function(){return this.type===h.eof||this.type===h.braceR||S.test(this.input.slice(this.lastTokEnd,this.start))},gt.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},gt.semicolon=function(){!this.eat(h.semi)&&!this.insertSemicolon()&&this.unexpected()},gt.afterTrailingComma=function(m,Y){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),Y||this.next(),!0},gt.expect=function(m){this.eat(m)||this.unexpected()},gt.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function xe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}gt.checkPatternErrors=function(m,Y){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var ve=Y?m.parenthesizedAssign:m.parenthesizedBind;ve>-1&&this.raiseRecoverable(ve,"Parenthesized pattern")}},gt.checkExpressionErrors=function(m,Y){if(!m)return!1;var ve=m.shorthandAssign,ne=m.doubleProto;if(!Y)return ve>=0||ne>=0;ve>=0&&this.raise(ve,"Shorthand property assignments are valid only in destructuring patterns"),ne>=0&&this.raiseRecoverable(ne,"Redefinition of __proto__ property")},gt.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},gt.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Mt=$e.prototype;Mt.parseTopLevel=function(m){var Y={};for(m.body||(m.body=[]);this.type!==h.eof;){var ve=this.parseStatement(null,!0,Y);m.body.push(ve)}if(this.inModule)for(var ne=0,Fe=Object.keys(this.undefinedExports);ne<Fe.length;ne+=1){var et=Fe[ne];this.raiseRecoverable(this.undefinedExports[et].start,"Export '"+et+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Ut={kind:"loop"},At={kind:"switch"};Mt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;B.lastIndex=this.pos;var Y=B.exec(this.input),ve=this.pos+Y[0].length,ne=this.input.charCodeAt(ve);if(ne===91)return!0;if(m)return!1;if(ne===123)return!0;if(j(ne,!0)){for(var Fe=ve+1;U(this.input.charCodeAt(Fe),!0);)++Fe;var et=this.input.slice(ve,Fe);if(!_.test(et))return!0}return!1},Mt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;B.lastIndex=this.pos;var m=B.exec(this.input),Y=this.pos+m[0].length;return!S.test(this.input.slice(this.pos,Y))&&this.input.slice(Y,Y+8)==="function"&&(Y+8===this.input.length||!U(this.input.charAt(Y+8)))},Mt.parseStatement=function(m,Y,ve){var ne=this.type,Fe=this.startNode(),et;switch(this.isLet(m)&&(ne=h._var,et="let"),ne){case h._break:case h._continue:return this.parseBreakContinueStatement(Fe,ne.keyword);case h._debugger:return this.parseDebuggerStatement(Fe);case h._do:return this.parseDoStatement(Fe);case h._for:return this.parseForStatement(Fe);case h._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Fe,!1,!m);case h._class:return m&&this.unexpected(),this.parseClass(Fe,!0);case h._if:return this.parseIfStatement(Fe);case h._return:return this.parseReturnStatement(Fe);case h._switch:return this.parseSwitchStatement(Fe);case h._throw:return this.parseThrowStatement(Fe);case h._try:return this.parseTryStatement(Fe);case h._const:case h._var:return et=et||this.value,m&&et!=="var"&&this.unexpected(),this.parseVarStatement(Fe,et);case h._while:return this.parseWhileStatement(Fe);case h._with:return this.parseWithStatement(Fe);case h.braceL:return this.parseBlock(!0,Fe);case h.semi:return this.parseEmptyStatement(Fe);case h._export:case h._import:if(this.options.ecmaVersion>10&&ne===h._import){B.lastIndex=this.pos;var Lt=B.exec(this.input),Kt=this.pos+Lt[0].length,Gt=this.input.charCodeAt(Kt);if(Gt===40||Gt===46)return this.parseExpressionStatement(Fe,this.parseExpression())}return this.options.allowImportExportEverywhere||(Y||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),ne===h._import?this.parseImport(Fe):this.parseExport(Fe,ve);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(Fe,!0,!m);var Fr=this.value,Vr=this.parseExpression();return ne===h.name&&Vr.type==="Identifier"&&this.eat(h.colon)?this.parseLabeledStatement(Fe,Fr,Vr,m):this.parseExpressionStatement(Fe,Vr)}},Mt.parseBreakContinueStatement=function(m,Y){var ve=Y==="break";this.next(),this.eat(h.semi)||this.insertSemicolon()?m.label=null:this.type!==h.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var ne=0;ne<this.labels.length;++ne){var Fe=this.labels[ne];if((m.label==null||Fe.name===m.label.name)&&(Fe.kind!=null&&(ve||Fe.kind==="loop")||m.label&&ve))break}return ne===this.labels.length&&this.raise(m.start,"Unsyntactic "+Y),this.finishNode(m,ve?"BreakStatement":"ContinueStatement")},Mt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Mt.parseDoStatement=function(m){return this.next(),this.labels.push(Ut),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(h._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(h.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Mt.parseForStatement=function(m){this.next();var Y=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ut),this.enterScope(0),this.expect(h.parenL),this.type===h.semi)return Y>-1&&this.unexpected(Y),this.parseFor(m,null);var ve=this.isLet();if(this.type===h._var||this.type===h._const||ve){var ne=this.startNode(),Fe=ve?"let":this.value;return this.next(),this.parseVar(ne,!0,Fe),this.finishNode(ne,"VariableDeclaration"),(this.type===h._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&ne.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===h._in?Y>-1&&this.unexpected(Y):m.await=Y>-1),this.parseForIn(m,ne)):(Y>-1&&this.unexpected(Y),this.parseFor(m,ne))}var et=new xe,Lt=this.parseExpression(!0,et);return this.type===h._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===h._in?Y>-1&&this.unexpected(Y):m.await=Y>-1),this.toAssignable(Lt,!1,et),this.checkLVal(Lt),this.parseForIn(m,Lt)):(this.checkExpressionErrors(et,!0),Y>-1&&this.unexpected(Y),this.parseFor(m,Lt))},Mt.parseFunctionStatement=function(m,Y,ve){return this.next(),this.parseFunction(m,it|(ve?0:pt),!1,Y)},Mt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(h._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Mt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(h.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Mt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(h.braceL),this.labels.push(At),this.enterScope(0);for(var Y,ve=!1;this.type!==h.braceR;)if(this.type===h._case||this.type===h._default){var ne=this.type===h._case;Y&&this.finishNode(Y,"SwitchCase"),m.cases.push(Y=this.startNode()),Y.consequent=[],this.next(),ne?Y.test=this.parseExpression():(ve&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),ve=!0,Y.test=null),this.expect(h.colon)}else Y||this.unexpected(),Y.consequent.push(this.parseStatement(null));return this.exitScope(),Y&&this.finishNode(Y,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Mt.parseThrowStatement=function(m){return this.next(),S.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var nt=[];Mt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===h._catch){var Y=this.startNode();if(this.next(),this.eat(h.parenL)){Y.param=this.parseBindingAtom();var ve=Y.param.type==="Identifier";this.enterScope(ve?J:0),this.checkLVal(Y.param,ve?De:de),this.expect(h.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),Y.param=null,this.enterScope(0);Y.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(Y,"CatchClause")}return m.finalizer=this.eat(h._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Mt.parseVarStatement=function(m,Y){return this.next(),this.parseVar(m,!1,Y),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Mt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Ut),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Mt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Mt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Mt.parseLabeledStatement=function(m,Y,ve,ne){for(var Fe=0,et=this.labels;Fe<et.length;Fe+=1){var Lt=et[Fe];Lt.name===Y&&this.raise(ve.start,"Label '"+Y+"' is already declared")}for(var Kt=this.type.isLoop?"loop":this.type===h._switch?"switch":null,Gt=this.labels.length-1;Gt>=0;Gt--){var Fr=this.labels[Gt];if(Fr.statementStart===m.start)Fr.statementStart=this.start,Fr.kind=Kt;else break}return this.labels.push({name:Y,kind:Kt,statementStart:this.start}),m.body=this.parseStatement(ne?ne.indexOf("label")===-1?ne+"label":ne:"label"),this.labels.pop(),m.label=ve,this.finishNode(m,"LabeledStatement")},Mt.parseExpressionStatement=function(m,Y){return m.expression=Y,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Mt.parseBlock=function(m,Y,ve){for(m===void 0&&(m=!0),Y===void 0&&(Y=this.startNode()),Y.body=[],this.expect(h.braceL),m&&this.enterScope(0);this.type!==h.braceR;){var ne=this.parseStatement(null);Y.body.push(ne)}return ve&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(Y,"BlockStatement")},Mt.parseFor=function(m,Y){return m.init=Y,this.expect(h.semi),m.test=this.type===h.semi?null:this.parseExpression(),this.expect(h.semi),m.update=this.type===h.parenR?null:this.parseExpression(),this.expect(h.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Mt.parseForIn=function(m,Y){var ve=this.type===h._in;return this.next(),Y.type==="VariableDeclaration"&&Y.declarations[0].init!=null&&(!ve||this.options.ecmaVersion<8||this.strict||Y.kind!=="var"||Y.declarations[0].id.type!=="Identifier")?this.raise(Y.start,(ve?"for-in":"for-of")+" loop variable declaration may not have an initializer"):Y.type==="AssignmentPattern"&&this.raise(Y.start,"Invalid left-hand side in for-loop"),m.left=Y,m.right=ve?this.parseExpression():this.parseMaybeAssign(),this.expect(h.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,ve?"ForInStatement":"ForOfStatement")},Mt.parseVar=function(m,Y,ve){for(m.declarations=[],m.kind=ve;;){var ne=this.startNode();if(this.parseVarId(ne,ve),this.eat(h.eq)?ne.init=this.parseMaybeAssign(Y):ve==="const"&&!(this.type===h._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():ne.id.type!=="Identifier"&&!(Y&&(this.type===h._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):ne.init=null,m.declarations.push(this.finishNode(ne,"VariableDeclarator")),!this.eat(h.comma))break}return m},Mt.parseVarId=function(m,Y){m.id=this.parseBindingAtom(),this.checkLVal(m.id,Y==="var"?X:de,!1)};var it=1,pt=2,Vt=4;Mt.parseFunction=function(m,Y,ve,ne){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!ne)&&(this.type===h.star&&Y&pt&&this.unexpected(),m.generator=this.eat(h.star)),this.options.ecmaVersion>=8&&(m.async=!!ne),Y&it&&(m.id=Y&Vt&&this.type!==h.name?null:this.parseIdent(),m.id&&!(Y&pt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?X:de:Ae));var Fe=this.yieldPos,et=this.awaitPos,Lt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Le(m.async,m.generator)),Y&it||(m.id=this.type===h.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,ve,!1),this.yieldPos=Fe,this.awaitPos=et,this.awaitIdentPos=Lt,this.finishNode(m,Y&it?"FunctionDeclaration":"FunctionExpression")},Mt.parseFunctionParams=function(m){this.expect(h.parenL),m.params=this.parseBindingList(h.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Mt.parseClass=function(m,Y){this.next();var ve=this.strict;this.strict=!0,this.parseClassId(m,Y),this.parseClassSuper(m);var ne=this.startNode(),Fe=!1;for(ne.body=[],this.expect(h.braceL);this.type!==h.braceR;){var et=this.parseClassElement(m.superClass!==null);et&&(ne.body.push(et),et.type==="MethodDefinition"&&et.kind==="constructor"&&(Fe&&this.raise(et.start,"Duplicate constructor in the same class"),Fe=!0))}return this.strict=ve,this.next(),m.body=this.finishNode(ne,"ClassBody"),this.finishNode(m,Y?"ClassDeclaration":"ClassExpression")},Mt.parseClassElement=function(m){var Y=this;if(this.eat(h.semi))return null;var ve=this.startNode(),ne=function(Gt,Fr){Fr===void 0&&(Fr=!1);var Vr=Y.start,Zn=Y.startLoc;return Y.eatContextual(Gt)?Y.type!==h.parenL&&(!Fr||!Y.canInsertSemicolon())?!0:(ve.key&&Y.unexpected(),ve.computed=!1,ve.key=Y.startNodeAt(Vr,Zn),ve.key.name=Gt,Y.finishNode(ve.key,"Identifier"),!1):!1};ve.kind="method",ve.static=ne("static");var Fe=this.eat(h.star),et=!1;Fe||(this.options.ecmaVersion>=8&&ne("async",!0)?(et=!0,Fe=this.options.ecmaVersion>=9&&this.eat(h.star)):ne("get")?ve.kind="get":ne("set")&&(ve.kind="set")),ve.key||this.parsePropertyName(ve);var Lt=ve.key,Kt=!1;return!ve.computed&&!ve.static&&(Lt.type==="Identifier"&&Lt.name==="constructor"||Lt.type==="Literal"&&Lt.value==="constructor")?(ve.kind!=="method"&&this.raise(Lt.start,"Constructor can't have get/set modifier"),Fe&&this.raise(Lt.start,"Constructor can't be a generator"),et&&this.raise(Lt.start,"Constructor can't be an async method"),ve.kind="constructor",Kt=m):ve.static&&Lt.type==="Identifier"&&Lt.name==="prototype"&&this.raise(Lt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(ve,Fe,et,Kt),ve.kind==="get"&&ve.value.params.length!==0&&this.raiseRecoverable(ve.value.start,"getter should have no params"),ve.kind==="set"&&ve.value.params.length!==1&&this.raiseRecoverable(ve.value.start,"setter should have exactly one param"),ve.kind==="set"&&ve.value.params[0].type==="RestElement"&&this.raiseRecoverable(ve.value.params[0].start,"Setter cannot use rest params"),ve},Mt.parseClassMethod=function(m,Y,ve,ne){return m.value=this.parseMethod(Y,ve,ne),this.finishNode(m,"MethodDefinition")},Mt.parseClassId=function(m,Y){this.type===h.name?(m.id=this.parseIdent(),Y&&this.checkLVal(m.id,de,!1)):(Y===!0&&this.unexpected(),m.id=null)},Mt.parseClassSuper=function(m){m.superClass=this.eat(h._extends)?this.parseExprSubscripts():null},Mt.parseExport=function(m,Y){if(this.next(),this.eat(h.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(Y,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==h.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(h._default)){this.checkExport(Y,"default",this.lastTokStart);var ve;if(this.type===h._function||(ve=this.isAsyncFunction())){var ne=this.startNode();this.next(),ve&&this.next(),m.declaration=this.parseFunction(ne,it|Vt,!1,ve)}else if(this.type===h._class){var Fe=this.startNode();m.declaration=this.parseClass(Fe,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(Y,m.declaration.declarations):this.checkExport(Y,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(Y),this.eatContextual("from"))this.type!==h.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var et=0,Lt=m.specifiers;et<Lt.length;et+=1){var Kt=Lt[et];this.checkUnreserved(Kt.local),this.checkLocalExport(Kt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Mt.checkExport=function(m,Y,ve){!m||(re(m,Y)&&this.raiseRecoverable(ve,"Duplicate export '"+Y+"'"),m[Y]=!0)},Mt.checkPatternExport=function(m,Y){var ve=Y.type;if(ve==="Identifier")this.checkExport(m,Y.name,Y.start);else if(ve==="ObjectPattern")for(var ne=0,Fe=Y.properties;ne<Fe.length;ne+=1){var et=Fe[ne];this.checkPatternExport(m,et)}else if(ve==="ArrayPattern")for(var Lt=0,Kt=Y.elements;Lt<Kt.length;Lt+=1){var Gt=Kt[Lt];Gt&&this.checkPatternExport(m,Gt)}else ve==="Property"?this.checkPatternExport(m,Y.value):ve==="AssignmentPattern"?this.checkPatternExport(m,Y.left):ve==="RestElement"?this.checkPatternExport(m,Y.argument):ve==="ParenthesizedExpression"&&this.checkPatternExport(m,Y.expression)},Mt.checkVariableExport=function(m,Y){if(!!m)for(var ve=0,ne=Y;ve<ne.length;ve+=1){var Fe=ne[ve];this.checkPatternExport(m,Fe.id)}},Mt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Mt.parseExportSpecifiers=function(m){var Y=[],ve=!0;for(this.expect(h.braceL);!this.eat(h.braceR);){if(ve)ve=!1;else if(this.expect(h.comma),this.afterTrailingComma(h.braceR))break;var ne=this.startNode();ne.local=this.parseIdent(!0),ne.exported=this.eatContextual("as")?this.parseIdent(!0):ne.local,this.checkExport(m,ne.exported.name,ne.exported.start),Y.push(this.finishNode(ne,"ExportSpecifier"))}return Y},Mt.parseImport=function(m){return this.next(),this.type===h.string?(m.specifiers=nt,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===h.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Mt.parseImportSpecifiers=function(){var m=[],Y=!0;if(this.type===h.name){var ve=this.startNode();if(ve.local=this.parseIdent(),this.checkLVal(ve.local,de),m.push(this.finishNode(ve,"ImportDefaultSpecifier")),!this.eat(h.comma))return m}if(this.type===h.star){var ne=this.startNode();return this.next(),this.expectContextual("as"),ne.local=this.parseIdent(),this.checkLVal(ne.local,de),m.push(this.finishNode(ne,"ImportNamespaceSpecifier")),m}for(this.expect(h.braceL);!this.eat(h.braceR);){if(Y)Y=!1;else if(this.expect(h.comma),this.afterTrailingComma(h.braceR))break;var Fe=this.startNode();Fe.imported=this.parseIdent(!0),this.eatContextual("as")?Fe.local=this.parseIdent():(this.checkUnreserved(Fe.imported),Fe.local=Fe.imported),this.checkLVal(Fe.local,de),m.push(this.finishNode(Fe,"ImportSpecifier"))}return m},Mt.adaptDirectivePrologue=function(m){for(var Y=0;Y<m.length&&this.isDirectiveCandidate(m[Y]);++Y)m[Y].directive=m[Y].expression.raw.slice(1,-1)},Mt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var Er=$e.prototype;Er.toAssignable=function(m,Y,ve){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",ve&&this.checkPatternErrors(ve,!0);for(var ne=0,Fe=m.properties;ne<Fe.length;ne+=1){var et=Fe[ne];this.toAssignable(et,Y),et.type==="RestElement"&&(et.argument.type==="ArrayPattern"||et.argument.type==="ObjectPattern")&&this.raise(et.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,Y);break;case"ArrayExpression":m.type="ArrayPattern",ve&&this.checkPatternErrors(ve,!0),this.toAssignableList(m.elements,Y);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,Y),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,Y);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,Y,ve);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!Y)break;default:this.raise(m.start,"Assigning to rvalue")}else ve&&this.checkPatternErrors(ve,!0);return m},Er.toAssignableList=function(m,Y){for(var ve=m.length,ne=0;ne<ve;ne++){var Fe=m[ne];Fe&&this.toAssignable(Fe,Y)}if(ve){var et=m[ve-1];this.options.ecmaVersion===6&&Y&&et&&et.type==="RestElement"&&et.argument.type!=="Identifier"&&this.unexpected(et.argument.start)}return m},Er.parseSpread=function(m){var Y=this.startNode();return this.next(),Y.argument=this.parseMaybeAssign(!1,m),this.finishNode(Y,"SpreadElement")},Er.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==h.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},Er.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case h.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(h.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case h.braceL:return this.parseObj(!0)}return this.parseIdent()},Er.parseBindingList=function(m,Y,ve){for(var ne=[],Fe=!0;!this.eat(m);)if(Fe?Fe=!1:this.expect(h.comma),Y&&this.type===h.comma)ne.push(null);else{if(ve&&this.afterTrailingComma(m))break;if(this.type===h.ellipsis){var et=this.parseRestBinding();this.parseBindingListItem(et),ne.push(et),this.type===h.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var Lt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Lt),ne.push(Lt)}}return ne},Er.parseBindingListItem=function(m){return m},Er.parseMaybeDefault=function(m,Y,ve){if(ve=ve||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(h.eq))return ve;var ne=this.startNodeAt(m,Y);return ne.left=ve,ne.right=this.parseMaybeAssign(),this.finishNode(ne,"AssignmentPattern")},Er.checkLVal=function(m,Y,ve){switch(Y===void 0&&(Y=C),m.type){case"Identifier":Y===de&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(Y?"Binding ":"Assigning to ")+m.name+" in strict mode"),ve&&(re(ve,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),ve[m.name]=!0),Y!==C&&Y!==Ge&&this.declareName(m.name,Y,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":Y&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var ne=0,Fe=m.properties;ne<Fe.length;ne+=1){var et=Fe[ne];this.checkLVal(et,Y,ve)}break;case"Property":this.checkLVal(m.value,Y,ve);break;case"ArrayPattern":for(var Lt=0,Kt=m.elements;Lt<Kt.length;Lt+=1){var Gt=Kt[Lt];Gt&&this.checkLVal(Gt,Y,ve)}break;case"AssignmentPattern":this.checkLVal(m.left,Y,ve);break;case"RestElement":this.checkLVal(m.argument,Y,ve);break;case"ParenthesizedExpression":this.checkLVal(m.expression,Y,ve);break;default:this.raise(m.start,(Y?"Binding":"Assigning to")+" rvalue")}};var mr=$e.prototype;mr.checkPropClash=function(m,Y,ve){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var ne=m.key,Fe;switch(ne.type){case"Identifier":Fe=ne.name;break;case"Literal":Fe=String(ne.value);break;default:return}var et=m.kind;if(this.options.ecmaVersion>=6){Fe==="__proto__"&&et==="init"&&(Y.proto&&(ve?ve.doubleProto<0&&(ve.doubleProto=ne.start):this.raiseRecoverable(ne.start,"Redefinition of __proto__ property")),Y.proto=!0);return}Fe="$"+Fe;var Lt=Y[Fe];if(Lt){var Kt;et==="init"?Kt=this.strict&&Lt.init||Lt.get||Lt.set:Kt=Lt.init||Lt[et],Kt&&this.raiseRecoverable(ne.start,"Redefinition of property")}else Lt=Y[Fe]={init:!1,get:!1,set:!1};Lt[et]=!0}},mr.parseExpression=function(m,Y){var ve=this.start,ne=this.startLoc,Fe=this.parseMaybeAssign(m,Y);if(this.type===h.comma){var et=this.startNodeAt(ve,ne);for(et.expressions=[Fe];this.eat(h.comma);)et.expressions.push(this.parseMaybeAssign(m,Y));return this.finishNode(et,"SequenceExpression")}return Fe},mr.parseMaybeAssign=function(m,Y,ve){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var ne=!1,Fe=-1,et=-1;Y?(Fe=Y.parenthesizedAssign,et=Y.trailingComma,Y.parenthesizedAssign=Y.trailingComma=-1):(Y=new xe,ne=!0);var Lt=this.start,Kt=this.startLoc;(this.type===h.parenL||this.type===h.name)&&(this.potentialArrowAt=this.start);var Gt=this.parseMaybeConditional(m,Y);if(ve&&(Gt=ve.call(this,Gt,Lt,Kt)),this.type.isAssign){var Fr=this.startNodeAt(Lt,Kt);return Fr.operator=this.value,Fr.left=this.type===h.eq?this.toAssignable(Gt,!1,Y):Gt,ne||(Y.parenthesizedAssign=Y.trailingComma=Y.doubleProto=-1),Y.shorthandAssign>=Fr.left.start&&(Y.shorthandAssign=-1),this.checkLVal(Gt),this.next(),Fr.right=this.parseMaybeAssign(m),this.finishNode(Fr,"AssignmentExpression")}else ne&&this.checkExpressionErrors(Y,!0);return Fe>-1&&(Y.parenthesizedAssign=Fe),et>-1&&(Y.trailingComma=et),Gt},mr.parseMaybeConditional=function(m,Y){var ve=this.start,ne=this.startLoc,Fe=this.parseExprOps(m,Y);if(this.checkExpressionErrors(Y))return Fe;if(this.eat(h.question)){var et=this.startNodeAt(ve,ne);return et.test=Fe,et.consequent=this.parseMaybeAssign(),this.expect(h.colon),et.alternate=this.parseMaybeAssign(m),this.finishNode(et,"ConditionalExpression")}return Fe},mr.parseExprOps=function(m,Y){var ve=this.start,ne=this.startLoc,Fe=this.parseMaybeUnary(Y,!1);return this.checkExpressionErrors(Y)||Fe.start===ve&&Fe.type==="ArrowFunctionExpression"?Fe:this.parseExprOp(Fe,ve,ne,-1,m)},mr.parseExprOp=function(m,Y,ve,ne,Fe){var et=this.type.binop;if(et!=null&&(!Fe||this.type!==h._in)&&et>ne){var Lt=this.type===h.logicalOR||this.type===h.logicalAND,Kt=this.type===h.coalesce;Kt&&(et=h.logicalAND.binop);var Gt=this.value;this.next();var Fr=this.start,Vr=this.startLoc,Zn=this.parseExprOp(this.parseMaybeUnary(null,!1),Fr,Vr,et,Fe),Ri=this.buildBinary(Y,ve,m,Zn,Gt,Lt||Kt);return(Lt&&this.type===h.coalesce||Kt&&(this.type===h.logicalOR||this.type===h.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ri,Y,ve,ne,Fe)}return m},mr.buildBinary=function(m,Y,ve,ne,Fe,et){var Lt=this.startNodeAt(m,Y);return Lt.left=ve,Lt.operator=Fe,Lt.right=ne,this.finishNode(Lt,et?"LogicalExpression":"BinaryExpression")},mr.parseMaybeUnary=function(m,Y){var ve=this.start,ne=this.startLoc,Fe;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))Fe=this.parseAwait(),Y=!0;else if(this.type.prefix){var et=this.startNode(),Lt=this.type===h.incDec;et.operator=this.value,et.prefix=!0,this.next(),et.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),Lt?this.checkLVal(et.argument):this.strict&&et.operator==="delete"&&et.argument.type==="Identifier"?this.raiseRecoverable(et.start,"Deleting local variable in strict mode"):Y=!0,Fe=this.finishNode(et,Lt?"UpdateExpression":"UnaryExpression")}else{if(Fe=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return Fe;for(;this.type.postfix&&!this.canInsertSemicolon();){var Kt=this.startNodeAt(ve,ne);Kt.operator=this.value,Kt.prefix=!1,Kt.argument=Fe,this.checkLVal(Fe),this.next(),Fe=this.finishNode(Kt,"UpdateExpression")}}return!Y&&this.eat(h.starstar)?this.buildBinary(ve,ne,Fe,this.parseMaybeUnary(null,!1),"**",!1):Fe},mr.parseExprSubscripts=function(m){var Y=this.start,ve=this.startLoc,ne=this.parseExprAtom(m);if(ne.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return ne;var Fe=this.parseSubscripts(ne,Y,ve);return m&&Fe.type==="MemberExpression"&&(m.parenthesizedAssign>=Fe.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=Fe.start&&(m.parenthesizedBind=-1)),Fe},mr.parseSubscripts=function(m,Y,ve,ne){for(var Fe=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,et=!1;;){var Lt=this.parseSubscript(m,Y,ve,ne,Fe,et);if(Lt.optional&&(et=!0),Lt===m||Lt.type==="ArrowFunctionExpression"){if(et){var Kt=this.startNodeAt(Y,ve);Kt.expression=Lt,Lt=this.finishNode(Kt,"ChainExpression")}return Lt}m=Lt}},mr.parseSubscript=function(m,Y,ve,ne,Fe,et){var Lt=this.options.ecmaVersion>=11,Kt=Lt&&this.eat(h.questionDot);ne&&Kt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Gt=this.eat(h.bracketL);if(Gt||Kt&&this.type!==h.parenL&&this.type!==h.backQuote||this.eat(h.dot)){var Fr=this.startNodeAt(Y,ve);Fr.object=m,Fr.property=Gt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Fr.computed=!!Gt,Gt&&this.expect(h.bracketR),Lt&&(Fr.optional=Kt),m=this.finishNode(Fr,"MemberExpression")}else if(!ne&&this.eat(h.parenL)){var Vr=new xe,Zn=this.yieldPos,Ri=this.awaitPos,ti=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ha=this.parseExprList(h.parenR,this.options.ecmaVersion>=8,!1,Vr);if(Fe&&!Kt&&!this.canInsertSemicolon()&&this.eat(h.arrow))return this.checkPatternErrors(Vr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Zn,this.awaitPos=Ri,this.awaitIdentPos=ti,this.parseArrowExpression(this.startNodeAt(Y,ve),ha,!0);this.checkExpressionErrors(Vr,!0),this.yieldPos=Zn||this.yieldPos,this.awaitPos=Ri||this.awaitPos,this.awaitIdentPos=ti||this.awaitIdentPos;var ua=this.startNodeAt(Y,ve);ua.callee=m,ua.arguments=ha,Lt&&(ua.optional=Kt),m=this.finishNode(ua,"CallExpression")}else if(this.type===h.backQuote){(Kt||et)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ga=this.startNodeAt(Y,ve);Ga.tag=m,Ga.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(Ga,"TaggedTemplateExpression")}return m},mr.parseExprAtom=function(m){this.type===h.slash&&this.readRegexp();var Y,ve=this.potentialArrowAt===this.start;switch(this.type){case h._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),Y=this.startNode(),this.next(),this.type===h.parenL&&!this.allowDirectSuper&&this.raise(Y.start,"super() call outside constructor of a subclass"),this.type!==h.dot&&this.type!==h.bracketL&&this.type!==h.parenL&&this.unexpected(),this.finishNode(Y,"Super");case h._this:return Y=this.startNode(),this.next(),this.finishNode(Y,"ThisExpression");case h.name:var ne=this.start,Fe=this.startLoc,et=this.containsEsc,Lt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!et&&Lt.name==="async"&&!this.canInsertSemicolon()&&this.eat(h._function))return this.parseFunction(this.startNodeAt(ne,Fe),0,!1,!0);if(ve&&!this.canInsertSemicolon()){if(this.eat(h.arrow))return this.parseArrowExpression(this.startNodeAt(ne,Fe),[Lt],!1);if(this.options.ecmaVersion>=8&&Lt.name==="async"&&this.type===h.name&&!et)return Lt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(h.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(ne,Fe),[Lt],!0)}return Lt;case h.regexp:var Kt=this.value;return Y=this.parseLiteral(Kt.value),Y.regex={pattern:Kt.pattern,flags:Kt.flags},Y;case h.num:case h.string:return this.parseLiteral(this.value);case h._null:case h._true:case h._false:return Y=this.startNode(),Y.value=this.type===h._null?null:this.type===h._true,Y.raw=this.type.keyword,this.next(),this.finishNode(Y,"Literal");case h.parenL:var Gt=this.start,Fr=this.parseParenAndDistinguishExpression(ve);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Fr)&&(m.parenthesizedAssign=Gt),m.parenthesizedBind<0&&(m.parenthesizedBind=Gt)),Fr;case h.bracketL:return Y=this.startNode(),this.next(),Y.elements=this.parseExprList(h.bracketR,!0,!0,m),this.finishNode(Y,"ArrayExpression");case h.braceL:return this.parseObj(!1,m);case h._function:return Y=this.startNode(),this.next(),this.parseFunction(Y,0);case h._class:return this.parseClass(this.startNode(),!1);case h._new:return this.parseNew();case h.backQuote:return this.parseTemplate();case h._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},mr.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var Y=this.parseIdent(!0);switch(this.type){case h.parenL:return this.parseDynamicImport(m);case h.dot:return m.meta=Y,this.parseImportMeta(m);default:this.unexpected()}},mr.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(h.parenR)){var Y=this.start;this.eat(h.comma)&&this.eat(h.parenR)?this.raiseRecoverable(Y,"Trailing comma is not allowed in import()"):this.unexpected(Y)}return this.finishNode(m,"ImportExpression")},mr.parseImportMeta=function(m){this.next();var Y=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),Y&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},mr.parseLiteral=function(m){var Y=this.startNode();return Y.value=m,Y.raw=this.input.slice(this.start,this.end),Y.raw.charCodeAt(Y.raw.length-1)===110&&(Y.bigint=Y.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(Y,"Literal")},mr.parseParenExpression=function(){this.expect(h.parenL);var m=this.parseExpression();return this.expect(h.parenR),m},mr.parseParenAndDistinguishExpression=function(m){var Y=this.start,ve=this.startLoc,ne,Fe=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var et=this.start,Lt=this.startLoc,Kt=[],Gt=!0,Fr=!1,Vr=new xe,Zn=this.yieldPos,Ri=this.awaitPos,ti;for(this.yieldPos=0,this.awaitPos=0;this.type!==h.parenR;)if(Gt?Gt=!1:this.expect(h.comma),Fe&&this.afterTrailingComma(h.parenR,!0)){Fr=!0;break}else if(this.type===h.ellipsis){ti=this.start,Kt.push(this.parseParenItem(this.parseRestBinding())),this.type===h.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Kt.push(this.parseMaybeAssign(!1,Vr,this.parseParenItem));var ha=this.start,ua=this.startLoc;if(this.expect(h.parenR),m&&!this.canInsertSemicolon()&&this.eat(h.arrow))return this.checkPatternErrors(Vr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Zn,this.awaitPos=Ri,this.parseParenArrowList(Y,ve,Kt);(!Kt.length||Fr)&&this.unexpected(this.lastTokStart),ti&&this.unexpected(ti),this.checkExpressionErrors(Vr,!0),this.yieldPos=Zn||this.yieldPos,this.awaitPos=Ri||this.awaitPos,Kt.length>1?(ne=this.startNodeAt(et,Lt),ne.expressions=Kt,this.finishNodeAt(ne,"SequenceExpression",ha,ua)):ne=Kt[0]}else ne=this.parseParenExpression();if(this.options.preserveParens){var Ga=this.startNodeAt(Y,ve);return Ga.expression=ne,this.finishNode(Ga,"ParenthesizedExpression")}else return ne},mr.parseParenItem=function(m){return m},mr.parseParenArrowList=function(m,Y,ve){return this.parseArrowExpression(this.startNodeAt(m,Y),ve)};var Br=[];mr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),Y=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(h.dot)){m.meta=Y;var ve=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),ve&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var ne=this.start,Fe=this.startLoc,et=this.type===h._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),ne,Fe,!0),et&&m.callee.type==="ImportExpression"&&this.raise(ne,"Cannot use new with import()"),this.eat(h.parenL)?m.arguments=this.parseExprList(h.parenR,this.options.ecmaVersion>=8,!1):m.arguments=Br,this.finishNode(m,"NewExpression")},mr.parseTemplateElement=function(m){var Y=m.isTagged,ve=this.startNode();return this.type===h.invalidTemplate?(Y||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),ve.value={raw:this.value,cooked:null}):ve.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),ve.tail=this.type===h.backQuote,this.finishNode(ve,"TemplateElement")},mr.parseTemplate=function(m){m===void 0&&(m={});var Y=m.isTagged;Y===void 0&&(Y=!1);var ve=this.startNode();this.next(),ve.expressions=[];var ne=this.parseTemplateElement({isTagged:Y});for(ve.quasis=[ne];!ne.tail;)this.type===h.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(h.dollarBraceL),ve.expressions.push(this.parseExpression()),this.expect(h.braceR),ve.quasis.push(ne=this.parseTemplateElement({isTagged:Y}));return this.next(),this.finishNode(ve,"TemplateLiteral")},mr.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===h.name||this.type===h.num||this.type===h.string||this.type===h.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===h.star)&&!S.test(this.input.slice(this.lastTokEnd,this.start))},mr.parseObj=function(m,Y){var ve=this.startNode(),ne=!0,Fe={};for(ve.properties=[],this.next();!this.eat(h.braceR);){if(ne)ne=!1;else if(this.expect(h.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(h.braceR))break;var et=this.parseProperty(m,Y);m||this.checkPropClash(et,Fe,Y),ve.properties.push(et)}return this.finishNode(ve,m?"ObjectPattern":"ObjectExpression")},mr.parseProperty=function(m,Y){var ve=this.startNode(),ne,Fe,et,Lt;if(this.options.ecmaVersion>=9&&this.eat(h.ellipsis))return m?(ve.argument=this.parseIdent(!1),this.type===h.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(ve,"RestElement")):(this.type===h.parenL&&Y&&(Y.parenthesizedAssign<0&&(Y.parenthesizedAssign=this.start),Y.parenthesizedBind<0&&(Y.parenthesizedBind=this.start)),ve.argument=this.parseMaybeAssign(!1,Y),this.type===h.comma&&Y&&Y.trailingComma<0&&(Y.trailingComma=this.start),this.finishNode(ve,"SpreadElement"));this.options.ecmaVersion>=6&&(ve.method=!1,ve.shorthand=!1,(m||Y)&&(et=this.start,Lt=this.startLoc),m||(ne=this.eat(h.star)));var Kt=this.containsEsc;return this.parsePropertyName(ve),!m&&!Kt&&this.options.ecmaVersion>=8&&!ne&&this.isAsyncProp(ve)?(Fe=!0,ne=this.options.ecmaVersion>=9&&this.eat(h.star),this.parsePropertyName(ve,Y)):Fe=!1,this.parsePropertyValue(ve,m,ne,Fe,et,Lt,Y,Kt),this.finishNode(ve,"Property")},mr.parsePropertyValue=function(m,Y,ve,ne,Fe,et,Lt,Kt){if((ve||ne)&&this.type===h.colon&&this.unexpected(),this.eat(h.colon))m.value=Y?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Lt),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===h.parenL)Y&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(ve,ne);else if(!Y&&!Kt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==h.comma&&this.type!==h.braceR&&this.type!==h.eq){(ve||ne)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Gt=m.kind==="get"?0:1;if(m.value.params.length!==Gt){var Fr=m.value.start;m.kind==="get"?this.raiseRecoverable(Fr,"getter should have no params"):this.raiseRecoverable(Fr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((ve||ne)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Fe),m.kind="init",Y?m.value=this.parseMaybeDefault(Fe,et,m.key):this.type===h.eq&&Lt?(Lt.shorthandAssign<0&&(Lt.shorthandAssign=this.start),m.value=this.parseMaybeDefault(Fe,et,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},mr.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(h.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(h.bracketR),m.key;m.computed=!1}return m.key=this.type===h.num||this.type===h.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},mr.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},mr.parseMethod=function(m,Y,ve){var ne=this.startNode(),Fe=this.yieldPos,et=this.awaitPos,Lt=this.awaitIdentPos;return this.initFunction(ne),this.options.ecmaVersion>=6&&(ne.generator=m),this.options.ecmaVersion>=8&&(ne.async=!!Y),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Le(Y,ne.generator)|fe|(ve?me:0)),this.expect(h.parenL),ne.params=this.parseBindingList(h.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(ne,!1,!0),this.yieldPos=Fe,this.awaitPos=et,this.awaitIdentPos=Lt,this.finishNode(ne,"FunctionExpression")},mr.parseArrowExpression=function(m,Y,ve){var ne=this.yieldPos,Fe=this.awaitPos,et=this.awaitIdentPos;return this.enterScope(Le(ve,!1)|se),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!ve),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(Y,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=ne,this.awaitPos=Fe,this.awaitIdentPos=et,this.finishNode(m,"ArrowFunctionExpression")},mr.parseFunctionBody=function(m,Y,ve){var ne=Y&&this.type!==h.braceL,Fe=this.strict,et=!1;if(ne)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var Lt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!Fe||Lt)&&(et=this.strictDirective(this.end),et&&Lt&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Kt=this.labels;this.labels=[],et&&(this.strict=!0),this.checkParams(m,!Fe&&!et&&!Y&&!ve&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,Ge),m.body=this.parseBlock(!1,void 0,et&&!Fe),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Kt}this.exitScope()},mr.isSimpleParamList=function(m){for(var Y=0,ve=m;Y<ve.length;Y+=1){var ne=ve[Y];if(ne.type!=="Identifier")return!1}return!0},mr.checkParams=function(m,Y){for(var ve={},ne=0,Fe=m.params;ne<Fe.length;ne+=1){var et=Fe[ne];this.checkLVal(et,X,Y?null:ve)}},mr.parseExprList=function(m,Y,ve,ne){for(var Fe=[],et=!0;!this.eat(m);){if(et)et=!1;else if(this.expect(h.comma),Y&&this.afterTrailingComma(m))break;var Lt=void 0;ve&&this.type===h.comma?Lt=null:this.type===h.ellipsis?(Lt=this.parseSpread(ne),ne&&this.type===h.comma&&ne.trailingComma<0&&(ne.trailingComma=this.start)):Lt=this.parseMaybeAssign(!1,ne),Fe.push(Lt)}return Fe},mr.checkUnreserved=function(m){var Y=m.start,ve=m.end,ne=m.name;if(this.inGenerator&&ne==="yield"&&this.raiseRecoverable(Y,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&ne==="await"&&this.raiseRecoverable(Y,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(ne)&&this.raise(Y,"Unexpected keyword '"+ne+"'"),!(this.options.ecmaVersion<6&&this.input.slice(Y,ve).indexOf("\\")!==-1)){var Fe=this.strict?this.reservedWordsStrict:this.reservedWords;Fe.test(ne)&&(!this.inAsync&&ne==="await"&&this.raiseRecoverable(Y,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(Y,"The keyword '"+ne+"' is reserved"))}},mr.parseIdent=function(m,Y){var ve=this.startNode();return this.type===h.name?ve.name=this.value:this.type.keyword?(ve.name=this.type.keyword,(ve.name==="class"||ve.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(ve,"Identifier"),m||(this.checkUnreserved(ve),ve.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ve.start)),ve},mr.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var Y=this.startNode();return this.next(),this.type===h.semi||this.canInsertSemicolon()||this.type!==h.star&&!this.type.startsExpr?(Y.delegate=!1,Y.argument=null):(Y.delegate=this.eat(h.star),Y.argument=this.parseMaybeAssign(m)),this.finishNode(Y,"YieldExpression")},mr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Ur=$e.prototype;Ur.raise=function(m,Y){var ve=G(this.input,m);Y+=" ("+ve.line+":"+ve.column+")";var ne=new SyntaxError(Y);throw ne.pos=m,ne.loc=ve,ne.raisedAt=this.pos,ne},Ur.raiseRecoverable=Ur.raise,Ur.curPosition=function(){if(this.options.locations)return new H(this.curLine,this.pos-this.lineStart)};var Ar=$e.prototype,Nn=function(Y){this.flags=Y,this.var=[],this.lexical=[],this.functions=[]};Ar.enterScope=function(m){this.scopeStack.push(new Nn(m))},Ar.exitScope=function(){this.scopeStack.pop()},Ar.treatFunctionsAsVarInScope=function(m){return m.flags&pe||!this.inModule&&m.flags&ge},Ar.declareName=function(m,Y,ve){var ne=!1;if(Y===de){var Fe=this.currentScope();ne=Fe.lexical.indexOf(m)>-1||Fe.functions.indexOf(m)>-1||Fe.var.indexOf(m)>-1,Fe.lexical.push(m),this.inModule&&Fe.flags&ge&&delete this.undefinedExports[m]}else if(Y===De){var et=this.currentScope();et.lexical.push(m)}else if(Y===Ae){var Lt=this.currentScope();this.treatFunctionsAsVar?ne=Lt.lexical.indexOf(m)>-1:ne=Lt.lexical.indexOf(m)>-1||Lt.var.indexOf(m)>-1,Lt.functions.push(m)}else for(var Kt=this.scopeStack.length-1;Kt>=0;--Kt){var Gt=this.scopeStack[Kt];if(Gt.lexical.indexOf(m)>-1&&!(Gt.flags&J&&Gt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Gt)&&Gt.functions.indexOf(m)>-1){ne=!0;break}if(Gt.var.push(m),this.inModule&&Gt.flags&ge&&delete this.undefinedExports[m],Gt.flags&Ne)break}ne&&this.raiseRecoverable(ve,"Identifier '"+m+"' has already been declared")},Ar.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Ar.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Ar.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var Y=this.scopeStack[m];if(Y.flags&Ne)return Y}},Ar.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var Y=this.scopeStack[m];if(Y.flags&Ne&&!(Y.flags&se))return Y}};var Rn=function(Y,ve,ne){this.type="",this.start=ve,this.end=0,Y.options.locations&&(this.loc=new ae(Y,ne)),Y.options.directSourceFile&&(this.sourceFile=Y.options.directSourceFile),Y.options.ranges&&(this.range=[ve,0])},ci=$e.prototype;ci.startNode=function(){return new Rn(this,this.start,this.startLoc)},ci.startNodeAt=function(m,Y){return new Rn(this,m,Y)};function Fi(m,Y,ve,ne){return m.type=Y,m.end=ve,this.options.locations&&(m.loc.end=ne),this.options.ranges&&(m.range[1]=ve),m}ci.finishNode=function(m,Y){return Fi.call(this,m,Y,this.lastTokEnd,this.lastTokEndLoc)},ci.finishNodeAt=function(m,Y,ve,ne){return Fi.call(this,m,Y,ve,ne)};var ji=function(Y,ve,ne,Fe,et){this.token=Y,this.isExpr=!!ve,this.preserveSpace=!!ne,this.override=Fe,this.generator=!!et},Si={b_stat:new ji("{",!1),b_expr:new ji("{",!0),b_tmpl:new ji("${",!1),p_stat:new ji("(",!1),p_expr:new ji("(",!0),q_tmpl:new ji("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new ji("function",!1),f_expr:new ji("function",!0),f_expr_gen:new ji("function",!0,!1,null,!0),f_gen:new ji("function",!1,!1,null,!0)},xi=$e.prototype;xi.initialContext=function(){return[Si.b_stat]},xi.braceIsBlock=function(m){var Y=this.curContext();return Y===Si.f_expr||Y===Si.f_stat?!0:m===h.colon&&(Y===Si.b_stat||Y===Si.b_expr)?!Y.isExpr:m===h._return||m===h.name&&this.exprAllowed?S.test(this.input.slice(this.lastTokEnd,this.start)):m===h._else||m===h.semi||m===h.eof||m===h.parenR||m===h.arrow?!0:m===h.braceL?Y===Si.b_stat:m===h._var||m===h._const||m===h.name?!1:!this.exprAllowed},xi.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var Y=this.context[m];if(Y.token==="function")return Y.generator}return!1},xi.updateContext=function(m){var Y,ve=this.type;ve.keyword&&m===h.dot?this.exprAllowed=!1:(Y=ve.updateContext)?Y.call(this,m):this.exprAllowed=ve.beforeExpr},h.parenR.updateContext=h.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Si.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},h.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Si.b_stat:Si.b_expr),this.exprAllowed=!0},h.dollarBraceL.updateContext=function(){this.context.push(Si.b_tmpl),this.exprAllowed=!0},h.parenL.updateContext=function(m){var Y=m===h._if||m===h._for||m===h._with||m===h._while;this.context.push(Y?Si.p_stat:Si.p_expr),this.exprAllowed=!0},h.incDec.updateContext=function(){},h._function.updateContext=h._class.updateContext=function(m){m.beforeExpr&&m!==h.semi&&m!==h._else&&!(m===h._return&&S.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===h.colon||m===h.braceL)&&this.curContext()===Si.b_stat)?this.context.push(Si.f_expr):this.context.push(Si.f_stat),this.exprAllowed=!1},h.backQuote.updateContext=function(){this.curContext()===Si.q_tmpl?this.context.pop():this.context.push(Si.q_tmpl),this.exprAllowed=!1},h.star.updateContext=function(m){if(m===h._function){var Y=this.context.length-1;this.context[Y]===Si.f_expr?this.context[Y]=Si.f_expr_gen:this.context[Y]=Si.f_gen}this.exprAllowed=!0},h.name.updateContext=function(m){var Y=!1;this.options.ecmaVersion>=6&&m!==h.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(Y=!0),this.exprAllowed=Y};var Ee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ke=Ee+" Extended_Pictographic",ze=ke,Ke={9:Ee,10:ke,11:ze},ot="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Rt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Nt=Rt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ye=Nt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Et={9:Rt,10:Nt,11:Ye},Zt={};function Lr(m){var Y=Zt[m]={binary:ee(Ke[m]+" "+ot),nonBinary:{General_Category:ee(ot),Script:ee(Et[m])}};Y.nonBinary.Script_Extensions=Y.nonBinary.Script,Y.nonBinary.gc=Y.nonBinary.General_Category,Y.nonBinary.sc=Y.nonBinary.Script,Y.nonBinary.scx=Y.nonBinary.Script_Extensions}Lr(9),Lr(10),Lr(11);var ir=$e.prototype,ur=function(Y){this.parser=Y,this.validFlags="gim"+(Y.options.ecmaVersion>=6?"uy":"")+(Y.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Zt[Y.options.ecmaVersion>=11?11:Y.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};ur.prototype.reset=function(Y,ve,ne){var Fe=ne.indexOf("u")!==-1;this.start=Y|0,this.source=ve+"",this.flags=ne,this.switchU=Fe&&this.parser.options.ecmaVersion>=6,this.switchN=Fe&&this.parser.options.ecmaVersion>=9},ur.prototype.raise=function(Y){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+Y)},ur.prototype.at=function(Y,ve){ve===void 0&&(ve=!1);var ne=this.source,Fe=ne.length;if(Y>=Fe)return-1;var et=ne.charCodeAt(Y);if(!(ve||this.switchU)||et<=55295||et>=57344||Y+1>=Fe)return et;var Lt=ne.charCodeAt(Y+1);return Lt>=56320&&Lt<=57343?(et<<10)+Lt-56613888:et},ur.prototype.nextIndex=function(Y,ve){ve===void 0&&(ve=!1);var ne=this.source,Fe=ne.length;if(Y>=Fe)return Fe;var et=ne.charCodeAt(Y),Lt;return!(ve||this.switchU)||et<=55295||et>=57344||Y+1>=Fe||(Lt=ne.charCodeAt(Y+1))<56320||Lt>57343?Y+1:Y+2},ur.prototype.current=function(Y){return Y===void 0&&(Y=!1),this.at(this.pos,Y)},ur.prototype.lookahead=function(Y){return Y===void 0&&(Y=!1),this.at(this.nextIndex(this.pos,Y),Y)},ur.prototype.advance=function(Y){Y===void 0&&(Y=!1),this.pos=this.nextIndex(this.pos,Y)},ur.prototype.eat=function(Y,ve){return ve===void 0&&(ve=!1),this.current(ve)===Y?(this.advance(ve),!0):!1};function Or(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}ir.validateRegExpFlags=function(m){for(var Y=m.validFlags,ve=m.flags,ne=0;ne<ve.length;ne++){var Fe=ve.charAt(ne);Y.indexOf(Fe)===-1&&this.raise(m.start,"Invalid regular expression flag"),ve.indexOf(Fe,ne+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},ir.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},ir.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var Y=0,ve=m.backReferenceNames;Y<ve.length;Y+=1){var ne=ve[Y];m.groupNames.indexOf(ne)===-1&&m.raise("Invalid named capture referenced")}},ir.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},ir.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},ir.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},ir.regexp_eatAssertion=function(m){var Y=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=Y}if(m.eat(40)&&m.eat(63)){var ve=!1;if(this.options.ecmaVersion>=9&&(ve=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!ve,!0}return m.pos=Y,!1},ir.regexp_eatQuantifier=function(m,Y){return Y===void 0&&(Y=!1),this.regexp_eatQuantifierPrefix(m,Y)?(m.eat(63),!0):!1},ir.regexp_eatQuantifierPrefix=function(m,Y){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,Y)},ir.regexp_eatBracedQuantifier=function(m,Y){var ve=m.pos;if(m.eat(123)){var ne=0,Fe=-1;if(this.regexp_eatDecimalDigits(m)&&(ne=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(Fe=m.lastIntValue),m.eat(125)))return Fe!==-1&&Fe<ne&&!Y&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!Y&&m.raise("Incomplete quantifier"),m.pos=ve}return!1},ir.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},ir.regexp_eatReverseSolidusAtomEscape=function(m){var Y=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=Y}return!1},ir.regexp_eatUncapturingGroup=function(m){var Y=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=Y}return!1},ir.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},ir.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},ir.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},ir.regexp_eatSyntaxCharacter=function(m){var Y=m.current();return nn(Y)?(m.lastIntValue=Y,m.advance(),!0):!1};function nn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}ir.regexp_eatPatternCharacters=function(m){for(var Y=m.pos,ve=0;(ve=m.current())!==-1&&!nn(ve);)m.advance();return m.pos!==Y},ir.regexp_eatExtendedPatternCharacter=function(m){var Y=m.current();return Y!==-1&&Y!==36&&!(Y>=40&&Y<=43)&&Y!==46&&Y!==63&&Y!==91&&Y!==94&&Y!==124?(m.advance(),!0):!1},ir.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},ir.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},ir.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Or(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Or(m.lastIntValue);return!0}return!1},ir.regexp_eatRegExpIdentifierStart=function(m){var Y=m.pos,ve=this.options.ecmaVersion>=11,ne=m.current(ve);return m.advance(ve),ne===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,ve)&&(ne=m.lastIntValue),Hr(ne)?(m.lastIntValue=ne,!0):(m.pos=Y,!1)};function Hr(m){return j(m,!0)||m===36||m===95}ir.regexp_eatRegExpIdentifierPart=function(m){var Y=m.pos,ve=this.options.ecmaVersion>=11,ne=m.current(ve);return m.advance(ve),ne===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,ve)&&(ne=m.lastIntValue),gr(ne)?(m.lastIntValue=ne,!0):(m.pos=Y,!1)};function gr(m){return U(m,!0)||m===36||m===95||m===8204||m===8205}ir.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},ir.regexp_eatBackReference=function(m){var Y=m.pos;if(this.regexp_eatDecimalEscape(m)){var ve=m.lastIntValue;if(m.switchU)return ve>m.maxBackReference&&(m.maxBackReference=ve),!0;if(ve<=m.numCapturingParens)return!0;m.pos=Y}return!1},ir.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},ir.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},ir.regexp_eatCControlLetter=function(m){var Y=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=Y}return!1},ir.regexp_eatZero=function(m){return m.current()===48&&!ni(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},ir.regexp_eatControlEscape=function(m){var Y=m.current();return Y===116?(m.lastIntValue=9,m.advance(),!0):Y===110?(m.lastIntValue=10,m.advance(),!0):Y===118?(m.lastIntValue=11,m.advance(),!0):Y===102?(m.lastIntValue=12,m.advance(),!0):Y===114?(m.lastIntValue=13,m.advance(),!0):!1},ir.regexp_eatControlLetter=function(m){var Y=m.current();return vn(Y)?(m.lastIntValue=Y%32,m.advance(),!0):!1};function vn(m){return m>=65&&m<=90||m>=97&&m<=122}ir.regexp_eatRegExpUnicodeEscapeSequence=function(m,Y){Y===void 0&&(Y=!1);var ve=m.pos,ne=Y||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var Fe=m.lastIntValue;if(ne&&Fe>=55296&&Fe<=56319){var et=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var Lt=m.lastIntValue;if(Lt>=56320&&Lt<=57343)return m.lastIntValue=(Fe-55296)*1024+(Lt-56320)+65536,!0}m.pos=et,m.lastIntValue=Fe}return!0}if(ne&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&an(m.lastIntValue))return!0;ne&&m.raise("Invalid unicode escape"),m.pos=ve}return!1};function an(m){return m>=0&&m<=1114111}ir.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var Y=m.current();return Y!==99&&(!m.switchN||Y!==107)?(m.lastIntValue=Y,m.advance(),!0):!1},ir.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var Y=m.current();if(Y>=49&&Y<=57){do m.lastIntValue=10*m.lastIntValue+(Y-48),m.advance();while((Y=m.current())>=48&&Y<=57);return!0}return!1},ir.regexp_eatCharacterClassEscape=function(m){var Y=m.current();if(sn(Y))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(Y===80||Y===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function sn(m){return m===100||m===68||m===115||m===83||m===119||m===87}ir.regexp_eatUnicodePropertyValueExpression=function(m){var Y=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var ve=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var ne=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,ve,ne),!0}}if(m.pos=Y,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var Fe=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,Fe),!0}return!1},ir.regexp_validateUnicodePropertyNameAndValue=function(m,Y,ve){re(m.unicodeProperties.nonBinary,Y)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[Y].test(ve)||m.raise("Invalid property value")},ir.regexp_validateUnicodePropertyNameOrValue=function(m,Y){m.unicodeProperties.binary.test(Y)||m.raise("Invalid property name")},ir.regexp_eatUnicodePropertyName=function(m){var Y=0;for(m.lastStringValue="";Ei(Y=m.current());)m.lastStringValue+=Or(Y),m.advance();return m.lastStringValue!==""};function Ei(m){return vn(m)||m===95}ir.regexp_eatUnicodePropertyValue=function(m){var Y=0;for(m.lastStringValue="";fn(Y=m.current());)m.lastStringValue+=Or(Y),m.advance();return m.lastStringValue!==""};function fn(m){return Ei(m)||ni(m)}ir.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},ir.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},ir.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var Y=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var ve=m.lastIntValue;m.switchU&&(Y===-1||ve===-1)&&m.raise("Invalid character class"),Y!==-1&&ve!==-1&&Y>ve&&m.raise("Range out of order in character class")}}},ir.regexp_eatClassAtom=function(m){var Y=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var ve=m.current();(ve===99||Li(ve))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=Y}var ne=m.current();return ne!==93?(m.lastIntValue=ne,m.advance(),!0):!1},ir.regexp_eatClassEscape=function(m){var Y=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=Y}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},ir.regexp_eatClassControlLetter=function(m){var Y=m.current();return ni(Y)||Y===95?(m.lastIntValue=Y%32,m.advance(),!0):!1},ir.regexp_eatHexEscapeSequence=function(m){var Y=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=Y}return!1},ir.regexp_eatDecimalDigits=function(m){var Y=m.pos,ve=0;for(m.lastIntValue=0;ni(ve=m.current());)m.lastIntValue=10*m.lastIntValue+(ve-48),m.advance();return m.pos!==Y};function ni(m){return m>=48&&m<=57}ir.regexp_eatHexDigits=function(m){var Y=m.pos,ve=0;for(m.lastIntValue=0;Ui(ve=m.current());)m.lastIntValue=16*m.lastIntValue+mi(ve),m.advance();return m.pos!==Y};function Ui(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function mi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}ir.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var Y=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var ve=m.lastIntValue;Y<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=Y*64+ve*8+m.lastIntValue:m.lastIntValue=Y*8+ve}else m.lastIntValue=Y;return!0}return!1},ir.regexp_eatOctalDigit=function(m){var Y=m.current();return Li(Y)?(m.lastIntValue=Y-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Li(m){return m>=48&&m<=55}ir.regexp_eatFixedHexDigits=function(m,Y){var ve=m.pos;m.lastIntValue=0;for(var ne=0;ne<Y;++ne){var Fe=m.current();if(!Ui(Fe))return m.pos=ve,!1;m.lastIntValue=16*m.lastIntValue+mi(Fe),m.advance()}return!0};var ui=function(Y){this.type=Y.type,this.value=Y.value,this.start=Y.start,this.end=Y.end,Y.options.locations&&(this.loc=new ae(Y,Y.startLoc,Y.endLoc)),Y.options.ranges&&(this.range=[Y.start,Y.end])},fi=$e.prototype;fi.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new ui(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},fi.getToken=function(){return this.next(),new ui(this)},typeof Symbol!="undefined"&&(fi[Symbol.iterator]=function(){var m=this;return{next:function(){var Y=m.getToken();return{done:Y.type===h.eof,value:Y}}}}),fi.curContext=function(){return this.context[this.context.length-1]},fi.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(h.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},fi.readToken=function(m){return j(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},fi.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var Y=this.input.charCodeAt(this.pos+1);return(m<<10)+Y-56613888},fi.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),Y=this.pos,ve=this.input.indexOf("*/",this.pos+=2);if(ve===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=ve+2,this.options.locations){A.lastIndex=Y;for(var ne;(ne=A.exec(this.input))&&ne.index<this.pos;)++this.curLine,this.lineStart=ne.index+ne[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(Y+2,ve),Y,this.pos,m,this.curPosition())},fi.skipLineComment=function(m){for(var Y=this.pos,ve=this.options.onComment&&this.curPosition(),ne=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!x(ne);)ne=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(Y+m,this.pos),Y,this.pos,ve,this.curPosition())},fi.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&z.test(String.fromCharCode(m)))++this.pos;else break e}}},fi.finishToken=function(m,Y){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var ve=this.type;this.type=m,this.value=Y,this.updateContext(ve)},fi.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var Y=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&Y===46?(this.pos+=3,this.finishToken(h.ellipsis)):(++this.pos,this.finishToken(h.dot))},fi.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(h.assign,2):this.finishOp(h.slash,1)},fi.readToken_mult_modulo_exp=function(m){var Y=this.input.charCodeAt(this.pos+1),ve=1,ne=m===42?h.star:h.modulo;return this.options.ecmaVersion>=7&&m===42&&Y===42&&(++ve,ne=h.starstar,Y=this.input.charCodeAt(this.pos+2)),Y===61?this.finishOp(h.assign,ve+1):this.finishOp(ne,ve)},fi.readToken_pipe_amp=function(m){var Y=this.input.charCodeAt(this.pos+1);if(Y===m){if(this.options.ecmaVersion>=12){var ve=this.input.charCodeAt(this.pos+2);if(ve===61)return this.finishOp(h.assign,3)}return this.finishOp(m===124?h.logicalOR:h.logicalAND,2)}return Y===61?this.finishOp(h.assign,2):this.finishOp(m===124?h.bitwiseOR:h.bitwiseAND,1)},fi.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(h.assign,2):this.finishOp(h.bitwiseXOR,1)},fi.readToken_plus_min=function(m){var Y=this.input.charCodeAt(this.pos+1);return Y===m?Y===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||S.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(h.incDec,2):Y===61?this.finishOp(h.assign,2):this.finishOp(h.plusMin,1)},fi.readToken_lt_gt=function(m){var Y=this.input.charCodeAt(this.pos+1),ve=1;return Y===m?(ve=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+ve)===61?this.finishOp(h.assign,ve+1):this.finishOp(h.bitShift,ve)):Y===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(Y===61&&(ve=2),this.finishOp(h.relational,ve))},fi.readToken_eq_excl=function(m){var Y=this.input.charCodeAt(this.pos+1);return Y===61?this.finishOp(h.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&Y===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(h.arrow)):this.finishOp(m===61?h.eq:h.prefix,1)},fi.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var Y=this.input.charCodeAt(this.pos+1);if(Y===46){var ve=this.input.charCodeAt(this.pos+2);if(ve<48||ve>57)return this.finishOp(h.questionDot,2)}if(Y===63){if(m>=12){var ne=this.input.charCodeAt(this.pos+2);if(ne===61)return this.finishOp(h.assign,3)}return this.finishOp(h.coalesce,2)}}return this.finishOp(h.question,1)},fi.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(h.parenL);case 41:return++this.pos,this.finishToken(h.parenR);case 59:return++this.pos,this.finishToken(h.semi);case 44:return++this.pos,this.finishToken(h.comma);case 91:return++this.pos,this.finishToken(h.bracketL);case 93:return++this.pos,this.finishToken(h.bracketR);case 123:return++this.pos,this.finishToken(h.braceL);case 125:return++this.pos,this.finishToken(h.braceR);case 58:return++this.pos,this.finishToken(h.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(h.backQuote);case 48:var Y=this.input.charCodeAt(this.pos+1);if(Y===120||Y===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(Y===111||Y===79)return this.readRadixNumber(8);if(Y===98||Y===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(h.prefix,1)}this.raise(this.pos,"Unexpected character '"+Pi(m)+"'")},fi.finishOp=function(m,Y){var ve=this.input.slice(this.pos,this.pos+Y);return this.pos+=Y,this.finishToken(m,ve)},fi.readRegexp=function(){for(var m,Y,ve=this.pos;;){this.pos>=this.input.length&&this.raise(ve,"Unterminated regular expression");var ne=this.input.charAt(this.pos);if(S.test(ne)&&this.raise(ve,"Unterminated regular expression"),m)m=!1;else{if(ne==="[")Y=!0;else if(ne==="]"&&Y)Y=!1;else if(ne==="/"&&!Y)break;m=ne==="\\"}++this.pos}var Fe=this.input.slice(ve,this.pos);++this.pos;var et=this.pos,Lt=this.readWord1();this.containsEsc&&this.unexpected(et);var Kt=this.regexpState||(this.regexpState=new ur(this));Kt.reset(ve,Fe,Lt),this.validateRegExpFlags(Kt),this.validateRegExpPattern(Kt);var Gt=null;try{Gt=new RegExp(Fe,Lt)}catch(Fr){}return this.finishToken(h.regexp,{pattern:Fe,flags:Lt,value:Gt})},fi.readInt=function(m,Y,ve){for(var ne=this.options.ecmaVersion>=12&&Y===void 0,Fe=ve&&this.input.charCodeAt(this.pos)===48,et=this.pos,Lt=0,Kt=0,Gt=0,Fr=Y==null?Infinity:Y;Gt<Fr;++Gt,++this.pos){var Vr=this.input.charCodeAt(this.pos),Zn=void 0;if(ne&&Vr===95){Fe&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Kt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Gt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Kt=Vr;continue}if(Vr>=97?Zn=Vr-97+10:Vr>=65?Zn=Vr-65+10:Vr>=48&&Vr<=57?Zn=Vr-48:Zn=Infinity,Zn>=m)break;Kt=Vr,Lt=Lt*m+Zn}return ne&&Kt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===et||Y!=null&&this.pos-et!==Y?null:Lt};function Wi(m,Y){return Y?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function va(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}fi.readRadixNumber=function(m){var Y=this.pos;this.pos+=2;var ve=this.readInt(m);return ve==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(ve=va(this.input.slice(Y,this.pos)),++this.pos):j(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(h.num,ve)},fi.readNumber=function(m){var Y=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(Y,"Invalid number");var ve=this.pos-Y>=2&&this.input.charCodeAt(Y)===48;ve&&this.strict&&this.raise(Y,"Invalid number");var ne=this.input.charCodeAt(this.pos);if(!ve&&!m&&this.options.ecmaVersion>=11&&ne===110){var Fe=va(this.input.slice(Y,this.pos));return++this.pos,j(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(h.num,Fe)}ve&&/[89]/.test(this.input.slice(Y,this.pos))&&(ve=!1),ne===46&&!ve&&(++this.pos,this.readInt(10),ne=this.input.charCodeAt(this.pos)),(ne===69||ne===101)&&!ve&&(ne=this.input.charCodeAt(++this.pos),(ne===43||ne===45)&&++this.pos,this.readInt(10)===null&&this.raise(Y,"Invalid number")),j(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var et=Wi(this.input.slice(Y,this.pos),ve);return this.finishToken(h.num,et)},fi.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),Y;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var ve=++this.pos;Y=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,Y>1114111&&this.invalidStringToken(ve,"Code point out of bounds")}else Y=this.readHexChar(4);return Y};function Pi(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}fi.readString=function(m){for(var Y="",ve=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var ne=this.input.charCodeAt(this.pos);if(ne===m)break;ne===92?(Y+=this.input.slice(ve,this.pos),Y+=this.readEscapedChar(!1),ve=this.pos):(x(ne,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return Y+=this.input.slice(ve,this.pos++),this.finishToken(h.string,Y)};var hi={};fi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===hi)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},fi.invalidStringToken=function(m,Y){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw hi;this.raise(m,Y)},fi.readTmplToken=function(){for(var m="",Y=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var ve=this.input.charCodeAt(this.pos);if(ve===96||ve===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===h.template||this.type===h.invalidTemplate)?ve===36?(this.pos+=2,this.finishToken(h.dollarBraceL)):(++this.pos,this.finishToken(h.backQuote)):(m+=this.input.slice(Y,this.pos),this.finishToken(h.template,m));if(ve===92)m+=this.input.slice(Y,this.pos),m+=this.readEscapedChar(!0),Y=this.pos;else if(x(ve)){switch(m+=this.input.slice(Y,this.pos),++this.pos,ve){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(ve);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),Y=this.pos}else++this.pos}},fi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(h.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},fi.readEscapedChar=function(m){var Y=this.input.charCodeAt(++this.pos);switch(++this.pos,Y){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Pi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var ve=this.pos-1;return this.invalidStringToken(ve,"Invalid escape sequence in template string"),null}default:if(Y>=48&&Y<=55){var ne=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Fe=parseInt(ne,8);return Fe>255&&(ne=ne.slice(0,-1),Fe=parseInt(ne,8)),this.pos+=ne.length-1,Y=this.input.charCodeAt(this.pos),(ne!=="0"||Y===56||Y===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-ne.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Fe)}return x(Y)?"":String.fromCharCode(Y)}},fi.readHexChar=function(m){var Y=this.pos,ve=this.readInt(16,m);return ve===null&&this.invalidStringToken(Y,"Bad character escape sequence"),ve},fi.readWord1=function(){this.containsEsc=!1;for(var m="",Y=!0,ve=this.pos,ne=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Fe=this.fullCharCodeAtPos();if(U(Fe,ne))this.pos+=Fe<=65535?1:2;else if(Fe===92){this.containsEsc=!0,m+=this.input.slice(ve,this.pos);var et=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Lt=this.readCodePoint();(Y?j:U)(Lt,ne)||this.invalidStringToken(et,"Invalid Unicode escape"),m+=Pi(Lt),ve=this.pos}else break;Y=!1}return m+this.input.slice(ve,this.pos)},fi.readWord=function(){var m=this.readWord1(),Y=h.name;return this.keywords.test(m)&&(Y=y[m]),this.finishToken(Y,m)};var Ii="7.4.1";$e.acorn={Parser:$e,version:Ii,defaultOptions:ie,Position:H,SourceLocation:ae,getLineInfo:G,Node:Rn,TokenType:I,tokTypes:h,keywordTypes:y,TokContext:ji,tokContexts:Si,isIdentifierChar:U,isIdentifierStart:j,Token:ui,isNewLine:x,lineBreak:S,lineBreakG:A,nonASCIIwhitespace:z};function La(m,Y){return $e.parse(m,Y)}function ls(m,Y,ve){return $e.parseExpressionAt(m,Y,ve)}function Ta(m,Y){return $e.tokenizer(m,Y)}function ma(m,Y){m.prototype=Object.create(Y.prototype),m.prototype.constructor=m,m.__proto__=Y}function Qo(m){var Y=typeof Map=="function"?new Map:void 0;return Qo=function(ne){if(ne===null||!to(ne))return ne;if(typeof ne!="function")throw new TypeError("Super expression must either be null or a function");if(typeof Y!="undefined"){if(Y.has(ne))return Y.get(ne);Y.set(ne,Fe)}function Fe(){return sa(ne,arguments,wa(this).constructor)}return Fe.prototype=Object.create(ne.prototype,{constructor:{value:Fe,enumerable:!1,writable:!0,configurable:!0}}),_a(Fe,ne)},Qo(m)}function Es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function sa(m,Y,ve){return Es()?sa=Reflect.construct:sa=function(Fe,et,Lt){var Kt=[null];Kt.push.apply(Kt,et);var Gt=Function.bind.apply(Fe,Kt),Fr=new Gt;return Lt&&_a(Fr,Lt.prototype),Fr},sa.apply(null,arguments)}function to(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function _a(m,Y){return _a=Object.setPrototypeOf||function(ne,Fe){return ne.__proto__=Fe,ne},_a(m,Y)}function wa(m){return wa=Object.setPrototypeOf?Object.getPrototypeOf:function(ve){return ve.__proto__||Object.getPrototypeOf(ve)},wa(m)}var $a=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(Qo(Error)),ia=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(Qo(SyntaxError)),Ja=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(Qo(ReferenceError)),ro=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(Qo(TypeError)),Xa=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}($a),no=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(ia),go=function(m){ma(Y,m);function Y(){return m.apply(this,arguments)||this}return Y}(Ja),fa={UnknownError:[3001,"%0",Xa],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Xa],NodeTypeSyntaxError:[1001,"Unknown node type: %0",go],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",go],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",go],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",go],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",go],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",go],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",go],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",go],ParamTypeSyntaxError:[1009,"Unknown param type: %0",go],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",go],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ja],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ja],IsNotConstructor:[2003,"%0 is not a constructor",ro]};function ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Qa(m,Y,ve){return ja()?Qa=Reflect.construct:Qa=function(Fe,et,Lt){var Kt=[null];Kt.push.apply(Kt,et);var Gt=Function.bind.apply(Fe,Kt),Fr=new Gt;return Lt&&Ua(Fr,Lt.prototype),Fr},Qa.apply(null,arguments)}function Ua(m,Y){return Ua=Object.setPrototypeOf||function(ne,Fe){return ne.__proto__=Fe,ne},Ua(m,Y)}var Ve="0.0.2";function rt(m,Y){Object.defineProperty(m,"name",{value:Y,writable:!1,enumerable:!1,configurable:!0})}var wt=Object.prototype.hasOwnProperty,lr=Symbol("Break"),Zr=Symbol("Continue"),Un=Symbol("DefaultCase"),oi=Symbol("EmptyStatementReturn"),te=Symbol("WithScopeName"),be=Symbol("SuperScopeName"),tt=Symbol("RootScopeName"),yt=Symbol("GlobalScopeName");function Bt(m){return typeof m=="function"}var qt=function(){function m(ve){this.interpreter=ve}var Y=m.prototype;return Y.generator=function(){var ne=this.interpreter;function Fe(){return this.getCurrentScope()}function et(){return this.getGlobalScope()}function Lt(){return this.getCurrentContext()}return{getOptions:ne.getOptions.bind(ne),getCurrentScope:Fe.bind(ne),getGlobalScope:et.bind(ne),getCurrentContext:Lt.bind(ne),getExecStartTime:ne.getExecStartTime.bind(ne)}},m}();function Wt(m,Y,ve){if(ve===void 0&&(ve=!0),!(m instanceof qt))throw new Error("Illegal call");if(typeof Y!="string")return Y;if(!!Y){var ne=m.generator(),Fe=ne.getOptions(),et={timeout:Fe.timeout,_initEnv:function(){ve||this.setCurrentContext(ne.getCurrentContext()),this.execStartTime=ne.getExecStartTime(),this.execEndTime=this.execStartTime}},Lt=ve?ne.getGlobalScope():ne.getCurrentScope(),Kt=new bn(Lt,et);return Kt.evaluate(Y)}}Object.defineProperty(Wt,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function or(m){if(!(m instanceof qt))throw new Error("Illegal call");for(var Y=m.generator(),ve=arguments.length,ne=new Array(ve>1?ve-1:0),Fe=1;Fe<ve;Fe++)ne[Fe-1]=arguments[Fe];var et=ne.pop(),Lt=new bn(Y.getGlobalScope(),Y.getOptions()),Kt=`
		    (function anonymous(`+ne.join(",")+`){
		        `+et+`
		    });
		    `;return Lt.evaluate(Kt)}Object.defineProperty(or,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var ar=function(Y){this.value=Y},kr=function(Y){this.value=Y},we=function(Y){this.value=Y},je=function(Y,ve,ne){ve===void 0&&(ve=null),this.name=ne,this.parent=ve,this.data=Y,this.labelStack=[]};function Ue(){}function ut(m,Y){return m===void 0&&(m=null),new je(Object.create(null),m,Y)}function Xt(m){return Object.create(m)}var Mr={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Wt,Function:or};typeof JSON!="undefined"&&(Mr.JSON=JSON),typeof Promise!="undefined"&&(Mr.Promise=Promise),typeof Set!="undefined"&&(Mr.Set=Set),typeof Map!="undefined"&&(Mr.Map=Map),typeof Symbol!="undefined"&&(Mr.Symbol=Symbol),typeof Proxy!="undefined"&&(Mr.Proxy=Proxy),typeof WeakMap!="undefined"&&(Mr.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Mr.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Mr.Reflect=Reflect);var bn=function(){function m(ve,ne){ve===void 0&&(ve=m.global),ne===void 0&&(ne={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:ne.ecmaVersion||m.ecmaVersion,timeout:ne.timeout||0,rootContext:ne.rootContext,globalContextInFunction:ne.globalContextInFunction===void 0?m.globalContextInFunction:ne.globalContextInFunction,_initEnv:ne._initEnv},this.context=ve||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var Y=m.prototype;return Y.initEnvironment=function(ne){var Fe;if(ne instanceof je)Fe=ne;else{var et=null,Lt=this.createSuperScope(ne);this.options.rootContext&&(et=new je(Xt(this.options.rootContext),Lt,tt)),Fe=new je(ne,et||Lt,yt)}this.globalScope=Fe,this.currentScope=this.globalScope,this.globalContext=Fe.data,this.currentContext=Fe.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Kt=this.options._initEnv;Kt&&Kt.call(this)},Y.getExecStartTime=function(){return this.execStartTime},Y.getExecutionTime=function(){return this.execEndTime-this.execStartTime},Y.setExecTimeout=function(ne){ne===void 0&&(ne=0),this.options.timeout=ne},Y.getOptions=function(){return this.options},Y.getGlobalScope=function(){return this.globalScope},Y.getCurrentScope=function(){return this.currentScope},Y.getCurrentContext=function(){return this.currentContext},Y.isInterruptThrow=function(ne){return ne instanceof Xa||ne instanceof go||ne instanceof no},Y.createSuperScope=function(ne){var Fe=Object.assign({},Mr),et=Object.keys(Fe);return et.forEach(function(Lt){Lt in ne&&delete Fe[Lt]}),new je(Fe,null,be)},Y.setCurrentContext=function(ne){this.currentContext=ne},Y.setCurrentScope=function(ne){this.currentScope=ne},Y.evaluate=function(ne){ne===void 0&&(ne="");var Fe;if(!!ne)return Fe=La(ne,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(Fe,ne)},Y.appendCode=function(ne){return this.evaluate(ne)},Y.evaluateNode=function(ne,Fe){var et=this;Fe===void 0&&(Fe=""),this.value=void 0,this.source=Fe,this.sourceList.push(Fe),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Lt=this.getCurrentScope(),Kt=this.getCurrentContext(),Gt=Lt.labelStack.concat([]),Fr=this.callStack.concat([]),Vr=function(){et.setCurrentScope(Lt),et.setCurrentContext(Kt),Lt.labelStack=Gt,et.callStack=Fr};try{var Zn=this.createClosure(ne);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Zn()}catch(Ri){throw Ri}finally{Vr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},Y.createErrorMessage=function(ne,Fe,et){var Lt=ne[1].replace("%0",String(Fe));return et!==null&&(Lt+=this.getNodePosition(et||this.lastExecNode)),Lt},Y.createError=function(ne,Fe){return new Fe(ne)},Y.createThrowError=function(ne,Fe){return this.createError(ne,Fe)},Y.createInternalThrowError=function(ne,Fe,et){return this.createError(this.createErrorMessage(ne,Fe,et),ne[2])},Y.checkTimeout=function(){if(!this.isRunning)return!1;var ne=this.options.timeout||0,Fe=Date.now();return Fe-this.execStartTime>ne},Y.getNodePosition=function(ne){if(ne){var Fe="";return ne.loc?" ["+ne.loc.start.line+":"+ne.loc.start.column+"]"+Fe:""}return""},Y.createClosure=function(ne){var Fe=this,et;switch(ne.type){case"BinaryExpression":et=this.binaryExpressionHandler(ne);break;case"LogicalExpression":et=this.logicalExpressionHandler(ne);break;case"UnaryExpression":et=this.unaryExpressionHandler(ne);break;case"UpdateExpression":et=this.updateExpressionHandler(ne);break;case"ObjectExpression":et=this.objectExpressionHandler(ne);break;case"ArrayExpression":et=this.arrayExpressionHandler(ne);break;case"CallExpression":et=this.callExpressionHandler(ne);break;case"NewExpression":et=this.newExpressionHandler(ne);break;case"MemberExpression":et=this.memberExpressionHandler(ne);break;case"ThisExpression":et=this.thisExpressionHandler(ne);break;case"SequenceExpression":et=this.sequenceExpressionHandler(ne);break;case"Literal":et=this.literalHandler(ne);break;case"Identifier":et=this.identifierHandler(ne);break;case"AssignmentExpression":et=this.assignmentExpressionHandler(ne);break;case"FunctionDeclaration":et=this.functionDeclarationHandler(ne);break;case"VariableDeclaration":et=this.variableDeclarationHandler(ne);break;case"BlockStatement":case"Program":et=this.programHandler(ne);break;case"ExpressionStatement":et=this.expressionStatementHandler(ne);break;case"EmptyStatement":et=this.emptyStatementHandler(ne);break;case"ReturnStatement":et=this.returnStatementHandler(ne);break;case"FunctionExpression":et=this.functionExpressionHandler(ne);break;case"IfStatement":et=this.ifStatementHandler(ne);break;case"ConditionalExpression":et=this.conditionalExpressionHandler(ne);break;case"ForStatement":et=this.forStatementHandler(ne);break;case"WhileStatement":et=this.whileStatementHandler(ne);break;case"DoWhileStatement":et=this.doWhileStatementHandler(ne);break;case"ForInStatement":et=this.forInStatementHandler(ne);break;case"WithStatement":et=this.withStatementHandler(ne);break;case"ThrowStatement":et=this.throwStatementHandler(ne);break;case"TryStatement":et=this.tryStatementHandler(ne);break;case"ContinueStatement":et=this.continueStatementHandler(ne);break;case"BreakStatement":et=this.breakStatementHandler(ne);break;case"SwitchStatement":et=this.switchStatementHandler(ne);break;case"LabeledStatement":et=this.labeledStatementHandler(ne);break;case"DebuggerStatement":et=this.debuggerStatementHandler(ne);break;default:throw this.createInternalThrowError(fa.NodeTypeSyntaxError,ne.type,ne)}return function(){var Lt=Fe.options.timeout;if(Lt&&Lt>0&&Fe.checkTimeout())throw Fe.createInternalThrowError(fa.ExecutionTimeOutError,Lt,null);return Fe.lastExecNode=ne,et.apply(void 0,arguments)}},Y.binaryExpressionHandler=function(ne){var Fe=this,et=this.createClosure(ne.left),Lt=this.createClosure(ne.right);return function(){var Kt=et(),Gt=Lt();switch(ne.operator){case"==":return Kt==Gt;case"!=":return Kt!=Gt;case"===":return Kt===Gt;case"!==":return Kt!==Gt;case"<":return Kt<Gt;case"<=":return Kt<=Gt;case">":return Kt>Gt;case">=":return Kt>=Gt;case"<<":return Kt<<Gt;case">>":return Kt>>Gt;case">>>":return Kt>>>Gt;case"+":return Kt+Gt;case"-":return Kt-Gt;case"*":return Kt*Gt;case"**":return Math.pow(Kt,Gt);case"/":return Kt/Gt;case"%":return Kt%Gt;case"|":return Kt|Gt;case"^":return Kt^Gt;case"&":return Kt&Gt;case"in":return Kt in Gt;case"instanceof":return Kt instanceof Gt;default:throw Fe.createInternalThrowError(fa.BinaryOperatorSyntaxError,ne.operator,ne)}}},Y.logicalExpressionHandler=function(ne){var Fe=this,et=this.createClosure(ne.left),Lt=this.createClosure(ne.right);return function(){switch(ne.operator){case"||":return et()||Lt();case"&&":return et()&&Lt();default:throw Fe.createInternalThrowError(fa.LogicalOperatorSyntaxError,ne.operator,ne)}}},Y.unaryExpressionHandler=function(ne){var Fe=this;switch(ne.operator){case"delete":var et=this.createObjectGetter(ne.argument),Lt=this.createNameGetter(ne.argument);return function(){var Vr=et(),Zn=Lt();return delete Vr[Zn]};default:var Kt;if(ne.operator==="typeof"&&ne.argument.type==="Identifier"){var Gt=this.createObjectGetter(ne.argument),Fr=this.createNameGetter(ne.argument);Kt=function(){return Gt()[Fr()]}}else Kt=this.createClosure(ne.argument);return function(){var Vr=Kt();switch(ne.operator){case"-":return-Vr;case"+":return+Vr;case"!":return!Vr;case"~":return~Vr;case"void":return;case"typeof":return typeof Vr;default:throw Fe.createInternalThrowError(fa.UnaryOperatorSyntaxError,ne.operator,ne)}}}},Y.updateExpressionHandler=function(ne){var Fe=this,et=this.createObjectGetter(ne.argument),Lt=this.createNameGetter(ne.argument);return function(){var Kt=et(),Gt=Lt();switch(Fe.assertVariable(Kt,Gt,ne),ne.operator){case"++":return ne.prefix?++Kt[Gt]:Kt[Gt]++;case"--":return ne.prefix?--Kt[Gt]:Kt[Gt]--;default:throw Fe.createInternalThrowError(fa.UpdateOperatorSyntaxError,ne.operator,ne)}}},Y.objectExpressionHandler=function(ne){var Fe=this,et=[];function Lt(Gt){return Gt.type==="Identifier"?Gt.name:Gt.type==="Literal"?Gt.value:this.throwError(fa.ObjectStructureSyntaxError,Gt.type,Gt)}var Kt=Object.create(null);return ne.properties.forEach(function(Gt){var Fr=Gt.kind,Vr=Lt(Gt.key);(!Kt[Vr]||Fr==="init")&&(Kt[Vr]={}),Kt[Vr][Fr]=Fe.createClosure(Gt.value),et.push({key:Vr,property:Gt})}),function(){for(var Gt={},Fr=et.length,Vr=0;Vr<Fr;Vr++){var Zn=et[Vr],Ri=Zn.key,ti=Kt[Ri],ha=ti.init?ti.init():void 0,ua=ti.get?ti.get():function(){},Ga=ti.set?ti.set():function(Qs){};if("set"in ti||"get"in ti){var Vi={configurable:!0,enumerable:!0,get:ua,set:Ga};Object.defineProperty(Gt,Ri,Vi)}else{var Cs=Zn.property,Gs=Cs.kind;Cs.key.type==="Identifier"&&Cs.value.type==="FunctionExpression"&&Gs==="init"&&!Cs.value.id&&rt(ha,Cs.key.name),Gt[Ri]=ha}}return Gt}},Y.arrayExpressionHandler=function(ne){var Fe=this,et=ne.elements.map(function(Lt){return Lt&&Fe.createClosure(Lt)});return function(){for(var Lt=et.length,Kt=Array(Lt),Gt=0;Gt<Lt;Gt++){var Fr=et[Gt];Fr&&(Kt[Gt]=Fr())}return Kt}},Y.safeObjectGet=function(ne,Fe,et){return ne[Fe]},Y.createCallFunctionGetter=function(ne){var Fe=this;switch(ne.type){case"MemberExpression":var et=this.createClosure(ne.object),Lt=this.createMemberKeyGetter(ne),Kt=this.source;return function(){var Fr=et(),Vr=Lt(),Zn=Fe.safeObjectGet(Fr,Vr,ne);if(!Zn||!Bt(Zn)){var Ri=Kt.slice(ne.start,ne.end);throw Fe.createInternalThrowError(fa.FunctionUndefinedReferenceError,Ri,ne)}return Zn.__IS_EVAL_FUNC?function(ti){return Zn(new qt(Fe),ti,!0)}:Zn.__IS_FUNCTION_FUNC?function(){for(var ti=arguments.length,ha=new Array(ti),ua=0;ua<ti;ua++)ha[ua]=arguments[ua];return Zn.apply(void 0,[new qt(Fe)].concat(ha))}:Zn.bind(Fr)};default:var Gt=this.createClosure(ne);return function(){var Fr="";ne.type==="Identifier"&&(Fr=ne.name);var Vr=Gt();if(!Vr||!Bt(Vr))throw Fe.createInternalThrowError(fa.FunctionUndefinedReferenceError,Fr,ne);if(ne.type==="Identifier"&&Vr.__IS_EVAL_FUNC&&Fr==="eval")return function(ti){var ha=Fe.getScopeFromName(Fr,Fe.getCurrentScope()),ua=ha.name===be||ha.name===yt||ha.name===tt;return Vr(new qt(Fe),ti,!ua)};if(Vr.__IS_EVAL_FUNC)return function(ti){return Vr(new qt(Fe),ti,!0)};if(Vr.__IS_FUNCTION_FUNC)return function(){for(var ti=arguments.length,ha=new Array(ti),ua=0;ua<ti;ua++)ha[ua]=arguments[ua];return Vr.apply(void 0,[new qt(Fe)].concat(ha))};var Zn=Fe.options.globalContextInFunction;if(ne.type==="Identifier"){var Ri=Fe.getIdentifierScope(ne);Ri.name===te&&(Zn=Ri.data)}return Vr.bind(Zn)}}},Y.callExpressionHandler=function(ne){var Fe=this,et=this.createCallFunctionGetter(ne.callee),Lt=ne.arguments.map(function(Kt){return Fe.createClosure(Kt)});return function(){return et().apply(void 0,Lt.map(function(Kt){return Kt()}))}},Y.functionExpressionHandler=function(ne){var Fe=this,et=this,Lt=this.source,Kt=this.collectDeclVars,Gt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Fr=ne.id?ne.id.name:"",Vr=ne.params.length,Zn=ne.params.map(function(ua){return Fe.createParamNameGetter(ua)}),Ri=this.createClosure(ne.body),ti=this.collectDeclVars,ha=this.collectDeclFuncs;return this.collectDeclVars=Kt,this.collectDeclFuncs=Gt,function(){var ua=et.getCurrentScope(),Ga=function Vi(){for(var Cs=arguments.length,Gs=new Array(Cs),Qs=0;Qs<Cs;Qs++)Gs[Qs]=arguments[Qs];et.callStack.push(""+Fr);var ll=et.getCurrentScope(),Hs=ut(ua,"FunctionScope("+Fr+")");et.setCurrentScope(Hs),et.addDeclarationsToScope(ti,ha,Hs),Fr&&(Hs.data[Fr]=Vi),Hs.data.arguments=arguments,Zn.forEach(function(Os,Ra){Hs.data[Os()]=Gs[Ra]});var Vu=et.getCurrentContext();et.setCurrentContext(this);var ks=Ri();if(et.setCurrentContext(Vu),et.setCurrentScope(ll),et.callStack.pop(),ks instanceof ar)return ks.value};return rt(Ga,Fr),Object.defineProperty(Ga,"length",{value:Vr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ga,"toString",{value:function(){return Lt.slice(ne.start,ne.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ga,"valueOf",{value:function(){return Lt.slice(ne.start,ne.end)},writable:!0,configurable:!0,enumerable:!1}),Ga}},Y.newExpressionHandler=function(ne){var Fe=this,et=this.source,Lt=this.createClosure(ne.callee),Kt=ne.arguments.map(function(Gt){return Fe.createClosure(Gt)});return function(){var Gt=Lt();if(!Bt(Gt)||Gt.__IS_EVAL_FUNC){var Fr=ne.callee,Vr=et.slice(Fr.start,Fr.end);throw Fe.createInternalThrowError(fa.IsNotConstructor,Vr,ne)}return Gt.__IS_FUNCTION_FUNC?Gt.apply(void 0,[new qt(Fe)].concat(Kt.map(function(Zn){return Zn()}))):Qa(Gt,Kt.map(function(Zn){return Zn()}))}},Y.memberExpressionHandler=function(ne){var Fe=this.createClosure(ne.object),et=this.createMemberKeyGetter(ne);return function(){var Lt=Fe(),Kt=et();return Lt[Kt]}},Y.thisExpressionHandler=function(ne){var Fe=this;return function(){return Fe.getCurrentContext()}},Y.sequenceExpressionHandler=function(ne){var Fe=this,et=ne.expressions.map(function(Lt){return Fe.createClosure(Lt)});return function(){for(var Lt,Kt=et.length,Gt=0;Gt<Kt;Gt++){var Fr=et[Gt];Lt=Fr()}return Lt}},Y.literalHandler=function(ne){return function(){return ne.regex?new RegExp(ne.regex.pattern,ne.regex.flags):ne.value}},Y.identifierHandler=function(ne){var Fe=this;return function(){var et=Fe.getCurrentScope(),Lt=Fe.getScopeDataFromName(ne.name,et);return Fe.assertVariable(Lt,ne.name,ne),Lt[ne.name]}},Y.getIdentifierScope=function(ne){var Fe=this.getCurrentScope(),et=this.getScopeFromName(ne.name,Fe);return et},Y.assignmentExpressionHandler=function(ne){var Fe=this;ne.left.type==="Identifier"&&ne.right.type==="FunctionExpression"&&!ne.right.id&&(ne.right.id={type:"Identifier",name:ne.left.name});var et=this.createObjectGetter(ne.left),Lt=this.createNameGetter(ne.left),Kt=this.createClosure(ne.right);return function(){var Gt=et(),Fr=Lt(),Vr=Kt();switch(ne.operator!=="="&&Fe.assertVariable(Gt,Fr,ne),ne.operator){case"=":return Gt[Fr]=Vr;case"+=":return Gt[Fr]+=Vr;case"-=":return Gt[Fr]-=Vr;case"*=":return Gt[Fr]*=Vr;case"**=":return Gt[Fr]=Math.pow(Gt[Fr],Vr);case"/=":return Gt[Fr]/=Vr;case"%=":return Gt[Fr]%=Vr;case"<<=":return Gt[Fr]<<=Vr;case">>=":return Gt[Fr]>>=Vr;case">>>=":return Gt[Fr]>>>=Vr;case"&=":return Gt[Fr]&=Vr;case"^=":return Gt[Fr]^=Vr;case"|=":return Gt[Fr]|=Vr;default:throw Fe.createInternalThrowError(fa.AssignmentExpressionSyntaxError,ne.type,ne)}}},Y.functionDeclarationHandler=function(ne){if(ne.id){var Fe=this.functionExpressionHandler(ne);Object.defineProperty(Fe,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(ne.id.name,Fe)}return function(){return oi}},Y.getVariableName=function(ne){if(ne.type==="Identifier")return ne.name;throw this.createInternalThrowError(fa.VariableTypeSyntaxError,ne.type,ne)},Y.variableDeclarationHandler=function(ne){for(var Fe=this,et,Lt=[],Kt=0;Kt<ne.declarations.length;Kt++){var Gt=ne.declarations[Kt];this.varDeclaration(this.getVariableName(Gt.id)),Gt.init&&Lt.push({type:"AssignmentExpression",operator:"=",left:Gt.id,right:Gt.init})}return Lt.length&&(et=this.createClosure({type:"BlockStatement",body:Lt})),function(){if(et){var Fr=Fe.isVarDeclMode;Fe.isVarDeclMode=!0,et(),Fe.isVarDeclMode=Fr}return oi}},Y.assertVariable=function(ne,Fe,et){if(ne===this.globalScope.data&&!(Fe in ne))throw this.createInternalThrowError(fa.VariableUndefinedReferenceError,Fe,et)},Y.programHandler=function(ne){var Fe=this,et=ne.body.map(function(Lt){return Fe.createClosure(Lt)});return function(){for(var Lt=oi,Kt=0;Kt<et.length;Kt++){var Gt=et[Kt],Fr=Fe.setValue(Gt());if(Fr!==oi&&(Lt=Fr,Lt instanceof ar||Lt instanceof kr||Lt instanceof we||Lt===lr||Lt===Zr))break}return Lt}},Y.expressionStatementHandler=function(ne){return this.createClosure(ne.expression)},Y.emptyStatementHandler=function(ne){return function(){return oi}},Y.returnStatementHandler=function(ne){var Fe=ne.argument?this.createClosure(ne.argument):Ue;return function(){return new ar(Fe())}},Y.ifStatementHandler=function(ne){var Fe=this.createClosure(ne.test),et=this.createClosure(ne.consequent),Lt=ne.alternate?this.createClosure(ne.alternate):function(){return oi};return function(){return Fe()?et():Lt()}},Y.conditionalExpressionHandler=function(ne){return this.ifStatementHandler(ne)},Y.forStatementHandler=function(ne){var Fe=this,et=Ue,Lt=ne.test?this.createClosure(ne.test):function(){return!0},Kt=Ue,Gt=this.createClosure(ne.body);return ne.type==="ForStatement"&&(et=ne.init?this.createClosure(ne.init):et,Kt=ne.update?this.createClosure(ne.update):Ue),function(Fr){var Vr,Zn=oi,Ri=ne.type==="DoWhileStatement";for(Fr&&Fr.type==="LabeledStatement"&&(Vr=Fr.label.name),et();Ri||Lt();Kt()){Ri=!1;var ti=Fe.setValue(Gt());if(!(ti===oi||ti===Zr)){if(ti===lr)break;if(Zn=ti,Zn instanceof we&&Zn.value===Vr){Zn=oi;continue}if(Zn instanceof ar||Zn instanceof kr||Zn instanceof we)break}}return Zn}},Y.whileStatementHandler=function(ne){return this.forStatementHandler(ne)},Y.doWhileStatementHandler=function(ne){return this.forStatementHandler(ne)},Y.forInStatementHandler=function(ne){var Fe=this,et=ne.left,Lt=this.createClosure(ne.right),Kt=this.createClosure(ne.body);return ne.left.type==="VariableDeclaration"&&(this.createClosure(ne.left)(),et=ne.left.declarations[0].id),function(Gt){var Fr,Vr=oi,Zn;Gt&&Gt.type==="LabeledStatement"&&(Fr=Gt.label.name);var Ri=Lt();for(Zn in Ri){Fe.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:et,right:{type:"Literal",value:Zn}})();var ti=Fe.setValue(Kt());if(!(ti===oi||ti===Zr)){if(ti===lr)break;if(Vr=ti,Vr instanceof we&&Vr.value===Fr){Vr=oi;continue}if(Vr instanceof ar||Vr instanceof kr||Vr instanceof we)break}}return Vr}},Y.withStatementHandler=function(ne){var Fe=this,et=this.createClosure(ne.object),Lt=this.createClosure(ne.body);return function(){var Kt=et(),Gt=Fe.getCurrentScope(),Fr=new je(Kt,Gt,te);Fe.setCurrentScope(Fr);var Vr=Fe.setValue(Lt());return Fe.setCurrentScope(Gt),Vr}},Y.throwStatementHandler=function(ne){var Fe=this,et=this.createClosure(ne.argument);return function(){throw Fe.setValue(void 0),et()}},Y.tryStatementHandler=function(ne){var Fe=this,et=this.createClosure(ne.block),Lt=ne.handler?this.catchClauseHandler(ne.handler):null,Kt=ne.finalizer?this.createClosure(ne.finalizer):null;return function(){var Gt=Fe.getCurrentScope(),Fr=Fe.getCurrentContext(),Vr=Gt.labelStack.concat([]),Zn=Fe.callStack.concat([]),Ri=oi,ti,ha,ua=function(){Fe.setCurrentScope(Gt),Fe.setCurrentContext(Fr),Gt.labelStack=Vr,Fe.callStack=Zn};try{Ri=Fe.setValue(et()),Ri instanceof ar&&(ti=Ri)}catch(Ga){if(ua(),Fe.isInterruptThrow(Ga))throw Ga;if(Lt)try{Ri=Fe.setValue(Lt(Ga)),Ri instanceof ar&&(ti=Ri)}catch(Vi){if(ua(),Fe.isInterruptThrow(Vi))throw Vi;ha=Vi}}if(Kt)try{Ri=Kt(),Ri instanceof ar&&(ti=Ri)}catch(Ga){if(ua(),Fe.isInterruptThrow(Ga))throw Ga;ha=Ga}if(ha)throw ha;return ti||Ri}},Y.catchClauseHandler=function(ne){var Fe=this,et=this.createParamNameGetter(ne.param),Lt=this.createClosure(ne.body);return function(Kt){var Gt,Fr=Fe.getCurrentScope(),Vr=Fr.data,Zn=et(),Ri=wt.call(Vr,Zn),ti=Vr[Zn];return Vr[Zn]=Kt,Gt=Lt(),Ri?Vr[Zn]=ti:delete Vr[Zn],Gt}},Y.continueStatementHandler=function(ne){return function(){return ne.label?new we(ne.label.name):Zr}},Y.breakStatementHandler=function(ne){return function(){return ne.label?new kr(ne.label.name):lr}},Y.switchStatementHandler=function(ne){var Fe=this,et=this.createClosure(ne.discriminant),Lt=ne.cases.map(function(Kt){return Fe.switchCaseHandler(Kt)});return function(){for(var Kt=et(),Gt=!1,Fr,Vr,Zn,Ri=0;Ri<Lt.length;Ri++){var ti=Lt[Ri](),ha=ti.testClosure();if(ha===Un){Zn=ti;continue}if(Gt||ha===Kt){if(Gt=!0,Vr=Fe.setValue(ti.bodyClosure()),Vr===oi)continue;if(Vr===lr||(Fr=Vr,Fr instanceof ar||Fr instanceof kr||Fr instanceof we||Fr===Zr))break}}if(!Gt&&Zn){Vr=Fe.setValue(Zn.bodyClosure());var ua=Vr===oi||Vr===lr||Vr===Zr;ua||(Fr=Vr)}return Fr}},Y.switchCaseHandler=function(ne){var Fe=ne.test?this.createClosure(ne.test):function(){return Un},et=this.createClosure({type:"BlockStatement",body:ne.consequent});return function(){return{testClosure:Fe,bodyClosure:et}}},Y.labeledStatementHandler=function(ne){var Fe=this,et=ne.label.name,Lt=this.createClosure(ne.body);return function(){var Kt,Gt=Fe.getCurrentScope();return Gt.labelStack.push(et),Kt=Lt(ne),Kt instanceof kr&&Kt.value===et&&(Kt=oi),Gt.labelStack.pop(),Kt}},Y.debuggerStatementHandler=function(ne){return function(){debugger;return oi}},Y.createParamNameGetter=function(ne){if(ne.type==="Identifier")return function(){return ne.name};throw this.createInternalThrowError(fa.ParamTypeSyntaxError,ne.type,ne)},Y.createObjectKeyGetter=function(ne){var Fe;return ne.type==="Identifier"?Fe=function(){return ne.name}:Fe=this.createClosure(ne),function(){return Fe()}},Y.createMemberKeyGetter=function(ne){return ne.computed?this.createClosure(ne.property):this.createObjectKeyGetter(ne.property)},Y.createObjectGetter=function(ne){var Fe=this;switch(ne.type){case"Identifier":return function(){return Fe.getScopeDataFromName(ne.name,Fe.getCurrentScope())};case"MemberExpression":return this.createClosure(ne.object);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,ne.type,ne)}},Y.createNameGetter=function(ne){switch(ne.type){case"Identifier":return function(){return ne.name};case"MemberExpression":return this.createMemberKeyGetter(ne);default:throw this.createInternalThrowError(fa.AssignmentTypeSyntaxError,ne.type,ne)}},Y.varDeclaration=function(ne){var Fe=this.collectDeclVars;Fe[ne]=void 0},Y.funcDeclaration=function(ne,Fe){var et=this.collectDeclFuncs;et[ne]=Fe},Y.addDeclarationsToScope=function(ne,Fe,et){var Lt=et.data;for(var Kt in Fe){var Gt=Fe[Kt];Lt[Kt]=Gt&&Gt()}for(var Fr in ne)Fr in Lt||(Lt[Fr]=void 0)},Y.getScopeValue=function(ne,Fe){var et=this.getScopeFromName(ne,Fe);return et.data[ne]},Y.getScopeDataFromName=function(ne,Fe){return this.getScopeFromName(ne,Fe).data},Y.getScopeFromName=function(ne,Fe){var et=Fe;do if(ne in et.data)return et;while(et=et.parent);return this.globalScope},Y.setValue=function(ne){var Fe=this.callStack.length;return this.isVarDeclMode||Fe||ne===oi||ne===lr||ne===Zr||ne instanceof kr||ne instanceof we||(this.value=ne instanceof ar?ne.value:ne),ne},Y.getValue=function(){return this.value},m}();bn.version=Ve,bn.eval=Wt,bn.Function=or,bn.ecmaVersion=5,bn.globalContextInFunction=void 0,bn.global=Object.create(null);function ei(m){return m===void 0&&(m=Object.create(null)),m}function Ci(m,Y,ve){Y===void 0&&(Y=[]),ve===void 0&&(ve={});var ne=ve.parsingContext,Fe=ve.timeout===void 0?0:ve.timeout,et=`
    (function anonymous(`+Y.join(",")+`){
         `+m+`
    });
    `,Lt=new bn(ne,{ecmaVersion:ve.ecmaVersion,timeout:Fe,rootContext:ve.rootContext,globalContextInFunction:ve.globalContextInFunction});return Lt.evaluate(et)}function Xi(m,Y,ve){var ne=new bn(Y,ve);return ne.evaluate(m)}var Fa=Xi,aa=function(){function m(ve){this._code=ve}var Y=m.prototype;return Y.runInContext=function(ne){return Xi(this._code,ne)},Y.runInNewContext=function(ne){return Xi(this._code,ne)},m}(),Oi=function(m,Y,ve){return Xi(m,Y,ve)};function vs(){for(var m=arguments.length,Y=new Array(m),ve=0;ve<m;ve++)Y[ve]=arguments[ve];var ne=Y.pop();return Ci(ne||"",Y)}var Yi=Oi},88307:function(Te,c,n){(function(i,F){Te.exports=F(n(18857))})(this,function(i){"use strict";var F=function(ye){return ye instanceof Uint8Array||ye instanceof Uint16Array||ye instanceof Uint32Array||ye instanceof Int8Array||ye instanceof Int16Array||ye instanceof Int32Array||ye instanceof Float32Array||ye instanceof Float64Array||ye instanceof Uint8ClampedArray},o=function(ye,Qe){for(var Ct=Object.keys(Qe),pr=0;pr<Ct.length;++pr)ye[Ct[pr]]=Qe[Ct[pr]];return ye},w=`
`;function _(ye){return typeof atob!="undefined"?atob(ye):"base64:"+ye}function P(ye){var Qe=new Error("(regl) "+ye);throw console.error(Qe),Qe}function L(ye,Qe){ye||P(Qe)}function d(ye){return ye?": "+ye:""}function E(ye,Qe,Ct){ye in Qe||P("unknown parameter ("+ye+")"+d(Ct)+". possible values: "+Object.keys(Qe).join())}function g(ye,Qe){F(ye)||P("invalid parameter type"+d(Qe)+". must be a typed array")}function k(ye,Qe){switch(Qe){case"number":return typeof ye=="number";case"object":return typeof ye=="object";case"string":return typeof ye=="string";case"boolean":return typeof ye=="boolean";case"function":return typeof ye=="function";case"undefined":return typeof ye=="undefined";case"symbol":return typeof ye=="symbol"}}function M(ye,Qe,Ct){k(ye,Qe)||P("invalid parameter type"+d(Ct)+". expected "+Qe+", got "+typeof ye)}function j(ye,Qe){ye>=0&&(ye|0)===ye||P("invalid parameter type, ("+ye+")"+d(Qe)+". must be a nonnegative integer")}function U(ye,Qe,Ct){Qe.indexOf(ye)<0&&P("invalid value"+d(Ct)+". must be one of: "+Qe)}var I=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function O(ye){Object.keys(ye).forEach(function(Qe){I.indexOf(Qe)<0&&P('invalid regl constructor argument "'+Qe+'". must be one of '+I)})}function D(ye,Qe){for(ye=ye+"";ye.length<Qe;)ye=" "+ye;return ye}function R(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function y(ye,Qe){this.number=ye,this.line=Qe,this.errors=[]}function v(ye,Qe,Ct){this.file=ye,this.line=Qe,this.message=Ct}function h(){var ye=new Error,Qe=(ye.stack||ye).toString(),Ct=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Qe);if(Ct)return Ct[1];var pr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Qe);return pr?pr[1]:"unknown"}function S(){var ye=new Error,Qe=(ye.stack||ye).toString(),Ct=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Qe);if(Ct)return Ct[1];var pr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Qe);return pr?pr[1]:"unknown"}function A(ye,Qe){var Ct=ye.split(`
`),pr=1,Ir=0,dr={unknown:new R,0:new R};dr.unknown.name=dr[0].name=Qe||h(),dr.unknown.lines.push(new y(0,""));for(var Tr=0;Tr<Ct.length;++Tr){var Wr=Ct[Tr],Gr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Wr);if(Gr)switch(Gr[1]){case"line":var en=/(\d+)(\s+\d+)?/.exec(Gr[2]);en&&(pr=en[1]|0,en[2]&&(Ir=en[2]|0,Ir in dr||(dr[Ir]=new R)));break;case"define":var rn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Gr[2]);rn&&(dr[Ir].name=rn[1]?_(rn[2]):rn[2]);break}dr[Ir].lines.push(new y(pr++,Wr))}return Object.keys(dr).forEach(function($r){var ln=dr[$r];ln.lines.forEach(function(Yr){ln.index[Yr.number]=Yr})}),dr}function x(ye){var Qe=[];return ye.split(`
`).forEach(function(Ct){if(!(Ct.length<5)){var pr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ct);pr?Qe.push(new v(pr[1]|0,pr[2]|0,pr[3].trim())):Ct.length>0&&Qe.push(new v("unknown",0,Ct))}}),Qe}function z(ye,Qe){Qe.forEach(function(Ct){var pr=ye[Ct.file];if(pr){var Ir=pr.index[Ct.line];if(Ir){Ir.errors.push(Ct),pr.hasErrors=!0;return}}ye.unknown.hasErrors=!0,ye.unknown.lines[0].errors.push(Ct)})}function B(ye,Qe,Ct,pr,Ir){if(!ye.getShaderParameter(Qe,ye.COMPILE_STATUS)){var dr=ye.getShaderInfoLog(Qe),Tr=pr===ye.FRAGMENT_SHADER?"fragment":"vertex";H(Ct,"string",Tr+" shader source must be a string",Ir);var Wr=A(Ct,Ir),Gr=x(dr);z(Wr,Gr),Object.keys(Wr).forEach(function(en){var rn=Wr[en];if(!rn.hasErrors)return;var $r=[""],ln=[""];function Yr(Qr,$t){$r.push(Qr),ln.push($t||"")}Yr("file number "+en+": "+rn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),rn.lines.forEach(function(Qr){if(Qr.errors.length>0){Yr(D(Qr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Yr(Qr.line+w,"color:red; background-color:yellow; font-weight:bold");var $t=0;Qr.errors.forEach(function(Sr){var Kr=Sr.message,Mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Kr);if(Mn){var Nr=Mn[1];switch(Kr=Mn[2],Nr){case"assign":Nr="=";break}$t=Math.max(Qr.line.indexOf(Nr,$t),0)}else $t=0;Yr(D("| ",6)),Yr(D("^^^",$t+3)+w,"font-weight:bold"),Yr(D("| ",6)),Yr(Kr+w,"font-weight:bold")}),Yr(D("| ",6)+w)}else Yr(D(Qr.number,4)+"|  "),Yr(Qr.line+w,"color:red")}),typeof document!="undefined"&&!window.chrome?(ln[0]=$r.join("%c"),console.log.apply(console,ln)):console.log($r.join(""))}),L.raise("Error compiling "+Tr+" shader, "+Wr[0].name)}}function V(ye,Qe,Ct,pr,Ir){if(!ye.getProgramParameter(Qe,ye.LINK_STATUS)){var dr=ye.getProgramInfoLog(Qe),Tr=A(Ct,Ir),Wr=A(pr,Ir),Gr='Error linking program with vertex shader, "'+Wr[0].name+'", and fragment shader "'+Tr[0].name+'"';typeof document!="undefined"?console.log("%c"+Gr+w+"%c"+dr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Gr+w+dr),L.raise(Gr)}}function Q(ye){ye._commandRef=h()}function oe(ye,Qe,Ct,pr){Q(ye);function Ir(Gr){return Gr?pr.id(Gr):0}ye._fragId=Ir(ye.static.frag),ye._vertId=Ir(ye.static.vert);function dr(Gr,en){Object.keys(en).forEach(function(rn){Gr[pr.id(rn)]=!0})}var Tr=ye._uniformSet={};dr(Tr,Qe.static),dr(Tr,Qe.dynamic);var Wr=ye._attributeSet={};dr(Wr,Ct.static),dr(Wr,Ct.dynamic),ye._hasCount="count"in ye.static||"count"in ye.dynamic||"elements"in ye.static||"elements"in ye.dynamic}function re(ye,Qe){var Ct=S();P(ye+" in command "+(Qe||h())+(Ct==="unknown"?"":" called from "+Ct))}function Z(ye,Qe,Ct){ye||re(Qe,Ct||h())}function ee(ye,Qe,Ct,pr){ye in Qe||re("unknown parameter ("+ye+")"+d(Ct)+". possible values: "+Object.keys(Qe).join(),pr||h())}function H(ye,Qe,Ct,pr){k(ye,Qe)||re("invalid parameter type"+d(Ct)+". expected "+Qe+", got "+typeof ye,pr||h())}function ae(ye){ye()}function G(ye,Qe,Ct){ye.texture?U(ye.texture._texture.internalformat,Qe,"unsupported texture format for attachment"):U(ye.renderbuffer._renderbuffer.format,Ct,"unsupported renderbuffer format for attachment")}var ie=33071,le=9728,Me=9984,ge=9985,pe=9986,Ne=9987,Re=5120,he=5121,se=5122,J=5123,fe=5124,me=5125,Le=5126,C=32819,X=32820,de=33635,Ae=34042,De=36193,Ge={};Ge[Re]=Ge[he]=1,Ge[se]=Ge[J]=Ge[De]=Ge[de]=Ge[C]=Ge[X]=2,Ge[fe]=Ge[me]=Ge[Le]=Ge[Ae]=4;function $e(ye,Qe){return ye===X||ye===C||ye===de?2:ye===Ae?4:Ge[ye]*Qe}function ct(ye){return!(ye&ye-1)&&!!ye}function gt(ye,Qe,Ct){var pr,Ir=Qe.width,dr=Qe.height,Tr=Qe.channels;L(Ir>0&&Ir<=Ct.maxTextureSize&&dr>0&&dr<=Ct.maxTextureSize,"invalid texture shape"),(ye.wrapS!==ie||ye.wrapT!==ie)&&L(ct(Ir)&&ct(dr),"incompatible wrap mode for texture, both width and height must be power of 2"),Qe.mipmask===1?Ir!==1&&dr!==1&&L(ye.minFilter!==Me&&ye.minFilter!==pe&&ye.minFilter!==ge&&ye.minFilter!==Ne,"min filter requires mipmap"):(L(ct(Ir)&&ct(dr),"texture must be a square power of 2 to support mipmapping"),L(Qe.mipmask===(Ir<<1)-1,"missing or incomplete mipmap data")),Qe.type===Le&&(Ct.extensions.indexOf("oes_texture_float_linear")<0&&L(ye.minFilter===le&&ye.magFilter===le,"filter not supported, must enable oes_texture_float_linear"),L(!ye.genMipmaps,"mipmap generation not supported with float textures"));var Wr=Qe.images;for(pr=0;pr<16;++pr)if(Wr[pr]){var Gr=Ir>>pr,en=dr>>pr;L(Qe.mipmask&1<<pr,"missing mipmap data");var rn=Wr[pr];if(L(rn.width===Gr&&rn.height===en,"invalid shape for mip images"),L(rn.format===Qe.format&&rn.internalformat===Qe.internalformat&&rn.type===Qe.type,"incompatible type for mip image"),!rn.compressed)if(rn.data){var $r=Math.ceil($e(rn.type,Tr)*Gr/rn.unpackAlignment)*rn.unpackAlignment;L(rn.data.byteLength===$r*en,"invalid data for image, buffer size is inconsistent with image format")}else rn.element||rn.copy}else ye.genMipmaps||L((Qe.mipmask&1<<pr)==0,"extra mipmap data");Qe.compressed&&L(!ye.genMipmaps,"mipmap generation for compressed images not supported")}function st(ye,Qe,Ct,pr){var Ir=ye.width,dr=ye.height,Tr=ye.channels;L(Ir>0&&Ir<=pr.maxTextureSize&&dr>0&&dr<=pr.maxTextureSize,"invalid texture shape"),L(Ir===dr,"cube map must be square"),L(Qe.wrapS===ie&&Qe.wrapT===ie,"wrap mode not supported by cube map");for(var Wr=0;Wr<Ct.length;++Wr){var Gr=Ct[Wr];L(Gr.width===Ir&&Gr.height===dr,"inconsistent cube map face shape"),Qe.genMipmaps&&(L(!Gr.compressed,"can not generate mipmap for compressed textures"),L(Gr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var en=Gr.images,rn=0;rn<16;++rn){var $r=en[rn];if($r){var ln=Ir>>rn,Yr=dr>>rn;L(Gr.mipmask&1<<rn,"missing mipmap data"),L($r.width===ln&&$r.height===Yr,"invalid shape for mip images"),L($r.format===ye.format&&$r.internalformat===ye.internalformat&&$r.type===ye.type,"incompatible type for mip image"),$r.compressed||($r.data?L($r.data.byteLength===ln*Yr*Math.max($e($r.type,Tr),$r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):$r.element||$r.copy)}}}}var xe=o(L,{optional:ae,raise:P,commandRaise:re,command:Z,parameter:E,commandParameter:ee,constructor:O,type:M,commandType:H,isTypedArray:g,nni:j,oneOf:U,shaderError:B,linkError:V,callSite:S,saveCommandRef:Q,saveDrawInfo:oe,framebufferFormat:G,guessCommand:h,texture2D:gt,textureCube:st}),Mt=0,Ut=0,At=5,nt=6;function it(ye,Qe){this.id=Mt++,this.type=ye,this.data=Qe}function pt(ye){return ye.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Vt(ye){if(ye.length===0)return[];var Qe=ye.charAt(0),Ct=ye.charAt(ye.length-1);if(ye.length>1&&Qe===Ct&&(Qe==='"'||Qe==="'"))return['"'+pt(ye.substr(1,ye.length-2))+'"'];var pr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ye);if(pr)return Vt(ye.substr(0,pr.index)).concat(Vt(pr[1])).concat(Vt(ye.substr(pr.index+pr[0].length)));var Ir=ye.split(".");if(Ir.length===1)return['"'+pt(ye)+'"'];for(var dr=[],Tr=0;Tr<Ir.length;++Tr)dr=dr.concat(Vt(Ir[Tr]));return dr}function Er(ye){return"["+Vt(ye).join("][")+"]"}function mr(ye,Qe){return new it(ye,Er(Qe+""))}function Br(ye){return typeof ye=="function"&&!ye._reglType||ye instanceof it}function Ur(ye,Qe){if(typeof ye=="function")return new it(Ut,ye);if(typeof ye=="number"||typeof ye=="boolean")return new it(At,ye);if(Array.isArray(ye))return new it(nt,ye.map(function(Ct,pr){return Ur(Ct,Qe+"["+pr+"]")}));if(ye instanceof it)return ye;xe(!1,"invalid option type in uniform "+Qe)}var Ar={DynamicVariable:it,define:mr,isDynamic:Br,unbox:Ur,accessor:Er},Nn={next:typeof requestAnimationFrame=="function"?function(ye){return requestAnimationFrame(ye)}:function(ye){return setTimeout(ye,16)},cancel:typeof cancelAnimationFrame=="function"?function(ye){return cancelAnimationFrame(ye)}:clearTimeout},Rn=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ci(){var ye={"":0},Qe=[""];return{id:function(Ct){var pr=ye[Ct];return pr||(pr=ye[Ct]=Qe.length,Qe.push(Ct),pr)},str:function(Ct){return Qe[Ct]}}}function Fi(ye,Qe,Ct){var pr=document.createElement("canvas");o(pr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),ye.appendChild(pr),ye===document.body&&(pr.style.position="absolute",o(ye.style,{margin:0,padding:0}));function Ir(){var Wr=window.innerWidth,Gr=window.innerHeight;if(ye!==document.body){var en=pr.getBoundingClientRect();Wr=en.right-en.left,Gr=en.bottom-en.top}pr.width=Ct*Wr,pr.height=Ct*Gr}var dr;ye!==document.body&&typeof ResizeObserver=="function"?(dr=new ResizeObserver(function(){setTimeout(Ir)}),dr.observe(ye)):window.addEventListener("resize",Ir,!1);function Tr(){dr?dr.disconnect():window.removeEventListener("resize",Ir),ye.removeChild(pr)}return Ir(),{canvas:pr,onDestroy:Tr}}function ji(ye,Qe){function Ct(pr){try{return ye.getContext(pr,Qe)}catch(Ir){return null}}return Ct("webgl")||Ct("experimental-webgl")||Ct("webgl-experimental")}function Si(ye){return typeof ye.nodeName=="string"&&typeof ye.appendChild=="function"&&typeof ye.getBoundingClientRect=="function"}function xi(ye){return typeof ye.drawArrays=="function"||typeof ye.drawElements=="function"}function Ee(ye){return typeof ye=="string"?ye.split():(xe(Array.isArray(ye),"invalid extension array"),ye)}function ke(ye){return typeof ye=="string"?(xe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(ye)):ye}function ze(ye){var Qe=ye||{},Ct,pr,Ir,dr,Tr={},Wr=[],Gr=[],en=typeof window=="undefined"?1:window.devicePixelRatio,rn=!1,$r=function(Qr){Qr&&xe.raise(Qr)},ln=function(){};if(typeof Qe=="string"?(xe(typeof document!="undefined","selector queries only supported in DOM environments"),Ct=document.querySelector(Qe),xe(Ct,"invalid query string for element")):typeof Qe=="object"?Si(Qe)?Ct=Qe:xi(Qe)?(dr=Qe,Ir=dr.canvas):(xe.constructor(Qe),"gl"in Qe?dr=Qe.gl:"canvas"in Qe?Ir=ke(Qe.canvas):"container"in Qe&&(pr=ke(Qe.container)),"attributes"in Qe&&(Tr=Qe.attributes,xe.type(Tr,"object","invalid context attributes")),"extensions"in Qe&&(Wr=Ee(Qe.extensions)),"optionalExtensions"in Qe&&(Gr=Ee(Qe.optionalExtensions)),"onDone"in Qe&&(xe.type(Qe.onDone,"function","invalid or missing onDone callback"),$r=Qe.onDone),"profile"in Qe&&(rn=!!Qe.profile),"pixelRatio"in Qe&&(en=+Qe.pixelRatio,xe(en>0,"invalid pixel ratio"))):xe.raise("invalid arguments to regl"),Ct&&(Ct.nodeName.toLowerCase()==="canvas"?Ir=Ct:pr=Ct),!dr){if(!Ir){xe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Yr=Fi(pr||document.body,$r,en);if(!Yr)return null;Ir=Yr.canvas,ln=Yr.onDestroy}Tr.premultipliedAlpha===void 0&&(Tr.premultipliedAlpha=!0),dr=ji(Ir,Tr)}return dr?{gl:dr,canvas:Ir,container:pr,extensions:Wr,optionalExtensions:Gr,pixelRatio:en,profile:rn,onDone:$r,onDestroy:ln}:(ln(),$r("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ke(ye,Qe){var Ct={};function pr(Tr){xe.type(Tr,"string","extension name must be string");var Wr=Tr.toLowerCase(),Gr;try{Gr=Ct[Wr]=ye.getExtension(Wr)}catch(en){}return!!Gr}for(var Ir=0;Ir<Qe.extensions.length;++Ir){var dr=Qe.extensions[Ir];if(!pr(dr))return Qe.onDestroy(),Qe.onDone('"'+dr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Qe.optionalExtensions.forEach(pr),{extensions:Ct,restore:function(){Object.keys(Ct).forEach(function(Tr){if(Ct[Tr]&&!pr(Tr))throw new Error("(regl): error restoring extension "+Tr)})}}}function ot(ye,Qe){for(var Ct=Array(ye),pr=0;pr<ye;++pr)Ct[pr]=Qe(pr);return Ct}var Rt=5120,Nt=5121,Ye=5122,Et=5123,Zt=5124,Lr=5125,ir=5126;function ur(ye){for(var Qe=16;Qe<=1<<28;Qe*=16)if(ye<=Qe)return Qe;return 0}function Or(ye){var Qe,Ct;return Qe=(ye>65535)<<4,ye>>>=Qe,Ct=(ye>255)<<3,ye>>>=Ct,Qe|=Ct,Ct=(ye>15)<<2,ye>>>=Ct,Qe|=Ct,Ct=(ye>3)<<1,ye>>>=Ct,Qe|=Ct,Qe|ye>>1}function nn(){var ye=ot(8,function(){return[]});function Qe(dr){var Tr=ur(dr),Wr=ye[Or(Tr)>>2];return Wr.length>0?Wr.pop():new ArrayBuffer(Tr)}function Ct(dr){ye[Or(dr.byteLength)>>2].push(dr)}function pr(dr,Tr){var Wr=null;switch(dr){case Rt:Wr=new Int8Array(Qe(Tr),0,Tr);break;case Nt:Wr=new Uint8Array(Qe(Tr),0,Tr);break;case Ye:Wr=new Int16Array(Qe(2*Tr),0,Tr);break;case Et:Wr=new Uint16Array(Qe(2*Tr),0,Tr);break;case Zt:Wr=new Int32Array(Qe(4*Tr),0,Tr);break;case Lr:Wr=new Uint32Array(Qe(4*Tr),0,Tr);break;case ir:Wr=new Float32Array(Qe(4*Tr),0,Tr);break;default:return null}return Wr.length!==Tr?Wr.subarray(0,Tr):Wr}function Ir(dr){Ct(dr.buffer)}return{alloc:Qe,free:Ct,allocType:pr,freeType:Ir}}var Hr=nn();Hr.zero=nn();var gr=3408,vn=3410,an=3411,sn=3412,Ei=3413,fn=3414,ni=3415,Ui=33901,mi=33902,Li=3379,ui=3386,fi=34921,Wi=36347,va=36348,Pi=35661,hi=35660,Ii=34930,La=36349,ls=34076,Ta=34024,ma=7936,Qo=7937,Es=7938,sa=35724,to=34047,_a=36063,wa=34852,$a=3553,ia=34067,Ja=34069,ro=33984,Xa=6408,no=5126,go=5121,fa=36160,ja=36053,Qa=36064,Ua=16384,Ve=function(ye,Qe){var Ct=1;Qe.ext_texture_filter_anisotropic&&(Ct=ye.getParameter(to));var pr=1,Ir=1;Qe.webgl_draw_buffers&&(pr=ye.getParameter(wa),Ir=ye.getParameter(_a));var dr=!!Qe.oes_texture_float;if(dr){var Tr=ye.createTexture();ye.bindTexture($a,Tr),ye.texImage2D($a,0,Xa,1,1,0,Xa,no,null);var Wr=ye.createFramebuffer();if(ye.bindFramebuffer(fa,Wr),ye.framebufferTexture2D(fa,Qa,$a,Tr,0),ye.bindTexture($a,null),ye.checkFramebufferStatus(fa)!==ja)dr=!1;else{ye.viewport(0,0,1,1),ye.clearColor(1,0,0,1),ye.clear(Ua);var Gr=Hr.allocType(no,4);ye.readPixels(0,0,1,1,Xa,no,Gr),ye.getError()?dr=!1:(ye.deleteFramebuffer(Wr),ye.deleteTexture(Tr),dr=Gr[0]===1),Hr.freeType(Gr)}}var en=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),rn=!0;if(!en){var $r=ye.createTexture(),ln=Hr.allocType(go,36);ye.activeTexture(ro),ye.bindTexture(ia,$r),ye.texImage2D(Ja,0,Xa,3,3,0,Xa,go,ln),Hr.freeType(ln),ye.bindTexture(ia,null),ye.deleteTexture($r),rn=!ye.getError()}return{colorBits:[ye.getParameter(vn),ye.getParameter(an),ye.getParameter(sn),ye.getParameter(Ei)],depthBits:ye.getParameter(fn),stencilBits:ye.getParameter(ni),subpixelBits:ye.getParameter(gr),extensions:Object.keys(Qe).filter(function(Yr){return!!Qe[Yr]}),maxAnisotropic:Ct,maxDrawbuffers:pr,maxColorAttachments:Ir,pointSizeDims:ye.getParameter(Ui),lineWidthDims:ye.getParameter(mi),maxViewportDims:ye.getParameter(ui),maxCombinedTextureUnits:ye.getParameter(Pi),maxCubeMapSize:ye.getParameter(ls),maxRenderbufferSize:ye.getParameter(Ta),maxTextureUnits:ye.getParameter(Ii),maxTextureSize:ye.getParameter(Li),maxAttributes:ye.getParameter(fi),maxVertexUniforms:ye.getParameter(Wi),maxVertexTextureUnits:ye.getParameter(hi),maxVaryingVectors:ye.getParameter(va),maxFragmentUniforms:ye.getParameter(La),glsl:ye.getParameter(sa),renderer:ye.getParameter(Qo),vendor:ye.getParameter(ma),version:ye.getParameter(Es),readFloat:dr,npotTextureCube:rn}};function rt(ye){return!!ye&&typeof ye=="object"&&Array.isArray(ye.shape)&&Array.isArray(ye.stride)&&typeof ye.offset=="number"&&ye.shape.length===ye.stride.length&&(Array.isArray(ye.data)||F(ye.data))}var wt=function(ye){return Object.keys(ye).map(function(Qe){return ye[Qe]})},lr={shape:tt,flatten:be};function Zr(ye,Qe,Ct){for(var pr=0;pr<Qe;++pr)Ct[pr]=ye[pr]}function Un(ye,Qe,Ct,pr){for(var Ir=0,dr=0;dr<Qe;++dr)for(var Tr=ye[dr],Wr=0;Wr<Ct;++Wr)pr[Ir++]=Tr[Wr]}function oi(ye,Qe,Ct,pr,Ir,dr){for(var Tr=dr,Wr=0;Wr<Qe;++Wr)for(var Gr=ye[Wr],en=0;en<Ct;++en)for(var rn=Gr[en],$r=0;$r<pr;++$r)Ir[Tr++]=rn[$r]}function te(ye,Qe,Ct,pr,Ir){for(var dr=1,Tr=Ct+1;Tr<Qe.length;++Tr)dr*=Qe[Tr];var Wr=Qe[Ct];if(Qe.length-Ct==4){var Gr=Qe[Ct+1],en=Qe[Ct+2],rn=Qe[Ct+3];for(Tr=0;Tr<Wr;++Tr)oi(ye[Tr],Gr,en,rn,pr,Ir),Ir+=dr}else for(Tr=0;Tr<Wr;++Tr)te(ye[Tr],Qe,Ct+1,pr,Ir),Ir+=dr}function be(ye,Qe,Ct,pr){var Ir=1;if(Qe.length)for(var dr=0;dr<Qe.length;++dr)Ir*=Qe[dr];else Ir=0;var Tr=pr||Hr.allocType(Ct,Ir);switch(Qe.length){case 0:break;case 1:Zr(ye,Qe[0],Tr);break;case 2:Un(ye,Qe[0],Qe[1],Tr);break;case 3:oi(ye,Qe[0],Qe[1],Qe[2],Tr,0);break;default:te(ye,Qe,0,Tr,0)}return Tr}function tt(ye){for(var Qe=[],Ct=ye;Ct.length;Ct=Ct[0])Qe.push(Ct.length);return Qe}var yt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Bt=5120,qt=5122,Wt=5124,or=5121,ar=5123,kr=5125,we=5126,je=5126,Ue={int8:Bt,int16:qt,int32:Wt,uint8:or,uint16:ar,uint32:kr,float:we,float32:je},ut=35048,Xt=35040,Mr={dynamic:ut,stream:Xt,static:35044},bn=lr.flatten,ei=lr.shape,Ci=35044,Xi=35040,Fa=5121,aa=5126,Oi=[];Oi[5120]=1,Oi[5122]=2,Oi[5124]=4,Oi[5121]=1,Oi[5123]=2,Oi[5125]=4,Oi[5126]=4;function vs(ye){return yt[Object.prototype.toString.call(ye)]|0}function Yi(ye,Qe){for(var Ct=0;Ct<Qe.length;++Ct)ye[Ct]=Qe[Ct]}function m(ye,Qe,Ct,pr,Ir,dr,Tr){for(var Wr=0,Gr=0;Gr<Ct;++Gr)for(var en=0;en<pr;++en)ye[Wr++]=Qe[Ir*Gr+dr*en+Tr]}function Y(ye,Qe,Ct,pr){var Ir=0,dr={};function Tr($t){this.id=Ir++,this.buffer=ye.createBuffer(),this.type=$t,this.usage=Ci,this.byteLength=0,this.dimension=1,this.dtype=Fa,this.persistentData=null,Ct.profile&&(this.stats={size:0})}Tr.prototype.bind=function(){ye.bindBuffer(this.type,this.buffer)},Tr.prototype.destroy=function(){ln(this)};var Wr=[];function Gr($t,Sr){var Kr=Wr.pop();return Kr||(Kr=new Tr($t)),Kr.bind(),$r(Kr,Sr,Xi,0,1,!1),Kr}function en($t){Wr.push($t)}function rn($t,Sr,Kr){$t.byteLength=Sr.byteLength,ye.bufferData($t.type,Sr,Kr)}function $r($t,Sr,Kr,Mn,Nr,En){var on;if($t.usage=Kr,Array.isArray(Sr)){if($t.dtype=Mn||aa,Sr.length>0){var Qn;if(Array.isArray(Sr[0])){on=ei(Sr);for(var wr=1,Pr=1;Pr<on.length;++Pr)wr*=on[Pr];$t.dimension=wr,Qn=bn(Sr,on,$t.dtype),rn($t,Qn,Kr),En?$t.persistentData=Qn:Hr.freeType(Qn)}else if(typeof Sr[0]=="number"){$t.dimension=Nr;var jn=Hr.allocType($t.dtype,Sr.length);Yi(jn,Sr),rn($t,jn,Kr),En?$t.persistentData=jn:Hr.freeType(jn)}else F(Sr[0])?($t.dimension=Sr[0].length,$t.dtype=Mn||vs(Sr[0])||aa,Qn=bn(Sr,[Sr.length,Sr[0].length],$t.dtype),rn($t,Qn,Kr),En?$t.persistentData=Qn:Hr.freeType(Qn)):xe.raise("invalid buffer data")}}else if(F(Sr))$t.dtype=Mn||vs(Sr),$t.dimension=Nr,rn($t,Sr,Kr),En&&($t.persistentData=new Uint8Array(new Uint8Array(Sr.buffer)));else if(rt(Sr)){on=Sr.shape;var Jr=Sr.stride,Xr=Sr.offset,xn=0,Tn=0,ki=0,Ti=0;on.length===1?(xn=on[0],Tn=1,ki=Jr[0],Ti=0):on.length===2?(xn=on[0],Tn=on[1],ki=Jr[0],Ti=Jr[1]):xe.raise("invalid shape"),$t.dtype=Mn||vs(Sr.data)||aa,$t.dimension=Tn;var Cn=Hr.allocType($t.dtype,xn*Tn);m(Cn,Sr.data,xn,Tn,ki,Ti,Xr),rn($t,Cn,Kr),En?$t.persistentData=Cn:Hr.freeType(Cn)}else Sr instanceof ArrayBuffer?($t.dtype=Fa,$t.dimension=Nr,rn($t,Sr,Kr),En&&($t.persistentData=new Uint8Array(new Uint8Array(Sr)))):xe.raise("invalid buffer data")}function ln($t){Qe.bufferCount--,pr($t);var Sr=$t.buffer;xe(Sr,"buffer must not be deleted already"),ye.deleteBuffer(Sr),$t.buffer=null,delete dr[$t.id]}function Yr($t,Sr,Kr,Mn){Qe.bufferCount++;var Nr=new Tr(Sr);dr[Nr.id]=Nr;function En(wr){var Pr=Ci,jn=null,Jr=0,Xr=0,xn=1;return Array.isArray(wr)||F(wr)||rt(wr)||wr instanceof ArrayBuffer?jn=wr:typeof wr=="number"?Jr=wr|0:wr&&(xe.type(wr,"object","buffer arguments must be an object, a number or an array"),"data"in wr&&(xe(jn===null||Array.isArray(jn)||F(jn)||rt(jn),"invalid data for buffer"),jn=wr.data),"usage"in wr&&(xe.parameter(wr.usage,Mr,"invalid buffer usage"),Pr=Mr[wr.usage]),"type"in wr&&(xe.parameter(wr.type,Ue,"invalid buffer type"),Xr=Ue[wr.type]),"dimension"in wr&&(xe.type(wr.dimension,"number","invalid dimension"),xn=wr.dimension|0),"length"in wr&&(xe.nni(Jr,"buffer length must be a nonnegative integer"),Jr=wr.length|0)),Nr.bind(),jn?$r(Nr,jn,Pr,Xr,xn,Mn):(Jr&&ye.bufferData(Nr.type,Jr,Pr),Nr.dtype=Xr||Fa,Nr.usage=Pr,Nr.dimension=xn,Nr.byteLength=Jr),Ct.profile&&(Nr.stats.size=Nr.byteLength*Oi[Nr.dtype]),En}function on(wr,Pr){xe(Pr+wr.byteLength<=Nr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+wr.byteLength+" starting from offset "+Pr+" to a buffer of size "+Nr.byteLength),ye.bufferSubData(Nr.type,Pr,wr)}function Qn(wr,Pr){var jn=(Pr||0)|0,Jr;if(Nr.bind(),F(wr)||wr instanceof ArrayBuffer)on(wr,jn);else if(Array.isArray(wr)){if(wr.length>0)if(typeof wr[0]=="number"){var Xr=Hr.allocType(Nr.dtype,wr.length);Yi(Xr,wr),on(Xr,jn),Hr.freeType(Xr)}else if(Array.isArray(wr[0])||F(wr[0])){Jr=ei(wr);var xn=bn(wr,Jr,Nr.dtype);on(xn,jn),Hr.freeType(xn)}else xe.raise("invalid buffer data")}else if(rt(wr)){Jr=wr.shape;var Tn=wr.stride,ki=0,Ti=0,Cn=0,Pn=0;Jr.length===1?(ki=Jr[0],Ti=1,Cn=Tn[0],Pn=0):Jr.length===2?(ki=Jr[0],Ti=Jr[1],Cn=Tn[0],Pn=Tn[1]):xe.raise("invalid shape");var yi=Array.isArray(wr.data)?Nr.dtype:vs(wr.data),wi=Hr.allocType(yi,ki*Ti);m(wi,wr.data,ki,Ti,Cn,Pn,wr.offset),on(wi,jn),Hr.freeType(wi)}else xe.raise("invalid data for buffer subdata");return En}return Kr||En($t),En._reglType="buffer",En._buffer=Nr,En.subdata=Qn,Ct.profile&&(En.stats=Nr.stats),En.destroy=function(){ln(Nr)},En}function Qr(){wt(dr).forEach(function($t){$t.buffer=ye.createBuffer(),ye.bindBuffer($t.type,$t.buffer),ye.bufferData($t.type,$t.persistentData||$t.byteLength,$t.usage)})}return Ct.profile&&(Qe.getTotalBufferSize=function(){var $t=0;return Object.keys(dr).forEach(function(Sr){$t+=dr[Sr].stats.size}),$t}),{create:Yr,createStream:Gr,destroyStream:en,clear:function(){wt(dr).forEach(ln),Wr.forEach(ln)},getBuffer:function($t){return $t&&$t._buffer instanceof Tr?$t._buffer:null},restore:Qr,_initBuffer:$r}}var ve=0,ne=0,Fe=1,et=1,Lt=4,Kt=4,Gt={points:ve,point:ne,lines:Fe,line:et,triangles:Lt,triangle:Kt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Fr=0,Vr=1,Zn=4,Ri=5120,ti=5121,ha=5122,ua=5123,Ga=5124,Vi=5125,Cs=34963,Gs=35040,Qs=35044;function ll(ye,Qe,Ct,pr){var Ir={},dr=0,Tr={uint8:ti,uint16:ua};Qe.oes_element_index_uint&&(Tr.uint32=Vi);function Wr(Qr){this.id=dr++,Ir[this.id]=this,this.buffer=Qr,this.primType=Zn,this.vertCount=0,this.type=0}Wr.prototype.bind=function(){this.buffer.bind()};var Gr=[];function en(Qr){var $t=Gr.pop();return $t||($t=new Wr(Ct.create(null,Cs,!0,!1)._buffer)),$r($t,Qr,Gs,-1,-1,0,0),$t}function rn(Qr){Gr.push(Qr)}function $r(Qr,$t,Sr,Kr,Mn,Nr,En){Qr.buffer.bind();var on;if($t){var Qn=En;!En&&(!F($t)||rt($t)&&!F($t.data))&&(Qn=Qe.oes_element_index_uint?Vi:ua),Ct._initBuffer(Qr.buffer,$t,Sr,Qn,3)}else ye.bufferData(Cs,Nr,Sr),Qr.buffer.dtype=on||ti,Qr.buffer.usage=Sr,Qr.buffer.dimension=3,Qr.buffer.byteLength=Nr;if(on=En,!En){switch(Qr.buffer.dtype){case ti:case Ri:on=ti;break;case ua:case ha:on=ua;break;case Vi:case Ga:on=Vi;break;default:xe.raise("unsupported type for element array")}Qr.buffer.dtype=on}Qr.type=on,xe(on!==Vi||!!Qe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var wr=Mn;wr<0&&(wr=Qr.buffer.byteLength,on===ua?wr>>=1:on===Vi&&(wr>>=2)),Qr.vertCount=wr;var Pr=Kr;if(Kr<0){Pr=Zn;var jn=Qr.buffer.dimension;jn===1&&(Pr=Fr),jn===2&&(Pr=Vr),jn===3&&(Pr=Zn)}Qr.primType=Pr}function ln(Qr){pr.elementsCount--,xe(Qr.buffer!==null,"must not double destroy elements"),delete Ir[Qr.id],Qr.buffer.destroy(),Qr.buffer=null}function Yr(Qr,$t){var Sr=Ct.create(null,Cs,!0),Kr=new Wr(Sr._buffer);pr.elementsCount++;function Mn(Nr){if(!Nr)Sr(),Kr.primType=Zn,Kr.vertCount=0,Kr.type=ti;else if(typeof Nr=="number")Sr(Nr),Kr.primType=Zn,Kr.vertCount=Nr|0,Kr.type=ti;else{var En=null,on=Qs,Qn=-1,wr=-1,Pr=0,jn=0;Array.isArray(Nr)||F(Nr)||rt(Nr)?En=Nr:(xe.type(Nr,"object","invalid arguments for elements"),"data"in Nr&&(En=Nr.data,xe(Array.isArray(En)||F(En)||rt(En),"invalid data for element buffer")),"usage"in Nr&&(xe.parameter(Nr.usage,Mr,"invalid element buffer usage"),on=Mr[Nr.usage]),"primitive"in Nr&&(xe.parameter(Nr.primitive,Gt,"invalid element buffer primitive"),Qn=Gt[Nr.primitive]),"count"in Nr&&(xe(typeof Nr.count=="number"&&Nr.count>=0,"invalid vertex count for elements"),wr=Nr.count|0),"type"in Nr&&(xe.parameter(Nr.type,Tr,"invalid buffer type"),jn=Tr[Nr.type]),"length"in Nr?Pr=Nr.length|0:(Pr=wr,jn===ua||jn===ha?Pr*=2:(jn===Vi||jn===Ga)&&(Pr*=4))),$r(Kr,En,on,Qn,wr,Pr,jn)}return Mn}return Mn(Qr),Mn._reglType="elements",Mn._elements=Kr,Mn.subdata=function(Nr,En){return Sr.subdata(Nr,En),Mn},Mn.destroy=function(){ln(Kr)},Mn}return{create:Yr,createStream:en,destroyStream:rn,getElements:function(Qr){return typeof Qr=="function"&&Qr._elements instanceof Wr?Qr._elements:null},clear:function(){wt(Ir).forEach(ln)}}}var Hs=new Float32Array(1),Vu=new Uint32Array(Hs.buffer),ks=5123;function Os(ye){for(var Qe=Hr.allocType(ks,ye.length),Ct=0;Ct<ye.length;++Ct)if(isNaN(ye[Ct]))Qe[Ct]=65535;else if(ye[Ct]===Infinity)Qe[Ct]=31744;else if(ye[Ct]===-Infinity)Qe[Ct]=64512;else{Hs[0]=ye[Ct];var pr=Vu[0],Ir=pr>>>31<<15,dr=(pr<<1>>>24)-127,Tr=pr>>13&(1<<10)-1;if(dr<-24)Qe[Ct]=Ir;else if(dr<-14){var Wr=-14-dr;Qe[Ct]=Ir+(Tr+(1<<10)>>Wr)}else dr>15?Qe[Ct]=Ir+31744:Qe[Ct]=Ir+(dr+15<<10)+Tr}return Qe}function Ra(ye){return Array.isArray(ye)||F(ye)}var cl=function(ye){return!(ye&ye-1)&&!!ye},$l=34467,Ts=3553,Zs=34067,Gu=34069,ms=6408,Ws=6406,Ou=6407,Ys=6409,Oa=6410,Hu=32854,Dl=32855,yu=36194,Jl=32819,vc=32820,Ql=33635,Zu=34042,qs=6402,eu=34041,Iu=35904,tu=35906,Is=36193,fl=33776,ru=33777,gs=33778,hl=33779,kl=35986,dl=35987,nu=34798,Ru=35840,Wu=35841,pl=35842,Yu=35843,ql=36196,Xs=5121,Xu=5123,Ku=5125,_u=5126,$u=10242,iu=10243,vl=10497,Ju=33071,Lu=33648,ec=10240,xu=10241,Aa=9728,au=9729,ys=9984,_s=9985,Ji=9986,Ia=9987,qo=33170,ou=4352,Du=4353,bu=4354,mc=34046,tc=3317,Qu=37440,ml=37441,Fs=37443,fo=37444,su=33984,Fl=[ys,Ji,_s,Ia],Ka=[0,Ys,Oa,Ou,ms],Sn={};Sn[Ys]=Sn[Ws]=Sn[qs]=1,Sn[eu]=Sn[Oa]=2,Sn[Ou]=Sn[Iu]=3,Sn[ms]=Sn[tu]=4;function Io(ye){return"[object "+ye+"]"}var uu=Io("HTMLCanvasElement"),cs=Io("OffscreenCanvas"),xs=Io("CanvasRenderingContext2D"),jo=Io("ImageBitmap"),qu=Io("HTMLImageElement"),pn=Io("HTMLVideoElement"),Nl=Object.keys(yt).concat([uu,cs,xs,jo,qu,pn]),Ns=[];Ns[Xs]=1,Ns[_u]=4,Ns[Is]=2,Ns[Xu]=2,Ns[Ku]=4;var io=[];io[Hu]=2,io[Dl]=2,io[yu]=2,io[eu]=4,io[fl]=.5,io[ru]=.5,io[gs]=1,io[hl]=1,io[kl]=.5,io[dl]=1,io[nu]=1,io[Ru]=.5,io[Wu]=.25,io[pl]=.5,io[Yu]=.25,io[ql]=.5;function fs(ye){return Array.isArray(ye)&&(ye.length===0||typeof ye[0]=="number")}function Uo(ye){if(!Array.isArray(ye))return!1;var Qe=ye.length;return!(Qe===0||!Ra(ye[0]))}function Rs(ye){return Object.prototype.toString.call(ye)}function Su(ye){return Rs(ye)===uu}function es(ye){return Rs(ye)===cs}function q(ye){return Rs(ye)===xs}function Oe(ye){return Rs(ye)===jo}function vt(ye){return Rs(ye)===qu}function ht(ye){return Rs(ye)===pn}function cr(ye){if(!ye)return!1;var Qe=Rs(ye);return Nl.indexOf(Qe)>=0?!0:fs(ye)||Uo(ye)||rt(ye)}function Qt(ye){return yt[Object.prototype.toString.call(ye)]|0}function hr(ye,Qe){var Ct=Qe.length;switch(ye.type){case Xs:case Xu:case Ku:case _u:var pr=Hr.allocType(ye.type,Ct);pr.set(Qe),ye.data=pr;break;case Is:ye.data=Os(Qe);break;default:xe.raise("unsupported texture type, must specify a typed array")}}function nr(ye,Qe){return Hr.allocType(ye.type===Is?_u:ye.type,Qe)}function Dr(ye,Qe){ye.type===Is?(ye.data=Os(Qe),Hr.freeType(Qe)):ye.data=Qe}function An(ye,Qe,Ct,pr,Ir,dr){for(var Tr=ye.width,Wr=ye.height,Gr=ye.channels,en=Tr*Wr*Gr,rn=nr(ye,en),$r=0,ln=0;ln<Wr;++ln)for(var Yr=0;Yr<Tr;++Yr)for(var Qr=0;Qr<Gr;++Qr)rn[$r++]=Qe[Ct*Yr+pr*ln+Ir*Qr+dr];Dr(ye,rn)}function Bn(ye,Qe,Ct,pr,Ir,dr){var Tr;if(typeof io[ye]!="undefined"?Tr=io[ye]:Tr=Sn[ye]*Ns[Qe],dr&&(Tr*=6),Ir){for(var Wr=0,Gr=Ct;Gr>=1;)Wr+=Tr*Gr*Gr,Gr/=2;return Wr}else return Tr*Ct*pr}function Ln(ye,Qe,Ct,pr,Ir,dr,Tr){var Wr={"don't care":ou,"dont care":ou,nice:bu,fast:Du},Gr={repeat:vl,clamp:Ju,mirror:Lu},en={nearest:Aa,linear:au},rn=o({mipmap:Ia,"nearest mipmap nearest":ys,"linear mipmap nearest":_s,"nearest mipmap linear":Ji,"linear mipmap linear":Ia},en),$r={none:0,browser:fo},ln={uint8:Xs,rgba4:Jl,rgb565:Ql,"rgb5 a1":vc},Yr={alpha:Ws,luminance:Ys,"luminance alpha":Oa,rgb:Ou,rgba:ms,rgba4:Hu,"rgb5 a1":Dl,rgb565:yu},Qr={};Qe.ext_srgb&&(Yr.srgb=Iu,Yr.srgba=tu),Qe.oes_texture_float&&(ln.float32=ln.float=_u),Qe.oes_texture_half_float&&(ln.float16=ln["half float"]=Is),Qe.webgl_depth_texture&&(o(Yr,{depth:qs,"depth stencil":eu}),o(ln,{uint16:Xu,uint32:Ku,"depth stencil":Zu})),Qe.webgl_compressed_texture_s3tc&&o(Qr,{"rgb s3tc dxt1":fl,"rgba s3tc dxt1":ru,"rgba s3tc dxt3":gs,"rgba s3tc dxt5":hl}),Qe.webgl_compressed_texture_atc&&o(Qr,{"rgb atc":kl,"rgba atc explicit alpha":dl,"rgba atc interpolated alpha":nu}),Qe.webgl_compressed_texture_pvrtc&&o(Qr,{"rgb pvrtc 4bppv1":Ru,"rgb pvrtc 2bppv1":Wu,"rgba pvrtc 4bppv1":pl,"rgba pvrtc 2bppv1":Yu}),Qe.webgl_compressed_texture_etc1&&(Qr["rgb etc1"]=ql);var $t=Array.prototype.slice.call(ye.getParameter($l)||new Uint32Array(0));Object.keys(Qr).forEach(function(dt){var vr=Qr[dt];$t.indexOf(vr)>=0&&(Yr[dt]=vr)});var Sr=Object.keys(Yr);Ct.textureFormats=Sr;var Kr=[];Object.keys(Yr).forEach(function(dt){var vr=Yr[dt];Kr[vr]=dt});var Mn=[];Object.keys(ln).forEach(function(dt){var vr=ln[dt];Mn[vr]=dt});var Nr=[];Object.keys(en).forEach(function(dt){var vr=en[dt];Nr[vr]=dt});var En=[];Object.keys(rn).forEach(function(dt){var vr=rn[dt];En[vr]=dt});var on=[];Object.keys(Gr).forEach(function(dt){var vr=Gr[dt];on[vr]=dt});var Qn=Sr.reduce(function(dt,vr){var sr=Yr[vr];return sr===Ys||sr===Ws||sr===Ys||sr===Oa||sr===qs||sr===eu||Qe.ext_srgb&&(sr===Iu||sr===tu)?dt[sr]=sr:sr===Dl||vr.indexOf("rgba")>=0?dt[sr]=ms:dt[sr]=Ou,dt},{});function wr(){this.internalformat=ms,this.format=ms,this.type=Xs,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=fo,this.width=0,this.height=0,this.channels=0}function Pr(dt,vr){dt.internalformat=vr.internalformat,dt.format=vr.format,dt.type=vr.type,dt.compressed=vr.compressed,dt.premultiplyAlpha=vr.premultiplyAlpha,dt.flipY=vr.flipY,dt.unpackAlignment=vr.unpackAlignment,dt.colorSpace=vr.colorSpace,dt.width=vr.width,dt.height=vr.height,dt.channels=vr.channels}function jn(dt,vr){if(!(typeof vr!="object"||!vr)){if("premultiplyAlpha"in vr&&(xe.type(vr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),dt.premultiplyAlpha=vr.premultiplyAlpha),"flipY"in vr&&(xe.type(vr.flipY,"boolean","invalid texture flip"),dt.flipY=vr.flipY),"alignment"in vr&&(xe.oneOf(vr.alignment,[1,2,4,8],"invalid texture unpack alignment"),dt.unpackAlignment=vr.alignment),"colorSpace"in vr&&(xe.parameter(vr.colorSpace,$r,"invalid colorSpace"),dt.colorSpace=$r[vr.colorSpace]),"type"in vr){var sr=vr.type;xe(Qe.oes_texture_float||!(sr==="float"||sr==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),xe(Qe.oes_texture_half_float||!(sr==="half float"||sr==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),xe(Qe.webgl_depth_texture||!(sr==="uint16"||sr==="uint32"||sr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),xe.parameter(sr,ln,"invalid texture type"),dt.type=ln[sr]}var On=dt.width,ea=dt.height,at=dt.channels,Ze=!1;"shape"in vr?(xe(Array.isArray(vr.shape)&&vr.shape.length>=2,"shape must be an array"),On=vr.shape[0],ea=vr.shape[1],vr.shape.length===3&&(at=vr.shape[2],xe(at>0&&at<=4,"invalid number of channels"),Ze=!0),xe(On>=0&&On<=Ct.maxTextureSize,"invalid width"),xe(ea>=0&&ea<=Ct.maxTextureSize,"invalid height")):("radius"in vr&&(On=ea=vr.radius,xe(On>=0&&On<=Ct.maxTextureSize,"invalid radius")),"width"in vr&&(On=vr.width,xe(On>=0&&On<=Ct.maxTextureSize,"invalid width")),"height"in vr&&(ea=vr.height,xe(ea>=0&&ea<=Ct.maxTextureSize,"invalid height")),"channels"in vr&&(at=vr.channels,xe(at>0&&at<=4,"invalid number of channels"),Ze=!0)),dt.width=On|0,dt.height=ea|0,dt.channels=at|0;var It=!1;if("format"in vr){var Jt=vr.format;xe(Qe.webgl_depth_texture||!(Jt==="depth"||Jt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),xe.parameter(Jt,Yr,"invalid texture format");var fr=dt.internalformat=Yr[Jt];dt.format=Qn[fr],Jt in ln&&("type"in vr||(dt.type=ln[Jt])),Jt in Qr&&(dt.compressed=!0),It=!0}!Ze&&It?dt.channels=Sn[dt.format]:Ze&&!It?dt.channels!==Ka[dt.format]&&(dt.format=dt.internalformat=Ka[dt.channels]):It&&Ze&&xe(dt.channels===Sn[dt.format],"number of channels inconsistent with specified format")}}function Jr(dt){ye.pixelStorei(Qu,dt.flipY),ye.pixelStorei(ml,dt.premultiplyAlpha),ye.pixelStorei(Fs,dt.colorSpace),ye.pixelStorei(tc,dt.unpackAlignment)}function Xr(){wr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function xn(dt,vr){var sr=null;if(cr(vr)?sr=vr:vr&&(xe.type(vr,"object","invalid pixel data type"),jn(dt,vr),"x"in vr&&(dt.xOffset=vr.x|0),"y"in vr&&(dt.yOffset=vr.y|0),cr(vr.data)&&(sr=vr.data)),xe(!dt.compressed||sr instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),vr.copy){xe(!sr,"can not specify copy and data field for the same texture");var On=Ir.viewportWidth,ea=Ir.viewportHeight;dt.width=dt.width||On-dt.xOffset,dt.height=dt.height||ea-dt.yOffset,dt.needsCopy=!0,xe(dt.xOffset>=0&&dt.xOffset<On&&dt.yOffset>=0&&dt.yOffset<ea&&dt.width>0&&dt.width<=On&&dt.height>0&&dt.height<=ea,"copy texture read out of bounds")}else if(!sr)dt.width=dt.width||1,dt.height=dt.height||1,dt.channels=dt.channels||4;else if(F(sr))dt.channels=dt.channels||4,dt.data=sr,!("type"in vr)&&dt.type===Xs&&(dt.type=Qt(sr));else if(fs(sr))dt.channels=dt.channels||4,hr(dt,sr),dt.alignment=1,dt.needsFree=!0;else if(rt(sr)){var at=sr.data;!Array.isArray(at)&&dt.type===Xs&&(dt.type=Qt(at));var Ze=sr.shape,It=sr.stride,Jt,fr,Ft,Dt,zt,qe;Ze.length===3?(Ft=Ze[2],qe=It[2]):(xe(Ze.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ft=1,qe=1),Jt=Ze[0],fr=Ze[1],Dt=It[0],zt=It[1],dt.alignment=1,dt.width=Jt,dt.height=fr,dt.channels=Ft,dt.format=dt.internalformat=Ka[Ft],dt.needsFree=!0,An(dt,at,Dt,zt,qe,sr.offset)}else if(Su(sr)||es(sr)||q(sr))Su(sr)||es(sr)?dt.element=sr:dt.element=sr.canvas,dt.width=dt.element.width,dt.height=dt.element.height,dt.channels=4;else if(Oe(sr))dt.element=sr,dt.width=sr.width,dt.height=sr.height,dt.channels=4;else if(vt(sr))dt.element=sr,dt.width=sr.naturalWidth,dt.height=sr.naturalHeight,dt.channels=4;else if(ht(sr))dt.element=sr,dt.width=sr.videoWidth,dt.height=sr.videoHeight,dt.channels=4;else if(Uo(sr)){var St=dt.width||sr[0].length,lt=dt.height||sr.length,Yt=dt.channels;Ra(sr[0][0])?Yt=Yt||sr[0][0].length:Yt=Yt||1;for(var tr=lr.shape(sr),jr=1,hn=0;hn<tr.length;++hn)jr*=tr[hn];var dn=nr(dt,jr);lr.flatten(sr,tr,"",dn),Dr(dt,dn),dt.alignment=1,dt.width=St,dt.height=lt,dt.channels=Yt,dt.format=dt.internalformat=Ka[Yt],dt.needsFree=!0}dt.type===_u?xe(Ct.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):dt.type===Is&&xe(Ct.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Tn(dt,vr,sr){var On=dt.element,ea=dt.data,at=dt.internalformat,Ze=dt.format,It=dt.type,Jt=dt.width,fr=dt.height;Jr(dt),On?ye.texImage2D(vr,sr,Ze,Ze,It,On):dt.compressed?ye.compressedTexImage2D(vr,sr,at,Jt,fr,0,ea):dt.needsCopy?(pr(),ye.copyTexImage2D(vr,sr,Ze,dt.xOffset,dt.yOffset,Jt,fr,0)):ye.texImage2D(vr,sr,Ze,Jt,fr,0,Ze,It,ea||null)}function ki(dt,vr,sr,On,ea){var at=dt.element,Ze=dt.data,It=dt.internalformat,Jt=dt.format,fr=dt.type,Ft=dt.width,Dt=dt.height;Jr(dt),at?ye.texSubImage2D(vr,ea,sr,On,Jt,fr,at):dt.compressed?ye.compressedTexSubImage2D(vr,ea,sr,On,It,Ft,Dt,Ze):dt.needsCopy?(pr(),ye.copyTexSubImage2D(vr,ea,sr,On,dt.xOffset,dt.yOffset,Ft,Dt)):ye.texSubImage2D(vr,ea,sr,On,Ft,Dt,Jt,fr,Ze)}var Ti=[];function Cn(){return Ti.pop()||new Xr}function Pn(dt){dt.needsFree&&Hr.freeType(dt.data),Xr.call(dt),Ti.push(dt)}function yi(){wr.call(this),this.genMipmaps=!1,this.mipmapHint=ou,this.mipmask=0,this.images=Array(16)}function wi(dt,vr,sr){var On=dt.images[0]=Cn();dt.mipmask=1,On.width=dt.width=vr,On.height=dt.height=sr,On.channels=dt.channels=4}function $i(dt,vr){var sr=null;if(cr(vr))sr=dt.images[0]=Cn(),Pr(sr,dt),xn(sr,vr),dt.mipmask=1;else if(jn(dt,vr),Array.isArray(vr.mipmap))for(var On=vr.mipmap,ea=0;ea<On.length;++ea)sr=dt.images[ea]=Cn(),Pr(sr,dt),sr.width>>=ea,sr.height>>=ea,xn(sr,On[ea]),dt.mipmask|=1<<ea;else sr=dt.images[0]=Cn(),Pr(sr,dt),xn(sr,vr),dt.mipmask=1;Pr(dt,dt.images[0]),dt.compressed&&(dt.internalformat===fl||dt.internalformat===ru||dt.internalformat===gs||dt.internalformat===hl)&&xe(dt.width%4==0&&dt.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function uo(dt,vr){for(var sr=dt.images,On=0;On<sr.length;++On){if(!sr[On])return;Tn(sr[On],vr,On)}}var po=[];function ra(){var dt=po.pop()||new yi;wr.call(dt),dt.mipmask=0;for(var vr=0;vr<16;++vr)dt.images[vr]=null;return dt}function Yo(dt){for(var vr=dt.images,sr=0;sr<vr.length;++sr)vr[sr]&&Pn(vr[sr]),vr[sr]=null;po.push(dt)}function Ya(){this.minFilter=Aa,this.magFilter=Aa,this.wrapS=Ju,this.wrapT=Ju,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ou}function Do(dt,vr){if("min"in vr){var sr=vr.min;xe.parameter(sr,rn),dt.minFilter=rn[sr],Fl.indexOf(dt.minFilter)>=0&&!("faces"in vr)&&(dt.genMipmaps=!0)}if("mag"in vr){var On=vr.mag;xe.parameter(On,en),dt.magFilter=en[On]}var ea=dt.wrapS,at=dt.wrapT;if("wrap"in vr){var Ze=vr.wrap;typeof Ze=="string"?(xe.parameter(Ze,Gr),ea=at=Gr[Ze]):Array.isArray(Ze)&&(xe.parameter(Ze[0],Gr),xe.parameter(Ze[1],Gr),ea=Gr[Ze[0]],at=Gr[Ze[1]])}else{if("wrapS"in vr){var It=vr.wrapS;xe.parameter(It,Gr),ea=Gr[It]}if("wrapT"in vr){var Jt=vr.wrapT;xe.parameter(Jt,Gr),at=Gr[Jt]}}if(dt.wrapS=ea,dt.wrapT=at,"anisotropic"in vr){var fr=vr.anisotropic;xe(typeof fr=="number"&&fr>=1&&fr<=Ct.maxAnisotropic,"aniso samples must be between 1 and "),dt.anisotropic=vr.anisotropic}if("mipmap"in vr){var Ft=!1;switch(typeof vr.mipmap){case"string":xe.parameter(vr.mipmap,Wr,"invalid mipmap hint"),dt.mipmapHint=Wr[vr.mipmap],dt.genMipmaps=!0,Ft=!0;break;case"boolean":Ft=dt.genMipmaps=vr.mipmap;break;case"object":xe(Array.isArray(vr.mipmap),"invalid mipmap type"),dt.genMipmaps=!1,Ft=!0;break;default:xe.raise("invalid mipmap type")}Ft&&!("min"in vr)&&(dt.minFilter=ys)}}function xo(dt,vr){ye.texParameteri(vr,xu,dt.minFilter),ye.texParameteri(vr,ec,dt.magFilter),ye.texParameteri(vr,$u,dt.wrapS),ye.texParameteri(vr,iu,dt.wrapT),Qe.ext_texture_filter_anisotropic&&ye.texParameteri(vr,mc,dt.anisotropic),dt.genMipmaps&&(ye.hint(qo,dt.mipmapHint),ye.generateMipmap(vr))}var Xo=0,is={},as=Ct.maxTextureUnits,bo=Array(as).map(function(){return null});function zi(dt){wr.call(this),this.mipmask=0,this.internalformat=ms,this.id=Xo++,this.refCount=1,this.target=dt,this.texture=ye.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ya,Tr.profile&&(this.stats={size:0})}function Ko(dt){ye.activeTexture(su),ye.bindTexture(dt.target,dt.texture)}function Sa(){var dt=bo[0];dt?ye.bindTexture(dt.target,dt.texture):ye.bindTexture(Ts,null)}function Ao(dt){var vr=dt.texture;xe(vr,"must not double destroy texture");var sr=dt.unit,On=dt.target;sr>=0&&(ye.activeTexture(su+sr),ye.bindTexture(On,null),bo[sr]=null),ye.deleteTexture(vr),dt.texture=null,dt.params=null,dt.pixels=null,dt.refCount=0,delete is[dt.id],dr.textureCount--}o(zi.prototype,{bind:function(){var dt=this;dt.bindCount+=1;var vr=dt.unit;if(vr<0){for(var sr=0;sr<as;++sr){var On=bo[sr];if(On){if(On.bindCount>0)continue;On.unit=-1}bo[sr]=dt,vr=sr;break}vr>=as&&xe.raise("insufficient number of texture units"),Tr.profile&&dr.maxTextureUnits<vr+1&&(dr.maxTextureUnits=vr+1),dt.unit=vr,ye.activeTexture(su+vr),ye.bindTexture(dt.target,dt.texture)}return vr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ao(this)}});function vi(dt,vr){var sr=new zi(Ts);is[sr.id]=sr,dr.textureCount++;function On(Ze,It){var Jt=sr.texInfo;Ya.call(Jt);var fr=ra();return typeof Ze=="number"?typeof It=="number"?wi(fr,Ze|0,It|0):wi(fr,Ze|0,Ze|0):Ze?(xe.type(Ze,"object","invalid arguments to regl.texture"),Do(Jt,Ze),$i(fr,Ze)):wi(fr,1,1),Jt.genMipmaps&&(fr.mipmask=(fr.width<<1)-1),sr.mipmask=fr.mipmask,Pr(sr,fr),xe.texture2D(Jt,fr,Ct),sr.internalformat=fr.internalformat,On.width=fr.width,On.height=fr.height,Ko(sr),uo(fr,Ts),xo(Jt,Ts),Sa(),Yo(fr),Tr.profile&&(sr.stats.size=Bn(sr.internalformat,sr.type,fr.width,fr.height,Jt.genMipmaps,!1)),On.format=Kr[sr.internalformat],On.type=Mn[sr.type],On.mag=Nr[Jt.magFilter],On.min=En[Jt.minFilter],On.wrapS=on[Jt.wrapS],On.wrapT=on[Jt.wrapT],On}function ea(Ze,It,Jt,fr){xe(!!Ze,"must specify image data");var Ft=It|0,Dt=Jt|0,zt=fr|0,qe=Cn();return Pr(qe,sr),qe.width=0,qe.height=0,xn(qe,Ze),qe.width=qe.width||(sr.width>>zt)-Ft,qe.height=qe.height||(sr.height>>zt)-Dt,xe(sr.type===qe.type&&sr.format===qe.format&&sr.internalformat===qe.internalformat,"incompatible format for texture.subimage"),xe(Ft>=0&&Dt>=0&&Ft+qe.width<=sr.width&&Dt+qe.height<=sr.height,"texture.subimage write out of bounds"),xe(sr.mipmask&1<<zt,"missing mipmap data"),xe(qe.data||qe.element||qe.needsCopy,"missing image data"),Ko(sr),ki(qe,Ts,Ft,Dt,zt),Sa(),Pn(qe),On}function at(Ze,It){var Jt=Ze|0,fr=It|0||Jt;if(Jt===sr.width&&fr===sr.height)return On;On.width=sr.width=Jt,On.height=sr.height=fr,Ko(sr);for(var Ft=0;sr.mipmask>>Ft;++Ft){var Dt=Jt>>Ft,zt=fr>>Ft;if(!Dt||!zt)break;ye.texImage2D(Ts,Ft,sr.format,Dt,zt,0,sr.format,sr.type,null)}return Sa(),Tr.profile&&(sr.stats.size=Bn(sr.internalformat,sr.type,Jt,fr,!1,!1)),On}return On(dt,vr),On.subimage=ea,On.resize=at,On._reglType="texture2d",On._texture=sr,Tr.profile&&(On.stats=sr.stats),On.destroy=function(){sr.decRef()},On}function Hi(dt,vr,sr,On,ea,at){var Ze=new zi(Zs);is[Ze.id]=Ze,dr.cubeCount++;var It=new Array(6);function Jt(Dt,zt,qe,St,lt,Yt){var tr,jr=Ze.texInfo;for(Ya.call(jr),tr=0;tr<6;++tr)It[tr]=ra();if(typeof Dt=="number"||!Dt){var hn=Dt|0||1;for(tr=0;tr<6;++tr)wi(It[tr],hn,hn)}else if(typeof Dt=="object")if(zt)$i(It[0],Dt),$i(It[1],zt),$i(It[2],qe),$i(It[3],St),$i(It[4],lt),$i(It[5],Yt);else if(Do(jr,Dt),jn(Ze,Dt),"faces"in Dt){var dn=Dt.faces;for(xe(Array.isArray(dn)&&dn.length===6,"cube faces must be a length 6 array"),tr=0;tr<6;++tr)xe(typeof dn[tr]=="object"&&!!dn[tr],"invalid input for cube map face"),Pr(It[tr],Ze),$i(It[tr],dn[tr])}else for(tr=0;tr<6;++tr)$i(It[tr],Dt);else xe.raise("invalid arguments to cube map");for(Pr(Ze,It[0]),xe.optional(function(){Ct.npotTextureCube||xe(cl(Ze.width)&&cl(Ze.height),"your browser does not support non power or two texture dimensions")}),jr.genMipmaps?Ze.mipmask=(It[0].width<<1)-1:Ze.mipmask=It[0].mipmask,xe.textureCube(Ze,jr,It,Ct),Ze.internalformat=It[0].internalformat,Jt.width=It[0].width,Jt.height=It[0].height,Ko(Ze),tr=0;tr<6;++tr)uo(It[tr],Gu+tr);for(xo(jr,Zs),Sa(),Tr.profile&&(Ze.stats.size=Bn(Ze.internalformat,Ze.type,Jt.width,Jt.height,jr.genMipmaps,!0)),Jt.format=Kr[Ze.internalformat],Jt.type=Mn[Ze.type],Jt.mag=Nr[jr.magFilter],Jt.min=En[jr.minFilter],Jt.wrapS=on[jr.wrapS],Jt.wrapT=on[jr.wrapT],tr=0;tr<6;++tr)Yo(It[tr]);return Jt}function fr(Dt,zt,qe,St,lt){xe(!!zt,"must specify image data"),xe(typeof Dt=="number"&&Dt===(Dt|0)&&Dt>=0&&Dt<6,"invalid face");var Yt=qe|0,tr=St|0,jr=lt|0,hn=Cn();return Pr(hn,Ze),hn.width=0,hn.height=0,xn(hn,zt),hn.width=hn.width||(Ze.width>>jr)-Yt,hn.height=hn.height||(Ze.height>>jr)-tr,xe(Ze.type===hn.type&&Ze.format===hn.format&&Ze.internalformat===hn.internalformat,"incompatible format for texture.subimage"),xe(Yt>=0&&tr>=0&&Yt+hn.width<=Ze.width&&tr+hn.height<=Ze.height,"texture.subimage write out of bounds"),xe(Ze.mipmask&1<<jr,"missing mipmap data"),xe(hn.data||hn.element||hn.needsCopy,"missing image data"),Ko(Ze),ki(hn,Gu+Dt,Yt,tr,jr),Sa(),Pn(hn),Jt}function Ft(Dt){var zt=Dt|0;if(zt!==Ze.width){Jt.width=Ze.width=zt,Jt.height=Ze.height=zt,Ko(Ze);for(var qe=0;qe<6;++qe)for(var St=0;Ze.mipmask>>St;++St)ye.texImage2D(Gu+qe,St,Ze.format,zt>>St,zt>>St,0,Ze.format,Ze.type,null);return Sa(),Tr.profile&&(Ze.stats.size=Bn(Ze.internalformat,Ze.type,Jt.width,Jt.height,!1,!0)),Jt}}return Jt(dt,vr,sr,On,ea,at),Jt.subimage=fr,Jt.resize=Ft,Jt._reglType="textureCube",Jt._texture=Ze,Tr.profile&&(Jt.stats=Ze.stats),Jt.destroy=function(){Ze.decRef()},Jt}function Va(){for(var dt=0;dt<as;++dt)ye.activeTexture(su+dt),ye.bindTexture(Ts,null),bo[dt]=null;wt(is).forEach(Ao),dr.cubeCount=0,dr.textureCount=0}Tr.profile&&(dr.getTotalTextureSize=function(){var dt=0;return Object.keys(is).forEach(function(vr){dt+=is[vr].stats.size}),dt});function ko(){for(var dt=0;dt<as;++dt){var vr=bo[dt];vr&&(vr.bindCount=0,vr.unit=-1,bo[dt]=null)}wt(is).forEach(function(sr){sr.texture=ye.createTexture(),ye.bindTexture(sr.target,sr.texture);for(var On=0;On<32;++On)if((sr.mipmask&1<<On)!=0)if(sr.target===Ts)ye.texImage2D(Ts,On,sr.internalformat,sr.width>>On,sr.height>>On,0,sr.internalformat,sr.type,null);else for(var ea=0;ea<6;++ea)ye.texImage2D(Gu+ea,On,sr.internalformat,sr.width>>On,sr.height>>On,0,sr.internalformat,sr.type,null);xo(sr.texInfo,sr.target)})}function sl(){for(var dt=0;dt<as;++dt){var vr=bo[dt];vr&&(vr.bindCount=0,vr.unit=-1,bo[dt]=null),ye.activeTexture(su+dt),ye.bindTexture(Ts,null),ye.bindTexture(Zs,null)}}return{create2D:vi,createCube:Hi,clear:Va,getTexture:function(dt){return null},restore:ko,refresh:sl}}var Wn=36161,ri=32854,ta=32855,Da=36194,gn=33189,yn=36168,yo=34041,ga=35907,Na=34836,xa=34842,ao=34843,Mi=[];Mi[ri]=2,Mi[ta]=2,Mi[Da]=2,Mi[gn]=2,Mi[yn]=1,Mi[yo]=4,Mi[ga]=4,Mi[Na]=16,Mi[xa]=8,Mi[ao]=6;function ho(ye,Qe,Ct){return Mi[ye]*Qe*Ct}var Ni=function(ye,Qe,Ct,pr,Ir){var dr={rgba4:ri,rgb565:Da,"rgb5 a1":ta,depth:gn,stencil:yn,"depth stencil":yo};Qe.ext_srgb&&(dr.srgba=ga),Qe.ext_color_buffer_half_float&&(dr.rgba16f=xa,dr.rgb16f=ao),Qe.webgl_color_buffer_float&&(dr.rgba32f=Na);var Tr=[];Object.keys(dr).forEach(function(Yr){var Qr=dr[Yr];Tr[Qr]=Yr});var Wr=0,Gr={};function en(Yr){this.id=Wr++,this.refCount=1,this.renderbuffer=Yr,this.format=ri,this.width=0,this.height=0,Ir.profile&&(this.stats={size:0})}en.prototype.decRef=function(){--this.refCount<=0&&rn(this)};function rn(Yr){var Qr=Yr.renderbuffer;xe(Qr,"must not double destroy renderbuffer"),ye.bindRenderbuffer(Wn,null),ye.deleteRenderbuffer(Qr),Yr.renderbuffer=null,Yr.refCount=0,delete Gr[Yr.id],pr.renderbufferCount--}function $r(Yr,Qr){var $t=new en(ye.createRenderbuffer());Gr[$t.id]=$t,pr.renderbufferCount++;function Sr(Mn,Nr){var En=0,on=0,Qn=ri;if(typeof Mn=="object"&&Mn){var wr=Mn;if("shape"in wr){var Pr=wr.shape;xe(Array.isArray(Pr)&&Pr.length>=2,"invalid renderbuffer shape"),En=Pr[0]|0,on=Pr[1]|0}else"radius"in wr&&(En=on=wr.radius|0),"width"in wr&&(En=wr.width|0),"height"in wr&&(on=wr.height|0);"format"in wr&&(xe.parameter(wr.format,dr,"invalid renderbuffer format"),Qn=dr[wr.format])}else typeof Mn=="number"?(En=Mn|0,typeof Nr=="number"?on=Nr|0:on=En):Mn?xe.raise("invalid arguments to renderbuffer constructor"):En=on=1;if(xe(En>0&&on>0&&En<=Ct.maxRenderbufferSize&&on<=Ct.maxRenderbufferSize,"invalid renderbuffer size"),!(En===$t.width&&on===$t.height&&Qn===$t.format))return Sr.width=$t.width=En,Sr.height=$t.height=on,$t.format=Qn,ye.bindRenderbuffer(Wn,$t.renderbuffer),ye.renderbufferStorage(Wn,Qn,En,on),xe(ye.getError()===0,"invalid render buffer format"),Ir.profile&&($t.stats.size=ho($t.format,$t.width,$t.height)),Sr.format=Tr[$t.format],Sr}function Kr(Mn,Nr){var En=Mn|0,on=Nr|0||En;return En===$t.width&&on===$t.height||(xe(En>0&&on>0&&En<=Ct.maxRenderbufferSize&&on<=Ct.maxRenderbufferSize,"invalid renderbuffer size"),Sr.width=$t.width=En,Sr.height=$t.height=on,ye.bindRenderbuffer(Wn,$t.renderbuffer),ye.renderbufferStorage(Wn,$t.format,En,on),xe(ye.getError()===0,"invalid render buffer format"),Ir.profile&&($t.stats.size=ho($t.format,$t.width,$t.height))),Sr}return Sr(Yr,Qr),Sr.resize=Kr,Sr._reglType="renderbuffer",Sr._renderbuffer=$t,Ir.profile&&(Sr.stats=$t.stats),Sr.destroy=function(){$t.decRef()},Sr}Ir.profile&&(pr.getTotalRenderbufferSize=function(){var Yr=0;return Object.keys(Gr).forEach(function(Qr){Yr+=Gr[Qr].stats.size}),Yr});function ln(){wt(Gr).forEach(function(Yr){Yr.renderbuffer=ye.createRenderbuffer(),ye.bindRenderbuffer(Wn,Yr.renderbuffer),ye.renderbufferStorage(Wn,Yr.format,Yr.width,Yr.height)}),ye.bindRenderbuffer(Wn,null)}return{create:$r,clear:function(){wt(Gr).forEach(rn)},restore:ln}},Qi=36160,Gi=36161,ba=3553,ka=34069,No=36064,Ro=36096,ws=36128,Vo=33306,Bs=36053,Go=36054,el=36055,Bl=36057,ku=36061,Eu=36193,zl=5121,lu=5126,Ks=6407,tl=6408,cu=6402,Xn=[Ks,tl],oa=[];oa[tl]=4,oa[Ks]=3;var la=[];la[zl]=1,la[lu]=4,la[Eu]=2;var _n=32854,Bo=32855,a=36194,u=33189,s=36168,f=34041,T=35907,W=34836,K=34842,ue=34843,Se=[_n,Bo,a,T,K,ue,W],Ie={};Ie[Bs]="complete",Ie[Go]="incomplete attachment",Ie[Bl]="incomplete dimensions",Ie[el]="incomplete, missing attachment",Ie[ku]="unsupported";function We(ye,Qe,Ct,pr,Ir,dr){var Tr={cur:null,next:null,dirty:!1,setFBO:null},Wr=["rgba"],Gr=["rgba4","rgb565","rgb5 a1"];Qe.ext_srgb&&Gr.push("srgba"),Qe.ext_color_buffer_half_float&&Gr.push("rgba16f","rgb16f"),Qe.webgl_color_buffer_float&&Gr.push("rgba32f");var en=["uint8"];Qe.oes_texture_half_float&&en.push("half float","float16"),Qe.oes_texture_float&&en.push("float","float32");function rn(Xr,xn,Tn){this.target=Xr,this.texture=xn,this.renderbuffer=Tn;var ki=0,Ti=0;xn?(ki=xn.width,Ti=xn.height):Tn&&(ki=Tn.width,Ti=Tn.height),this.width=ki,this.height=Ti}function $r(Xr){Xr&&(Xr.texture&&Xr.texture._texture.decRef(),Xr.renderbuffer&&Xr.renderbuffer._renderbuffer.decRef())}function ln(Xr,xn,Tn){if(!!Xr)if(Xr.texture){var ki=Xr.texture._texture,Ti=Math.max(1,ki.width),Cn=Math.max(1,ki.height);xe(Ti===xn&&Cn===Tn,"inconsistent width/height for supplied texture"),ki.refCount+=1}else{var Pn=Xr.renderbuffer._renderbuffer;xe(Pn.width===xn&&Pn.height===Tn,"inconsistent width/height for renderbuffer"),Pn.refCount+=1}}function Yr(Xr,xn){xn&&(xn.texture?ye.framebufferTexture2D(Qi,Xr,xn.target,xn.texture._texture.texture,0):ye.framebufferRenderbuffer(Qi,Xr,Gi,xn.renderbuffer._renderbuffer.renderbuffer))}function Qr(Xr){var xn=ba,Tn=null,ki=null,Ti=Xr;typeof Xr=="object"&&(Ti=Xr.data,"target"in Xr&&(xn=Xr.target|0)),xe.type(Ti,"function","invalid attachment data");var Cn=Ti._reglType;return Cn==="texture2d"?(Tn=Ti,xe(xn===ba)):Cn==="textureCube"?(Tn=Ti,xe(xn>=ka&&xn<ka+6,"invalid cube map target")):Cn==="renderbuffer"?(ki=Ti,xn=Gi):xe.raise("invalid regl object for attachment"),new rn(xn,Tn,ki)}function $t(Xr,xn,Tn,ki,Ti){if(Tn){var Cn=pr.create2D({width:Xr,height:xn,format:ki,type:Ti});return Cn._texture.refCount=0,new rn(ba,Cn,null)}else{var Pn=Ir.create({width:Xr,height:xn,format:ki});return Pn._renderbuffer.refCount=0,new rn(Gi,null,Pn)}}function Sr(Xr){return Xr&&(Xr.texture||Xr.renderbuffer)}function Kr(Xr,xn,Tn){Xr&&(Xr.texture?Xr.texture.resize(xn,Tn):Xr.renderbuffer&&Xr.renderbuffer.resize(xn,Tn),Xr.width=xn,Xr.height=Tn)}var Mn=0,Nr={};function En(){this.id=Mn++,Nr[this.id]=this,this.framebuffer=ye.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function on(Xr){Xr.colorAttachments.forEach($r),$r(Xr.depthAttachment),$r(Xr.stencilAttachment),$r(Xr.depthStencilAttachment)}function Qn(Xr){var xn=Xr.framebuffer;xe(xn,"must not double destroy framebuffer"),ye.deleteFramebuffer(xn),Xr.framebuffer=null,dr.framebufferCount--,delete Nr[Xr.id]}function wr(Xr){var xn;ye.bindFramebuffer(Qi,Xr.framebuffer);var Tn=Xr.colorAttachments;for(xn=0;xn<Tn.length;++xn)Yr(No+xn,Tn[xn]);for(xn=Tn.length;xn<Ct.maxColorAttachments;++xn)ye.framebufferTexture2D(Qi,No+xn,ba,null,0);ye.framebufferTexture2D(Qi,Vo,ba,null,0),ye.framebufferTexture2D(Qi,Ro,ba,null,0),ye.framebufferTexture2D(Qi,ws,ba,null,0),Yr(Ro,Xr.depthAttachment),Yr(ws,Xr.stencilAttachment),Yr(Vo,Xr.depthStencilAttachment);var ki=ye.checkFramebufferStatus(Qi);!ye.isContextLost()&&ki!==Bs&&xe.raise("framebuffer configuration not supported, status = "+Ie[ki]),ye.bindFramebuffer(Qi,Tr.next?Tr.next.framebuffer:null),Tr.cur=Tr.next,ye.getError()}function Pr(Xr,xn){var Tn=new En;dr.framebufferCount++;function ki(Cn,Pn){var yi;xe(Tr.next!==Tn,"can not update framebuffer which is currently in use");var wi=0,$i=0,uo=!0,po=!0,ra=null,Yo=!0,Ya="rgba",Do="uint8",xo=1,Xo=null,is=null,as=null,bo=!1;if(typeof Cn=="number")wi=Cn|0,$i=Pn|0||wi;else if(!Cn)wi=$i=1;else{xe.type(Cn,"object","invalid arguments for framebuffer");var zi=Cn;if("shape"in zi){var Ko=zi.shape;xe(Array.isArray(Ko)&&Ko.length>=2,"invalid shape for framebuffer"),wi=Ko[0],$i=Ko[1]}else"radius"in zi&&(wi=$i=zi.radius),"width"in zi&&(wi=zi.width),"height"in zi&&($i=zi.height);("color"in zi||"colors"in zi)&&(ra=zi.color||zi.colors,Array.isArray(ra)&&xe(ra.length===1||Qe.webgl_draw_buffers,"multiple render targets not supported")),ra||("colorCount"in zi&&(xo=zi.colorCount|0,xe(xo>0,"invalid color buffer count")),"colorTexture"in zi&&(Yo=!!zi.colorTexture,Ya="rgba4"),"colorType"in zi&&(Do=zi.colorType,Yo?(xe(Qe.oes_texture_float||!(Do==="float"||Do==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),xe(Qe.oes_texture_half_float||!(Do==="half float"||Do==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Do==="half float"||Do==="float16"?(xe(Qe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ya="rgba16f"):(Do==="float"||Do==="float32")&&(xe(Qe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ya="rgba32f"),xe.oneOf(Do,en,"invalid color type")),"colorFormat"in zi&&(Ya=zi.colorFormat,Wr.indexOf(Ya)>=0?Yo=!0:Gr.indexOf(Ya)>=0?Yo=!1:xe.optional(function(){Yo?xe.oneOf(zi.colorFormat,Wr,"invalid color format for texture"):xe.oneOf(zi.colorFormat,Gr,"invalid color format for renderbuffer")}))),("depthTexture"in zi||"depthStencilTexture"in zi)&&(bo=!!(zi.depthTexture||zi.depthStencilTexture),xe(!bo||Qe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in zi&&(typeof zi.depth=="boolean"?uo=zi.depth:(Xo=zi.depth,po=!1)),"stencil"in zi&&(typeof zi.stencil=="boolean"?po=zi.stencil:(is=zi.stencil,uo=!1)),"depthStencil"in zi&&(typeof zi.depthStencil=="boolean"?uo=po=zi.depthStencil:(as=zi.depthStencil,uo=!1,po=!1))}var Sa=null,Ao=null,vi=null,Hi=null;if(Array.isArray(ra))Sa=ra.map(Qr);else if(ra)Sa=[Qr(ra)];else for(Sa=new Array(xo),yi=0;yi<xo;++yi)Sa[yi]=$t(wi,$i,Yo,Ya,Do);xe(Qe.webgl_draw_buffers||Sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),xe(Sa.length<=Ct.maxColorAttachments,"too many color attachments, not supported"),wi=wi||Sa[0].width,$i=$i||Sa[0].height,Xo?Ao=Qr(Xo):uo&&!po&&(Ao=$t(wi,$i,bo,"depth","uint32")),is?vi=Qr(is):po&&!uo&&(vi=$t(wi,$i,!1,"stencil","uint8")),as?Hi=Qr(as):!Xo&&!is&&po&&uo&&(Hi=$t(wi,$i,bo,"depth stencil","depth stencil")),xe(!!Xo+!!is+!!as<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Va=null;for(yi=0;yi<Sa.length;++yi)if(ln(Sa[yi],wi,$i),xe(!Sa[yi]||Sa[yi].texture&&Xn.indexOf(Sa[yi].texture._texture.format)>=0||Sa[yi].renderbuffer&&Se.indexOf(Sa[yi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+yi+" is invalid"),Sa[yi]&&Sa[yi].texture){var ko=oa[Sa[yi].texture._texture.format]*la[Sa[yi].texture._texture.type];Va===null?Va=ko:xe(Va===ko,"all color attachments much have the same number of bits per pixel.")}return ln(Ao,wi,$i),xe(!Ao||Ao.texture&&Ao.texture._texture.format===cu||Ao.renderbuffer&&Ao.renderbuffer._renderbuffer.format===u,"invalid depth attachment for framebuffer object"),ln(vi,wi,$i),xe(!vi||vi.renderbuffer&&vi.renderbuffer._renderbuffer.format===s,"invalid stencil attachment for framebuffer object"),ln(Hi,wi,$i),xe(!Hi||Hi.texture&&Hi.texture._texture.format===f||Hi.renderbuffer&&Hi.renderbuffer._renderbuffer.format===f,"invalid depth-stencil attachment for framebuffer object"),on(Tn),Tn.width=wi,Tn.height=$i,Tn.colorAttachments=Sa,Tn.depthAttachment=Ao,Tn.stencilAttachment=vi,Tn.depthStencilAttachment=Hi,ki.color=Sa.map(Sr),ki.depth=Sr(Ao),ki.stencil=Sr(vi),ki.depthStencil=Sr(Hi),ki.width=Tn.width,ki.height=Tn.height,wr(Tn),ki}function Ti(Cn,Pn){xe(Tr.next!==Tn,"can not resize a framebuffer which is currently in use");var yi=Math.max(Cn|0,1),wi=Math.max(Pn|0||yi,1);if(yi===Tn.width&&wi===Tn.height)return ki;for(var $i=Tn.colorAttachments,uo=0;uo<$i.length;++uo)Kr($i[uo],yi,wi);return Kr(Tn.depthAttachment,yi,wi),Kr(Tn.stencilAttachment,yi,wi),Kr(Tn.depthStencilAttachment,yi,wi),Tn.width=ki.width=yi,Tn.height=ki.height=wi,wr(Tn),ki}return ki(Xr,xn),o(ki,{resize:Ti,_reglType:"framebuffer",_framebuffer:Tn,destroy:function(){Qn(Tn),on(Tn)},use:function(Cn){Tr.setFBO({framebuffer:ki},Cn)}})}function jn(Xr){var xn=Array(6);function Tn(Ti){var Cn;xe(xn.indexOf(Tr.next)<0,"can not update framebuffer which is currently in use");var Pn={color:null},yi=0,wi=null,$i="rgba",uo="uint8",po=1;if(typeof Ti=="number")yi=Ti|0;else if(!Ti)yi=1;else{xe.type(Ti,"object","invalid arguments for framebuffer");var ra=Ti;if("shape"in ra){var Yo=ra.shape;xe(Array.isArray(Yo)&&Yo.length>=2,"invalid shape for framebuffer"),xe(Yo[0]===Yo[1],"cube framebuffer must be square"),yi=Yo[0]}else"radius"in ra&&(yi=ra.radius|0),"width"in ra?(yi=ra.width|0,"height"in ra&&xe(ra.height===yi,"must be square")):"height"in ra&&(yi=ra.height|0);("color"in ra||"colors"in ra)&&(wi=ra.color||ra.colors,Array.isArray(wi)&&xe(wi.length===1||Qe.webgl_draw_buffers,"multiple render targets not supported")),wi||("colorCount"in ra&&(po=ra.colorCount|0,xe(po>0,"invalid color buffer count")),"colorType"in ra&&(xe.oneOf(ra.colorType,en,"invalid color type"),uo=ra.colorType),"colorFormat"in ra&&($i=ra.colorFormat,xe.oneOf(ra.colorFormat,Wr,"invalid color format for texture"))),"depth"in ra&&(Pn.depth=ra.depth),"stencil"in ra&&(Pn.stencil=ra.stencil),"depthStencil"in ra&&(Pn.depthStencil=ra.depthStencil)}var Ya;if(wi)if(Array.isArray(wi))for(Ya=[],Cn=0;Cn<wi.length;++Cn)Ya[Cn]=wi[Cn];else Ya=[wi];else{Ya=Array(po);var Do={radius:yi,format:$i,type:uo};for(Cn=0;Cn<po;++Cn)Ya[Cn]=pr.createCube(Do)}for(Pn.color=Array(Ya.length),Cn=0;Cn<Ya.length;++Cn){var xo=Ya[Cn];xe(typeof xo=="function"&&xo._reglType==="textureCube","invalid cube map"),yi=yi||xo.width,xe(xo.width===yi&&xo.height===yi,"invalid cube map shape"),Pn.color[Cn]={target:ka,data:Ya[Cn]}}for(Cn=0;Cn<6;++Cn){for(var Xo=0;Xo<Ya.length;++Xo)Pn.color[Xo].target=ka+Cn;Cn>0&&(Pn.depth=xn[0].depth,Pn.stencil=xn[0].stencil,Pn.depthStencil=xn[0].depthStencil),xn[Cn]?xn[Cn](Pn):xn[Cn]=Pr(Pn)}return o(Tn,{width:yi,height:yi,color:Ya})}function ki(Ti){var Cn,Pn=Ti|0;if(xe(Pn>0&&Pn<=Ct.maxCubeMapSize,"invalid radius for cube fbo"),Pn===Tn.width)return Tn;var yi=Tn.color;for(Cn=0;Cn<yi.length;++Cn)yi[Cn].resize(Pn);for(Cn=0;Cn<6;++Cn)xn[Cn].resize(Pn);return Tn.width=Tn.height=Pn,Tn}return Tn(Xr),o(Tn,{faces:xn,resize:ki,_reglType:"framebufferCube",destroy:function(){xn.forEach(function(Ti){Ti.destroy()})}})}function Jr(){Tr.cur=null,Tr.next=null,Tr.dirty=!0,wt(Nr).forEach(function(Xr){Xr.framebuffer=ye.createFramebuffer(),wr(Xr)})}return o(Tr,{getFramebuffer:function(Xr){if(typeof Xr=="function"&&Xr._reglType==="framebuffer"){var xn=Xr._framebuffer;if(xn instanceof En)return xn}return null},create:Pr,createCube:jn,clear:function(){wt(Nr).forEach(Qn)},restore:Jr})}var Xe=5126,Je=34962,xt=34963,_t=["attributes","elements","offset","count","primitive","instances"];function Pt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Xe,this.offset=0,this.stride=0,this.divisor=0}function ft(ye,Qe,Ct,pr,Ir,dr,Tr){for(var Wr=Ct.maxAttributes,Gr=new Array(Wr),en=0;en<Wr;++en)Gr[en]=new Pt;var rn=0,$r={},ln={Record:Pt,scope:{},state:Gr,currentVAO:null,targetVAO:null,restore:Qr()?on:function(){},createVAO:Qn,getVAO:Sr,destroyBuffer:Yr,setVAO:Qr()?Kr:Mn,clear:Qr()?Nr:function(){}};function Yr(wr){for(var Pr=0;Pr<Gr.length;++Pr){var jn=Gr[Pr];jn.buffer===wr&&(ye.disableVertexAttribArray(Pr),jn.buffer=null)}}function Qr(){return Qe.oes_vertex_array_object}function $t(){return Qe.angle_instanced_arrays}function Sr(wr){return typeof wr=="function"&&wr._vao?wr._vao:null}function Kr(wr){if(wr!==ln.currentVAO){var Pr=Qr();wr?Pr.bindVertexArrayOES(wr.vao):Pr.bindVertexArrayOES(null),ln.currentVAO=wr}}function Mn(wr){if(wr!==ln.currentVAO){if(wr)wr.bindAttrs();else{for(var Pr=$t(),jn=0;jn<Gr.length;++jn){var Jr=Gr[jn];Jr.buffer?(ye.enableVertexAttribArray(jn),Jr.buffer.bind(),ye.vertexAttribPointer(jn,Jr.size,Jr.type,Jr.normalized,Jr.stride,Jr.offfset),Pr&&Jr.divisor&&Pr.vertexAttribDivisorANGLE(jn,Jr.divisor)):(ye.disableVertexAttribArray(jn),ye.vertexAttrib4f(jn,Jr.x,Jr.y,Jr.z,Jr.w))}Tr.elements?ye.bindBuffer(xt,Tr.elements.buffer.buffer):ye.bindBuffer(xt,null)}ln.currentVAO=wr}}function Nr(){wt($r).forEach(function(wr){wr.destroy()})}function En(){this.id=++rn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var wr=Qr();wr?this.vao=wr.createVertexArrayOES():this.vao=null,$r[this.id]=this,this.buffers=[]}En.prototype.bindAttrs=function(){for(var wr=$t(),Pr=this.attributes,jn=0;jn<Pr.length;++jn){var Jr=Pr[jn];Jr.buffer?(ye.enableVertexAttribArray(jn),ye.bindBuffer(Je,Jr.buffer.buffer),ye.vertexAttribPointer(jn,Jr.size,Jr.type,Jr.normalized,Jr.stride,Jr.offset),wr&&Jr.divisor&&wr.vertexAttribDivisorANGLE(jn,Jr.divisor)):(ye.disableVertexAttribArray(jn),ye.vertexAttrib4f(jn,Jr.x,Jr.y,Jr.z,Jr.w))}for(var Xr=Pr.length;Xr<Wr;++Xr)ye.disableVertexAttribArray(Xr);var xn=dr.getElements(this.elements);xn?ye.bindBuffer(xt,xn.buffer.buffer):ye.bindBuffer(xt,null)},En.prototype.refresh=function(){var wr=Qr();wr&&(wr.bindVertexArrayOES(this.vao),this.bindAttrs(),ln.currentVAO=null,wr.bindVertexArrayOES(null))},En.prototype.destroy=function(){if(this.vao){var wr=Qr();this===ln.currentVAO&&(ln.currentVAO=null,wr.bindVertexArrayOES(null)),wr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),$r[this.id]&&(delete $r[this.id],pr.vaoCount-=1)};function on(){var wr=Qr();wr&&wt($r).forEach(function(Pr){Pr.refresh()})}function Qn(wr){var Pr=new En;pr.vaoCount+=1;function jn(Jr){var Xr;if(Array.isArray(Jr))Xr=Jr,Pr.elements&&Pr.ownsElements&&Pr.elements.destroy(),Pr.elements=null,Pr.ownsElements=!1,Pr.offset=0,Pr.count=0,Pr.instances=-1,Pr.primitive=4;else{if(xe(typeof Jr=="object","invalid arguments for create vao"),xe("attributes"in Jr,"must specify attributes for vao"),Jr.elements){var xn=Jr.elements;Pr.ownsElements?typeof xn=="function"&&xn._reglType==="elements"?(Pr.elements.destroy(),Pr.ownsElements=!1):(Pr.elements(xn),Pr.ownsElements=!1):dr.getElements(Jr.elements)?(Pr.elements=Jr.elements,Pr.ownsElements=!1):(Pr.elements=dr.create(Jr.elements),Pr.ownsElements=!0)}else Pr.elements=null,Pr.ownsElements=!1;Xr=Jr.attributes,Pr.offset=0,Pr.count=-1,Pr.instances=-1,Pr.primitive=4,Pr.elements&&(Pr.count=Pr.elements._elements.vertCount,Pr.primitive=Pr.elements._elements.primType),"offset"in Jr&&(Pr.offset=Jr.offset|0),"count"in Jr&&(Pr.count=Jr.count|0),"instances"in Jr&&(Pr.instances=Jr.instances|0),"primitive"in Jr&&(xe(Jr.primitive in Gt,"bad primitive type: "+Jr.primitive),Pr.primitive=Gt[Jr.primitive]),xe.optional(()=>{for(var uo=Object.keys(Jr),po=0;po<uo.length;++po)xe(_t.indexOf(uo[po])>=0,'invalid option for vao: "'+uo[po]+'" valid options are '+_t)}),xe(Array.isArray(Xr),"attributes must be an array")}xe(Xr.length<Wr,"too many attributes"),xe(Xr.length>0,"must specify at least one attribute");var Tn={},ki=Pr.attributes;ki.length=Xr.length;for(var Ti=0;Ti<Xr.length;++Ti){var Cn=Xr[Ti],Pn=ki[Ti]=new Pt,yi=Cn.data||Cn;if(Array.isArray(yi)||F(yi)||rt(yi)){var wi;Pr.buffers[Ti]&&(wi=Pr.buffers[Ti],F(yi)&&wi._buffer.byteLength>=yi.byteLength?wi.subdata(yi):(wi.destroy(),Pr.buffers[Ti]=null)),Pr.buffers[Ti]||(wi=Pr.buffers[Ti]=Ir.create(Cn,Je,!1,!0)),Pn.buffer=Ir.getBuffer(wi),Pn.size=Pn.buffer.dimension|0,Pn.normalized=!1,Pn.type=Pn.buffer.dtype,Pn.offset=0,Pn.stride=0,Pn.divisor=0,Pn.state=1,Tn[Ti]=1}else Ir.getBuffer(Cn)?(Pn.buffer=Ir.getBuffer(Cn),Pn.size=Pn.buffer.dimension|0,Pn.normalized=!1,Pn.type=Pn.buffer.dtype,Pn.offset=0,Pn.stride=0,Pn.divisor=0,Pn.state=1):Ir.getBuffer(Cn.buffer)?(Pn.buffer=Ir.getBuffer(Cn.buffer),Pn.size=(+Cn.size||Pn.buffer.dimension)|0,Pn.normalized=!!Cn.normalized||!1,"type"in Cn?(xe.parameter(Cn.type,Ue,"invalid buffer type"),Pn.type=Ue[Cn.type]):Pn.type=Pn.buffer.dtype,Pn.offset=(Cn.offset||0)|0,Pn.stride=(Cn.stride||0)|0,Pn.divisor=(Cn.divisor||0)|0,Pn.state=1,xe(Pn.size>=1&&Pn.size<=4,"size must be between 1 and 4"),xe(Pn.offset>=0,"invalid offset"),xe(Pn.stride>=0&&Pn.stride<=255,"stride must be between 0 and 255"),xe(Pn.divisor>=0,"divisor must be positive"),xe(!Pn.divisor||!!Qe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Cn?(xe(Ti>0,"first attribute must not be a constant"),Pn.x=+Cn.x||0,Pn.y=+Cn.y||0,Pn.z=+Cn.z||0,Pn.w=+Cn.w||0,Pn.state=2):xe(!1,"invalid attribute spec for location "+Ti)}for(var $i=0;$i<Pr.buffers.length;++$i)!Tn[$i]&&Pr.buffers[$i]&&(Pr.buffers[$i].destroy(),Pr.buffers[$i]=null);return Pr.refresh(),jn}return jn.destroy=function(){for(var Jr=0;Jr<Pr.buffers.length;++Jr)Pr.buffers[Jr]&&Pr.buffers[Jr].destroy();Pr.buffers.length=0,Pr.ownsElements&&(Pr.elements.destroy(),Pr.elements=null,Pr.ownsElements=!1),Pr.destroy()},jn._vao=Pr,jn._reglType="vao",jn(wr)}return ln}var Ot=35632,jt=35633,er=35718,br=35721;function yr(ye,Qe,Ct,pr){var Ir={},dr={};function Tr($t,Sr,Kr,Mn){this.name=$t,this.id=Sr,this.location=Kr,this.info=Mn}function Wr($t,Sr){for(var Kr=0;Kr<$t.length;++Kr)if($t[Kr].id===Sr.id){$t[Kr].location=Sr.location;return}$t.push(Sr)}function Gr($t,Sr,Kr){var Mn=$t===Ot?Ir:dr,Nr=Mn[Sr];if(!Nr){var En=Qe.str(Sr);Nr=ye.createShader($t),ye.shaderSource(Nr,En),ye.compileShader(Nr),xe.shaderError(ye,Nr,En,$t,Kr),Mn[Sr]=Nr}return Nr}var en={},rn=[],$r=0;function ln($t,Sr){this.id=$r++,this.fragId=$t,this.vertId=Sr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,pr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Yr($t,Sr,Kr){var Mn,Nr,En=Gr(Ot,$t.fragId),on=Gr(jt,$t.vertId),Qn=$t.program=ye.createProgram();if(ye.attachShader(Qn,En),ye.attachShader(Qn,on),Kr)for(Mn=0;Mn<Kr.length;++Mn){var wr=Kr[Mn];ye.bindAttribLocation(Qn,wr[0],wr[1])}ye.linkProgram(Qn),xe.linkError(ye,Qn,Qe.str($t.fragId),Qe.str($t.vertId),Sr);var Pr=ye.getProgramParameter(Qn,er);pr.profile&&($t.stats.uniformsCount=Pr);var jn=$t.uniforms;for(Mn=0;Mn<Pr;++Mn)if(Nr=ye.getActiveUniform(Qn,Mn),Nr)if(Nr.size>1)for(var Jr=0;Jr<Nr.size;++Jr){var Xr=Nr.name.replace("[0]","["+Jr+"]");Wr(jn,new Tr(Xr,Qe.id(Xr),ye.getUniformLocation(Qn,Xr),Nr))}else Wr(jn,new Tr(Nr.name,Qe.id(Nr.name),ye.getUniformLocation(Qn,Nr.name),Nr));var xn=ye.getProgramParameter(Qn,br);pr.profile&&($t.stats.attributesCount=xn);var Tn=$t.attributes;for(Mn=0;Mn<xn;++Mn)Nr=ye.getActiveAttrib(Qn,Mn),Nr&&Wr(Tn,new Tr(Nr.name,Qe.id(Nr.name),ye.getAttribLocation(Qn,Nr.name),Nr))}pr.profile&&(Ct.getMaxUniformsCount=function(){var $t=0;return rn.forEach(function(Sr){Sr.stats.uniformsCount>$t&&($t=Sr.stats.uniformsCount)}),$t},Ct.getMaxAttributesCount=function(){var $t=0;return rn.forEach(function(Sr){Sr.stats.attributesCount>$t&&($t=Sr.stats.attributesCount)}),$t});function Qr(){Ir={},dr={};for(var $t=0;$t<rn.length;++$t)Yr(rn[$t],null,rn[$t].attributes.map(function(Sr){return[Sr.location,Sr.name]}))}return{clear:function(){var $t=ye.deleteShader.bind(ye);wt(Ir).forEach($t),Ir={},wt(dr).forEach($t),dr={},rn.forEach(function(Sr){ye.deleteProgram(Sr.program)}),rn.length=0,en={},Ct.shaderCount=0},program:function($t,Sr,Kr,Mn){xe.command($t>=0,"missing vertex shader",Kr),xe.command(Sr>=0,"missing fragment shader",Kr);var Nr=en[Sr];Nr||(Nr=en[Sr]={});var En=Nr[$t];if(En&&(En.refCount++,!Mn))return En;var on=new ln(Sr,$t);return Ct.shaderCount++,Yr(on,Kr,Mn),En||(Nr[$t]=on),rn.push(on),o(on,{destroy:function(){if(on.refCount--,on.refCount<=0){ye.deleteProgram(on.program);var Qn=rn.indexOf(on);rn.splice(Qn,1),Ct.shaderCount--}Nr[on.vertId].refCount<=0&&(ye.deleteShader(dr[on.vertId]),delete dr[on.vertId],delete en[on.fragId][on.vertId]),Object.keys(en[on.fragId]).length||(ye.deleteShader(Ir[on.fragId]),delete Ir[on.fragId],delete en[on.fragId])}})},restore:Qr,shader:Gr,frag:-1,vert:-1}}var Cr=6408,zr=5121,un=3333,qr=5126;function Dn(ye,Qe,Ct,pr,Ir,dr,Tr){function Wr(rn){var $r;Qe.next===null?(xe(Ir.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),$r=zr):(xe(Qe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),$r=Qe.next.colorAttachments[0].texture._texture.type,xe.optional(function(){dr.oes_texture_float?(xe($r===zr||$r===qr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),$r===qr&&xe(Tr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):xe($r===zr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ln=0,Yr=0,Qr=pr.framebufferWidth,$t=pr.framebufferHeight,Sr=null;F(rn)?Sr=rn:rn&&(xe.type(rn,"object","invalid arguments to regl.read()"),ln=rn.x|0,Yr=rn.y|0,xe(ln>=0&&ln<pr.framebufferWidth,"invalid x offset for regl.read"),xe(Yr>=0&&Yr<pr.framebufferHeight,"invalid y offset for regl.read"),Qr=(rn.width||pr.framebufferWidth-ln)|0,$t=(rn.height||pr.framebufferHeight-Yr)|0,Sr=rn.data||null),Sr&&($r===zr?xe(Sr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):$r===qr&&xe(Sr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),xe(Qr>0&&Qr+ln<=pr.framebufferWidth,"invalid width for read pixels"),xe($t>0&&$t+Yr<=pr.framebufferHeight,"invalid height for read pixels"),Ct();var Kr=Qr*$t*4;return Sr||($r===zr?Sr=new Uint8Array(Kr):$r===qr&&(Sr=Sr||new Float32Array(Kr))),xe.isTypedArray(Sr,"data buffer for regl.read() must be a typedarray"),xe(Sr.byteLength>=Kr,"data buffer for regl.read() too small"),ye.pixelStorei(un,4),ye.readPixels(ln,Yr,Qr,$t,Cr,$r,Sr),Sr}function Gr(rn){var $r;return Qe.setFBO({framebuffer:rn.framebuffer},function(){$r=Wr(rn)}),$r}function en(rn){return!rn||!("framebuffer"in rn)?Wr(rn):Gr(rn)}return en}function $n(ye){return Array.prototype.slice.call(ye)}function Jn(ye){return $n(ye).join("")}function ii(){var ye=0,Qe=[],Ct=[];function pr($r){for(var ln=0;ln<Ct.length;++ln)if(Ct[ln]===$r)return Qe[ln];var Yr="g"+ye++;return Qe.push(Yr),Ct.push($r),Yr}function Ir(){var $r=[];function ln(){$r.push.apply($r,$n(arguments))}var Yr=[];function Qr(){var $t="v"+ye++;return Yr.push($t),arguments.length>0&&($r.push($t,"="),$r.push.apply($r,$n(arguments)),$r.push(";")),$t}return o(ln,{def:Qr,toString:function(){return Jn([Yr.length>0?"var "+Yr.join(",")+";":"",Jn($r)])}})}function dr(){var $r=Ir(),ln=Ir(),Yr=$r.toString,Qr=ln.toString;function $t(Sr,Kr){ln(Sr,Kr,"=",$r.def(Sr,Kr),";")}return o(function(){$r.apply($r,$n(arguments))},{def:$r.def,entry:$r,exit:ln,save:$t,set:function(Sr,Kr,Mn){$t(Sr,Kr),$r(Sr,Kr,"=",Mn,";")},toString:function(){return Yr()+Qr()}})}function Tr(){var $r=Jn(arguments),ln=dr(),Yr=dr(),Qr=ln.toString,$t=Yr.toString;return o(ln,{then:function(){return ln.apply(ln,$n(arguments)),this},else:function(){return Yr.apply(Yr,$n(arguments)),this},toString:function(){var Sr=$t();return Sr&&(Sr="else{"+Sr+"}"),Jn(["if(",$r,"){",Qr(),"}",Sr])}})}var Wr=Ir(),Gr={};function en($r,ln){var Yr=[];function Qr(){var Nr="a"+Yr.length;return Yr.push(Nr),Nr}ln=ln||0;for(var $t=0;$t<ln;++$t)Qr();var Sr=dr(),Kr=Sr.toString,Mn=Gr[$r]=o(Sr,{arg:Qr,toString:function(){return Jn(["function(",Yr.join(),"){",Kr(),"}"])}});return Mn}function rn(){var $r=['"use strict";',Wr,"return {"];Object.keys(Gr).forEach(function($t){$r.push('"',$t,'":',Gr[$t].toString(),",")}),$r.push("}");var ln=Jn($r).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Yr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Qr=Yr?i.Function.apply(null,Qe.concat(ln)):Function.apply(null,Qe.concat(ln));return Qr.apply(null,Ct)}return{global:Wr,link:pr,block:Ir,proc:en,scope:dr,cond:Tr,compile:rn}}var qi="xyzw".split(""),zn=5121,di=1,Bi=2,bi=0,gi=1,Di=2,pi=3,li=4,Co=5,oo=6,Ho="dither",Lo="blend.enable",qa="blend.color",so="blend.equation",hs="blend.func",ts="depth.enable",Cu="depth.func",ds="depth.range",zs="depth.mask",As="colorMask",gl="cull.enable",rl="cull.face",fu="frontFace",Fu="lineWidth",yl="polygonOffset.enable",js="polygonOffset.offset",_l="sample.alpha",$s="sample.enable",_o="sample.coverage",hu="stencil.enable",Tu="stencil.mask",wu="stencil.func",da="stencil.opFront",rs="stencil.opBack",ps="scissor.enable",du="scissor.box",Au="viewport",Nu="profile",nl="framebuffer",Mu="vert",xl="frag",Us="elements",pu="primitive",il="count",Bu="offset",ns="instances",gc="vao",Pc="Width",Jc="Height",rc=nl+Pc,nc=nl+Jc,nh=Au+Pc,Qc=Au+Jc,wf="drawingBuffer",yc=wf+Pc,qc=wf+Jc,bl=[hs,so,wu,da,rs,_o,Au,du,js],zu=34962,ef=34963,ih=35632,ah=35633,Af=3553,oh=34067,sh=2884,uh=3042,tf=3024,lh=2960,ic=2929,ch=3089,To=32823,Oc=32926,Mf=32928,ac=5126,jl=35664,Sl=35665,_c=35666,Ic=5124,El=35667,oc=35668,sc=35669,rf=35670,Cl=35671,Rc=35672,uc=35673,xc=35674,Ul=35675,Vl=35676,Ls=35678,bc=35680,nf=4,Sc=1028,Gl=1029,af=2304,Tl=2305,fh=32775,hh=32776,Pf=519,al=7680,Of=0,If=1,Hl=32774,dh=513,Lc=36160,Ec=36064,Zo={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],lc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},wl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},cc={frag:ih,vert:ah},Dc={cw:af,ccw:Tl};function kc(ye){return Array.isArray(ye)||F(ye)||rt(ye)}function Lf(ye){return ye.sort(function(Qe,Ct){return Qe===Au?-1:Ct===Au?1:Qe<Ct?-1:1})}function Wo(ye,Qe,Ct,pr){this.thisDep=ye,this.contextDep=Qe,this.propDep=Ct,this.append=pr}function Al(ye){return ye&&!(ye.thisDep||ye.contextDep||ye.propDep)}function wo(ye){return new Wo(!1,!1,!1,ye)}function Wa(ye,Qe){var Ct=ye.type;if(Ct===bi){var pr=ye.data.length;return new Wo(!0,pr>=1,pr>=2,Qe)}else if(Ct===li){var Ir=ye.data;return new Wo(Ir.thisDep,Ir.contextDep,Ir.propDep,Qe)}else{if(Ct===Co)return new Wo(!1,!1,!1,Qe);if(Ct===oo){for(var dr=!1,Tr=!1,Wr=!1,Gr=0;Gr<ye.data.length;++Gr){var en=ye.data[Gr];if(en.type===gi)Wr=!0;else if(en.type===Di)Tr=!0;else if(en.type===pi)dr=!0;else if(en.type===bi){dr=!0;var rn=en.data;rn>=1&&(Tr=!0),rn>=2&&(Wr=!0)}else en.type===li&&(dr=dr||en.data.thisDep,Tr=Tr||en.data.contextDep,Wr=Wr||en.data.propDep)}return new Wo(dr,Tr,Wr,Qe)}else return new Wo(Ct===pi,Ct===Di,Ct===gi,Qe)}}var Df=new Wo(!1,!1,!1,function(){});function kf(ye,Qe,Ct,pr,Ir,dr,Tr,Wr,Gr,en,rn,$r,ln,Yr,Qr){var $t=en.Record,Sr={add:32774,subtract:32778,"reverse subtract":32779};Ct.ext_blend_minmax&&(Sr.min=fh,Sr.max=hh);var Kr=Ct.angle_instanced_arrays,Mn=Ct.webgl_draw_buffers,Nr=Ct.oes_vertex_array_object,En={dirty:!0,profile:Qr.profile},on={},Qn=[],wr={},Pr={};function jn(at){return at.replace(".","_")}function Jr(at,Ze,It){var Jt=jn(at);Qn.push(at),on[Jt]=En[Jt]=!!It,wr[Jt]=Ze}function Xr(at,Ze,It){var Jt=jn(at);Qn.push(at),Array.isArray(It)?(En[Jt]=It.slice(),on[Jt]=It.slice()):En[Jt]=on[Jt]=It,Pr[Jt]=Ze}Jr(Ho,tf),Jr(Lo,uh),Xr(qa,"blendColor",[0,0,0,0]),Xr(so,"blendEquationSeparate",[Hl,Hl]),Xr(hs,"blendFuncSeparate",[If,Of,If,Of]),Jr(ts,ic,!0),Xr(Cu,"depthFunc",dh),Xr(ds,"depthRange",[0,1]),Xr(zs,"depthMask",!0),Xr(As,As,[!0,!0,!0,!0]),Jr(gl,sh),Xr(rl,"cullFace",Gl),Xr(fu,fu,Tl),Xr(Fu,Fu,1),Jr(yl,To),Xr(js,"polygonOffset",[0,0]),Jr(_l,Oc),Jr($s,Mf),Xr(_o,"sampleCoverage",[1,!1]),Jr(hu,lh),Xr(Tu,"stencilMask",-1),Xr(wu,"stencilFunc",[Pf,0,-1]),Xr(da,"stencilOpSeparate",[Sc,al,al,al]),Xr(rs,"stencilOpSeparate",[Gl,al,al,al]),Jr(ps,ch),Xr(du,"scissor",[0,0,ye.drawingBufferWidth,ye.drawingBufferHeight]),Xr(Au,Au,[0,0,ye.drawingBufferWidth,ye.drawingBufferHeight]);var xn={gl:ye,context:ln,strings:Qe,next:on,current:En,draw:$r,elements:dr,buffer:Ir,shader:rn,attributes:en.state,vao:en,uniforms:Gr,framebuffer:Wr,extensions:Ct,timer:Yr,isBufferArgs:kc},Tn={primTypes:Gt,compareFuncs:lc,blendFuncs:Zo,blendEquations:Sr,stencilOps:wl,glTypes:Ue,orientationType:Dc};xe.optional(function(){xn.isArrayLike=Ra}),Mn&&(Tn.backBuffer=[Gl],Tn.drawBuffer=ot(pr.maxDrawbuffers,function(at){return at===0?[0]:ot(at,function(Ze){return Ec+Ze})}));var ki=0;function Ti(){var at=ii(),Ze=at.link,It=at.global;at.id=ki++,at.batchId="0";var Jt=Ze(xn),fr=at.shared={props:"a0"};Object.keys(xn).forEach(function(St){fr[St]=It.def(Jt,".",St)}),xe.optional(function(){at.CHECK=Ze(xe),at.commandStr=xe.guessCommand(),at.command=Ze(at.commandStr),at.assert=function(St,lt,Yt){St("if(!(",lt,"))",this.CHECK,".commandRaise(",Ze(Yt),",",this.command,");")},Tn.invalidBlendCombinations=Rf});var Ft=at.next={},Dt=at.current={};Object.keys(Pr).forEach(function(St){Array.isArray(En[St])&&(Ft[St]=It.def(fr.next,".",St),Dt[St]=It.def(fr.current,".",St))});var zt=at.constants={};Object.keys(Tn).forEach(function(St){zt[St]=It.def(JSON.stringify(Tn[St]))}),at.invoke=function(St,lt){switch(lt.type){case bi:var Yt=["this",fr.context,fr.props,at.batchId];return St.def(Ze(lt.data),".call(",Yt.slice(0,Math.max(lt.data.length+1,4)),")");case gi:return St.def(fr.props,lt.data);case Di:return St.def(fr.context,lt.data);case pi:return St.def("this",lt.data);case li:return lt.data.append(at,St),lt.data.ref;case Co:return lt.data.toString();case oo:return lt.data.map(function(tr){return at.invoke(St,tr)})}},at.attribCache={};var qe={};return at.scopeAttrib=function(St){var lt=Qe.id(St);if(lt in qe)return qe[lt];var Yt=en.scope[lt];Yt||(Yt=en.scope[lt]=new $t);var tr=qe[lt]=Ze(Yt);return tr},at}function Cn(at){var Ze=at.static,It=at.dynamic,Jt;if(Nu in Ze){var fr=!!Ze[Nu];Jt=wo(function(Dt,zt){return fr}),Jt.enable=fr}else if(Nu in It){var Ft=It[Nu];Jt=Wa(Ft,function(Dt,zt){return Dt.invoke(zt,Ft)})}return Jt}function Pn(at,Ze){var It=at.static,Jt=at.dynamic;if(nl in It){var fr=It[nl];return fr?(fr=Wr.getFramebuffer(fr),xe.command(fr,"invalid framebuffer object"),wo(function(Dt,zt){var qe=Dt.link(fr),St=Dt.shared;zt.set(St.framebuffer,".next",qe);var lt=St.context;return zt.set(lt,"."+rc,qe+".width"),zt.set(lt,"."+nc,qe+".height"),qe})):wo(function(Dt,zt){var qe=Dt.shared;zt.set(qe.framebuffer,".next","null");var St=qe.context;return zt.set(St,"."+rc,St+"."+yc),zt.set(St,"."+nc,St+"."+qc),"null"})}else if(nl in Jt){var Ft=Jt[nl];return Wa(Ft,function(Dt,zt){var qe=Dt.invoke(zt,Ft),St=Dt.shared,lt=St.framebuffer,Yt=zt.def(lt,".getFramebuffer(",qe,")");xe.optional(function(){Dt.assert(zt,"!"+qe+"||"+Yt,"invalid framebuffer object")}),zt.set(lt,".next",Yt);var tr=St.context;return zt.set(tr,"."+rc,Yt+"?"+Yt+".width:"+tr+"."+yc),zt.set(tr,"."+nc,Yt+"?"+Yt+".height:"+tr+"."+qc),Yt})}else return null}function yi(at,Ze,It){var Jt=at.static,fr=at.dynamic;function Ft(qe){if(qe in Jt){var St=Jt[qe];xe.commandType(St,"object","invalid "+qe,It.commandStr);var lt=!0,Yt=St.x|0,tr=St.y|0,jr,hn;return"width"in St?(jr=St.width|0,xe.command(jr>=0,"invalid "+qe,It.commandStr)):lt=!1,"height"in St?(hn=St.height|0,xe.command(hn>=0,"invalid "+qe,It.commandStr)):lt=!1,new Wo(!lt&&Ze&&Ze.thisDep,!lt&&Ze&&Ze.contextDep,!lt&&Ze&&Ze.propDep,function(cn,Yn){var kn=cn.shared.context,Vn=jr;"width"in St||(Vn=Yn.def(kn,".",rc,"-",Yt));var Gn=hn;return"height"in St||(Gn=Yn.def(kn,".",nc,"-",tr)),[Yt,tr,Vn,Gn]})}else if(qe in fr){var dn=fr[qe],wn=Wa(dn,function(cn,Yn){var kn=cn.invoke(Yn,dn);xe.optional(function(){cn.assert(Yn,kn+"&&typeof "+kn+'==="object"',"invalid "+qe)});var Vn=cn.shared.context,Gn=Yn.def(kn,".x|0"),Hn=Yn.def(kn,".y|0"),_i=Yn.def('"width" in ',kn,"?",kn,".width|0:","(",Vn,".",rc,"-",Gn,")"),Ba=Yn.def('"height" in ',kn,"?",kn,".height|0:","(",Vn,".",nc,"-",Hn,")");return xe.optional(function(){cn.assert(Yn,_i+">=0&&"+Ba+">=0","invalid "+qe)}),[Gn,Hn,_i,Ba]});return Ze&&(wn.thisDep=wn.thisDep||Ze.thisDep,wn.contextDep=wn.contextDep||Ze.contextDep,wn.propDep=wn.propDep||Ze.propDep),wn}else return Ze?new Wo(Ze.thisDep,Ze.contextDep,Ze.propDep,function(cn,Yn){var kn=cn.shared.context;return[0,0,Yn.def(kn,".",rc),Yn.def(kn,".",nc)]}):null}var Dt=Ft(Au);if(Dt){var zt=Dt;Dt=new Wo(Dt.thisDep,Dt.contextDep,Dt.propDep,function(qe,St){var lt=zt.append(qe,St),Yt=qe.shared.context;return St.set(Yt,"."+nh,lt[2]),St.set(Yt,"."+Qc,lt[3]),lt})}return{viewport:Dt,scissor_box:Ft(du)}}function wi(at,Ze){var It=at.static,Jt=typeof It[xl]=="string"&&typeof It[Mu]=="string";if(Jt){if(Object.keys(Ze.dynamic).length>0)return null;var fr=Ze.static,Ft=Object.keys(fr);if(Ft.length>0&&typeof fr[Ft[0]]=="number"){for(var Dt=[],zt=0;zt<Ft.length;++zt)xe(typeof fr[Ft[zt]]=="number","must specify all vertex attribute locations when using vaos"),Dt.push([fr[Ft[zt]]|0,Ft[zt]]);return Dt}}return null}function $i(at,Ze,It){var Jt=at.static,fr=at.dynamic;function Ft(lt){if(lt in Jt){var Yt=Qe.id(Jt[lt]);xe.optional(function(){rn.shader(cc[lt],Yt,xe.guessCommand())});var tr=wo(function(){return Yt});return tr.id=Yt,tr}else if(lt in fr){var jr=fr[lt];return Wa(jr,function(hn,dn){var wn=hn.invoke(dn,jr),cn=dn.def(hn.shared.strings,".id(",wn,")");return xe.optional(function(){dn(hn.shared.shader,".shader(",cc[lt],",",cn,",",hn.command,");")}),cn})}return null}var Dt=Ft(xl),zt=Ft(Mu),qe=null,St;return Al(Dt)&&Al(zt)?(qe=rn.program(zt.id,Dt.id,null,It),St=wo(function(lt,Yt){return lt.link(qe)})):St=new Wo(Dt&&Dt.thisDep||zt&&zt.thisDep,Dt&&Dt.contextDep||zt&&zt.contextDep,Dt&&Dt.propDep||zt&&zt.propDep,function(lt,Yt){var tr=lt.shared.shader,jr;Dt?jr=Dt.append(lt,Yt):jr=Yt.def(tr,".",xl);var hn;zt?hn=zt.append(lt,Yt):hn=Yt.def(tr,".",Mu);var dn=tr+".program("+hn+","+jr;return xe.optional(function(){dn+=","+lt.command}),Yt.def(dn+")")}),{frag:Dt,vert:zt,progVar:St,program:qe}}function uo(at,Ze){var It=at.static,Jt=at.dynamic,fr={},Ft=!1;function Dt(){if(gc in It){var Yn=It[gc];return Yn!==null&&en.getVAO(Yn)===null&&(Yn=en.createVAO(Yn)),Ft=!0,fr.vao=Yn,wo(function(Vn){var Gn=en.getVAO(Yn);return Gn?Vn.link(Gn):"null"})}else if(gc in Jt){Ft=!0;var kn=Jt[gc];return Wa(kn,function(Vn,Gn){var Hn=Vn.invoke(Gn,kn);return Gn.def(Vn.shared.vao+".getVAO("+Hn+")")})}return null}var zt=Dt(),qe=!1;function St(){if(Us in It){var Yn=It[Us];if(fr.elements=Yn,kc(Yn)){var kn=fr.elements=dr.create(Yn,!0);Yn=dr.getElements(kn),qe=!0}else Yn&&(Yn=dr.getElements(Yn),qe=!0,xe.command(Yn,"invalid elements",Ze.commandStr));var Vn=wo(function(Hn,_i){if(Yn){var Ba=Hn.link(Yn);return Hn.ELEMENTS=Ba,Ba}return Hn.ELEMENTS=null,null});return Vn.value=Yn,Vn}else if(Us in Jt){qe=!0;var Gn=Jt[Us];return Wa(Gn,function(Hn,_i){var Ba=Hn.shared,vo=Ba.isBufferArgs,Pu=Ba.elements,Vs=Hn.invoke(_i,Gn),ju=_i.def("null"),Ea=_i.def(vo,"(",Vs,")"),Ca=Hn.cond(Ea).then(ju,"=",Pu,".createStream(",Vs,");").else(ju,"=",Pu,".getElements(",Vs,");");return xe.optional(function(){Hn.assert(Ca.else,"!"+Vs+"||"+ju,"invalid elements")}),_i.entry(Ca),_i.exit(Hn.cond(Ea).then(Pu,".destroyStream(",ju,");")),Hn.ELEMENTS=ju,ju})}else if(Ft)return new Wo(zt.thisDep,zt.contextDep,zt.propDep,function(Hn,_i){return _i.def(Hn.shared.vao+".currentVAO?"+Hn.shared.elements+".getElements("+Hn.shared.vao+".currentVAO.elements):null")});return null}var lt=St();function Yt(){if(pu in It){var Yn=It[pu];return fr.primitive=Yn,xe.commandParameter(Yn,Gt,"invalid primitve",Ze.commandStr),wo(function(Vn,Gn){return Gt[Yn]})}else if(pu in Jt){var kn=Jt[pu];return Wa(kn,function(Vn,Gn){var Hn=Vn.constants.primTypes,_i=Vn.invoke(Gn,kn);return xe.optional(function(){Vn.assert(Gn,_i+" in "+Hn,"invalid primitive, must be one of "+Object.keys(Gt))}),Gn.def(Hn,"[",_i,"]")})}else{if(qe)return Al(lt)?lt.value?wo(function(Vn,Gn){return Gn.def(Vn.ELEMENTS,".primType")}):wo(function(){return nf}):new Wo(lt.thisDep,lt.contextDep,lt.propDep,function(Vn,Gn){var Hn=Vn.ELEMENTS;return Gn.def(Hn,"?",Hn,".primType:",nf)});if(Ft)return new Wo(zt.thisDep,zt.contextDep,zt.propDep,function(Vn,Gn){return Gn.def(Vn.shared.vao+".currentVAO?"+Vn.shared.vao+".currentVAO.primitive:"+nf)})}return null}function tr(Yn,kn){if(Yn in It){var Vn=It[Yn]|0;return kn?fr.offset=Vn:fr.instances=Vn,xe.command(!kn||Vn>=0,"invalid "+Yn,Ze.commandStr),wo(function(Hn,_i){return kn&&(Hn.OFFSET=Vn),Vn})}else if(Yn in Jt){var Gn=Jt[Yn];return Wa(Gn,function(Hn,_i){var Ba=Hn.invoke(_i,Gn);return kn&&(Hn.OFFSET=Ba,xe.optional(function(){Hn.assert(_i,Ba+">=0","invalid "+Yn)})),Ba})}else if(kn){if(qe)return wo(function(Hn,_i){return Hn.OFFSET=0,0});if(Ft)return new Wo(zt.thisDep,zt.contextDep,zt.propDep,function(Hn,_i){return _i.def(Hn.shared.vao+".currentVAO?"+Hn.shared.vao+".currentVAO.offset:0")})}else if(Ft)return new Wo(zt.thisDep,zt.contextDep,zt.propDep,function(Hn,_i){return _i.def(Hn.shared.vao+".currentVAO?"+Hn.shared.vao+".currentVAO.instances:-1")});return null}var jr=tr(Bu,!0);function hn(){if(il in It){var Yn=It[il]|0;return fr.count=Yn,xe.command(typeof Yn=="number"&&Yn>=0,"invalid vertex count",Ze.commandStr),wo(function(){return Yn})}else if(il in Jt){var kn=Jt[il];return Wa(kn,function(_i,Ba){var vo=_i.invoke(Ba,kn);return xe.optional(function(){_i.assert(Ba,"typeof "+vo+'==="number"&&'+vo+">=0&&"+vo+"===("+vo+"|0)","invalid vertex count")}),vo})}else if(qe)if(Al(lt)){if(lt)return jr?new Wo(jr.thisDep,jr.contextDep,jr.propDep,function(_i,Ba){var vo=Ba.def(_i.ELEMENTS,".vertCount-",_i.OFFSET);return xe.optional(function(){_i.assert(Ba,vo+">=0","invalid vertex offset/element buffer too small")}),vo}):wo(function(_i,Ba){return Ba.def(_i.ELEMENTS,".vertCount")});var Vn=wo(function(){return-1});return xe.optional(function(){Vn.MISSING=!0}),Vn}else{var Gn=new Wo(lt.thisDep||jr.thisDep,lt.contextDep||jr.contextDep,lt.propDep||jr.propDep,function(_i,Ba){var vo=_i.ELEMENTS;return _i.OFFSET?Ba.def(vo,"?",vo,".vertCount-",_i.OFFSET,":-1"):Ba.def(vo,"?",vo,".vertCount:-1")});return xe.optional(function(){Gn.DYNAMIC=!0}),Gn}else if(Ft){var Hn=new Wo(zt.thisDep,zt.contextDep,zt.propDep,function(_i,Ba){return Ba.def(_i.shared.vao,".currentVAO?",_i.shared.vao,".currentVAO.count:-1")});return Hn}return null}var dn=Yt(),wn=hn(),cn=tr(ns,!1);return{elements:lt,primitive:dn,count:wn,instances:cn,offset:jr,vao:zt,vaoActive:Ft,elementsActive:qe,static:fr}}function po(at,Ze){var It=at.static,Jt=at.dynamic,fr={};return Qn.forEach(function(Ft){var Dt=jn(Ft);function zt(qe,St){if(Ft in It){var lt=qe(It[Ft]);fr[Dt]=wo(function(){return lt})}else if(Ft in Jt){var Yt=Jt[Ft];fr[Dt]=Wa(Yt,function(tr,jr){return St(tr,jr,tr.invoke(jr,Yt))})}}switch(Ft){case gl:case Lo:case Ho:case hu:case ts:case ps:case yl:case _l:case $s:case zs:return zt(function(qe){return xe.commandType(qe,"boolean",Ft,Ze.commandStr),qe},function(qe,St,lt){return xe.optional(function(){qe.assert(St,"typeof "+lt+'==="boolean"',"invalid flag "+Ft,qe.commandStr)}),lt});case Cu:return zt(function(qe){return xe.commandParameter(qe,lc,"invalid "+Ft,Ze.commandStr),lc[qe]},function(qe,St,lt){var Yt=qe.constants.compareFuncs;return xe.optional(function(){qe.assert(St,lt+" in "+Yt,"invalid "+Ft+", must be one of "+Object.keys(lc))}),St.def(Yt,"[",lt,"]")});case ds:return zt(function(qe){return xe.command(Ra(qe)&&qe.length===2&&typeof qe[0]=="number"&&typeof qe[1]=="number"&&qe[0]<=qe[1],"depth range is 2d array",Ze.commandStr),qe},function(qe,St,lt){xe.optional(function(){qe.assert(St,qe.shared.isArrayLike+"("+lt+")&&"+lt+".length===2&&typeof "+lt+'[0]==="number"&&typeof '+lt+'[1]==="number"&&'+lt+"[0]<="+lt+"[1]","depth range must be a 2d array")});var Yt=St.def("+",lt,"[0]"),tr=St.def("+",lt,"[1]");return[Yt,tr]});case hs:return zt(function(qe){xe.commandType(qe,"object","blend.func",Ze.commandStr);var St="srcRGB"in qe?qe.srcRGB:qe.src,lt="srcAlpha"in qe?qe.srcAlpha:qe.src,Yt="dstRGB"in qe?qe.dstRGB:qe.dst,tr="dstAlpha"in qe?qe.dstAlpha:qe.dst;return xe.commandParameter(St,Zo,Dt+".srcRGB",Ze.commandStr),xe.commandParameter(lt,Zo,Dt+".srcAlpha",Ze.commandStr),xe.commandParameter(Yt,Zo,Dt+".dstRGB",Ze.commandStr),xe.commandParameter(tr,Zo,Dt+".dstAlpha",Ze.commandStr),xe.command(Rf.indexOf(St+", "+Yt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+St+", "+Yt+")",Ze.commandStr),[Zo[St],Zo[Yt],Zo[lt],Zo[tr]]},function(qe,St,lt){var Yt=qe.constants.blendFuncs;xe.optional(function(){qe.assert(St,lt+"&&typeof "+lt+'==="object"',"invalid blend func, must be an object")});function tr(kn,Vn){var Gn=St.def('"',kn,Vn,'" in ',lt,"?",lt,".",kn,Vn,":",lt,".",kn);return xe.optional(function(){qe.assert(St,Gn+" in "+Yt,"invalid "+Ft+"."+kn+Vn+", must be one of "+Object.keys(Zo))}),Gn}var jr=tr("src","RGB"),hn=tr("dst","RGB");xe.optional(function(){var kn=qe.constants.invalidBlendCombinations;qe.assert(St,kn+".indexOf("+jr+'+", "+'+hn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var dn=St.def(Yt,"[",jr,"]"),wn=St.def(Yt,"[",tr("src","Alpha"),"]"),cn=St.def(Yt,"[",hn,"]"),Yn=St.def(Yt,"[",tr("dst","Alpha"),"]");return[dn,cn,wn,Yn]});case so:return zt(function(qe){if(typeof qe=="string")return xe.commandParameter(qe,Sr,"invalid "+Ft,Ze.commandStr),[Sr[qe],Sr[qe]];if(typeof qe=="object")return xe.commandParameter(qe.rgb,Sr,Ft+".rgb",Ze.commandStr),xe.commandParameter(qe.alpha,Sr,Ft+".alpha",Ze.commandStr),[Sr[qe.rgb],Sr[qe.alpha]];xe.commandRaise("invalid blend.equation",Ze.commandStr)},function(qe,St,lt){var Yt=qe.constants.blendEquations,tr=St.def(),jr=St.def(),hn=qe.cond("typeof ",lt,'==="string"');return xe.optional(function(){function dn(wn,cn,Yn){qe.assert(wn,Yn+" in "+Yt,"invalid "+cn+", must be one of "+Object.keys(Sr))}dn(hn.then,Ft,lt),qe.assert(hn.else,lt+"&&typeof "+lt+'==="object"',"invalid "+Ft),dn(hn.else,Ft+".rgb",lt+".rgb"),dn(hn.else,Ft+".alpha",lt+".alpha")}),hn.then(tr,"=",jr,"=",Yt,"[",lt,"];"),hn.else(tr,"=",Yt,"[",lt,".rgb];",jr,"=",Yt,"[",lt,".alpha];"),St(hn),[tr,jr]});case qa:return zt(function(qe){return xe.command(Ra(qe)&&qe.length===4,"blend.color must be a 4d array",Ze.commandStr),ot(4,function(St){return+qe[St]})},function(qe,St,lt){return xe.optional(function(){qe.assert(St,qe.shared.isArrayLike+"("+lt+")&&"+lt+".length===4","blend.color must be a 4d array")}),ot(4,function(Yt){return St.def("+",lt,"[",Yt,"]")})});case Tu:return zt(function(qe){return xe.commandType(qe,"number",Dt,Ze.commandStr),qe|0},function(qe,St,lt){return xe.optional(function(){qe.assert(St,"typeof "+lt+'==="number"',"invalid stencil.mask")}),St.def(lt,"|0")});case wu:return zt(function(qe){xe.commandType(qe,"object",Dt,Ze.commandStr);var St=qe.cmp||"keep",lt=qe.ref||0,Yt="mask"in qe?qe.mask:-1;return xe.commandParameter(St,lc,Ft+".cmp",Ze.commandStr),xe.commandType(lt,"number",Ft+".ref",Ze.commandStr),xe.commandType(Yt,"number",Ft+".mask",Ze.commandStr),[lc[St],lt,Yt]},function(qe,St,lt){var Yt=qe.constants.compareFuncs;xe.optional(function(){function dn(){qe.assert(St,Array.prototype.join.call(arguments,""),"invalid stencil.func")}dn(lt+"&&typeof ",lt,'==="object"'),dn('!("cmp" in ',lt,")||(",lt,".cmp in ",Yt,")")});var tr=St.def('"cmp" in ',lt,"?",Yt,"[",lt,".cmp]",":",al),jr=St.def(lt,".ref|0"),hn=St.def('"mask" in ',lt,"?",lt,".mask|0:-1");return[tr,jr,hn]});case da:case rs:return zt(function(qe){xe.commandType(qe,"object",Dt,Ze.commandStr);var St=qe.fail||"keep",lt=qe.zfail||"keep",Yt=qe.zpass||"keep";return xe.commandParameter(St,wl,Ft+".fail",Ze.commandStr),xe.commandParameter(lt,wl,Ft+".zfail",Ze.commandStr),xe.commandParameter(Yt,wl,Ft+".zpass",Ze.commandStr),[Ft===rs?Gl:Sc,wl[St],wl[lt],wl[Yt]]},function(qe,St,lt){var Yt=qe.constants.stencilOps;xe.optional(function(){qe.assert(St,lt+"&&typeof "+lt+'==="object"',"invalid "+Ft)});function tr(jr){return xe.optional(function(){qe.assert(St,'!("'+jr+'" in '+lt+")||("+lt+"."+jr+" in "+Yt+")","invalid "+Ft+"."+jr+", must be one of "+Object.keys(wl))}),St.def('"',jr,'" in ',lt,"?",Yt,"[",lt,".",jr,"]:",al)}return[Ft===rs?Gl:Sc,tr("fail"),tr("zfail"),tr("zpass")]});case js:return zt(function(qe){xe.commandType(qe,"object",Dt,Ze.commandStr);var St=qe.factor|0,lt=qe.units|0;return xe.commandType(St,"number",Dt+".factor",Ze.commandStr),xe.commandType(lt,"number",Dt+".units",Ze.commandStr),[St,lt]},function(qe,St,lt){xe.optional(function(){qe.assert(St,lt+"&&typeof "+lt+'==="object"',"invalid "+Ft)});var Yt=St.def(lt,".factor|0"),tr=St.def(lt,".units|0");return[Yt,tr]});case rl:return zt(function(qe){var St=0;return qe==="front"?St=Sc:qe==="back"&&(St=Gl),xe.command(!!St,Dt,Ze.commandStr),St},function(qe,St,lt){return xe.optional(function(){qe.assert(St,lt+'==="front"||'+lt+'==="back"',"invalid cull.face")}),St.def(lt,'==="front"?',Sc,":",Gl)});case Fu:return zt(function(qe){return xe.command(typeof qe=="number"&&qe>=pr.lineWidthDims[0]&&qe<=pr.lineWidthDims[1],"invalid line width, must be a positive number between "+pr.lineWidthDims[0]+" and "+pr.lineWidthDims[1],Ze.commandStr),qe},function(qe,St,lt){return xe.optional(function(){qe.assert(St,"typeof "+lt+'==="number"&&'+lt+">="+pr.lineWidthDims[0]+"&&"+lt+"<="+pr.lineWidthDims[1],"invalid line width")}),lt});case fu:return zt(function(qe){return xe.commandParameter(qe,Dc,Dt,Ze.commandStr),Dc[qe]},function(qe,St,lt){return xe.optional(function(){qe.assert(St,lt+'==="cw"||'+lt+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),St.def(lt+'==="cw"?'+af+":"+Tl)});case As:return zt(function(qe){return xe.command(Ra(qe)&&qe.length===4,"color.mask must be length 4 array",Ze.commandStr),qe.map(function(St){return!!St})},function(qe,St,lt){return xe.optional(function(){qe.assert(St,qe.shared.isArrayLike+"("+lt+")&&"+lt+".length===4","invalid color.mask")}),ot(4,function(Yt){return"!!"+lt+"["+Yt+"]"})});case _o:return zt(function(qe){xe.command(typeof qe=="object"&&qe,Dt,Ze.commandStr);var St="value"in qe?qe.value:1,lt=!!qe.invert;return xe.command(typeof St=="number"&&St>=0&&St<=1,"sample.coverage.value must be a number between 0 and 1",Ze.commandStr),[St,lt]},function(qe,St,lt){xe.optional(function(){qe.assert(St,lt+"&&typeof "+lt+'==="object"',"invalid sample.coverage")});var Yt=St.def('"value" in ',lt,"?+",lt,".value:1"),tr=St.def("!!",lt,".invert");return[Yt,tr]})}}),fr}function ra(at,Ze){var It=at.static,Jt=at.dynamic,fr={};return Object.keys(It).forEach(function(Ft){var Dt=It[Ft],zt;if(typeof Dt=="number"||typeof Dt=="boolean")zt=wo(function(){return Dt});else if(typeof Dt=="function"){var qe=Dt._reglType;qe==="texture2d"||qe==="textureCube"?zt=wo(function(St){return St.link(Dt)}):qe==="framebuffer"||qe==="framebufferCube"?(xe.command(Dt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ft+'"',Ze.commandStr),zt=wo(function(St){return St.link(Dt.color[0])})):xe.commandRaise('invalid data for uniform "'+Ft+'"',Ze.commandStr)}else Ra(Dt)?zt=wo(function(St){var lt=St.global.def("[",ot(Dt.length,function(Yt){return xe.command(typeof Dt[Yt]=="number"||typeof Dt[Yt]=="boolean","invalid uniform "+Ft,St.commandStr),Dt[Yt]}),"]");return lt}):xe.commandRaise('invalid or missing data for uniform "'+Ft+'"',Ze.commandStr);zt.value=Dt,fr[Ft]=zt}),Object.keys(Jt).forEach(function(Ft){var Dt=Jt[Ft];fr[Ft]=Wa(Dt,function(zt,qe){return zt.invoke(qe,Dt)})}),fr}function Yo(at,Ze){var It=at.static,Jt=at.dynamic,fr={};return Object.keys(It).forEach(function(Ft){var Dt=It[Ft],zt=Qe.id(Ft),qe=new $t;if(kc(Dt))qe.state=di,qe.buffer=Ir.getBuffer(Ir.create(Dt,zu,!1,!0)),qe.type=0;else{var St=Ir.getBuffer(Dt);if(St)qe.state=di,qe.buffer=St,qe.type=0;else if(xe.command(typeof Dt=="object"&&Dt,"invalid data for attribute "+Ft,Ze.commandStr),"constant"in Dt){var lt=Dt.constant;qe.buffer="null",qe.state=Bi,typeof lt=="number"?qe.x=lt:(xe.command(Ra(lt)&&lt.length>0&&lt.length<=4,"invalid constant for attribute "+Ft,Ze.commandStr),qi.forEach(function(cn,Yn){Yn<lt.length&&(qe[cn]=lt[Yn])}))}else{kc(Dt.buffer)?St=Ir.getBuffer(Ir.create(Dt.buffer,zu,!1,!0)):St=Ir.getBuffer(Dt.buffer),xe.command(!!St,'missing buffer for attribute "'+Ft+'"',Ze.commandStr);var Yt=Dt.offset|0;xe.command(Yt>=0,'invalid offset for attribute "'+Ft+'"',Ze.commandStr);var tr=Dt.stride|0;xe.command(tr>=0&&tr<256,'invalid stride for attribute "'+Ft+'", must be integer betweeen [0, 255]',Ze.commandStr);var jr=Dt.size|0;xe.command(!("size"in Dt)||jr>0&&jr<=4,'invalid size for attribute "'+Ft+'", must be 1,2,3,4',Ze.commandStr);var hn=!!Dt.normalized,dn=0;"type"in Dt&&(xe.commandParameter(Dt.type,Ue,"invalid type for attribute "+Ft,Ze.commandStr),dn=Ue[Dt.type]);var wn=Dt.divisor|0;xe.optional(function(){"divisor"in Dt&&(xe.command(wn===0||Kr,'cannot specify divisor for attribute "'+Ft+'", instancing not supported',Ze.commandStr),xe.command(wn>=0,'invalid divisor for attribute "'+Ft+'"',Ze.commandStr));var cn=Ze.commandStr,Yn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Dt).forEach(function(kn){xe.command(Yn.indexOf(kn)>=0,'unknown parameter "'+kn+'" for attribute pointer "'+Ft+'" (valid parameters are '+Yn+")",cn)})}),qe.buffer=St,qe.state=di,qe.size=jr,qe.normalized=hn,qe.type=dn||St.dtype,qe.offset=Yt,qe.stride=tr,qe.divisor=wn}}fr[Ft]=wo(function(cn,Yn){var kn=cn.attribCache;if(zt in kn)return kn[zt];var Vn={isStream:!1};return Object.keys(qe).forEach(function(Gn){Vn[Gn]=qe[Gn]}),qe.buffer&&(Vn.buffer=cn.link(qe.buffer),Vn.type=Vn.type||Vn.buffer+".dtype"),kn[zt]=Vn,Vn})}),Object.keys(Jt).forEach(function(Ft){var Dt=Jt[Ft];function zt(qe,St){var lt=qe.invoke(St,Dt),Yt=qe.shared,tr=qe.constants,jr=Yt.isBufferArgs,hn=Yt.buffer;xe.optional(function(){qe.assert(St,lt+"&&(typeof "+lt+'==="object"||typeof '+lt+'==="function")&&('+jr+"("+lt+")||"+hn+".getBuffer("+lt+")||"+hn+".getBuffer("+lt+".buffer)||"+jr+"("+lt+'.buffer)||("constant" in '+lt+"&&(typeof "+lt+'.constant==="number"||'+Yt.isArrayLike+"("+lt+".constant))))",'invalid dynamic attribute "'+Ft+'"')});var dn={isStream:St.def(!1)},wn=new $t;wn.state=di,Object.keys(wn).forEach(function(Vn){dn[Vn]=St.def(""+wn[Vn])});var cn=dn.buffer,Yn=dn.type;St("if(",jr,"(",lt,")){",dn.isStream,"=true;",cn,"=",hn,".createStream(",zu,",",lt,");",Yn,"=",cn,".dtype;","}else{",cn,"=",hn,".getBuffer(",lt,");","if(",cn,"){",Yn,"=",cn,".dtype;",'}else if("constant" in ',lt,"){",dn.state,"=",Bi,";","if(typeof "+lt+'.constant === "number"){',dn[qi[0]],"=",lt,".constant;",qi.slice(1).map(function(Vn){return dn[Vn]}).join("="),"=0;","}else{",qi.map(function(Vn,Gn){return dn[Vn]+"="+lt+".constant.length>"+Gn+"?"+lt+".constant["+Gn+"]:0;"}).join(""),"}}else{","if(",jr,"(",lt,".buffer)){",cn,"=",hn,".createStream(",zu,",",lt,".buffer);","}else{",cn,"=",hn,".getBuffer(",lt,".buffer);","}",Yn,'="type" in ',lt,"?",tr.glTypes,"[",lt,".type]:",cn,".dtype;",dn.normalized,"=!!",lt,".normalized;");function kn(Vn){St(dn[Vn],"=",lt,".",Vn,"|0;")}return kn("size"),kn("offset"),kn("stride"),kn("divisor"),St("}}"),St.exit("if(",dn.isStream,"){",hn,".destroyStream(",cn,");","}"),dn}fr[Ft]=Wa(Dt,zt)}),fr}function Ya(at){var Ze=at.static,It=at.dynamic,Jt={};return Object.keys(Ze).forEach(function(fr){var Ft=Ze[fr];Jt[fr]=wo(function(Dt,zt){return typeof Ft=="number"||typeof Ft=="boolean"?""+Ft:Dt.link(Ft)})}),Object.keys(It).forEach(function(fr){var Ft=It[fr];Jt[fr]=Wa(Ft,function(Dt,zt){return Dt.invoke(zt,Ft)})}),Jt}function Do(at,Ze,It,Jt,fr){var Ft=at.static,Dt=at.dynamic;xe.optional(function(){var kn=[nl,Mu,xl,Us,pu,Bu,il,ns,Nu,gc].concat(Qn);function Vn(Gn){Object.keys(Gn).forEach(function(Hn){xe.command(kn.indexOf(Hn)>=0,'unknown parameter "'+Hn+'"',fr.commandStr)})}Vn(Ft),Vn(Dt)});var zt=wi(at,Ze),qe=Pn(at,fr),St=yi(at,qe,fr),lt=uo(at,fr),Yt=po(at,fr),tr=$i(at,fr,zt);function jr(kn){var Vn=St[kn];Vn&&(Yt[kn]=Vn)}jr(Au),jr(jn(du));var hn=Object.keys(Yt).length>0,dn={framebuffer:qe,draw:lt,shader:tr,state:Yt,dirty:hn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(dn.profile=Cn(at,fr),dn.uniforms=ra(It,fr),dn.drawVAO=dn.scopeVAO=lt.vao,!dn.drawVAO&&tr.program&&!zt&&Ct.angle_instanced_arrays&&lt.static.elements){var wn=!0,cn=tr.program.attributes.map(function(kn){var Vn=Ze.static[kn];return wn=wn&&!!Vn,Vn});if(wn&&cn.length>0){var Yn=en.getVAO(en.createVAO({attributes:cn,elements:lt.static.elements}));dn.drawVAO=new Wo(null,null,null,function(kn,Vn){return kn.link(Yn)}),dn.useVAO=!0}}return zt?dn.useVAO=!0:dn.attributes=Yo(Ze,fr),dn.context=Ya(Jt,fr),dn}function xo(at,Ze,It){var Jt=at.shared,fr=Jt.context,Ft=at.scope();Object.keys(It).forEach(function(Dt){Ze.save(fr,"."+Dt);var zt=It[Dt],qe=zt.append(at,Ze);Array.isArray(qe)?Ft(fr,".",Dt,"=[",qe.join(),"];"):Ft(fr,".",Dt,"=",qe,";")}),Ze(Ft)}function Xo(at,Ze,It,Jt){var fr=at.shared,Ft=fr.gl,Dt=fr.framebuffer,zt;Mn&&(zt=Ze.def(fr.extensions,".webgl_draw_buffers"));var qe=at.constants,St=qe.drawBuffer,lt=qe.backBuffer,Yt;It?Yt=It.append(at,Ze):Yt=Ze.def(Dt,".next"),Jt||Ze("if(",Yt,"!==",Dt,".cur){"),Ze("if(",Yt,"){",Ft,".bindFramebuffer(",Lc,",",Yt,".framebuffer);"),Mn&&Ze(zt,".drawBuffersWEBGL(",St,"[",Yt,".colorAttachments.length]);"),Ze("}else{",Ft,".bindFramebuffer(",Lc,",null);"),Mn&&Ze(zt,".drawBuffersWEBGL(",lt,");"),Ze("}",Dt,".cur=",Yt,";"),Jt||Ze("}")}function is(at,Ze,It){var Jt=at.shared,fr=Jt.gl,Ft=at.current,Dt=at.next,zt=Jt.current,qe=Jt.next,St=at.cond(zt,".dirty");Qn.forEach(function(lt){var Yt=jn(lt);if(!(Yt in It.state)){var tr,jr;if(Yt in Dt){tr=Dt[Yt],jr=Ft[Yt];var hn=ot(En[Yt].length,function(wn){return St.def(tr,"[",wn,"]")});St(at.cond(hn.map(function(wn,cn){return wn+"!=="+jr+"["+cn+"]"}).join("||")).then(fr,".",Pr[Yt],"(",hn,");",hn.map(function(wn,cn){return jr+"["+cn+"]="+wn}).join(";"),";"))}else{tr=St.def(qe,".",Yt);var dn=at.cond(tr,"!==",zt,".",Yt);St(dn),Yt in wr?dn(at.cond(tr).then(fr,".enable(",wr[Yt],");").else(fr,".disable(",wr[Yt],");"),zt,".",Yt,"=",tr,";"):dn(fr,".",Pr[Yt],"(",tr,");",zt,".",Yt,"=",tr,";")}}}),Object.keys(It.state).length===0&&St(zt,".dirty=false;"),Ze(St)}function as(at,Ze,It,Jt){var fr=at.shared,Ft=at.current,Dt=fr.current,zt=fr.gl;Lf(Object.keys(It)).forEach(function(qe){var St=It[qe];if(!(Jt&&!Jt(St))){var lt=St.append(at,Ze);if(wr[qe]){var Yt=wr[qe];Al(St)?lt?Ze(zt,".enable(",Yt,");"):Ze(zt,".disable(",Yt,");"):Ze(at.cond(lt).then(zt,".enable(",Yt,");").else(zt,".disable(",Yt,");")),Ze(Dt,".",qe,"=",lt,";")}else if(Ra(lt)){var tr=Ft[qe];Ze(zt,".",Pr[qe],"(",lt,");",lt.map(function(jr,hn){return tr+"["+hn+"]="+jr}).join(";"),";")}else Ze(zt,".",Pr[qe],"(",lt,");",Dt,".",qe,"=",lt,";")}})}function bo(at,Ze){Kr&&(at.instancing=Ze.def(at.shared.extensions,".angle_instanced_arrays"))}function zi(at,Ze,It,Jt,fr){var Ft=at.shared,Dt=at.stats,zt=Ft.current,qe=Ft.timer,St=It.profile;function lt(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Yt,tr;function jr(kn){Yt=Ze.def(),kn(Yt,"=",lt(),";"),typeof fr=="string"?kn(Dt,".count+=",fr,";"):kn(Dt,".count++;"),Yr&&(Jt?(tr=Ze.def(),kn(tr,"=",qe,".getNumPendingQueries();")):kn(qe,".beginQuery(",Dt,");"))}function hn(kn){kn(Dt,".cpuTime+=",lt(),"-",Yt,";"),Yr&&(Jt?kn(qe,".pushScopeStats(",tr,",",qe,".getNumPendingQueries(),",Dt,");"):kn(qe,".endQuery();"))}function dn(kn){var Vn=Ze.def(zt,".profile");Ze(zt,".profile=",kn,";"),Ze.exit(zt,".profile=",Vn,";")}var wn;if(St){if(Al(St)){St.enable?(jr(Ze),hn(Ze.exit),dn("true")):dn("false");return}wn=St.append(at,Ze),dn(wn)}else wn=Ze.def(zt,".profile");var cn=at.block();jr(cn),Ze("if(",wn,"){",cn,"}");var Yn=at.block();hn(Yn),Ze.exit("if(",wn,"){",Yn,"}")}function Ko(at,Ze,It,Jt,fr){var Ft=at.shared;function Dt(qe){switch(qe){case jl:case El:case Cl:return 2;case Sl:case oc:case Rc:return 3;case _c:case sc:case uc:return 4;default:return 1}}function zt(qe,St,lt){var Yt=Ft.gl,tr=Ze.def(qe,".location"),jr=Ze.def(Ft.attributes,"[",tr,"]"),hn=lt.state,dn=lt.buffer,wn=[lt.x,lt.y,lt.z,lt.w],cn=["buffer","normalized","offset","stride"];function Yn(){Ze("if(!",jr,".buffer){",Yt,".enableVertexAttribArray(",tr,");}");var Vn=lt.type,Gn;if(lt.size?Gn=Ze.def(lt.size,"||",St):Gn=St,Ze("if(",jr,".type!==",Vn,"||",jr,".size!==",Gn,"||",cn.map(function(_i){return jr+"."+_i+"!=="+lt[_i]}).join("||"),"){",Yt,".bindBuffer(",zu,",",dn,".buffer);",Yt,".vertexAttribPointer(",[tr,Gn,Vn,lt.normalized,lt.stride,lt.offset],");",jr,".type=",Vn,";",jr,".size=",Gn,";",cn.map(function(_i){return jr+"."+_i+"="+lt[_i]+";"}).join(""),"}"),Kr){var Hn=lt.divisor;Ze("if(",jr,".divisor!==",Hn,"){",at.instancing,".vertexAttribDivisorANGLE(",[tr,Hn],");",jr,".divisor=",Hn,";}")}}function kn(){Ze("if(",jr,".buffer){",Yt,".disableVertexAttribArray(",tr,");",jr,".buffer=null;","}if(",qi.map(function(Vn,Gn){return jr+"."+Vn+"!=="+wn[Gn]}).join("||"),"){",Yt,".vertexAttrib4f(",tr,",",wn,");",qi.map(function(Vn,Gn){return jr+"."+Vn+"="+wn[Gn]+";"}).join(""),"}")}hn===di?Yn():hn===Bi?kn():(Ze("if(",hn,"===",di,"){"),Yn(),Ze("}else{"),kn(),Ze("}"))}Jt.forEach(function(qe){var St=qe.name,lt=It.attributes[St],Yt;if(lt){if(!fr(lt))return;Yt=lt.append(at,Ze)}else{if(!fr(Df))return;var tr=at.scopeAttrib(St);xe.optional(function(){at.assert(Ze,tr+".state","missing attribute "+St)}),Yt={},Object.keys(new $t).forEach(function(jr){Yt[jr]=Ze.def(tr,".",jr)})}zt(at.link(qe),Dt(qe.info.type),Yt)})}function Sa(at,Ze,It,Jt,fr,Ft){for(var Dt=at.shared,zt=Dt.gl,qe,St=0;St<Jt.length;++St){var lt=Jt[St],Yt=lt.name,tr=lt.info.type,jr=It.uniforms[Yt],hn=at.link(lt),dn=hn+".location",wn;if(jr){if(!fr(jr))continue;if(Al(jr)){var cn=jr.value;if(xe.command(cn!==null&&typeof cn!="undefined",'missing uniform "'+Yt+'"',at.commandStr),tr===Ls||tr===bc){xe.command(typeof cn=="function"&&(tr===Ls&&(cn._reglType==="texture2d"||cn._reglType==="framebuffer")||tr===bc&&(cn._reglType==="textureCube"||cn._reglType==="framebufferCube")),"invalid texture for uniform "+Yt,at.commandStr);var Yn=at.link(cn._texture||cn.color[0]._texture);Ze(zt,".uniform1i(",dn,",",Yn+".bind());"),Ze.exit(Yn,".unbind();")}else if(tr===xc||tr===Ul||tr===Vl){xe.optional(function(){xe.command(Ra(cn),"invalid matrix for uniform "+Yt,at.commandStr),xe.command(tr===xc&&cn.length===4||tr===Ul&&cn.length===9||tr===Vl&&cn.length===16,"invalid length for matrix uniform "+Yt,at.commandStr)});var kn=at.global.def("new Float32Array(["+Array.prototype.slice.call(cn)+"])"),Vn=2;tr===Ul?Vn=3:tr===Vl&&(Vn=4),Ze(zt,".uniformMatrix",Vn,"fv(",dn,",false,",kn,");")}else{switch(tr){case ac:xe.commandType(cn,"number","uniform "+Yt,at.commandStr),qe="1f";break;case jl:xe.command(Ra(cn)&&cn.length===2,"uniform "+Yt,at.commandStr),qe="2f";break;case Sl:xe.command(Ra(cn)&&cn.length===3,"uniform "+Yt,at.commandStr),qe="3f";break;case _c:xe.command(Ra(cn)&&cn.length===4,"uniform "+Yt,at.commandStr),qe="4f";break;case rf:xe.commandType(cn,"boolean","uniform "+Yt,at.commandStr),qe="1i";break;case Ic:xe.commandType(cn,"number","uniform "+Yt,at.commandStr),qe="1i";break;case Cl:xe.command(Ra(cn)&&cn.length===2,"uniform "+Yt,at.commandStr),qe="2i";break;case El:xe.command(Ra(cn)&&cn.length===2,"uniform "+Yt,at.commandStr),qe="2i";break;case Rc:xe.command(Ra(cn)&&cn.length===3,"uniform "+Yt,at.commandStr),qe="3i";break;case oc:xe.command(Ra(cn)&&cn.length===3,"uniform "+Yt,at.commandStr),qe="3i";break;case uc:xe.command(Ra(cn)&&cn.length===4,"uniform "+Yt,at.commandStr),qe="4i";break;case sc:xe.command(Ra(cn)&&cn.length===4,"uniform "+Yt,at.commandStr),qe="4i";break}Ze(zt,".uniform",qe,"(",dn,",",Ra(cn)?Array.prototype.slice.call(cn):cn,");")}continue}else wn=jr.append(at,Ze)}else{if(!fr(Df))continue;wn=Ze.def(Dt.uniforms,"[",Qe.id(Yt),"]")}tr===Ls?(xe(!Array.isArray(wn),"must specify a scalar prop for textures"),Ze("if(",wn,"&&",wn,'._reglType==="framebuffer"){',wn,"=",wn,".color[0];","}")):tr===bc&&(xe(!Array.isArray(wn),"must specify a scalar prop for cube maps"),Ze("if(",wn,"&&",wn,'._reglType==="framebufferCube"){',wn,"=",wn,".color[0];","}")),xe.optional(function(){function Ea(vu,cf){at.assert(Ze,vu,'bad data or missing for uniform "'+Yt+'".  '+cf)}function Ca(vu){xe(!Array.isArray(wn),"must not specify an array type for uniform"),Ea("typeof "+wn+'==="'+vu+'"',"invalid type, expected "+vu)}function Js(vu,cf){Array.isArray(wn)?xe(wn.length===vu,"must have length "+vu):Ea(Dt.isArrayLike+"("+wn+")&&"+wn+".length==="+vu,"invalid vector, should have length "+vu,at.commandStr)}function lf(vu){xe(!Array.isArray(wn),"must not specify a value type"),Ea("typeof "+wn+'==="function"&&'+wn+'._reglType==="texture'+(vu===Af?"2d":"Cube")+'"',"invalid texture type",at.commandStr)}switch(tr){case Ic:Ca("number");break;case El:Js(2,"number");break;case oc:Js(3,"number");break;case sc:Js(4,"number");break;case ac:Ca("number");break;case jl:Js(2,"number");break;case Sl:Js(3,"number");break;case _c:Js(4,"number");break;case rf:Ca("boolean");break;case Cl:Js(2,"boolean");break;case Rc:Js(3,"boolean");break;case uc:Js(4,"boolean");break;case xc:Js(4,"number");break;case Ul:Js(9,"number");break;case Vl:Js(16,"number");break;case Ls:lf(Af);break;case bc:lf(oh);break}});var Gn=1;switch(tr){case Ls:case bc:var Hn=Ze.def(wn,"._texture");Ze(zt,".uniform1i(",dn,",",Hn,".bind());"),Ze.exit(Hn,".unbind();");continue;case Ic:case rf:qe="1i";break;case El:case Cl:qe="2i",Gn=2;break;case oc:case Rc:qe="3i",Gn=3;break;case sc:case uc:qe="4i",Gn=4;break;case ac:qe="1f";break;case jl:qe="2f",Gn=2;break;case Sl:qe="3f",Gn=3;break;case _c:qe="4f",Gn=4;break;case xc:qe="Matrix2fv";break;case Ul:qe="Matrix3fv";break;case Vl:qe="Matrix4fv";break}if(qe.charAt(0)==="M"){Ze(zt,".uniform",qe,"(",dn,",");var _i=Math.pow(tr-xc+2,2),Ba=at.global.def("new Float32Array(",_i,")");Array.isArray(wn)?Ze("false,(",ot(_i,function(Ea){return Ba+"["+Ea+"]="+wn[Ea]}),",",Ba,")"):Ze("false,(Array.isArray(",wn,")||",wn," instanceof Float32Array)?",wn,":(",ot(_i,function(Ea){return Ba+"["+Ea+"]="+wn+"["+Ea+"]"}),",",Ba,")"),Ze(");")}else if(Gn>1){for(var vo=[],Pu=[],Vs=0;Vs<Gn;++Vs)Array.isArray(wn)?Pu.push(wn[Vs]):Pu.push(Ze.def(wn+"["+Vs+"]")),Ft&&vo.push(Ze.def());Ft&&Ze("if(!",at.batchId,"||",vo.map(function(Ea,Ca){return Ea+"!=="+Pu[Ca]}).join("||"),"){",vo.map(function(Ea,Ca){return Ea+"="+Pu[Ca]+";"}).join("")),Ze(zt,".uniform",qe,"(",dn,",",Pu.join(","),");"),Ft&&Ze("}")}else{if(xe(!Array.isArray(wn),"uniform value must not be an array"),Ft){var ju=Ze.def();Ze("if(!",at.batchId,"||",ju,"!==",wn,"){",ju,"=",wn,";")}Ze(zt,".uniform",qe,"(",dn,",",wn,");"),Ft&&Ze("}")}}}function Ao(at,Ze,It,Jt){var fr=at.shared,Ft=fr.gl,Dt=fr.draw,zt=Jt.draw;function qe(){var Gn=zt.elements,Hn,_i=Ze;return Gn?((Gn.contextDep&&Jt.contextDynamic||Gn.propDep)&&(_i=It),Hn=Gn.append(at,_i),zt.elementsActive&&_i("if("+Hn+")"+Ft+".bindBuffer("+ef+","+Hn+".buffer.buffer);")):(Hn=_i.def(),_i(Hn,"=",Dt,".",Us,";","if(",Hn,"){",Ft,".bindBuffer(",ef,",",Hn,".buffer.buffer);}","else if(",fr.vao,".currentVAO){",Hn,"=",at.shared.elements+".getElements("+fr.vao,".currentVAO.elements);",Nr?"":"if("+Hn+")"+Ft+".bindBuffer("+ef+","+Hn+".buffer.buffer);","}")),Hn}function St(){var Gn=zt.count,Hn,_i=Ze;return Gn?((Gn.contextDep&&Jt.contextDynamic||Gn.propDep)&&(_i=It),Hn=Gn.append(at,_i),xe.optional(function(){Gn.MISSING&&at.assert(Ze,"false","missing vertex count"),Gn.DYNAMIC&&at.assert(_i,Hn+">=0","missing vertex count")})):(Hn=_i.def(Dt,".",il),xe.optional(function(){at.assert(_i,Hn+">=0","missing vertex count")})),Hn}var lt=qe();function Yt(Gn){var Hn=zt[Gn];return Hn?Hn.contextDep&&Jt.contextDynamic||Hn.propDep?Hn.append(at,It):Hn.append(at,Ze):Ze.def(Dt,".",Gn)}var tr=Yt(pu),jr=Yt(Bu),hn=St();if(typeof hn=="number"){if(hn===0)return}else It("if(",hn,"){"),It.exit("}");var dn,wn;Kr&&(dn=Yt(ns),wn=at.instancing);var cn=lt+".type",Yn=zt.elements&&Al(zt.elements)&&!zt.vaoActive;function kn(){function Gn(){It(wn,".drawElementsInstancedANGLE(",[tr,hn,cn,jr+"<<(("+cn+"-"+zn+")>>1)",dn],");")}function Hn(){It(wn,".drawArraysInstancedANGLE(",[tr,jr,hn,dn],");")}lt&&lt!=="null"?Yn?Gn():(It("if(",lt,"){"),Gn(),It("}else{"),Hn(),It("}")):Hn()}function Vn(){function Gn(){It(Ft+".drawElements("+[tr,hn,cn,jr+"<<(("+cn+"-"+zn+")>>1)"]+");")}function Hn(){It(Ft+".drawArrays("+[tr,jr,hn]+");")}lt&&lt!=="null"?Yn?Gn():(It("if(",lt,"){"),Gn(),It("}else{"),Hn(),It("}")):Hn()}Kr&&(typeof dn!="number"||dn>=0)?typeof dn=="string"?(It("if(",dn,">0){"),kn(),It("}else if(",dn,"<0){"),Vn(),It("}")):kn():Vn()}function vi(at,Ze,It,Jt,fr){var Ft=Ti(),Dt=Ft.proc("body",fr);return xe.optional(function(){Ft.commandStr=Ze.commandStr,Ft.command=Ft.link(Ze.commandStr)}),Kr&&(Ft.instancing=Dt.def(Ft.shared.extensions,".angle_instanced_arrays")),at(Ft,Dt,It,Jt),Ft.compile().body}function Hi(at,Ze,It,Jt){bo(at,Ze),It.useVAO?It.drawVAO?Ze(at.shared.vao,".setVAO(",It.drawVAO.append(at,Ze),");"):Ze(at.shared.vao,".setVAO(",at.shared.vao,".targetVAO);"):(Ze(at.shared.vao,".setVAO(null);"),Ko(at,Ze,It,Jt.attributes,function(){return!0})),Sa(at,Ze,It,Jt.uniforms,function(){return!0},!1),Ao(at,Ze,Ze,It)}function Va(at,Ze){var It=at.proc("draw",1);bo(at,It),xo(at,It,Ze.context),Xo(at,It,Ze.framebuffer),is(at,It,Ze),as(at,It,Ze.state),zi(at,It,Ze,!1,!0);var Jt=Ze.shader.progVar.append(at,It);if(It(at.shared.gl,".useProgram(",Jt,".program);"),Ze.shader.program)Hi(at,It,Ze,Ze.shader.program);else{It(at.shared.vao,".setVAO(null);");var fr=at.global.def("{}"),Ft=It.def(Jt,".id"),Dt=It.def(fr,"[",Ft,"]");It(at.cond(Dt).then(Dt,".call(this,a0);").else(Dt,"=",fr,"[",Ft,"]=",at.link(function(zt){return vi(Hi,at,Ze,zt,1)}),"(",Jt,");",Dt,".call(this,a0);"))}Object.keys(Ze.state).length>0&&It(at.shared.current,".dirty=true;"),at.shared.vao&&It(at.shared.vao,".setVAO(null);")}function ko(at,Ze,It,Jt){at.batchId="a1",bo(at,Ze);function fr(){return!0}Ko(at,Ze,It,Jt.attributes,fr),Sa(at,Ze,It,Jt.uniforms,fr,!1),Ao(at,Ze,Ze,It)}function sl(at,Ze,It,Jt){bo(at,Ze);var fr=It.contextDep,Ft=Ze.def(),Dt="a0",zt="a1",qe=Ze.def();at.shared.props=qe,at.batchId=Ft;var St=at.scope(),lt=at.scope();Ze(St.entry,"for(",Ft,"=0;",Ft,"<",zt,";++",Ft,"){",qe,"=",Dt,"[",Ft,"];",lt,"}",St.exit);function Yt(cn){return cn.contextDep&&fr||cn.propDep}function tr(cn){return!Yt(cn)}if(It.needsContext&&xo(at,lt,It.context),It.needsFramebuffer&&Xo(at,lt,It.framebuffer),as(at,lt,It.state,Yt),It.profile&&Yt(It.profile)&&zi(at,lt,It,!1,!0),Jt)It.useVAO?It.drawVAO?Yt(It.drawVAO)?lt(at.shared.vao,".setVAO(",It.drawVAO.append(at,lt),");"):St(at.shared.vao,".setVAO(",It.drawVAO.append(at,St),");"):St(at.shared.vao,".setVAO(",at.shared.vao,".targetVAO);"):(St(at.shared.vao,".setVAO(null);"),Ko(at,St,It,Jt.attributes,tr),Ko(at,lt,It,Jt.attributes,Yt)),Sa(at,St,It,Jt.uniforms,tr,!1),Sa(at,lt,It,Jt.uniforms,Yt,!0),Ao(at,St,lt,It);else{var jr=at.global.def("{}"),hn=It.shader.progVar.append(at,lt),dn=lt.def(hn,".id"),wn=lt.def(jr,"[",dn,"]");lt(at.shared.gl,".useProgram(",hn,".program);","if(!",wn,"){",wn,"=",jr,"[",dn,"]=",at.link(function(cn){return vi(ko,at,It,cn,2)}),"(",hn,");}",wn,".call(this,a0[",Ft,"],",Ft,");")}}function dt(at,Ze){var It=at.proc("batch",2);at.batchId="0",bo(at,It);var Jt=!1,fr=!0;Object.keys(Ze.context).forEach(function(jr){Jt=Jt||Ze.context[jr].propDep}),Jt||(xo(at,It,Ze.context),fr=!1);var Ft=Ze.framebuffer,Dt=!1;Ft?(Ft.propDep?Jt=Dt=!0:Ft.contextDep&&Jt&&(Dt=!0),Dt||Xo(at,It,Ft)):Xo(at,It,null),Ze.state.viewport&&Ze.state.viewport.propDep&&(Jt=!0);function zt(jr){return jr.contextDep&&Jt||jr.propDep}is(at,It,Ze),as(at,It,Ze.state,function(jr){return!zt(jr)}),(!Ze.profile||!zt(Ze.profile))&&zi(at,It,Ze,!1,"a1"),Ze.contextDep=Jt,Ze.needsContext=fr,Ze.needsFramebuffer=Dt;var qe=Ze.shader.progVar;if(qe.contextDep&&Jt||qe.propDep)sl(at,It,Ze,null);else{var St=qe.append(at,It);if(It(at.shared.gl,".useProgram(",St,".program);"),Ze.shader.program)sl(at,It,Ze,Ze.shader.program);else{It(at.shared.vao,".setVAO(null);");var lt=at.global.def("{}"),Yt=It.def(St,".id"),tr=It.def(lt,"[",Yt,"]");It(at.cond(tr).then(tr,".call(this,a0,a1);").else(tr,"=",lt,"[",Yt,"]=",at.link(function(jr){return vi(sl,at,Ze,jr,2)}),"(",St,");",tr,".call(this,a0,a1);"))}}Object.keys(Ze.state).length>0&&It(at.shared.current,".dirty=true;"),at.shared.vao&&It(at.shared.vao,".setVAO(null);")}function vr(at,Ze){var It=at.proc("scope",3);at.batchId="a2";var Jt=at.shared,fr=Jt.current;xo(at,It,Ze.context),Ze.framebuffer&&Ze.framebuffer.append(at,It),Lf(Object.keys(Ze.state)).forEach(function(Dt){var zt=Ze.state[Dt],qe=zt.append(at,It);Ra(qe)?qe.forEach(function(St,lt){It.set(at.next[Dt],"["+lt+"]",St)}):It.set(Jt.next,"."+Dt,qe)}),zi(at,It,Ze,!0,!0),[Us,Bu,il,ns,pu].forEach(function(Dt){var zt=Ze.draw[Dt];!zt||It.set(Jt.draw,"."+Dt,""+zt.append(at,It))}),Object.keys(Ze.uniforms).forEach(function(Dt){var zt=Ze.uniforms[Dt].append(at,It);Array.isArray(zt)&&(zt="["+zt.join()+"]"),It.set(Jt.uniforms,"["+Qe.id(Dt)+"]",zt)}),Object.keys(Ze.attributes).forEach(function(Dt){var zt=Ze.attributes[Dt].append(at,It),qe=at.scopeAttrib(Dt);Object.keys(new $t).forEach(function(St){It.set(qe,"."+St,zt[St])})}),Ze.scopeVAO&&It.set(Jt.vao,".targetVAO",Ze.scopeVAO.append(at,It));function Ft(Dt){var zt=Ze.shader[Dt];zt&&It.set(Jt.shader,"."+Dt,zt.append(at,It))}Ft(Mu),Ft(xl),Object.keys(Ze.state).length>0&&(It(fr,".dirty=true;"),It.exit(fr,".dirty=true;")),It("a1(",at.shared.context,",a0,",at.batchId,");")}function sr(at){if(!(typeof at!="object"||Ra(at))){for(var Ze=Object.keys(at),It=0;It<Ze.length;++It)if(Ar.isDynamic(at[Ze[It]]))return!0;return!1}}function On(at,Ze,It){var Jt=Ze.static[It];if(!Jt||!sr(Jt))return;var fr=at.global,Ft=Object.keys(Jt),Dt=!1,zt=!1,qe=!1,St=at.global.def("{}");Ft.forEach(function(Yt){var tr=Jt[Yt];if(Ar.isDynamic(tr)){typeof tr=="function"&&(tr=Jt[Yt]=Ar.unbox(tr));var jr=Wa(tr,null);Dt=Dt||jr.thisDep,qe=qe||jr.propDep,zt=zt||jr.contextDep}else{switch(fr(St,".",Yt,"="),typeof tr){case"number":fr(tr);break;case"string":fr('"',tr,'"');break;case"object":Array.isArray(tr)&&fr("[",tr.join(),"]");break;default:fr(at.link(tr));break}fr(";")}});function lt(Yt,tr){Ft.forEach(function(jr){var hn=Jt[jr];if(!!Ar.isDynamic(hn)){var dn=Yt.invoke(tr,hn);tr(St,".",jr,"=",dn,";")}})}Ze.dynamic[It]=new Ar.DynamicVariable(li,{thisDep:Dt,contextDep:zt,propDep:qe,ref:St,append:lt}),delete Ze.static[It]}function ea(at,Ze,It,Jt,fr){var Ft=Ti();Ft.stats=Ft.link(fr),Object.keys(Ze.static).forEach(function(zt){On(Ft,Ze,zt)}),bl.forEach(function(zt){On(Ft,at,zt)});var Dt=Do(at,Ze,It,Jt,Ft);return Va(Ft,Dt),vr(Ft,Dt),dt(Ft,Dt),o(Ft.compile(),{destroy:function(){Dt.shader.program.destroy()}})}return{next:on,current:En,procs:function(){var at=Ti(),Ze=at.proc("poll"),It=at.proc("refresh"),Jt=at.block();Ze(Jt),It(Jt);var fr=at.shared,Ft=fr.gl,Dt=fr.next,zt=fr.current;Jt(zt,".dirty=false;"),Xo(at,Ze),Xo(at,It,null,!0);var qe;Kr&&(qe=at.link(Kr)),Ct.oes_vertex_array_object&&It(at.link(Ct.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var St=0;St<pr.maxAttributes;++St){var lt=It.def(fr.attributes,"[",St,"]"),Yt=at.cond(lt,".buffer");Yt.then(Ft,".enableVertexAttribArray(",St,");",Ft,".bindBuffer(",zu,",",lt,".buffer.buffer);",Ft,".vertexAttribPointer(",St,",",lt,".size,",lt,".type,",lt,".normalized,",lt,".stride,",lt,".offset);").else(Ft,".disableVertexAttribArray(",St,");",Ft,".vertexAttrib4f(",St,",",lt,".x,",lt,".y,",lt,".z,",lt,".w);",lt,".buffer=null;"),It(Yt),Kr&&It(qe,".vertexAttribDivisorANGLE(",St,",",lt,".divisor);")}return It(at.shared.vao,".currentVAO=null;",at.shared.vao,".setVAO(",at.shared.vao,".targetVAO);"),Object.keys(wr).forEach(function(tr){var jr=wr[tr],hn=Jt.def(Dt,".",tr),dn=at.block();dn("if(",hn,"){",Ft,".enable(",jr,")}else{",Ft,".disable(",jr,")}",zt,".",tr,"=",hn,";"),It(dn),Ze("if(",hn,"!==",zt,".",tr,"){",dn,"}")}),Object.keys(Pr).forEach(function(tr){var jr=Pr[tr],hn=En[tr],dn,wn,cn=at.block();if(cn(Ft,".",jr,"("),Ra(hn)){var Yn=hn.length;dn=at.global.def(Dt,".",tr),wn=at.global.def(zt,".",tr),cn(ot(Yn,function(kn){return dn+"["+kn+"]"}),");",ot(Yn,function(kn){return wn+"["+kn+"]="+dn+"["+kn+"];"}).join("")),Ze("if(",ot(Yn,function(kn){return dn+"["+kn+"]!=="+wn+"["+kn+"]"}).join("||"),"){",cn,"}")}else dn=Jt.def(Dt,".",tr),wn=Jt.def(zt,".",tr),cn(dn,");",zt,".",tr,"=",dn,";"),Ze("if(",dn,"!==",wn,"){",cn,"}");It(cn)}),at.compile()}(),compile:ea}}function Ff(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ph=34918,Nf=34919,Bf=35007,vh=function(ye,Qe){if(!Qe.ext_disjoint_timer_query)return null;var Ct=[];function pr(){return Ct.pop()||Qe.ext_disjoint_timer_query.createQueryEXT()}function Ir(Kr){Ct.push(Kr)}var dr=[];function Tr(Kr){var Mn=pr();Qe.ext_disjoint_timer_query.beginQueryEXT(Bf,Mn),dr.push(Mn),Yr(dr.length-1,dr.length,Kr)}function Wr(){Qe.ext_disjoint_timer_query.endQueryEXT(Bf)}function Gr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var en=[];function rn(){return en.pop()||new Gr}function $r(Kr){en.push(Kr)}var ln=[];function Yr(Kr,Mn,Nr){var En=rn();En.startQueryIndex=Kr,En.endQueryIndex=Mn,En.sum=0,En.stats=Nr,ln.push(En)}var Qr=[],$t=[];function Sr(){var Kr,Mn,Nr=dr.length;if(Nr!==0){$t.length=Math.max($t.length,Nr+1),Qr.length=Math.max(Qr.length,Nr+1),Qr[0]=0,$t[0]=0;var En=0;for(Kr=0,Mn=0;Mn<dr.length;++Mn){var on=dr[Mn];Qe.ext_disjoint_timer_query.getQueryObjectEXT(on,Nf)?(En+=Qe.ext_disjoint_timer_query.getQueryObjectEXT(on,ph),Ir(on)):dr[Kr++]=on,Qr[Mn+1]=En,$t[Mn+1]=Kr}for(dr.length=Kr,Kr=0,Mn=0;Mn<ln.length;++Mn){var Qn=ln[Mn],wr=Qn.startQueryIndex,Pr=Qn.endQueryIndex;Qn.sum+=Qr[Pr]-Qr[wr];var jn=$t[wr],Jr=$t[Pr];Jr===jn?(Qn.stats.gpuTime+=Qn.sum/1e6,$r(Qn)):(Qn.startQueryIndex=jn,Qn.endQueryIndex=Jr,ln[Kr++]=Qn)}ln.length=Kr}}return{beginQuery:Tr,endQuery:Wr,pushScopeStats:Yr,update:Sr,getNumPendingQueries:function(){return dr.length},clear:function(){Ct.push.apply(Ct,dr);for(var Kr=0;Kr<Ct.length;Kr++)Qe.ext_disjoint_timer_query.deleteQueryEXT(Ct[Kr]);dr.length=0,Ct.length=0},restore:function(){dr.length=0,Ct.length=0}}},mh=16384,zf=256,gh=1024,yh=34962,fc="webglcontextlost",of="webglcontextrestored",sf=1,Fc=2,Ha=3;function uf(ye,Qe){for(var Ct=0;Ct<ye.length;++Ct)if(ye[Ct]===Qe)return Ct;return-1}function ol(ye){var Qe=ze(ye);if(!Qe)return null;var Ct=Qe.gl,pr=Ct.getContextAttributes(),Ir=Ct.isContextLost(),dr=Ke(Ct,Qe);if(!dr)return null;var Tr=ci(),Wr=Ff(),Gr=dr.extensions,en=vh(Ct,Gr),rn=Rn(),$r=Ct.drawingBufferWidth,ln=Ct.drawingBufferHeight,Yr={tick:0,time:0,viewportWidth:$r,viewportHeight:ln,framebufferWidth:$r,framebufferHeight:ln,drawingBufferWidth:$r,drawingBufferHeight:ln,pixelRatio:Qe.pixelRatio},Qr={},$t={elements:null,primitive:4,count:-1,offset:0,instances:-1},Sr=Ve(Ct,Gr),Kr=Y(Ct,Wr,Qe,En),Mn=ll(Ct,Gr,Kr,Wr),Nr=ft(Ct,Gr,Sr,Wr,Kr,Mn,$t);function En(vi){return Nr.destroyBuffer(vi)}var on=yr(Ct,Tr,Wr,Qe),Qn=Ln(Ct,Gr,Sr,function(){jn.procs.poll()},Yr,Wr,Qe),wr=Ni(Ct,Gr,Sr,Wr,Qe),Pr=We(Ct,Gr,Sr,Qn,wr,Wr),jn=kf(Ct,Tr,Gr,Sr,Kr,Mn,Qn,Pr,Qr,Nr,on,$t,Yr,en,Qe),Jr=Dn(Ct,Pr,jn.procs.poll,Yr,pr,Gr,Sr),Xr=jn.next,xn=Ct.canvas,Tn=[],ki=[],Ti=[],Cn=[Qe.onDestroy],Pn=null;function yi(){if(Tn.length===0){en&&en.update(),Pn=null;return}Pn=Nn.next(yi),bo();for(var vi=Tn.length-1;vi>=0;--vi){var Hi=Tn[vi];Hi&&Hi(Yr,null,0)}Ct.flush(),en&&en.update()}function wi(){!Pn&&Tn.length>0&&(Pn=Nn.next(yi))}function $i(){Pn&&(Nn.cancel(yi),Pn=null)}function uo(vi){vi.preventDefault(),Ir=!0,$i(),ki.forEach(function(Hi){Hi()})}function po(vi){Ct.getError(),Ir=!1,dr.restore(),on.restore(),Kr.restore(),Qn.restore(),wr.restore(),Pr.restore(),Nr.restore(),en&&en.restore(),jn.procs.refresh(),wi(),Ti.forEach(function(Hi){Hi()})}var ra=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ra&&xn&&(xn.addEventListener(fc,uo,!1),xn.addEventListener(of,po,!1));function Yo(){Tn.length=0,$i(),!ra&&xn&&(xn.removeEventListener(fc,uo),xn.removeEventListener(of,po)),on.clear(),Pr.clear(),wr.clear(),Nr.clear(),Qn.clear(),Mn.clear(),Kr.clear(),en&&en.clear(),Cn.forEach(function(vi){vi()})}function Ya(vi){xe(!!vi,"invalid args to regl({...})"),xe.type(vi,"object","invalid args to regl({...})");function Hi(Ft){var Dt=o({},Ft);delete Dt.uniforms,delete Dt.attributes,delete Dt.context,delete Dt.vao,"stencil"in Dt&&Dt.stencil.op&&(Dt.stencil.opBack=Dt.stencil.opFront=Dt.stencil.op,delete Dt.stencil.op);function zt(qe){if(qe in Dt){var St=Dt[qe];delete Dt[qe],Object.keys(St).forEach(function(lt){Dt[qe+"."+lt]=St[lt]})}}return zt("blend"),zt("depth"),zt("cull"),zt("stencil"),zt("polygonOffset"),zt("scissor"),zt("sample"),"vao"in Ft&&(Dt.vao=Ft.vao),Dt}function Va(Ft,Dt){var zt={},qe={};return Object.keys(Ft).forEach(function(St){var lt=Ft[St];if(Ar.isDynamic(lt)){qe[St]=Ar.unbox(lt,St);return}else if(Dt&&Array.isArray(lt)){for(var Yt=0;Yt<lt.length;++Yt)if(Ar.isDynamic(lt[Yt])){qe[St]=Ar.unbox(lt,St);return}}zt[St]=lt}),{dynamic:qe,static:zt}}var ko=Va(vi.context||{},!0),sl=Va(vi.uniforms||{},!0),dt=Va(vi.attributes||{},!1),vr=Va(Hi(vi),!1),sr={gpuTime:0,cpuTime:0,count:0},On=jn.compile(vr,dt,sl,ko,sr),ea=On.draw,at=On.batch,Ze=On.scope,It=[];function Jt(Ft){for(;It.length<Ft;)It.push(null);return It}function fr(Ft,Dt){var zt;if(Ir&&xe.raise("context lost"),typeof Ft=="function")return Ze.call(this,null,Ft,0);if(typeof Dt=="function")if(typeof Ft=="number")for(zt=0;zt<Ft;++zt)Ze.call(this,null,Dt,zt);else if(Array.isArray(Ft))for(zt=0;zt<Ft.length;++zt)Ze.call(this,Ft[zt],Dt,zt);else return Ze.call(this,Ft,Dt,0);else if(typeof Ft=="number"){if(Ft>0)return at.call(this,Jt(Ft|0),Ft|0)}else if(Array.isArray(Ft)){if(Ft.length)return at.call(this,Ft,Ft.length)}else return ea.call(this,Ft)}return o(fr,{stats:sr,destroy:function(){On.destroy()}})}var Do=Pr.setFBO=Ya({framebuffer:Ar.define.call(null,sf,"framebuffer")});function xo(vi,Hi){var Va=0;jn.procs.poll();var ko=Hi.color;ko&&(Ct.clearColor(+ko[0]||0,+ko[1]||0,+ko[2]||0,+ko[3]||0),Va|=mh),"depth"in Hi&&(Ct.clearDepth(+Hi.depth),Va|=zf),"stencil"in Hi&&(Ct.clearStencil(Hi.stencil|0),Va|=gh),xe(!!Va,"called regl.clear with no buffer specified"),Ct.clear(Va)}function Xo(vi){if(xe(typeof vi=="object"&&vi,"regl.clear() takes an object as input"),"framebuffer"in vi)if(vi.framebuffer&&vi.framebuffer_reglType==="framebufferCube")for(var Hi=0;Hi<6;++Hi)Do(o({framebuffer:vi.framebuffer.faces[Hi]},vi),xo);else Do(vi,xo);else xo(null,vi)}function is(vi){xe.type(vi,"function","regl.frame() callback must be a function"),Tn.push(vi);function Hi(){var Va=uf(Tn,vi);xe(Va>=0,"cannot cancel a frame twice");function ko(){var sl=uf(Tn,ko);Tn[sl]=Tn[Tn.length-1],Tn.length-=1,Tn.length<=0&&$i()}Tn[Va]=ko}return wi(),{cancel:Hi}}function as(){var vi=Xr.viewport,Hi=Xr.scissor_box;vi[0]=vi[1]=Hi[0]=Hi[1]=0,Yr.viewportWidth=Yr.framebufferWidth=Yr.drawingBufferWidth=vi[2]=Hi[2]=Ct.drawingBufferWidth,Yr.viewportHeight=Yr.framebufferHeight=Yr.drawingBufferHeight=vi[3]=Hi[3]=Ct.drawingBufferHeight}function bo(){Yr.tick+=1,Yr.time=Ko(),as(),jn.procs.poll()}function zi(){Qn.refresh(),as(),jn.procs.refresh(),en&&en.update()}function Ko(){return(Rn()-rn)/1e3}zi();function Sa(vi,Hi){xe.type(Hi,"function","listener callback must be a function");var Va;switch(vi){case"frame":return is(Hi);case"lost":Va=ki;break;case"restore":Va=Ti;break;case"destroy":Va=Cn;break;default:xe.raise("invalid event, must be one of frame,lost,restore,destroy")}return Va.push(Hi),{cancel:function(){for(var ko=0;ko<Va.length;++ko)if(Va[ko]===Hi){Va[ko]=Va[Va.length-1],Va.pop();return}}}}var Ao=o(Ya,{clear:Xo,prop:Ar.define.bind(null,sf),context:Ar.define.bind(null,Fc),this:Ar.define.bind(null,Ha),draw:Ya({}),buffer:function(vi){return Kr.create(vi,yh,!1,!1)},elements:function(vi){return Mn.create(vi,!1)},texture:Qn.create2D,cube:Qn.createCube,renderbuffer:wr.create,framebuffer:Pr.create,framebufferCube:Pr.createCube,vao:Nr.createVAO,attributes:pr,frame:is,on:Sa,limits:Sr,hasExtension:function(vi){return Sr.extensions.indexOf(vi.toLowerCase())>=0},read:Jr,destroy:Yo,_gl:Ct,_refresh:zi,poll:function(){bo(),en&&en.update()},now:Ko,stats:Wr});return Qe.onDone(null,Ao),Ao}return ol})},49029:function(Te){var c=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function n(i){return i.match(c)||[]}Te.exports=n},29750:function(Te){function c(n,i,F){return n===n&&(F!==void 0&&(n=n<=F?n:F),i!==void 0&&(n=n>=i?n:i)),n}Te.exports=c},18674:function(Te){function c(n){return function(i){return n==null?void 0:n[i]}}Te.exports=c},98805:function(Te,c,n){var i=n(40180),F=n(62689),o=n(83140),w=n(79833);function _(P){return function(L){L=w(L);var d=F(L)?o(L):void 0,E=d?d[0]:L.charAt(0),g=d?i(d,1).join(""):L.slice(1);return E[P]()+g}}Te.exports=_},35393:function(Te,c,n){var i=n(62663),F=n(53816),o=n(58748),w="['\u2019]",_=RegExp(w,"g");function P(L){return function(d){return i(o(F(d).replace(_,"")),L,"")}}Te.exports=P},69389:function(Te,c,n){var i=n(18674),F={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},o=i(F);Te.exports=o},93157:function(Te){var c=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function n(i){return c.test(i)}Te.exports=n},2757:function(Te){var c="\\ud800-\\udfff",n="\\u0300-\\u036f",i="\\ufe20-\\ufe2f",F="\\u20d0-\\u20ff",o=n+i+F,w="\\u2700-\\u27bf",_="a-z\\xdf-\\xf6\\xf8-\\xff",P="\\xac\\xb1\\xd7\\xf7",L="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",d="\\u2000-\\u206f",E=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",g="A-Z\\xc0-\\xd6\\xd8-\\xde",k="\\ufe0e\\ufe0f",M=P+L+d+E,j="['\u2019]",U="["+M+"]",I="["+o+"]",O="\\d+",D="["+w+"]",R="["+_+"]",y="[^"+c+M+O+w+_+g+"]",v="\\ud83c[\\udffb-\\udfff]",h="(?:"+I+"|"+v+")",S="[^"+c+"]",A="(?:\\ud83c[\\udde6-\\uddff]){2}",x="[\\ud800-\\udbff][\\udc00-\\udfff]",z="["+g+"]",B="\\u200d",V="(?:"+R+"|"+y+")",Q="(?:"+z+"|"+y+")",oe="(?:"+j+"(?:d|ll|m|re|s|t|ve))?",re="(?:"+j+"(?:D|LL|M|RE|S|T|VE))?",Z=h+"?",ee="["+k+"]?",H="(?:"+B+"(?:"+[S,A,x].join("|")+")"+ee+Z+")*",ae="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",G="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ie=ee+Z+H,le="(?:"+[D,A,x].join("|")+")"+ie,Me=RegExp([z+"?"+R+"+"+oe+"(?="+[U,z,"$"].join("|")+")",Q+"+"+re+"(?="+[U,z+V,"$"].join("|")+")",z+"?"+V+"+"+oe,z+"+"+re,G,ae,O,le].join("|"),"g");function ge(pe){return pe.match(Me)||[]}Te.exports=ge},68929:function(Te,c,n){var i=n(48403),F=n(35393),o=F(function(w,_,P){return _=_.toLowerCase(),w+(P?i(_):_)});Te.exports=o},48403:function(Te,c,n){var i=n(79833),F=n(11700);function o(w){return F(i(w).toLowerCase())}Te.exports=o},74691:function(Te,c,n){var i=n(29750),F=n(14841);function o(w,_,P){return P===void 0&&(P=_,_=void 0),P!==void 0&&(P=F(P),P=P===P?P:0),_!==void 0&&(_=F(_),_=_===_?_:0),i(F(w),_,P)}Te.exports=o},53816:function(Te,c,n){var i=n(69389),F=n(79833),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,w="\\u0300-\\u036f",_="\\ufe20-\\ufe2f",P="\\u20d0-\\u20ff",L=w+_+P,d="["+L+"]",E=RegExp(d,"g");function g(k){return k=F(k),k&&k.replace(o,i).replace(E,"")}Te.exports=g},14293:function(Te){function c(n){return n==null}Te.exports=c},81763:function(Te,c,n){var i=n(44239),F=n(37005),o="[object Number]";function w(_){return typeof _=="number"||F(_)&&i(_)==o}Te.exports=w},30236:function(Te,c,n){var i=n(42980),F=n(21463),o=F(function(w,_,P,L){i(w,_,P,L)});Te.exports=o},23493:function(Te,c,n){var i=n(23279),F=n(13218),o="Expected a function";function w(_,P,L){var d=!0,E=!0;if(typeof _!="function")throw new TypeError(o);return F(L)&&(d="leading"in L?!!L.leading:d,E="trailing"in L?!!L.trailing:E),i(_,P,{leading:d,maxWait:P,trailing:E})}Te.exports=w},44908:function(Te,c,n){var i=n(45652);function F(o){return o&&o.length?i(o):[]}Te.exports=F},11700:function(Te,c,n){var i=n(98805),F=i("toUpperCase");Te.exports=F},58748:function(Te,c,n){var i=n(49029),F=n(93157),o=n(79833),w=n(2757);function _(P,L,d){return P=o(P),L=d?void 0:L,L===void 0?F(P)?w(P):i(P):P.match(L)||[]}Te.exports=_},6158:function(Te){(function(c,n){Te.exports=n()})(this,function(){"use strict";var c,n,i;function F(o,w){if(!c)c=w;else if(!n)n=w;else{var _="var sharedChunk = {}; ("+c+")(sharedChunk); ("+n+")(sharedChunk);",P={};c(P),i=w(P),typeof window!="undefined"&&(i.workerUrl=window.URL.createObjectURL(new Blob([_],{type:"text/javascript"})))}}return F(["exports"],function(o){"use strict";function w(e,t){return e(t={exports:{}},t.exports),t.exports}var _=P;function P(e,t,r,l){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=l,this.p2x=r,this.p2y=l}P.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},P.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},P.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},P.prototype.solveCurveX=function(e,t){var r,l,p,b,N;for(t===void 0&&(t=1e-6),p=e,N=0;N<8;N++){if(b=this.sampleCurveX(p)-e,Math.abs(b)<t)return p;var $=this.sampleCurveDerivativeX(p);if(Math.abs($)<1e-6)break;p-=b/$}if((p=e)<(r=0))return r;if(p>(l=1))return l;for(;r<l;){if(b=this.sampleCurveX(p),Math.abs(b-e)<t)return p;e>b?r=p:l=p,p=.5*(l-r)+r}return p},P.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var L=d;function d(e,t){this.x=e,this.y=t}d.prototype={clone:function(){return new d(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),l=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=l,this},_rotateAround:function(e,t){var r=Math.cos(e),l=Math.sin(e),p=t.y+l*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},d.convert=function(e){return e instanceof d?e:Array.isArray(e)?new d(e[0],e[1]):e};var E=typeof self!="undefined"?self:{},g=Math.pow(2,53)-1;function k(e,t,r,l){var p=new _(e,t,r,l);return function(b){return p.solve(b)}}var M=k(.25,.1,.25,1);function j(e,t,r){return Math.min(r,Math.max(t,e))}function U(e,t,r){var l=r-t,p=((e-t)%l+l)%l+t;return p===t?r:p}function I(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var l=0,p=t;l<p.length;l+=1){var b=p[l];for(var N in b)e[N]=b[N]}return e}var O=1;function D(){return O++}function R(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function y(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function v(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function h(e,t){return e.indexOf(t,e.length-t.length)!==-1}function S(e,t,r){var l={};for(var p in e)l[p]=t.call(r||this,e[p],p,e);return l}function A(e,t,r){var l={};for(var p in e)t.call(r||this,e[p],p,e)&&(l[p]=e[p]);return l}function x(e){return Array.isArray(e)?e.map(x):typeof e=="object"&&e?S(e,x):e}var z={};function B(e){z[e]||(typeof console!="undefined"&&console.warn(e),z[e]=!0)}function V(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Q(e){for(var t=0,r=0,l=e.length,p=l-1,b=void 0,N=void 0;r<l;p=r++)t+=((N=e[p]).x-(b=e[r]).x)*(b.y+N.y);return t}function oe(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function re(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(l,p,b,N){var $=b||N;return t[p]=!$||$.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var Z=null;function ee(e){if(Z==null){var t=e.navigator?e.navigator.userAgent:null;Z=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Z}function H(e){try{var t=E[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var ae,G,ie,le,Me=E.performance&&E.performance.now?E.performance.now.bind(E.performance):Date.now.bind(Date),ge=E.requestAnimationFrame||E.mozRequestAnimationFrame||E.webkitRequestAnimationFrame||E.msRequestAnimationFrame,pe=E.cancelAnimationFrame||E.mozCancelAnimationFrame||E.webkitCancelAnimationFrame||E.msCancelAnimationFrame,Ne={now:Me,frame:function(e){var t=ge(e);return{cancel:function(){return pe(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=E.document.createElement("canvas"),l=r.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,l.drawImage(e,0,0,e.width,e.height),l.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return ae||(ae=E.document.createElement("a")),ae.href=e,ae.href},hardwareConcurrency:E.navigator&&E.navigator.hardwareConcurrency||4,get devicePixelRatio(){return E.devicePixelRatio},get prefersReducedMotion(){return!!E.matchMedia&&(G==null&&(G=E.matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}},Re={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},he={supported:!1,testSupport:function(e){!se&&le&&(J?fe(e):ie=e)}},se=!1,J=!1;function fe(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,le),e.isContextLost())return;he.supported=!0}catch(r){}e.deleteTexture(t),se=!0}E.document&&((le=E.document.createElement("img")).onload=function(){ie&&fe(ie),ie=null,J=!0},le.onerror=function(){se=!0,ie=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var me="01",Le=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function C(e){return e.indexOf("mapbox:")===0}Le.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",me,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Le.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Le.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Le.prototype.normalizeStyleURL=function(e,t){if(!C(e))return e;var r=De(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Le.prototype.normalizeGlyphsURL=function(e,t){if(!C(e))return e;var r=De(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Le.prototype.normalizeSourceURL=function(e,t){if(!C(e))return e;var r=De(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},Le.prototype.normalizeSpriteURL=function(e,t,r,l){var p=De(e);return C(e)?(p.path="/styles/v1"+p.path+"/sprite"+t+r,this._makeAPIURL(p,this._customAccessToken||l)):(p.path+=""+t+r,Ge(p))},Le.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!C(e))return e;var r=De(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ne.devicePixelRatio>=2||t===512?"@2x":"")+(he.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var l=this._customAccessToken||function(p){for(var b=0,N=p;b<N.length;b+=1){var $=N[b].match(/^access_token=(.*)$/);if($)return $[1]}return null}(r.params)||Re.ACCESS_TOKEN;return Re.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,l)},Le.prototype.canonicalizeTileURL=function(e,t){var r=De(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var l="mapbox://tiles/";l+=r.path.replace("/v4/","");var p=r.params;return t&&(p=p.filter(function(b){return!b.match(/^access_token=/)})),p.length&&(l+="?"+p.join("&")),l},Le.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&C(t),l=[],p=0,b=e.tiles||[];p<b.length;p+=1){var N=b[p];de(N)?l.push(this.canonicalizeTileURL(N,r)):l.push(N)}return l},Le.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=De(Re.API_URL);if(e.protocol=l.protocol,e.authority=l.authority,e.protocol==="http"){var p=e.params.indexOf("secure");p>=0&&e.params.splice(p,1)}if(l.path!=="/"&&(e.path=""+l.path+e.path),!Re.REQUIRE_ACCESS_TOKEN)return Ge(e);if(!(t=t||Re.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(b){return b.indexOf("access_token")===-1}),e.params.push("access_token="+t),Ge(e)};var X=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function de(e){return X.test(e)}var Ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function De(e){var t=e.match(Ae);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ge(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function $e(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(E.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var ct=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ct.prototype.getStorageKey=function(e){var t,r=$e(Re.ACCESS_TOKEN);return t=r&&r.u?E.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(l,p){return String.fromCharCode(Number("0x"+p))})):Re.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},ct.prototype.fetchEventData=function(){var e=H("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var l=E.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));var p=E.localStorage.getItem(r);p&&(this.anonId=p)}catch(b){B("Unable to read from LocalStorage")}},ct.prototype.saveEventData=function(){var e=H("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{E.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&E.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(l){B("Unable to write to LocalStorage")}},ct.prototype.processRequests=function(e){},ct.prototype.postEvent=function(e,t,r,l){var p=this;if(Re.EVENTS_URL){var b=De(Re.EVENTS_URL);b.params.push("access_token="+(l||Re.ACCESS_TOKEN||""));var N={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:me,userId:this.anonId},$=t?I(N,t):N,ce={url:Ge(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([$])};this.pendingRequest=xi(ce,function(_e){p.pendingRequest=null,r(_e),p.saveEventData(),p.processRequests(l)})}},ct.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var gt,st,xe=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,l,p,b){this.skuToken=p,(Re.EVENTS_URL&&b||Re.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(N){return C(N)||de(N)}))&&this.queueRequest({id:l,timestamp:Date.now()},b)},t.prototype.processRequests=function(r){var l=this;if(!this.pendingRequest&&this.queue.length!==0){var p=this.queue.shift(),b=p.id,N=p.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),y(this.anonId)||(this.anonId=R()),this.postEvent(N,{skuToken:this.skuToken},function($){$||b&&(l.success[b]=!0)},r))}},t}(ct),Mt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,l){Re.EVENTS_URL&&Re.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(p){return C(p)||de(p)})&&this.queueRequest(Date.now(),l)},t.prototype.processRequests=function(r){var l=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var p=$e(Re.ACCESS_TOKEN),b=p?p.u:Re.ACCESS_TOKEN,N=b!==this.eventData.tokenU;y(this.anonId)||(this.anonId=R(),N=!0);var $=this.queue.shift();if(this.eventData.lastSuccess){var ce=new Date(this.eventData.lastSuccess),_e=new Date($),Ce=($-this.eventData.lastSuccess)/864e5;N=N||Ce>=1||Ce<-1||ce.getDate()!==_e.getDate()}else N=!0;if(!N)return this.processRequests();this.postEvent($,{"enabled.telemetry":!1},function(Pe){Pe||(l.eventData.lastSuccess=$,l.eventData.tokenU=b)},r)}},t}(ct)),Ut=Mt.postTurnstileEvent.bind(Mt),At=new xe,nt=At.postMapLoadEvent.bind(At),it=500,pt=50;function Vt(){E.caches&&!gt&&(gt=E.caches.open("mapbox-tiles"))}function Er(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var mr,Br=1/0;function Ur(){return mr==null&&(mr=E.OffscreenCanvas&&new E.OffscreenCanvas(1,1).getContext("2d")&&typeof E.createImageBitmap=="function"),mr}var Ar={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ar);var Nn=function(e){function t(r,l,p){l===401&&de(p)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=l,this.url=p,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Rn=oe()?function(){return self.worker&&self.worker.referrer}:function(){return(E.location.protocol==="blob:"?E.parent:E).location.href},ci,Fi,ji=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Rn())&&!/^\w+:/.test(r))){if(E.fetch&&E.Request&&E.AbortController&&E.Request.prototype.hasOwnProperty("signal"))return function(l,p){var b,N=new E.AbortController,$=new E.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Rn(),signal:N.signal}),ce=!1,_e=!1,Ce=(b=$.url).indexOf("sku=")>0&&de(b);l.type==="json"&&$.headers.set("Accept","application/json");var Pe=function(He,mt,bt){if(!_e){if(He&&He.message!=="SecurityError"&&B(He),mt&&bt)return Be(mt);var kt=Date.now();E.fetch($).then(function(Tt){if(Tt.ok){var Ht=Ce?Tt.clone():null;return Be(Tt,Ht,kt)}return p(new Nn(Tt.statusText,Tt.status,l.url))}).catch(function(Tt){Tt.code!==20&&p(new Error(Tt.message))})}},Be=function(He,mt,bt){(l.type==="arrayBuffer"?He.arrayBuffer():l.type==="json"?He.json():He.text()).then(function(kt){_e||(mt&&bt&&function(Tt,Ht,rr){if(Vt(),gt){var _r={status:Ht.status,statusText:Ht.statusText,headers:new E.Headers};Ht.headers.forEach(function(Rr,tn){return _r.headers.set(tn,Rr)});var xr=re(Ht.headers.get("Cache-Control")||"");xr["no-store"]||(xr["max-age"]&&_r.headers.set("Expires",new Date(rr+1e3*xr["max-age"]).toUTCString()),new Date(_r.headers.get("Expires")).getTime()-rr<42e4||function(Rr,tn){if(st===void 0)try{new Response(new ReadableStream),st=!0}catch(mn){st=!1}st?tn(Rr.body):Rr.blob().then(tn)}(Ht,function(Rr){var tn=new E.Response(Rr,_r);Vt(),gt&&gt.then(function(mn){return mn.put(Er(Tt.url),tn)}).catch(function(mn){return B(mn.message)})}))}}($,mt,bt),ce=!0,p(null,kt,He.headers.get("Cache-Control"),He.headers.get("Expires")))}).catch(function(kt){_e||p(new Error(kt.message))})};return Ce?function(He,mt){if(Vt(),!gt)return mt(null);var bt=Er(He.url);gt.then(function(kt){kt.match(bt).then(function(Tt){var Ht=function(rr){if(!rr)return!1;var _r=new Date(rr.headers.get("Expires")||0),xr=re(rr.headers.get("Cache-Control")||"");return _r>Date.now()&&!xr["no-cache"]}(Tt);kt.delete(bt),Ht&&kt.put(bt,Tt.clone()),mt(null,Tt,Ht)}).catch(mt)}).catch(mt)}($,Pe):Pe(null,null),{cancel:function(){_e=!0,ce||N.abort()}}}(e,t);if(oe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(l,p){var b=new E.XMLHttpRequest;for(var N in b.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(b.responseType="arraybuffer"),l.headers)b.setRequestHeader(N,l.headers[N]);return l.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=l.credentials==="include",b.onerror=function(){p(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var $=b.response;if(l.type==="json")try{$=JSON.parse(b.response)}catch(ce){return p(ce)}p(null,$,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else p(new Nn(b.statusText,b.status,l.url))},b.send(l.body),{cancel:function(){return b.abort()}}}(e,t)},Si=function(e,t){return ji(I(e,{type:"arrayBuffer"}),t)},xi=function(e,t){return ji(I(e,{method:"POST"}),t)},Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ci=[],Fi=0;var ke=function(e,t){if(he.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Fi>=Re.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return ci.push(r),r}Fi++;var l=!1,p=function(){if(!l)for(l=!0,Fi--;ci.length&&Fi<Re.MAX_PARALLEL_IMAGE_REQUESTS;){var N=ci.shift();N.cancelled||(N.cancel=ke(N.requestParameters,N.callback).cancel)}},b=Si(e,function(N,$,ce,_e){p(),N?t(N):$&&(Ur()?function(Ce,Pe){var Be=new E.Blob([new Uint8Array(Ce)],{type:"image/png"});E.createImageBitmap(Be).then(function(He){Pe(null,He)}).catch(function(He){Pe(new Error("Could not load image because of "+He.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}($,t):function(Ce,Pe,Be,He){var mt=new E.Image,bt=E.URL;mt.onload=function(){Pe(null,mt),bt.revokeObjectURL(mt.src),mt.onload=null,E.requestAnimationFrame(function(){mt.src=Ee})},mt.onerror=function(){return Pe(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var kt=new E.Blob([new Uint8Array(Ce)],{type:"image/png"});mt.cacheControl=Be,mt.expires=He,mt.src=Ce.byteLength?bt.createObjectURL(kt):Ee}($,t,ce,_e))});return{cancel:function(){b.cancel(),p()}}};function ze(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function Ke(e,t,r){if(r&&r[e]){var l=r[e].indexOf(t);l!==-1&&r[e].splice(l,1)}}var ot=function(e,t){t===void 0&&(t={}),I(this,t),this.type=e},Rt=function(e){function t(r,l){l===void 0&&(l={}),e.call(this,"error",I({error:r},l))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ot),Nt=function(){};Nt.prototype.on=function(e,t){return this._listeners=this._listeners||{},ze(e,t,this._listeners),this},Nt.prototype.off=function(e,t){return Ke(e,t,this._listeners),Ke(e,t,this._oneTimeListeners),this},Nt.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ze(e,t,this._oneTimeListeners),this},Nt.prototype.fire=function(e,t){typeof e=="string"&&(e=new ot(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var l=0,p=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];l<p.length;l+=1)p[l].call(this,e);for(var b=0,N=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];b<N.length;b+=1){var $=N[b];Ke(r,$,this._oneTimeListeners),$.call(this,e)}var ce=this._eventedParent;ce&&(I(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),ce.fire(e))}else e instanceof Rt&&console.error(e.error);return this},Nt.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Nt.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Et=function(e,t,r,l){this.message=(e?e+": ":"")+r,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)};function Zt(e){var t=e.value;return t?[new Et(e.key,t,"constants have been deprecated as of v8")]:[]}function Lr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var l=0,p=t;l<p.length;l+=1){var b=p[l];for(var N in b)e[N]=b[N]}return e}function ir(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ur(e){if(Array.isArray(e))return e.map(ur);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=ur(e[r]);return t}return ir(e)}var Or=function(e){function t(r,l){e.call(this,l),this.message=l,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),nn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,l=t;r<l.length;r+=1){var p=l[r];this.bindings[p[0]]=p[1]}};nn.prototype.concat=function(e){return new nn(this,e)},nn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},nn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Hr={kind:"null"},gr={kind:"number"},vn={kind:"string"},an={kind:"boolean"},sn={kind:"color"},Ei={kind:"object"},fn={kind:"value"},ni={kind:"collator"},Ui={kind:"formatted"},mi={kind:"resolvedImage"};function Li(e,t){return{kind:"array",itemType:e,N:t}}function ui(e){if(e.kind==="array"){var t=ui(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var fi=[Hr,gr,vn,an,sn,Ui,Ei,Li(fn),mi];function Wi(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Wi(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,l=fi;r<l.length;r+=1)if(!Wi(l[r],t))return null}}return"Expected "+ui(e)+" but found "+ui(t)+" instead."}function va(e,t){return t.some(function(r){return r.kind===e.kind})}function Pi(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var hi=w(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l($){return($=Math.round($))<0?0:$>255?255:$}function p($){return l($[$.length-1]==="%"?parseFloat($)/100*255:parseInt($))}function b($){return(ce=$[$.length-1]==="%"?parseFloat($)/100:parseFloat($))<0?0:ce>1?1:ce;var ce}function N($,ce,_e){return _e<0?_e+=1:_e>1&&(_e-=1),6*_e<1?$+(ce-$)*_e*6:2*_e<1?ce:3*_e<2?$+(ce-$)*(2/3-_e)*6:$}try{t.parseCSSColor=function($){var ce,_e=$.replace(/ /g,"").toLowerCase();if(_e in r)return r[_e].slice();if(_e[0]==="#")return _e.length===4?(ce=parseInt(_e.substr(1),16))>=0&&ce<=4095?[(3840&ce)>>4|(3840&ce)>>8,240&ce|(240&ce)>>4,15&ce|(15&ce)<<4,1]:null:_e.length===7&&(ce=parseInt(_e.substr(1),16))>=0&&ce<=16777215?[(16711680&ce)>>16,(65280&ce)>>8,255&ce,1]:null;var Ce=_e.indexOf("("),Pe=_e.indexOf(")");if(Ce!==-1&&Pe+1===_e.length){var Be=_e.substr(0,Ce),He=_e.substr(Ce+1,Pe-(Ce+1)).split(","),mt=1;switch(Be){case"rgba":if(He.length!==4)return null;mt=b(He.pop());case"rgb":return He.length!==3?null:[p(He[0]),p(He[1]),p(He[2]),mt];case"hsla":if(He.length!==4)return null;mt=b(He.pop());case"hsl":if(He.length!==3)return null;var bt=(parseFloat(He[0])%360+360)%360/360,kt=b(He[1]),Tt=b(He[2]),Ht=Tt<=.5?Tt*(kt+1):Tt+kt-Tt*kt,rr=2*Tt-Ht;return[l(255*N(rr,Ht,bt+1/3)),l(255*N(rr,Ht,bt)),l(255*N(rr,Ht,bt-1/3)),mt];default:return null}}return null}}catch($){}}).parseCSSColor,Ii=function(e,t,r,l){l===void 0&&(l=1),this.r=e,this.g=t,this.b=r,this.a=l};Ii.parse=function(e){if(e){if(e instanceof Ii)return e;if(typeof e=="string"){var t=hi(e);if(t)return new Ii(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Ii.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],l=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+l+")"},Ii.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Ii.black=new Ii(0,0,0,1),Ii.white=new Ii(1,1,1,1),Ii.transparent=new Ii(0,0,0,0),Ii.red=new Ii(1,0,0,1);var La=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};La.prototype.compare=function(e,t){return this.collator.compare(e,t)},La.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ls=function(e,t,r,l,p){this.text=e,this.image=t,this.scale=r,this.fontStack=l,this.textColor=p},Ta=function(e){this.sections=e};Ta.fromString=function(e){return new Ta([new ls(e,null,null,null,null)])},Ta.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Ta.factory=function(e){return e instanceof Ta?e:Ta.fromString(e)},Ta.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Ta.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var l=r[t];if(l.image)e.push(["image",l.image.name]);else{e.push(l.text);var p={};l.fontStack&&(p["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(p["font-scale"]=l.scale),l.textColor&&(p["text-color"]=["rgba"].concat(l.textColor.toArray())),e.push(p)}}return e};var ma=function(e){this.name=e.name,this.available=e.available};function Qo(e,t,r,l){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:"Invalid rgba value ["+[e,t,r,l].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof l=="number"?[e,t,r,l]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Es(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Ii||e instanceof La||e instanceof Ta||e instanceof ma)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Es(r[t]))return!1;return!0}if(typeof e=="object"){for(var l in e)if(!Es(e[l]))return!1;return!0}return!1}function sa(e){if(e===null)return Hr;if(typeof e=="string")return vn;if(typeof e=="boolean")return an;if(typeof e=="number")return gr;if(e instanceof Ii)return sn;if(e instanceof La)return ni;if(e instanceof Ta)return Ui;if(e instanceof ma)return mi;if(Array.isArray(e)){for(var t,r=e.length,l=0,p=e;l<p.length;l+=1){var b=sa(p[l]);if(t){if(t===b)continue;t=fn;break}t=b}return Li(t||fn,r)}return Ei}function to(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Ii||e instanceof Ta||e instanceof ma?e.toString():JSON.stringify(e)}ma.prototype.toString=function(){return this.name},ma.fromString=function(e){return e?new ma({name:e,available:!1}):null},ma.prototype.serialize=function(){return["image",this.name]};var _a=function(e,t){this.type=e,this.value=t};_a.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Es(e[1]))return t.error("invalid value");var r=e[1],l=sa(r),p=t.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new _a(l,r)},_a.prototype.evaluate=function(){return this.value},_a.prototype.eachChild=function(){},_a.prototype.outputDefined=function(){return!0},_a.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ii?["rgba"].concat(this.value.toArray()):this.value instanceof Ta?this.value.serialize():this.value};var wa=function(e){this.name="ExpressionEvaluationError",this.message=e};wa.prototype.toJSON=function(){return this.message};var $a={string:vn,number:gr,boolean:an,object:Ei},ia=function(e,t){this.type=e,this.args=t};ia.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,l=1,p=e[0];if(p==="array"){var b,N;if(e.length>2){var $=e[1];if(typeof $!="string"||!($ in $a)||$==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);b=$a[$],l++}else b=fn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);N=e[2],l++}r=Li(b,N)}else r=$a[p];for(var ce=[];l<e.length;l++){var _e=t.parse(e[l],l,fn);if(!_e)return null;ce.push(_e)}return new ia(r,ce)},ia.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Wi(this.type,sa(r)))return r;if(t===this.args.length-1)throw new wa("Expected value to be of type "+ui(this.type)+", but found "+ui(sa(r))+" instead.")}return null},ia.prototype.eachChild=function(e){this.args.forEach(e)},ia.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ia.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(function(p){return p.serialize()}))};var Ja=function(e){this.type=Ui,this.sections=e};Ja.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var l=[],p=!1,b=1;b<=e.length-1;++b){var N=e[b];if(p&&typeof N=="object"&&!Array.isArray(N)){p=!1;var $=null;if(N["font-scale"]&&!($=t.parse(N["font-scale"],1,gr)))return null;var ce=null;if(N["text-font"]&&!(ce=t.parse(N["text-font"],1,Li(vn))))return null;var _e=null;if(N["text-color"]&&!(_e=t.parse(N["text-color"],1,sn)))return null;var Ce=l[l.length-1];Ce.scale=$,Ce.font=ce,Ce.textColor=_e}else{var Pe=t.parse(e[b],1,fn);if(!Pe)return null;var Be=Pe.type.kind;if(Be!=="string"&&Be!=="value"&&Be!=="null"&&Be!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:Pe,scale:null,font:null,textColor:null})}}return new Ja(l)},Ja.prototype.evaluate=function(e){return new Ta(this.sections.map(function(t){var r=t.content.evaluate(e);return sa(r)===mi?new ls("",r,null,null,null):new ls(to(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Ja.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var l=r[t];e(l.content),l.scale&&e(l.scale),l.font&&e(l.font),l.textColor&&e(l.textColor)}},Ja.prototype.outputDefined=function(){return!1},Ja.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var l=r[t];e.push(l.content.serialize());var p={};l.scale&&(p["font-scale"]=l.scale.serialize()),l.font&&(p["text-font"]=l.font.serialize()),l.textColor&&(p["text-color"]=l.textColor.serialize()),e.push(p)}return e};var ro=function(e){this.type=mi,this.input=e};ro.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vn);return r?new ro(r):t.error("No image name provided.")},ro.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=ma.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},ro.prototype.eachChild=function(e){e(this.input)},ro.prototype.outputDefined=function(){return!1},ro.prototype.serialize=function(){return["image",this.input.serialize()]};var Xa={"to-boolean":an,"to-color":sn,"to-number":gr,"to-string":vn},no=function(e,t){this.type=e,this.args=t};no.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var l=Xa[r],p=[],b=1;b<e.length;b++){var N=t.parse(e[b],b,fn);if(!N)return null;p.push(N)}return new no(l,p)},no.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,l=0,p=this.args;l<p.length;l+=1){if(r=null,(t=p[l].evaluate(e))instanceof Ii)return t;if(typeof t=="string"){var b=e.parseColor(t);if(b)return b}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Qo(t[0],t[1],t[2],t[3])))return new Ii(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new wa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var N=null,$=0,ce=this.args;$<ce.length;$+=1){if((N=ce[$].evaluate(e))===null)return 0;var _e=Number(N);if(!isNaN(_e))return _e}throw new wa("Could not convert "+JSON.stringify(N)+" to number.")}return this.type.kind==="formatted"?Ta.fromString(to(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ma.fromString(to(this.args[0].evaluate(e))):to(this.args[0].evaluate(e))},no.prototype.eachChild=function(e){this.args.forEach(e)},no.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},no.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ro(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var go=["Unknown","Point","LineString","Polygon"],fa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?go[this.feature.type]:this.feature.type:null},fa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fa.prototype.canonicalID=function(){return this.canonical},fa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fa.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ii.parse(e)),t};var ja=function(e,t,r,l){this.name=e,this.type=t,this._evaluate=r,this.args=l};ja.prototype.evaluate=function(e){return this._evaluate(e,this.args)},ja.prototype.eachChild=function(e){this.args.forEach(e)},ja.prototype.outputDefined=function(){return!1},ja.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},ja.parse=function(e,t){var r,l=e[0],p=ja.definitions[l];if(!p)return t.error('Unknown expression "'+l+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(p)?p[0]:p.type,N=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,$=N.filter(function(ai){var Fn=ai[0];return!Array.isArray(Fn)||Fn.length===e.length-1}),ce=null,_e=0,Ce=$;_e<Ce.length;_e+=1){var Pe=Ce[_e],Be=Pe[0],He=Pe[1];ce=new Ue(t.registry,t.path,null,t.scope);for(var mt=[],bt=!1,kt=1;kt<e.length;kt++){var Tt=e[kt],Ht=Array.isArray(Be)?Be[kt-1]:Be.type,rr=ce.parse(Tt,1+mt.length,Ht);if(!rr){bt=!0;break}mt.push(rr)}if(!bt)if(Array.isArray(Be)&&Be.length!==mt.length)ce.error("Expected "+Be.length+" arguments, but found "+mt.length+" instead.");else{for(var _r=0;_r<mt.length;_r++){var xr=Array.isArray(Be)?Be[_r]:Be.type,Rr=mt[_r];ce.concat(_r+1).checkSubtype(xr,Rr.type)}if(ce.errors.length===0)return new ja(l,b,He,mt)}}if($.length===1)(r=t.errors).push.apply(r,ce.errors);else{for(var tn=($.length?$:N).map(function(ai){var Fn;return Fn=ai[0],Array.isArray(Fn)?"("+Fn.map(ui).join(", ")+")":"("+ui(Fn.type)+"...)"}).join(" | "),mn=[],qn=1;qn<e.length;qn++){var In=t.parse(e[qn],1+mn.length);if(!In)return null;mn.push(ui(In.type))}t.error("Expected arguments of type "+tn+", but found ("+mn.join(", ")+") instead.")}return null},ja.register=function(e,t){for(var r in ja.definitions=t,t)e[r]=ja};var Qa=function(e,t,r){this.type=ni,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Ua(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ve(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function rt(e,t){var r=(180+e[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(r*p*8192),Math.round(l*p*8192)]}function wt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function lr(e,t){for(var r,l,p,b,N,$,ce,_e=!1,Ce=0,Pe=t.length;Ce<Pe;Ce++)for(var Be=t[Ce],He=0,mt=Be.length;He<mt-1;He++){if((b=(r=e)[0]-(l=Be[He])[0])*(ce=r[1]-(p=Be[He+1])[1])-($=r[0]-p[0])*(N=r[1]-l[1])==0&&b*$<=0&&N*ce<=0)return!1;wt(e,Be[He],Be[He+1])&&(_e=!_e)}return _e}function Zr(e,t){for(var r=0;r<t.length;r++)if(lr(e,t[r]))return!0;return!1}function Un(e,t,r,l){var p=l[0]-r[0],b=l[1]-r[1],N=(e[0]-r[0])*b-p*(e[1]-r[1]),$=(t[0]-r[0])*b-p*(t[1]-r[1]);return N>0&&$<0||N<0&&$>0}function oi(e,t,r){for(var l=0,p=r;l<p.length;l+=1)for(var b=p[l],N=0;N<b.length-1;++N)if((Pe=[(Ce=b[N+1])[0]-(_e=b[N])[0],Ce[1]-_e[1]])[0]*(Be=[(ce=t)[0]-($=e)[0],ce[1]-$[1]])[1]-Pe[1]*Be[0]!=0&&Un($,ce,_e,Ce)&&Un(_e,Ce,$,ce))return!0;var $,ce,_e,Ce,Pe,Be;return!1}function te(e,t){for(var r=0;r<e.length;++r)if(!lr(e[r],t))return!1;for(var l=0;l<e.length-1;++l)if(oi(e[l],e[l+1],t))return!1;return!0}function be(e,t){for(var r=0;r<t.length;r++)if(te(e,t[r]))return!0;return!1}function tt(e,t,r){for(var l=[],p=0;p<e.length;p++){for(var b=[],N=0;N<e[p].length;N++){var $=rt(e[p][N],r);Ua(t,$),b.push($)}l.push(b)}return l}function yt(e,t,r){for(var l=[],p=0;p<e.length;p++){var b=tt(e[p],t,r);l.push(b)}return l}function Bt(e,t,r,l){if(e[0]<r[0]||e[0]>r[2]){var p=.5*l,b=e[0]-r[0]>p?-l:r[0]-e[0]>p?l:0;b===0&&(b=e[0]-r[2]>p?-l:r[2]-e[0]>p?l:0),e[0]+=b}Ua(t,e)}function qt(e,t,r,l){for(var p=8192*Math.pow(2,l.z),b=[8192*l.x,8192*l.y],N=[],$=0,ce=e;$<ce.length;$+=1)for(var _e=0,Ce=ce[$];_e<Ce.length;_e+=1){var Pe=Ce[_e],Be=[Pe.x+b[0],Pe.y+b[1]];Bt(Be,t,r,p),N.push(Be)}return N}function Wt(e,t,r,l){for(var p,b=8192*Math.pow(2,l.z),N=[8192*l.x,8192*l.y],$=[],ce=0,_e=e;ce<_e.length;ce+=1){for(var Ce=[],Pe=0,Be=_e[ce];Pe<Be.length;Pe+=1){var He=Be[Pe],mt=[He.x+N[0],He.y+N[1]];Ua(t,mt),Ce.push(mt)}$.push(Ce)}if(t[2]-t[0]<=b/2){(p=t)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(var bt=0,kt=$;bt<kt.length;bt+=1)for(var Tt=0,Ht=kt[bt];Tt<Ht.length;Tt+=1)Bt(Ht[Tt],t,r,b)}return $}Qa.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var l=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,an);if(!l)return null;var p=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,an);if(!p)return null;var b=null;return r.locale&&!(b=t.parse(r.locale,1,vn))?null:new Qa(l,p,b)},Qa.prototype.evaluate=function(e){return new La(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Qa.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Qa.prototype.outputDefined=function(){return!1},Qa.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var or=function(e,t){this.type=an,this.geojson=e,this.geometries=t};function ar(e){if(e instanceof ja&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof or)return!1;var t=!0;return e.eachChild(function(r){t&&!ar(r)&&(t=!1)}),t}function kr(e){if(e instanceof ja&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!kr(r)&&(t=!1)}),t}function we(e,t){if(e instanceof ja&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(l){r&&!we(l,t)&&(r=!1)}),r}or.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Es(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var l=0;l<r.features.length;++l){var p=r.features[l].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new or(r,r.features[l].geometry)}else if(r.type==="Feature"){var b=r.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new or(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new or(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},or.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],b=t.canonicalID();if(r.type==="Polygon"){var N=tt(r.coordinates,p,b),$=qt(t.geometry(),l,p,b);if(!Ve(l,p))return!1;for(var ce=0,_e=$;ce<_e.length;ce+=1)if(!lr(_e[ce],N))return!1}if(r.type==="MultiPolygon"){var Ce=yt(r.coordinates,p,b),Pe=qt(t.geometry(),l,p,b);if(!Ve(l,p))return!1;for(var Be=0,He=Pe;Be<He.length;Be+=1)if(!Zr(He[Be],Ce))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],b=t.canonicalID();if(r.type==="Polygon"){var N=tt(r.coordinates,p,b),$=Wt(t.geometry(),l,p,b);if(!Ve(l,p))return!1;for(var ce=0,_e=$;ce<_e.length;ce+=1)if(!te(_e[ce],N))return!1}if(r.type==="MultiPolygon"){var Ce=yt(r.coordinates,p,b),Pe=Wt(t.geometry(),l,p,b);if(!Ve(l,p))return!1;for(var Be=0,He=Pe;Be<He.length;Be+=1)if(!be(He[Be],Ce))return!1}return!0}(e,this.geometries)}return!1},or.prototype.eachChild=function(){},or.prototype.outputDefined=function(){return!0},or.prototype.serialize=function(){return["within",this.geojson]};var je=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};je.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new je(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},je.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},je.prototype.eachChild=function(){},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return["var",this.name]};var Ue=function(e,t,r,l,p){t===void 0&&(t=[]),l===void 0&&(l=new nn),p===void 0&&(p=[]),this.registry=e,this.path=t,this.key=t.map(function(b){return"["+b+"]"}).join(""),this.scope=l,this.errors=p,this.expectedType=r};function ut(e,t){for(var r,l=e.length-1,p=0,b=l,N=0;p<=b;)if((r=e[N=Math.floor((p+b)/2)])<=t){if(N===l||t<e[N+1])return N;p=N+1}else{if(!(r>t))throw new wa("Input is not a number.");b=N-1}return 0}Ue.prototype.parse=function(e,t,r,l,p){return p===void 0&&(p={}),t?this.concat(t,r,l)._parse(e,p):this._parse(e,p)},Ue.prototype._parse=function(e,t){function r(_e,Ce,Pe){return Pe==="assert"?new ia(Ce,[_e]):Pe==="coerce"?new no(Ce,[_e]):_e}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var l=e[0];if(typeof l!="string")return this.error("Expression name must be a string, but found "+typeof l+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var p=this.registry[l];if(p){var b=p.parse(e,this);if(!b)return null;if(this.expectedType){var N=this.expectedType,$=b.type;if(N.kind!=="string"&&N.kind!=="number"&&N.kind!=="boolean"&&N.kind!=="object"&&N.kind!=="array"||$.kind!=="value")if(N.kind!=="color"&&N.kind!=="formatted"&&N.kind!=="resolvedImage"||$.kind!=="value"&&$.kind!=="string"){if(this.checkSubtype(N,$))return null}else b=r(b,N,t.typeAnnotation||"coerce");else b=r(b,N,t.typeAnnotation||"assert")}if(!(b instanceof _a)&&b.type.kind!=="resolvedImage"&&function _e(Ce){if(Ce instanceof je)return _e(Ce.boundExpression);if(Ce instanceof ja&&Ce.name==="error"||Ce instanceof Qa||Ce instanceof or)return!1;var Pe=Ce instanceof no||Ce instanceof ia,Be=!0;return Ce.eachChild(function(He){Be=Pe?Be&&_e(He):Be&&He instanceof _a}),!!Be&&ar(Ce)&&we(Ce,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var ce=new fa;try{b=new _a(b.type,b.evaluate(ce))}catch(_e){return this.error(_e.message),null}}return b}return this.error('Unknown expression "'+l+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ue.prototype.concat=function(e,t,r){var l=typeof e=="number"?this.path.concat(e):this.path,p=r?this.scope.concat(r):this.scope;return new Ue(this.registry,l,t||null,p,this.errors)},Ue.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var l=""+this.key+t.map(function(p){return"["+p+"]"}).join("");this.errors.push(new Or(l,e))},Ue.prototype.checkSubtype=function(e,t){var r=Wi(e,t);return r&&this.error(r),r};var Xt=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var l=0,p=r;l<p.length;l+=1){var b=p[l],N=b[1];this.labels.push(b[0]),this.outputs.push(N)}};function Mr(e,t,r){return e*(1-r)+t*r}Xt.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var l=[],p=null;t.expectedType&&t.expectedType.kind!=="value"&&(p=t.expectedType);for(var b=1;b<e.length;b+=2){var N=b===1?-1/0:e[b],$=e[b+1],ce=b,_e=b+1;if(typeof N!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ce);if(l.length&&l[l.length-1][0]>=N)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ce);var Ce=t.parse($,_e,p);if(!Ce)return null;p=p||Ce.type,l.push([N,Ce])}return new Xt(p,r,l)},Xt.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var l=this.input.evaluate(e);if(l<=t[0])return r[0].evaluate(e);var p=t.length;return l>=t[p-1]?r[p-1].evaluate(e):r[ut(t,l)].evaluate(e)},Xt.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Xt.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Xt.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var bn=Object.freeze({__proto__:null,number:Mr,color:function(e,t,r){return new Ii(Mr(e.r,t.r,r),Mr(e.g,t.g,r),Mr(e.b,t.b,r),Mr(e.a,t.a,r))},array:function(e,t,r){return e.map(function(l,p){return Mr(l,t[p],r)})}}),ei=6/29*3*(6/29),Ci=Math.PI/180,Xi=180/Math.PI;function Fa(e){return e>.008856451679035631?Math.pow(e,1/3):e/ei+4/29}function aa(e){return e>6/29?e*e*e:ei*(e-4/29)}function Oi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function vs(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Yi(e){var t=vs(e.r),r=vs(e.g),l=vs(e.b),p=Fa((.4124564*t+.3575761*r+.1804375*l)/.95047),b=Fa((.2126729*t+.7151522*r+.072175*l)/1);return{l:116*b-16,a:500*(p-b),b:200*(b-Fa((.0193339*t+.119192*r+.9503041*l)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,l=isNaN(e.b)?t:t-e.b/200;return t=1*aa(t),r=.95047*aa(r),l=1.08883*aa(l),new Ii(Oi(3.2404542*r-1.5371385*t-.4985314*l),Oi(-.969266*r+1.8760108*t+.041556*l),Oi(.0556434*r-.2040259*t+1.0572252*l),e.alpha)}function Y(e,t,r){var l=t-e;return e+r*(l>180||l<-180?l-360*Math.round(l/360):l)}var ve={forward:Yi,reverse:m,interpolate:function(e,t,r){return{l:Mr(e.l,t.l,r),a:Mr(e.a,t.a,r),b:Mr(e.b,t.b,r),alpha:Mr(e.alpha,t.alpha,r)}}},ne={forward:function(e){var t=Yi(e),r=t.l,l=t.a,p=t.b,b=Math.atan2(p,l)*Xi;return{h:b<0?b+360:b,c:Math.sqrt(l*l+p*p),l:r,alpha:e.a}},reverse:function(e){var t=e.h*Ci,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:Y(e.h,t.h,r),c:Mr(e.c,t.c,r),l:Mr(e.l,t.l,r),alpha:Mr(e.alpha,t.alpha,r)}}},Fe=Object.freeze({__proto__:null,lab:ve,hcl:ne}),et=function(e,t,r,l,p){this.type=e,this.operator=t,this.interpolation=r,this.input=l,this.labels=[],this.outputs=[];for(var b=0,N=p;b<N.length;b+=1){var $=N[b],ce=$[1];this.labels.push($[0]),this.outputs.push(ce)}};function Lt(e,t,r,l){var p=l-r,b=e-r;return p===0?0:t===1?b/p:(Math.pow(t,b)-1)/(Math.pow(t,p)-1)}et.interpolationFactor=function(e,t,r,l){var p=0;if(e.name==="exponential")p=Lt(t,e.base,r,l);else if(e.name==="linear")p=Lt(t,1,r,l);else if(e.name==="cubic-bezier"){var b=e.controlPoints;p=new _(b[0],b[1],b[2],b[3]).solve(Lt(t,1,r,l))}return p},et.parse=function(e,t){var r=e[0],l=e[1],p=e[2],b=e.slice(3);if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){var N=l[1];if(typeof N!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:N}}else{if(l[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(l[0]),1,0);var $=l.slice(1);if($.length!==4||$.some(function(kt){return typeof kt!="number"||kt<0||kt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:$}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(p=t.parse(p,2,gr)))return null;var ce=[],_e=null;r==="interpolate-hcl"||r==="interpolate-lab"?_e=sn:t.expectedType&&t.expectedType.kind!=="value"&&(_e=t.expectedType);for(var Ce=0;Ce<b.length;Ce+=2){var Pe=b[Ce],Be=b[Ce+1],He=Ce+3,mt=Ce+4;if(typeof Pe!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',He);if(ce.length&&ce[ce.length-1][0]>=Pe)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',He);var bt=t.parse(Be,mt,_e);if(!bt)return null;_e=_e||bt.type,ce.push([Pe,bt])}return _e.kind==="number"||_e.kind==="color"||_e.kind==="array"&&_e.itemType.kind==="number"&&typeof _e.N=="number"?new et(_e,r,l,p,ce):t.error("Type "+ui(_e)+" is not interpolatable.")},et.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var l=this.input.evaluate(e);if(l<=t[0])return r[0].evaluate(e);var p=t.length;if(l>=t[p-1])return r[p-1].evaluate(e);var b=ut(t,l),N=et.interpolationFactor(this.interpolation,l,t[b],t[b+1]),$=r[b].evaluate(e),ce=r[b+1].evaluate(e);return this.operator==="interpolate"?bn[this.type.kind.toLowerCase()]($,ce,N):this.operator==="interpolate-hcl"?ne.reverse(ne.interpolate(ne.forward($),ne.forward(ce),N)):ve.reverse(ve.interpolate(ve.forward($),ve.forward(ce),N))},et.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},et.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},et.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Kt=function(e,t){this.type=e,this.args=t};Kt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,l=t.expectedType;l&&l.kind!=="value"&&(r=l);for(var p=[],b=0,N=e.slice(1);b<N.length;b+=1){var $=t.parse(N[b],1+p.length,r,void 0,{typeAnnotation:"omit"});if(!$)return null;r=r||$.type,p.push($)}var ce=l&&p.some(function(_e){return Wi(l,_e.type)});return new Kt(ce?fn:r,p)},Kt.prototype.evaluate=function(e){for(var t,r=null,l=0,p=0,b=this.args;p<b.length&&(l++,(r=b[p].evaluate(e))&&r instanceof ma&&!r.available&&(t||(t=r.name),r=null,l===this.args.length&&(r=t)),r===null);p+=1);return r},Kt.prototype.eachChild=function(e){this.args.forEach(e)},Kt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Kt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Gt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Gt.prototype.evaluate=function(e){return this.result.evaluate(e)},Gt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Gt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],l=1;l<e.length-1;l+=2){var p=e[l];if(typeof p!="string")return t.error("Expected string, but found "+typeof p+" instead.",l);if(/[^a-zA-Z0-9_]/.test(p))return t.error("Variable names must contain only alphanumeric characters or '_'.",l);var b=t.parse(e[l+1],l+1);if(!b)return null;r.push([p,b])}var N=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return N?new Gt(r,N):null},Gt.prototype.outputDefined=function(){return this.result.outputDefined()},Gt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var l=r[t];e.push(l[0],l[1].serialize())}return e.push(this.result.serialize()),e};var Fr=function(e,t,r){this.type=e,this.index=t,this.input=r};Fr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,gr),l=t.parse(e[2],2,Li(t.expectedType||fn));return r&&l?new Fr(l.type.itemType,r,l):null},Fr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new wa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new wa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new wa("Array index must be an integer, but found "+t+" instead.");return r[t]},Fr.prototype.eachChild=function(e){e(this.index),e(this.input)},Fr.prototype.outputDefined=function(){return!1},Fr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Vr=function(e,t){this.type=an,this.needle=e,this.haystack=t};Vr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),l=t.parse(e[2],2,fn);return r&&l?va(r.type,[an,vn,gr,Hr,fn])?new Vr(r,l):t.error("Expected first argument to be of type boolean, string, number or null, but found "+ui(r.type)+" instead"):null},Vr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Pi(t,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+ui(sa(t))+" instead.");if(!Pi(r,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+ui(sa(r))+" instead.");return r.indexOf(t)>=0},Vr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Vr.prototype.outputDefined=function(){return!0},Vr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Zn=function(e,t,r){this.type=gr,this.needle=e,this.haystack=t,this.fromIndex=r};Zn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),l=t.parse(e[2],2,fn);if(!r||!l)return null;if(!va(r.type,[an,vn,gr,Hr,fn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+ui(r.type)+" instead");if(e.length===4){var p=t.parse(e[3],3,gr);return p?new Zn(r,l,p):null}return new Zn(r,l)},Zn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Pi(t,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+ui(sa(t))+" instead.");if(!Pi(r,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+ui(sa(r))+" instead.");if(this.fromIndex){var l=this.fromIndex.evaluate(e);return r.indexOf(t,l)}return r.indexOf(t)},Zn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Zn.prototype.outputDefined=function(){return!1},Zn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ri=function(e,t,r,l,p,b){this.inputType=e,this.type=t,this.input=r,this.cases=l,this.outputs=p,this.otherwise=b};Ri.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(var p={},b=[],N=2;N<e.length-1;N+=2){var $=e[N],ce=e[N+1];Array.isArray($)||($=[$]);var _e=t.concat(N);if($.length===0)return _e.error("Expected at least one branch label.");for(var Ce=0,Pe=$;Ce<Pe.length;Ce+=1){var Be=Pe[Ce];if(typeof Be!="number"&&typeof Be!="string")return _e.error("Branch labels must be numbers or strings.");if(typeof Be=="number"&&Math.abs(Be)>Number.MAX_SAFE_INTEGER)return _e.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof Be=="number"&&Math.floor(Be)!==Be)return _e.error("Numeric branch labels must be integer values.");if(r){if(_e.checkSubtype(r,sa(Be)))return null}else r=sa(Be);if(p[String(Be)]!==void 0)return _e.error("Branch labels must be unique.");p[String(Be)]=b.length}var He=t.parse(ce,N,l);if(!He)return null;l=l||He.type,b.push(He)}var mt=t.parse(e[1],1,fn);if(!mt)return null;var bt=t.parse(e[e.length-1],e.length-1,l);return bt?mt.type.kind!=="value"&&t.concat(1).checkSubtype(r,mt.type)?null:new Ri(r,l,mt,p,b,bt):null},Ri.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(sa(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Ri.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Ri.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Ri.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],l={},p=0,b=Object.keys(this.cases).sort();p<b.length;p+=1){var N=b[p];(Pe=l[this.cases[N]])===void 0?(l[this.cases[N]]=r.length,r.push([this.cases[N],[N]])):r[Pe][1].push(N)}for(var $=function(He){return e.inputType.kind==="number"?Number(He):He},ce=0,_e=r;ce<_e.length;ce+=1){var Ce=_e[ce],Pe=Ce[0],Be=Ce[1];t.push(Be.length===1?$(Be[0]):Be.map($)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var ti=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};ti.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var l=[],p=1;p<e.length-1;p+=2){var b=t.parse(e[p],p,an);if(!b)return null;var N=t.parse(e[p+1],p+1,r);if(!N)return null;l.push([b,N]),r=r||N.type}var $=t.parse(e[e.length-1],e.length-1,r);return $?new ti(r,l,$):null},ti.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var l=r[t],p=l[1];if(l[0].evaluate(e))return p.evaluate(e)}return this.otherwise.evaluate(e)},ti.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var l=r[t],p=l[1];e(l[0]),e(p)}e(this.otherwise)},ti.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},ti.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ha=function(e,t,r,l){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=l};function ua(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ga(e,t,r,l){return l.compare(t,r)===0}function Vi(e,t,r){var l=e!=="=="&&e!=="!=";return function(){function p(b,N,$){this.type=an,this.lhs=b,this.rhs=N,this.collator=$,this.hasUntypedArgument=b.type.kind==="value"||N.type.kind==="value"}return p.parse=function(b,N){if(b.length!==3&&b.length!==4)return N.error("Expected two or three arguments.");var $=b[0],ce=N.parse(b[1],1,fn);if(!ce)return null;if(!ua($,ce.type))return N.concat(1).error('"'+$+`" comparisons are not supported for type '`+ui(ce.type)+"'.");var _e=N.parse(b[2],2,fn);if(!_e)return null;if(!ua($,_e.type))return N.concat(2).error('"'+$+`" comparisons are not supported for type '`+ui(_e.type)+"'.");if(ce.type.kind!==_e.type.kind&&ce.type.kind!=="value"&&_e.type.kind!=="value")return N.error("Cannot compare types '"+ui(ce.type)+"' and '"+ui(_e.type)+"'.");l&&(ce.type.kind==="value"&&_e.type.kind!=="value"?ce=new ia(_e.type,[ce]):ce.type.kind!=="value"&&_e.type.kind==="value"&&(_e=new ia(ce.type,[_e])));var Ce=null;if(b.length===4){if(ce.type.kind!=="string"&&_e.type.kind!=="string"&&ce.type.kind!=="value"&&_e.type.kind!=="value")return N.error("Cannot use collator to compare non-string types.");if(!(Ce=N.parse(b[3],3,ni)))return null}return new p(ce,_e,Ce)},p.prototype.evaluate=function(b){var N=this.lhs.evaluate(b),$=this.rhs.evaluate(b);if(l&&this.hasUntypedArgument){var ce=sa(N),_e=sa($);if(ce.kind!==_e.kind||ce.kind!=="string"&&ce.kind!=="number")throw new wa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+ce.kind+", "+_e.kind+") instead.")}if(this.collator&&!l&&this.hasUntypedArgument){var Ce=sa(N),Pe=sa($);if(Ce.kind!=="string"||Pe.kind!=="string")return t(b,N,$)}return this.collator?r(b,N,$,this.collator.evaluate(b)):t(b,N,$)},p.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},p.prototype.outputDefined=function(){return!0},p.prototype.serialize=function(){var b=[e];return this.eachChild(function(N){b.push(N.serialize())}),b},p}()}ha.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,fn),l=t.parse(e[2],2,gr);if(!r||!l)return null;if(!va(r.type,[Li(fn),vn,fn]))return t.error("Expected first argument to be of type array or string, but found "+ui(r.type)+" instead");if(e.length===4){var p=t.parse(e[3],3,gr);return p?new ha(r.type,r,l,p):null}return new ha(r.type,r,l)},ha.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Pi(t,["string","array"]))throw new wa("Expected first argument to be of type array or string, but found "+ui(sa(t))+" instead.");if(this.endIndex){var l=this.endIndex.evaluate(e);return t.slice(r,l)}return t.slice(r)},ha.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ha.prototype.outputDefined=function(){return!1},ha.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Cs=Vi("==",function(e,t,r){return t===r},Ga),Gs=Vi("!=",function(e,t,r){return t!==r},function(e,t,r,l){return!Ga(0,t,r,l)}),Qs=Vi("<",function(e,t,r){return t<r},function(e,t,r,l){return l.compare(t,r)<0}),ll=Vi(">",function(e,t,r){return t>r},function(e,t,r,l){return l.compare(t,r)>0}),Hs=Vi("<=",function(e,t,r){return t<=r},function(e,t,r,l){return l.compare(t,r)<=0}),Vu=Vi(">=",function(e,t,r){return t>=r},function(e,t,r,l){return l.compare(t,r)>=0}),ks=function(e,t,r,l,p){this.type=vn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=l,this.maxFractionDigits=p};ks.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");var p=null;if(l.locale&&!(p=t.parse(l.locale,1,vn)))return null;var b=null;if(l.currency&&!(b=t.parse(l.currency,1,vn)))return null;var N=null;if(l["min-fraction-digits"]&&!(N=t.parse(l["min-fraction-digits"],1,gr)))return null;var $=null;return l["max-fraction-digits"]&&!($=t.parse(l["max-fraction-digits"],1,gr))?null:new ks(r,p,b,N,$)},ks.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},ks.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},ks.prototype.outputDefined=function(){return!1},ks.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Os=function(e){this.type=gr,this.input=e};Os.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+ui(r.type)+" instead."):new Os(r):null},Os.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new wa("Expected value to be of type string or array, but found "+ui(sa(t))+" instead.")},Os.prototype.eachChild=function(e){e(this.input)},Os.prototype.outputDefined=function(){return!1},Os.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ra={"==":Cs,"!=":Gs,">":ll,"<":Qs,">=":Vu,"<=":Hs,array:ia,at:Fr,boolean:ia,case:ti,coalesce:Kt,collator:Qa,format:Ja,image:ro,in:Vr,"index-of":Zn,interpolate:et,"interpolate-hcl":et,"interpolate-lab":et,length:Os,let:Gt,literal:_a,match:Ri,number:ia,"number-format":ks,object:ia,slice:ha,step:Xt,string:ia,"to-boolean":no,"to-color":no,"to-number":no,"to-string":no,var:je,within:or};function cl(e,t){var r=t[0],l=t[1],p=t[2],b=t[3];r=r.evaluate(e),l=l.evaluate(e),p=p.evaluate(e);var N=b?b.evaluate(e):1,$=Qo(r,l,p,N);if($)throw new wa($);return new Ii(r/255*N,l/255*N,p/255*N,N)}function $l(e,t){return e in t}function Ts(e,t){var r=t[e];return r===void 0?null:r}function Zs(e){return{type:e}}function Gu(e){return{result:"success",value:e}}function ms(e){return{result:"error",value:e}}function Ws(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Ou(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Ys(e){return!!e.expression&&e.expression.interpolated}function Oa(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Hu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Dl(e){return e}function yu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Jl(e,t,r,l,p){return yu(typeof r===p?l[r]:void 0,e.default,t.default)}function vc(e,t,r){if(Oa(r)!=="number")return yu(e.default,t.default);var l=e.stops.length;if(l===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[l-1][0])return e.stops[l-1][1];var p=ut(e.stops.map(function(b){return b[0]}),r);return e.stops[p][1]}function Ql(e,t,r){var l=e.base!==void 0?e.base:1;if(Oa(r)!=="number")return yu(e.default,t.default);var p=e.stops.length;if(p===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[p-1][0])return e.stops[p-1][1];var b=ut(e.stops.map(function(Pe){return Pe[0]}),r),N=function(Pe,Be,He,mt){var bt=mt-He,kt=Pe-He;return bt===0?0:Be===1?kt/bt:(Math.pow(Be,kt)-1)/(Math.pow(Be,bt)-1)}(r,l,e.stops[b][0],e.stops[b+1][0]),$=e.stops[b][1],ce=e.stops[b+1][1],_e=bn[t.type]||Dl;if(e.colorSpace&&e.colorSpace!=="rgb"){var Ce=Fe[e.colorSpace];_e=function(Pe,Be){return Ce.reverse(Ce.interpolate(Ce.forward(Pe),Ce.forward(Be),N))}}return typeof $.evaluate=="function"?{evaluate:function(){for(var Pe=[],Be=arguments.length;Be--;)Pe[Be]=arguments[Be];var He=$.evaluate.apply(void 0,Pe),mt=ce.evaluate.apply(void 0,Pe);if(He!==void 0&&mt!==void 0)return _e(He,mt,N)}}:_e($,ce,N)}function Zu(e,t,r){return t.type==="color"?r=Ii.parse(r):t.type==="formatted"?r=Ta.fromString(r.toString()):t.type==="resolvedImage"?r=ma.fromString(r.toString()):Oa(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),yu(r,e.default,t.default)}ja.register(Ra,{error:[{kind:"error"},[vn],function(e,t){throw new wa(t[0].evaluate(e))}],typeof:[vn,[fn],function(e,t){return ui(sa(t[0].evaluate(e)))}],"to-rgba":[Li(gr,4),[sn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[sn,[gr,gr,gr],cl],rgba:[sn,[gr,gr,gr,gr],cl],has:{type:an,overloads:[[[vn],function(e,t){return $l(t[0].evaluate(e),e.properties())}],[[vn,Ei],function(e,t){var r=t[1];return $l(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:fn,overloads:[[[vn],function(e,t){return Ts(t[0].evaluate(e),e.properties())}],[[vn,Ei],function(e,t){var r=t[1];return Ts(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[fn,[vn],function(e,t){return Ts(t[0].evaluate(e),e.featureState||{})}],properties:[Ei,[],function(e){return e.properties()}],"geometry-type":[vn,[],function(e){return e.geometryType()}],id:[fn,[],function(e){return e.id()}],zoom:[gr,[],function(e){return e.globals.zoom}],"heatmap-density":[gr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[gr,[],function(e){return e.globals.lineProgress||0}],accumulated:[fn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[gr,Zs(gr),function(e,t){for(var r=0,l=0,p=t;l<p.length;l+=1)r+=p[l].evaluate(e);return r}],"*":[gr,Zs(gr),function(e,t){for(var r=1,l=0,p=t;l<p.length;l+=1)r*=p[l].evaluate(e);return r}],"-":{type:gr,overloads:[[[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[gr],function(e,t){return-t[0].evaluate(e)}]]},"/":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[gr,[],function(){return Math.LN2}],pi:[gr,[],function(){return Math.PI}],e:[gr,[],function(){return Math.E}],"^":[gr,[gr,gr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[gr,[gr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[gr,[gr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[gr,[gr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[gr,[gr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[gr,[gr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[gr,[gr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[gr,[gr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[gr,Zs(gr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[gr,Zs(gr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[gr,[gr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[gr,[gr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[gr,[gr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[gr,[gr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[an,[vn,fn],function(e,t){var r=t[0],l=t[1];return e.properties()[r.value]===l.value}],"filter-id-==":[an,[fn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[an,[vn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[an,[vn,fn],function(e,t){var r=t[0],l=t[1],p=e.properties()[r.value],b=l.value;return typeof p==typeof b&&p<b}],"filter-id-<":[an,[fn],function(e,t){var r=t[0],l=e.id(),p=r.value;return typeof l==typeof p&&l<p}],"filter->":[an,[vn,fn],function(e,t){var r=t[0],l=t[1],p=e.properties()[r.value],b=l.value;return typeof p==typeof b&&p>b}],"filter-id->":[an,[fn],function(e,t){var r=t[0],l=e.id(),p=r.value;return typeof l==typeof p&&l>p}],"filter-<=":[an,[vn,fn],function(e,t){var r=t[0],l=t[1],p=e.properties()[r.value],b=l.value;return typeof p==typeof b&&p<=b}],"filter-id-<=":[an,[fn],function(e,t){var r=t[0],l=e.id(),p=r.value;return typeof l==typeof p&&l<=p}],"filter->=":[an,[vn,fn],function(e,t){var r=t[0],l=t[1],p=e.properties()[r.value],b=l.value;return typeof p==typeof b&&p>=b}],"filter-id->=":[an,[fn],function(e,t){var r=t[0],l=e.id(),p=r.value;return typeof l==typeof p&&l>=p}],"filter-has":[an,[fn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[an,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[an,[Li(vn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[an,[Li(fn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[an,[vn,Li(fn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[an,[vn,Li(fn)],function(e,t){var r=t[0],l=t[1];return function(p,b,N,$){for(;N<=$;){var ce=N+$>>1;if(b[ce]===p)return!0;b[ce]>p?$=ce-1:N=ce+1}return!1}(e.properties()[r.value],l.value,0,l.value.length-1)}],all:{type:an,overloads:[[[an,an],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Zs(an),function(e,t){for(var r=0,l=t;r<l.length;r+=1)if(!l[r].evaluate(e))return!1;return!0}]]},any:{type:an,overloads:[[[an,an],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Zs(an),function(e,t){for(var r=0,l=t;r<l.length;r+=1)if(l[r].evaluate(e))return!0;return!1}]]},"!":[an,[an],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[an,[vn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vn,Zs(fn),function(e,t){return t.map(function(r){return to(r.evaluate(e))}).join("")}],"resolved-locale":[vn,[ni],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var qs=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new fa,this._defaultValue=t?function(r){return r.type==="color"&&Hu(r.default)?new Ii(0,0,0,0):r.type==="color"?Ii.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function eu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Ra}function Iu(e,t){var r=new Ue(Ra,[],t?function(p){var b={color:sn,string:vn,number:gr,enum:vn,boolean:an,formatted:Ui,resolvedImage:mi};return p.type==="array"?Li(b[p.value]||fn,p.length):b[p.type]}(t):void 0),l=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Gu(new qs(l,t)):ms(r.errors)}qs.prototype.evaluateWithoutErrorHandling=function(e,t,r,l,p,b){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},qs.prototype.evaluate=function(e,t,r,l,p,b){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=b||null;try{var N=this.expression.evaluate(this._evaluator);if(N==null||typeof N=="number"&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new wa("Expected value to be one of "+Object.keys(this._enumValues).map(function($){return JSON.stringify($)}).join(", ")+", but found "+JSON.stringify(N)+" instead.");return N}catch($){return this._warningHistory[$.message]||(this._warningHistory[$.message]=!0,typeof console!="undefined"&&console.warn($.message)),this._defaultValue}};var tu=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!kr(t.expression)};tu.prototype.evaluateWithoutErrorHandling=function(e,t,r,l,p,b){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,l,p,b)},tu.prototype.evaluate=function(e,t,r,l,p,b){return this._styleExpression.evaluate(e,t,r,l,p,b)};var Is=function(e,t,r,l){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!kr(t.expression),this.interpolationType=l};function fl(e,t){if((e=Iu(e,t)).result==="error")return e;var r=e.value.expression,l=ar(r);if(!l&&!Ws(t))return ms([new Or("","data expressions not supported")]);var p=we(r,["zoom"]);if(!p&&!Ou(t))return ms([new Or("","zoom expressions not supported")]);var b=function N($){var ce=null;if($ instanceof Gt)ce=N($.result);else if($ instanceof Kt)for(var _e=0,Ce=$.args;_e<Ce.length&&!(ce=N(Ce[_e]));_e+=1);else($ instanceof Xt||$ instanceof et)&&$.input instanceof ja&&$.input.name==="zoom"&&(ce=$);return ce instanceof Or||$.eachChild(function(Pe){var Be=N(Pe);Be instanceof Or?ce=Be:!ce&&Be?ce=new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):ce&&Be&&ce!==Be&&(ce=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),ce}(r);return b||p?b instanceof Or?ms([b]):b instanceof et&&!Ys(t)?ms([new Or("",'"interpolate" expressions cannot be used with this property')]):Gu(b?new Is(l?"camera":"composite",e.value,b.labels,b instanceof et?b.interpolation:void 0):new tu(l?"constant":"source",e.value)):ms([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Is.prototype.evaluateWithoutErrorHandling=function(e,t,r,l,p,b){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,l,p,b)},Is.prototype.evaluate=function(e,t,r,l,p,b){return this._styleExpression.evaluate(e,t,r,l,p,b)},Is.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?et.interpolationFactor(this.interpolationType,e,t,r):0};var ru=function(e,t){this._parameters=e,this._specification=t,Lr(this,function r(l,p){var b,N,$,ce=p.type==="color",_e=l.stops&&typeof l.stops[0][0]=="object",Ce=_e||!(_e||l.property!==void 0),Pe=l.type||(Ys(p)?"exponential":"interval");if(ce&&((l=Lr({},l)).stops&&(l.stops=l.stops.map(function(In){return[In[0],Ii.parse(In[1])]})),l.default=Ii.parse(l.default?l.default:p.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Fe[l.colorSpace])throw new Error("Unknown color space: "+l.colorSpace);if(Pe==="exponential")b=Ql;else if(Pe==="interval")b=vc;else if(Pe==="categorical"){b=Jl,N=Object.create(null);for(var Be=0,He=l.stops;Be<He.length;Be+=1){var mt=He[Be];N[mt[0]]=mt[1]}$=typeof l.stops[0][0]}else{if(Pe!=="identity")throw new Error('Unknown function type "'+Pe+'"');b=Zu}if(_e){for(var bt={},kt=[],Tt=0;Tt<l.stops.length;Tt++){var Ht=l.stops[Tt],rr=Ht[0].zoom;bt[rr]===void 0&&(bt[rr]={zoom:rr,type:l.type,property:l.property,default:l.default,stops:[]},kt.push(rr)),bt[rr].stops.push([Ht[0].value,Ht[1]])}for(var _r=[],xr=0,Rr=kt;xr<Rr.length;xr+=1){var tn=Rr[xr];_r.push([bt[tn].zoom,r(bt[tn],p)])}var mn={name:"linear"};return{kind:"composite",interpolationType:mn,interpolationFactor:et.interpolationFactor.bind(void 0,mn),zoomStops:_r.map(function(In){return In[0]}),evaluate:function(In,ai){var Fn=In.zoom;return Ql({stops:_r,base:l.base},p,Fn).evaluate(Fn,ai)}}}if(Ce){var qn=Pe==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:qn,interpolationFactor:et.interpolationFactor.bind(void 0,qn),zoomStops:l.stops.map(function(In){return In[0]}),evaluate:function(In){return b(l,p,In.zoom,N,$)}}}return{kind:"source",evaluate:function(In,ai){var Fn=ai&&ai.properties?ai.properties[l.property]:void 0;return Fn===void 0?yu(l.default,p.default):b(l,p,Fn,N,$)}}}(this._parameters,this._specification))};function gs(e){var t=e.key,r=e.value,l=e.valueSpec||{},p=e.objectElementValidators||{},b=e.style,N=e.styleSpec,$=[],ce=Oa(r);if(ce!=="object")return[new Et(t,r,"object expected, "+ce+" found")];for(var _e in r){var Ce=_e.split(".")[0],Pe=l[Ce]||l["*"],Be=void 0;if(p[Ce])Be=p[Ce];else if(l[Ce])Be=Ji;else if(p["*"])Be=p["*"];else{if(!l["*"]){$.push(new Et(t,r[_e],'unknown property "'+_e+'"'));continue}Be=Ji}$=$.concat(Be({key:(t&&t+".")+_e,value:r[_e],valueSpec:Pe,style:b,styleSpec:N,object:r,objectKey:_e},r))}for(var He in l)p[He]||l[He].required&&l[He].default===void 0&&r[He]===void 0&&$.push(new Et(t,r,'missing required property "'+He+'"'));return $}function hl(e){var t=e.value,r=e.valueSpec,l=e.style,p=e.styleSpec,b=e.key,N=e.arrayElementValidator||Ji;if(Oa(t)!=="array")return[new Et(b,t,"array expected, "+Oa(t)+" found")];if(r.length&&t.length!==r.length)return[new Et(b,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Et(b,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var $={type:r.value,values:r.values};p.$version<7&&($.function=r.function),Oa(r.value)==="object"&&($=r.value);for(var ce=[],_e=0;_e<t.length;_e++)ce=ce.concat(N({array:t,arrayIndex:_e,value:t[_e],valueSpec:$,style:l,styleSpec:p,key:b+"["+_e+"]"}));return ce}function kl(e){var t=e.key,r=e.value,l=e.valueSpec,p=Oa(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Et(t,r,"number expected, "+p+" found")]:"minimum"in l&&r<l.minimum?[new Et(t,r,r+" is less than the minimum value "+l.minimum)]:"maximum"in l&&r>l.maximum?[new Et(t,r,r+" is greater than the maximum value "+l.maximum)]:[]}function dl(e){var t,r,l,p=e.valueSpec,b=ir(e.value.type),N={},$=b!=="categorical"&&e.value.property===void 0,ce=!$,_e=Oa(e.value.stops)==="array"&&Oa(e.value.stops[0])==="array"&&Oa(e.value.stops[0][0])==="object",Ce=gs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(He){if(b==="identity")return[new Et(He.key,He.value,'identity function may not have a "stops" property')];var mt=[],bt=He.value;return mt=mt.concat(hl({key:He.key,value:bt,valueSpec:He.valueSpec,style:He.style,styleSpec:He.styleSpec,arrayElementValidator:Pe})),Oa(bt)==="array"&&bt.length===0&&mt.push(new Et(He.key,bt,"array must have at least one stop")),mt},default:function(He){return Ji({key:He.key,value:He.value,valueSpec:p,style:He.style,styleSpec:He.styleSpec})}}});return b==="identity"&&$&&Ce.push(new Et(e.key,e.value,'missing required property "property"')),b==="identity"||e.value.stops||Ce.push(new Et(e.key,e.value,'missing required property "stops"')),b==="exponential"&&e.valueSpec.expression&&!Ys(e.valueSpec)&&Ce.push(new Et(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(ce&&!Ws(e.valueSpec)?Ce.push(new Et(e.key,e.value,"property functions not supported")):$&&!Ou(e.valueSpec)&&Ce.push(new Et(e.key,e.value,"zoom functions not supported"))),b!=="categorical"&&!_e||e.value.property!==void 0||Ce.push(new Et(e.key,e.value,'"property" property is required')),Ce;function Pe(He){var mt=[],bt=He.value,kt=He.key;if(Oa(bt)!=="array")return[new Et(kt,bt,"array expected, "+Oa(bt)+" found")];if(bt.length!==2)return[new Et(kt,bt,"array length 2 expected, length "+bt.length+" found")];if(_e){if(Oa(bt[0])!=="object")return[new Et(kt,bt,"object expected, "+Oa(bt[0])+" found")];if(bt[0].zoom===void 0)return[new Et(kt,bt,"object stop key must have zoom")];if(bt[0].value===void 0)return[new Et(kt,bt,"object stop key must have value")];if(l&&l>ir(bt[0].zoom))return[new Et(kt,bt[0].zoom,"stop zoom values must appear in ascending order")];ir(bt[0].zoom)!==l&&(l=ir(bt[0].zoom),r=void 0,N={}),mt=mt.concat(gs({key:kt+"[0]",value:bt[0],valueSpec:{zoom:{}},style:He.style,styleSpec:He.styleSpec,objectElementValidators:{zoom:kl,value:Be}}))}else mt=mt.concat(Be({key:kt+"[0]",value:bt[0],valueSpec:{},style:He.style,styleSpec:He.styleSpec},bt));return eu(ur(bt[1]))?mt.concat([new Et(kt+"[1]",bt[1],"expressions are not allowed in function stops.")]):mt.concat(Ji({key:kt+"[1]",value:bt[1],valueSpec:p,style:He.style,styleSpec:He.styleSpec}))}function Be(He,mt){var bt=Oa(He.value),kt=ir(He.value),Tt=He.value!==null?He.value:mt;if(t){if(bt!==t)return[new Et(He.key,Tt,bt+" stop domain type must match previous stop domain type "+t)]}else t=bt;if(bt!=="number"&&bt!=="string"&&bt!=="boolean")return[new Et(He.key,Tt,"stop domain value must be a number, string, or boolean")];if(bt!=="number"&&b!=="categorical"){var Ht="number expected, "+bt+" found";return Ws(p)&&b===void 0&&(Ht+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(He.key,Tt,Ht)]}return b!=="categorical"||bt!=="number"||isFinite(kt)&&Math.floor(kt)===kt?b!=="categorical"&&bt==="number"&&r!==void 0&&kt<r?[new Et(He.key,Tt,"stop domain values must appear in ascending order")]:(r=kt,b==="categorical"&&kt in N?[new Et(He.key,Tt,"stop domain values must be unique")]:(N[kt]=!0,[])):[new Et(He.key,Tt,"integer expected, found "+kt)]}}function nu(e){var t=(e.expressionContext==="property"?fl:Iu)(ur(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(l){return new Et(""+e.key+l.key,e.value,l.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Et(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!kr(r))return[new Et(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!kr(r))return[new Et(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!we(r,["zoom","feature-state"]))return[new Et(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ar(r))return[new Et(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ru(e){var t=e.key,r=e.value,l=e.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(ir(r))===-1&&p.push(new Et(t,r,"expected one of ["+l.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(l.values).indexOf(ir(r))===-1&&p.push(new Et(t,r,"expected one of ["+Object.keys(l.values).join(", ")+"], "+JSON.stringify(r)+" found")),p}function Wu(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var l=r[t];if(!Wu(l)&&typeof l!="boolean")return!1}return!0;default:return!0}}ru.deserialize=function(e){return new ru(e._parameters,e._specification)},ru.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Yu(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Wu(e)||(e=Xs(e));var t=Iu(e,pl);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,l,p){return t.value.evaluate(r,l,{},p)},needGeometry:function r(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(var p=1;p<l.length;p++)if(r(l[p]))return!0;return!1}(e)}}function ql(e,t){return e<t?-1:e>t?1:0}function Xs(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Xu(e[1],e[2],"=="):r==="!="?$u(Xu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Xu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Xs))):r==="all"?["all"].concat(e.slice(1).map(Xs)):r==="none"?["all"].concat(e.slice(1).map(Xs).map($u)):r==="in"?Ku(e[1],e.slice(2)):r==="!in"?$u(Ku(e[1],e.slice(2))):r==="has"?_u(e[1]):r==="!has"?$u(_u(e[1])):r!=="within"||e}function Xu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Ku(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(ql)]]:["filter-in-small",e,["literal",t]]}}function _u(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function $u(e){return["!",e]}function iu(e){return Wu(ur(e.value))?nu(Lr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var l=r.value,p=r.key;if(Oa(l)!=="array")return[new Et(p,l,"array expected, "+Oa(l)+" found")];var b,N=r.styleSpec,$=[];if(l.length<1)return[new Et(p,l,"filter array must have at least 1 element")];switch($=$.concat(Ru({key:p+"[0]",value:l[0],valueSpec:N.filter_operator,style:r.style,styleSpec:r.styleSpec})),ir(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&ir(l[1])==="$type"&&$.push(new Et(p,l,'"$type" cannot be use with operator "'+l[0]+'"'));case"==":case"!=":l.length!==3&&$.push(new Et(p,l,'filter array for operator "'+l[0]+'" must have 3 elements'));case"in":case"!in":l.length>=2&&(b=Oa(l[1]))!=="string"&&$.push(new Et(p+"[1]",l[1],"string expected, "+b+" found"));for(var ce=2;ce<l.length;ce++)b=Oa(l[ce]),ir(l[1])==="$type"?$=$.concat(Ru({key:p+"["+ce+"]",value:l[ce],valueSpec:N.geometry_type,style:r.style,styleSpec:r.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&$.push(new Et(p+"["+ce+"]",l[ce],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var _e=1;_e<l.length;_e++)$=$.concat(t({key:p+"["+_e+"]",value:l[_e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":b=Oa(l[1]),l.length!==2?$.push(new Et(p,l,'filter array for "'+l[0]+'" operator must have 2 elements')):b!=="string"&&$.push(new Et(p+"[1]",l[1],"string expected, "+b+" found"));break;case"within":b=Oa(l[1]),l.length!==2?$.push(new Et(p,l,'filter array for "'+l[0]+'" operator must have 2 elements')):b!=="object"&&$.push(new Et(p+"[1]",l[1],"object expected, "+b+" found"))}return $}(e)}function vl(e,t){var r=e.key,l=e.style,p=e.styleSpec,b=e.value,N=e.objectKey,$=p[t+"_"+e.layerType];if(!$)return[];var ce=N.match(/^(.*)-transition$/);if(t==="paint"&&ce&&$[ce[1]]&&$[ce[1]].transition)return Ji({key:r,value:b,valueSpec:p.transition,style:l,styleSpec:p});var _e,Ce=e.valueSpec||$[N];if(!Ce)return[new Et(r,b,'unknown property "'+N+'"')];if(Oa(b)==="string"&&Ws(Ce)&&!Ce.tokens&&(_e=/^{([^}]+)}$/.exec(b)))return[new Et(r,b,'"'+N+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(_e[1])+" }`.")];var Pe=[];return e.layerType==="symbol"&&(N==="text-field"&&l&&!l.glyphs&&Pe.push(new Et(r,b,'use of "text-field" requires a style "glyphs" property')),N==="text-font"&&Hu(ur(b))&&ir(b.type)==="identity"&&Pe.push(new Et(r,b,'"text-font" does not support identity functions'))),Pe.concat(Ji({key:e.key,value:b,valueSpec:Ce,style:l,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:N}))}function Ju(e){return vl(e,"paint")}function Lu(e){return vl(e,"layout")}function ec(e){var t=[],r=e.value,l=e.key,p=e.style,b=e.styleSpec;r.type||r.ref||t.push(new Et(l,r,'either "type" or "ref" is required'));var N,$=ir(r.type),ce=ir(r.ref);if(r.id)for(var _e=ir(r.id),Ce=0;Ce<e.arrayIndex;Ce++){var Pe=p.layers[Ce];ir(Pe.id)===_e&&t.push(new Et(l,r.id,'duplicate layer id "'+r.id+'", previously used at line '+Pe.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(mt){mt in r&&t.push(new Et(l,r[mt],'"'+mt+'" is prohibited for ref layers'))}),p.layers.forEach(function(mt){ir(mt.id)===ce&&(N=mt)}),N?N.ref?t.push(new Et(l,r.ref,"ref cannot reference another ref layer")):$=ir(N.type):t.push(new Et(l,r.ref,'ref layer "'+ce+'" not found'));else if($!=="background")if(r.source){var Be=p.sources&&p.sources[r.source],He=Be&&ir(Be.type);Be?He==="vector"&&$==="raster"?t.push(new Et(l,r.source,'layer "'+r.id+'" requires a raster source')):He==="raster"&&$!=="raster"?t.push(new Et(l,r.source,'layer "'+r.id+'" requires a vector source')):He!=="vector"||r["source-layer"]?He==="raster-dem"&&$!=="hillshade"?t.push(new Et(l,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):$!=="line"||!r.paint||!r.paint["line-gradient"]||He==="geojson"&&Be.lineMetrics||t.push(new Et(l,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Et(l,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Et(l,r.source,'source "'+r.source+'" not found'))}else t.push(new Et(l,r,'missing required property "source"'));return t=t.concat(gs({key:l,value:r,valueSpec:b.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ji({key:l+".type",value:r.type,valueSpec:b.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:iu,layout:function(mt){return gs({layer:r,key:mt.key,value:mt.value,style:mt.style,styleSpec:mt.styleSpec,objectElementValidators:{"*":function(bt){return Lu(Lr({layerType:$},bt))}}})},paint:function(mt){return gs({layer:r,key:mt.key,value:mt.value,style:mt.style,styleSpec:mt.styleSpec,objectElementValidators:{"*":function(bt){return Ju(Lr({layerType:$},bt))}}})}}}))}function xu(e){var t=e.value,r=e.key,l=Oa(t);return l!=="string"?[new Et(r,t,"string expected, "+l+" found")]:[]}var Aa={promoteId:function(e){var t=e.key,r=e.value;if(Oa(r)==="string")return xu({key:t,value:r});var l=[];for(var p in r)l.push.apply(l,xu({key:t+"."+p,value:r[p]}));return l}};function au(e){var t=e.value,r=e.key,l=e.styleSpec,p=e.style;if(!t.type)return[new Et(r,t,'"type" is required')];var b,N=ir(t.type);switch(N){case"vector":case"raster":case"raster-dem":return gs({key:r,value:t,valueSpec:l["source_"+N.replace("-","_")],style:e.style,styleSpec:l,objectElementValidators:Aa});case"geojson":if(b=gs({key:r,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,objectElementValidators:Aa}),t.cluster)for(var $ in t.clusterProperties){var ce=t.clusterProperties[$],_e=ce[0],Ce=typeof _e=="string"?[_e,["accumulated"],["get",$]]:_e;b.push.apply(b,nu({key:r+"."+$+".map",value:ce[1],expressionContext:"cluster-map"})),b.push.apply(b,nu({key:r+"."+$+".reduce",value:Ce,expressionContext:"cluster-reduce"}))}return b;case"video":return gs({key:r,value:t,valueSpec:l.source_video,style:p,styleSpec:l});case"image":return gs({key:r,value:t,valueSpec:l.source_image,style:p,styleSpec:l});case"canvas":return[new Et(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ru({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:l})}}function ys(e){var t=e.value,r=e.styleSpec,l=r.light,p=e.style,b=[],N=Oa(t);if(t===void 0)return b;if(N!=="object")return b.concat([new Et("light",t,"object expected, "+N+" found")]);for(var $ in t){var ce=$.match(/^(.*)-transition$/);b=b.concat(ce&&l[ce[1]]&&l[ce[1]].transition?Ji({key:$,value:t[$],valueSpec:r.transition,style:p,styleSpec:r}):l[$]?Ji({key:$,value:t[$],valueSpec:l[$],style:p,styleSpec:r}):[new Et($,t[$],'unknown property "'+$+'"')])}return b}var _s={"*":function(){return[]},array:hl,boolean:function(e){var t=e.value,r=e.key,l=Oa(t);return l!=="boolean"?[new Et(r,t,"boolean expected, "+l+" found")]:[]},number:kl,color:function(e){var t=e.key,r=e.value,l=Oa(r);return l!=="string"?[new Et(t,r,"color expected, "+l+" found")]:hi(r)===null?[new Et(t,r,'color expected, "'+r+'" found')]:[]},constants:Zt,enum:Ru,filter:iu,function:dl,layer:ec,object:gs,source:au,light:ys,string:xu,formatted:function(e){return xu(e).length===0?[]:nu(e)},resolvedImage:function(e){return xu(e).length===0?[]:nu(e)}};function Ji(e){var t=e.value,r=e.valueSpec,l=e.styleSpec;return r.expression&&Hu(ir(t))?dl(e):r.expression&&eu(ur(t))?nu(e):r.type&&_s[r.type]?_s[r.type](e):gs(Lr({},e,{valueSpec:r.type?l[r.type]:r}))}function Ia(e){var t=e.value,r=e.key,l=xu(e);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Et(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Et(r,t,'"glyphs" url must include a "{range}" token'))),l}function qo(e,t){t===void 0&&(t=Ye);var r=[];return r=r.concat(Ji({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ia,"*":function(){return[]}}})),e.constants&&(r=r.concat(Zt({key:"constants",value:e.constants,style:e,styleSpec:t}))),ou(r)}function ou(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Du(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return ou(e.apply(this,t))}}qo.source=Du(au),qo.light=Du(ys),qo.layer=Du(ec),qo.filter=Du(iu),qo.paintProperty=Du(Ju),qo.layoutProperty=Du(Lu);var bu=qo,mc=bu.light,tc=bu.paintProperty,Qu=bu.layoutProperty;function ml(e,t){var r=!1;if(t&&t.length)for(var l=0,p=t;l<p.length;l+=1)e.fire(new Rt(new Error(p[l].message))),r=!0;return r}var Fs=fo;function fo(e,t,r){var l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(t=p[1])+2*(r=p[2]);for(var b=0;b<this.d*this.d;b++){var N=p[3+b],$=p[3+b+1];l.push(N===$?null:p.subarray(N,$))}var ce=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],ce),this.bboxes=p.subarray(ce),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var _e=0;_e<this.d*this.d;_e++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var Ce=r/t*e;this.min=-Ce,this.max=e+Ce}fo.prototype.insert=function(e,t,r,l,p){this._forEachCell(t,r,l,p,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(p)},fo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fo.prototype._insertCell=function(e,t,r,l,p,b){this.cells[p].push(b)},fo.prototype.query=function(e,t,r,l,p){var b=this.min,N=this.max;if(e<=b&&t<=b&&N<=r&&N<=l&&!p)return Array.prototype.slice.call(this.keys);var $=[];return this._forEachCell(e,t,r,l,this._queryCell,$,{},p),$},fo.prototype._queryCell=function(e,t,r,l,p,b,N,$){var ce=this.cells[p];if(ce!==null)for(var _e=this.keys,Ce=this.bboxes,Pe=0;Pe<ce.length;Pe++){var Be=ce[Pe];if(N[Be]===void 0){var He=4*Be;($?$(Ce[He+0],Ce[He+1],Ce[He+2],Ce[He+3]):e<=Ce[He+2]&&t<=Ce[He+3]&&r>=Ce[He+0]&&l>=Ce[He+1])?(N[Be]=!0,b.push(_e[Be])):N[Be]=!1}}},fo.prototype._forEachCell=function(e,t,r,l,p,b,N,$){for(var ce=this._convertToCellCoord(e),_e=this._convertToCellCoord(t),Ce=this._convertToCellCoord(r),Pe=this._convertToCellCoord(l),Be=ce;Be<=Ce;Be++)for(var He=_e;He<=Pe;He++){var mt=this.d*He+Be;if((!$||$(this._convertFromCellCoord(Be),this._convertFromCellCoord(He),this._convertFromCellCoord(Be+1),this._convertFromCellCoord(He+1)))&&p.call(this,e,t,r,l,mt,b,N,$))return}},fo.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},fo.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},fo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,l=0;l<this.cells.length;l++)r+=this.cells[l].length;var p=new Int32Array(t+r+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var b=t,N=0;N<e.length;N++){var $=e[N];p[3+N]=b,p.set($,b),b+=$.length}return p[3+e.length]=b,p.set(this.keys,b),p[3+e.length+1]=b+=this.keys.length,p.set(this.bboxes,b),b+=this.bboxes.length,p.buffer};var su=E.ImageData,Fl=E.ImageBitmap,Ka={};function Sn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Ka[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Io in Sn("Object",Object),Fs.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Fs.deserialize=function(e){return new Fs(e.buffer)},Sn("Grid",Fs),Sn("Color",Ii),Sn("Error",Error),Sn("ResolvedImage",ma),Sn("StylePropertyFunction",ru),Sn("StyleExpression",qs,{omit:["_evaluator"]}),Sn("ZoomDependentExpression",Is),Sn("ZoomConstantExpression",tu),Sn("CompoundExpression",ja,{omit:["_evaluate"]}),Ra)Ra[Io]._classRegistryKey||Sn("Expression_"+Io,Ra[Io]);function uu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function cs(e){return Fl&&e instanceof Fl}function xs(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(uu(e)||cs(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof su)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var l=[],p=0,b=e;p<b.length;p+=1)l.push(xs(b[p],t));return l}if(typeof e=="object"){var N=e.constructor,$=N._classRegistryKey;if(!$)throw new Error("can't serialize object of unregistered class");var ce=N.serialize?N.serialize(e,t):{};if(!N.serialize){for(var _e in e)if(e.hasOwnProperty(_e)&&!(Ka[$].omit.indexOf(_e)>=0)){var Ce=e[_e];ce[_e]=Ka[$].shallow.indexOf(_e)>=0?Ce:xs(Ce,t)}e instanceof Error&&(ce.message=e.message)}if(ce.$name)throw new Error("$name property is reserved for worker serialization logic.");return $!=="Object"&&(ce.$name=$),ce}throw new Error("can't serialize object of type "+typeof e)}function jo(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||uu(e)||cs(e)||ArrayBuffer.isView(e)||e instanceof su)return e;if(Array.isArray(e))return e.map(jo);if(typeof e=="object"){var t=e.$name||"Object",r=Ka[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var l=Object.create(r.prototype),p=0,b=Object.keys(e);p<b.length;p+=1){var N=b[p];if(N!=="$name"){var $=e[N];l[N]=Ka[t].shallow.indexOf(N)>=0?$:jo($)}}return l}throw new Error("can't deserialize object of type "+typeof e)}var qu=function(){this.first=!0};qu.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var pn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Nl(e){for(var t=0,r=e;t<r.length;t+=1)if(Ns(r[t].charCodeAt(0)))return!0;return!1}function Ns(e){return!(e!==746&&e!==747&&(e<4352||!(pn["Bopomofo Extended"](e)||pn.Bopomofo(e)||pn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||pn["CJK Compatibility Ideographs"](e)||pn["CJK Compatibility"](e)||pn["CJK Radicals Supplement"](e)||pn["CJK Strokes"](e)||!(!pn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||pn["CJK Unified Ideographs Extension A"](e)||pn["CJK Unified Ideographs"](e)||pn["Enclosed CJK Letters and Months"](e)||pn["Hangul Compatibility Jamo"](e)||pn["Hangul Jamo Extended-A"](e)||pn["Hangul Jamo Extended-B"](e)||pn["Hangul Jamo"](e)||pn["Hangul Syllables"](e)||pn.Hiragana(e)||pn["Ideographic Description Characters"](e)||pn.Kanbun(e)||pn["Kangxi Radicals"](e)||pn["Katakana Phonetic Extensions"](e)||pn.Katakana(e)&&e!==12540||!(!pn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!pn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||pn["Unified Canadian Aboriginal Syllabics"](e)||pn["Unified Canadian Aboriginal Syllabics Extended"](e)||pn["Vertical Forms"](e)||pn["Yijing Hexagram Symbols"](e)||pn["Yi Syllables"](e)||pn["Yi Radicals"](e))))}function io(e){return!(Ns(e)||function(t){return!!(pn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||pn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||pn["Letterlike Symbols"](t)||pn["Number Forms"](t)||pn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||pn["Control Pictures"](t)&&t!==9251||pn["Optical Character Recognition"](t)||pn["Enclosed Alphanumerics"](t)||pn["Geometric Shapes"](t)||pn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||pn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||pn["CJK Symbols and Punctuation"](t)||pn.Katakana(t)||pn["Private Use Area"](t)||pn["CJK Compatibility Forms"](t)||pn["Small Form Variants"](t)||pn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function fs(e){return e>=1424&&e<=2303||pn["Arabic Presentation Forms-A"](e)||pn["Arabic Presentation Forms-B"](e)}function Uo(e,t){return!(!t&&fs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||pn.Khmer(e))}function Rs(e){for(var t=0,r=e;t<r.length;t+=1)if(fs(r[t].charCodeAt(0)))return!0;return!1}var Su=null,es="unavailable",q=null,Oe=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(es="error"),Su&&Su(e)};function vt(){ht.fire(new ot("pluginStateChange",{pluginStatus:es,pluginURL:q}))}var ht=new Nt,cr=function(){return es},Qt=function(){if(es!=="deferred"||!q)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");es="loading",vt(),q&&Si({url:q},function(e){e?Oe(e):(es="loaded",vt())})},hr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return es==="loaded"||hr.applyArabicShaping!=null},isLoading:function(){return es==="loading"},setState:function(e){es=e.pluginStatus,q=e.pluginURL},isParsed:function(){return hr.applyArabicShaping!=null&&hr.processBidirectionalText!=null&&hr.processStyledBidirectionalText!=null},getPluginURL:function(){return q}},nr=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qu,this.transition={})};nr.prototype.isSupportedScript=function(e){return function(t,r){for(var l=0,p=t;l<p.length;l+=1)if(!Uo(p[l].charCodeAt(0),r))return!1;return!0}(e,hr.isLoaded())},nr.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},nr.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Dr=function(e,t){this.property=e,this.value=t,this.expression=function(r,l){if(Hu(r))return new ru(r,l);if(eu(r)){var p=fl(r,l);if(p.result==="error")throw new Error(p.value.map(function(N){return N.key+": "+N.message}).join(", "));return p.value}var b=r;return typeof r=="string"&&l.type==="color"&&(b=Ii.parse(r)),{kind:"constant",evaluate:function(){return b}}}(t===void 0?e.specification.default:t,e.specification)};Dr.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Dr.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var An=function(e){this.property=e,this.value=new Dr(e,void 0)};An.prototype.transitioned=function(e,t){return new Ln(this.property,this.value,t,I({},e.transition,this.transition),e.now)},An.prototype.untransitioned=function(){return new Ln(this.property,this.value,null,{},0)};var Bn=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Bn.prototype.getValue=function(e){return x(this._values[e].value.value)},Bn.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new An(this._values[e].property)),this._values[e].value=new Dr(this._values[e].property,t===null?void 0:x(t))},Bn.prototype.getTransition=function(e){return x(this._values[e].transition)},Bn.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new An(this._values[e].property)),this._values[e].transition=x(t)||void 0},Bn.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var l=r[t],p=this.getValue(l);p!==void 0&&(e[l]=p);var b=this.getTransition(l);b!==void 0&&(e[l+"-transition"]=b)}return e},Bn.prototype.transitioned=function(e,t){for(var r=new Wn(this._properties),l=0,p=Object.keys(this._values);l<p.length;l+=1){var b=p[l];r._values[b]=this._values[b].transitioned(e,t._values[b])}return r},Bn.prototype.untransitioned=function(){for(var e=new Wn(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var l=r[t];e._values[l]=this._values[l].untransitioned()}return e};var Ln=function(e,t,r,l,p){this.property=e,this.value=t,this.begin=p+l.delay||0,this.end=this.begin+l.duration||0,e.specification.transition&&(l.delay||l.duration)&&(this.prior=r)};Ln.prototype.possiblyEvaluate=function(e,t,r){var l=e.now||0,p=this.value.possiblyEvaluate(e,t,r),b=this.prior;if(b){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return b.possiblyEvaluate(e,t,r);var N=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,t,r),p,function($){if($<=0)return 0;if($>=1)return 1;var ce=$*$,_e=ce*$;return 4*($<.5?_e:3*($-ce)+_e-.75)}(N))}return p};var Wn=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Wn.prototype.possiblyEvaluate=function(e,t,r){for(var l=new Da(this._properties),p=0,b=Object.keys(this._values);p<b.length;p+=1){var N=b[p];l._values[N]=this._values[N].possiblyEvaluate(e,t,r)}return l},Wn.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var ri=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};ri.prototype.getValue=function(e){return x(this._values[e].value)},ri.prototype.setValue=function(e,t){this._values[e]=new Dr(this._values[e].property,t===null?void 0:x(t))},ri.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var l=r[t],p=this.getValue(l);p!==void 0&&(e[l]=p)}return e},ri.prototype.possiblyEvaluate=function(e,t,r){for(var l=new Da(this._properties),p=0,b=Object.keys(this._values);p<b.length;p+=1){var N=b[p];l._values[N]=this._values[N].possiblyEvaluate(e,t,r)}return l};var ta=function(e,t,r){this.property=e,this.value=t,this.parameters=r};ta.prototype.isConstant=function(){return this.value.kind==="constant"},ta.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},ta.prototype.evaluate=function(e,t,r,l){return this.property.evaluate(this.value,this.parameters,e,t,r,l)};var Da=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Da.prototype.get=function(e){return this._values[e]};var gn=function(e){this.specification=e};gn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},gn.prototype.interpolate=function(e,t,r){var l=bn[this.specification.type];return l?l(e,t,r):e};var yn=function(e,t){this.specification=e,this.overrides=t};yn.prototype.possiblyEvaluate=function(e,t,r,l){return new ta(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,l)}:e.expression,t)},yn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ta(this,{kind:"constant",value:void 0},e.parameters);var l=bn[this.specification.type];return l?new ta(this,{kind:"constant",value:l(e.value.value,t.value.value,r)},e.parameters):e},yn.prototype.evaluate=function(e,t,r,l,p,b){return e.kind==="constant"?e.value:e.evaluate(t,r,l,p,b)};var yo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,l,p,b){if(r.value===void 0)return new ta(this,{kind:"constant",value:void 0},l);if(r.expression.kind==="constant"){var N=r.expression.evaluate(l,null,{},p,b),$=r.property.specification.type==="resolvedImage"&&typeof N!="string"?N.name:N,ce=this._calculate($,$,$,l);return new ta(this,{kind:"constant",value:ce},l)}if(r.expression.kind==="camera"){var _e=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new ta(this,{kind:"constant",value:_e},l)}return new ta(this,r.expression,l)},t.prototype.evaluate=function(r,l,p,b,N,$){if(r.kind==="source"){var ce=r.evaluate(l,p,b,N,$);return this._calculate(ce,ce,ce,l)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},p,b),r.evaluate({zoom:Math.floor(l.zoom)},p,b),r.evaluate({zoom:Math.floor(l.zoom)+1},p,b),l):r.value},t.prototype._calculate=function(r,l,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:p,to:l}},t.prototype.interpolate=function(r){return r},t}(yn),ga=function(e){this.specification=e};ga.prototype.possiblyEvaluate=function(e,t,r,l){if(e.value!==void 0){if(e.expression.kind==="constant"){var p=e.expression.evaluate(t,null,{},r,l);return this._calculate(p,p,p,t)}return this._calculate(e.expression.evaluate(new nr(Math.floor(t.zoom-1),t)),e.expression.evaluate(new nr(Math.floor(t.zoom),t)),e.expression.evaluate(new nr(Math.floor(t.zoom+1),t)),t)}},ga.prototype._calculate=function(e,t,r,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ga.prototype.interpolate=function(e){return e};var Na=function(e){this.specification=e};Na.prototype.possiblyEvaluate=function(e,t,r,l){return!!e.expression.evaluate(t,null,{},r,l)},Na.prototype.interpolate=function(){return!1};var xa=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var l=this.defaultPropertyValues[t]=new Dr(r,void 0),p=this.defaultTransitionablePropertyValues[t]=new An(r);this.defaultTransitioningPropertyValues[t]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=l.possiblyEvaluate({})}};Sn("DataDrivenProperty",yn),Sn("DataConstantProperty",gn),Sn("CrossFadedDataDrivenProperty",yo),Sn("CrossFadedProperty",ga),Sn("ColorRampProperty",Na);var ao=function(e){function t(r,l){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new ri(l.layout)),l.paint)){for(var p in this._transitionablePaint=new Bn(l.paint),r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(var b in r.layout)this.setLayoutProperty(b,r.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Da(l.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,l,p){p===void 0&&(p={}),l!=null&&this._validate(Qu,"layers."+this.id+".layout."+r,r,l,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)},t.prototype.getPaintProperty=function(r){return h(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,l,p){if(p===void 0&&(p={}),l!=null&&this._validate(tc,"layers."+this.id+".paint."+r,r,l,p))return!1;if(h(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),l||void 0),!1;var b=this._transitionablePaint._values[r],N=b.property.specification["property-type"]==="cross-faded-data-driven",$=b.value.isDataDriven(),ce=b.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);var _e=this._transitionablePaint._values[r].value;return _e.isDataDriven()||$||N||this._handleOverridablePaintPropertyUpdate(r,ce,_e)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,l,p){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),A(r,function(l,p){return!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length)})},t.prototype._validate=function(r,l,p,b,N){return N===void 0&&(N={}),(!N||N.validate!==!1)&&ml(this,r.call(bu,{key:l,layerType:this.type,objectKey:p,value:b,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var l=this.paint.get(r);if(l instanceof ta&&Ws(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1},t}(Nt),Mi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ho=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ni=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Qi(e,t){t===void 0&&(t=1);var r=0,l=0;return{members:e.map(function(p){var b=Mi[p.type].BYTES_PER_ELEMENT,N=r=Gi(r,Math.max(t,b)),$=p.components||1;return l=Math.max(l,b),r+=b*$,{name:p.name,type:p.type,components:$,offset:N}}),size:Gi(r,Math.max(l,t)),alignment:t}}function Gi(e,t){return Math.ceil(e/t)*t}Ni.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Ni.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Ni.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ni.prototype.clear=function(){this.length=0},Ni.prototype.resize=function(e){this.reserve(e),this.length=e},Ni.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Ni.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ba=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l){var p=this.length;return this.resize(p+1),this.emplace(p,r,l)},t.prototype.emplace=function(r,l,p){var b=2*r;return this.int16[b+0]=l,this.int16[b+1]=p,r},t}(Ni);ba.prototype.bytesPerElement=4,Sn("StructArrayLayout2i4",ba);var ka=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b){var N=this.length;return this.resize(N+1),this.emplace(N,r,l,p,b)},t.prototype.emplace=function(r,l,p,b,N){var $=4*r;return this.int16[$+0]=l,this.int16[$+1]=p,this.int16[$+2]=b,this.int16[$+3]=N,r},t}(Ni);ka.prototype.bytesPerElement=8,Sn("StructArrayLayout4i8",ka);var No=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$){var ce=this.length;return this.resize(ce+1),this.emplace(ce,r,l,p,b,N,$)},t.prototype.emplace=function(r,l,p,b,N,$,ce){var _e=6*r;return this.int16[_e+0]=l,this.int16[_e+1]=p,this.int16[_e+2]=b,this.int16[_e+3]=N,this.int16[_e+4]=$,this.int16[_e+5]=ce,r},t}(Ni);No.prototype.bytesPerElement=12,Sn("StructArrayLayout2i4i12",No);var Ro=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$){var ce=this.length;return this.resize(ce+1),this.emplace(ce,r,l,p,b,N,$)},t.prototype.emplace=function(r,l,p,b,N,$,ce){var _e=4*r,Ce=8*r;return this.int16[_e+0]=l,this.int16[_e+1]=p,this.uint8[Ce+4]=b,this.uint8[Ce+5]=N,this.uint8[Ce+6]=$,this.uint8[Ce+7]=ce,r},t}(Ni);Ro.prototype.bytesPerElement=8,Sn("StructArrayLayout2i4ub8",Ro);var ws=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l){var p=this.length;return this.resize(p+1),this.emplace(p,r,l)},t.prototype.emplace=function(r,l,p){var b=2*r;return this.float32[b+0]=l,this.float32[b+1]=p,r},t}(Ni);ws.prototype.bytesPerElement=8,Sn("StructArrayLayout2f8",ws);var Vo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$,ce,_e,Ce,Pe){var Be=this.length;return this.resize(Be+1),this.emplace(Be,r,l,p,b,N,$,ce,_e,Ce,Pe)},t.prototype.emplace=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be){var He=10*r;return this.uint16[He+0]=l,this.uint16[He+1]=p,this.uint16[He+2]=b,this.uint16[He+3]=N,this.uint16[He+4]=$,this.uint16[He+5]=ce,this.uint16[He+6]=_e,this.uint16[He+7]=Ce,this.uint16[He+8]=Pe,this.uint16[He+9]=Be,r},t}(Ni);Vo.prototype.bytesPerElement=20,Sn("StructArrayLayout10ui20",Vo);var Bs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He){var mt=this.length;return this.resize(mt+1),this.emplace(mt,r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He)},t.prototype.emplace=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt){var bt=12*r;return this.int16[bt+0]=l,this.int16[bt+1]=p,this.int16[bt+2]=b,this.int16[bt+3]=N,this.uint16[bt+4]=$,this.uint16[bt+5]=ce,this.uint16[bt+6]=_e,this.uint16[bt+7]=Ce,this.int16[bt+8]=Pe,this.int16[bt+9]=Be,this.int16[bt+10]=He,this.int16[bt+11]=mt,r},t}(Ni);Bs.prototype.bytesPerElement=24,Sn("StructArrayLayout4i4ui4i24",Bs);var Go=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p){var b=this.length;return this.resize(b+1),this.emplace(b,r,l,p)},t.prototype.emplace=function(r,l,p,b){var N=3*r;return this.float32[N+0]=l,this.float32[N+1]=p,this.float32[N+2]=b,r},t}(Ni);Go.prototype.bytesPerElement=12,Sn("StructArrayLayout3f12",Go);var el=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var l=this.length;return this.resize(l+1),this.emplace(l,r)},t.prototype.emplace=function(r,l){return this.uint32[1*r+0]=l,r},t}(Ni);el.prototype.bytesPerElement=4,Sn("StructArrayLayout1ul4",el);var Bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$,ce,_e,Ce){var Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,r,l,p,b,N,$,ce,_e,Ce)},t.prototype.emplace=function(r,l,p,b,N,$,ce,_e,Ce,Pe){var Be=10*r,He=5*r;return this.int16[Be+0]=l,this.int16[Be+1]=p,this.int16[Be+2]=b,this.int16[Be+3]=N,this.int16[Be+4]=$,this.int16[Be+5]=ce,this.uint32[He+3]=_e,this.uint16[Be+8]=Ce,this.uint16[Be+9]=Pe,r},t}(Ni);Bl.prototype.bytesPerElement=20,Sn("StructArrayLayout6i1ul2ui20",Bl);var ku=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$){var ce=this.length;return this.resize(ce+1),this.emplace(ce,r,l,p,b,N,$)},t.prototype.emplace=function(r,l,p,b,N,$,ce){var _e=6*r;return this.int16[_e+0]=l,this.int16[_e+1]=p,this.int16[_e+2]=b,this.int16[_e+3]=N,this.int16[_e+4]=$,this.int16[_e+5]=ce,r},t}(Ni);ku.prototype.bytesPerElement=12,Sn("StructArrayLayout2i2i2i12",ku);var Eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N){var $=this.length;return this.resize($+1),this.emplace($,r,l,p,b,N)},t.prototype.emplace=function(r,l,p,b,N,$){var ce=4*r,_e=8*r;return this.float32[ce+0]=l,this.float32[ce+1]=p,this.float32[ce+2]=b,this.int16[_e+6]=N,this.int16[_e+7]=$,r},t}(Ni);Eu.prototype.bytesPerElement=16,Sn("StructArrayLayout2f1f2i16",Eu);var zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b){var N=this.length;return this.resize(N+1),this.emplace(N,r,l,p,b)},t.prototype.emplace=function(r,l,p,b,N){var $=12*r,ce=3*r;return this.uint8[$+0]=l,this.uint8[$+1]=p,this.float32[ce+1]=b,this.float32[ce+2]=N,r},t}(Ni);zl.prototype.bytesPerElement=12,Sn("StructArrayLayout2ub2f12",zl);var lu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p){var b=this.length;return this.resize(b+1),this.emplace(b,r,l,p)},t.prototype.emplace=function(r,l,p,b){var N=3*r;return this.uint16[N+0]=l,this.uint16[N+1]=p,this.uint16[N+2]=b,r},t}(Ni);lu.prototype.bytesPerElement=6,Sn("StructArrayLayout3ui6",lu);var Ks=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht){var rr=this.length;return this.resize(rr+1),this.emplace(rr,r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht)},t.prototype.emplace=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht,rr){var _r=24*r,xr=12*r,Rr=48*r;return this.int16[_r+0]=l,this.int16[_r+1]=p,this.uint16[_r+2]=b,this.uint16[_r+3]=N,this.uint32[xr+2]=$,this.uint32[xr+3]=ce,this.uint32[xr+4]=_e,this.uint16[_r+10]=Ce,this.uint16[_r+11]=Pe,this.uint16[_r+12]=Be,this.float32[xr+7]=He,this.float32[xr+8]=mt,this.uint8[Rr+36]=bt,this.uint8[Rr+37]=kt,this.uint8[Rr+38]=Tt,this.uint32[xr+10]=Ht,this.int16[_r+22]=rr,r},t}(Ni);Ks.prototype.bytesPerElement=48,Sn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ks);var tl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht,rr,_r,xr,Rr,tn,mn,qn,In,ai,Fn,Ki){var Ai=this.length;return this.resize(Ai+1),this.emplace(Ai,r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht,rr,_r,xr,Rr,tn,mn,qn,In,ai,Fn,Ki)},t.prototype.emplace=function(r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt,kt,Tt,Ht,rr,_r,xr,Rr,tn,mn,qn,In,ai,Fn,Ki,Ai){var Kn=34*r,na=17*r;return this.int16[Kn+0]=l,this.int16[Kn+1]=p,this.int16[Kn+2]=b,this.int16[Kn+3]=N,this.int16[Kn+4]=$,this.int16[Kn+5]=ce,this.int16[Kn+6]=_e,this.int16[Kn+7]=Ce,this.uint16[Kn+8]=Pe,this.uint16[Kn+9]=Be,this.uint16[Kn+10]=He,this.uint16[Kn+11]=mt,this.uint16[Kn+12]=bt,this.uint16[Kn+13]=kt,this.uint16[Kn+14]=Tt,this.uint16[Kn+15]=Ht,this.uint16[Kn+16]=rr,this.uint16[Kn+17]=_r,this.uint16[Kn+18]=xr,this.uint16[Kn+19]=Rr,this.uint16[Kn+20]=tn,this.uint16[Kn+21]=mn,this.uint16[Kn+22]=qn,this.uint32[na+12]=In,this.float32[na+13]=ai,this.float32[na+14]=Fn,this.float32[na+15]=Ki,this.float32[na+16]=Ai,r},t}(Ni);tl.prototype.bytesPerElement=68,Sn("StructArrayLayout8i15ui1ul4f68",tl);var cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var l=this.length;return this.resize(l+1),this.emplace(l,r)},t.prototype.emplace=function(r,l){return this.float32[1*r+0]=l,r},t}(Ni);cu.prototype.bytesPerElement=4,Sn("StructArrayLayout1f4",cu);var Xn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p){var b=this.length;return this.resize(b+1),this.emplace(b,r,l,p)},t.prototype.emplace=function(r,l,p,b){var N=3*r;return this.int16[N+0]=l,this.int16[N+1]=p,this.int16[N+2]=b,r},t}(Ni);Xn.prototype.bytesPerElement=6,Sn("StructArrayLayout3i6",Xn);var oa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p){var b=this.length;return this.resize(b+1),this.emplace(b,r,l,p)},t.prototype.emplace=function(r,l,p,b){var N=4*r;return this.uint32[2*r+0]=l,this.uint16[N+2]=p,this.uint16[N+3]=b,r},t}(Ni);oa.prototype.bytesPerElement=8,Sn("StructArrayLayout1ul2ui8",oa);var la=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l){var p=this.length;return this.resize(p+1),this.emplace(p,r,l)},t.prototype.emplace=function(r,l,p){var b=2*r;return this.uint16[b+0]=l,this.uint16[b+1]=p,r},t}(Ni);la.prototype.bytesPerElement=4,Sn("StructArrayLayout2ui4",la);var _n=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var l=this.length;return this.resize(l+1),this.emplace(l,r)},t.prototype.emplace=function(r,l){return this.uint16[1*r+0]=l,r},t}(Ni);_n.prototype.bytesPerElement=2,Sn("StructArrayLayout1ui2",_n);var Bo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,l,p,b){var N=this.length;return this.resize(N+1),this.emplace(N,r,l,p,b)},t.prototype.emplace=function(r,l,p,b,N){var $=4*r;return this.float32[$+0]=l,this.float32[$+1]=p,this.float32[$+2]=b,this.float32[$+3]=N,r},t}(Ni);Bo.prototype.bytesPerElement=16,Sn("StructArrayLayout4f16",Bo);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new L(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ho);a.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(Bl);Sn("CollisionBoxArray",u);var s=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(l){this._structArray.uint8[this._pos1+37]=l},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(l){this._structArray.uint8[this._pos1+38]=l},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(l){this._structArray.uint32[this._pos4+10]=l},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ho);s.prototype.size=48;var f=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new s(this,r)},t}(Ks);Sn("PlacedSymbolArray",f);var T=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(l){this._structArray.uint32[this._pos4+12]=l},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ho);T.prototype.size=68;var W=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new T(this,r)},t}(tl);Sn("SymbolInstanceArray",W);var K=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(cu);Sn("GlyphOffsetArray",K);var ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Xn);Sn("SymbolLineVertexArray",ue);var Se=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ho);Se.prototype.size=8;var Ie=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new Se(this,r)},t}(oa);Sn("FeatureIndexArray",Ie);var We=Qi([{name:"a_pos",components:2,type:"Int16"}],4).members,Xe=function(e){e===void 0&&(e=[]),this.segments=e};function Je(e,t){return 256*(e=j(Math.floor(e),0,255))+j(Math.floor(t),0,255)}Xe.prototype.prepareSegment=function(e,t,r,l){var p=this.segments[this.segments.length-1];return e>Xe.MAX_VERTEX_ARRAY_LENGTH&&B("Max vertices per segment is "+Xe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!p||p.vertexLength+e>Xe.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l)&&(p={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},l!==void 0&&(p.sortKey=l),this.segments.push(p)),p},Xe.prototype.get=function(){return this.segments},Xe.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var l in r.vaos)r.vaos[l].destroy()}},Xe.simpleSegment=function(e,t,r,l){return new Xe([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:l,vaos:{},sortKey:0}])},Xe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn("SegmentVector",Xe);var xt=Qi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),_t=w(function(e){e.exports=function(t,r){var l,p,b,N,$,ce,_e,Ce;for(p=t.length-(l=3&t.length),b=r,$=3432918353,ce=461845907,Ce=0;Ce<p;)_e=255&t.charCodeAt(Ce)|(255&t.charCodeAt(++Ce))<<8|(255&t.charCodeAt(++Ce))<<16|(255&t.charCodeAt(++Ce))<<24,++Ce,b=27492+(65535&(N=5*(65535&(b=(b^=_e=(65535&(_e=(_e=(65535&_e)*$+(((_e>>>16)*$&65535)<<16)&4294967295)<<15|_e>>>17))*ce+(((_e>>>16)*ce&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(N>>>16)&65535)<<16);switch(_e=0,l){case 3:_e^=(255&t.charCodeAt(Ce+2))<<16;case 2:_e^=(255&t.charCodeAt(Ce+1))<<8;case 1:b^=_e=(65535&(_e=(_e=(65535&(_e^=255&t.charCodeAt(Ce)))*$+(((_e>>>16)*$&65535)<<16)&4294967295)<<15|_e>>>17))*ce+(((_e>>>16)*ce&65535)<<16)&4294967295}return b^=t.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Pt=w(function(e){e.exports=function(t,r){for(var l,p=t.length,b=r^p,N=0;p>=4;)l=1540483477*(65535&(l=255&t.charCodeAt(N)|(255&t.charCodeAt(++N))<<8|(255&t.charCodeAt(++N))<<16|(255&t.charCodeAt(++N))<<24))+((1540483477*(l>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++N;switch(p){case 3:b^=(255&t.charCodeAt(N+2))<<16;case 2:b^=(255&t.charCodeAt(N+1))<<8;case 1:b=1540483477*(65535&(b^=255&t.charCodeAt(N)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),ft=_t,Ot=Pt;ft.murmur3=_t,ft.murmur2=Ot;var jt=function(){this.ids=[],this.positions=[],this.indexed=!1};jt.prototype.add=function(e,t,r,l){this.ids.push(br(e)),this.positions.push(t,r,l)},jt.prototype.getPositions=function(e){for(var t=br(e),r=0,l=this.ids.length-1;r<l;){var p=r+l>>1;this.ids[p]>=t?l=p:r=p+1}for(var b=[];this.ids[r]===t;)b.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return b},jt.serialize=function(e,t){var r=new Float64Array(e.ids),l=new Uint32Array(e.positions);return function p(b,N,$,ce){for(;$<ce;){for(var _e=b[$+ce>>1],Ce=$-1,Pe=ce+1;;){do Ce++;while(b[Ce]<_e);do Pe--;while(b[Pe]>_e);if(Ce>=Pe)break;yr(b,Ce,Pe),yr(N,3*Ce,3*Pe),yr(N,3*Ce+1,3*Pe+1),yr(N,3*Ce+2,3*Pe+2)}Pe-$<ce-Pe?(p(b,N,$,Pe),$=Pe+1):(p(b,N,Pe+1,ce),ce=Pe)}}(r,l,0,r.length-1),t&&t.push(r.buffer,l.buffer),{ids:r,positions:l}},jt.deserialize=function(e){var t=new jt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var er=Math.pow(2,53)-1;function br(e){var t=+e;return!isNaN(t)&&t<=er?t:ft(String(e))}function yr(e,t,r){var l=e[t];e[t]=e[r],e[r]=l}Sn("FeaturePositionMap",jt);var Cr=function(e,t){this.gl=e.gl,this.location=t},zr=function(e){function t(r,l){e.call(this,r,l),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Cr),un=function(e){function t(r,l){e.call(this,r,l),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Cr),qr=function(e){function t(r,l){e.call(this,r,l),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Cr),Dn=function(e){function t(r,l){e.call(this,r,l),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Cr),$n=function(e){function t(r,l){e.call(this,r,l),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Cr),Jn=function(e){function t(r,l){e.call(this,r,l),this.current=Ii.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Cr),ii=new Float32Array(16),qi=function(e){function t(r,l){e.call(this,r,l),this.current=ii}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var l=1;l<16;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Cr);function zn(e){return[Je(255*e.r,255*e.g),Je(255*e.b,255*e.a)]}var di=function(e,t,r){this.value=e,this.uniformNames=t.map(function(l){return"u_"+l}),this.type=r};di.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},di.prototype.getBinding=function(e,t,r){return this.type==="color"?new Jn(e,t):new un(e,t)};var Bi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Bi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Bi.prototype.setUniform=function(e,t,r,l){var p=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&e.set(p)},Bi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new $n(e,t):new un(e,t)};var bi=function(e,t,r,l){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(p){return{name:"a_"+p,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new l};bi.prototype.populatePaintArray=function(e,t,r,l,p){var b=this.paintVertexArray.length,N=this.expression.evaluate(new nr(0),t,{},l,[],p);this.paintVertexArray.resize(e),this._setPaintValue(b,e,N)},bi.prototype.updatePaintArray=function(e,t,r,l){var p=this.expression.evaluate({zoom:0},r,l);this._setPaintValue(e,t,p)},bi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var l=zn(r),p=e;p<t;p++)this.paintVertexArray.emplace(p,l[0],l[1]);else{for(var b=e;b<t;b++)this.paintVertexArray.emplace(b,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},bi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},bi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var gi=function(e,t,r,l,p,b){this.expression=e,this.uniformNames=t.map(function(N){return"u_"+N+"_t"}),this.type=r,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=t.map(function(N){return{name:"a_"+N,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new b};gi.prototype.populatePaintArray=function(e,t,r,l,p){var b=this.expression.evaluate(new nr(this.zoom),t,{},l,[],p),N=this.expression.evaluate(new nr(this.zoom+1),t,{},l,[],p),$=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue($,e,b,N)},gi.prototype.updatePaintArray=function(e,t,r,l){var p=this.expression.evaluate({zoom:this.zoom},r,l),b=this.expression.evaluate({zoom:this.zoom+1},r,l);this._setPaintValue(e,t,p,b)},gi.prototype._setPaintValue=function(e,t,r,l){if(this.type==="color")for(var p=zn(r),b=zn(l),N=e;N<t;N++)this.paintVertexArray.emplace(N,p[0],p[1],b[0],b[1]);else{for(var $=e;$<t;$++)this.paintVertexArray.emplace($,r,l);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(l))}},gi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},gi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},gi.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,l=j(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(l)},gi.prototype.getBinding=function(e,t,r){return new un(e,t)};var Di=function(e,t,r,l,p,b){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=l,this.layerId=b,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p};Di.prototype.populatePaintArray=function(e,t,r){var l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],r)},Di.prototype.updatePaintArray=function(e,t,r,l,p){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],p)},Di.prototype._setPaintValues=function(e,t,r,l){if(l&&r){var p=l[r.min],b=l[r.mid],N=l[r.max];if(p&&b&&N)for(var $=e;$<t;$++)this.zoomInPaintVertexArray.emplace($,b.tl[0],b.tl[1],b.br[0],b.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],b.pixelRatio,p.pixelRatio),this.zoomOutPaintVertexArray.emplace($,b.tl[0],b.tl[1],b.br[0],b.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],b.pixelRatio,N.pixelRatio)}},Di.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,xt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,xt.members,this.expression.isStateDependent))},Di.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var pi=function(e,t,r){this.binders={},this._buffers=[];var l=[];for(var p in e.paint._values)if(r(p)){var b=e.paint.get(p);if(b instanceof ta&&Ws(b.property.specification)){var N=Co(p,e.type),$=b.value,ce=b.property.specification.type,_e=b.property.useIntegerZoom,Ce=b.property.specification["property-type"],Pe=Ce==="cross-faded"||Ce==="cross-faded-data-driven";if($.kind==="constant")this.binders[p]=Pe?new Bi($.value,N):new di($.value,N,ce),l.push("/u_"+p);else if($.kind==="source"||Pe){var Be=oo(p,ce,"source");this.binders[p]=Pe?new Di($,ce,_e,t,Be,e.id):new bi($,N,ce,Be),l.push("/a_"+p)}else{var He=oo(p,ce,"composite");this.binders[p]=new gi($,N,ce,_e,t,He),l.push("/z_"+p)}}}this.cacheKey=l.sort().join("")};pi.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof bi||t instanceof gi?t.maxValue:0},pi.prototype.populatePaintArrays=function(e,t,r,l,p){for(var b in this.binders){var N=this.binders[b];(N instanceof bi||N instanceof gi||N instanceof Di)&&N.populatePaintArray(e,t,r,l,p)}},pi.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var l=this.binders[r];l instanceof Bi&&l.setConstantPatternPositions(e,t)}},pi.prototype.updatePaintArrays=function(e,t,r,l,p){var b=!1;for(var N in e)for(var $=0,ce=t.getPositions(N);$<ce.length;$+=1){var _e=ce[$],Ce=r.feature(_e.index);for(var Pe in this.binders){var Be=this.binders[Pe];if((Be instanceof bi||Be instanceof gi||Be instanceof Di)&&Be.expression.isStateDependent===!0){var He=l.paint.get(Pe);Be.expression=He.value,Be.updatePaintArray(_e.start,_e.end,Ce,e[N],p),b=!0}}}return b},pi.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof di||r instanceof Bi)&&e.push.apply(e,r.uniformNames.map(function(l){return"#define HAS_UNIFORM_"+l}))}return e},pi.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof bi||r instanceof gi)for(var l=0;l<r.paintVertexAttributes.length;l++)e.push(r.paintVertexAttributes[l].name);else if(r instanceof Di)for(var p=0;p<xt.members.length;p++)e.push(xt.members[p].name)}return e},pi.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof di||r instanceof Bi||r instanceof gi)for(var l=0,p=r.uniformNames;l<p.length;l+=1)e.push(p[l])}return e},pi.prototype.getPaintVertexBuffers=function(){return this._buffers},pi.prototype.getUniforms=function(e,t){var r=[];for(var l in this.binders){var p=this.binders[l];if(p instanceof di||p instanceof Bi||p instanceof gi)for(var b=0,N=p.uniformNames;b<N.length;b+=1){var $=N[b];if(t[$]){var ce=p.getBinding(e,t[$],$);r.push({name:$,property:l,binding:ce})}}}return r},pi.prototype.setUniforms=function(e,t,r,l){for(var p=0,b=t;p<b.length;p+=1){var N=b[p],$=N.name,ce=N.property;this.binders[ce].setUniform(N.binding,l,r.get(ce),$)}},pi.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Di){var l=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(r instanceof bi||r instanceof gi)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},pi.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof bi||r instanceof gi||r instanceof Di)&&r.upload(e)}this.updatePaintBuffers()},pi.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof bi||t instanceof gi||t instanceof Di)&&t.destroy()}};var li=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var l=0,p=e;l<p.length;l+=1){var b=p[l];this.programConfigurations[b.id]=new pi(b,t,r)}this.needsUpload=!1,this._featureMap=new jt,this._bufferOffset=0};function Co(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function oo(e,t,r){var l={color:{source:ws,composite:Bo},number:{source:cu,composite:ws}},p=function(b){return{"line-pattern":{source:Vo,composite:Vo},"fill-pattern":{source:Vo,composite:Vo},"fill-extrusion-pattern":{source:Vo,composite:Vo}}[b]}(e);return p&&p[r]||l[t][r]}li.prototype.populatePaintArrays=function(e,t,r,l,p,b){for(var N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(e,t,l,p,b);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},li.prototype.updatePaintArrays=function(e,t,r,l){for(var p=0,b=r;p<b.length;p+=1){var N=b[p];this.needsUpload=this.programConfigurations[N.id].updatePaintArrays(e,this._featureMap,t,N,l)||this.needsUpload}},li.prototype.get=function(e){return this.programConfigurations[e]},li.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},li.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Sn("ConstantBinder",di),Sn("CrossFadedConstantBinder",Bi),Sn("SourceExpressionBinder",bi),Sn("CrossFadedCompositeBinder",Di),Sn("CompositeExpressionBinder",gi),Sn("ProgramConfiguration",pi,{omit:["_buffers"]}),Sn("ProgramConfigurationSet",li);var Ho=Math.pow(2,14)-1,Lo=-Ho-1;function qa(e){for(var t=8192/e.extent,r=e.loadGeometry(),l=0;l<r.length;l++)for(var p=r[l],b=0;b<p.length;b++){var N=p[b],$=Math.round(N.x*t),ce=Math.round(N.y*t);N.x=j($,Lo,Ho),N.y=j(ce,Lo,Ho),($<N.x||$>N.x+1||ce<N.y||ce>N.y+1)&&B("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function so(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?qa(e):[]}}function hs(e,t,r,l,p){e.emplaceBack(2*t+(l+1)/2,2*r+(p+1)/2)}var ts=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ba,this.indexArray=new lu,this.segments=new Xe,this.programConfigurations=new li(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Cu(e,t){for(var r=0;r<e.length;r++)if(js(t,e[r]))return!0;for(var l=0;l<t.length;l++)if(js(e,t[l]))return!0;return!!gl(e,t)}function ds(e,t,r){return!!js(e,t)||!!fu(t,e,r)}function zs(e,t){if(e.length===1)return yl(t,e[0]);for(var r=0;r<t.length;r++)for(var l=t[r],p=0;p<l.length;p++)if(js(e,l[p]))return!0;for(var b=0;b<e.length;b++)if(yl(t,e[b]))return!0;for(var N=0;N<t.length;N++)if(gl(e,t[N]))return!0;return!1}function As(e,t,r){if(e.length>1){if(gl(e,t))return!0;for(var l=0;l<t.length;l++)if(fu(t[l],e,r))return!0}for(var p=0;p<e.length;p++)if(fu(e[p],t,r))return!0;return!1}function gl(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var l=e[r],p=e[r+1],b=0;b<t.length-1;b++)if(rl(l,p,t[b],t[b+1]))return!0;return!1}function rl(e,t,r,l){return V(e,r,l)!==V(t,r,l)&&V(e,t,r)!==V(e,t,l)}function fu(e,t,r){var l=r*r;if(t.length===1)return e.distSqr(t[0])<l;for(var p=1;p<t.length;p++)if(Fu(e,t[p-1],t[p])<l)return!0;return!1}function Fu(e,t,r){var l=t.distSqr(r);if(l===0)return e.distSqr(t);var p=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/l;return e.distSqr(p<0?t:p>1?r:r.sub(t)._mult(p)._add(t))}function yl(e,t){for(var r,l,p,b=!1,N=0;N<e.length;N++)for(var $=0,ce=(r=e[N]).length-1;$<r.length;ce=$++)(l=r[$]).y>t.y!=(p=r[ce]).y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(b=!b);return b}function js(e,t){for(var r=!1,l=0,p=e.length-1;l<e.length;p=l++){var b=e[l],N=e[p];b.y>t.y!=N.y>t.y&&t.x<(N.x-b.x)*(t.y-b.y)/(N.y-b.y)+b.x&&(r=!r)}return r}function _l(e,t,r){var l=r[0],p=r[2];if(e.x<l.x&&t.x<l.x||e.x>p.x&&t.x>p.x||e.y<l.y&&t.y<l.y||e.y>p.y&&t.y>p.y)return!1;var b=V(e,t,r[0]);return b!==V(e,t,r[1])||b!==V(e,t,r[2])||b!==V(e,t,r[3])}function $s(e,t,r){var l=t.paint.get(e).value;return l.kind==="constant"?l.value:r.programConfigurations.get(t.id).getMaxValue(e)}function _o(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hu(e,t,r,l,p){if(!t[0]&&!t[1])return e;var b=L.convert(t)._mult(p);r==="viewport"&&b._rotate(-l);for(var N=[],$=0;$<e.length;$++)N.push(e[$].sub(b));return N}ts.prototype.populate=function(e,t,r){var l=this.layers[0],p=[],b=null;l.type==="circle"&&(b=l.layout.get("circle-sort-key"));for(var N=0,$=e;N<$.length;N+=1){var ce=$[N],_e=ce.feature,Ce=ce.id,Pe=ce.index,Be=ce.sourceLayerIndex,He=this.layers[0]._featureFilter.needGeometry,mt=so(_e,He);if(this.layers[0]._featureFilter.filter(new nr(this.zoom),mt,r)){var bt=b?b.evaluate(mt,{},r):void 0,kt={id:Ce,properties:_e.properties,type:_e.type,sourceLayerIndex:Be,index:Pe,geometry:He?mt.geometry:qa(_e),patterns:{},sortKey:bt};p.push(kt)}}b&&p.sort(function(mn,qn){return mn.sortKey-qn.sortKey});for(var Tt=0,Ht=p;Tt<Ht.length;Tt+=1){var rr=Ht[Tt],_r=rr.geometry,xr=rr.index,Rr=rr.sourceLayerIndex,tn=e[xr].feature;this.addFeature(rr,_r,xr,r),t.featureIndex.insert(tn,_r,xr,Rr,this.index)}},ts.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ts.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,We),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ts.prototype.addFeature=function(e,t,r,l){for(var p=0,b=t;p<b.length;p+=1)for(var N=0,$=b[p];N<$.length;N+=1){var ce=$[N],_e=ce.x,Ce=ce.y;if(!(_e<0||_e>=8192||Ce<0||Ce>=8192)){var Pe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),Be=Pe.vertexLength;hs(this.layoutVertexArray,_e,Ce,-1,-1),hs(this.layoutVertexArray,_e,Ce,1,-1),hs(this.layoutVertexArray,_e,Ce,1,1),hs(this.layoutVertexArray,_e,Ce,-1,1),this.indexArray.emplaceBack(Be,Be+1,Be+2),this.indexArray.emplaceBack(Be,Be+3,Be+2),Pe.vertexLength+=4,Pe.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},l)},Sn("CircleBucket",ts,{omit:["layers"]});var Tu=new xa({"circle-sort-key":new yn(Ye.layout_circle["circle-sort-key"])}),wu={paint:new xa({"circle-radius":new yn(Ye.paint_circle["circle-radius"]),"circle-color":new yn(Ye.paint_circle["circle-color"]),"circle-blur":new yn(Ye.paint_circle["circle-blur"]),"circle-opacity":new yn(Ye.paint_circle["circle-opacity"]),"circle-translate":new gn(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new gn(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gn(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gn(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Ye.paint_circle["circle-stroke-opacity"])}),layout:Tu},da=typeof Float32Array!="undefined"?Float32Array:Array;function rs(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ps(e,t,r){var l=t[0],p=t[1],b=t[2],N=t[3],$=t[4],ce=t[5],_e=t[6],Ce=t[7],Pe=t[8],Be=t[9],He=t[10],mt=t[11],bt=t[12],kt=t[13],Tt=t[14],Ht=t[15],rr=r[0],_r=r[1],xr=r[2],Rr=r[3];return e[0]=rr*l+_r*$+xr*Pe+Rr*bt,e[1]=rr*p+_r*ce+xr*Be+Rr*kt,e[2]=rr*b+_r*_e+xr*He+Rr*Tt,e[3]=rr*N+_r*Ce+xr*mt+Rr*Ht,e[4]=(rr=r[4])*l+(_r=r[5])*$+(xr=r[6])*Pe+(Rr=r[7])*bt,e[5]=rr*p+_r*ce+xr*Be+Rr*kt,e[6]=rr*b+_r*_e+xr*He+Rr*Tt,e[7]=rr*N+_r*Ce+xr*mt+Rr*Ht,e[8]=(rr=r[8])*l+(_r=r[9])*$+(xr=r[10])*Pe+(Rr=r[11])*bt,e[9]=rr*p+_r*ce+xr*Be+Rr*kt,e[10]=rr*b+_r*_e+xr*He+Rr*Tt,e[11]=rr*N+_r*Ce+xr*mt+Rr*Ht,e[12]=(rr=r[12])*l+(_r=r[13])*$+(xr=r[14])*Pe+(Rr=r[15])*bt,e[13]=rr*p+_r*ce+xr*Be+Rr*kt,e[14]=rr*b+_r*_e+xr*He+Rr*Tt,e[15]=rr*N+_r*Ce+xr*mt+Rr*Ht,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var du,Au=ps;function Nu(e,t,r){var l=t[0],p=t[1],b=t[2],N=t[3];return e[0]=r[0]*l+r[4]*p+r[8]*b+r[12]*N,e[1]=r[1]*l+r[5]*p+r[9]*b+r[13]*N,e[2]=r[2]*l+r[6]*p+r[10]*b+r[14]*N,e[3]=r[3]*l+r[7]*p+r[11]*b+r[15]*N,e}du=new da(3),da!=Float32Array&&(du[0]=0,du[1]=0,du[2]=0),function(){var e=new da(4);da!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var nl=(function(){var e=new da(2);da!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,wu)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new ts(r)},t.prototype.queryRadius=function(r){var l=r;return $s("circle-radius",this,l)+$s("circle-stroke-width",this,l)+_o(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,l,p,b,N,$,ce,_e){for(var Ce=hu(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),$.angle,ce),Pe=this.paint.get("circle-radius").evaluate(l,p)+this.paint.get("circle-stroke-width").evaluate(l,p),Be=this.paint.get("circle-pitch-alignment")==="map",He=Be?Ce:function(tn,mn){return tn.map(function(qn){return Mu(qn,mn)})}(Ce,_e),mt=Be?Pe*ce:Pe,bt=0,kt=b;bt<kt.length;bt+=1)for(var Tt=0,Ht=kt[bt];Tt<Ht.length;Tt+=1){var rr=Ht[Tt],_r=Be?rr:Mu(rr,_e),xr=mt,Rr=Nu([],[rr.x,rr.y,0,1],_e);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xr*=Rr[3]/$.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xr*=$.cameraToCenterDistance/Rr[3]),ds(He,_r,xr))return!0}return!1},t}(ao));function Mu(e,t){var r=Nu([],[e.x,e.y,0,1],t);return new L(r[0]/r[3],r[1]/r[3])}var xl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ts);function Us(e,t,r,l){var p=t.width,b=t.height;if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==p*b*r)throw new RangeError("mismatched image size")}else l=new Uint8Array(p*b*r);return e.width=p,e.height=b,e.data=l,e}function pu(e,t,r){var l=t.width,p=t.height;if(l!==e.width||p!==e.height){var b=Us({},{width:l,height:p},r);il(e,b,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,l),height:Math.min(e.height,p)},r),e.width=l,e.height=p,e.data=b.data}}function il(e,t,r,l,p,b){if(p.width===0||p.height===0)return t;if(p.width>e.width||p.height>e.height||r.x>e.width-p.width||r.y>e.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");for(var N=e.data,$=t.data,ce=0;ce<p.height;ce++)for(var _e=((r.y+ce)*e.width+r.x)*b,Ce=((l.y+ce)*t.width+l.x)*b,Pe=0;Pe<p.width*b;Pe++)$[Ce+Pe]=N[_e+Pe];return t}Sn("HeatmapBucket",xl,{omit:["layers"]});var Bu=function(e,t){Us(this,e,1,t)};Bu.prototype.resize=function(e){pu(this,e,1)},Bu.prototype.clone=function(){return new Bu({width:this.width,height:this.height},new Uint8Array(this.data))},Bu.copy=function(e,t,r,l,p){il(e,t,r,l,p,1)};var ns=function(e,t){Us(this,e,4,t)};ns.prototype.resize=function(e){pu(this,e,4)},ns.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},ns.prototype.clone=function(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))},ns.copy=function(e,t,r,l,p){il(e,t,r,l,p,4)},Sn("AlphaImage",Bu),Sn("RGBAImage",ns);var gc={paint:new xa({"heatmap-radius":new yn(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gn(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Na(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gn(Ye.paint_heatmap["heatmap-opacity"])})};function Pc(e){var t={},r=e.resolution||256,l=e.clips?e.clips.length:1,p=e.image||new ns({width:r,height:l}),b=function(mt,bt,kt){t[e.evaluationKey]=kt;var Tt=e.expression.evaluate(t);p.data[mt+bt+0]=Math.floor(255*Tt.r/Tt.a),p.data[mt+bt+1]=Math.floor(255*Tt.g/Tt.a),p.data[mt+bt+2]=Math.floor(255*Tt.b/Tt.a),p.data[mt+bt+3]=Math.floor(255*Tt.a)};if(e.clips)for(var N=0,$=0;N<l;++N,$+=4*r)for(var ce=0,_e=0;ce<r;ce++,_e+=4){var Ce=ce/(r-1),Pe=e.clips[N];b($,_e,Pe.start*(1-Ce)+Pe.end*Ce)}else for(var Be=0,He=0;Be<r;Be++,He+=4)b(0,He,Be/(r-1));return p}var Jc=function(e){function t(r){e.call(this,r,gc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new xl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Pc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(ao),rc={paint:new xa({"hillshade-illumination-direction":new gn(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gn(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gn(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gn(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gn(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gn(Ye.paint_hillshade["hillshade-accent-color"])})},nc=function(e){function t(r){e.call(this,r,rc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(ao),nh=Qi([{name:"a_pos",components:2,type:"Int16"}],4).members,Qc=yc,wf=yc;function yc(e,t,r){r=r||2;var l,p,b,N,$,ce,_e,Ce=t&&t.length,Pe=Ce?t[0]*r:e.length,Be=qc(e,0,Pe,r,!0),He=[];if(!Be||Be.next===Be.prev)return He;if(Ce&&(Be=function(bt,kt,Tt,Ht){var rr,_r,xr,Rr=[];for(rr=0,_r=kt.length;rr<_r;rr++)(xr=qc(bt,kt[rr]*Ht,rr<_r-1?kt[rr+1]*Ht:bt.length,Ht,!1))===xr.next&&(xr.steiner=!0),Rr.push(lh(xr));for(Rr.sort(oh),rr=0;rr<Rr.length;rr++)sh(Rr[rr],Tt),Tt=bl(Tt,Tt.next);return Tt}(e,t,Be,r)),e.length>80*r){l=b=e[0],p=N=e[1];for(var mt=r;mt<Pe;mt+=r)($=e[mt])<l&&(l=$),(ce=e[mt+1])<p&&(p=ce),$>b&&(b=$),ce>N&&(N=ce);_e=(_e=Math.max(b-l,N-p))!==0?1/_e:0}return zu(Be,He,r,l,p,_e),He}function qc(e,t,r,l,p){var b,N;if(p===sc(e,t,r,l)>0)for(b=t;b<r;b+=l)N=Ic(b,e[b],e[b+1],N);else for(b=r-l;b>=t;b-=l)N=Ic(b,e[b],e[b+1],N);return N&&Oc(N,N.next)&&(El(N),N=N.next),N}function bl(e,t){if(!e)return e;t||(t=e);var r,l=e;do if(r=!1,l.steiner||!Oc(l,l.next)&&To(l.prev,l,l.next)!==0)l=l.next;else{if(El(l),(l=t=l.prev)===l.next)break;r=!0}while(r||l!==t);return t}function zu(e,t,r,l,p,b,N){if(e){!N&&b&&function(Ce,Pe,Be,He){var mt=Ce;do mt.z===null&&(mt.z=tf(mt.x,mt.y,Pe,Be,He)),mt.prevZ=mt.prev,mt.nextZ=mt.next,mt=mt.next;while(mt!==Ce);mt.prevZ.nextZ=null,mt.prevZ=null,function(bt){var kt,Tt,Ht,rr,_r,xr,Rr,tn,mn=1;do{for(Tt=bt,bt=null,_r=null,xr=0;Tt;){for(xr++,Ht=Tt,Rr=0,kt=0;kt<mn&&(Rr++,Ht=Ht.nextZ);kt++);for(tn=mn;Rr>0||tn>0&&Ht;)Rr!==0&&(tn===0||!Ht||Tt.z<=Ht.z)?(rr=Tt,Tt=Tt.nextZ,Rr--):(rr=Ht,Ht=Ht.nextZ,tn--),_r?_r.nextZ=rr:bt=rr,rr.prevZ=_r,_r=rr;Tt=Ht}_r.nextZ=null,mn*=2}while(xr>1)}(mt)}(e,l,p,b);for(var $,ce,_e=e;e.prev!==e.next;)if($=e.prev,ce=e.next,b?ih(e,l,p,b):ef(e))t.push($.i/r),t.push(e.i/r),t.push(ce.i/r),El(e),e=ce.next,_e=ce.next;else if((e=ce)===_e){N?N===1?zu(e=ah(bl(e),t,r),t,r,l,p,b,2):N===2&&Af(e,t,r,l,p,b):zu(bl(e),t,r,l,p,b,1);break}}}function ef(e){var t=e.prev,r=e,l=e.next;if(To(t,r,l)>=0)return!1;for(var p=e.next.next;p!==e.prev;){if(ic(t.x,t.y,r.x,r.y,l.x,l.y,p.x,p.y)&&To(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ih(e,t,r,l){var p=e.prev,b=e,N=e.next;if(To(p,b,N)>=0)return!1;for(var $=p.x>b.x?p.x>N.x?p.x:N.x:b.x>N.x?b.x:N.x,ce=p.y>b.y?p.y>N.y?p.y:N.y:b.y>N.y?b.y:N.y,_e=tf(p.x<b.x?p.x<N.x?p.x:N.x:b.x<N.x?b.x:N.x,p.y<b.y?p.y<N.y?p.y:N.y:b.y<N.y?b.y:N.y,t,r,l),Ce=tf($,ce,t,r,l),Pe=e.prevZ,Be=e.nextZ;Pe&&Pe.z>=_e&&Be&&Be.z<=Ce;){if(Pe!==e.prev&&Pe!==e.next&&ic(p.x,p.y,b.x,b.y,N.x,N.y,Pe.x,Pe.y)&&To(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Be!==e.prev&&Be!==e.next&&ic(p.x,p.y,b.x,b.y,N.x,N.y,Be.x,Be.y)&&To(Be.prev,Be,Be.next)>=0))return!1;Be=Be.nextZ}for(;Pe&&Pe.z>=_e;){if(Pe!==e.prev&&Pe!==e.next&&ic(p.x,p.y,b.x,b.y,N.x,N.y,Pe.x,Pe.y)&&To(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Be&&Be.z<=Ce;){if(Be!==e.prev&&Be!==e.next&&ic(p.x,p.y,b.x,b.y,N.x,N.y,Be.x,Be.y)&&To(Be.prev,Be,Be.next)>=0)return!1;Be=Be.nextZ}return!0}function ah(e,t,r){var l=e;do{var p=l.prev,b=l.next.next;!Oc(p,b)&&Mf(p,l,l.next,b)&&Sl(p,b)&&Sl(b,p)&&(t.push(p.i/r),t.push(l.i/r),t.push(b.i/r),El(l),El(l.next),l=e=b),l=l.next}while(l!==e);return bl(l)}function Af(e,t,r,l,p,b){var N=e;do{for(var $=N.next.next;$!==N.prev;){if(N.i!==$.i&&ch(N,$)){var ce=_c(N,$);return N=bl(N,N.next),ce=bl(ce,ce.next),zu(N,t,r,l,p,b),void zu(ce,t,r,l,p,b)}$=$.next}N=N.next}while(N!==e)}function oh(e,t){return e.x-t.x}function sh(e,t){if(t=function(l,p){var b,N=p,$=l.x,ce=l.y,_e=-1/0;do{if(ce<=N.y&&ce>=N.next.y&&N.next.y!==N.y){var Ce=N.x+(ce-N.y)*(N.next.x-N.x)/(N.next.y-N.y);if(Ce<=$&&Ce>_e){if(_e=Ce,Ce===$){if(ce===N.y)return N;if(ce===N.next.y)return N.next}b=N.x<N.next.x?N:N.next}}N=N.next}while(N!==p);if(!b)return null;if($===_e)return b;var Pe,Be=b,He=b.x,mt=b.y,bt=1/0;N=b;do $>=N.x&&N.x>=He&&$!==N.x&&ic(ce<mt?$:_e,ce,He,mt,ce<mt?_e:$,ce,N.x,N.y)&&(Pe=Math.abs(ce-N.y)/($-N.x),Sl(N,l)&&(Pe<bt||Pe===bt&&(N.x>b.x||N.x===b.x&&uh(b,N)))&&(b=N,bt=Pe)),N=N.next;while(N!==Be);return b}(e,t)){var r=_c(t,e);bl(t,t.next),bl(r,r.next)}}function uh(e,t){return To(e.prev,e,t.prev)<0&&To(t.next,e,e.next)<0}function tf(e,t,r,l,p){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*p)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*p)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function lh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ic(e,t,r,l,p,b,N,$){return(p-N)*(t-$)-(e-N)*(b-$)>=0&&(e-N)*(l-$)-(r-N)*(t-$)>=0&&(r-N)*(b-$)-(p-N)*(l-$)>=0}function ch(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,l){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==l.i&&p.next.i!==l.i&&Mf(p,p.next,r,l))return!0;p=p.next}while(p!==r);return!1}(e,t)&&(Sl(e,t)&&Sl(t,e)&&function(r,l){var p=r,b=!1,N=(r.x+l.x)/2,$=(r.y+l.y)/2;do p.y>$!=p.next.y>$&&p.next.y!==p.y&&N<(p.next.x-p.x)*($-p.y)/(p.next.y-p.y)+p.x&&(b=!b),p=p.next;while(p!==r);return b}(e,t)&&(To(e.prev,e,t.prev)||To(e,t.prev,t))||Oc(e,t)&&To(e.prev,e,e.next)>0&&To(t.prev,t,t.next)>0)}function To(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Oc(e,t){return e.x===t.x&&e.y===t.y}function Mf(e,t,r,l){var p=jl(To(e,t,r)),b=jl(To(e,t,l)),N=jl(To(r,l,e)),$=jl(To(r,l,t));return p!==b&&N!==$||!(p!==0||!ac(e,r,t))||!(b!==0||!ac(e,l,t))||!(N!==0||!ac(r,e,l))||!($!==0||!ac(r,t,l))}function ac(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function jl(e){return e>0?1:e<0?-1:0}function Sl(e,t){return To(e.prev,e,e.next)<0?To(e,t,e.next)>=0&&To(e,e.prev,t)>=0:To(e,t,e.prev)<0||To(e,e.next,t)<0}function _c(e,t){var r=new oc(e.i,e.x,e.y),l=new oc(t.i,t.x,t.y),p=e.next,b=t.prev;return e.next=t,t.prev=e,r.next=p,p.prev=r,l.next=r,r.prev=l,b.next=l,l.prev=b,l}function Ic(e,t,r,l){var p=new oc(e,t,r);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function El(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function oc(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sc(e,t,r,l){for(var p=0,b=t,N=r-l;b<r;b+=l)p+=(e[N]-e[b])*(e[b+1]+e[N+1]),N=b;return p}function rf(e,t,r,l,p){(function b(N,$,ce,_e,Ce){for(;_e>ce;){if(_e-ce>600){var Pe=_e-ce+1,Be=$-ce+1,He=Math.log(Pe),mt=.5*Math.exp(2*He/3),bt=.5*Math.sqrt(He*mt*(Pe-mt)/Pe)*(Be-Pe/2<0?-1:1);b(N,$,Math.max(ce,Math.floor($-Be*mt/Pe+bt)),Math.min(_e,Math.floor($+(Pe-Be)*mt/Pe+bt)),Ce)}var kt=N[$],Tt=ce,Ht=_e;for(Cl(N,ce,$),Ce(N[_e],kt)>0&&Cl(N,ce,_e);Tt<Ht;){for(Cl(N,Tt,Ht),Tt++,Ht--;Ce(N[Tt],kt)<0;)Tt++;for(;Ce(N[Ht],kt)>0;)Ht--}Ce(N[ce],kt)===0?Cl(N,ce,Ht):Cl(N,++Ht,_e),Ht<=$&&(ce=Ht+1),$<=Ht&&(_e=Ht-1)}})(e,t,r||0,l||e.length-1,p||Rc)}function Cl(e,t,r){var l=e[t];e[t]=e[r],e[r]=l}function Rc(e,t){return e<t?-1:e>t?1:0}function uc(e,t){var r=e.length;if(r<=1)return[e];for(var l,p,b=[],N=0;N<r;N++){var $=Q(e[N]);$!==0&&(e[N].area=Math.abs($),p===void 0&&(p=$<0),p===$<0?(l&&b.push(l),l=[e[N]]):l.push(e[N]))}if(l&&b.push(l),t>1)for(var ce=0;ce<b.length;ce++)b[ce].length<=t||(rf(b[ce],t,1,b[ce].length-1,xc),b[ce]=b[ce].slice(0,t));return b}function xc(e,t){return t.area-e.area}function Ul(e,t,r){for(var l=r.patternDependencies,p=!1,b=0,N=t;b<N.length;b+=1){var $=N[b].paint.get(e+"-pattern");$.isConstant()||(p=!0);var ce=$.constantOr(null);ce&&(p=!0,l[ce.to]=!0,l[ce.from]=!0)}return p}function Vl(e,t,r,l,p){for(var b=p.patternDependencies,N=0,$=t;N<$.length;N+=1){var ce=$[N],_e=ce.paint.get(e+"-pattern").value;if(_e.kind!=="constant"){var Ce=_e.evaluate({zoom:l-1},r,{},p.availableImages),Pe=_e.evaluate({zoom:l},r,{},p.availableImages),Be=_e.evaluate({zoom:l+1},r,{},p.availableImages);Pe=Pe&&Pe.name?Pe.name:Pe,Be=Be&&Be.name?Be.name:Be,b[Ce=Ce&&Ce.name?Ce.name:Ce]=!0,b[Pe]=!0,b[Be]=!0,r.patterns[ce.id]={min:Ce,mid:Pe,max:Be}}}return r}yc.deviation=function(e,t,r,l){var p=t&&t.length,b=Math.abs(sc(e,0,p?t[0]*r:e.length,r));if(p)for(var N=0,$=t.length;N<$;N++)b-=Math.abs(sc(e,t[N]*r,N<$-1?t[N+1]*r:e.length,r));var ce=0;for(N=0;N<l.length;N+=3){var _e=l[N]*r,Ce=l[N+1]*r,Pe=l[N+2]*r;ce+=Math.abs((e[_e]-e[Pe])*(e[Ce+1]-e[_e+1])-(e[_e]-e[Ce])*(e[Pe+1]-e[_e+1]))}return b===0&&ce===0?0:Math.abs((ce-b)/b)},yc.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},l=0,p=0;p<e.length;p++){for(var b=0;b<e[p].length;b++)for(var N=0;N<t;N++)r.vertices.push(e[p][b][N]);p>0&&r.holes.push(l+=e[p-1].length)}return r},Qc.default=wf;var Ls=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ba,this.indexArray=new lu,this.indexArray2=new la,this.programConfigurations=new li(e.layers,e.zoom),this.segments=new Xe,this.segments2=new Xe,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Ls.prototype.populate=function(e,t,r){this.hasPattern=Ul("fill",this.layers,t);for(var l=this.layers[0].layout.get("fill-sort-key"),p=[],b=0,N=e;b<N.length;b+=1){var $=N[b],ce=$.feature,_e=$.id,Ce=$.index,Pe=$.sourceLayerIndex,Be=this.layers[0]._featureFilter.needGeometry,He=so(ce,Be);if(this.layers[0]._featureFilter.filter(new nr(this.zoom),He,r)){var mt=l?l.evaluate(He,{},r,t.availableImages):void 0,bt={id:_e,properties:ce.properties,type:ce.type,sourceLayerIndex:Pe,index:Ce,geometry:Be?He.geometry:qa(ce),patterns:{},sortKey:mt};p.push(bt)}}l&&p.sort(function(tn,mn){return tn.sortKey-mn.sortKey});for(var kt=0,Tt=p;kt<Tt.length;kt+=1){var Ht=Tt[kt],rr=Ht.geometry,_r=Ht.index,xr=Ht.sourceLayerIndex;if(this.hasPattern){var Rr=Vl("fill",this.layers,Ht,this.zoom,t);this.patternFeatures.push(Rr)}else this.addFeature(Ht,rr,_r,r,{});t.featureIndex.insert(e[_r].feature,rr,_r,xr,this.index)}},Ls.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ls.prototype.addFeatures=function(e,t,r){for(var l=0,p=this.patternFeatures;l<p.length;l+=1){var b=p[l];this.addFeature(b,b.geometry,b.index,t,r)}},Ls.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ls.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ls.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ls.prototype.addFeature=function(e,t,r,l,p){for(var b=0,N=uc(t,500);b<N.length;b+=1){for(var $=N[b],ce=0,_e=0,Ce=$;_e<Ce.length;_e+=1)ce+=Ce[_e].length;for(var Pe=this.segments.prepareSegment(ce,this.layoutVertexArray,this.indexArray),Be=Pe.vertexLength,He=[],mt=[],bt=0,kt=$;bt<kt.length;bt+=1){var Tt=kt[bt];if(Tt.length!==0){Tt!==$[0]&&mt.push(He.length/2);var Ht=this.segments2.prepareSegment(Tt.length,this.layoutVertexArray,this.indexArray2),rr=Ht.vertexLength;this.layoutVertexArray.emplaceBack(Tt[0].x,Tt[0].y),this.indexArray2.emplaceBack(rr+Tt.length-1,rr),He.push(Tt[0].x),He.push(Tt[0].y);for(var _r=1;_r<Tt.length;_r++)this.layoutVertexArray.emplaceBack(Tt[_r].x,Tt[_r].y),this.indexArray2.emplaceBack(rr+_r-1,rr+_r),He.push(Tt[_r].x),He.push(Tt[_r].y);Ht.vertexLength+=Tt.length,Ht.primitiveLength+=Tt.length}}for(var xr=Qc(He,mt),Rr=0;Rr<xr.length;Rr+=3)this.indexArray.emplaceBack(Be+xr[Rr],Be+xr[Rr+1],Be+xr[Rr+2]);Pe.vertexLength+=ce,Pe.primitiveLength+=xr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,p,l)},Sn("FillBucket",Ls,{omit:["layers","patternFeatures"]});var bc=new xa({"fill-sort-key":new yn(Ye.layout_fill["fill-sort-key"])}),nf={paint:new xa({"fill-antialias":new gn(Ye.paint_fill["fill-antialias"]),"fill-opacity":new yn(Ye.paint_fill["fill-opacity"]),"fill-color":new yn(Ye.paint_fill["fill-color"]),"fill-outline-color":new yn(Ye.paint_fill["fill-outline-color"]),"fill-translate":new gn(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new gn(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new yo(Ye.paint_fill["fill-pattern"])}),layout:bc},Sc=function(e){function t(r){e.call(this,r,nf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,l){e.prototype.recalculate.call(this,r,l);var p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Ls(r)},t.prototype.queryRadius=function(){return _o(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,l,p,b,N,$,ce){return zs(hu(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),$.angle,ce),b)},t.prototype.isTileClipped=function(){return!0},t}(ao),Gl=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,af=Tl;function Tl(e,t,r,l,p){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=l,this._values=p,e.readFields(fh,this,t)}function fh(e,t,r){e==1?t.id=r.readVarint():e==2?function(l,p){for(var b=l.readVarint()+l.pos;l.pos<b;){var N=p._keys[l.readVarint()],$=p._values[l.readVarint()];p.properties[N]=$}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function hh(e){for(var t,r,l=0,p=0,b=e.length,N=b-1;p<b;N=p++)l+=((r=e[N]).x-(t=e[p]).x)*(t.y+r.y);return l}Tl.types=["Unknown","Point","LineString","Polygon"],Tl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,l=1,p=0,b=0,N=0,$=[];e.pos<r;){if(p<=0){var ce=e.readVarint();l=7&ce,p=ce>>3}if(p--,l===1||l===2)b+=e.readSVarint(),N+=e.readSVarint(),l===1&&(t&&$.push(t),t=[]),t.push(new L(b,N));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&$.push(t),$},Tl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,l=0,p=0,b=0,N=1/0,$=-1/0,ce=1/0,_e=-1/0;e.pos<t;){if(l<=0){var Ce=e.readVarint();r=7&Ce,l=Ce>>3}if(l--,r===1||r===2)(p+=e.readSVarint())<N&&(N=p),p>$&&($=p),(b+=e.readSVarint())<ce&&(ce=b),b>_e&&(_e=b);else if(r!==7)throw new Error("unknown command "+r)}return[N,ce,$,_e]},Tl.prototype.toGeoJSON=function(e,t,r){var l,p,b=this.extent*Math.pow(2,r),N=this.extent*e,$=this.extent*t,ce=this.loadGeometry(),_e=Tl.types[this.type];function Ce(He){for(var mt=0;mt<He.length;mt++){var bt=He[mt];He[mt]=[360*(bt.x+N)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(bt.y+$)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var Pe=[];for(l=0;l<ce.length;l++)Pe[l]=ce[l][0];Ce(ce=Pe);break;case 2:for(l=0;l<ce.length;l++)Ce(ce[l]);break;case 3:for(ce=function(He){var mt=He.length;if(mt<=1)return[He];for(var bt,kt,Tt=[],Ht=0;Ht<mt;Ht++){var rr=hh(He[Ht]);rr!==0&&(kt===void 0&&(kt=rr<0),kt===rr<0?(bt&&Tt.push(bt),bt=[He[Ht]]):bt.push(He[Ht]))}return bt&&Tt.push(bt),Tt}(ce),l=0;l<ce.length;l++)for(p=0;p<ce[l].length;p++)Ce(ce[l][p])}ce.length===1?ce=ce[0]:_e="Multi"+_e;var Be={type:"Feature",geometry:{type:_e,coordinates:ce},properties:this.properties};return"id"in this&&(Be.id=this.id),Be};var Pf=al;function al(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Of,this,t),this.length=this._features.length}function Of(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(l){for(var p=null,b=l.readVarint()+l.pos;l.pos<b;){var N=l.readVarint()>>3;p=N===1?l.readString():N===2?l.readFloat():N===3?l.readDouble():N===4?l.readVarint64():N===5?l.readVarint():N===6?l.readSVarint():N===7?l.readBoolean():null}return p}(r))}function If(e,t,r){if(e===3){var l=new Pf(r,r.readVarint()+r.pos);l.length&&(t[l.name]=l)}}al.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new af(this._pbf,t,this.extent,this._keys,this._values)};var Hl={VectorTile:function(e,t){this.layers=e.readFields(If,{},t)},VectorTileFeature:af,VectorTileLayer:Pf},dh=Hl.VectorTileFeature.types,Lc=Math.pow(2,13);function Ec(e,t,r,l,p,b,N,$){e.emplaceBack(t,r,2*Math.floor(l*Lc)+N,p*Lc*2,b*Lc*2,Math.round($))}var Zo=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new No,this.indexArray=new lu,this.programConfigurations=new li(e.layers,e.zoom),this.segments=new Xe,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Rf(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Zo.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=Ul("fill-extrusion",this.layers,t);for(var l=0,p=e;l<p.length;l+=1){var b=p[l],N=b.feature,$=b.id,ce=b.index,_e=b.sourceLayerIndex,Ce=this.layers[0]._featureFilter.needGeometry,Pe=so(N,Ce);if(this.layers[0]._featureFilter.filter(new nr(this.zoom),Pe,r)){var Be={id:$,sourceLayerIndex:_e,index:ce,geometry:Ce?Pe.geometry:qa(N),properties:N.properties,type:N.type,patterns:{}};this.hasPattern?this.features.push(Vl("fill-extrusion",this.layers,Be,this.zoom,t)):this.addFeature(Be,Be.geometry,ce,r,{}),t.featureIndex.insert(N,Be.geometry,ce,_e,this.index,!0)}}},Zo.prototype.addFeatures=function(e,t,r){for(var l=0,p=this.features;l<p.length;l+=1){var b=p[l];this.addFeature(b,b.geometry,b.index,t,r)}},Zo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Zo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gl),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Zo.prototype.addFeature=function(e,t,r,l,p){for(var b=0,N=uc(t,500);b<N.length;b+=1){for(var $=N[b],ce=0,_e=0,Ce=$;_e<Ce.length;_e+=1)ce+=Ce[_e].length;for(var Pe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),Be=0,He=$;Be<He.length;Be+=1){var mt=He[Be];if(mt.length!==0&&!((na=mt).every(function(Zi){return Zi.x<0})||na.every(function(Zi){return Zi.x>8192})||na.every(function(Zi){return Zi.y<0})||na.every(function(Zi){return Zi.y>8192})))for(var bt=0,kt=0;kt<mt.length;kt++){var Tt=mt[kt];if(kt>=1){var Ht=mt[kt-1];if(!Rf(Tt,Ht)){Pe.vertexLength+4>Xe.MAX_VERTEX_ARRAY_LENGTH&&(Pe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var rr=Tt.sub(Ht)._perp()._unit(),_r=Ht.dist(Tt);bt+_r>32768&&(bt=0),Ec(this.layoutVertexArray,Tt.x,Tt.y,rr.x,rr.y,0,0,bt),Ec(this.layoutVertexArray,Tt.x,Tt.y,rr.x,rr.y,0,1,bt),Ec(this.layoutVertexArray,Ht.x,Ht.y,rr.x,rr.y,0,0,bt+=_r),Ec(this.layoutVertexArray,Ht.x,Ht.y,rr.x,rr.y,0,1,bt);var xr=Pe.vertexLength;this.indexArray.emplaceBack(xr,xr+2,xr+1),this.indexArray.emplaceBack(xr+1,xr+2,xr+3),Pe.vertexLength+=4,Pe.primitiveLength+=2}}}}if(Pe.vertexLength+ce>Xe.MAX_VERTEX_ARRAY_LENGTH&&(Pe=this.segments.prepareSegment(ce,this.layoutVertexArray,this.indexArray)),dh[e.type]==="Polygon"){for(var Rr=[],tn=[],mn=Pe.vertexLength,qn=0,In=$;qn<In.length;qn+=1){var ai=In[qn];if(ai.length!==0){ai!==$[0]&&tn.push(Rr.length/2);for(var Fn=0;Fn<ai.length;Fn++){var Ki=ai[Fn];Ec(this.layoutVertexArray,Ki.x,Ki.y,0,0,1,1,0),Rr.push(Ki.x),Rr.push(Ki.y)}}}for(var Ai=Qc(Rr,tn),Kn=0;Kn<Ai.length;Kn+=3)this.indexArray.emplaceBack(mn+Ai[Kn],mn+Ai[Kn+2],mn+Ai[Kn+1]);Pe.primitiveLength+=Ai.length/3,Pe.vertexLength+=ce}}var na;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,p,l)},Sn("FillExtrusionBucket",Zo,{omit:["layers","features"]});var lc={paint:new xa({"fill-extrusion-opacity":new gn(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gn(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gn(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yo(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gn(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},wl=function(e){function t(r){e.call(this,r,lc)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Zo(r)},t.prototype.queryRadius=function(){return _o(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,l,p,b,N,$,ce,_e){var Ce=hu(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),$.angle,ce),Pe=this.paint.get("fill-extrusion-height").evaluate(l,p),Be=this.paint.get("fill-extrusion-base").evaluate(l,p),He=function(bt,kt,Tt,Ht){for(var rr=[],_r=0,xr=bt;_r<xr.length;_r+=1){var Rr=xr[_r],tn=[Rr.x,Rr.y,0,1];Nu(tn,tn,kt),rr.push(new L(tn[0]/tn[3],tn[1]/tn[3]))}return rr}(Ce,_e),mt=function(bt,kt,Tt,Ht){for(var rr=[],_r=[],xr=Ht[8]*kt,Rr=Ht[9]*kt,tn=Ht[10]*kt,mn=Ht[11]*kt,qn=Ht[8]*Tt,In=Ht[9]*Tt,ai=Ht[10]*Tt,Fn=Ht[11]*Tt,Ki=0,Ai=bt;Ki<Ai.length;Ki+=1){for(var Kn=[],na=[],Zi=0,pa=Ai[Ki];Zi<pa.length;Zi+=1){var si=pa[Zi],Ma=si.x,lo=si.y,So=Ht[0]*Ma+Ht[4]*lo+Ht[12],mo=Ht[1]*Ma+Ht[5]*lo+Ht[13],co=Ht[2]*Ma+Ht[6]*lo+Ht[14],Eo=Ht[3]*Ma+Ht[7]*lo+Ht[15],$o=co+tn,Jo=Eo+mn,Ms=So+qn,ss=mo+In,Ps=co+ai,Mo=Eo+Fn,us=new L((So+xr)/Jo,(mo+Rr)/Jo);us.z=$o/Jo,Kn.push(us);var ca=new L(Ms/Mo,ss/Mo);ca.z=Ps/Mo,na.push(ca)}rr.push(Kn),_r.push(na)}return[rr,_r]}(b,Be,Pe,_e);return function(bt,kt,Tt){var Ht=1/0;zs(Tt,kt)&&(Ht=Dc(Tt,kt[0]));for(var rr=0;rr<kt.length;rr++)for(var _r=kt[rr],xr=bt[rr],Rr=0;Rr<_r.length-1;Rr++){var tn=_r[Rr],mn=[tn,_r[Rr+1],xr[Rr+1],xr[Rr],tn];Cu(Tt,mn)&&(Ht=Math.min(Ht,Dc(Tt,mn)))}return Ht!==1/0&&Ht}(mt[0],mt[1],He)},t}(ao);function cc(e,t){return e.x*t.x+e.y*t.y}function Dc(e,t){if(e.length===1){for(var r,l=0,p=t[l++];!r||p.equals(r);)if(!(r=t[l++]))return 1/0;for(;l<t.length;l++){var b=t[l],N=e[0],$=r.sub(p),ce=b.sub(p),_e=N.sub(p),Ce=cc($,$),Pe=cc($,ce),Be=cc(ce,ce),He=cc(_e,$),mt=cc(_e,ce),bt=Ce*Be-Pe*Pe,kt=(Be*He-Pe*mt)/bt,Tt=(Ce*mt-Pe*He)/bt,Ht=p.z*(1-kt-Tt)+r.z*kt+b.z*Tt;if(isFinite(Ht))return Ht}return 1/0}for(var rr=1/0,_r=0,xr=t;_r<xr.length;_r+=1)rr=Math.min(rr,xr[_r].z);return rr}var kc=Qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Lf=Qi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Wo=Hl.VectorTileFeature.types,Al=Math.cos(Math.PI/180*37.5),wo=Math.pow(2,14)/.5,Wa=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ro,this.layoutVertexArray2=new ws,this.indexArray=new lu,this.programConfigurations=new li(e.layers,e.zoom),this.segments=new Xe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Wa.prototype.populate=function(e,t,r){this.hasPattern=Ul("line",this.layers,t);for(var l=this.layers[0].layout.get("line-sort-key"),p=[],b=0,N=e;b<N.length;b+=1){var $=N[b],ce=$.feature,_e=$.id,Ce=$.index,Pe=$.sourceLayerIndex,Be=this.layers[0]._featureFilter.needGeometry,He=so(ce,Be);if(this.layers[0]._featureFilter.filter(new nr(this.zoom),He,r)){var mt=l?l.evaluate(He,{},r):void 0,bt={id:_e,properties:ce.properties,type:ce.type,sourceLayerIndex:Pe,index:Ce,geometry:Be?He.geometry:qa(ce),patterns:{},sortKey:mt};p.push(bt)}}l&&p.sort(function(tn,mn){return tn.sortKey-mn.sortKey});for(var kt=0,Tt=p;kt<Tt.length;kt+=1){var Ht=Tt[kt],rr=Ht.geometry,_r=Ht.index,xr=Ht.sourceLayerIndex;if(this.hasPattern){var Rr=Vl("line",this.layers,Ht,this.zoom,t);this.patternFeatures.push(Rr)}else this.addFeature(Ht,rr,_r,r,{});t.featureIndex.insert(e[_r].feature,rr,_r,xr,this.index)}},Wa.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Wa.prototype.addFeatures=function(e,t,r){for(var l=0,p=this.patternFeatures;l<p.length;l+=1){var b=p[l];this.addFeature(b,b.geometry,b.index,t,r)}},Wa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wa.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Wa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wa.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Wa.prototype.addFeature=function(e,t,r,l,p){var b=this.layers[0].layout,N=b.get("line-join").evaluate(e,{}),$=b.get("line-cap"),ce=b.get("line-miter-limit"),_e=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var Ce=0,Pe=t;Ce<Pe.length;Ce+=1)this.addLine(Pe[Ce],e,N,$,ce,_e);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,p,l)},Wa.prototype.addLine=function(e,t,r,l,p,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var N=0;N<e.length-1;N++)this.totalDistance+=e[N].dist(e[N+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var $=Wo[t.type]==="Polygon",ce=e.length;ce>=2&&e[ce-1].equals(e[ce-2]);)ce--;for(var _e=0;_e<ce-1&&e[_e].equals(e[_e+1]);)_e++;if(!(ce<($?3:2))){r==="bevel"&&(p=1.05);var Ce,Pe=this.overscaling<=16?122880/(512*this.overscaling):0,Be=this.segments.prepareSegment(10*ce,this.layoutVertexArray,this.indexArray),He=void 0,mt=void 0,bt=void 0,kt=void 0;this.e1=this.e2=-1,$&&(kt=e[_e].sub(Ce=e[ce-2])._unit()._perp());for(var Tt=_e;Tt<ce;Tt++)if(!(mt=Tt===ce-1?$?e[_e+1]:void 0:e[Tt+1])||!e[Tt].equals(mt)){kt&&(bt=kt),Ce&&(He=Ce),Ce=e[Tt],kt=mt?mt.sub(Ce)._unit()._perp():bt;var Ht=(bt=bt||kt).add(kt);Ht.x===0&&Ht.y===0||Ht._unit();var rr=bt.x*kt.x+bt.y*kt.y,_r=Ht.x*kt.x+Ht.y*kt.y,xr=_r!==0?1/_r:1/0,Rr=2*Math.sqrt(2-2*_r),tn=_r<Al&&He&&mt,mn=bt.x*kt.y-bt.y*kt.x>0;if(tn&&Tt>_e){var qn=Ce.dist(He);if(qn>2*Pe){var In=Ce.sub(Ce.sub(He)._mult(Pe/qn)._round());this.updateDistance(He,In),this.addCurrentVertex(In,bt,0,0,Be),He=In}}var ai=He&&mt,Fn=ai?r:$?"butt":l;if(ai&&Fn==="round"&&(xr<b?Fn="miter":xr<=2&&(Fn="fakeround")),Fn==="miter"&&xr>p&&(Fn="bevel"),Fn==="bevel"&&(xr>2&&(Fn="flipbevel"),xr<p&&(Fn="miter")),He&&this.updateDistance(He,Ce),Fn==="miter")Ht._mult(xr),this.addCurrentVertex(Ce,Ht,0,0,Be);else if(Fn==="flipbevel"){if(xr>100)Ht=kt.mult(-1);else{var Ki=xr*bt.add(kt).mag()/bt.sub(kt).mag();Ht._perp()._mult(Ki*(mn?-1:1))}this.addCurrentVertex(Ce,Ht,0,0,Be),this.addCurrentVertex(Ce,Ht.mult(-1),0,0,Be)}else if(Fn==="bevel"||Fn==="fakeround"){var Ai=-Math.sqrt(xr*xr-1),Kn=mn?Ai:0,na=mn?0:Ai;if(He&&this.addCurrentVertex(Ce,bt,Kn,na,Be),Fn==="fakeround")for(var Zi=Math.round(180*Rr/Math.PI/20),pa=1;pa<Zi;pa++){var si=pa/Zi;if(si!==.5){var Ma=si-.5;si+=si*Ma*(si-1)*((1.0904+rr*(rr*(3.55645-1.43519*rr)-3.2452))*Ma*Ma+(.848013+rr*(.215638*rr-1.06021)))}var lo=kt.sub(bt)._mult(si)._add(bt)._unit()._mult(mn?-1:1);this.addHalfVertex(Ce,lo.x,lo.y,!1,mn,0,Be)}mt&&this.addCurrentVertex(Ce,kt,-Kn,-na,Be)}else if(Fn==="butt")this.addCurrentVertex(Ce,Ht,0,0,Be);else if(Fn==="square"){var So=He?1:-1;this.addCurrentVertex(Ce,Ht,So,So,Be)}else Fn==="round"&&(He&&(this.addCurrentVertex(Ce,bt,0,0,Be),this.addCurrentVertex(Ce,bt,1,1,Be,!0)),mt&&(this.addCurrentVertex(Ce,kt,-1,-1,Be,!0),this.addCurrentVertex(Ce,kt,0,0,Be)));if(tn&&Tt<ce-1){var mo=Ce.dist(mt);if(mo>2*Pe){var co=Ce.add(mt.sub(Ce)._mult(Pe/mo)._round());this.updateDistance(Ce,co),this.addCurrentVertex(co,kt,0,0,Be),Ce=co}}}}},Wa.prototype.addCurrentVertex=function(e,t,r,l,p,b){b===void 0&&(b=!1);var N=t.y*l-t.x,$=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,b,!1,r,p),this.addHalfVertex(e,N,$,b,!0,-l,p),this.distance>wo/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,l,p,b))},Wa.prototype.addHalfVertex=function(e,t,r,l,p,b,N){var $=.5*(this.lineClips?this.scaledDistance*(wo-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(l?1:0),(e.y<<1)+(p?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(b===0?0:b<0?-1:1)|(63&$)<<2,$>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var ce=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ce),N.primitiveLength++),p?this.e2=ce:this.e1=ce},Wa.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wa.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Sn("LineBucket",Wa,{omit:["layers","patternFeatures"]});var Df=new xa({"line-cap":new gn(Ye.layout_line["line-cap"]),"line-join":new yn(Ye.layout_line["line-join"]),"line-miter-limit":new gn(Ye.layout_line["line-miter-limit"]),"line-round-limit":new gn(Ye.layout_line["line-round-limit"]),"line-sort-key":new yn(Ye.layout_line["line-sort-key"])}),kf={paint:new xa({"line-opacity":new yn(Ye.paint_line["line-opacity"]),"line-color":new yn(Ye.paint_line["line-color"]),"line-translate":new gn(Ye.paint_line["line-translate"]),"line-translate-anchor":new gn(Ye.paint_line["line-translate-anchor"]),"line-width":new yn(Ye.paint_line["line-width"]),"line-gap-width":new yn(Ye.paint_line["line-gap-width"]),"line-offset":new yn(Ye.paint_line["line-offset"]),"line-blur":new yn(Ye.paint_line["line-blur"]),"line-dasharray":new ga(Ye.paint_line["line-dasharray"]),"line-pattern":new yo(Ye.paint_line["line-pattern"]),"line-gradient":new Na(Ye.paint_line["line-gradient"])}),layout:Df},Ff=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,l){return l=new nr(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),e.prototype.possiblyEvaluate.call(this,r,l)},t.prototype.evaluate=function(r,l,p,b){return l=I({},l,{zoom:Math.floor(l.zoom)}),e.prototype.evaluate.call(this,r,l,p,b)},t}(yn))(kf.paint.properties["line-width"].specification);Ff.useIntegerZoom=!0;var ph=function(e){function t(r){e.call(this,r,kf),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Xt,this.gradientVersion=(this.gradientVersion+1)%g)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,l){e.prototype.recalculate.call(this,r,l),this.paint._values["line-floorwidth"]=Ff.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Wa(r)},t.prototype.queryRadius=function(r){var l=r,p=Nf($s("line-width",this,l),$s("line-gap-width",this,l)),b=$s("line-offset",this,l);return p/2+Math.abs(b)+_o(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,l,p,b,N,$,ce){var _e=hu(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),$.angle,ce),Ce=ce/2*Nf(this.paint.get("line-width").evaluate(l,p),this.paint.get("line-gap-width").evaluate(l,p)),Pe=this.paint.get("line-offset").evaluate(l,p);return Pe&&(b=function(Be,He){for(var mt=[],bt=new L(0,0),kt=0;kt<Be.length;kt++){for(var Tt=Be[kt],Ht=[],rr=0;rr<Tt.length;rr++){var _r=Tt[rr],xr=Tt[rr+1],Rr=rr===0?bt:_r.sub(Tt[rr-1])._unit()._perp(),tn=rr===Tt.length-1?bt:xr.sub(_r)._unit()._perp(),mn=Rr._add(tn)._unit();mn._mult(1/(mn.x*tn.x+mn.y*tn.y)),Ht.push(mn._mult(He)._add(_r))}mt.push(Ht)}return mt}(b,Pe*ce)),function(Be,He,mt){for(var bt=0;bt<He.length;bt++){var kt=He[bt];if(Be.length>=3){for(var Tt=0;Tt<kt.length;Tt++)if(js(Be,kt[Tt]))return!0}if(As(Be,kt,mt))return!0}return!1}(_e,b,Ce)},t.prototype.isTileClipped=function(){return!0},t}(ao);function Nf(e,t){return t>0?t+2*e:e}var Bf=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vh=Qi([{name:"a_projected_pos",components:3,type:"Float32"}],4),mh=(Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),zf=(Qi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),gh=Qi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yh(e,t,r){return e.sections.forEach(function(l){l.text=function(p,b,N){var $=b.layout.get("text-transform").evaluate(N,{});return $==="uppercase"?p=p.toLocaleUpperCase():$==="lowercase"&&(p=p.toLocaleLowerCase()),hr.applyArabicShaping&&(p=hr.applyArabicShaping(p)),p}(l.text,t,r)}),e}Qi([{name:"triangle",components:3,type:"Uint16"}]),Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var fc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},of=function(e,t,r,l,p){var b,N,$=8*p-l-1,ce=(1<<$)-1,_e=ce>>1,Ce=-7,Pe=r?p-1:0,Be=r?-1:1,He=e[t+Pe];for(Pe+=Be,b=He&(1<<-Ce)-1,He>>=-Ce,Ce+=$;Ce>0;b=256*b+e[t+Pe],Pe+=Be,Ce-=8);for(N=b&(1<<-Ce)-1,b>>=-Ce,Ce+=l;Ce>0;N=256*N+e[t+Pe],Pe+=Be,Ce-=8);if(b===0)b=1-_e;else{if(b===ce)return N?NaN:1/0*(He?-1:1);N+=Math.pow(2,l),b-=_e}return(He?-1:1)*N*Math.pow(2,b-l)},sf=function(e,t,r,l,p,b){var N,$,ce,_e=8*b-p-1,Ce=(1<<_e)-1,Pe=Ce>>1,Be=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,He=l?0:b-1,mt=l?1:-1,bt=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?($=isNaN(t)?1:0,N=Ce):(N=Math.floor(Math.log(t)/Math.LN2),t*(ce=Math.pow(2,-N))<1&&(N--,ce*=2),(t+=N+Pe>=1?Be/ce:Be*Math.pow(2,1-Pe))*ce>=2&&(N++,ce/=2),N+Pe>=Ce?($=0,N=Ce):N+Pe>=1?($=(t*ce-1)*Math.pow(2,p),N+=Pe):($=t*Math.pow(2,Pe-1)*Math.pow(2,p),N=0));p>=8;e[r+He]=255&$,He+=mt,$/=256,p-=8);for(N=N<<p|$,_e+=p;_e>0;e[r+He]=255&N,He+=mt,N/=256,_e-=8);e[r+He-mt]|=128*bt},Fc=Ha;function Ha(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ha.Varint=0,Ha.Fixed64=1,Ha.Bytes=2,Ha.Fixed32=5;var uf=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ol(e){return e.type===Ha.Bytes?e.readVarint()+e.pos:e.pos+1}function ye(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Qe(e,t,r){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(l);for(var p=r.pos-1;p>=e;p--)r.buf[p+l]=r.buf[p]}function Ct(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function pr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Ir(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function dr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Tr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function en(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function rn(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function $r(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function ln(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function Yr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Qr(e,t,r){e===1&&r.readMessage($t,t)}function $t(e,t,r){if(e===3){var l=r.readMessage(Sr,{}),p=l.width,b=l.height,N=l.left,$=l.top,ce=l.advance;t.push({id:l.id,bitmap:new Bu({width:p+6,height:b+6},l.bitmap),metrics:{width:p,height:b,left:N,top:$,advance:ce}})}}function Sr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Kr(e){for(var t=0,r=0,l=0,p=e;l<p.length;l+=1){var b=p[l];t+=b.w*b.h,r=Math.max(r,b.w)}e.sort(function(bt,kt){return kt.h-bt.h});for(var N=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],$=0,ce=0,_e=0,Ce=e;_e<Ce.length;_e+=1)for(var Pe=Ce[_e],Be=N.length-1;Be>=0;Be--){var He=N[Be];if(!(Pe.w>He.w||Pe.h>He.h)){if(Pe.x=He.x,Pe.y=He.y,ce=Math.max(ce,Pe.y+Pe.h),$=Math.max($,Pe.x+Pe.w),Pe.w===He.w&&Pe.h===He.h){var mt=N.pop();Be<N.length&&(N[Be]=mt)}else Pe.h===He.h?(He.x+=Pe.w,He.w-=Pe.w):Pe.w===He.w?(He.y+=Pe.h,He.h-=Pe.h):(N.push({x:He.x+Pe.w,y:He.y,w:He.w-Pe.w,h:Pe.h}),He.y+=Pe.h,He.h-=Pe.h);break}}return{w:$,h:ce,fill:t/($*ce)||0}}Ha.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var l=this.readVarint(),p=l>>3,b=this.pos;this.type=7&l,e(p,t,this),this.pos===b&&this.skip(l)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=$r(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Yr(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=$r(this.buf,this.pos)+4294967296*$r(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=$r(this.buf,this.pos)+4294967296*Yr(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=of(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=of(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,l=this.buf;return t=127&(r=l[this.pos++]),r<128?t:(t|=(127&(r=l[this.pos++]))<<7,r<128?t:(t|=(127&(r=l[this.pos++]))<<14,r<128?t:(t|=(127&(r=l[this.pos++]))<<21,r<128?t:function(p,b,N){var $,ce,_e=N.buf;if($=(112&(ce=_e[N.pos++]))>>4,ce<128||($|=(127&(ce=_e[N.pos++]))<<3,ce<128)||($|=(127&(ce=_e[N.pos++]))<<10,ce<128)||($|=(127&(ce=_e[N.pos++]))<<17,ce<128)||($|=(127&(ce=_e[N.pos++]))<<24,ce<128)||($|=(1&(ce=_e[N.pos++]))<<31,ce<128))return ye(p,$,b);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=l[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&uf?function(r,l,p){return uf.decode(r.subarray(l,p))}(this.buf,t,e):function(r,l,p){for(var b="",N=l;N<p;){var $,ce,_e,Ce=r[N],Pe=null,Be=Ce>239?4:Ce>223?3:Ce>191?2:1;if(N+Be>p)break;Be===1?Ce<128&&(Pe=Ce):Be===2?(192&($=r[N+1]))==128&&(Pe=(31&Ce)<<6|63&$)<=127&&(Pe=null):Be===3?(ce=r[N+2],(192&($=r[N+1]))==128&&(192&ce)==128&&((Pe=(15&Ce)<<12|(63&$)<<6|63&ce)<=2047||Pe>=55296&&Pe<=57343)&&(Pe=null)):Be===4&&(ce=r[N+2],_e=r[N+3],(192&($=r[N+1]))==128&&(192&ce)==128&&(192&_e)==128&&((Pe=(15&Ce)<<18|(63&$)<<12|(63&ce)<<6|63&_e)<=65535||Pe>=1114112)&&(Pe=null)),Pe===null?(Pe=65533,Be=1):Pe>65535&&(Pe-=65536,b+=String.fromCharCode(Pe>>>10&1023|55296),Pe=56320|1023&Pe),b+=String.fromCharCode(Pe),N+=Be}return b}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ha.Bytes)return e.push(this.readVarint(t));var r=ol(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ha.Bytes)return e.push(this.readSVarint());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ha.Bytes)return e.push(this.readBoolean());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ha.Bytes)return e.push(this.readFloat());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ha.Bytes)return e.push(this.readDouble());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ha.Bytes)return e.push(this.readFixed32());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ha.Bytes)return e.push(this.readSFixed32());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ha.Bytes)return e.push(this.readFixed64());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ha.Bytes)return e.push(this.readSFixed64());var t=ol(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ha.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ha.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ha.Fixed32)this.pos+=4;else{if(t!==Ha.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ln(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ln(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ln(this.buf,-1&e,this.pos),ln(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ln(this.buf,-1&e,this.pos),ln(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(b,N,$){$.buf[$.pos++]=127&b|128,b>>>=7,$.buf[$.pos++]=127&b|128,b>>>=7,$.buf[$.pos++]=127&b|128,b>>>=7,$.buf[$.pos++]=127&b|128,$.buf[$.pos]=127&(b>>>=7)}(l,0,r),function(b,N){var $=(7&b)<<4;N.buf[N.pos++]|=$|((b>>>=3)?128:0),b&&(N.buf[N.pos++]=127&b|((b>>>=7)?128:0),b&&(N.buf[N.pos++]=127&b|((b>>>=7)?128:0),b&&(N.buf[N.pos++]=127&b|((b>>>=7)?128:0),b&&(N.buf[N.pos++]=127&b|((b>>>=7)?128:0),b&&(N.buf[N.pos++]=127&b)))))}(p,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(l,p,b){for(var N,$,ce=0;ce<p.length;ce++){if((N=p.charCodeAt(ce))>55295&&N<57344){if(!$){N>56319||ce+1===p.length?(l[b++]=239,l[b++]=191,l[b++]=189):$=N;continue}if(N<56320){l[b++]=239,l[b++]=191,l[b++]=189,$=N;continue}N=$-55296<<10|N-56320|65536,$=null}else $&&(l[b++]=239,l[b++]=191,l[b++]=189,$=null);N<128?l[b++]=N:(N<2048?l[b++]=N>>6|192:(N<65536?l[b++]=N>>12|224:(l[b++]=N>>18|240,l[b++]=N>>12&63|128),l[b++]=N>>6&63|128),l[b++]=63&N|128)}return b}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Qe(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),sf(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),sf(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var l=this.pos-r;l>=128&&Qe(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeMessage:function(e,t,r){this.writeTag(e,Ha.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ct,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,pr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Tr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Ir,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,dr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,en,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,rn,t)},writeBytesField:function(e,t){this.writeTag(e,Ha.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ha.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ha.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ha.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ha.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ha.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ha.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ha.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ha.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ha.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Mn=function(e,t){var r=t.pixelRatio,l=t.version,p=t.stretchX,b=t.stretchY,N=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=b,this.content=N,this.version=l},Nr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Nr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Nr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Nr.tlbr.get=function(){return this.tl.concat(this.br)},Nr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Mn.prototype,Nr);var En=function(e,t){var r={},l={};this.haveRenderCallbacks=[];var p=[];this.addImages(e,r,p),this.addImages(t,l,p);var b=Kr(p),N=new ns({width:b.w||1,height:b.h||1});for(var $ in e){var ce=e[$],_e=r[$].paddedRect;ns.copy(ce.data,N,{x:0,y:0},{x:_e.x+1,y:_e.y+1},ce.data)}for(var Ce in t){var Pe=t[Ce],Be=l[Ce].paddedRect,He=Be.x+1,mt=Be.y+1,bt=Pe.data.width,kt=Pe.data.height;ns.copy(Pe.data,N,{x:0,y:0},{x:He,y:mt},Pe.data),ns.copy(Pe.data,N,{x:0,y:kt-1},{x:He,y:mt-1},{width:bt,height:1}),ns.copy(Pe.data,N,{x:0,y:0},{x:He,y:mt+kt},{width:bt,height:1}),ns.copy(Pe.data,N,{x:bt-1,y:0},{x:He-1,y:mt},{width:1,height:kt}),ns.copy(Pe.data,N,{x:0,y:0},{x:He+bt,y:mt},{width:1,height:kt})}this.image=N,this.iconPositions=r,this.patternPositions=l};En.prototype.addImages=function(e,t,r){for(var l in e){var p=e[l],b={x:0,y:0,w:p.data.width+2,h:p.data.height+2};r.push(b),t[l]=new Mn(b,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}},En.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},En.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var l=e.tl;r.update(t.data,void 0,{x:l[0],y:l[1]})}},Sn("ImagePosition",Mn),Sn("ImageAtlas",En);var on={horizontal:1,vertical:2,horizontalOnly:3},Qn=function(){this.scale=1,this.fontStack="",this.imageName=null};Qn.forText=function(e,t){var r=new Qn;return r.scale=e||1,r.fontStack=t,r},Qn.forImage=function(e){var t=new Qn;return t.imageName=e,t};var wr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Pr(e,t,r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt){var kt,Tt=wr.fromFeature(e,p);Pe===on.vertical&&Tt.verticalizePunctuation();var Ht=hr.processBidirectionalText,rr=hr.processStyledBidirectionalText;if(Ht&&Tt.sections.length===1){kt=[];for(var _r=0,xr=Ht(Tt.toString(),Ti(Tt,_e,b,t,l,He,mt));_r<xr.length;_r+=1){var Rr=xr[_r],tn=new wr;tn.text=Rr,tn.sections=Tt.sections;for(var mn=0;mn<Rr.length;mn++)tn.sectionIndex.push(0);kt.push(tn)}}else if(rr){kt=[];for(var qn=0,In=rr(Tt.text,Tt.sectionIndex,Ti(Tt,_e,b,t,l,He,mt));qn<In.length;qn+=1){var ai=In[qn],Fn=new wr;Fn.text=ai[0],Fn.sectionIndex=ai[1],Fn.sections=Tt.sections,kt.push(Fn)}}else kt=function(Kn,na){for(var Zi=[],pa=Kn.text,si=0,Ma=0,lo=na;Ma<lo.length;Ma+=1){var So=lo[Ma];Zi.push(Kn.substring(si,So)),si=So}return si<pa.length&&Zi.push(Kn.substring(si,pa.length)),Zi}(Tt,Ti(Tt,_e,b,t,l,He,mt));var Ki=[],Ai={positionedLines:Ki,text:Tt.toString(),top:Ce[1],bottom:Ce[1],left:Ce[0],right:Ce[0],writingMode:Pe,iconsInText:!1,verticalizable:!1};return function(Kn,na,Zi,pa,si,Ma,lo,So,mo,co,Eo,$o){for(var Jo=0,Ms=-17,ss=0,Ps=0,Mo=So==="right"?1:So==="left"?0:.5,us=0,ca=0,Za=si;ca<Za.length;ca+=1){var za=Za[ca];za.trim();var ya=za.getMaxScale(),Ds=24*(ya-1),bs={positionedGlyphs:[],lineOffset:0};Kn.positionedLines[us]=bs;var eo=bs.positionedGlyphs,Fo=0;if(za.length()){for(var Ss=0;Ss<za.length();Ss++){var Pa=za.getSection(Ss),Ml=za.getSectionIndex(Ss),mu=za.getCharCode(Ss),Pl=0,Po=null,Ol=null,Uu=null,Bc=24,wc=!(mo===on.horizontal||!Eo&&!Ns(mu)||Eo&&(jn[mu]||(Xl=mu,pn.Arabic(Xl)||pn["Arabic Supplement"](Xl)||pn["Arabic Extended-A"](Xl)||pn["Arabic Presentation Forms-A"](Xl)||pn["Arabic Presentation Forms-B"](Xl))));if(Pa.imageName){var zc=pa[Pa.imageName];if(!zc)continue;Uu=Pa.imageName,Kn.iconsInText=Kn.iconsInText||!0,Ol=zc.paddedRect;var Yl=zc.displaySize;Pa.scale=24*Pa.scale/$o,Pl=Ds+(24-Yl[1]*Pa.scale),Bc=(Po={width:Yl[0],height:Yl[1],left:1,top:-3,advance:wc?Yl[1]:Yl[0]}).advance;var jc=wc?Yl[0]*Pa.scale-24*ya:Yl[1]*Pa.scale-24*ya;jc>0&&jc>Fo&&(Fo=jc)}else{var Vf=Zi[Pa.fontStack],Uc=Vf&&Vf[mu];if(Uc&&Uc.rect)Ol=Uc.rect,Po=Uc.metrics;else{var hf=na[Pa.fontStack],Gf=hf&&hf[mu];if(!Gf)continue;Po=Gf.metrics}Pl=24*(ya-Pa.scale)}wc?(Kn.verticalizable=!0,eo.push({glyph:mu,imageName:Uu,x:Jo,y:Ms+Pl,vertical:wc,scale:Pa.scale,fontStack:Pa.fontStack,sectionIndex:Ml,metrics:Po,rect:Ol}),Jo+=Bc*Pa.scale+co):(eo.push({glyph:mu,imageName:Uu,x:Jo,y:Ms+Pl,vertical:wc,scale:Pa.scale,fontStack:Pa.fontStack,sectionIndex:Ml,metrics:Po,rect:Ol}),Jo+=Po.advance*Pa.scale+co)}eo.length!==0&&(ss=Math.max(Jo-co,ss),Pn(eo,0,eo.length-1,Mo,Fo)),Jo=0;var Hf=Ma*ya+Fo;bs.lineOffset=Math.max(Fo,Ds),Ms+=Hf,Ps=Math.max(Hf,Ps),++us}else Ms+=Ma,++us}var Xl,df=Ms- -17,Vc=Cn(lo),dc=Vc.horizontalAlign,Gc=Vc.verticalAlign;(function(Zf,Wf,pf,vf,Yf,mf,gf,yf,Xf){var Hc,Kf=(Wf-pf)*Yf;Hc=mf!==gf?-yf*vf- -17:(-vf*Xf+.5)*gf;for(var Zc=0,_f=Zf;Zc<_f.length;Zc+=1)for(var Ac=0,xf=_f[Zc].positionedGlyphs;Ac<xf.length;Ac+=1){var Wc=xf[Ac];Wc.x+=Kf,Wc.y+=Hc}})(Kn.positionedLines,Mo,dc,Gc,ss,Ps,Ma,df,si.length),Kn.top+=-Gc*df,Kn.bottom=Kn.top+df,Kn.left+=-dc*ss,Kn.right=Kn.left+ss}(Ai,t,r,l,kt,N,$,ce,Pe,_e,Be,bt),!function(Kn){for(var na=0,Zi=Kn;na<Zi.length;na+=1)if(Zi[na].positionedGlyphs.length!==0)return!1;return!0}(Ki)&&Ai}wr.fromFeature=function(e,t){for(var r=new wr,l=0;l<e.sections.length;l++){var p=e.sections[l];p.image?r.addImageSection(p):r.addTextSection(p,t)}return r},wr.prototype.length=function(){return this.text.length},wr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},wr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},wr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},wr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var l=e.charCodeAt(r+1)||null,p=e.charCodeAt(r-1)||null;t+=l&&io(l)&&!fc[e[r+1]]||p&&io(p)&&!fc[e[r-1]]||!fc[e[r]]?e[r]:fc[e[r]]}return t}(this.text)},wr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&jn[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,l=this.text.length-1;l>=0&&l>=e&&jn[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},wr.prototype.substring=function(e,t){var r=new wr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},wr.prototype.toString=function(){return this.text},wr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},wr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Qn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,l=0;l<e.text.length;++l)this.sectionIndex.push(r)},wr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Qn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):B("Reached maximum number of images 6401")}else B("Can't add FormattedSection with an empty image.")},wr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var jn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jr={};function Xr(e,t,r,l,p,b){if(t.imageName){var N=l[t.imageName];return N?N.displaySize[0]*t.scale*24/b+p:0}var $=r[t.fontStack],ce=$&&$[e];return ce?ce.metrics.advance*t.scale+p:0}function xn(e,t,r,l){var p=Math.pow(e-t,2);return l?e<t?p/2:2*p:p+Math.abs(r)*r}function Tn(e,t,r){var l=0;return e===10&&(l-=1e4),r&&(l+=150),e!==40&&e!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function ki(e,t,r,l,p,b){for(var N=null,$=xn(t,r,p,b),ce=0,_e=l;ce<_e.length;ce+=1){var Ce=_e[ce],Pe=xn(t-Ce.x,r,p,b)+Ce.badness;Pe<=$&&(N=Ce,$=Pe)}return{index:e,x:t,priorBreak:N,badness:$}}function Ti(e,t,r,l,p,b,N){if(b!=="point")return[];if(!e)return[];for(var $,ce=[],_e=function(kt,Tt,Ht,rr,_r,xr){for(var Rr=0,tn=0;tn<kt.length();tn++){var mn=kt.getSection(tn);Rr+=Xr(kt.getCharCode(tn),mn,rr,_r,Tt,xr)}return Rr/Math.max(1,Math.ceil(Rr/Ht))}(e,t,r,l,p,N),Ce=e.text.indexOf("\u200B")>=0,Pe=0,Be=0;Be<e.length();Be++){var He=e.getSection(Be),mt=e.getCharCode(Be);if(jn[mt]||(Pe+=Xr(mt,He,l,p,t,N)),Be<e.length()-1){var bt=!(($=mt)<11904||!(pn["Bopomofo Extended"]($)||pn.Bopomofo($)||pn["CJK Compatibility Forms"]($)||pn["CJK Compatibility Ideographs"]($)||pn["CJK Compatibility"]($)||pn["CJK Radicals Supplement"]($)||pn["CJK Strokes"]($)||pn["CJK Symbols and Punctuation"]($)||pn["CJK Unified Ideographs Extension A"]($)||pn["CJK Unified Ideographs"]($)||pn["Enclosed CJK Letters and Months"]($)||pn["Halfwidth and Fullwidth Forms"]($)||pn.Hiragana($)||pn["Ideographic Description Characters"]($)||pn["Kangxi Radicals"]($)||pn["Katakana Phonetic Extensions"]($)||pn.Katakana($)||pn["Vertical Forms"]($)||pn["Yi Radicals"]($)||pn["Yi Syllables"]($)));(Jr[mt]||bt||He.imageName)&&ce.push(ki(Be+1,Pe,_e,ce,Tn(mt,e.getCharCode(Be+1),bt&&Ce),!1))}}return function kt(Tt){return Tt?kt(Tt.priorBreak).concat(Tt.index):[]}(ki(e.length(),Pe,_e,ce,0,!0))}function Cn(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Pn(e,t,r,l,p){if(l||p)for(var b=e[r],N=(e[r].x+b.metrics.advance*b.scale)*l,$=t;$<=r;$++)e[$].x-=N,e[$].y+=p}function yi(e,t,r,l,p,b){var N,$=e.image;if($.content){var ce=$.content,_e=$.pixelRatio||1;N=[ce[0]/_e,ce[1]/_e,$.displaySize[0]-ce[2]/_e,$.displaySize[1]-ce[3]/_e]}var Ce,Pe,Be,He,mt=t.left*b,bt=t.right*b;r==="width"||r==="both"?(He=p[0]+mt-l[3],Pe=p[0]+bt+l[1]):Pe=(He=p[0]+(mt+bt-$.displaySize[0])/2)+$.displaySize[0];var kt=t.top*b,Tt=t.bottom*b;return r==="height"||r==="both"?(Ce=p[1]+kt-l[0],Be=p[1]+Tt+l[2]):Be=(Ce=p[1]+(kt+Tt-$.displaySize[1])/2)+$.displaySize[1],{image:$,top:Ce,right:Pe,bottom:Be,left:He,collisionPadding:N}}Jr[10]=!0,Jr[32]=!0,Jr[38]=!0,Jr[40]=!0,Jr[41]=!0,Jr[43]=!0,Jr[45]=!0,Jr[47]=!0,Jr[173]=!0,Jr[183]=!0,Jr[8203]=!0,Jr[8208]=!0,Jr[8211]=!0,Jr[8231]=!0;var wi=function(e){function t(r,l,p,b){e.call(this,r,l),this.angle=p,b!==void 0&&(this.segment=b)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(L);function $i(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new nr(e+1))};if(r.kind==="source")return{kind:"source"};for(var l=r.zoomStops,p=r.interpolationType,b=0;b<l.length&&l[b]<=e;)b++;for(var N=b=Math.max(0,b-1);N<l.length&&l[N]<e+1;)N++;N=Math.min(l.length-1,N);var $=l[b],ce=l[N];return r.kind==="composite"?{kind:"composite",minZoom:$,maxZoom:ce,interpolationType:p}:{kind:"camera",minZoom:$,maxZoom:ce,minSize:r.evaluate(new nr($)),maxSize:r.evaluate(new nr(ce)),interpolationType:p}}function uo(e,t,r){var l=t.uSize,p=r.lowerSize;return e.kind==="source"?p/128:e.kind==="composite"?Mr(p/128,r.upperSize/128,t.uSizeT):l}function po(e,t){var r=0,l=0;if(e.kind==="constant")l=e.layoutSize;else if(e.kind!=="source"){var p=e.interpolationType,b=p?j(et.interpolationFactor(p,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?l=Mr(e.minSize,e.maxSize,b):r=b}return{uSizeT:r,uSize:l}}Sn("Anchor",wi);var ra=Object.freeze({__proto__:null,getSizeData:$i,evaluateSizeForFeature:uo,evaluateSizeForZoom:po,SIZE_PACK_FACTOR:128});function Yo(e,t,r,l,p){if(t.segment===void 0)return!0;for(var b=t,N=t.segment+1,$=0;$>-r/2;){if(--N<0)return!1;$-=e[N].dist(b),b=e[N]}$+=e[N].dist(e[N+1]),N++;for(var ce=[],_e=0;$<r/2;){var Ce=e[N],Pe=e[N+1];if(!Pe)return!1;var Be=e[N-1].angleTo(Ce)-Ce.angleTo(Pe);for(Be=Math.abs((Be+3*Math.PI)%(2*Math.PI)-Math.PI),ce.push({distance:$,angleDelta:Be}),_e+=Be;$-ce[0].distance>l;)_e-=ce.shift().angleDelta;if(_e>p)return!1;N++,$+=Ce.dist(Pe)}return!0}function Ya(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Do(e,t,r){return e?.6*t*r:0}function xo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Xo(e,t,r,l,p,b){for(var N=Do(r,p,b),$=xo(r,l)*b,ce=0,_e=Ya(e)/2,Ce=0;Ce<e.length-1;Ce++){var Pe=e[Ce],Be=e[Ce+1],He=Pe.dist(Be);if(ce+He>_e){var mt=(_e-ce)/He,bt=Mr(Pe.x,Be.x,mt),kt=Mr(Pe.y,Be.y,mt),Tt=new wi(bt,kt,Be.angleTo(Pe),Ce);return Tt._round(),!N||Yo(e,Tt,$,N,t)?Tt:void 0}ce+=He}}function is(e,t,r,l,p,b,N,$,ce){var _e=Do(l,b,N),Ce=xo(l,p),Pe=Ce*N,Be=e[0].x===0||e[0].x===ce||e[0].y===0||e[0].y===ce;return t-Pe<t/4&&(t=Pe+t/4),function He(mt,bt,kt,Tt,Ht,rr,_r,xr,Rr){for(var tn=rr/2,mn=Ya(mt),qn=0,In=bt-kt,ai=[],Fn=0;Fn<mt.length-1;Fn++){for(var Ki=mt[Fn],Ai=mt[Fn+1],Kn=Ki.dist(Ai),na=Ai.angleTo(Ki);In+kt<qn+Kn;){var Zi=((In+=kt)-qn)/Kn,pa=Mr(Ki.x,Ai.x,Zi),si=Mr(Ki.y,Ai.y,Zi);if(pa>=0&&pa<Rr&&si>=0&&si<Rr&&In-tn>=0&&In+tn<=mn){var Ma=new wi(pa,si,na,Fn);Ma._round(),Tt&&!Yo(mt,Ma,rr,Tt,Ht)||ai.push(Ma)}}qn+=Kn}return xr||ai.length||_r||(ai=He(mt,qn/2,kt,Tt,Ht,rr,_r,!0,Rr)),ai}(e,Be?t/2*$%t:(Ce/2+2*b)*N*$%t,t,_e,r,Pe,Be,!1,ce)}function as(e,t,r,l,p){for(var b=[],N=0;N<e.length;N++)for(var $=e[N],ce=void 0,_e=0;_e<$.length-1;_e++){var Ce=$[_e],Pe=$[_e+1];Ce.x<t&&Pe.x<t||(Ce.x<t?Ce=new L(t,Ce.y+(t-Ce.x)/(Pe.x-Ce.x)*(Pe.y-Ce.y))._round():Pe.x<t&&(Pe=new L(t,Ce.y+(t-Ce.x)/(Pe.x-Ce.x)*(Pe.y-Ce.y))._round()),Ce.y<r&&Pe.y<r||(Ce.y<r?Ce=new L(Ce.x+(r-Ce.y)/(Pe.y-Ce.y)*(Pe.x-Ce.x),r)._round():Pe.y<r&&(Pe=new L(Ce.x+(r-Ce.y)/(Pe.y-Ce.y)*(Pe.x-Ce.x),r)._round()),Ce.x>=l&&Pe.x>=l||(Ce.x>=l?Ce=new L(l,Ce.y+(l-Ce.x)/(Pe.x-Ce.x)*(Pe.y-Ce.y))._round():Pe.x>=l&&(Pe=new L(l,Ce.y+(l-Ce.x)/(Pe.x-Ce.x)*(Pe.y-Ce.y))._round()),Ce.y>=p&&Pe.y>=p||(Ce.y>=p?Ce=new L(Ce.x+(p-Ce.y)/(Pe.y-Ce.y)*(Pe.x-Ce.x),p)._round():Pe.y>=p&&(Pe=new L(Ce.x+(p-Ce.y)/(Pe.y-Ce.y)*(Pe.x-Ce.x),p)._round()),ce&&Ce.equals(ce[ce.length-1])||b.push(ce=[Ce]),ce.push(Pe)))))}return b}function bo(e,t,r,l){var p=[],b=e.image,N=b.pixelRatio,$=b.paddedRect.w-2,ce=b.paddedRect.h-2,_e=e.right-e.left,Ce=e.bottom-e.top,Pe=b.stretchX||[[0,$]],Be=b.stretchY||[[0,ce]],He=function(pa,si){return pa+si[1]-si[0]},mt=Pe.reduce(He,0),bt=Be.reduce(He,0),kt=$-mt,Tt=ce-bt,Ht=0,rr=mt,_r=0,xr=bt,Rr=0,tn=kt,mn=0,qn=Tt;if(b.content&&l){var In=b.content;Ht=zi(Pe,0,In[0]),_r=zi(Be,0,In[1]),rr=zi(Pe,In[0],In[2]),xr=zi(Be,In[1],In[3]),Rr=In[0]-Ht,mn=In[1]-_r,tn=In[2]-In[0]-rr,qn=In[3]-In[1]-xr}var ai=function(pa,si,Ma,lo){var So=Sa(pa.stretch-Ht,rr,_e,e.left),mo=Ao(pa.fixed-Rr,tn,pa.stretch,mt),co=Sa(si.stretch-_r,xr,Ce,e.top),Eo=Ao(si.fixed-mn,qn,si.stretch,bt),$o=Sa(Ma.stretch-Ht,rr,_e,e.left),Jo=Ao(Ma.fixed-Rr,tn,Ma.stretch,mt),Ms=Sa(lo.stretch-_r,xr,Ce,e.top),ss=Ao(lo.fixed-mn,qn,lo.stretch,bt),Ps=new L(So,co),Mo=new L($o,co),us=new L($o,Ms),ca=new L(So,Ms),Za=new L(mo/N,Eo/N),za=new L(Jo/N,ss/N),ya=t*Math.PI/180;if(ya){var Ds=Math.sin(ya),bs=Math.cos(ya),eo=[bs,-Ds,Ds,bs];Ps._matMult(eo),Mo._matMult(eo),ca._matMult(eo),us._matMult(eo)}var Fo=pa.stretch+pa.fixed,Ss=si.stretch+si.fixed;return{tl:Ps,tr:Mo,bl:ca,br:us,tex:{x:b.paddedRect.x+1+Fo,y:b.paddedRect.y+1+Ss,w:Ma.stretch+Ma.fixed-Fo,h:lo.stretch+lo.fixed-Ss},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Za,pixelOffsetBR:za,minFontScaleX:tn/N/_e,minFontScaleY:qn/N/Ce,isSDF:r}};if(l&&(b.stretchX||b.stretchY))for(var Fn=Ko(Pe,kt,mt),Ki=Ko(Be,Tt,bt),Ai=0;Ai<Fn.length-1;Ai++)for(var Kn=Fn[Ai],na=Fn[Ai+1],Zi=0;Zi<Ki.length-1;Zi++)p.push(ai(Kn,Ki[Zi],na,Ki[Zi+1]));else p.push(ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:$+1},{fixed:0,stretch:ce+1}));return p}function zi(e,t,r){for(var l=0,p=0,b=e;p<b.length;p+=1){var N=b[p];l+=Math.max(t,Math.min(r,N[1]))-Math.max(t,Math.min(r,N[0]))}return l}function Ko(e,t,r){for(var l=[{fixed:-1,stretch:0}],p=0,b=e;p<b.length;p+=1){var N=b[p],$=N[0],ce=N[1],_e=l[l.length-1];l.push({fixed:$-_e.stretch,stretch:_e.stretch}),l.push({fixed:$-_e.stretch,stretch:_e.stretch+(ce-$)})}return l.push({fixed:t+1,stretch:r}),l}function Sa(e,t,r,l){return e/t*r+l}function Ao(e,t,r,l){return e-t*r/l}var vi=function(e,t,r,l,p,b,N,$,ce,_e){if(this.boxStartIndex=e.length,ce){var Ce=b.top,Pe=b.bottom,Be=b.collisionPadding;Be&&(Ce-=Be[1],Pe+=Be[3]);var He=Pe-Ce;He>0&&(He=Math.max(10,He),this.circleDiameter=He)}else{var mt=b.top*N-$,bt=b.bottom*N+$,kt=b.left*N-$,Tt=b.right*N+$,Ht=b.collisionPadding;if(Ht&&(kt-=Ht[0]*N,mt-=Ht[1]*N,Tt+=Ht[2]*N,bt+=Ht[3]*N),_e){var rr=new L(kt,mt),_r=new L(Tt,mt),xr=new L(kt,bt),Rr=new L(Tt,bt),tn=_e*Math.PI/180;rr._rotate(tn),_r._rotate(tn),xr._rotate(tn),Rr._rotate(tn),kt=Math.min(rr.x,_r.x,xr.x,Rr.x),Tt=Math.max(rr.x,_r.x,xr.x,Rr.x),mt=Math.min(rr.y,_r.y,xr.y,Rr.y),bt=Math.max(rr.y,_r.y,xr.y,Rr.y)}e.emplaceBack(t.x,t.y,kt,mt,Tt,bt,r,l,p)}this.boxEndIndex=e.length},Hi=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Va),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Va(e,t){return e<t?-1:e>t?1:0}function ko(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var l=1/0,p=1/0,b=-1/0,N=-1/0,$=e[0],ce=0;ce<$.length;ce++){var _e=$[ce];(!ce||_e.x<l)&&(l=_e.x),(!ce||_e.y<p)&&(p=_e.y),(!ce||_e.x>b)&&(b=_e.x),(!ce||_e.y>N)&&(N=_e.y)}var Ce=Math.min(b-l,N-p),Pe=Ce/2,Be=new Hi([],sl);if(Ce===0)return new L(l,p);for(var He=l;He<b;He+=Ce)for(var mt=p;mt<N;mt+=Ce)Be.push(new dt(He+Pe,mt+Pe,Pe,e));for(var bt=function(Ht){for(var rr=0,_r=0,xr=0,Rr=Ht[0],tn=0,mn=Rr.length,qn=mn-1;tn<mn;qn=tn++){var In=Rr[tn],ai=Rr[qn],Fn=In.x*ai.y-ai.x*In.y;_r+=(In.x+ai.x)*Fn,xr+=(In.y+ai.y)*Fn,rr+=3*Fn}return new dt(_r/rr,xr/rr,0,Ht)}(e),kt=Be.length;Be.length;){var Tt=Be.pop();(Tt.d>bt.d||!bt.d)&&(bt=Tt,r&&console.log("found best %d after %d probes",Math.round(1e4*Tt.d)/1e4,kt)),Tt.max-bt.d<=t||(Be.push(new dt(Tt.p.x-(Pe=Tt.h/2),Tt.p.y-Pe,Pe,e)),Be.push(new dt(Tt.p.x+Pe,Tt.p.y-Pe,Pe,e)),Be.push(new dt(Tt.p.x-Pe,Tt.p.y+Pe,Pe,e)),Be.push(new dt(Tt.p.x+Pe,Tt.p.y+Pe,Pe,e)),kt+=4)}return r&&(console.log("num probes: "+kt),console.log("best distance: "+bt.d)),bt.p}function sl(e,t){return t.max-e.max}function dt(e,t,r,l){this.p=new L(e,t),this.h=r,this.d=function(p,b){for(var N=!1,$=1/0,ce=0;ce<b.length;ce++)for(var _e=b[ce],Ce=0,Pe=_e.length,Be=Pe-1;Ce<Pe;Be=Ce++){var He=_e[Ce],mt=_e[Be];He.y>p.y!=mt.y>p.y&&p.x<(mt.x-He.x)*(p.y-He.y)/(mt.y-He.y)+He.x&&(N=!N),$=Math.min($,Fu(p,He,mt))}return(N?1:-1)*Math.sqrt($)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}Hi.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Hi.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Hi.prototype.peek=function(){return this.data[0]},Hi.prototype._up=function(e){for(var t=this.data,r=this.compare,l=t[e];e>0;){var p=e-1>>1,b=t[p];if(r(l,b)>=0)break;t[e]=b,e=p}t[e]=l},Hi.prototype._down=function(e){for(var t=this.data,r=this.compare,l=this.length>>1,p=t[e];e<l;){var b=1+(e<<1),N=t[b],$=b+1;if($<this.length&&r(t[$],N)<0&&(b=$,N=t[$]),r(N,p)>=0)break;t[e]=N,e=b}t[e]=p};var vr=Number.POSITIVE_INFINITY;function sr(e,t){return t[1]!==vr?function(r,l,p){var b=0,N=0;switch(l=Math.abs(l),p=Math.abs(p),r){case"top-right":case"top-left":case"top":N=p-7;break;case"bottom-right":case"bottom-left":case"bottom":N=7-p}switch(r){case"top-right":case"bottom-right":case"right":b=-l;break;case"top-left":case"bottom-left":case"left":b=l}return[b,N]}(e,t[0],t[1]):function(r,l){var p=0,b=0;l<0&&(l=0);var N=l/Math.sqrt(2);switch(r){case"top-right":case"top-left":b=N-7;break;case"bottom-right":case"bottom-left":b=7-N;break;case"bottom":b=7-l;break;case"top":b=l-7}switch(r){case"top-right":case"bottom-right":p=-N;break;case"top-left":case"bottom-left":p=N;break;case"left":p=l;break;case"right":p=-l}return[p,b]}(e,t[0])}function On(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ea(e,t,r,l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt){var bt=function(_r,xr,Rr,tn,mn,qn,In,ai){for(var Fn=tn.layout.get("text-rotate").evaluate(qn,{})*Math.PI/180,Ki=[],Ai=0,Kn=xr.positionedLines;Ai<Kn.length;Ai+=1)for(var na=Kn[Ai],Zi=0,pa=na.positionedGlyphs;Zi<pa.length;Zi+=1){var si=pa[Zi];if(si.rect){var Ma=si.rect||{},lo=4,So=!0,mo=1,co=0,Eo=(mn||ai)&&si.vertical,$o=si.metrics.advance*si.scale/2;if(ai&&xr.verticalizable&&(co=na.lineOffset/2-(si.imageName?-(24-si.metrics.width*si.scale)/2:24*(si.scale-1))),si.imageName){var Jo=In[si.imageName];So=Jo.sdf,lo=1/(mo=Jo.pixelRatio)}var Ms=mn?[si.x+$o,si.y]:[0,0],ss=mn?[0,0]:[si.x+$o+Rr[0],si.y+Rr[1]-co],Ps=[0,0];Eo&&(Ps=ss,ss=[0,0]);var Mo=(si.metrics.left-lo)*si.scale-$o+ss[0],us=(-si.metrics.top-lo)*si.scale+ss[1],ca=Mo+Ma.w*si.scale/mo,Za=us+Ma.h*si.scale/mo,za=new L(Mo,us),ya=new L(ca,us),Ds=new L(Mo,Za),bs=new L(ca,Za);if(Eo){var eo=new L(-$o,$o- -17),Fo=-Math.PI/2,Ss=12-$o,Pa=new L(22-Ss,-(si.imageName?Ss:0)),Ml=new(Function.prototype.bind.apply(L,[null].concat(Ps)));za._rotateAround(Fo,eo)._add(Pa)._add(Ml),ya._rotateAround(Fo,eo)._add(Pa)._add(Ml),Ds._rotateAround(Fo,eo)._add(Pa)._add(Ml),bs._rotateAround(Fo,eo)._add(Pa)._add(Ml)}if(Fn){var mu=Math.sin(Fn),Pl=Math.cos(Fn),Po=[Pl,-mu,mu,Pl];za._matMult(Po),ya._matMult(Po),Ds._matMult(Po),bs._matMult(Po)}var Ol=new L(0,0),Uu=new L(0,0);Ki.push({tl:za,tr:ya,bl:Ds,br:bs,tex:Ma,writingMode:xr.writingMode,glyphOffset:Ms,sectionIndex:si.sectionIndex,isSDF:So,pixelOffsetTL:Ol,pixelOffsetBR:Uu,minFontScaleX:0,minFontScaleY:0})}}return Ki}(0,r,$,p,b,N,l,e.allowVerticalPlacement),kt=e.textSizeData,Tt=null;kt.kind==="source"?(Tt=[128*p.layout.get("text-size").evaluate(N,{})])[0]>32640&&B(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):kt.kind==="composite"&&((Tt=[128*He.compositeTextSizes[0].evaluate(N,{},mt),128*He.compositeTextSizes[1].evaluate(N,{},mt)])[0]>32640||Tt[1]>32640)&&B(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,bt,Tt,$,b,N,_e,t,ce.lineStartIndex,ce.lineLength,Be,mt);for(var Ht=0,rr=Ce;Ht<rr.length;Ht+=1)Pe[rr[Ht]]=e.text.placedSymbolArray.length-1;return 4*bt.length}function at(e){for(var t in e)return e[t];return null}function Ze(e,t,r,l){var p=e.compareText;if(t in p){for(var b=p[t],N=b.length-1;N>=0;N--)if(l.dist(b[N])<r)return!0}else p[t]=[];return p[t].push(l),!1}var It=Hl.VectorTileFeature.types,Jt=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fr(e,t,r,l,p,b,N,$,ce,_e,Ce,Pe,Be){var He=$?Math.min(32640,Math.round($[0])):0,mt=$?Math.min(32640,Math.round($[1])):0;e.emplaceBack(t,r,Math.round(32*l),Math.round(32*p),b,N,(He<<1)+(ce?1:0),mt,16*_e,16*Ce,256*Pe,256*Be)}function Ft(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function Dt(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Rs(r[t].text))return!0;return!1}var zt=function(e){this.layoutVertexArray=new Bs,this.indexArray=new lu,this.programConfigurations=e,this.segments=new Xe,this.dynamicLayoutVertexArray=new Go,this.opacityVertexArray=new el,this.placedSymbolArray=new f};zt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},zt.prototype.upload=function(e,t,r,l){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jt,!0),this.opacityVertexBuffer.itemSize=1),(r||l)&&this.programConfigurations.upload(e))},zt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Sn("SymbolBuffers",zt);var qe=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new Xe,this.collisionVertexArray=new zl};qe.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mh.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Sn("CollisionBuffers",qe);var St=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rs([]),this.placementViewportMatrix=rs([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$i(this.zoom,t["text-size"]),this.iconSizeData=$i(this.zoom,t["icon-size"]);var r=this.layers[0].layout,l=r.get("symbol-sort-key"),p=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(b){return on[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=e.sourceID};St.prototype.createArrays=function(){this.text=new zt(new li(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new zt(new li(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new K,this.lineVertexArray=new ue,this.symbolInstances=new W},St.prototype.calculateGlyphDependencies=function(e,t,r,l,p){for(var b=0;b<e.length;b++)if(t[e.charCodeAt(b)]=!0,(r||l)&&p){var N=fc[e.charAt(b)];N&&(t[N.charCodeAt(0)]=!0)}},St.prototype.populate=function(e,t,r){var l=this.layers[0],p=l.layout,b=p.get("text-font"),N=p.get("text-field"),$=p.get("icon-image"),ce=(N.value.kind!=="constant"||N.value.value instanceof Ta&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),_e=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,Ce=p.get("symbol-sort-key");if(this.features=[],ce||_e){for(var Pe=t.iconDependencies,Be=t.glyphDependencies,He=t.availableImages,mt=new nr(this.zoom),bt=0,kt=e;bt<kt.length;bt+=1){var Tt=kt[bt],Ht=Tt.feature,rr=Tt.id,_r=Tt.index,xr=Tt.sourceLayerIndex,Rr=l._featureFilter.needGeometry,tn=so(Ht,Rr);if(l._featureFilter.filter(mt,tn,r)){Rr||(tn.geometry=qa(Ht));var mn=void 0;if(ce){var qn=l.getValueAndResolveTokens("text-field",tn,r,He),In=Ta.factory(qn);Dt(In)&&(this.hasRTLText=!0),(!this.hasRTLText||cr()==="unavailable"||this.hasRTLText&&hr.isParsed())&&(mn=yh(In,l,tn))}var ai=void 0;if(_e){var Fn=l.getValueAndResolveTokens("icon-image",tn,r,He);ai=Fn instanceof ma?Fn:ma.fromString(Fn)}if(mn||ai){var Ki=this.sortFeaturesByKey?Ce.evaluate(tn,{},r):void 0;if(this.features.push({id:rr,text:mn,icon:ai,index:_r,sourceLayerIndex:xr,geometry:tn.geometry,properties:Ht.properties,type:It[Ht.type],sortKey:Ki}),ai&&(Pe[ai.name]=!0),mn){var Ai=b.evaluate(tn,{},r).join(","),Kn=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(on.vertical)>=0;for(var na=0,Zi=mn.sections;na<Zi.length;na+=1){var pa=Zi[na];if(pa.image)Pe[pa.image.name]=!0;else{var si=Nl(mn.toString()),Ma=pa.fontStack||Ai,lo=Be[Ma]=Be[Ma]||{};this.calculateGlyphDependencies(pa.text,lo,Kn,this.allowVerticalPlacement,si)}}}}}}p.get("symbol-placement")==="line"&&(this.features=function(So){var mo={},co={},Eo=[],$o=0;function Jo(eo){Eo.push(So[eo]),$o++}function Ms(eo,Fo,Ss){var Pa=co[eo];return delete co[eo],co[Fo]=Pa,Eo[Pa].geometry[0].pop(),Eo[Pa].geometry[0]=Eo[Pa].geometry[0].concat(Ss[0]),Pa}function ss(eo,Fo,Ss){var Pa=mo[Fo];return delete mo[Fo],mo[eo]=Pa,Eo[Pa].geometry[0].shift(),Eo[Pa].geometry[0]=Ss[0].concat(Eo[Pa].geometry[0]),Pa}function Ps(eo,Fo,Ss){var Pa=Ss?Fo[0][Fo[0].length-1]:Fo[0][0];return eo+":"+Pa.x+":"+Pa.y}for(var Mo=0;Mo<So.length;Mo++){var us=So[Mo],ca=us.geometry,Za=us.text?us.text.toString():null;if(Za){var za=Ps(Za,ca),ya=Ps(Za,ca,!0);if(za in co&&ya in mo&&co[za]!==mo[ya]){var Ds=ss(za,ya,ca),bs=Ms(za,ya,Eo[Ds].geometry);delete mo[za],delete co[ya],co[Ps(Za,Eo[bs].geometry,!0)]=bs,Eo[Ds].geometry=null}else za in co?Ms(za,ya,ca):ya in mo?ss(za,ya,ca):(Jo(Mo),mo[za]=$o-1,co[ya]=$o-1)}else Jo(Mo)}return Eo.filter(function(eo){return eo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(So,mo){return So.sortKey-mo.sortKey})}},St.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},St.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},St.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},St.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},St.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},St.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},St.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var l=e.dist(t[e.segment+1]),p=e.dist(t[e.segment]),b={},N=e.segment+1;N<t.length;N++)b[N]={x:t[N].x,y:t[N].y,tileUnitDistanceFromAnchor:l},N<t.length-1&&(l+=t[N+1].dist(t[N]));for(var $=e.segment||0;$>=0;$--)b[$]={x:t[$].x,y:t[$].y,tileUnitDistanceFromAnchor:p},$>0&&(p+=t[$-1].dist(t[$]));for(var ce=0;ce<t.length;ce++){var _e=b[ce];this.lineVertexArray.emplaceBack(_e.x,_e.y,_e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},St.prototype.addSymbols=function(e,t,r,l,p,b,N,$,ce,_e,Ce,Pe){for(var Be=e.indexArray,He=e.layoutVertexArray,mt=e.segments.prepareSegment(4*t.length,He,Be,this.canOverlap?b.sortKey:void 0),bt=this.glyphOffsetArray.length,kt=mt.vertexLength,Tt=this.allowVerticalPlacement&&N===on.vertical?Math.PI/2:0,Ht=b.text&&b.text.sections,rr=0;rr<t.length;rr++){var _r=t[rr],xr=_r.tl,Rr=_r.tr,tn=_r.bl,mn=_r.br,qn=_r.tex,In=_r.pixelOffsetTL,ai=_r.pixelOffsetBR,Fn=_r.minFontScaleX,Ki=_r.minFontScaleY,Ai=_r.glyphOffset,Kn=_r.isSDF,na=_r.sectionIndex,Zi=mt.vertexLength,pa=Ai[1];fr(He,$.x,$.y,xr.x,pa+xr.y,qn.x,qn.y,r,Kn,In.x,In.y,Fn,Ki),fr(He,$.x,$.y,Rr.x,pa+Rr.y,qn.x+qn.w,qn.y,r,Kn,ai.x,In.y,Fn,Ki),fr(He,$.x,$.y,tn.x,pa+tn.y,qn.x,qn.y+qn.h,r,Kn,In.x,ai.y,Fn,Ki),fr(He,$.x,$.y,mn.x,pa+mn.y,qn.x+qn.w,qn.y+qn.h,r,Kn,ai.x,ai.y,Fn,Ki),Ft(e.dynamicLayoutVertexArray,$,Tt),Be.emplaceBack(Zi,Zi+1,Zi+2),Be.emplaceBack(Zi+1,Zi+2,Zi+3),mt.vertexLength+=4,mt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ai[0]),rr!==t.length-1&&na===t[rr+1].sectionIndex||e.programConfigurations.populatePaintArrays(He.length,b,b.index,{},Pe,Ht&&Ht[na])}e.placedSymbolArray.emplaceBack($.x,$.y,bt,this.glyphOffsetArray.length-bt,kt,ce,_e,$.segment,r?r[0]:0,r?r[1]:0,l[0],l[1],N,0,!1,0,Ce)},St.prototype._addCollisionDebugVertex=function(e,t,r,l,p,b){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,l,p,Math.round(b.x),Math.round(b.y))},St.prototype.addCollisionDebugVertices=function(e,t,r,l,p,b,N){var $=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),ce=$.vertexLength,_e=p.layoutVertexArray,Ce=p.collisionVertexArray,Pe=N.anchorX,Be=N.anchorY;this._addCollisionDebugVertex(_e,Ce,b,Pe,Be,new L(e,t)),this._addCollisionDebugVertex(_e,Ce,b,Pe,Be,new L(r,t)),this._addCollisionDebugVertex(_e,Ce,b,Pe,Be,new L(r,l)),this._addCollisionDebugVertex(_e,Ce,b,Pe,Be,new L(e,l)),$.vertexLength+=4;var He=p.indexArray;He.emplaceBack(ce,ce+1),He.emplaceBack(ce+1,ce+2),He.emplaceBack(ce+2,ce+3),He.emplaceBack(ce+3,ce),$.primitiveLength+=4},St.prototype.addDebugCollisionBoxes=function(e,t,r,l){for(var p=e;p<t;p++){var b=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,l?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,r)}},St.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(ku,zf.members,la),this.iconCollisionBox=new qe(ku,zf.members,la);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},St.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,l,p,b,N,$,ce){for(var _e={},Ce=t;Ce<r;Ce++){var Pe=e.get(Ce);_e.textBox={x1:Pe.x1,y1:Pe.y1,x2:Pe.x2,y2:Pe.y2,anchorPointX:Pe.anchorPointX,anchorPointY:Pe.anchorPointY},_e.textFeatureIndex=Pe.featureIndex;break}for(var Be=l;Be<p;Be++){var He=e.get(Be);_e.verticalTextBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},_e.verticalTextFeatureIndex=He.featureIndex;break}for(var mt=b;mt<N;mt++){var bt=e.get(mt);_e.iconBox={x1:bt.x1,y1:bt.y1,x2:bt.x2,y2:bt.y2,anchorPointX:bt.anchorPointX,anchorPointY:bt.anchorPointY},_e.iconFeatureIndex=bt.featureIndex;break}for(var kt=$;kt<ce;kt++){var Tt=e.get(kt);_e.verticalIconBox={x1:Tt.x1,y1:Tt.y1,x2:Tt.x2,y2:Tt.y2,anchorPointX:Tt.anchorPointX,anchorPointY:Tt.anchorPointY},_e.verticalIconFeatureIndex=Tt.featureIndex;break}return _e},St.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},St.prototype.hasTextData=function(){return this.text.segments.get().length>0},St.prototype.hasIconData=function(){return this.icon.segments.get().length>0},St.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},St.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},St.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},St.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),l=r.vertexStartIndex+4*r.numGlyphs,p=r.vertexStartIndex;p<l;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)},St.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),l=[],p=[],b=[],N=0;N<this.symbolInstances.length;++N){b.push(N);var $=this.symbolInstances.get(N);l.push(0|Math.round(t*$.anchorX+r*$.anchorY)),p.push($.featureIndex)}return b.sort(function(ce,_e){return l[ce]-l[_e]||p[_e]-p[ce]}),b},St.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},St.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,l=this.symbolInstanceIndexes;r<l.length;r+=1){var p=this.symbolInstances.get(l[r]);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(function(b,N,$){b>=0&&$.indexOf(b)===N&&t.addIndicesForPlacedSymbol(t.text,b)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Sn("SymbolBucket",St,{omit:["layers","collisionBoxArray","features","compareText"]}),St.MAX_GLYPHS=65535,St.addDynamicAttributes=Ft;var lt=new xa({"symbol-placement":new gn(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new gn(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gn(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gn(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gn(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gn(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new gn(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gn(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Ye.layout_symbol["icon-size"]),"icon-text-fit":new gn(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gn(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Ye.layout_symbol["icon-image"]),"icon-rotate":new yn(Ye.layout_symbol["icon-rotate"]),"icon-padding":new gn(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new gn(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Ye.layout_symbol["icon-offset"]),"icon-anchor":new yn(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gn(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gn(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gn(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Ye.layout_symbol["text-field"]),"text-font":new yn(Ye.layout_symbol["text-font"]),"text-size":new yn(Ye.layout_symbol["text-size"]),"text-max-width":new yn(Ye.layout_symbol["text-max-width"]),"text-line-height":new gn(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Ye.layout_symbol["text-justify"]),"text-radial-offset":new yn(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gn(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new yn(Ye.layout_symbol["text-anchor"]),"text-max-angle":new gn(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new gn(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Ye.layout_symbol["text-rotate"]),"text-padding":new gn(Ye.layout_symbol["text-padding"]),"text-keep-upright":new gn(Ye.layout_symbol["text-keep-upright"]),"text-transform":new yn(Ye.layout_symbol["text-transform"]),"text-offset":new yn(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new gn(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gn(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new gn(Ye.layout_symbol["text-optional"])}),Yt={paint:new xa({"icon-opacity":new yn(Ye.paint_symbol["icon-opacity"]),"icon-color":new yn(Ye.paint_symbol["icon-color"]),"icon-halo-color":new yn(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new gn(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new gn(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(Ye.paint_symbol["text-opacity"]),"text-color":new yn(Ye.paint_symbol["text-color"],{runtimeType:sn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new yn(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Ye.paint_symbol["text-halo-blur"]),"text-translate":new gn(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new gn(Ye.paint_symbol["text-translate-anchor"])}),layout:lt},tr=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e};tr.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},tr.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},tr.prototype.outputDefined=function(){return!1},tr.prototype.serialize=function(){return null},Sn("FormatSectionOverride",tr,{omit:["defaultValue"]});var jr=function(e){function t(r){e.call(this,r,Yt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,l){if(e.prototype.recalculate.call(this,r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var p=this.layout.get("text-writing-mode");if(p){for(var b=[],N=0,$=p;N<$.length;N+=1){var ce=$[N];b.indexOf(ce)<0&&b.push(ce)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,l,p,b){var N=this.layout.get(r).evaluate(l,{},p,b),$=this._unevaluatedLayout._values[r];return $.isDataDriven()||eu($.value)||!N?N:function(ce,_e){return _e.replace(/{([^{}]+)}/g,function(Ce,Pe){return Pe in ce?String(ce[Pe]):""})}(l.properties,N)},t.prototype.createBucket=function(r){return new St(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,l=Yt.paint.overridableProperties;r<l.length;r+=1){var p=l[r];if(t.hasPaintOverride(this.layout,p)){var b,N=this.paint.get(p),$=new tr(N),ce=new qs($,N.property.specification);b=N.value.kind==="constant"||N.value.kind==="source"?new tu("source",ce):new Is("composite",ce,N.value.zoomStops,N.value._interpolationType),this.paint._values[p]=new ta(N.property,b,N.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,l){var p=r.get("text-field"),b=Yt.paint.properties[l],N=!1,$=function(Ce){for(var Pe=0,Be=Ce;Pe<Be.length;Pe+=1)if(b.overrides&&b.overrides.hasOverride(Be[Pe]))return void(N=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ta)$(p.value.value.sections);else if(p.value.kind==="source"){var ce=function(Ce){N||(Ce instanceof _a&&sa(Ce.value)===Ui?$(Ce.value.sections):Ce instanceof Ja?$(Ce.sections):Ce.eachChild(ce))},_e=p.value;_e._styleExpression&&ce(_e._styleExpression.expression)}return N},t}(ao),hn={paint:new xa({"background-color":new gn(Ye.paint_background["background-color"]),"background-pattern":new ga(Ye.paint_background["background-pattern"]),"background-opacity":new gn(Ye.paint_background["background-opacity"])})},dn=function(e){function t(r){e.call(this,r,hn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ao),wn={paint:new xa({"raster-opacity":new gn(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new gn(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gn(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gn(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new gn(Ye.paint_raster["raster-saturation"]),"raster-contrast":new gn(Ye.paint_raster["raster-contrast"]),"raster-resampling":new gn(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new gn(Ye.paint_raster["raster-fade-duration"])})},cn=function(e){function t(r){e.call(this,r,wn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ao),Yn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(ao),kn={circle:nl,heatmap:Jc,hillshade:nc,fill:Sc,"fill-extrusion":wl,line:ph,symbol:jr,background:dn,raster:cn},Vn=E.HTMLImageElement,Gn=E.HTMLCanvasElement,Hn=E.HTMLVideoElement,_i=E.ImageData,Ba=E.ImageBitmap,vo=function(e,t,r,l){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,l)};vo.prototype.update=function(e,t,r){var l=e.width,p=e.height,b=!(this.size&&this.size[0]===l&&this.size[1]===p||r),N=this.context,$=N.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),$.bindTexture($.TEXTURE_2D,this.texture),N.pixelStoreUnpackFlipY.set(!1),N.pixelStoreUnpack.set(1),N.pixelStoreUnpackPremultiplyAlpha.set(this.format===$.RGBA&&(!t||t.premultiply!==!1)),b)this.size=[l,p],e instanceof Vn||e instanceof Gn||e instanceof Hn||e instanceof _i||Ba&&e instanceof Ba?$.texImage2D($.TEXTURE_2D,0,this.format,this.format,$.UNSIGNED_BYTE,e):$.texImage2D($.TEXTURE_2D,0,this.format,l,p,0,this.format,$.UNSIGNED_BYTE,e.data);else{var ce=r||{x:0,y:0},_e=ce.x,Ce=ce.y;e instanceof Vn||e instanceof Gn||e instanceof Hn||e instanceof _i||Ba&&e instanceof Ba?$.texSubImage2D($.TEXTURE_2D,0,_e,Ce,$.RGBA,$.UNSIGNED_BYTE,e):$.texSubImage2D($.TEXTURE_2D,0,_e,Ce,l,p,$.RGBA,$.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$.generateMipmap($.TEXTURE_2D)},vo.prototype.bind=function(e,t,r){var l=this.context.gl;l.bindTexture(l.TEXTURE_2D,this.texture),r!==l.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=l.LINEAR),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)},vo.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},vo.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Pu=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Pu.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Pu.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Vs=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},v(["receive","process"],this),this.invoker=new Pu(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=oe()?e:E};function ju(e,t,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[e*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}Vs.prototype.send=function(e,t,r,l,p){var b=this;p===void 0&&(p=!1);var N=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[N]=r);var $=ee(this.globalScope)?void 0:[];return this.target.postMessage({id:N,type:e,hasCallback:!!r,targetMapId:l,mustQueue:p,sourceMapId:this.mapId,data:xs(t,$)},$),{cancel:function(){r&&delete b.callbacks[N],b.target.postMessage({id:N,type:"<cancel>",targetMapId:l,sourceMapId:b.mapId})}}},Vs.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var l=this.cancelCallbacks[r];delete this.cancelCallbacks[r],l&&l()}else oe()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Vs.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Vs.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var l=this.callbacks[e];delete this.callbacks[e],l&&(t.error?l(jo(t.error)):l(null,jo(t.data)))}else{var p=!1,b=ee(this.globalScope)?void 0:[],N=t.hasCallback?function(Ce,Pe){p=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:Ce?xs(Ce):null,data:xs(Pe,b)},b)}:function(Ce){p=!0},$=null,ce=jo(t.data);if(this.parent[t.type])$=this.parent[t.type](t.sourceMapId,ce,N);else if(this.parent.getWorkerSource){var _e=t.type.split(".");$=this.parent.getWorkerSource(t.sourceMapId,_e[0],ce.source)[_e[1]](ce,N)}else N(new Error("Could not find function "+t.type));!p&&$&&$.cancel&&(this.cancelCallbacks[e]=$.cancel)}},Vs.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ea=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Ea.prototype.setNorthEast=function(e){return this._ne=e instanceof Ca?new Ca(e.lng,e.lat):Ca.convert(e),this},Ea.prototype.setSouthWest=function(e){return this._sw=e instanceof Ca?new Ca(e.lng,e.lat):Ca.convert(e),this},Ea.prototype.extend=function(e){var t,r,l=this._sw,p=this._ne;if(e instanceof Ca)t=e,r=e;else{if(!(e instanceof Ea))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ea.convert(e)):this.extend(Ca.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return l||p?(l.lng=Math.min(t.lng,l.lng),l.lat=Math.min(t.lat,l.lat),p.lng=Math.max(r.lng,p.lng),p.lat=Math.max(r.lat,p.lat)):(this._sw=new Ca(t.lng,t.lat),this._ne=new Ca(r.lng,r.lat)),this},Ea.prototype.getCenter=function(){return new Ca((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ea.prototype.getSouthWest=function(){return this._sw},Ea.prototype.getNorthEast=function(){return this._ne},Ea.prototype.getNorthWest=function(){return new Ca(this.getWest(),this.getNorth())},Ea.prototype.getSouthEast=function(){return new Ca(this.getEast(),this.getSouth())},Ea.prototype.getWest=function(){return this._sw.lng},Ea.prototype.getSouth=function(){return this._sw.lat},Ea.prototype.getEast=function(){return this._ne.lng},Ea.prototype.getNorth=function(){return this._ne.lat},Ea.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ea.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ea.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ea.prototype.contains=function(e){var t=Ca.convert(e),r=t.lng,l=t.lat,p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&p},Ea.convert=function(e){return!e||e instanceof Ea?e:new Ea(e)};var Ca=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ca.prototype.wrap=function(){return new Ca(U(this.lng,-180,180),this.lat)},Ca.prototype.toArray=function(){return[this.lng,this.lat]},Ca.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ca.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,l=e.lat*t,p=Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(p,1))},Ca.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Ea(new Ca(this.lng-r,this.lat-t),new Ca(this.lng+r,this.lat+t))},Ca.convert=function(e){if(e instanceof Ca)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ca(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ca(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Js=2*Math.PI*63710088e-1;function lf(e){return Js*Math.cos(e*Math.PI/180)}function vu(e){return(180+e)/360}function cf(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Rh(e,t){return e/lf(t)}function _h(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Cc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Cc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Ca.convert(e);return new Cc(vu(r.lng),cf(r.lat),Rh(t,r.lat))},Cc.prototype.toLngLat=function(){return new Ca(360*this.x-180,_h(this.y))},Cc.prototype.toAltitude=function(){return this.z*lf(_h(this.y))},Cc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Js*(e=_h(this.y),1/Math.cos(e*Math.PI/180));var e};var Tc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=ff(0,e,e,t,r)};Tc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Tc.prototype.url=function(e,t){var r,l,p,b,N,$=(l=this.y,p=this.z,b=ju(256*(r=this.x),256*(l=Math.pow(2,p)-l-1),p),N=ju(256*(r+1),256*(l+1),p),b[0]+","+b[1]+","+N[0]+","+N[1]),ce=function(_e,Ce,Pe){for(var Be,He="",mt=_e;mt>0;mt--)He+=(Ce&(Be=1<<mt-1)?1:0)+(Pe&Be?2:0);return He}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",ce).replace("{bbox-epsg-3857}",$)},Tc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new L(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Tc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Lh=function(e,t){this.wrap=e,this.canonical=t,this.key=ff(e,t.z,t.z,t.x,t.y)},zo=function(e,t,r,l,p){this.overscaledZ=e,this.wrap=t,this.canonical=new Tc(r,+l,+p),this.key=ff(t,e,r,l,p)};function ff(e,t,r,l,p){(e*=2)<0&&(e=-1*e-1);var b=1<<r;return(b*b*e+b*p+l).toString(36)+r.toString(36)+t.toString(36)}zo.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},zo.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new zo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},zo.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?ff(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):ff(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},zo.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},zo.prototype.children=function(e){if(this.overscaledZ>=e)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,l=2*this.canonical.y;return[new zo(t,this.wrap,t,r,l),new zo(t,this.wrap,t,r+1,l),new zo(t,this.wrap,t,r,l+1),new zo(t,this.wrap,t,r+1,l+1)]},zo.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},zo.prototype.wrapped=function(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},zo.prototype.unwrapTo=function(e){return new zo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},zo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},zo.prototype.toUnwrapped=function(){return new Lh(this.wrap,this.canonical)},zo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},zo.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Cc(e.x-this.wrap,e.y))},Sn("CanonicalTileID",Tc),Sn("OverscaledTileID",zo,{omit:["posMatrix"]});var Zl=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return B('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var l=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var p=0;p<l;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(l,p)]=this.data[this._idx(l-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,l)]=this.data[this._idx(p,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)]};Zl.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[l],r[l+1],r[l+2])},Zl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Zl.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Zl.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Zl.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Zl.prototype.getPixels=function(){return new ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Zl.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var l=t*this.dim,p=t*this.dim+this.dim,b=r*this.dim,N=r*this.dim+this.dim;switch(t){case-1:l=p-1;break;case 1:p=l+1}switch(r){case-1:b=N-1;break;case 1:N=b+1}for(var $=-t*this.dim,ce=-r*this.dim,_e=b;_e<N;_e++)for(var Ce=l;Ce<p;Ce++)this.data[this._idx(Ce,_e)]=e.data[this._idx(Ce+$,_e+ce)]},Sn("DEMData",Zl);var jf=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};jf.prototype.encode=function(e){return this._stringToNumber[e]},jf.prototype.decode=function(e){return this._numberToString[e]};var Uf=function(e,t,r,l,p){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=l,this.properties=e.properties,this.id=p},xh={geometry:{configurable:!0}};xh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},xh.geometry.set=function(e){this._geometry=e},Uf.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Uf.prototype,xh);var Nc=function(){this.state={},this.stateChanges={},this.deletedStates={}};Nc.prototype.updateState=function(e,t,r){var l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},I(this.stateChanges[e][l],r),this.deletedStates[e]===null)for(var p in this.deletedStates[e]={},this.state[e])p!==l&&(this.deletedStates[e][p]=null);else if(this.deletedStates[e]&&this.deletedStates[e][l]===null)for(var b in this.deletedStates[e][l]={},this.state[e][l])r[b]||(this.deletedStates[e][l][b]=null);else for(var N in r)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][N]===null&&delete this.deletedStates[e][l][N]},Nc.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(r in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][r]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}},Nc.prototype.getState=function(e,t){var r=String(t),l=I({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var p=this.deletedStates[e][t];if(p===null)return{};for(var b in p)delete l[b]}return l},Nc.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Nc.prototype.coalesceChanges=function(e,t){var r={};for(var l in this.stateChanges){this.state[l]=this.state[l]||{};var p={};for(var b in this.stateChanges[l])this.state[l][b]||(this.state[l][b]={}),I(this.state[l][b],this.stateChanges[l][b]),p[b]=this.state[l][b];r[l]=p}for(var N in this.deletedStates){this.state[N]=this.state[N]||{};var $={};if(this.deletedStates[N]===null)for(var ce in this.state[N])$[ce]={},this.state[N][ce]={};else for(var _e in this.deletedStates[N]){if(this.deletedStates[N][_e]===null)this.state[N][_e]={};else for(var Ce=0,Pe=Object.keys(this.deletedStates[N][_e]);Ce<Pe.length;Ce+=1)delete this.state[N][_e][Pe[Ce]];$[_e]=this.state[N][_e]}r[N]=r[N]||{},I(r[N],$)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var Be in e)e[Be].setFeatureState(r,t)};var Wl=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fs(8192,16,0),this.grid3D=new Fs(8192,16,0),this.featureIndexArray=new Ie,this.promoteId=t};function Dh(e,t,r,l,p){return S(e,function(b,N){var $=t instanceof Da?t.get(N):null;return $&&$.evaluate?$.evaluate(r,l,p):$})}function kh(e){for(var t=1/0,r=1/0,l=-1/0,p=-1/0,b=0,N=e;b<N.length;b+=1){var $=N[b];t=Math.min(t,$.x),r=Math.min(r,$.y),l=Math.max(l,$.x),p=Math.max(p,$.y)}return{minX:t,minY:r,maxX:l,maxY:p}}function sd(e,t){return t-e}Wl.prototype.insert=function(e,t,r,l,p,b){var N=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,l,p);for(var $=b?this.grid3D:this.grid,ce=0;ce<t.length;ce++){for(var _e=t[ce],Ce=[1/0,1/0,-1/0,-1/0],Pe=0;Pe<_e.length;Pe++){var Be=_e[Pe];Ce[0]=Math.min(Ce[0],Be.x),Ce[1]=Math.min(Ce[1],Be.y),Ce[2]=Math.max(Ce[2],Be.x),Ce[3]=Math.max(Ce[3],Be.y)}Ce[0]<8192&&Ce[1]<8192&&Ce[2]>=0&&Ce[3]>=0&&$.insert(N,Ce[0],Ce[1],Ce[2],Ce[3])}},Wl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Hl.VectorTile(new Fc(this.rawTileData)).layers,this.sourceLayerCoder=new jf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Wl.prototype.query=function(e,t,r,l){var p=this;this.loadVTLayers();for(var b=e.params||{},N=8192/e.tileSize/e.scale,$=Yu(b.filter),ce=e.queryGeometry,_e=e.queryPadding*N,Ce=kh(ce),Pe=this.grid.query(Ce.minX-_e,Ce.minY-_e,Ce.maxX+_e,Ce.maxY+_e),Be=kh(e.cameraQueryGeometry),He=this.grid3D.query(Be.minX-_e,Be.minY-_e,Be.maxX+_e,Be.maxY+_e,function(_r,xr,Rr,tn){return function(mn,qn,In,ai,Fn){for(var Ki=0,Ai=mn;Ki<Ai.length;Ki+=1){var Kn=Ai[Ki];if(qn<=Kn.x&&In<=Kn.y&&ai>=Kn.x&&Fn>=Kn.y)return!0}var na=[new L(qn,In),new L(qn,Fn),new L(ai,Fn),new L(ai,In)];if(mn.length>2){for(var Zi=0,pa=na;Zi<pa.length;Zi+=1)if(js(mn,pa[Zi]))return!0}for(var si=0;si<mn.length-1;si++)if(_l(mn[si],mn[si+1],na))return!0;return!1}(e.cameraQueryGeometry,_r-_e,xr-_e,Rr+_e,tn+_e)}),mt=0,bt=He;mt<bt.length;mt+=1)Pe.push(bt[mt]);Pe.sort(sd);for(var kt,Tt={},Ht=function(_r){var xr=Pe[_r];if(xr!==kt){kt=xr;var Rr=p.featureIndexArray.get(xr),tn=null;p.loadMatchingFeature(Tt,Rr.bucketIndex,Rr.sourceLayerIndex,Rr.featureIndex,$,b.layers,b.availableImages,t,r,l,function(mn,qn,In){return tn||(tn=qa(mn)),qn.queryIntersectsFeature(ce,mn,In,tn,p.z,e.transform,N,e.pixelPosMatrix)})}},rr=0;rr<Pe.length;rr++)Ht(rr);return Tt},Wl.prototype.loadMatchingFeature=function(e,t,r,l,p,b,N,$,ce,_e,Ce){var Pe=this.bucketLayerIDs[t];if(!b||function(mn,qn){for(var In=0;In<mn.length;In++)if(qn.indexOf(mn[In])>=0)return!0;return!1}(b,Pe)){var Be=this.sourceLayerCoder.decode(r),He=this.vtLayers[Be].feature(l);if(p.needGeometry){var mt=so(He,!0);if(!p.filter(new nr(this.tileID.overscaledZ),mt,this.tileID.canonical))return}else if(!p.filter(new nr(this.tileID.overscaledZ),He))return;for(var bt=this.getId(He,Be),kt=0;kt<Pe.length;kt++){var Tt=Pe[kt];if(!(b&&b.indexOf(Tt)<0)){var Ht=$[Tt];if(Ht){var rr={};bt!==void 0&&_e&&(rr=_e.getState(Ht.sourceLayer||"_geojsonTileLayer",bt));var _r=I({},ce[Tt]);_r.paint=Dh(_r.paint,Ht.paint,He,rr,N),_r.layout=Dh(_r.layout,Ht.layout,He,rr,N);var xr=!Ce||Ce(He,Ht,rr);if(xr){var Rr=new Uf(He,this.z,this.x,this.y,bt);Rr.layer=_r;var tn=e[Tt];tn===void 0&&(tn=e[Tt]=[]),tn.push({featureIndex:l,feature:Rr,intersectionZ:xr})}}}}}},Wl.prototype.lookupSymbolFeatures=function(e,t,r,l,p,b,N,$){var ce={};this.loadVTLayers();for(var _e=Yu(p),Ce=0,Pe=e;Ce<Pe.length;Ce+=1)this.loadMatchingFeature(ce,r,l,Pe[Ce],_e,b,N,$,t);return ce},Wl.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var l=0,p=r[t];l<p.length;l+=1)if(e===p[l])return!0;return!1},Wl.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Sn("FeatureIndex",Wl,{omit:["rawTileData","sourceLayerCoder"]});var os=function(e,t){this.tileID=e,this.uid=D(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};os.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Ne.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},os.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var l in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(_e,Ce){var Pe={};if(!Ce)return Pe;for(var Be=function(){var bt=mt[He],kt=bt.layerIds.map(function(rr){return Ce.getLayer(rr)}).filter(Boolean);if(kt.length!==0){bt.layers=kt,bt.stateDependentLayerIds&&(bt.stateDependentLayers=bt.stateDependentLayerIds.map(function(rr){return kt.filter(function(_r){return _r.id===rr})[0]}));for(var Tt=0,Ht=kt;Tt<Ht.length;Tt+=1)Pe[Ht[Tt].id]=bt}},He=0,mt=_e;He<mt.length;He+=1)Be();return Pe}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var p=this.buckets[l];if(p instanceof St){if(this.hasSymbolBuckets=!0,!r)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var N=this.buckets[b];if(N instanceof St&&N.hasRTLText){this.hasRTLText=!0,hr.isLoading()||hr.isLoaded()||cr()!=="deferred"||Qt();break}}for(var $ in this.queryPadding=0,this.buckets){var ce=this.buckets[$];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer($).queryRadius(ce))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},os.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},os.prototype.getBucket=function(e){return this.buckets[e.id]},os.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var l=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vo(e,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vo(e,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)},os.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},os.prototype.queryRenderedFeatures=function(e,t,r,l,p,b,N,$,ce,_e){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:p,scale:b,tileSize:this.tileSize,pixelPosMatrix:_e,transform:$,params:N,queryPadding:this.queryPadding*ce},e,t,r):{}},os.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var l=r.loadVTLayers(),p=t?t.sourceLayer:"",b=l._geojsonTileLayer||l[p];if(b)for(var N=Yu(t&&t.filter),$=this.tileID.canonical,ce=$.z,_e=$.x,Ce=$.y,Pe={z:ce,x:_e,y:Ce},Be=0;Be<b.length;Be++){var He=b.feature(Be);if(N.needGeometry){var mt=so(He,!0);if(!N.filter(new nr(this.tileID.overscaledZ),mt,this.tileID.canonical))continue}else if(!N.filter(new nr(this.tileID.overscaledZ),He))continue;var bt=r.getId(He,p),kt=new Uf(He,ce,_e,Ce,bt);kt.tile=Pe,e.push(kt)}}},os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},os.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=re(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var l=Date.now(),p=!1;if(this.expirationTime>l)p=!1;else if(t)if(this.expirationTime<t)p=!0;else{var b=this.expirationTime-t;b?this.expirationTime=l+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},os.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var l in this.buckets)if(t.style.hasLayer(l)){var p=this.buckets[l],b=p.layers[0].sourceLayer||"_geojsonTileLayer",N=r[b],$=e[b];if(N&&$&&Object.keys($).length!==0){p.update($,N,this.imageAtlas&&this.imageAtlas.patternPositions||{});var ce=t&&t.style&&t.style.getLayer(l);ce&&(this.queryPadding=Math.max(this.queryPadding,ce.queryRadius(p)))}}}},os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ne.now()},os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},os.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Ne.now()+e},os.prototype.setDependencies=function(e,t){for(var r={},l=0,p=t;l<p.length;l+=1)r[p[l]]=!0;this.dependencies[e]=r},os.prototype.hasDependency=function(e,t){for(var r=0,l=e;r<l.length;r+=1){var p=this.dependencies[l[r]];if(p){for(var b=0,N=t;b<N.length;b+=1)if(p[N[b]])return!0}}return!1};var hc=E.performance,Fh=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},hc.mark(this._marks.start)};Fh.prototype.finish=function(){hc.mark(this._marks.end);var e=hc.getEntriesByName(this._marks.measure);return e.length===0&&(hc.measure(this._marks.measure,this._marks.start,this._marks.end),e=hc.getEntriesByName(this._marks.measure),hc.clearMarks(this._marks.start),hc.clearMarks(this._marks.end),hc.clearMeasures(this._marks.measure)),e},o.Actor=Vs,o.AlphaImage=Bu,o.CanonicalTileID=Tc,o.CollisionBoxArray=u,o.Color=Ii,o.DEMData=Zl,o.DataConstantProperty=gn,o.DictionaryCoder=jf,o.EXTENT=8192,o.ErrorEvent=Rt,o.EvaluationParameters=nr,o.Event=ot,o.Evented=Nt,o.FeatureIndex=Wl,o.FillBucket=Ls,o.FillExtrusionBucket=Zo,o.ImageAtlas=En,o.ImagePosition=Mn,o.LineBucket=Wa,o.LngLat=Ca,o.LngLatBounds=Ea,o.MercatorCoordinate=Cc,o.ONE_EM=24,o.OverscaledTileID=zo,o.Point=L,o.Point$1=L,o.Properties=xa,o.Protobuf=Fc,o.RGBAImage=ns,o.RequestManager=Le,o.RequestPerformance=Fh,o.ResourceType=Ar,o.SegmentVector=Xe,o.SourceFeatureState=Nc,o.StructArrayLayout1ui2=_n,o.StructArrayLayout2f1f2i16=Eu,o.StructArrayLayout2i4=ba,o.StructArrayLayout3ui6=lu,o.StructArrayLayout4i8=ka,o.SymbolBucket=St,o.Texture=vo,o.Tile=os,o.Transitionable=Bn,o.Uniform1f=un,o.Uniform1i=zr,o.Uniform2f=qr,o.Uniform3f=Dn,o.Uniform4f=$n,o.UniformColor=Jn,o.UniformMatrix4f=qi,o.UnwrappedTileID=Lh,o.ValidationError=Et,o.WritingMode=on,o.ZoomHistory=qu,o.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},o.addDynamicAttributes=Ft,o.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var l=e.length,p=new Array(e.length),b=null;e.forEach(function(N,$){t(N,function(ce,_e){ce&&(b=ce),p[$]=_e,--l==0&&r(b,p)})})},o.bezier=k,o.bindAll=v,o.browser=Ne,o.cacheEntryPossiblyAdded=function(e){++Br>pt&&(e.getActor().send("enforceCacheSizeLimit",it),Br=0)},o.clamp=j,o.clearTileCache=function(e){var t=E.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},o.clipLine=as,o.clone=function(e){var t=new da(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.clone$1=x,o.clone$2=function(e){var t=new da(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.collisionCircleLayout=gh,o.config=Re,o.create=function(){var e=new da(16);return da!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},o.create$1=function(){var e=new da(9);return da!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},o.create$2=function(){var e=new da(4);return da!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},o.createCommonjsModule=w,o.createExpression=Iu,o.createLayout=Qi,o.createStyleLayer=function(e){return e.type==="custom"?new Yn(e):new kn[e.type](e)},o.cross=function(e,t,r){var l=t[0],p=t[1],b=t[2],N=r[0],$=r[1],ce=r[2];return e[0]=p*ce-b*$,e[1]=b*N-l*ce,e[2]=l*$-p*N,e},o.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],r[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var p in t)if(!e(t[p],r[p]))return!1;return!0}return t===r},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},o.ease=M,o.emitValidationErrors=ml,o.endsWith=h,o.enforceCacheSizeLimit=function(e){Vt(),gt&&gt.then(function(t){t.keys().then(function(r){for(var l=0;l<r.length-e;l++)t.delete(r[l])})})},o.evaluateSizeForFeature=uo,o.evaluateSizeForZoom=po,o.evaluateVariableOffset=sr,o.evented=ht,o.extend=I,o.featureFilter=Yu,o.filterObject=A,o.fromRotation=function(e,t){var r=Math.sin(t),l=Math.cos(t);return e[0]=l,e[1]=r,e[2]=0,e[3]=-r,e[4]=l,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},o.getAnchorAlignment=Cn,o.getAnchorJustification=On,o.getArrayBuffer=Si,o.getImage=ke,o.getJSON=function(e,t){return ji(I(e,{type:"json"}),t)},o.getRTLTextPluginStatus=cr,o.getReferrer=Rn,o.getVideo=function(e,t){var r,l,p=E.document.createElement("video");p.muted=!0,p.onloadstart=function(){t(null,p)};for(var b=0;b<e.length;b++){var N=E.document.createElement("source");r=e[b],l=void 0,(l=E.document.createElement("a")).href=r,(l.protocol!==E.document.location.protocol||l.host!==E.document.location.host)&&(p.crossOrigin="Anonymous"),N.src=e[b],p.appendChild(N)}return{cancel:function(){}}},o.identity=rs,o.invert=function(e,t){var r=t[0],l=t[1],p=t[2],b=t[3],N=t[4],$=t[5],ce=t[6],_e=t[7],Ce=t[8],Pe=t[9],Be=t[10],He=t[11],mt=t[12],bt=t[13],kt=t[14],Tt=t[15],Ht=r*$-l*N,rr=r*ce-p*N,_r=r*_e-b*N,xr=l*ce-p*$,Rr=l*_e-b*$,tn=p*_e-b*ce,mn=Ce*bt-Pe*mt,qn=Ce*kt-Be*mt,In=Ce*Tt-He*mt,ai=Pe*kt-Be*bt,Fn=Pe*Tt-He*bt,Ki=Be*Tt-He*kt,Ai=Ht*Ki-rr*Fn+_r*ai+xr*In-Rr*qn+tn*mn;return Ai?(e[0]=($*Ki-ce*Fn+_e*ai)*(Ai=1/Ai),e[1]=(p*Fn-l*Ki-b*ai)*Ai,e[2]=(bt*tn-kt*Rr+Tt*xr)*Ai,e[3]=(Be*Rr-Pe*tn-He*xr)*Ai,e[4]=(ce*In-N*Ki-_e*qn)*Ai,e[5]=(r*Ki-p*In+b*qn)*Ai,e[6]=(kt*_r-mt*tn-Tt*rr)*Ai,e[7]=(Ce*tn-Be*_r+He*rr)*Ai,e[8]=(N*Fn-$*In+_e*mn)*Ai,e[9]=(l*In-r*Fn-b*mn)*Ai,e[10]=(mt*Rr-bt*_r+Tt*Ht)*Ai,e[11]=(Pe*_r-Ce*Rr-He*Ht)*Ai,e[12]=($*qn-N*ai-ce*mn)*Ai,e[13]=(r*ai-l*qn+p*mn)*Ai,e[14]=(bt*rr-mt*xr-kt*Ht)*Ai,e[15]=(Ce*xr-Pe*rr+Be*Ht)*Ai,e):null},o.isChar=pn,o.isMapboxURL=C,o.keysDifference=function(e,t){var r=[];for(var l in e)l in t||r.push(l);return r},o.makeRequest=ji,o.mapObject=S,o.mercatorXfromLng=vu,o.mercatorYfromLat=cf,o.mercatorZfromAltitude=Rh,o.mul=Au,o.multiply=ps,o.mvt=Hl,o.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},o.normalize=function(e,t){var r=t[0],l=t[1],p=t[2],b=r*r+l*l+p*p;return b>0&&(b=1/Math.sqrt(b)),e[0]=t[0]*b,e[1]=t[1]*b,e[2]=t[2]*b,e},o.number=Mr,o.offscreenCanvasSupported=Ur,o.ortho=function(e,t,r,l,p,b,N){var $=1/(t-r),ce=1/(l-p),_e=1/(b-N);return e[0]=-2*$,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*ce,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*_e,e[11]=0,e[12]=(t+r)*$,e[13]=(p+l)*ce,e[14]=(N+b)*_e,e[15]=1,e},o.parseGlyphPBF=function(e){return new Fc(e).readFields(Qr,[])},o.pbf=Fc,o.performSymbolLayout=function(e,t,r,l,p,b,N){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var $=e.layers[0].layout,ce=e.layers[0]._unevaluatedLayout._values,_e={};if(e.textSizeData.kind==="composite"){var Ce=e.textSizeData,Pe=Ce.maxZoom;_e.compositeTextSizes=[ce["text-size"].possiblyEvaluate(new nr(Ce.minZoom),N),ce["text-size"].possiblyEvaluate(new nr(Pe),N)]}if(e.iconSizeData.kind==="composite"){var Be=e.iconSizeData,He=Be.maxZoom;_e.compositeIconSizes=[ce["icon-size"].possiblyEvaluate(new nr(Be.minZoom),N),ce["icon-size"].possiblyEvaluate(new nr(He),N)]}_e.layoutTextSize=ce["text-size"].possiblyEvaluate(new nr(e.zoom+1),N),_e.layoutIconSize=ce["icon-size"].possiblyEvaluate(new nr(e.zoom+1),N),_e.textMaxSize=ce["text-size"].possiblyEvaluate(new nr(18));for(var mt=24*$.get("text-line-height"),bt=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",kt=$.get("text-keep-upright"),Tt=$.get("text-size"),Ht=function(){var xr=_r[rr],Rr=$.get("text-font").evaluate(xr,{},N).join(","),tn=Tt.evaluate(xr,{},N),mn=_e.layoutTextSize.evaluate(xr,{},N),qn=_e.layoutIconSize.evaluate(xr,{},N),In={horizontal:{},vertical:void 0},ai=xr.text,Fn=[0,0];if(ai){var Ki=ai.toString(),Ai=24*$.get("text-letter-spacing").evaluate(xr,{},N),Kn=function(ca){for(var Za=0,za=ca;Za<za.length;Za+=1)if(ya=za[Za].charCodeAt(0),pn.Arabic(ya)||pn["Arabic Supplement"](ya)||pn["Arabic Extended-A"](ya)||pn["Arabic Presentation Forms-A"](ya)||pn["Arabic Presentation Forms-B"](ya))return!1;var ya;return!0}(Ki)?Ai:0,na=$.get("text-anchor").evaluate(xr,{},N),Zi=$.get("text-variable-anchor");if(!Zi){var pa=$.get("text-radial-offset").evaluate(xr,{},N);Fn=pa?sr(na,[24*pa,vr]):$.get("text-offset").evaluate(xr,{},N).map(function(ca){return 24*ca})}var si=bt?"center":$.get("text-justify").evaluate(xr,{},N),Ma=$.get("symbol-placement"),lo=Ma==="point"?24*$.get("text-max-width").evaluate(xr,{},N):0,So=function(){e.allowVerticalPlacement&&Nl(Ki)&&(In.vertical=Pr(ai,t,r,p,Rr,lo,mt,na,"left",Kn,Fn,on.vertical,!0,Ma,mn,tn))};if(!bt&&Zi){for(var mo=si==="auto"?Zi.map(function(ca){return On(ca)}):[si],co=!1,Eo=0;Eo<mo.length;Eo++){var $o=mo[Eo];if(!In.horizontal[$o])if(co)In.horizontal[$o]=In.horizontal[0];else{var Jo=Pr(ai,t,r,p,Rr,lo,mt,"center",$o,Kn,Fn,on.horizontal,!1,Ma,mn,tn);Jo&&(In.horizontal[$o]=Jo,co=Jo.positionedLines.length===1)}}So()}else{si==="auto"&&(si=On(na));var Ms=Pr(ai,t,r,p,Rr,lo,mt,na,si,Kn,Fn,on.horizontal,!1,Ma,mn,tn);Ms&&(In.horizontal[si]=Ms),So(),Nl(Ki)&&bt&&kt&&(In.vertical=Pr(ai,t,r,p,Rr,lo,mt,na,si,Kn,Fn,on.vertical,!1,Ma,mn,tn))}}var ss=void 0,Ps=!1;if(xr.icon&&xr.icon.name){var Mo=l[xr.icon.name];Mo&&(ss=function(ca,Za,za){var ya=Cn(za),Ds=Za[0]-ca.displaySize[0]*ya.horizontalAlign,bs=Za[1]-ca.displaySize[1]*ya.verticalAlign;return{image:ca,top:bs,bottom:bs+ca.displaySize[1],left:Ds,right:Ds+ca.displaySize[0]}}(p[xr.icon.name],$.get("icon-offset").evaluate(xr,{},N),$.get("icon-anchor").evaluate(xr,{},N)),Ps=Mo.sdf,e.sdfIcons===void 0?e.sdfIcons=Mo.sdf:e.sdfIcons!==Mo.sdf&&B("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Mo.pixelRatio!==e.pixelRatio||$.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var us=at(In.horizontal)||In.vertical;e.iconsInText=!!us&&us.iconsInText,(us||ss)&&function(ca,Za,za,ya,Ds,bs,eo,Fo,Ss,Pa,Ml){var mu=bs.textMaxSize.evaluate(Za,{});mu===void 0&&(mu=eo);var Pl,Po=ca.layers[0].layout,Ol=Po.get("icon-offset").evaluate(Za,{},Ml),Uu=at(za.horizontal),Bc=eo/24,wc=ca.tilePixelRatio*Bc,zc=ca.tilePixelRatio*mu/24,Yl=ca.tilePixelRatio*Fo,jc=ca.tilePixelRatio*Po.get("symbol-spacing"),Vf=Po.get("text-padding")*ca.tilePixelRatio,Uc=Po.get("icon-padding")*ca.tilePixelRatio,hf=Po.get("text-max-angle")/180*Math.PI,Gf=Po.get("text-rotation-alignment")==="map"&&Po.get("symbol-placement")!=="point",Hf=Po.get("icon-rotation-alignment")==="map"&&Po.get("symbol-placement")!=="point",Xl=Po.get("symbol-placement"),df=jc/2,Vc=Po.get("icon-text-fit");ya&&Vc!=="none"&&(ca.allowVerticalPlacement&&za.vertical&&(Pl=yi(ya,za.vertical,Vc,Po.get("icon-text-fit-padding"),Ol,Bc)),Uu&&(ya=yi(ya,Uu,Vc,Po.get("icon-text-fit-padding"),Ol,Bc)));var dc=function(ud,bf){bf.x<0||bf.x>=8192||bf.y<0||bf.y>=8192||function(Oo,ul,ld,pc,Ch,zh,$f,Il,Jf,Sf,Qf,qf,Th,jh,Ef,Uh,Vh,Gh,Hh,Zh,gu,eh,Wh,Rl,cd){var Yh,Mc,Yc,Xc,Kc,$c=Oo.addToLineVertexArray(ul,ld),Xh=0,Kh=0,$h=0,Jh=0,wh=-1,Ah=-1,Kl={},Qh=ft(""),Mh=0,Ph=0;if(Il._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Mh=(Yh=Il.layout.get("text-offset").evaluate(gu,{},Rl).map(function(Tf){return 24*Tf}))[0],Ph=Yh[1]):(Mh=24*Il.layout.get("text-radial-offset").evaluate(gu,{},Rl),Ph=vr),Oo.allowVerticalPlacement&&pc.vertical){var qh=Il.layout.get("text-rotate").evaluate(gu,{},Rl)+90;Xc=new vi(Jf,ul,Sf,Qf,qf,pc.vertical,Th,jh,Ef,qh),$f&&(Kc=new vi(Jf,ul,Sf,Qf,qf,$f,Vh,Gh,Ef,qh))}if(Ch){var Oh=Il.layout.get("icon-rotate").evaluate(gu,{}),ed=Il.layout.get("icon-text-fit")!=="none",td=bo(Ch,Oh,Wh,ed),Ih=$f?bo($f,Oh,Wh,ed):void 0;Yc=new vi(Jf,ul,Sf,Qf,qf,Ch,Vh,Gh,!1,Oh),Xh=4*td.length;var rd=Oo.iconSizeData,Cf=null;rd.kind==="source"?(Cf=[128*Il.layout.get("icon-size").evaluate(gu,{})])[0]>32640&&B(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):rd.kind==="composite"&&((Cf=[128*eh.compositeIconSizes[0].evaluate(gu,{},Rl),128*eh.compositeIconSizes[1].evaluate(gu,{},Rl)])[0]>32640||Cf[1]>32640)&&B(Oo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Oo.addSymbols(Oo.icon,td,Cf,Zh,Hh,gu,!1,ul,$c.lineStartIndex,$c.lineLength,-1,Rl),wh=Oo.icon.placedSymbolArray.length-1,Ih&&(Kh=4*Ih.length,Oo.addSymbols(Oo.icon,Ih,Cf,Zh,Hh,gu,on.vertical,ul,$c.lineStartIndex,$c.lineLength,-1,Rl),Ah=Oo.icon.placedSymbolArray.length-1)}for(var nd in pc.horizontal){var th=pc.horizontal[nd];if(!Mc){Qh=ft(th.text);var fd=Il.layout.get("text-rotate").evaluate(gu,{},Rl);Mc=new vi(Jf,ul,Sf,Qf,qf,th,Th,jh,Ef,fd)}var id=th.positionedLines.length===1;if($h+=ea(Oo,ul,th,zh,Il,Ef,gu,Uh,$c,pc.vertical?on.horizontal:on.horizontalOnly,id?Object.keys(pc.horizontal):[nd],Kl,wh,eh,Rl),id)break}pc.vertical&&(Jh+=ea(Oo,ul,pc.vertical,zh,Il,Ef,gu,Uh,$c,on.vertical,["vertical"],Kl,Ah,eh,Rl));var hd=Mc?Mc.boxStartIndex:Oo.collisionBoxArray.length,dd=Mc?Mc.boxEndIndex:Oo.collisionBoxArray.length,pd=Xc?Xc.boxStartIndex:Oo.collisionBoxArray.length,vd=Xc?Xc.boxEndIndex:Oo.collisionBoxArray.length,md=Yc?Yc.boxStartIndex:Oo.collisionBoxArray.length,gd=Yc?Yc.boxEndIndex:Oo.collisionBoxArray.length,yd=Kc?Kc.boxStartIndex:Oo.collisionBoxArray.length,_d=Kc?Kc.boxEndIndex:Oo.collisionBoxArray.length,Ll=-1,rh=function(Tf,od){return Tf&&Tf.circleDiameter?Math.max(Tf.circleDiameter,od):od};Ll=rh(Mc,Ll),Ll=rh(Xc,Ll),Ll=rh(Yc,Ll);var ad=(Ll=rh(Kc,Ll))>-1?1:0;ad&&(Ll*=cd/24),Oo.glyphOffsetArray.length>=St.MAX_GLYPHS&&B("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gu.sortKey!==void 0&&Oo.addToSortKeyRanges(Oo.symbolInstances.length,gu.sortKey),Oo.symbolInstances.emplaceBack(ul.x,ul.y,Kl.right>=0?Kl.right:-1,Kl.center>=0?Kl.center:-1,Kl.left>=0?Kl.left:-1,Kl.vertical||-1,wh,Ah,Qh,hd,dd,pd,vd,md,gd,yd,_d,Sf,$h,Jh,Xh,Kh,ad,0,Th,Mh,Ph,Ll)}(ca,bf,ud,za,ya,Ds,Pl,ca.layers[0],ca.collisionBoxArray,Za.index,Za.sourceLayerIndex,ca.index,wc,Vf,Gf,Ss,Yl,Uc,Hf,Ol,Za,bs,Pa,Ml,eo)};if(Xl==="line")for(var Gc=0,Zf=as(Za.geometry,0,0,8192,8192);Gc<Zf.length;Gc+=1)for(var Wf=Zf[Gc],pf=0,vf=is(Wf,jc,hf,za.vertical||Uu,ya,24,zc,ca.overscaling,8192);pf<vf.length;pf+=1){var Yf=vf[pf];Uu&&Ze(ca,Uu.text,df,Yf)||dc(Wf,Yf)}else if(Xl==="line-center")for(var mf=0,gf=Za.geometry;mf<gf.length;mf+=1){var yf=gf[mf];if(yf.length>1){var Xf=Xo(yf,hf,za.vertical||Uu,ya,24,zc);Xf&&dc(yf,Xf)}}else if(Za.type==="Polygon")for(var Hc=0,Kf=uc(Za.geometry,0);Hc<Kf.length;Hc+=1){var Zc=Kf[Hc],_f=ko(Zc,16);dc(Zc[0],new wi(_f.x,_f.y,0))}else if(Za.type==="LineString")for(var Ac=0,xf=Za.geometry;Ac<xf.length;Ac+=1){var Wc=xf[Ac];dc(Wc,new wi(Wc[0].x,Wc[0].y,0))}else if(Za.type==="Point")for(var bh=0,Nh=Za.geometry;bh<Nh.length;bh+=1)for(var Sh=0,Bh=Nh[bh];Sh<Bh.length;Sh+=1){var Eh=Bh[Sh];dc([Eh],new wi(Eh.x,Eh.y,0))}}(e,xr,In,ss,l,_e,mn,qn,Fn,Ps,N)},rr=0,_r=e.features;rr<_r.length;rr+=1)Ht();b&&e.generateCollisionDebugBuffers()},o.perspective=function(e,t,r,l,p){var b,N=1/Math.tan(t/2);return e[0]=N/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=N,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,p!=null&&p!==1/0?(e[10]=(p+l)*(b=1/(l-p)),e[14]=2*p*l*b):(e[10]=-1,e[14]=-2*l),e},o.pick=function(e,t){for(var r={},l=0;l<t.length;l++){var p=t[l];p in e&&(r[p]=e[p])}return r},o.plugin=hr,o.polygonIntersectsPolygon=Cu,o.postMapLoadEvent=nt,o.postTurnstileEvent=Ut,o.potpack=Kr,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Sn,o.registerForPluginStateChange=function(e){return e({pluginStatus:es,pluginURL:q}),ht.on("pluginStateChange",e),e},o.renderColorRamp=Pc,o.rotate=function(e,t,r){var l=t[0],p=t[1],b=t[2],N=t[3],$=Math.sin(r),ce=Math.cos(r);return e[0]=l*ce+b*$,e[1]=p*ce+N*$,e[2]=l*-$+b*ce,e[3]=p*-$+N*ce,e},o.rotateX=function(e,t,r){var l=Math.sin(r),p=Math.cos(r),b=t[4],N=t[5],$=t[6],ce=t[7],_e=t[8],Ce=t[9],Pe=t[10],Be=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=b*p+_e*l,e[5]=N*p+Ce*l,e[6]=$*p+Pe*l,e[7]=ce*p+Be*l,e[8]=_e*p-b*l,e[9]=Ce*p-N*l,e[10]=Pe*p-$*l,e[11]=Be*p-ce*l,e},o.rotateZ=function(e,t,r){var l=Math.sin(r),p=Math.cos(r),b=t[0],N=t[1],$=t[2],ce=t[3],_e=t[4],Ce=t[5],Pe=t[6],Be=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=b*p+_e*l,e[1]=N*p+Ce*l,e[2]=$*p+Pe*l,e[3]=ce*p+Be*l,e[4]=_e*p-b*l,e[5]=Ce*p-N*l,e[6]=Pe*p-$*l,e[7]=Be*p-ce*l,e},o.scale=function(e,t,r){var l=r[0],p=r[1],b=r[2];return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*p,e[5]=t[5]*p,e[6]=t[6]*p,e[7]=t[7]*p,e[8]=t[8]*b,e[9]=t[9]*b,e[10]=t[10]*b,e[11]=t[11]*b,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},o.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},o.setCacheLimits=function(e,t){it=e,pt=t},o.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),es==="deferred"||es==="loading"||es==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");q=Ne.resolveURL(e),es="deferred",Su=t,vt(),r||Qt()},o.sphericalToCartesian=function(e){var t=e[0],r=e[1],l=e[2];return r+=90,r*=Math.PI/180,l*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(l),y:t*Math.sin(r)*Math.sin(l),z:t*Math.cos(l)}},o.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},o.styleSpec=Ye,o.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},o.symbolSize=ra,o.transformMat3=function(e,t,r){var l=t[0],p=t[1],b=t[2];return e[0]=l*r[0]+p*r[3]+b*r[6],e[1]=l*r[1]+p*r[4]+b*r[7],e[2]=l*r[2]+p*r[5]+b*r[8],e},o.transformMat4=Nu,o.translate=function(e,t,r){var l,p,b,N,$,ce,_e,Ce,Pe,Be,He,mt,bt=r[0],kt=r[1],Tt=r[2];return t===e?(e[12]=t[0]*bt+t[4]*kt+t[8]*Tt+t[12],e[13]=t[1]*bt+t[5]*kt+t[9]*Tt+t[13],e[14]=t[2]*bt+t[6]*kt+t[10]*Tt+t[14],e[15]=t[3]*bt+t[7]*kt+t[11]*Tt+t[15]):(p=t[1],b=t[2],N=t[3],$=t[4],ce=t[5],_e=t[6],Ce=t[7],Pe=t[8],Be=t[9],He=t[10],mt=t[11],e[0]=l=t[0],e[1]=p,e[2]=b,e[3]=N,e[4]=$,e[5]=ce,e[6]=_e,e[7]=Ce,e[8]=Pe,e[9]=Be,e[10]=He,e[11]=mt,e[12]=l*bt+$*kt+Pe*Tt+t[12],e[13]=p*bt+ce*kt+Be*Tt+t[13],e[14]=b*bt+_e*kt+He*Tt+t[14],e[15]=N*bt+Ce*kt+mt*Tt+t[15]),e},o.triggerPluginCompletionEvent=Oe,o.uniqueId=D,o.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},o.validateLight=mc,o.validateStyle=bu,o.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},o.vectorTile=Hl,o.version="1.13.1",o.warnOnce=B,o.webpSupported=he,o.window=E,o.wrap=U}),F(["./shared"],function(o){"use strict";function w(Ee){var ke=typeof Ee;if(ke==="number"||ke==="boolean"||ke==="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){for(var ze="[",Ke=0,ot=Ee;Ke<ot.length;Ke+=1)ze+=w(ot[Ke])+",";return ze+"]"}for(var Rt=Object.keys(Ee).sort(),Nt="{",Ye=0;Ye<Rt.length;Ye++)Nt+=JSON.stringify(Rt[Ye])+":"+w(Ee[Rt[Ye]])+",";return Nt+"}"}function _(Ee){for(var ke="",ze=0,Ke=o.refProperties;ze<Ke.length;ze+=1)ke+="/"+w(Ee[Ke[ze]]);return ke}var P=function(Ee){this.keyCache={},Ee&&this.replace(Ee)};P.prototype.replace=function(Ee){this._layerConfigs={},this._layers={},this.update(Ee,[])},P.prototype.update=function(Ee,ke){for(var ze=this,Ke=0,ot=Ee;Ke<ot.length;Ke+=1){var Rt=ot[Ke];this._layerConfigs[Rt.id]=Rt;var Nt=this._layers[Rt.id]=o.createStyleLayer(Rt);Nt._featureFilter=o.featureFilter(Nt.filter),this.keyCache[Rt.id]&&delete this.keyCache[Rt.id]}for(var Ye=0,Et=ke;Ye<Et.length;Ye+=1){var Zt=Et[Ye];delete this.keyCache[Zt],delete this._layerConfigs[Zt],delete this._layers[Zt]}this.familiesBySource={};for(var Lr=0,ir=function(an,sn){for(var Ei={},fn=0;fn<an.length;fn++){var ni=sn&&sn[an[fn].id]||_(an[fn]);sn&&(sn[an[fn].id]=ni);var Ui=Ei[ni];Ui||(Ui=Ei[ni]=[]),Ui.push(an[fn])}var mi=[];for(var Li in Ei)mi.push(Ei[Li]);return mi}(o.values(this._layerConfigs),this.keyCache);Lr<ir.length;Lr+=1){var ur=ir[Lr].map(function(an){return ze._layers[an.id]}),Or=ur[0];if(Or.visibility!=="none"){var nn=Or.source||"",Hr=this.familiesBySource[nn];Hr||(Hr=this.familiesBySource[nn]={});var gr=Or.sourceLayer||"_geojsonTileLayer",vn=Hr[gr];vn||(vn=Hr[gr]=[]),vn.push(ur)}}};var L=function(Ee){var ke={},ze=[];for(var Ke in Ee){var ot=Ee[Ke],Rt=ke[Ke]={};for(var Nt in ot){var Ye=ot[+Nt];if(Ye&&Ye.bitmap.width!==0&&Ye.bitmap.height!==0){var Et={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};ze.push(Et),Rt[Nt]={rect:Et,metrics:Ye.metrics}}}}var Zt=o.potpack(ze),Lr=new o.AlphaImage({width:Zt.w||1,height:Zt.h||1});for(var ir in Ee){var ur=Ee[ir];for(var Or in ur){var nn=ur[+Or];if(nn&&nn.bitmap.width!==0&&nn.bitmap.height!==0){var Hr=ke[ir][Or].rect;o.AlphaImage.copy(nn.bitmap,Lr,{x:0,y:0},{x:Hr.x+1,y:Hr.y+1},nn.bitmap)}}}this.image=Lr,this.positions=ke};o.register("GlyphAtlas",L);var d=function(Ee){this.tileID=new o.OverscaledTileID(Ee.tileID.overscaledZ,Ee.tileID.wrap,Ee.tileID.canonical.z,Ee.tileID.canonical.x,Ee.tileID.canonical.y),this.uid=Ee.uid,this.zoom=Ee.zoom,this.pixelRatio=Ee.pixelRatio,this.tileSize=Ee.tileSize,this.source=Ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ee.showCollisionBoxes,this.collectResourceTiming=!!Ee.collectResourceTiming,this.returnDependencies=!!Ee.returnDependencies,this.promoteId=Ee.promoteId};function E(Ee,ke,ze){for(var Ke=new o.EvaluationParameters(ke),ot=0,Rt=Ee;ot<Rt.length;ot+=1)Rt[ot].recalculate(Ke,ze)}function g(Ee,ke){var ze=o.getArrayBuffer(Ee.request,function(Ke,ot,Rt,Nt){Ke?ke(Ke):ot&&ke(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(ot)),rawData:ot,cacheControl:Rt,expires:Nt})});return function(){ze.cancel(),ke()}}d.prototype.parse=function(Ee,ke,ze,Ke,ot){var Rt=this;this.status="parsing",this.data=Ee,this.collisionBoxArray=new o.CollisionBoxArray;var Nt=new o.DictionaryCoder(Object.keys(Ee.layers).sort()),Ye=new o.FeatureIndex(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];var Et,Zt,Lr,ir,ur={},Or={featureIndex:Ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ze},nn=ke.familiesBySource[this.source];for(var Hr in nn){var gr=Ee.layers[Hr];if(gr){gr.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+Hr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vn=Nt.encode(Hr),an=[],sn=0;sn<gr.length;sn++){var Ei=gr.feature(sn),fn=Ye.getId(Ei,Hr);an.push({feature:Ei,id:fn,index:sn,sourceLayerIndex:vn})}for(var ni=0,Ui=nn[Hr];ni<Ui.length;ni+=1){var mi=Ui[ni],Li=mi[0];Li.minzoom&&this.zoom<Math.floor(Li.minzoom)||Li.maxzoom&&this.zoom>=Li.maxzoom||Li.visibility!=="none"&&(E(mi,this.zoom,ze),(ur[Li.id]=Li.createBucket({index:Ye.bucketLayerIDs.length,layers:mi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source})).populate(an,Or,this.tileID.canonical),Ye.bucketLayerIDs.push(mi.map(function(Pi){return Pi.id})))}}}var ui=o.mapObject(Or.glyphDependencies,function(Pi){return Object.keys(Pi).map(Number)});Object.keys(ui).length?Ke.send("getGlyphs",{uid:this.uid,stacks:ui},function(Pi,hi){Et||(Et=Pi,Zt=hi,va.call(Rt))}):Zt={};var fi=Object.keys(Or.iconDependencies);fi.length?Ke.send("getImages",{icons:fi,source:this.source,tileID:this.tileID,type:"icons"},function(Pi,hi){Et||(Et=Pi,Lr=hi,va.call(Rt))}):Lr={};var Wi=Object.keys(Or.patternDependencies);function va(){if(Et)return ot(Et);if(Zt&&Lr&&ir){var Pi=new L(Zt),hi=new o.ImageAtlas(Lr,ir);for(var Ii in ur){var La=ur[Ii];La instanceof o.SymbolBucket?(E(La.layers,this.zoom,ze),o.performSymbolLayout(La,Zt,Pi.positions,Lr,hi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):La.hasPattern&&(La instanceof o.LineBucket||La instanceof o.FillBucket||La instanceof o.FillExtrusionBucket)&&(E(La.layers,this.zoom,ze),La.addFeatures(Or,this.tileID.canonical,hi.patternPositions))}this.status="done",ot(null,{buckets:o.values(ur).filter(function(ls){return!ls.isEmpty()}),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pi.image,imageAtlas:hi,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?Lr:null,glyphPositions:this.returnDependencies?Pi.positions:null})}}Wi.length?Ke.send("getImages",{icons:Wi,source:this.source,tileID:this.tileID,type:"patterns"},function(Pi,hi){Et||(Et=Pi,ir=hi,va.call(Rt))}):ir={},va.call(this)};var k=function(Ee,ke,ze,Ke){this.actor=Ee,this.layerIndex=ke,this.availableImages=ze,this.loadVectorData=Ke||g,this.loading={},this.loaded={}};k.prototype.loadTile=function(Ee,ke){var ze=this,Ke=Ee.uid;this.loading||(this.loading={});var ot=!!(Ee&&Ee.request&&Ee.request.collectResourceTiming)&&new o.RequestPerformance(Ee.request),Rt=this.loading[Ke]=new d(Ee);Rt.abort=this.loadVectorData(Ee,function(Nt,Ye){if(delete ze.loading[Ke],Nt||!Ye)return Rt.status="done",ze.loaded[Ke]=Rt,ke(Nt);var Et=Ye.rawData,Zt={};Ye.expires&&(Zt.expires=Ye.expires),Ye.cacheControl&&(Zt.cacheControl=Ye.cacheControl);var Lr={};if(ot){var ir=ot.finish();ir&&(Lr.resourceTiming=JSON.parse(JSON.stringify(ir)))}Rt.vectorTile=Ye.vectorTile,Rt.parse(Ye.vectorTile,ze.layerIndex,ze.availableImages,ze.actor,function(ur,Or){if(ur||!Or)return ke(ur);ke(null,o.extend({rawTileData:Et.slice(0)},Or,Zt,Lr))}),ze.loaded=ze.loaded||{},ze.loaded[Ke]=Rt})},k.prototype.reloadTile=function(Ee,ke){var ze=this,Ke=this.loaded,ot=Ee.uid,Rt=this;if(Ke&&Ke[ot]){var Nt=Ke[ot];Nt.showCollisionBoxes=Ee.showCollisionBoxes;var Ye=function(Et,Zt){var Lr=Nt.reloadCallback;Lr&&(delete Nt.reloadCallback,Nt.parse(Nt.vectorTile,Rt.layerIndex,ze.availableImages,Rt.actor,Lr)),ke(Et,Zt)};Nt.status==="parsing"?Nt.reloadCallback=Ye:Nt.status==="done"&&(Nt.vectorTile?Nt.parse(Nt.vectorTile,this.layerIndex,this.availableImages,this.actor,Ye):Ye())}},k.prototype.abortTile=function(Ee,ke){var ze=this.loading,Ke=Ee.uid;ze&&ze[Ke]&&ze[Ke].abort&&(ze[Ke].abort(),delete ze[Ke]),ke()},k.prototype.removeTile=function(Ee,ke){var ze=this.loaded,Ke=Ee.uid;ze&&ze[Ke]&&delete ze[Ke],ke()};var M=o.window.ImageBitmap,j=function(){this.loaded={}};function U(Ee,ke){if(Ee.length!==0){I(Ee[0],ke);for(var ze=1;ze<Ee.length;ze++)I(Ee[ze],!ke)}}function I(Ee,ke){for(var ze=0,Ke=0,ot=Ee.length,Rt=ot-1;Ke<ot;Rt=Ke++)ze+=(Ee[Ke][0]-Ee[Rt][0])*(Ee[Rt][1]+Ee[Ke][1]);ze>=0!=!!ke&&Ee.reverse()}j.prototype.loadTile=function(Ee,ke){var ze=Ee.uid,Ke=Ee.encoding,ot=Ee.rawImageData,Rt=M&&ot instanceof M?this.getImageData(ot):ot,Nt=new o.DEMData(ze,Rt,Ke);this.loaded=this.loaded||{},this.loaded[ze]=Nt,ke(null,Nt)},j.prototype.getImageData=function(Ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Ee.width,Ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Ee.width,this.offscreenCanvas.height=Ee.height,this.offscreenCanvasContext.drawImage(Ee,0,0,Ee.width,Ee.height);var ke=this.offscreenCanvasContext.getImageData(-1,-1,Ee.width+2,Ee.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:ke.width,height:ke.height},ke.data)},j.prototype.removeTile=function(Ee){var ke=this.loaded,ze=Ee.uid;ke&&ke[ze]&&delete ke[ze]};var O=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,D=function(Ee){this._feature=Ee,this.extent=o.EXTENT,this.type=Ee.type,this.properties=Ee.tags,"id"in Ee&&!isNaN(Ee.id)&&(this.id=parseInt(Ee.id,10))};D.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Ee=[],ke=0,ze=this._feature.geometry;ke<ze.length;ke+=1){var Ke=ze[ke];Ee.push([new o.Point$1(Ke[0],Ke[1])])}return Ee}for(var ot=[],Rt=0,Nt=this._feature.geometry;Rt<Nt.length;Rt+=1){for(var Ye=[],Et=0,Zt=Nt[Rt];Et<Zt.length;Et+=1){var Lr=Zt[Et];Ye.push(new o.Point$1(Lr[0],Lr[1]))}ot.push(Ye)}return ot},D.prototype.toGeoJSON=function(Ee,ke,ze){return O.call(this,Ee,ke,ze)};var R=function(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Ee.length,this._features=Ee};R.prototype.feature=function(Ee){return new D(this._features[Ee])};var y=o.vectorTile.VectorTileFeature,v=h;function h(Ee,ke){this.options=ke||{},this.features=Ee,this.length=Ee.length}function S(Ee,ke){this.id=typeof Ee.id=="number"?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=Ee.type===1?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=ke||4096}h.prototype.feature=function(Ee){return new S(this.features[Ee],this.options.extent)},S.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var ke=0;ke<Ee.length;ke++){for(var ze=Ee[ke],Ke=[],ot=0;ot<ze.length;ot++)Ke.push(new o.Point$1(ze[ot][0],ze[ot][1]));this.geometry.push(Ke)}return this.geometry},S.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,ke=1/0,ze=-1/0,Ke=1/0,ot=-1/0,Rt=0;Rt<Ee.length;Rt++)for(var Nt=Ee[Rt],Ye=0;Ye<Nt.length;Ye++){var Et=Nt[Ye];ke=Math.min(ke,Et.x),ze=Math.max(ze,Et.x),Ke=Math.min(Ke,Et.y),ot=Math.max(ot,Et.y)}return[ke,Ke,ze,ot]},S.prototype.toGeoJSON=y.prototype.toGeoJSON;var A=z,x=v;function z(Ee){var ke=new o.pbf;return function(ze,Ke){for(var ot in ze.layers)Ke.writeMessage(3,B,ze.layers[ot])}(Ee,ke),ke.finish()}function B(Ee,ke){var ze;ke.writeVarintField(15,Ee.version||1),ke.writeStringField(1,Ee.name||""),ke.writeVarintField(5,Ee.extent||4096);var Ke={keys:[],values:[],keycache:{},valuecache:{}};for(ze=0;ze<Ee.length;ze++)Ke.feature=Ee.feature(ze),ke.writeMessage(2,V,Ke);var ot=Ke.keys;for(ze=0;ze<ot.length;ze++)ke.writeStringField(3,ot[ze]);var Rt=Ke.values;for(ze=0;ze<Rt.length;ze++)ke.writeMessage(4,ee,Rt[ze])}function V(Ee,ke){var ze=Ee.feature;ze.id!==void 0&&ke.writeVarintField(1,ze.id),ke.writeMessage(2,Q,Ee),ke.writeVarintField(3,ze.type),ke.writeMessage(4,Z,ze)}function Q(Ee,ke){var ze=Ee.feature,Ke=Ee.keys,ot=Ee.values,Rt=Ee.keycache,Nt=Ee.valuecache;for(var Ye in ze.properties){var Et=Rt[Ye];Et===void 0&&(Ke.push(Ye),Rt[Ye]=Et=Ke.length-1),ke.writeVarint(Et);var Zt=ze.properties[Ye],Lr=typeof Zt;Lr!=="string"&&Lr!=="boolean"&&Lr!=="number"&&(Zt=JSON.stringify(Zt));var ir=Lr+":"+Zt,ur=Nt[ir];ur===void 0&&(ot.push(Zt),Nt[ir]=ur=ot.length-1),ke.writeVarint(ur)}}function oe(Ee,ke){return(ke<<3)+(7&Ee)}function re(Ee){return Ee<<1^Ee>>31}function Z(Ee,ke){for(var ze=Ee.loadGeometry(),Ke=Ee.type,ot=0,Rt=0,Nt=ze.length,Ye=0;Ye<Nt;Ye++){var Et=ze[Ye],Zt=1;Ke===1&&(Zt=Et.length),ke.writeVarint(oe(1,Zt));for(var Lr=Ke===3?Et.length-1:Et.length,ir=0;ir<Lr;ir++){ir===1&&Ke!==1&&ke.writeVarint(oe(2,Lr-1));var ur=Et[ir].x-ot,Or=Et[ir].y-Rt;ke.writeVarint(re(ur)),ke.writeVarint(re(Or)),ot+=ur,Rt+=Or}Ke===3&&ke.writeVarint(oe(7,1))}}function ee(Ee,ke){var ze=typeof Ee;ze==="string"?ke.writeStringField(1,Ee):ze==="boolean"?ke.writeBooleanField(7,Ee):ze==="number"&&(Ee%1!=0?ke.writeDoubleField(3,Ee):Ee<0?ke.writeSVarintField(6,Ee):ke.writeVarintField(5,Ee))}function H(Ee,ke,ze,Ke){ae(Ee,ze,Ke),ae(ke,2*ze,2*Ke),ae(ke,2*ze+1,2*Ke+1)}function ae(Ee,ke,ze){var Ke=Ee[ke];Ee[ke]=Ee[ze],Ee[ze]=Ke}function G(Ee,ke,ze,Ke){var ot=Ee-ze,Rt=ke-Ke;return ot*ot+Rt*Rt}A.fromVectorTileJs=z,A.fromGeojsonVt=function(Ee,ke){ke=ke||{};var ze={};for(var Ke in Ee)ze[Ke]=new v(Ee[Ke].features,ke),ze[Ke].name=Ke,ze[Ke].version=ke.version,ze[Ke].extent=ke.extent;return z({layers:ze})},A.GeoJSONWrapper=x;var ie=function(Ee){return Ee[0]},le=function(Ee){return Ee[1]},Me=function(Ee,ke,ze,Ke,ot){ke===void 0&&(ke=ie),ze===void 0&&(ze=le),Ke===void 0&&(Ke=64),ot===void 0&&(ot=Float64Array),this.nodeSize=Ke,this.points=Ee;for(var Rt=Ee.length<65536?Uint16Array:Uint32Array,Nt=this.ids=new Rt(Ee.length),Ye=this.coords=new ot(2*Ee.length),Et=0;Et<Ee.length;Et++)Nt[Et]=Et,Ye[2*Et]=ke(Ee[Et]),Ye[2*Et+1]=ze(Ee[Et]);(function Zt(Lr,ir,ur,Or,nn,Hr){if(!(nn-Or<=ur)){var gr=Or+nn>>1;(function vn(an,sn,Ei,fn,ni,Ui){for(;ni>fn;){if(ni-fn>600){var mi=ni-fn+1,Li=Ei-fn+1,ui=Math.log(mi),fi=.5*Math.exp(2*ui/3),Wi=.5*Math.sqrt(ui*fi*(mi-fi)/mi)*(Li-mi/2<0?-1:1);vn(an,sn,Ei,Math.max(fn,Math.floor(Ei-Li*fi/mi+Wi)),Math.min(ni,Math.floor(Ei+(mi-Li)*fi/mi+Wi)),Ui)}var va=sn[2*Ei+Ui],Pi=fn,hi=ni;for(H(an,sn,fn,Ei),sn[2*ni+Ui]>va&&H(an,sn,fn,ni);Pi<hi;){for(H(an,sn,Pi,hi),Pi++,hi--;sn[2*Pi+Ui]<va;)Pi++;for(;sn[2*hi+Ui]>va;)hi--}sn[2*fn+Ui]===va?H(an,sn,fn,hi):H(an,sn,++hi,ni),hi<=Ei&&(fn=hi+1),Ei<=hi&&(ni=hi-1)}})(Lr,ir,gr,Or,nn,Hr%2),Zt(Lr,ir,ur,Or,gr-1,Hr+1),Zt(Lr,ir,ur,gr+1,nn,Hr+1)}})(Nt,Ye,Ke,0,Nt.length-1,0)};Me.prototype.range=function(Ee,ke,ze,Ke){return function(ot,Rt,Nt,Ye,Et,Zt,Lr){for(var ir,ur,Or=[0,ot.length-1,0],nn=[];Or.length;){var Hr=Or.pop(),gr=Or.pop(),vn=Or.pop();if(gr-vn<=Lr)for(var an=vn;an<=gr;an++)ur=Rt[2*an+1],(ir=Rt[2*an])>=Nt&&ir<=Et&&ur>=Ye&&ur<=Zt&&nn.push(ot[an]);else{var sn=Math.floor((vn+gr)/2);ur=Rt[2*sn+1],(ir=Rt[2*sn])>=Nt&&ir<=Et&&ur>=Ye&&ur<=Zt&&nn.push(ot[sn]);var Ei=(Hr+1)%2;(Hr===0?Nt<=ir:Ye<=ur)&&(Or.push(vn),Or.push(sn-1),Or.push(Ei)),(Hr===0?Et>=ir:Zt>=ur)&&(Or.push(sn+1),Or.push(gr),Or.push(Ei))}}return nn}(this.ids,this.coords,Ee,ke,ze,Ke,this.nodeSize)},Me.prototype.within=function(Ee,ke,ze){return function(Ke,ot,Rt,Nt,Ye,Et){for(var Zt=[0,Ke.length-1,0],Lr=[],ir=Ye*Ye;Zt.length;){var ur=Zt.pop(),Or=Zt.pop(),nn=Zt.pop();if(Or-nn<=Et)for(var Hr=nn;Hr<=Or;Hr++)G(ot[2*Hr],ot[2*Hr+1],Rt,Nt)<=ir&&Lr.push(Ke[Hr]);else{var gr=Math.floor((nn+Or)/2),vn=ot[2*gr],an=ot[2*gr+1];G(vn,an,Rt,Nt)<=ir&&Lr.push(Ke[gr]);var sn=(ur+1)%2;(ur===0?Rt-Ye<=vn:Nt-Ye<=an)&&(Zt.push(nn),Zt.push(gr-1),Zt.push(sn)),(ur===0?Rt+Ye>=vn:Nt+Ye>=an)&&(Zt.push(gr+1),Zt.push(Or),Zt.push(sn))}}return Lr}(this.ids,this.coords,Ee,ke,ze,this.nodeSize)};var ge={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ee){return Ee}},pe=function(Ee){this.options=me(Object.create(ge),Ee),this.trees=new Array(this.options.maxZoom+1)};function Ne(Ee,ke,ze,Ke,ot){return{x:Ee,y:ke,zoom:1/0,id:ze,parentId:-1,numPoints:Ke,properties:ot}}function Re(Ee,ke){var ze=Ee.geometry.coordinates,Ke=ze[1];return{x:J(ze[0]),y:fe(Ke),zoom:1/0,index:ke,parentId:-1}}function he(Ee){return{type:"Feature",id:Ee.id,properties:se(Ee),geometry:{type:"Point",coordinates:[(Ke=Ee.x,360*(Ke-.5)),(ke=Ee.y,ze=(180-360*ke)*Math.PI/180,360*Math.atan(Math.exp(ze))/Math.PI-90)]}};var ke,ze,Ke}function se(Ee){var ke=Ee.numPoints,ze=ke>=1e4?Math.round(ke/1e3)+"k":ke>=1e3?Math.round(ke/100)/10+"k":ke;return me(me({},Ee.properties),{cluster:!0,cluster_id:Ee.id,point_count:ke,point_count_abbreviated:ze})}function J(Ee){return Ee/360+.5}function fe(Ee){var ke=Math.sin(Ee*Math.PI/180),ze=.5-.25*Math.log((1+ke)/(1-ke))/Math.PI;return ze<0?0:ze>1?1:ze}function me(Ee,ke){for(var ze in ke)Ee[ze]=ke[ze];return Ee}function Le(Ee){return Ee.x}function C(Ee){return Ee.y}function X(Ee,ke,ze,Ke,ot,Rt){var Nt=ot-ze,Ye=Rt-Ke;if(Nt!==0||Ye!==0){var Et=((Ee-ze)*Nt+(ke-Ke)*Ye)/(Nt*Nt+Ye*Ye);Et>1?(ze=ot,Ke=Rt):Et>0&&(ze+=Nt*Et,Ke+=Ye*Et)}return(Nt=Ee-ze)*Nt+(Ye=ke-Ke)*Ye}function de(Ee,ke,ze,Ke){var ot={id:Ee===void 0?null:Ee,type:ke,geometry:ze,tags:Ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Rt){var Nt=Rt.geometry,Ye=Rt.type;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")Ae(Rt,Nt);else if(Ye==="Polygon"||Ye==="MultiLineString")for(var Et=0;Et<Nt.length;Et++)Ae(Rt,Nt[Et]);else if(Ye==="MultiPolygon")for(Et=0;Et<Nt.length;Et++)for(var Zt=0;Zt<Nt[Et].length;Zt++)Ae(Rt,Nt[Et][Zt])}(ot),ot}function Ae(Ee,ke){for(var ze=0;ze<ke.length;ze+=3)Ee.minX=Math.min(Ee.minX,ke[ze]),Ee.minY=Math.min(Ee.minY,ke[ze+1]),Ee.maxX=Math.max(Ee.maxX,ke[ze]),Ee.maxY=Math.max(Ee.maxY,ke[ze+1])}function De(Ee,ke,ze,Ke){if(ke.geometry){var ot=ke.geometry.coordinates,Rt=ke.geometry.type,Nt=Math.pow(ze.tolerance/((1<<ze.maxZoom)*ze.extent),2),Ye=[],Et=ke.id;if(ze.promoteId?Et=ke.properties[ze.promoteId]:ze.generateId&&(Et=Ke||0),Rt==="Point")Ge(ot,Ye);else if(Rt==="MultiPoint")for(var Zt=0;Zt<ot.length;Zt++)Ge(ot[Zt],Ye);else if(Rt==="LineString")$e(ot,Ye,Nt,!1);else if(Rt==="MultiLineString"){if(ze.lineMetrics){for(Zt=0;Zt<ot.length;Zt++)$e(ot[Zt],Ye=[],Nt,!1),Ee.push(de(Et,"LineString",Ye,ke.properties));return}ct(ot,Ye,Nt,!1)}else if(Rt==="Polygon")ct(ot,Ye,Nt,!0);else{if(Rt!=="MultiPolygon"){if(Rt==="GeometryCollection"){for(Zt=0;Zt<ke.geometry.geometries.length;Zt++)De(Ee,{id:Et,geometry:ke.geometry.geometries[Zt],properties:ke.properties},ze,Ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Zt=0;Zt<ot.length;Zt++){var Lr=[];ct(ot[Zt],Lr,Nt,!0),Ye.push(Lr)}}Ee.push(de(Et,Rt,Ye,ke.properties))}}function Ge(Ee,ke){ke.push(gt(Ee[0])),ke.push(st(Ee[1])),ke.push(0)}function $e(Ee,ke,ze,Ke){for(var ot,Rt,Nt=0,Ye=0;Ye<Ee.length;Ye++){var Et=gt(Ee[Ye][0]),Zt=st(Ee[Ye][1]);ke.push(Et),ke.push(Zt),ke.push(0),Ye>0&&(Nt+=Ke?(ot*Zt-Et*Rt)/2:Math.sqrt(Math.pow(Et-ot,2)+Math.pow(Zt-Rt,2))),ot=Et,Rt=Zt}var Lr=ke.length-3;ke[2]=1,function ir(ur,Or,nn,Hr){for(var gr,vn=Hr,an=nn-Or>>1,sn=nn-Or,Ei=ur[Or],fn=ur[Or+1],ni=ur[nn],Ui=ur[nn+1],mi=Or+3;mi<nn;mi+=3){var Li=X(ur[mi],ur[mi+1],Ei,fn,ni,Ui);if(Li>vn)gr=mi,vn=Li;else if(Li===vn){var ui=Math.abs(mi-an);ui<sn&&(gr=mi,sn=ui)}}vn>Hr&&(gr-Or>3&&ir(ur,Or,gr,Hr),ur[gr+2]=vn,nn-gr>3&&ir(ur,gr,nn,Hr))}(ke,0,Lr,ze),ke[Lr+2]=1,ke.size=Math.abs(Nt),ke.start=0,ke.end=ke.size}function ct(Ee,ke,ze,Ke){for(var ot=0;ot<Ee.length;ot++){var Rt=[];$e(Ee[ot],Rt,ze,Ke),ke.push(Rt)}}function gt(Ee){return Ee/360+.5}function st(Ee){var ke=Math.sin(Ee*Math.PI/180),ze=.5-.25*Math.log((1+ke)/(1-ke))/Math.PI;return ze<0?0:ze>1?1:ze}function xe(Ee,ke,ze,Ke,ot,Rt,Nt,Ye){if(Ke/=ke,Rt>=(ze/=ke)&&Nt<Ke)return Ee;if(Nt<ze||Rt>=Ke)return null;for(var Et=[],Zt=0;Zt<Ee.length;Zt++){var Lr=Ee[Zt],ir=Lr.geometry,ur=Lr.type,Or=ot===0?Lr.minX:Lr.minY,nn=ot===0?Lr.maxX:Lr.maxY;if(Or>=ze&&nn<Ke)Et.push(Lr);else if(!(nn<ze||Or>=Ke)){var Hr=[];if(ur==="Point"||ur==="MultiPoint")Mt(ir,Hr,ze,Ke,ot);else if(ur==="LineString")Ut(ir,Hr,ze,Ke,ot,!1,Ye.lineMetrics);else if(ur==="MultiLineString")nt(ir,Hr,ze,Ke,ot,!1);else if(ur==="Polygon")nt(ir,Hr,ze,Ke,ot,!0);else if(ur==="MultiPolygon")for(var gr=0;gr<ir.length;gr++){var vn=[];nt(ir[gr],vn,ze,Ke,ot,!0),vn.length&&Hr.push(vn)}if(Hr.length){if(Ye.lineMetrics&&ur==="LineString"){for(gr=0;gr<Hr.length;gr++)Et.push(de(Lr.id,ur,Hr[gr],Lr.tags));continue}ur!=="LineString"&&ur!=="MultiLineString"||(Hr.length===1?(ur="LineString",Hr=Hr[0]):ur="MultiLineString"),ur!=="Point"&&ur!=="MultiPoint"||(ur=Hr.length===3?"Point":"MultiPoint"),Et.push(de(Lr.id,ur,Hr,Lr.tags))}}}return Et.length?Et:null}function Mt(Ee,ke,ze,Ke,ot){for(var Rt=0;Rt<Ee.length;Rt+=3){var Nt=Ee[Rt+ot];Nt>=ze&&Nt<=Ke&&(ke.push(Ee[Rt]),ke.push(Ee[Rt+1]),ke.push(Ee[Rt+2]))}}function Ut(Ee,ke,ze,Ke,ot,Rt,Nt){for(var Ye,Et,Zt=At(Ee),Lr=ot===0?pt:Vt,ir=Ee.start,ur=0;ur<Ee.length-3;ur+=3){var Or=Ee[ur],nn=Ee[ur+1],Hr=Ee[ur+2],gr=Ee[ur+3],vn=Ee[ur+4],an=ot===0?Or:nn,sn=ot===0?gr:vn,Ei=!1;Nt&&(Ye=Math.sqrt(Math.pow(Or-gr,2)+Math.pow(nn-vn,2))),an<ze?sn>ze&&(Et=Lr(Zt,Or,nn,gr,vn,ze),Nt&&(Zt.start=ir+Ye*Et)):an>Ke?sn<Ke&&(Et=Lr(Zt,Or,nn,gr,vn,Ke),Nt&&(Zt.start=ir+Ye*Et)):it(Zt,Or,nn,Hr),sn<ze&&an>=ze&&(Et=Lr(Zt,Or,nn,gr,vn,ze),Ei=!0),sn>Ke&&an<=Ke&&(Et=Lr(Zt,Or,nn,gr,vn,Ke),Ei=!0),!Rt&&Ei&&(Nt&&(Zt.end=ir+Ye*Et),ke.push(Zt),Zt=At(Ee)),Nt&&(ir+=Ye)}var fn=Ee.length-3;Or=Ee[fn],nn=Ee[fn+1],Hr=Ee[fn+2],(an=ot===0?Or:nn)>=ze&&an<=Ke&&it(Zt,Or,nn,Hr),fn=Zt.length-3,Rt&&fn>=3&&(Zt[fn]!==Zt[0]||Zt[fn+1]!==Zt[1])&&it(Zt,Zt[0],Zt[1],Zt[2]),Zt.length&&ke.push(Zt)}function At(Ee){var ke=[];return ke.size=Ee.size,ke.start=Ee.start,ke.end=Ee.end,ke}function nt(Ee,ke,ze,Ke,ot,Rt){for(var Nt=0;Nt<Ee.length;Nt++)Ut(Ee[Nt],ke,ze,Ke,ot,Rt,!1)}function it(Ee,ke,ze,Ke){Ee.push(ke),Ee.push(ze),Ee.push(Ke)}function pt(Ee,ke,ze,Ke,ot,Rt){var Nt=(Rt-ke)/(Ke-ke);return Ee.push(Rt),Ee.push(ze+(ot-ze)*Nt),Ee.push(1),Nt}function Vt(Ee,ke,ze,Ke,ot,Rt){var Nt=(Rt-ze)/(ot-ze);return Ee.push(ke+(Ke-ke)*Nt),Ee.push(Rt),Ee.push(1),Nt}function Er(Ee,ke){for(var ze=[],Ke=0;Ke<Ee.length;Ke++){var ot,Rt=Ee[Ke],Nt=Rt.type;if(Nt==="Point"||Nt==="MultiPoint"||Nt==="LineString")ot=mr(Rt.geometry,ke);else if(Nt==="MultiLineString"||Nt==="Polygon"){ot=[];for(var Ye=0;Ye<Rt.geometry.length;Ye++)ot.push(mr(Rt.geometry[Ye],ke))}else if(Nt==="MultiPolygon")for(ot=[],Ye=0;Ye<Rt.geometry.length;Ye++){for(var Et=[],Zt=0;Zt<Rt.geometry[Ye].length;Zt++)Et.push(mr(Rt.geometry[Ye][Zt],ke));ot.push(Et)}ze.push(de(Rt.id,Nt,ot,Rt.tags))}return ze}function mr(Ee,ke){var ze=[];ze.size=Ee.size,Ee.start!==void 0&&(ze.start=Ee.start,ze.end=Ee.end);for(var Ke=0;Ke<Ee.length;Ke+=3)ze.push(Ee[Ke]+ke,Ee[Ke+1],Ee[Ke+2]);return ze}function Br(Ee,ke){if(Ee.transformed)return Ee;var ze,Ke,ot,Rt=1<<Ee.z,Nt=Ee.x,Ye=Ee.y;for(ze=0;ze<Ee.features.length;ze++){var Et=Ee.features[ze],Zt=Et.geometry,Lr=Et.type;if(Et.geometry=[],Lr===1)for(Ke=0;Ke<Zt.length;Ke+=2)Et.geometry.push(Ur(Zt[Ke],Zt[Ke+1],ke,Rt,Nt,Ye));else for(Ke=0;Ke<Zt.length;Ke++){var ir=[];for(ot=0;ot<Zt[Ke].length;ot+=2)ir.push(Ur(Zt[Ke][ot],Zt[Ke][ot+1],ke,Rt,Nt,Ye));Et.geometry.push(ir)}}return Ee.transformed=!0,Ee}function Ur(Ee,ke,ze,Ke,ot,Rt){return[Math.round(ze*(Ee*Ke-ot)),Math.round(ze*(ke*Ke-Rt))]}function Ar(Ee,ke,ze,Ke,ot){for(var Rt=ke===ot.maxZoom?0:ot.tolerance/((1<<ke)*ot.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ze,y:Ke,z:ke,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ye=0;Ye<Ee.length;Ye++){Nt.numFeatures++,Nn(Nt,Ee[Ye],Rt,ot);var Et=Ee[Ye].minX,Zt=Ee[Ye].minY,Lr=Ee[Ye].maxX,ir=Ee[Ye].maxY;Et<Nt.minX&&(Nt.minX=Et),Zt<Nt.minY&&(Nt.minY=Zt),Lr>Nt.maxX&&(Nt.maxX=Lr),ir>Nt.maxY&&(Nt.maxY=ir)}return Nt}function Nn(Ee,ke,ze,Ke){var ot=ke.geometry,Rt=ke.type,Nt=[];if(Rt==="Point"||Rt==="MultiPoint")for(var Ye=0;Ye<ot.length;Ye+=3)Nt.push(ot[Ye]),Nt.push(ot[Ye+1]),Ee.numPoints++,Ee.numSimplified++;else if(Rt==="LineString")Rn(Nt,ot,Ee,ze,!1,!1);else if(Rt==="MultiLineString"||Rt==="Polygon")for(Ye=0;Ye<ot.length;Ye++)Rn(Nt,ot[Ye],Ee,ze,Rt==="Polygon",Ye===0);else if(Rt==="MultiPolygon")for(var Et=0;Et<ot.length;Et++){var Zt=ot[Et];for(Ye=0;Ye<Zt.length;Ye++)Rn(Nt,Zt[Ye],Ee,ze,!0,Ye===0)}if(Nt.length){var Lr=ke.tags||null;if(Rt==="LineString"&&Ke.lineMetrics){for(var ir in Lr={},ke.tags)Lr[ir]=ke.tags[ir];Lr.mapbox_clip_start=ot.start/ot.size,Lr.mapbox_clip_end=ot.end/ot.size}var ur={geometry:Nt,type:Rt==="Polygon"||Rt==="MultiPolygon"?3:Rt==="LineString"||Rt==="MultiLineString"?2:1,tags:Lr};ke.id!==null&&(ur.id=ke.id),Ee.features.push(ur)}}function Rn(Ee,ke,ze,Ke,ot,Rt){var Nt=Ke*Ke;if(Ke>0&&ke.size<(ot?Nt:Ke))ze.numPoints+=ke.length/3;else{for(var Ye=[],Et=0;Et<ke.length;Et+=3)(Ke===0||ke[Et+2]>Nt)&&(ze.numSimplified++,Ye.push(ke[Et]),Ye.push(ke[Et+1])),ze.numPoints++;ot&&function(Zt,Lr){for(var ir=0,ur=0,Or=Zt.length,nn=Or-2;ur<Or;nn=ur,ur+=2)ir+=(Zt[ur]-Zt[nn])*(Zt[ur+1]+Zt[nn+1]);if(ir>0===Lr)for(ur=0,Or=Zt.length;ur<Or/2;ur+=2){var Hr=Zt[ur],gr=Zt[ur+1];Zt[ur]=Zt[Or-2-ur],Zt[ur+1]=Zt[Or-1-ur],Zt[Or-2-ur]=Hr,Zt[Or-1-ur]=gr}}(Ye,Rt),Ee.push(Ye)}}function ci(Ee,ke){var ze=(ke=this.options=function(ot,Rt){for(var Nt in Rt)ot[Nt]=Rt[Nt];return ot}(Object.create(this.options),ke)).debug;if(ze&&console.time("preprocess data"),ke.maxZoom<0||ke.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ke.promoteId&&ke.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ke=function(ot,Rt){var Nt=[];if(ot.type==="FeatureCollection")for(var Ye=0;Ye<ot.features.length;Ye++)De(Nt,ot.features[Ye],Rt,Ye);else De(Nt,ot.type==="Feature"?ot:{geometry:ot},Rt);return Nt}(Ee,ke);this.tiles={},this.tileCoords=[],ze&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ke.indexMaxZoom,ke.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ke=function(ot,Rt){var Nt=Rt.buffer/Rt.extent,Ye=ot,Et=xe(ot,1,-1-Nt,Nt,0,-1,2,Rt),Zt=xe(ot,1,1-Nt,2+Nt,0,-1,2,Rt);return(Et||Zt)&&(Ye=xe(ot,1,-Nt,1+Nt,0,-1,2,Rt)||[],Et&&(Ye=Er(Et,1).concat(Ye)),Zt&&(Ye=Ye.concat(Er(Zt,-1)))),Ye}(Ke,ke)).length&&this.splitTile(Ke,0,0,0),ze&&(Ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fi(Ee,ke,ze){return 32*((1<<Ee)*ze+ke)+Ee}function ji(Ee,ke){var ze=Ee.tileID.canonical;if(!this._geoJSONIndex)return ke(null,null);var Ke=this._geoJSONIndex.getTile(ze.z,ze.x,ze.y);if(!Ke)return ke(null,null);var ot=new R(Ke.features),Rt=A(ot);Rt.byteOffset===0&&Rt.byteLength===Rt.buffer.byteLength||(Rt=new Uint8Array(Rt)),ke(null,{vectorTile:ot,rawData:Rt.buffer})}pe.prototype.load=function(Ee){var ke=this.options,ze=ke.log,Ke=ke.minZoom,ot=ke.maxZoom,Rt=ke.nodeSize;ze&&console.time("total time");var Nt="prepare "+Ee.length+" points";ze&&console.time(Nt),this.points=Ee;for(var Ye=[],Et=0;Et<Ee.length;Et++)Ee[Et].geometry&&Ye.push(Re(Ee[Et],Et));this.trees[ot+1]=new Me(Ye,Le,C,Rt,Float32Array),ze&&console.timeEnd(Nt);for(var Zt=ot;Zt>=Ke;Zt--){var Lr=+Date.now();Ye=this._cluster(Ye,Zt),this.trees[Zt]=new Me(Ye,Le,C,Rt,Float32Array),ze&&console.log("z%d: %d clusters in %dms",Zt,Ye.length,+Date.now()-Lr)}return ze&&console.timeEnd("total time"),this},pe.prototype.getClusters=function(Ee,ke){var ze=((Ee[0]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,Ee[1])),ot=Ee[2]===180?180:((Ee[2]+180)%360+360)%360-180,Rt=Math.max(-90,Math.min(90,Ee[3]));if(Ee[2]-Ee[0]>=360)ze=-180,ot=180;else if(ze>ot){var Nt=this.getClusters([ze,Ke,180,Rt],ke),Ye=this.getClusters([-180,Ke,ot,Rt],ke);return Nt.concat(Ye)}for(var Et=this.trees[this._limitZoom(ke)],Zt=[],Lr=0,ir=Et.range(J(ze),fe(Rt),J(ot),fe(Ke));Lr<ir.length;Lr+=1){var ur=Et.points[ir[Lr]];Zt.push(ur.numPoints?he(ur):this.points[ur.index])}return Zt},pe.prototype.getChildren=function(Ee){var ke=this._getOriginId(Ee),ze=this._getOriginZoom(Ee),Ke="No cluster with the specified id.",ot=this.trees[ze];if(!ot)throw new Error(Ke);var Rt=ot.points[ke];if(!Rt)throw new Error(Ke);for(var Nt=this.options.radius/(this.options.extent*Math.pow(2,ze-1)),Ye=[],Et=0,Zt=ot.within(Rt.x,Rt.y,Nt);Et<Zt.length;Et+=1){var Lr=ot.points[Zt[Et]];Lr.parentId===Ee&&Ye.push(Lr.numPoints?he(Lr):this.points[Lr.index])}if(Ye.length===0)throw new Error(Ke);return Ye},pe.prototype.getLeaves=function(Ee,ke,ze){var Ke=[];return this._appendLeaves(Ke,Ee,ke=ke||10,ze=ze||0,0),Ke},pe.prototype.getTile=function(Ee,ke,ze){var Ke=this.trees[this._limitZoom(Ee)],ot=Math.pow(2,Ee),Rt=this.options,Nt=Rt.radius/Rt.extent,Ye=(ze-Nt)/ot,Et=(ze+1+Nt)/ot,Zt={features:[]};return this._addTileFeatures(Ke.range((ke-Nt)/ot,Ye,(ke+1+Nt)/ot,Et),Ke.points,ke,ze,ot,Zt),ke===0&&this._addTileFeatures(Ke.range(1-Nt/ot,Ye,1,Et),Ke.points,ot,ze,ot,Zt),ke===ot-1&&this._addTileFeatures(Ke.range(0,Ye,Nt/ot,Et),Ke.points,-1,ze,ot,Zt),Zt.features.length?Zt:null},pe.prototype.getClusterExpansionZoom=function(Ee){for(var ke=this._getOriginZoom(Ee)-1;ke<=this.options.maxZoom;){var ze=this.getChildren(Ee);if(ke++,ze.length!==1)break;Ee=ze[0].properties.cluster_id}return ke},pe.prototype._appendLeaves=function(Ee,ke,ze,Ke,ot){for(var Rt=0,Nt=this.getChildren(ke);Rt<Nt.length;Rt+=1){var Ye=Nt[Rt],Et=Ye.properties;if(Et&&Et.cluster?ot+Et.point_count<=Ke?ot+=Et.point_count:ot=this._appendLeaves(Ee,Et.cluster_id,ze,Ke,ot):ot<Ke?ot++:Ee.push(Ye),Ee.length===ze)break}return ot},pe.prototype._addTileFeatures=function(Ee,ke,ze,Ke,ot,Rt){for(var Nt=0,Ye=Ee;Nt<Ye.length;Nt+=1){var Et=ke[Ye[Nt]],Zt=Et.numPoints,Lr={type:1,geometry:[[Math.round(this.options.extent*(Et.x*ot-ze)),Math.round(this.options.extent*(Et.y*ot-Ke))]],tags:Zt?se(Et):this.points[Et.index].properties},ir=void 0;Zt?ir=Et.id:this.options.generateId?ir=Et.index:this.points[Et.index].id&&(ir=this.points[Et.index].id),ir!==void 0&&(Lr.id=ir),Rt.features.push(Lr)}},pe.prototype._limitZoom=function(Ee){return Math.max(this.options.minZoom,Math.min(+Ee,this.options.maxZoom+1))},pe.prototype._cluster=function(Ee,ke){for(var ze=[],Ke=this.options,ot=Ke.reduce,Rt=Ke.minPoints,Nt=Ke.radius/(Ke.extent*Math.pow(2,ke)),Ye=0;Ye<Ee.length;Ye++){var Et=Ee[Ye];if(!(Et.zoom<=ke)){Et.zoom=ke;for(var Zt=this.trees[ke+1],Lr=Zt.within(Et.x,Et.y,Nt),ir=Et.numPoints||1,ur=ir,Or=0,nn=Lr;Or<nn.length;Or+=1){var Hr=Zt.points[nn[Or]];Hr.zoom>ke&&(ur+=Hr.numPoints||1)}if(ur>=Rt){for(var gr=Et.x*ir,vn=Et.y*ir,an=ot&&ir>1?this._map(Et,!0):null,sn=(Ye<<5)+(ke+1)+this.points.length,Ei=0,fn=Lr;Ei<fn.length;Ei+=1){var ni=Zt.points[fn[Ei]];if(!(ni.zoom<=ke)){ni.zoom=ke;var Ui=ni.numPoints||1;gr+=ni.x*Ui,vn+=ni.y*Ui,ni.parentId=sn,ot&&(an||(an=this._map(Et,!0)),ot(an,this._map(ni)))}}Et.parentId=sn,ze.push(Ne(gr/ur,vn/ur,sn,ur,an))}else if(ze.push(Et),ur>1)for(var mi=0,Li=Lr;mi<Li.length;mi+=1){var ui=Zt.points[Li[mi]];ui.zoom<=ke||(ui.zoom=ke,ze.push(ui))}}}return ze},pe.prototype._getOriginId=function(Ee){return Ee-this.points.length>>5},pe.prototype._getOriginZoom=function(Ee){return(Ee-this.points.length)%32},pe.prototype._map=function(Ee,ke){if(Ee.numPoints)return ke?me({},Ee.properties):Ee.properties;var ze=this.points[Ee.index].properties,Ke=this.options.map(ze);return ke&&Ke===ze?me({},Ke):Ke},ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ci.prototype.splitTile=function(Ee,ke,ze,Ke,ot,Rt,Nt){for(var Ye=[Ee,ke,ze,Ke],Et=this.options,Zt=Et.debug;Ye.length;){Ke=Ye.pop(),ze=Ye.pop(),ke=Ye.pop(),Ee=Ye.pop();var Lr=1<<ke,ir=Fi(ke,ze,Ke),ur=this.tiles[ir];if(!ur&&(Zt>1&&console.time("creation"),ur=this.tiles[ir]=Ar(Ee,ke,ze,Ke,Et),this.tileCoords.push({z:ke,x:ze,y:Ke}),Zt)){Zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ke,ze,Ke,ur.numFeatures,ur.numPoints,ur.numSimplified),console.timeEnd("creation"));var Or="z"+ke;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(ur.source=Ee,ot){if(ke===Et.maxZoom||ke===ot)continue;var nn=1<<ot-ke;if(ze!==Math.floor(Rt/nn)||Ke!==Math.floor(Nt/nn))continue}else if(ke===Et.indexMaxZoom||ur.numPoints<=Et.indexMaxPoints)continue;if(ur.source=null,Ee.length!==0){Zt>1&&console.time("clipping");var Hr,gr,vn,an,sn,Ei,fn=.5*Et.buffer/Et.extent,ni=.5-fn,Ui=.5+fn,mi=1+fn;Hr=gr=vn=an=null,sn=xe(Ee,Lr,ze-fn,ze+Ui,0,ur.minX,ur.maxX,Et),Ei=xe(Ee,Lr,ze+ni,ze+mi,0,ur.minX,ur.maxX,Et),Ee=null,sn&&(Hr=xe(sn,Lr,Ke-fn,Ke+Ui,1,ur.minY,ur.maxY,Et),gr=xe(sn,Lr,Ke+ni,Ke+mi,1,ur.minY,ur.maxY,Et),sn=null),Ei&&(vn=xe(Ei,Lr,Ke-fn,Ke+Ui,1,ur.minY,ur.maxY,Et),an=xe(Ei,Lr,Ke+ni,Ke+mi,1,ur.minY,ur.maxY,Et),Ei=null),Zt>1&&console.timeEnd("clipping"),Ye.push(Hr||[],ke+1,2*ze,2*Ke),Ye.push(gr||[],ke+1,2*ze,2*Ke+1),Ye.push(vn||[],ke+1,2*ze+1,2*Ke),Ye.push(an||[],ke+1,2*ze+1,2*Ke+1)}}},ci.prototype.getTile=function(Ee,ke,ze){var Ke=this.options,ot=Ke.extent,Rt=Ke.debug;if(Ee<0||Ee>24)return null;var Nt=1<<Ee,Ye=Fi(Ee,ke=(ke%Nt+Nt)%Nt,ze);if(this.tiles[Ye])return Br(this.tiles[Ye],ot);Rt>1&&console.log("drilling down to z%d-%d-%d",Ee,ke,ze);for(var Et,Zt=Ee,Lr=ke,ir=ze;!Et&&Zt>0;)Zt--,Lr=Math.floor(Lr/2),ir=Math.floor(ir/2),Et=this.tiles[Fi(Zt,Lr,ir)];return Et&&Et.source?(Rt>1&&console.log("found parent tile z%d-%d-%d",Zt,Lr,ir),Rt>1&&console.time("drilling down"),this.splitTile(Et.source,Zt,Lr,ir,Ee,ke,ze),Rt>1&&console.timeEnd("drilling down"),this.tiles[Ye]?Br(this.tiles[Ye],ot):null):null};var Si=function(Ee){function ke(ze,Ke,ot,Rt){Ee.call(this,ze,Ke,ot,ji),Rt&&(this.loadGeoJSON=Rt)}return Ee&&(ke.__proto__=Ee),(ke.prototype=Object.create(Ee&&Ee.prototype)).constructor=ke,ke.prototype.loadData=function(ze,Ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Ke,this._pendingLoadDataParams=ze,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ke.prototype._loadData=function(){var ze=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Ke=this._pendingCallback,ot=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Rt=!!(ot&&ot.request&&ot.request.collectResourceTiming)&&new o.RequestPerformance(ot.request);this.loadGeoJSON(ot,function(Nt,Ye){if(Nt||!Ye)return Ke(Nt);if(typeof Ye!="object")return Ke(new Error("Input data given to '"+ot.source+"' is not a valid GeoJSON object."));(function ur(Or,nn){var Hr,gr=Or&&Or.type;if(gr==="FeatureCollection")for(Hr=0;Hr<Or.features.length;Hr++)ur(Or.features[Hr],nn);else if(gr==="GeometryCollection")for(Hr=0;Hr<Or.geometries.length;Hr++)ur(Or.geometries[Hr],nn);else if(gr==="Feature")ur(Or.geometry,nn);else if(gr==="Polygon")U(Or.coordinates,nn);else if(gr==="MultiPolygon")for(Hr=0;Hr<Or.coordinates.length;Hr++)U(Or.coordinates[Hr],nn);return Or})(Ye,!0);try{if(ot.filter){var Et=o.createExpression(ot.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Et.result==="error")throw new Error(Et.value.map(function(ur){return ur.key+": "+ur.message}).join(", "));var Zt=Ye.features.filter(function(ur){return Et.value.evaluate({zoom:0},ur)});Ye={type:"FeatureCollection",features:Zt}}ze._geoJSONIndex=ot.cluster?new pe(function(ur){var Or=ur.superclusterOptions,nn=ur.clusterProperties;if(!nn||!Or)return Or;for(var Hr={},gr={},vn={accumulated:null,zoom:0},an={properties:null},sn=Object.keys(nn),Ei=0,fn=sn;Ei<fn.length;Ei+=1){var ni=fn[Ei],Ui=nn[ni],mi=Ui[0],Li=o.createExpression(Ui[1]),ui=o.createExpression(typeof mi=="string"?[mi,["accumulated"],["get",ni]]:mi);Hr[ni]=Li.value,gr[ni]=ui.value}return Or.map=function(fi){an.properties=fi;for(var Wi={},va=0,Pi=sn;va<Pi.length;va+=1){var hi=Pi[va];Wi[hi]=Hr[hi].evaluate(vn,an)}return Wi},Or.reduce=function(fi,Wi){an.properties=Wi;for(var va=0,Pi=sn;va<Pi.length;va+=1){var hi=Pi[va];vn.accumulated=fi[hi],fi[hi]=gr[hi].evaluate(vn,an)}},Or}(ot)).load(Ye.features):function(ur,Or){return new ci(ur,Or)}(Ye,ot.geojsonVtOptions)}catch(ur){return Ke(ur)}ze.loaded={};var Lr={};if(Rt){var ir=Rt.finish();ir&&(Lr.resourceTiming={},Lr.resourceTiming[ot.source]=JSON.parse(JSON.stringify(ir)))}Ke(null,Lr)})}},ke.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ke.prototype.reloadTile=function(ze,Ke){var ot=this.loaded;return ot&&ot[ze.uid]?Ee.prototype.reloadTile.call(this,ze,Ke):this.loadTile(ze,Ke)},ke.prototype.loadGeoJSON=function(ze,Ke){if(ze.request)o.getJSON(ze.request,Ke);else{if(typeof ze.data!="string")return Ke(new Error("Input data given to '"+ze.source+"' is not a valid GeoJSON object."));try{return Ke(null,JSON.parse(ze.data))}catch(ot){return Ke(new Error("Input data given to '"+ze.source+"' is not a valid GeoJSON object."))}}},ke.prototype.removeSource=function(ze,Ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ke()},ke.prototype.getClusterExpansionZoom=function(ze,Ke){try{Ke(null,this._geoJSONIndex.getClusterExpansionZoom(ze.clusterId))}catch(ot){Ke(ot)}},ke.prototype.getClusterChildren=function(ze,Ke){try{Ke(null,this._geoJSONIndex.getChildren(ze.clusterId))}catch(ot){Ke(ot)}},ke.prototype.getClusterLeaves=function(ze,Ke){try{Ke(null,this._geoJSONIndex.getLeaves(ze.clusterId,ze.limit,ze.offset))}catch(ot){Ke(ot)}},ke}(k),xi=function(Ee){var ke=this;this.self=Ee,this.actor=new o.Actor(Ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:k,geojson:Si},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ze,Ke){if(ke.workerSourceTypes[ze])throw new Error('Worker source with name "'+ze+'" already registered.');ke.workerSourceTypes[ze]=Ke},this.self.registerRTLTextPlugin=function(ze){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ze.applyArabicShaping,o.plugin.processBidirectionalText=ze.processBidirectionalText,o.plugin.processStyledBidirectionalText=ze.processStyledBidirectionalText}};return xi.prototype.setReferrer=function(Ee,ke){this.referrer=ke},xi.prototype.setImages=function(Ee,ke,ze){for(var Ke in this.availableImages[Ee]=ke,this.workerSources[Ee]){var ot=this.workerSources[Ee][Ke];for(var Rt in ot)ot[Rt].availableImages=ke}ze()},xi.prototype.setLayers=function(Ee,ke,ze){this.getLayerIndex(Ee).replace(ke),ze()},xi.prototype.updateLayers=function(Ee,ke,ze){this.getLayerIndex(Ee).update(ke.layers,ke.removedIds),ze()},xi.prototype.loadTile=function(Ee,ke,ze){this.getWorkerSource(Ee,ke.type,ke.source).loadTile(ke,ze)},xi.prototype.loadDEMTile=function(Ee,ke,ze){this.getDEMWorkerSource(Ee,ke.source).loadTile(ke,ze)},xi.prototype.reloadTile=function(Ee,ke,ze){this.getWorkerSource(Ee,ke.type,ke.source).reloadTile(ke,ze)},xi.prototype.abortTile=function(Ee,ke,ze){this.getWorkerSource(Ee,ke.type,ke.source).abortTile(ke,ze)},xi.prototype.removeTile=function(Ee,ke,ze){this.getWorkerSource(Ee,ke.type,ke.source).removeTile(ke,ze)},xi.prototype.removeDEMTile=function(Ee,ke){this.getDEMWorkerSource(Ee,ke.source).removeTile(ke)},xi.prototype.removeSource=function(Ee,ke,ze){if(this.workerSources[Ee]&&this.workerSources[Ee][ke.type]&&this.workerSources[Ee][ke.type][ke.source]){var Ke=this.workerSources[Ee][ke.type][ke.source];delete this.workerSources[Ee][ke.type][ke.source],Ke.removeSource!==void 0?Ke.removeSource(ke,ze):ze()}},xi.prototype.loadWorkerSource=function(Ee,ke,ze){try{this.self.importScripts(ke.url),ze()}catch(Ke){ze(Ke.toString())}},xi.prototype.syncRTLPluginState=function(Ee,ke,ze){try{o.plugin.setState(ke);var Ke=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&Ke!=null){this.self.importScripts(Ke);var ot=o.plugin.isParsed();ze(ot?void 0:new Error("RTL Text Plugin failed to import scripts from "+Ke),ot)}}catch(Rt){ze(Rt.toString())}},xi.prototype.getAvailableImages=function(Ee){var ke=this.availableImages[Ee];return ke||(ke=[]),ke},xi.prototype.getLayerIndex=function(Ee){var ke=this.layerIndexes[Ee];return ke||(ke=this.layerIndexes[Ee]=new P),ke},xi.prototype.getWorkerSource=function(Ee,ke,ze){var Ke=this;return this.workerSources[Ee]||(this.workerSources[Ee]={}),this.workerSources[Ee][ke]||(this.workerSources[Ee][ke]={}),this.workerSources[Ee][ke][ze]||(this.workerSources[Ee][ke][ze]=new this.workerSourceTypes[ke]({send:function(ot,Rt,Nt){Ke.actor.send(ot,Rt,Nt,Ee)}},this.getLayerIndex(Ee),this.getAvailableImages(Ee))),this.workerSources[Ee][ke][ze]},xi.prototype.getDEMWorkerSource=function(Ee,ke){return this.demWorkerSources[Ee]||(this.demWorkerSources[Ee]={}),this.demWorkerSources[Ee][ke]||(this.demWorkerSources[Ee][ke]=new j),this.demWorkerSources[Ee][ke]},xi.prototype.enforceCacheSizeLimit=function(Ee,ke){o.enforceCacheSizeLimit(ke)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new xi(self)),xi}),F(["./shared"],function(o){"use strict";var w=o.createCommonjsModule(function(a){function u(T){return!s(T)}function s(T){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var K,ue,Se=new Blob([""],{type:"text/javascript"}),Ie=URL.createObjectURL(Se);try{ue=new Worker(Ie),K=!0}catch(We){K=!1}return ue&&ue.terminate(),URL.revokeObjectURL(Ie),K}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var K=document.createElement("canvas");K.width=K.height=1;var ue=K.getContext("2d");if(!ue)return!1;var Se=ue.getImageData(0,0,1,1);return Se&&Se.width===K.width}()?(f[W=T&&T.failIfMajorPerformanceCaveat]===void 0&&(f[W]=function(K){var ue=function(Ie){var We=document.createElement("canvas"),Xe=Object.create(u.webGLContextAttributes);return Xe.failIfMajorPerformanceCaveat=Ie,We.probablySupportsContext?We.probablySupportsContext("webgl",Xe)||We.probablySupportsContext("experimental-webgl",Xe):We.supportsContext?We.supportsContext("webgl",Xe)||We.supportsContext("experimental-webgl",Xe):We.getContext("webgl",Xe)||We.getContext("experimental-webgl",Xe)}(K);if(!ue)return!1;var Se=ue.createShader(ue.VERTEX_SHADER);return!(!Se||ue.isContextLost())&&(ue.shaderSource(Se,"void main() {}"),ue.compileShader(Se),ue.getShaderParameter(Se,ue.COMPILE_STATUS)===!0)}(W)),f[W]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var W}a.exports?a.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=s);var f={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),_={create:function(a,u,s){var f=o.window.document.createElement(a);return u!==void 0&&(f.className=u),s&&s.appendChild(f),f},createNS:function(a,u){return o.window.document.createElementNS(a,u)}},P=o.window.document&&o.window.document.documentElement.style;function L(a){if(!P)return a[0];for(var u=0;u<a.length;u++)if(a[u]in P)return a[u];return a[0]}var d,E=L(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);_.disableDrag=function(){P&&E&&(d=P[E],P[E]="none")},_.enableDrag=function(){P&&E&&(P[E]=d)};var g=L(["transform","WebkitTransform"]);_.setTransform=function(a,u){a.style[g]=u};var k=!1;try{var M=Object.defineProperty({},"passive",{get:function(){k=!0}});o.window.addEventListener("test",M,M),o.window.removeEventListener("test",M,M)}catch(a){k=!1}_.addEventListener=function(a,u,s,f){f===void 0&&(f={}),a.addEventListener(u,s,"passive"in f&&k?f:f.capture)},_.removeEventListener=function(a,u,s,f){f===void 0&&(f={}),a.removeEventListener(u,s,"passive"in f&&k?f:f.capture)};var j=function(a){a.preventDefault(),a.stopPropagation(),o.window.removeEventListener("click",j,!0)};function U(a){var u=a.userImage;return!!(u&&u.render&&u.render())&&(a.data.replace(new Uint8Array(u.data.buffer)),!0)}_.suppressClick=function(){o.window.addEventListener("click",j,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",j,!0)},0)},_.mousePos=function(a,u){var s=a.getBoundingClientRect();return new o.Point(u.clientX-s.left-a.clientLeft,u.clientY-s.top-a.clientTop)},_.touchPos=function(a,u){for(var s=a.getBoundingClientRect(),f=[],T=0;T<u.length;T++)f.push(new o.Point(u[T].clientX-s.left-a.clientLeft,u[T].clientY-s.top-a.clientTop));return f},_.mouseButton=function(a){return o.window.InstallTrigger!==void 0&&a.button===2&&a.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:a.button},_.remove=function(a){a.parentNode&&a.parentNode.removeChild(a)};var I=function(a){function u(){a.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(s){if(this.loaded!==s&&(this.loaded=s,s)){for(var f=0,T=this.requestors;f<T.length;f+=1){var W=T[f];this._notify(W.ids,W.callback)}this.requestors=[]}},u.prototype.getImage=function(s){return this.images[s]},u.prototype.addImage=function(s,f){this._validate(s,f)&&(this.images[s]=f)},u.prototype._validate=function(s,f){var T=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+s+'" has invalid "stretchX" value'))),T=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+s+'" has invalid "stretchY" value'))),T=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error('Image "'+s+'" has invalid "content" value'))),T=!1),T},u.prototype._validateStretch=function(s,f){if(!s)return!0;for(var T=0,W=0,K=s;W<K.length;W+=1){var ue=K[W];if(ue[0]<T||ue[1]<ue[0]||f<ue[1])return!1;T=ue[1]}return!0},u.prototype._validateContent=function(s,f){return!(s&&(s.length!==4||s[0]<0||f.data.width<s[0]||s[1]<0||f.data.height<s[1]||s[2]<0||f.data.width<s[2]||s[3]<0||f.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))},u.prototype.updateImage=function(s,f){f.version=this.images[s].version+1,this.images[s]=f,this.updatedImages[s]=!0},u.prototype.removeImage=function(s){var f=this.images[s];delete this.images[s],delete this.patterns[s],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(s,f){var T=!0;if(!this.isLoaded())for(var W=0,K=s;W<K.length;W+=1)this.images[K[W]]||(T=!1);this.isLoaded()||T?this._notify(s,f):this.requestors.push({ids:s,callback:f})},u.prototype._notify=function(s,f){for(var T={},W=0,K=s;W<K.length;W+=1){var ue=K[W];this.images[ue]||this.fire(new o.Event("styleimagemissing",{id:ue}));var Se=this.images[ue];Se?T[ue]={data:Se.data.clone(),pixelRatio:Se.pixelRatio,sdf:Se.sdf,version:Se.version,stretchX:Se.stretchX,stretchY:Se.stretchY,content:Se.content,hasRenderCallback:Boolean(Se.userImage&&Se.userImage.render)}:o.warnOnce('Image "'+ue+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}f(null,T)},u.prototype.getPixelSize=function(){var s=this.atlasImage;return{width:s.width,height:s.height}},u.prototype.getPattern=function(s){var f=this.patterns[s],T=this.getImage(s);if(!T)return null;if(f&&f.position.version===T.version)return f.position;if(f)f.position.version=T.version;else{var W={w:T.data.width+2,h:T.data.height+2,x:0,y:0},K=new o.ImagePosition(W,T);this.patterns[s]={bin:W,position:K}}return this._updatePatternAtlas(),this.patterns[s].position},u.prototype.bind=function(s){var f=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(s,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var s=[];for(var f in this.patterns)s.push(this.patterns[f].bin);var T=o.potpack(s),W=T.w,K=T.h,ue=this.atlasImage;for(var Se in ue.resize({width:W||1,height:K||1}),this.patterns){var Ie=this.patterns[Se].bin,We=Ie.x+1,Xe=Ie.y+1,Je=this.images[Se].data,xt=Je.width,_t=Je.height;o.RGBAImage.copy(Je,ue,{x:0,y:0},{x:We,y:Xe},{width:xt,height:_t}),o.RGBAImage.copy(Je,ue,{x:0,y:_t-1},{x:We,y:Xe-1},{width:xt,height:1}),o.RGBAImage.copy(Je,ue,{x:0,y:0},{x:We,y:Xe+_t},{width:xt,height:1}),o.RGBAImage.copy(Je,ue,{x:xt-1,y:0},{x:We-1,y:Xe},{width:1,height:_t}),o.RGBAImage.copy(Je,ue,{x:0,y:0},{x:We+xt,y:Xe},{width:1,height:_t})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(s){for(var f=0,T=s;f<T.length;f+=1){var W=T[f];if(!this.callbackDispatchedThisFrame[W]){this.callbackDispatchedThisFrame[W]=!0;var K=this.images[W];U(K)&&this.updateImage(W,K)}}},u}(o.Evented),O=y,D=y,R=1e20;function y(a,u,s,f,T,W){this.fontSize=a||24,this.buffer=u===void 0?3:u,this.cutoff=f||.25,this.fontFamily=T||"sans-serif",this.fontWeight=W||"normal",this.radius=s||8;var K=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=K,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(K*K),this.gridInner=new Float64Array(K*K),this.f=new Float64Array(K),this.d=new Float64Array(K),this.z=new Float64Array(K+1),this.v=new Int16Array(K),this.middle=Math.round(K/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function v(a,u,s,f,T,W,K){for(var ue=0;ue<u;ue++){for(var Se=0;Se<s;Se++)f[Se]=a[Se*u+ue];for(h(f,T,W,K,s),Se=0;Se<s;Se++)a[Se*u+ue]=T[Se]}for(Se=0;Se<s;Se++){for(ue=0;ue<u;ue++)f[ue]=a[Se*u+ue];for(h(f,T,W,K,u),ue=0;ue<u;ue++)a[Se*u+ue]=Math.sqrt(T[ue])}}function h(a,u,s,f,T){s[0]=0,f[0]=-R,f[1]=+R;for(var W=1,K=0;W<T;W++){for(var ue=(a[W]+W*W-(a[s[K]]+s[K]*s[K]))/(2*W-2*s[K]);ue<=f[K];)K--,ue=(a[W]+W*W-(a[s[K]]+s[K]*s[K]))/(2*W-2*s[K]);s[++K]=W,f[K]=ue,f[K+1]=+R}for(W=0,K=0;W<T;W++){for(;f[K+1]<W;)K++;u[W]=(W-s[K])*(W-s[K])+a[s[K]]}}y.prototype.draw=function(a){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(a,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),s=new Uint8ClampedArray(this.size*this.size),f=0;f<this.size*this.size;f++){var T=u.data[4*f+3]/255;this.gridOuter[f]=T===1?0:T===0?R:Math.pow(Math.max(0,.5-T),2),this.gridInner[f]=T===1?R:T===0?0:Math.pow(Math.max(0,T-.5),2)}for(v(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),v(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),f=0;f<this.size*this.size;f++)s[f]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[f]-this.gridInner[f])/this.radius+this.cutoff))));return s},O.default=D;var S=function(a,u){this.requestManager=a,this.localIdeographFontFamily=u,this.entries={}};S.prototype.setURL=function(a){this.url=a},S.prototype.getGlyphs=function(a,u){var s=this,f=[];for(var T in a)for(var W=0,K=a[T];W<K.length;W+=1)f.push({stack:T,id:K[W]});o.asyncAll(f,function(ue,Se){var Ie=ue.stack,We=ue.id,Xe=s.entries[Ie];Xe||(Xe=s.entries[Ie]={glyphs:{},requests:{},ranges:{}});var Je=Xe.glyphs[We];if(Je===void 0){if(Je=s._tinySDF(Xe,Ie,We))return Xe.glyphs[We]=Je,void Se(null,{stack:Ie,id:We,glyph:Je});var xt=Math.floor(We/256);if(256*xt>65535)Se(new Error("glyphs > 65535 not supported"));else if(Xe.ranges[xt])Se(null,{stack:Ie,id:We,glyph:Je});else{var _t=Xe.requests[xt];_t||(_t=Xe.requests[xt]=[],S.loadGlyphRange(Ie,xt,s.url,s.requestManager,function(Pt,ft){if(ft){for(var Ot in ft)s._doesCharSupportLocalGlyph(+Ot)||(Xe.glyphs[+Ot]=ft[+Ot]);Xe.ranges[xt]=!0}for(var jt=0,er=_t;jt<er.length;jt+=1)(0,er[jt])(Pt,ft);delete Xe.requests[xt]})),_t.push(function(Pt,ft){Pt?Se(Pt):ft&&Se(null,{stack:Ie,id:We,glyph:ft[We]||null})})}}else Se(null,{stack:Ie,id:We,glyph:Je})},function(ue,Se){if(ue)u(ue);else if(Se){for(var Ie={},We=0,Xe=Se;We<Xe.length;We+=1){var Je=Xe[We],xt=Je.stack,_t=Je.id,Pt=Je.glyph;(Ie[xt]||(Ie[xt]={}))[_t]=Pt&&{id:Pt.id,bitmap:Pt.bitmap.clone(),metrics:Pt.metrics}}u(null,Ie)}})},S.prototype._doesCharSupportLocalGlyph=function(a){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](a)||o.isChar["Hangul Syllables"](a)||o.isChar.Hiragana(a)||o.isChar.Katakana(a))},S.prototype._tinySDF=function(a,u,s){var f=this.localIdeographFontFamily;if(f&&this._doesCharSupportLocalGlyph(s)){var T=a.tinySDF;if(!T){var W="400";/bold/i.test(u)?W="900":/medium/i.test(u)?W="500":/light/i.test(u)&&(W="200"),T=a.tinySDF=new S.TinySDF(24,3,8,.25,f,W)}return{id:s,bitmap:new o.AlphaImage({width:30,height:30},T.draw(String.fromCharCode(s))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},S.loadGlyphRange=function(a,u,s,f,T){var W=256*u,K=W+255,ue=f.transformRequest(f.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",W+"-"+K),o.ResourceType.Glyphs);o.getArrayBuffer(ue,function(Se,Ie){if(Se)T(Se);else if(Ie){for(var We={},Xe=0,Je=o.parseGlyphPBF(Ie);Xe<Je.length;Xe+=1){var xt=Je[Xe];We[xt.id]=xt}T(null,We)}})},S.TinySDF=O;var A=function(){this.specification=o.styleSpec.light.position};A.prototype.possiblyEvaluate=function(a,u){return o.sphericalToCartesian(a.expression.evaluate(u))},A.prototype.interpolate=function(a,u,s){return{x:o.number(a.x,u.x,s),y:o.number(a.y,u.y,s),z:o.number(a.z,u.z,s)}};var x=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new A,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),z=function(a){function u(s){a.call(this),this._transitionable=new o.Transitionable(x),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(s,f){if(f===void 0&&(f={}),!this._validate(o.validateLight,s,f))for(var T in s){var W=s[T];o.endsWith(T,"-transition")?this._transitionable.setTransition(T.slice(0,-"-transition".length),W):this._transitionable.setValue(T,W)}},u.prototype.updateTransitions=function(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(s){this.properties=this._transitioning.possiblyEvaluate(s)},u.prototype._validate=function(s,f,T){return(!T||T.validate!==!1)&&o.emitValidationErrors(this,s.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},u}(o.Evented),B=function(a,u){this.width=a,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};B.prototype.getDash=function(a,u){var s=a.join(",")+String(u);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(a,u)),this.dashEntry[s]},B.prototype.getDashRanges=function(a,u,s){var f=[],T=a.length%2==1?-a[a.length-1]*s:0,W=a[0]*s,K=!0;f.push({left:T,right:W,isDash:K,zeroLength:a[0]===0});for(var ue=a[0],Se=1;Se<a.length;Se++){var Ie=a[Se];f.push({left:T=ue*s,right:W=(ue+=Ie)*s,isDash:K=!K,zeroLength:Ie===0})}return f},B.prototype.addRoundDash=function(a,u,s){for(var f=u/2,T=-s;T<=s;T++)for(var W=this.width*(this.nextRow+s+T),K=0,ue=a[K],Se=0;Se<this.width;Se++){Se/ue.right>1&&(ue=a[++K]);var Ie=Math.abs(Se-ue.left),We=Math.abs(Se-ue.right),Xe=Math.min(Ie,We),Je=void 0,xt=T/s*(f+1);if(ue.isDash){var _t=f-Math.abs(xt);Je=Math.sqrt(Xe*Xe+_t*_t)}else Je=f-Math.sqrt(Xe*Xe+xt*xt);this.data[W+Se]=Math.max(0,Math.min(255,Je+128))}},B.prototype.addRegularDash=function(a){for(var u=a.length-1;u>=0;--u){var s=a[u],f=a[u+1];s.zeroLength?a.splice(u,1):f&&f.isDash===s.isDash&&(f.left=s.left,a.splice(u,1))}var T=a[0],W=a[a.length-1];T.isDash===W.isDash&&(T.left=W.left-this.width,W.right=T.right+this.width);for(var K=this.width*this.nextRow,ue=0,Se=a[ue],Ie=0;Ie<this.width;Ie++){Ie/Se.right>1&&(Se=a[++ue]);var We=Math.abs(Ie-Se.left),Xe=Math.abs(Ie-Se.right),Je=Math.min(We,Xe);this.data[K+Ie]=Math.max(0,Math.min(255,(Se.isDash?Je:-Je)+128))}},B.prototype.addDash=function(a,u){var s=u?7:0,f=2*s+1;if(this.nextRow+f>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var T=0,W=0;W<a.length;W++)T+=a[W];if(T!==0){var K=this.width/T,ue=this.getDashRanges(a,this.width,K);u?this.addRoundDash(ue,K,s):this.addRegularDash(ue)}var Se={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:T};return this.nextRow+=f,this.dirty=!0,Se},B.prototype.bind=function(a){var u=a.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var V=function a(u,s){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var f=this.workerPool.acquire(this.id),T=0;T<f.length;T++){var W=new a.Actor(f[T],s,this.id);W.name="Worker "+T,this.actors.push(W)}};function Q(a,u,s){var f=function(T,W){if(T)return s(T);if(W){var K=o.pick(o.extend(W,a),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);W.vector_layers&&(K.vectorLayers=W.vector_layers,K.vectorLayerIds=K.vectorLayers.map(function(ue){return ue.id})),K.tiles=u.canonicalizeTileset(K,a.url),s(null,K)}};return a.url?o.getJSON(u.transformRequest(u.normalizeSourceURL(a.url),o.ResourceType.Source),f):o.browser.frame(function(){return f(null,a)})}V.prototype.broadcast=function(a,u,s){o.asyncAll(this.actors,function(f,T){f.send(a,u,T)},s=s||function(){})},V.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},V.prototype.remove=function(){this.actors.forEach(function(a){a.remove()}),this.actors=[],this.workerPool.release(this.id)},V.Actor=o.Actor;var oe=function(a,u,s){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=u||0,this.maxzoom=s||24};oe.prototype.validateBounds=function(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]},oe.prototype.contains=function(a){var u=Math.pow(2,a.z),s=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*u),f=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*u),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*u),W=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*u);return a.x>=s&&a.x<T&&a.y>=f&&a.y<W};var re=function(a){function u(s,f,T,W){if(a.call(this),this.id=s,this.dispatcher=T,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(f,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(W)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(){var s=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Q(this._options,this.map._requestManager,function(f,T){s._tileJSONRequest=null,s._loaded=!0,f?s.fire(new o.ErrorEvent(f)):T&&(o.extend(s,T),T.bounds&&(s.tileBounds=new oe(T.bounds,s.minzoom,s.maxzoom)),o.postTurnstileEvent(T.tiles,s.map._requestManager._customAccessToken),o.postMapLoadEvent(T.tiles,s.map._getMapId(),s.map._requestManager._skuToken,s.map._requestManager._customAccessToken),s.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),s.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)},u.prototype.onAdd=function(s){this.map=s,this.load()},u.prototype.setSourceProperty=function(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(s){var f=this;return this.setSourceProperty(function(){f._options.tiles=s}),this},u.prototype.setUrl=function(s){var f=this;return this.setSourceProperty(function(){f.url=s,f._options.url=s}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return o.extend({},this._options)},u.prototype.loadTile=function(s,f){var T=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),W={request:this.map._requestManager.transformRequest(T,o.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function K(ue,Se){return delete s.request,s.aborted?f(null):ue&&ue.status!==404?f(ue):(Se&&Se.resourceTiming&&(s.resourceTiming=Se.resourceTiming),this.map._refreshExpiredTiles&&Se&&s.setExpiryData(Se),s.loadVectorData(Se,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}W.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=f:s.request=s.actor.send("reloadTile",W,K.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",W,K.bind(this)))},u.prototype.abortTile=function(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(o.Evented),Z=function(a){function u(s,f,T,W){a.call(this),this.id=s,this.dispatcher=T,this.setEventedParent(W),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(){var s=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Q(this._options,this.map._requestManager,function(f,T){s._tileJSONRequest=null,s._loaded=!0,f?s.fire(new o.ErrorEvent(f)):T&&(o.extend(s,T),T.bounds&&(s.tileBounds=new oe(T.bounds,s.minzoom,s.maxzoom)),o.postTurnstileEvent(T.tiles),o.postMapLoadEvent(T.tiles,s.map._getMapId(),s.map._requestManager._skuToken),s.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),s.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(s){this.map=s,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return o.extend({},this._options)},u.prototype.hasTile=function(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)},u.prototype.loadTile=function(s,f){var T=this,W=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);s.request=o.getImage(this.map._requestManager.transformRequest(W,o.ResourceType.Tile),function(K,ue){if(delete s.request,s.aborted)s.state="unloaded",f(null);else if(K)s.state="errored",f(K);else if(ue){T.map._refreshExpiredTiles&&s.setExpiryData(ue),delete ue.cacheControl,delete ue.expires;var Se=T.map.painter.context,Ie=Se.gl;s.texture=T.map.painter.getTileTexture(ue.width),s.texture?s.texture.update(ue,{useMipmap:!0}):(s.texture=new o.Texture(Se,ue,Ie.RGBA,{useMipmap:!0}),s.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE,Ie.LINEAR_MIPMAP_NEAREST),Se.extTextureFilterAnisotropic&&Ie.texParameterf(Ie.TEXTURE_2D,Se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Se.extTextureFilterAnisotropicMax)),s.state="loaded",o.cacheEntryPossiblyAdded(T.dispatcher),f(null)}})},u.prototype.abortTile=function(s,f){s.request&&(s.request.cancel(),delete s.request),f()},u.prototype.unloadTile=function(s,f){s.texture&&this.map.painter.saveTileTexture(s.texture),f()},u.prototype.hasTransition=function(){return!1},u}(o.Evented),ee=function(a){function u(s,f,T,W){a.call(this,s,f,T,W),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox"}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(s,f){var T=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function W(K,ue){K&&(s.state="errored",f(K)),ue&&(s.dem=ue,s.needsHillshadePrepare=!0,s.state="loaded",f(null))}s.request=o.getImage(this.map._requestManager.transformRequest(T,o.ResourceType.Tile),function(K,ue){if(delete s.request,s.aborted)s.state="unloaded",f(null);else if(K)s.state="errored",f(K);else if(ue){this.map._refreshExpiredTiles&&s.setExpiryData(ue),delete ue.cacheControl,delete ue.expires;var Se=o.window.ImageBitmap&&ue instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?ue:o.browser.getImageData(ue,1),Ie={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:Se,encoding:this.encoding};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",Ie,W.bind(this)))}}.bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)},u.prototype._getNeighboringTiles=function(s){var f=s.canonical,T=Math.pow(2,f.z),W=(f.x-1+T)%T,K=f.x===0?s.wrap-1:s.wrap,ue=(f.x+1+T)%T,Se=f.x+1===T?s.wrap+1:s.wrap,Ie={};return Ie[new o.OverscaledTileID(s.overscaledZ,K,f.z,W,f.y).key]={backfilled:!1},Ie[new o.OverscaledTileID(s.overscaledZ,Se,f.z,ue,f.y).key]={backfilled:!1},f.y>0&&(Ie[new o.OverscaledTileID(s.overscaledZ,K,f.z,W,f.y-1).key]={backfilled:!1},Ie[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},Ie[new o.OverscaledTileID(s.overscaledZ,Se,f.z,ue,f.y-1).key]={backfilled:!1}),f.y+1<T&&(Ie[new o.OverscaledTileID(s.overscaledZ,K,f.z,W,f.y+1).key]={backfilled:!1},Ie[new o.OverscaledTileID(s.overscaledZ,s.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},Ie[new o.OverscaledTileID(s.overscaledZ,Se,f.z,ue,f.y+1).key]={backfilled:!1}),Ie},u.prototype.unloadTile=function(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})},u}(Z),H=function(a){function u(s,f,T,W){a.call(this),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=T.getActor(),this.setEventedParent(W),this._data=f.data,this._options=o.extend({},f),this._collectResourceTiming=f.collectResourceTiming,this._resourceTiming=[],f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;var K=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*K,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*K,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?Math.min(f.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:o.EXTENT,radius:(f.clusterRadius||50)*K,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(){var s=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(f){if(f)s.fire(new o.ErrorEvent(f));else{var T={dataType:"source",sourceDataType:"metadata"};s._collectResourceTiming&&s._resourceTiming&&s._resourceTiming.length>0&&(T.resourceTiming=s._resourceTiming,s._resourceTiming=[]),s.fire(new o.Event("data",T))}})},u.prototype.onAdd=function(s){this.map=s,this.load()},u.prototype.setData=function(s){var f=this;return this._data=s,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(T){if(T)f.fire(new o.ErrorEvent(T));else{var W={dataType:"source",sourceDataType:"content"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(W.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new o.Event("data",W))}}),this},u.prototype.getClusterExpansionZoom=function(s,f){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},f),this},u.prototype.getClusterChildren=function(s,f){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},f),this},u.prototype.getClusterLeaves=function(s,f,T,W){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:f,offset:T},W),this},u.prototype._updateWorkerData=function(s){var f=this;this._loaded=!1;var T=o.extend({},this.workerOptions),W=this._data;typeof W=="string"?(T.request=this.map._requestManager.transformRequest(o.browser.resolveURL(W),o.ResourceType.Source),T.request.collectResourceTiming=this._collectResourceTiming):T.data=JSON.stringify(W),this.actor.send(this.type+".loadData",T,function(K,ue){f._removed||ue&&ue.abandoned||(f._loaded=!0,ue&&ue.resourceTiming&&ue.resourceTiming[f.id]&&(f._resourceTiming=ue.resourceTiming[f.id].slice(0)),f.actor.send(f.type+".coalesce",{source:T.source},null),s(K))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(s,f){var T=this,W=s.actor?"reloadTile":"loadTile";s.actor=this.actor,s.request=this.actor.send(W,{type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(K,ue){return delete s.request,s.unloadVectorData(),s.aborted?f(null):K?f(K):(s.loadVectorData(ue,T.map.painter,W==="reloadTile"),f(null))})},u.prototype.abortTile=function(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0},u.prototype.unloadTile=function(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(o.Evented),ae=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),G=function(a){function u(s,f,T,W){a.call(this),this.id=s,this.dispatcher=T,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(W),this.options=f}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(s,f){var T=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(W,K){T._loaded=!0,W?T.fire(new o.ErrorEvent(W)):K&&(T.image=K,s&&(T.coordinates=s),f&&f(),T._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(s){var f=this;return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,function(){f.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(s){this.map=s,this.load()},u.prototype.setCoordinates=function(s){var f=this;this.coordinates=s;var T=s.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(K){for(var ue=1/0,Se=1/0,Ie=-1/0,We=-1/0,Xe=0,Je=K;Xe<Je.length;Xe+=1){var xt=Je[Xe];ue=Math.min(ue,xt.x),Se=Math.min(Se,xt.y),Ie=Math.max(Ie,xt.x),We=Math.max(We,xt.y)}var _t=Math.max(Ie-ue,We-Se),Pt=Math.max(0,Math.floor(-Math.log(_t)/Math.LN2)),ft=Math.pow(2,Pt);return new o.CanonicalTileID(Pt,Math.floor((ue+Ie)/2*ft),Math.floor((Se+We)/2*ft))}(T),this.minzoom=this.maxzoom=this.tileID.z;var W=T.map(function(K){return f.tileID.getTilePoint(K)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(W[0].x,W[0].y,0,0),this._boundsArray.emplaceBack(W[1].x,W[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(W[3].x,W[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(W[2].x,W[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var s=this.map.painter.context,f=s.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(s,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var W=this.tiles[T];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}}},u.prototype.loadTile=function(s,f){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},f(null)):(s.state="errored",f(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(o.Evented),ie=function(a){function u(s,f,T,W){a.call(this,s,f,T,W),this.roundZoom=!0,this.type="video",this.options=f}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(){var s=this;this._loaded=!1;var f=this.options;this.urls=[];for(var T=0,W=f.urls;T<W.length;T+=1)this.urls.push(this.map._requestManager.transformRequest(W[T],o.ResourceType.Source).url);o.getVideo(this.urls,function(K,ue){s._loaded=!0,K?s.fire(new o.ErrorEvent(K)):ue&&(s.video=ue,s.video.loop=!0,s.video.addEventListener("playing",function(){s.map.triggerRepaint()}),s.map&&s.video.play(),s._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(s){if(this.video){var f=this.video.seekable;s<f.start(0)||s>f.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+f.start(0)+" and "+f.end(0)+"-second mark."))):this.video.currentTime=s}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var s=this.map.painter.context,f=s.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(s,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var W=this.tiles[T];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(G),le=function(a){function u(s,f,T,W){a.call(this,s,f,T,W),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(function(K){return!Array.isArray(K)||K.length!==2||K.some(function(ue){return typeof ue!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+s,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,T=f.gl;for(var W in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(f,this.canvas,T.RGBA,{premultiply:!0}),this.tiles){var K=this.tiles[W];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var s=0,f=[this.canvas.width,this.canvas.height];s<f.length;s+=1){var T=f[s];if(isNaN(T)||T<=0)return!0}return!1},u}(G),Me={vector:re,raster:Z,"raster-dem":ee,geojson:H,video:ie,image:G,canvas:le};function ge(a,u){var s=o.identity([]);return o.translate(s,s,[1,1,0]),o.scale(s,s,[.5*a.width,.5*a.height,1]),o.multiply(s,s,a.calculatePosMatrix(u.toUnwrapped()))}function pe(a,u,s,f,T,W){var K=function(Pt,ft,Ot){if(Pt)for(var jt=0,er=Pt;jt<er.length;jt+=1){var br=ft[er[jt]];if(br&&br.source===Ot&&br.type==="fill-extrusion")return!0}else for(var yr in ft){var Cr=ft[yr];if(Cr.source===Ot&&Cr.type==="fill-extrusion")return!0}return!1}(T&&T.layers,u,a.id),ue=W.maxPitchScaleFactor(),Se=a.tilesIn(f,ue,K);Se.sort(Ne);for(var Ie=[],We=0,Xe=Se;We<Xe.length;We+=1){var Je=Xe[We];Ie.push({wrappedTileID:Je.tileID.wrapped().key,queryResults:Je.tile.queryRenderedFeatures(u,s,a._state,Je.queryGeometry,Je.cameraQueryGeometry,Je.scale,T,W,ue,ge(a.transform,Je.tileID))})}var xt=function(Pt){for(var ft={},Ot={},jt=0,er=Pt;jt<er.length;jt+=1){var br=er[jt],yr=br.queryResults,Cr=br.wrappedTileID,zr=Ot[Cr]=Ot[Cr]||{};for(var un in yr)for(var qr=yr[un],Dn=zr[un]=zr[un]||{},$n=ft[un]=ft[un]||[],Jn=0,ii=qr;Jn<ii.length;Jn+=1){var qi=ii[Jn];Dn[qi.featureIndex]||(Dn[qi.featureIndex]=!0,$n.push(qi))}}return ft}(Ie);for(var _t in xt)xt[_t].forEach(function(Pt){var ft=Pt.feature,Ot=a.getFeatureState(ft.layer["source-layer"],ft.id);ft.source=ft.layer.source,ft.layer["source-layer"]&&(ft.sourceLayer=ft.layer["source-layer"]),ft.state=Ot});return xt}function Ne(a,u){var s=a.tileID,f=u.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}var Re=function(a,u){this.max=a,this.onRemove=u,this.reset()};Re.prototype.reset=function(){for(var a in this.data)for(var u=0,s=this.data[a];u<s.length;u+=1){var f=s[u];f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value)}return this.data={},this.order=[],this},Re.prototype.add=function(a,u,s){var f=this,T=a.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);var W={value:u,timeout:void 0};if(s!==void 0&&(W.timeout=setTimeout(function(){f.remove(a,W)},s)),this.data[T].push(W),this.order.push(T),this.order.length>this.max){var K=this._getAndRemoveByKey(this.order[0]);K&&this.onRemove(K)}return this},Re.prototype.has=function(a){return a.wrapped().key in this.data},Re.prototype.getAndRemove=function(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null},Re.prototype._getAndRemoveByKey=function(a){var u=this.data[a].shift();return u.timeout&&clearTimeout(u.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),u.value},Re.prototype.getByKey=function(a){var u=this.data[a];return u?u[0].value:null},Re.prototype.get=function(a){return this.has(a)?this.data[a.wrapped().key][0].value:null},Re.prototype.remove=function(a,u){if(!this.has(a))return this;var s=a.wrapped().key,f=u===void 0?0:this.data[s].indexOf(u),T=this.data[s][f];return this.data[s].splice(f,1),T.timeout&&clearTimeout(T.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(T.value),this.order.splice(this.order.indexOf(s),1),this},Re.prototype.setMaxSize=function(a){for(this.max=a;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},Re.prototype.filter=function(a){var u=[];for(var s in this.data)for(var f=0,T=this.data[s];f<T.length;f+=1){var W=T[f];a(W.value)||u.push(W)}for(var K=0,ue=u;K<ue.length;K+=1){var Se=ue[K];this.remove(Se.value.tileID,Se)}};var he=function(a,u,s){this.context=a;var f=a.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(s),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};he.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},he.prototype.updateData=function(a){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)},he.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var se={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},J=function(a,u,s,f){this.length=u.length,this.attributes=s,this.itemSize=u.bytesPerElement,this.dynamicDraw=f,this.context=a;var T=a.gl;this.buffer=T.createBuffer(),a.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};J.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},J.prototype.updateData=function(a){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)},J.prototype.enableAttributes=function(a,u){for(var s=0;s<this.attributes.length;s++){var f=u.attributes[this.attributes[s].name];f!==void 0&&a.enableVertexAttribArray(f)}},J.prototype.setVertexAttribPointers=function(a,u,s){for(var f=0;f<this.attributes.length;f++){var T=this.attributes[f],W=u.attributes[T.name];W!==void 0&&a.vertexAttribPointer(W,T.components,a[se[T.type]],!1,this.itemSize,T.offset+this.itemSize*(s||0))}},J.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fe=function(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};fe.prototype.get=function(){return this.current},fe.prototype.set=function(a){},fe.prototype.getDefault=function(){return this.default},fe.prototype.setDefault=function(){this.set(this.default)};var me=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return o.Color.transparent},u.prototype.set=function(s){var f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)},u}(fe),Le=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)},u}(fe),C=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)},u}(fe),X=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(s){var f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)},u}(fe),de=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)},u}(fe),Ae=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)},u}(fe),De=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(s){var f=this.current;(s.func!==f.func||s.ref!==f.ref||s.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)},u}(fe),Ge=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){var s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]},u.prototype.set=function(s){var f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)},u}(fe),$e=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;s?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=s,this.dirty=!1}},u}(fe),ct=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(s){var f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)},u}(fe),gt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;s?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=s,this.dirty=!1}},u}(fe),st=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)},u}(fe),xe=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;s?f.enable(f.BLEND):f.disable(f.BLEND),this.current=s,this.dirty=!1}},u}(fe),Mt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){var s=this.gl;return[s.ONE,s.ZERO]},u.prototype.set=function(s){var f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)},u}(fe),Ut=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return o.Color.transparent},u.prototype.set=function(s){var f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)},u}(fe),At=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)},u}(fe),nt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;s?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=s,this.dirty=!1}},u}(fe),it=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)},u}(fe),pt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)},u}(fe),Vt=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)},u}(fe),Er=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)},u}(fe),mr=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){var s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]},u.prototype.set=function(s){var f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)},u}(fe),Br=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,s),this.current=s,this.dirty=!1}},u}(fe),Ur=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,s),this.current=s,this.dirty=!1}},u}(fe),Ar=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.bindTexture(f.TEXTURE_2D,s),this.current=s,this.dirty=!1}},u}(fe),Nn=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}},u}(fe),Rn=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1},u}(fe),ci=function(a){function u(s){a.call(this,s),this.vao=s.extVertexArrayObject}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)},u}(fe),Fi=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}},u}(fe),ji=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}},u}(fe),Si=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(s){if(s!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}},u}(fe),xi=function(a){function u(s,f){a.call(this,s),this.context=s,this.parent=f}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(fe),Ee=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(s){if(s!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}},u}(xi),ke=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(s){if(s!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1}},u}(xi),ze=function(a,u,s,f){this.context=a,this.width=u,this.height=s;var T=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Ee(a,T),f&&(this.depthAttachment=new ke(a,T))};ze.prototype.destroy=function(){var a=this.context.gl,u=this.colorAttachment.get();if(u&&a.deleteTexture(u),this.depthAttachment){var s=this.depthAttachment.get();s&&a.deleteRenderbuffer(s)}a.deleteFramebuffer(this.framebuffer)};var Ke=function(a,u,s){this.func=a,this.mask=u,this.range=s};Ke.ReadOnly=!1,Ke.ReadWrite=!0,Ke.disabled=new Ke(519,Ke.ReadOnly,[0,1]);var ot=function(a,u,s,f,T,W){this.test=a,this.ref=u,this.mask=s,this.fail=f,this.depthFail=T,this.pass=W};ot.disabled=new ot({func:519,mask:0},0,0,7680,7680,7680);var Rt=function(a,u,s){this.blendFunction=a,this.blendColor=u,this.mask=s};Rt.disabled=new Rt(Rt.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),Rt.unblended=new Rt(Rt.Replace,o.Color.transparent,[!0,!0,!0,!0]),Rt.alphaBlended=new Rt([1,771],o.Color.transparent,[!0,!0,!0,!0]);var Nt=function(a,u,s){this.enable=a,this.mode=u,this.frontFace=s};Nt.disabled=new Nt(!1,1029,2305),Nt.backCCW=new Nt(!0,1029,2305);var Ye=function(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new me(this),this.clearDepth=new Le(this),this.clearStencil=new C(this),this.colorMask=new X(this),this.depthMask=new de(this),this.stencilMask=new Ae(this),this.stencilFunc=new De(this),this.stencilOp=new Ge(this),this.stencilTest=new $e(this),this.depthRange=new ct(this),this.depthTest=new gt(this),this.depthFunc=new st(this),this.blend=new xe(this),this.blendFunc=new Mt(this),this.blendColor=new Ut(this),this.blendEquation=new At(this),this.cullFace=new nt(this),this.cullFaceSide=new it(this),this.frontFace=new pt(this),this.program=new Vt(this),this.activeTexture=new Er(this),this.viewport=new mr(this),this.bindFramebuffer=new Br(this),this.bindRenderbuffer=new Ur(this),this.bindTexture=new Ar(this),this.bindVertexBuffer=new Nn(this),this.bindElementBuffer=new Rn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ci(this),this.pixelStoreUnpack=new Fi(this),this.pixelStoreUnpackPremultiplyAlpha=new ji(this),this.pixelStoreUnpackFlipY=new Si(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)};Ye.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Ye.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Ye.prototype.createIndexBuffer=function(a,u){return new he(this,a,u)},Ye.prototype.createVertexBuffer=function(a,u,s){return new J(this,a,u,s)},Ye.prototype.createRenderbuffer=function(a,u,s){var f=this.gl,T=f.createRenderbuffer();return this.bindRenderbuffer.set(T),f.renderbufferStorage(f.RENDERBUFFER,a,u,s),this.bindRenderbuffer.set(null),T},Ye.prototype.createFramebuffer=function(a,u,s){return new ze(this,a,u,s)},Ye.prototype.clear=function(a){var u=a.color,s=a.depth,f=this.gl,T=0;u&&(T|=f.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(T|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f.clear(T)},Ye.prototype.setCullFace=function(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))},Ye.prototype.setDepthMode=function(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)},Ye.prototype.setStencilMode=function(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)},Ye.prototype.setColorMode=function(a){o.deepEqual(a.blendFunction,Rt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)},Ye.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Et=function(a){function u(s,f,T){var W=this;a.call(this),this.id=s,this.dispatcher=T,this.on("data",function(K){K.dataType==="source"&&K.sourceDataType==="metadata"&&(W._sourceLoaded=!0),W._sourceLoaded&&!W._paused&&K.dataType==="source"&&K.sourceDataType==="content"&&(W.reload(),W.transform&&W.update(W.transform))}),this.on("error",function(){W._sourceErrored=!0}),this._source=function(K,ue,Se,Ie){var We=new Me[ue.type](K,ue,Se,Ie);if(We.id!==K)throw new Error("Expected Source id to be "+K+" instead of "+We.id);return o.bindAll(["load","abort","unload","serialize","prepare"],We),We}(s,f,T,this),this._tiles={},this._cache=new Re(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.onAdd=function(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)},u.prototype.onRemove=function(s){this._source&&this._source.onRemove&&this._source.onRemove(s)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var s in this._tiles){var f=this._tiles[s];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(s,f){return this._source.loadTile(s,f)},u.prototype._unloadTile=function(s){if(this._source.unloadTile)return this._source.unloadTile(s,function(){})},u.prototype._abortTile=function(s){if(this._source.abortTile)return this._source.abortTile(s,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(s){for(var f in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var T=this._tiles[f];T.upload(s),T.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return o.values(this._tiles).map(function(s){return s.tileID}).sort(Zt).map(function(s){return s.key})},u.prototype.getRenderableIds=function(s){var f=this,T=[];for(var W in this._tiles)this._isIdRenderable(W,s)&&T.push(this._tiles[W]);return s?T.sort(function(K,ue){var Se=K.tileID,Ie=ue.tileID,We=new o.Point(Se.canonical.x,Se.canonical.y)._rotate(f.transform.angle),Xe=new o.Point(Ie.canonical.x,Ie.canonical.y)._rotate(f.transform.angle);return Se.overscaledZ-Ie.overscaledZ||Xe.y-We.y||Xe.x-We.x}).map(function(K){return K.tileID.key}):T.map(function(K){return K.tileID}).sort(Zt).map(function(K){return K.key})},u.prototype.hasRenderableParent=function(s){var f=this.findLoadedParent(s,0);return!!f&&this._isIdRenderable(f.tileID.key)},u.prototype._isIdRenderable=function(s,f){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(f||!this._tiles[s].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var s in this._cache.reset(),this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")},u.prototype._reloadTile=function(s,f){var T=this._tiles[s];T&&(T.state!=="loading"&&(T.state=f),this._loadTile(T,this._tileLoaded.bind(this,T,s,f)))},u.prototype._tileLoaded=function(s,f,T,W){if(W)return s.state="errored",void(W.status!==404?this._source.fire(new o.ErrorEvent(W,{tile:s})):this.update(this.transform));s.timeAdded=o.browser.now(),T==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(f,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:s,coord:s.tileID}))},u.prototype._backfillDEM=function(s){for(var f=this.getRenderableIds(),T=0;T<f.length;T++){var W=f[T];if(s.neighboringTiles&&s.neighboringTiles[W]){var K=this.getTileByID(W);ue(s,K),ue(K,s)}}function ue(Se,Ie){Se.needsHillshadePrepare=!0;var We=Ie.tileID.canonical.x-Se.tileID.canonical.x,Xe=Ie.tileID.canonical.y-Se.tileID.canonical.y,Je=Math.pow(2,Se.tileID.canonical.z),xt=Ie.tileID.key;We===0&&Xe===0||Math.abs(Xe)>1||(Math.abs(We)>1&&(Math.abs(We+Je)===1?We+=Je:Math.abs(We-Je)===1&&(We-=Je)),Ie.dem&&Se.dem&&(Se.dem.backfillBorder(Ie.dem,We,Xe),Se.neighboringTiles&&Se.neighboringTiles[xt]&&(Se.neighboringTiles[xt].backfilled=!0)))}},u.prototype.getTile=function(s){return this.getTileByID(s.key)},u.prototype.getTileByID=function(s){return this._tiles[s]},u.prototype._retainLoadedChildren=function(s,f,T,W){for(var K in this._tiles){var ue=this._tiles[K];if(!(W[K]||!ue.hasData()||ue.tileID.overscaledZ<=f||ue.tileID.overscaledZ>T)){for(var Se=ue.tileID;ue&&ue.tileID.overscaledZ>f+1;){var Ie=ue.tileID.scaledTo(ue.tileID.overscaledZ-1);(ue=this._tiles[Ie.key])&&ue.hasData()&&(Se=Ie)}for(var We=Se;We.overscaledZ>f;)if(s[(We=We.scaledTo(We.overscaledZ-1)).key]){W[Se.key]=Se;break}}}},u.prototype.findLoadedParent=function(s,f){if(s.key in this._loadedParentTiles){var T=this._loadedParentTiles[s.key];return T&&T.tileID.overscaledZ>=f?T:null}for(var W=s.overscaledZ-1;W>=f;W--){var K=s.scaledTo(W),ue=this._getLoadedTile(K);if(ue)return ue}},u.prototype._getLoadedTile=function(s){var f=this._tiles[s.key];return f&&f.hasData()?f:this._cache.getByKey(s.wrapped().key)},u.prototype.updateCacheSize=function(s){var f=Math.ceil(s.width/this._source.tileSize)+1,T=Math.ceil(s.height/this._source.tileSize)+1,W=Math.floor(f*T*5),K=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,W):W;this._cache.setMaxSize(K)},u.prototype.handleWrapJump=function(s){var f=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,f){var T={};for(var W in this._tiles){var K=this._tiles[W];K.tileID=K.tileID.unwrapTo(K.tileID.wrap+f),T[K.tileID.key]=K}for(var ue in this._tiles=T,this._timers)clearTimeout(this._timers[ue]),delete this._timers[ue];for(var Se in this._tiles)this._setTileReloadTimer(Se,this._tiles[Se])}},u.prototype.update=function(s){var f=this;if(this.transform=s,this._sourceLoaded&&!this._paused){var T;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?T=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(zr){return new o.OverscaledTileID(zr.canonical.z,zr.wrap,zr.canonical.z,zr.canonical.x,zr.canonical.y)}):(T=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(T=T.filter(function(zr){return f._source.hasTile(zr)}))):T=[];var W=s.coveringZoomLevel(this._source),K=Math.max(W-u.maxOverzooming,this._source.minzoom),ue=Math.max(W+u.maxUnderzooming,this._source.minzoom),Se=this._updateRetainedTiles(T,W);if(Lr(this._source.type)){for(var Ie={},We={},Xe=0,Je=Object.keys(Se);Xe<Je.length;Xe+=1){var xt=Je[Xe],_t=Se[xt],Pt=this._tiles[xt];if(Pt&&!(Pt.fadeEndTime&&Pt.fadeEndTime<=o.browser.now())){var ft=this.findLoadedParent(_t,K);ft&&(this._addTile(ft.tileID),Ie[ft.tileID.key]=ft.tileID),We[xt]=_t}}for(var Ot in this._retainLoadedChildren(We,W,ue,Se),Ie)Se[Ot]||(this._coveredTiles[Ot]=!0,Se[Ot]=Ie[Ot])}for(var jt in Se)this._tiles[jt].clearFadeHold();for(var er=0,br=o.keysDifference(this._tiles,Se);er<br.length;er+=1){var yr=br[er],Cr=this._tiles[yr];Cr.hasSymbolBuckets&&!Cr.holdingForFade()?Cr.setHoldDuration(this.map._fadeDuration):Cr.hasSymbolBuckets&&!Cr.symbolFadeFinished()||this._removeTile(yr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)},u.prototype._updateRetainedTiles=function(s,f){for(var T={},W={},K=Math.max(f-u.maxOverzooming,this._source.minzoom),ue=Math.max(f+u.maxUnderzooming,this._source.minzoom),Se={},Ie=0,We=s;Ie<We.length;Ie+=1){var Xe=We[Ie],Je=this._addTile(Xe);T[Xe.key]=Xe,Je.hasData()||f<this._source.maxzoom&&(Se[Xe.key]=Xe)}this._retainLoadedChildren(Se,f,ue,T);for(var xt=0,_t=s;xt<_t.length;xt+=1){var Pt=_t[xt],ft=this._tiles[Pt.key];if(!ft.hasData()){if(f+1>this._source.maxzoom){var Ot=Pt.children(this._source.maxzoom)[0],jt=this.getTile(Ot);if(jt&&jt.hasData()){T[Ot.key]=Ot;continue}}else{var er=Pt.children(this._source.maxzoom);if(T[er[0].key]&&T[er[1].key]&&T[er[2].key]&&T[er[3].key])continue}for(var br=ft.wasRequested(),yr=Pt.overscaledZ-1;yr>=K;--yr){var Cr=Pt.scaledTo(yr);if(W[Cr.key]||(W[Cr.key]=!0,!(ft=this.getTile(Cr))&&br&&(ft=this._addTile(Cr)),ft&&(T[Cr.key]=Cr,br=ft.wasRequested(),ft.hasData())))break}}}return T},u.prototype._updateLoadedParentTileCache=function(){for(var s in this._loadedParentTiles={},this._tiles){for(var f=[],T=void 0,W=this._tiles[s].tileID;W.overscaledZ>0;){if(W.key in this._loadedParentTiles){T=this._loadedParentTiles[W.key];break}f.push(W.key);var K=W.scaledTo(W.overscaledZ-1);if(T=this._getLoadedTile(K))break;W=K}for(var ue=0,Se=f;ue<Se.length;ue+=1)this._loadedParentTiles[Se[ue]]=T}},u.prototype._addTile=function(s){var f=this._tiles[s.key];if(f)return f;(f=this._cache.getAndRemove(s))&&(this._setTileReloadTimer(s.key,f),f.tileID=s,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,f)));var T=Boolean(f);return T||(f=new o.Tile(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(f,this._tileLoaded.bind(this,f,s.key,f.state))),f?(f.uses++,this._tiles[s.key]=f,T||this._source.fire(new o.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f):null},u.prototype._setTileReloadTimer=function(s,f){var T=this;s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);var W=f.getExpiryTimeout();W&&(this._timers[s]=setTimeout(function(){T._reloadTile(s,"expired"),delete T._timers[s]},W))},u.prototype._removeTile=function(s){var f=this._tiles[s];f&&(f.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))},u.prototype.clearTiles=function(){for(var s in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(s);this._cache.reset()},u.prototype.tilesIn=function(s,f,T){var W=this,K=[],ue=this.transform;if(!ue)return K;for(var Se=T?ue.getCameraQueryGeometry(s):s,Ie=s.map(function(yr){return ue.pointCoordinate(yr)}),We=Se.map(function(yr){return ue.pointCoordinate(yr)}),Xe=this.getIds(),Je=1/0,xt=1/0,_t=-1/0,Pt=-1/0,ft=0,Ot=We;ft<Ot.length;ft+=1){var jt=Ot[ft];Je=Math.min(Je,jt.x),xt=Math.min(xt,jt.y),_t=Math.max(_t,jt.x),Pt=Math.max(Pt,jt.y)}for(var er=function(yr){var Cr=W._tiles[Xe[yr]];if(!Cr.holdingForFade()){var zr=Cr.tileID,un=Math.pow(2,ue.zoom-Cr.tileID.overscaledZ),qr=f*Cr.queryPadding*o.EXTENT/Cr.tileSize/un,Dn=[zr.getTilePoint(new o.MercatorCoordinate(Je,xt)),zr.getTilePoint(new o.MercatorCoordinate(_t,Pt))];if(Dn[0].x-qr<o.EXTENT&&Dn[0].y-qr<o.EXTENT&&Dn[1].x+qr>=0&&Dn[1].y+qr>=0){var $n=Ie.map(function(ii){return zr.getTilePoint(ii)}),Jn=We.map(function(ii){return zr.getTilePoint(ii)});K.push({tile:Cr,tileID:zr,queryGeometry:$n,cameraQueryGeometry:Jn,scale:un})}}},br=0;br<Xe.length;br++)er(br);return K},u.prototype.getVisibleCoordinates=function(s){for(var f=this,T=this.getRenderableIds(s).map(function(Se){return f._tiles[Se].tileID}),W=0,K=T;W<K.length;W+=1){var ue=K[W];ue.posMatrix=this.transform.calculatePosMatrix(ue.toUnwrapped())}return T},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lr(this._source.type))for(var s in this._tiles){var f=this._tiles[s];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=o.browser.now())return!0}return!1},u.prototype.setFeatureState=function(s,f,T){this._state.updateState(s=s||"_geojsonTileLayer",f,T)},u.prototype.removeFeatureState=function(s,f,T){this._state.removeFeatureState(s=s||"_geojsonTileLayer",f,T)},u.prototype.getFeatureState=function(s,f){return this._state.getState(s=s||"_geojsonTileLayer",f)},u.prototype.setDependencies=function(s,f,T){var W=this._tiles[s];W&&W.setDependencies(f,T)},u.prototype.reloadTilesForDependencies=function(s,f){for(var T in this._tiles)this._tiles[T].hasDependency(s,f)&&this._reloadTile(T,"reloading");this._cache.filter(function(W){return!W.hasDependency(s,f)})},u}(o.Evented);function Zt(a,u){var s=Math.abs(2*a.wrap)-+(a.wrap<0),f=Math.abs(2*u.wrap)-+(u.wrap<0);return a.overscaledZ-u.overscaledZ||f-s||u.canonical.y-a.canonical.y||u.canonical.x-a.canonical.x}function Lr(a){return a==="raster"||a==="image"||a==="video"}function ir(){return new o.window.Worker(Bo.workerUrl)}Et.maxOverzooming=10,Et.maxUnderzooming=3;var ur="mapboxgl_preloaded_worker_pool",Or=function(){this.active={}};Or.prototype.acquire=function(a){if(!this.workers)for(this.workers=[];this.workers.length<Or.workerCount;)this.workers.push(new ir);return this.active[a]=!0,this.workers.slice()},Or.prototype.release=function(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Or.prototype.isPreloaded=function(){return!!this.active[ur]},Or.prototype.numActive=function(){return Object.keys(this.active).length};var nn,Hr=Math.floor(o.browser.hardwareConcurrency/2);function gr(){return nn||(nn=new Or),nn}function vn(a,u){var s={};for(var f in a)f!=="ref"&&(s[f]=a[f]);return o.refProperties.forEach(function(T){T in u&&(s[T]=u[T])}),s}function an(a){a=a.slice();for(var u=Object.create(null),s=0;s<a.length;s++)u[a[s].id]=a[s];for(var f=0;f<a.length;f++)"ref"in a[f]&&(a[f]=vn(a[f],u[a[f].ref]));return a}Or.workerCount=Math.max(Math.min(Hr,6),1);var sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(a,u,s){s.push({command:sn.addSource,args:[a,u[a]]})}function fn(a,u,s){u.push({command:sn.removeSource,args:[a]}),s[a]=!0}function ni(a,u,s,f){fn(a,s,f),Ei(a,u,s)}function Ui(a,u,s){var f;for(f in a[s])if(a[s].hasOwnProperty(f)&&f!=="data"&&!o.deepEqual(a[s][f],u[s][f]))return!1;for(f in u[s])if(u[s].hasOwnProperty(f)&&f!=="data"&&!o.deepEqual(a[s][f],u[s][f]))return!1;return!0}function mi(a,u,s,f,T,W){var K;for(K in u=u||{},a=a||{})a.hasOwnProperty(K)&&(o.deepEqual(a[K],u[K])||s.push({command:W,args:[f,K,u[K],T]}));for(K in u)u.hasOwnProperty(K)&&!a.hasOwnProperty(K)&&(o.deepEqual(a[K],u[K])||s.push({command:W,args:[f,K,u[K],T]}))}function Li(a){return a.id}function ui(a,u){return a[u.id]=u,a}var fi=function(a,u){this.reset(a,u)};fi.prototype.reset=function(a,u){this.points=a||[],this._distances=[0];for(var s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},fi.prototype.lerp=function(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);for(var u=1,s=this._distances[u],f=a*this.paddedLength+this.padding;s<f&&u<this._distances.length;)s=this._distances[++u];var T=u-1,W=this._distances[T],K=s-W,ue=K>0?(f-W)/K:0;return this.points[T].mult(1-ue).add(this.points[u].mult(ue))};var Wi=function(a,u,s){var f=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(a/s),this.yCellCount=Math.ceil(u/s);for(var W=0;W<this.xCellCount*this.yCellCount;W++)f.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function va(a,u,s,f,T){var W=o.create();return u?(o.scale(W,W,[1/T,1/T,1]),s||o.rotateZ(W,W,f.angle)):o.multiply(W,f.labelPlaneMatrix,a),W}function Pi(a,u,s,f,T){if(u){var W=o.clone(a);return o.scale(W,W,[T,T,1]),s||o.rotateZ(W,W,-f.angle),W}return f.glCoordMatrix}function hi(a,u){var s=[a.x,a.y,0,1];wa(s,s,u);var f=s[3];return{point:new o.Point(s[0]/f,s[1]/f),signedDistanceFromCamera:f}}function Ii(a,u){return .5+a/u*.5}function La(a,u){var s=a[0]/a[3],f=a[1]/a[3];return s>=-u[0]&&s<=u[0]&&f>=-u[1]&&f<=u[1]}function ls(a,u,s,f,T,W,K,ue){var Se=f?a.textSizeData:a.iconSizeData,Ie=o.evaluateSizeForZoom(Se,s.transform.zoom),We=[256/s.width*2+1,256/s.height*2+1],Xe=f?a.text.dynamicLayoutVertexArray:a.icon.dynamicLayoutVertexArray;Xe.clear();for(var Je=a.lineVertexArray,xt=f?a.text.placedSymbolArray:a.icon.placedSymbolArray,_t=s.transform.width/s.transform.height,Pt=!1,ft=0;ft<xt.length;ft++){var Ot=xt.get(ft);if(Ot.hidden||Ot.writingMode===o.WritingMode.vertical&&!Pt)_a(Ot.numGlyphs,Xe);else{Pt=!1;var jt=[Ot.anchorX,Ot.anchorY,0,1];if(o.transformMat4(jt,jt,u),La(jt,We)){var er=Ii(s.transform.cameraToCenterDistance,jt[3]),br=o.evaluateSizeForFeature(Se,Ie,Ot),yr=K?br/er:br*er,Cr=new o.Point(Ot.anchorX,Ot.anchorY),zr=hi(Cr,T).point,un={},qr=Qo(Ot,yr,!1,ue,u,T,W,a.glyphOffsetArray,Je,Xe,zr,Cr,un,_t);Pt=qr.useVertical,(qr.notEnoughRoom||Pt||qr.needsFlipping&&Qo(Ot,yr,!0,ue,u,T,W,a.glyphOffsetArray,Je,Xe,zr,Cr,un,_t).notEnoughRoom)&&_a(Ot.numGlyphs,Xe)}else _a(Ot.numGlyphs,Xe)}}f?a.text.dynamicLayoutVertexBuffer.updateData(Xe):a.icon.dynamicLayoutVertexBuffer.updateData(Xe)}function Ta(a,u,s,f,T,W,K,ue,Se,Ie,We){var Xe=ue.glyphStartIndex+ue.numGlyphs,Je=ue.lineStartIndex,xt=ue.lineStartIndex+ue.lineLength,_t=u.getoffsetX(ue.glyphStartIndex),Pt=u.getoffsetX(Xe-1),ft=sa(a*_t,s,f,T,W,K,ue.segment,Je,xt,Se,Ie,We);if(!ft)return null;var Ot=sa(a*Pt,s,f,T,W,K,ue.segment,Je,xt,Se,Ie,We);return Ot?{first:ft,last:Ot}:null}function ma(a,u,s,f){return a===o.WritingMode.horizontal&&Math.abs(s.y-u.y)>Math.abs(s.x-u.x)*f?{useVertical:!0}:(a===o.WritingMode.vertical?u.y<s.y:u.x>s.x)?{needsFlipping:!0}:null}function Qo(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe,Je,xt){var _t,Pt=u/24,ft=a.lineOffsetX*Pt,Ot=a.lineOffsetY*Pt;if(a.numGlyphs>1){var jt=a.glyphStartIndex+a.numGlyphs,er=a.lineStartIndex,br=a.lineStartIndex+a.lineLength,yr=Ta(Pt,ue,ft,Ot,s,We,Xe,a,Se,W,Je);if(!yr)return{notEnoughRoom:!0};var Cr=hi(yr.first.point,K).point,zr=hi(yr.last.point,K).point;if(f&&!s){var un=ma(a.writingMode,Cr,zr,xt);if(un)return un}_t=[yr.first];for(var qr=a.glyphStartIndex+1;qr<jt-1;qr++)_t.push(sa(Pt*ue.getoffsetX(qr),ft,Ot,s,We,Xe,a.segment,er,br,Se,W,Je));_t.push(yr.last)}else{if(f&&!s){var Dn=hi(Xe,T).point,$n=a.lineStartIndex+a.segment+1,Jn=new o.Point(Se.getx($n),Se.gety($n)),ii=hi(Jn,T),qi=ii.signedDistanceFromCamera>0?ii.point:Es(Xe,Jn,Dn,1,T),zn=ma(a.writingMode,Dn,qi,xt);if(zn)return zn}var di=sa(Pt*ue.getoffsetX(a.glyphStartIndex),ft,Ot,s,We,Xe,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,Se,W,Je);if(!di)return{notEnoughRoom:!0};_t=[di]}for(var Bi=0,bi=_t;Bi<bi.length;Bi+=1){var gi=bi[Bi];o.addDynamicAttributes(Ie,gi.point,gi.angle)}return{}}function Es(a,u,s,f,T){var W=hi(a.add(a.sub(u)._unit()),T).point,K=s.sub(W);return s.add(K._mult(f/K.mag()))}function sa(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe){var Je=f?a-u:a+u,xt=Je>0?1:-1,_t=0;f&&(xt*=-1,_t=Math.PI),xt<0&&(_t+=Math.PI);for(var Pt=xt>0?ue+K:ue+K+1,ft=T,Ot=T,jt=0,er=0,br=Math.abs(Je),yr=[];jt+er<=br;){if((Pt+=xt)<ue||Pt>=Se)return null;if(Ot=ft,yr.push(ft),(ft=Xe[Pt])===void 0){var Cr=new o.Point(Ie.getx(Pt),Ie.gety(Pt)),zr=hi(Cr,We);if(zr.signedDistanceFromCamera>0)ft=Xe[Pt]=zr.point;else{var un=Pt-xt;ft=Es(jt===0?W:new o.Point(Ie.getx(un),Ie.gety(un)),Cr,Ot,br-jt+1,We)}}jt+=er,er=Ot.dist(ft)}var qr=(br-jt)/er,Dn=ft.sub(Ot),$n=Dn.mult(qr)._add(Ot);$n._add(Dn._unit()._perp()._mult(s*xt));var Jn=_t+Math.atan2(ft.y-Ot.y,ft.x-Ot.x);return yr.push($n),{point:$n,angle:Jn,path:yr}}Wi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Wi.prototype.insert=function(a,u,s,f,T){this._forEachCell(u,s,f,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(T)},Wi.prototype.insertCircle=function(a,u,s,f){this._forEachCell(u-f,s-f,u+f,s+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(s),this.circles.push(f)},Wi.prototype._insertBoxCell=function(a,u,s,f,T,W){this.boxCells[T].push(W)},Wi.prototype._insertCircleCell=function(a,u,s,f,T,W){this.circleCells[T].push(W)},Wi.prototype._query=function(a,u,s,f,T,W){if(s<0||a>this.width||f<0||u>this.height)return!T&&[];var K=[];if(a<=0&&u<=0&&this.width<=s&&this.height<=f){if(T)return!0;for(var ue=0;ue<this.boxKeys.length;ue++)K.push({key:this.boxKeys[ue],x1:this.bboxes[4*ue],y1:this.bboxes[4*ue+1],x2:this.bboxes[4*ue+2],y2:this.bboxes[4*ue+3]});for(var Se=0;Se<this.circleKeys.length;Se++){var Ie=this.circles[3*Se],We=this.circles[3*Se+1],Xe=this.circles[3*Se+2];K.push({key:this.circleKeys[Se],x1:Ie-Xe,y1:We-Xe,x2:Ie+Xe,y2:We+Xe})}return W?K.filter(W):K}return this._forEachCell(a,u,s,f,this._queryCell,K,{hitTest:T,seenUids:{box:{},circle:{}}},W),T?K.length>0:K},Wi.prototype._queryCircle=function(a,u,s,f,T){var W=a-s,K=a+s,ue=u-s,Se=u+s;if(K<0||W>this.width||Se<0||ue>this.height)return!f&&[];var Ie=[];return this._forEachCell(W,ue,K,Se,this._queryCellCircle,Ie,{hitTest:f,circle:{x:a,y:u,radius:s},seenUids:{box:{},circle:{}}},T),f?Ie.length>0:Ie},Wi.prototype.query=function(a,u,s,f,T){return this._query(a,u,s,f,!1,T)},Wi.prototype.hitTest=function(a,u,s,f,T){return this._query(a,u,s,f,!0,T)},Wi.prototype.hitTestCircle=function(a,u,s,f){return this._queryCircle(a,u,s,!0,f)},Wi.prototype._queryCell=function(a,u,s,f,T,W,K,ue){var Se=K.seenUids,Ie=this.boxCells[T];if(Ie!==null)for(var We=this.bboxes,Xe=0,Je=Ie;Xe<Je.length;Xe+=1){var xt=Je[Xe];if(!Se.box[xt]){Se.box[xt]=!0;var _t=4*xt;if(a<=We[_t+2]&&u<=We[_t+3]&&s>=We[_t+0]&&f>=We[_t+1]&&(!ue||ue(this.boxKeys[xt]))){if(K.hitTest)return W.push(!0),!0;W.push({key:this.boxKeys[xt],x1:We[_t],y1:We[_t+1],x2:We[_t+2],y2:We[_t+3]})}}}var Pt=this.circleCells[T];if(Pt!==null)for(var ft=this.circles,Ot=0,jt=Pt;Ot<jt.length;Ot+=1){var er=jt[Ot];if(!Se.circle[er]){Se.circle[er]=!0;var br=3*er;if(this._circleAndRectCollide(ft[br],ft[br+1],ft[br+2],a,u,s,f)&&(!ue||ue(this.circleKeys[er]))){if(K.hitTest)return W.push(!0),!0;var yr=ft[br],Cr=ft[br+1],zr=ft[br+2];W.push({key:this.circleKeys[er],x1:yr-zr,y1:Cr-zr,x2:yr+zr,y2:Cr+zr})}}}},Wi.prototype._queryCellCircle=function(a,u,s,f,T,W,K,ue){var Se=K.circle,Ie=K.seenUids,We=this.boxCells[T];if(We!==null)for(var Xe=this.bboxes,Je=0,xt=We;Je<xt.length;Je+=1){var _t=xt[Je];if(!Ie.box[_t]){Ie.box[_t]=!0;var Pt=4*_t;if(this._circleAndRectCollide(Se.x,Se.y,Se.radius,Xe[Pt+0],Xe[Pt+1],Xe[Pt+2],Xe[Pt+3])&&(!ue||ue(this.boxKeys[_t])))return W.push(!0),!0}}var ft=this.circleCells[T];if(ft!==null)for(var Ot=this.circles,jt=0,er=ft;jt<er.length;jt+=1){var br=er[jt];if(!Ie.circle[br]){Ie.circle[br]=!0;var yr=3*br;if(this._circlesCollide(Ot[yr],Ot[yr+1],Ot[yr+2],Se.x,Se.y,Se.radius)&&(!ue||ue(this.circleKeys[br])))return W.push(!0),!0}}},Wi.prototype._forEachCell=function(a,u,s,f,T,W,K,ue){for(var Se=this._convertToXCellCoord(a),Ie=this._convertToYCellCoord(u),We=this._convertToXCellCoord(s),Xe=this._convertToYCellCoord(f),Je=Se;Je<=We;Je++)for(var xt=Ie;xt<=Xe;xt++)if(T.call(this,a,u,s,f,this.xCellCount*xt+Je,W,K,ue))return},Wi.prototype._convertToXCellCoord=function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))},Wi.prototype._convertToYCellCoord=function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))},Wi.prototype._circlesCollide=function(a,u,s,f,T,W){var K=f-a,ue=T-u,Se=s+W;return Se*Se>K*K+ue*ue},Wi.prototype._circleAndRectCollide=function(a,u,s,f,T,W,K){var ue=(W-f)/2,Se=Math.abs(a-(f+ue));if(Se>ue+s)return!1;var Ie=(K-T)/2,We=Math.abs(u-(T+Ie));if(We>Ie+s)return!1;if(Se<=ue||We<=Ie)return!0;var Xe=Se-ue,Je=We-Ie;return Xe*Xe+Je*Je<=s*s};var to=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _a(a,u){for(var s=0;s<a;s++){var f=u.length;u.resize(f+4),u.float32.set(to,3*f)}}function wa(a,u,s){var f=u[0],T=u[1];return a[0]=s[0]*f+s[4]*T+s[12],a[1]=s[1]*f+s[5]*T+s[13],a[3]=s[3]*f+s[7]*T+s[15],a}var $a=function(a,u,s){u===void 0&&(u=new Wi(a.width+200,a.height+200,25)),s===void 0&&(s=new Wi(a.width+200,a.height+200,25)),this.transform=a,this.grid=u,this.ignoredGrid=s,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+100,this.screenBottomBoundary=a.height+100,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200};function ia(a,u,s){return u*(o.EXTENT/(a.tileSize*Math.pow(2,s-a.tileID.overscaledZ)))}$a.prototype.placeCollisionBox=function(a,u,s,f,T){var W=this.projectAndGetPerspectiveRatio(f,a.anchorPointX,a.anchorPointY),K=s*W.perspectiveRatio,ue=a.x1*K+W.point.x,Se=a.y1*K+W.point.y,Ie=a.x2*K+W.point.x,We=a.y2*K+W.point.y;return!this.isInsideGrid(ue,Se,Ie,We)||!u&&this.grid.hitTest(ue,Se,Ie,We,T)?{box:[],offscreen:!1}:{box:[ue,Se,Ie,We],offscreen:this.isOffscreen(ue,Se,Ie,We)}},$a.prototype.placeCollisionCircles=function(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe,Je){var xt=[],_t=new o.Point(u.anchorX,u.anchorY),Pt=hi(_t,W),ft=Ii(this.transform.cameraToCenterDistance,Pt.signedDistanceFromCamera),Ot=(Ie?T/ft:T*ft)/o.ONE_EM,jt=hi(_t,K).point,er=Ta(Ot,f,u.lineOffsetX*Ot,u.lineOffsetY*Ot,!1,jt,_t,u,s,K,{}),br=!1,yr=!1,Cr=!0;if(er){for(var zr=.5*Xe*ft+Je,un=new o.Point(-100,-100),qr=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Dn=new fi,$n=er.first,Jn=er.last,ii=[],qi=$n.path.length-1;qi>=1;qi--)ii.push($n.path[qi]);for(var zn=1;zn<Jn.path.length;zn++)ii.push(Jn.path[zn]);var di=2.5*zr;if(ue){var Bi=ii.map(function(As){return hi(As,ue)});ii=Bi.some(function(As){return As.signedDistanceFromCamera<=0})?[]:Bi.map(function(As){return As.point})}var bi=[];if(ii.length>0){for(var gi=ii[0].clone(),Di=ii[0].clone(),pi=1;pi<ii.length;pi++)gi.x=Math.min(gi.x,ii[pi].x),gi.y=Math.min(gi.y,ii[pi].y),Di.x=Math.max(Di.x,ii[pi].x),Di.y=Math.max(Di.y,ii[pi].y);bi=gi.x>=un.x&&Di.x<=qr.x&&gi.y>=un.y&&Di.y<=qr.y?[ii]:Di.x<un.x||gi.x>qr.x||Di.y<un.y||gi.y>qr.y?[]:o.clipLine([ii],un.x,un.y,qr.x,qr.y)}for(var li=0,Co=bi;li<Co.length;li+=1){var oo;Dn.reset(Co[li],.25*zr),oo=Dn.length<=.5*zr?1:Math.ceil(Dn.paddedLength/di)+1;for(var Ho=0;Ho<oo;Ho++){var Lo=Ho/Math.max(oo-1,1),qa=Dn.lerp(Lo),so=qa.x+100,hs=qa.y+100;xt.push(so,hs,zr,0);var ts=so-zr,Cu=hs-zr,ds=so+zr,zs=hs+zr;if(Cr=Cr&&this.isOffscreen(ts,Cu,ds,zs),yr=yr||this.isInsideGrid(ts,Cu,ds,zs),!a&&this.grid.hitTestCircle(so,hs,zr,We)&&(br=!0,!Se))return{circles:[],offscreen:!1,collisionDetected:br}}}}return{circles:!Se&&br||!yr?[]:xt,offscreen:Cr,collisionDetected:br}},$a.prototype.queryRenderedSymbols=function(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],s=1/0,f=1/0,T=-1/0,W=-1/0,K=0,ue=a;K<ue.length;K+=1){var Se=ue[K],Ie=new o.Point(Se.x+100,Se.y+100);s=Math.min(s,Ie.x),f=Math.min(f,Ie.y),T=Math.max(T,Ie.x),W=Math.max(W,Ie.y),u.push(Ie)}for(var We={},Xe={},Je=0,xt=this.grid.query(s,f,T,W).concat(this.ignoredGrid.query(s,f,T,W));Je<xt.length;Je+=1){var _t=xt[Je],Pt=_t.key;if(We[Pt.bucketInstanceId]===void 0&&(We[Pt.bucketInstanceId]={}),!We[Pt.bucketInstanceId][Pt.featureIndex]){var ft=[new o.Point(_t.x1,_t.y1),new o.Point(_t.x2,_t.y1),new o.Point(_t.x2,_t.y2),new o.Point(_t.x1,_t.y2)];o.polygonIntersectsPolygon(u,ft)&&(We[Pt.bucketInstanceId][Pt.featureIndex]=!0,Xe[Pt.bucketInstanceId]===void 0&&(Xe[Pt.bucketInstanceId]=[]),Xe[Pt.bucketInstanceId].push(Pt.featureIndex))}}return Xe},$a.prototype.insertCollisionBox=function(a,u,s,f,T){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:f,collisionGroupID:T},a[0],a[1],a[2],a[3])},$a.prototype.insertCollisionCircles=function(a,u,s,f,T){for(var W=u?this.ignoredGrid:this.grid,K={bucketInstanceId:s,featureIndex:f,collisionGroupID:T},ue=0;ue<a.length;ue+=4)W.insertCircle(K,a[ue],a[ue+1],a[ue+2])},$a.prototype.projectAndGetPerspectiveRatio=function(a,u,s){var f=[u,s,0,1];return wa(f,f,a),{point:new o.Point((f[0]/f[3]+1)/2*this.transform.width+100,(-f[1]/f[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}},$a.prototype.isOffscreen=function(a,u,s,f){return s<100||a>=this.screenRightBoundary||f<100||u>this.screenBottomBoundary},$a.prototype.isInsideGrid=function(a,u,s,f){return s>=0&&a<this.gridRightBoundary&&f>=0&&u<this.gridBottomBoundary},$a.prototype.getViewportMatrix=function(){var a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a};var Ja=function(a,u,s,f){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):f&&s?1:0,this.placed=s};Ja.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var ro=function(a,u,s,f,T){this.text=new Ja(a?a.text:null,u,s,T),this.icon=new Ja(a?a.icon:null,u,f,T)};ro.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Xa=function(a,u,s){this.text=a,this.icon=u,this.skipFade=s},no=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},go=function(a,u,s,f,T){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=s,this.bucketIndex=f,this.tileID=T},fa=function(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}};function ja(a,u,s,f,T){var W=o.getAnchorAlignment(a),K=-(W.horizontalAlign-.5)*u,ue=-(W.verticalAlign-.5)*s,Se=o.evaluateVariableOffset(a,f);return new o.Point(K+Se[0]*T,ue+Se[1]*T)}function Qa(a,u,s,f,T,W){var K=a.x1,ue=a.x2,Se=a.y1,Ie=a.y2,We=a.anchorPointX,Xe=a.anchorPointY,Je=new o.Point(u,s);return f&&Je._rotate(T?W:-W),{x1:K+Je.x,y1:Se+Je.y,x2:ue+Je.x,y2:Ie+Je.y,anchorPointX:We,anchorPointY:Xe}}fa.prototype.get=function(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){var u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:function(s){return s.collisionGroupID===u}}}return this.collisionGroups[a]};var Ua=function(a,u,s,f){this.transform=a.clone(),this.collisionIndex=new $a(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new fa(s),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}};function Ve(a,u,s,f,T){a.emplaceBack(u?1:0,s?1:0,f||0,T||0),a.emplaceBack(u?1:0,s?1:0,f||0,T||0),a.emplaceBack(u?1:0,s?1:0,f||0,T||0),a.emplaceBack(u?1:0,s?1:0,f||0,T||0)}Ua.prototype.getBucketParts=function(a,u,s,f){var T=s.getBucket(u),W=s.latestFeatureIndex;if(T&&W&&u.id===T.layerIds[0]){var K=s.collisionBoxArray,ue=T.layers[0].layout,Se=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),Ie=s.tileSize/o.EXTENT,We=this.transform.calculatePosMatrix(s.tileID.toUnwrapped()),Xe=ue.get("text-pitch-alignment")==="map",Je=ue.get("text-rotation-alignment")==="map",xt=ia(s,1,this.transform.zoom),_t=va(We,Xe,Je,this.transform,xt),Pt=null;if(Xe){var ft=Pi(We,Xe,Je,this.transform,xt);Pt=o.multiply([],this.transform.labelPlaneMatrix,ft)}this.retainedQueryData[T.bucketInstanceId]=new go(T.bucketInstanceId,W,T.sourceLayerIndex,T.index,s.tileID);var Ot={bucket:T,layout:ue,posMatrix:We,textLabelPlaneMatrix:_t,labelToScreenMatrix:Pt,scale:Se,textPixelRatio:Ie,holdingForFade:s.holdingForFade(),collisionBoxArray:K,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(f)for(var jt=0,er=T.sortKeyRanges;jt<er.length;jt+=1){var br=er[jt];a.push({sortKey:br.sortKey,symbolInstanceStart:br.symbolInstanceStart,symbolInstanceEnd:br.symbolInstanceEnd,parameters:Ot})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ot})}},Ua.prototype.attemptAnchorPlacement=function(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe,Je,xt,_t){var Pt,ft=[Xe.textOffset0,Xe.textOffset1],Ot=ja(a,s,f,ft,T),jt=this.collisionIndex.placeCollisionBox(Qa(u,Ot.x,Ot.y,W,K,this.transform.angle),We,ue,Se,Ie.predicate);if(!_t||this.collisionIndex.placeCollisionBox(Qa(_t,Ot.x,Ot.y,W,K,this.transform.angle),We,ue,Se,Ie.predicate).box.length!==0)return jt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Xe.crossTileID]&&this.prevPlacement.placements[Xe.crossTileID]&&this.prevPlacement.placements[Xe.crossTileID].text&&(Pt=this.prevPlacement.variableOffsets[Xe.crossTileID].anchor),this.variableOffsets[Xe.crossTileID]={textOffset:ft,width:s,height:f,anchor:a,textBoxScale:T,prevAnchor:Pt},this.markUsedJustification(Je,a,Xe,xt),Je.allowVerticalPlacement&&(this.markUsedOrientation(Je,xt,Xe),this.placedOrientations[Xe.crossTileID]=xt),{shift:Ot,placedGlyphBoxes:jt}):void 0},Ua.prototype.placeLayerBucketPart=function(a,u,s){var f=this,T=a.parameters,W=T.bucket,K=T.layout,ue=T.posMatrix,Se=T.textLabelPlaneMatrix,Ie=T.labelToScreenMatrix,We=T.textPixelRatio,Xe=T.holdingForFade,Je=T.collisionBoxArray,xt=T.partiallyEvaluatedTextSize,_t=T.collisionGroup,Pt=K.get("text-optional"),ft=K.get("icon-optional"),Ot=K.get("text-allow-overlap"),jt=K.get("icon-allow-overlap"),er=K.get("text-rotation-alignment")==="map",br=K.get("text-pitch-alignment")==="map",yr=K.get("icon-text-fit")!=="none",Cr=K.get("symbol-z-order")==="viewport-y",zr=Ot&&(jt||!W.hasIconData()||ft),un=jt&&(Ot||!W.hasTextData()||Pt);!W.collisionArrays&&Je&&W.deserializeCollisionBoxes(Je);var qr=function(zn,di){if(!u[zn.crossTileID])if(Xe)f.placements[zn.crossTileID]=new Xa(!1,!1,!1);else{var Bi,bi=!1,gi=!1,Di=!0,pi=null,li={box:null,offscreen:null},Co={box:null,offscreen:null},oo=null,Ho=null,Lo=0,qa=0,so=0;di.textFeatureIndex?Lo=di.textFeatureIndex:zn.useRuntimeCollisionCircles&&(Lo=zn.featureIndex),di.verticalTextFeatureIndex&&(qa=di.verticalTextFeatureIndex);var hs=di.textBox;if(hs){var ts=function(da){var rs=o.WritingMode.horizontal;if(W.allowVerticalPlacement&&!da&&f.prevPlacement){var ps=f.prevPlacement.placedOrientations[zn.crossTileID];ps&&(f.placedOrientations[zn.crossTileID]=ps,f.markUsedOrientation(W,rs=ps,zn))}return rs},Cu=function(da,rs){if(W.allowVerticalPlacement&&zn.numVerticalGlyphVertices>0&&di.verticalTextBox)for(var ps=0,du=W.writingModes;ps<du.length&&(du[ps]===o.WritingMode.vertical?(li=rs(),Co=li):li=da(),!(li&&li.box&&li.box.length));ps+=1);else li=da()};if(K.get("text-variable-anchor")){var ds=K.get("text-variable-anchor");if(f.prevPlacement&&f.prevPlacement.variableOffsets[zn.crossTileID]){var zs=f.prevPlacement.variableOffsets[zn.crossTileID];ds.indexOf(zs.anchor)>0&&(ds=ds.filter(function(da){return da!==zs.anchor})).unshift(zs.anchor)}var As=function(da,rs,ps){for(var du=da.x2-da.x1,Au=da.y2-da.y1,Nu=zn.textBoxScale,nl=yr&&!jt?rs:null,Mu={box:[],offscreen:!1},xl=Ot?2*ds.length:ds.length,Us=0;Us<xl;++Us){var pu=f.attemptAnchorPlacement(ds[Us%ds.length],da,du,Au,Nu,er,br,We,ue,_t,Us>=ds.length,zn,W,ps,nl);if(pu&&(Mu=pu.placedGlyphBoxes)&&Mu.box&&Mu.box.length){bi=!0,pi=pu.shift;break}}return Mu};Cu(function(){return As(hs,di.iconBox,o.WritingMode.horizontal)},function(){var da=di.verticalTextBox;return W.allowVerticalPlacement&&!(li&&li.box&&li.box.length)&&zn.numVerticalGlyphVertices>0&&da?As(da,di.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),li&&(bi=li.box,Di=li.offscreen);var gl=ts(li&&li.box);if(!bi&&f.prevPlacement){var rl=f.prevPlacement.variableOffsets[zn.crossTileID];rl&&(f.variableOffsets[zn.crossTileID]=rl,f.markUsedJustification(W,rl.anchor,zn,gl))}}else{var fu=function(da,rs){var ps=f.collisionIndex.placeCollisionBox(da,Ot,We,ue,_t.predicate);return ps&&ps.box&&ps.box.length&&(f.markUsedOrientation(W,rs,zn),f.placedOrientations[zn.crossTileID]=rs),ps};Cu(function(){return fu(hs,o.WritingMode.horizontal)},function(){var da=di.verticalTextBox;return W.allowVerticalPlacement&&zn.numVerticalGlyphVertices>0&&da?fu(da,o.WritingMode.vertical):{box:null,offscreen:null}}),ts(li&&li.box&&li.box.length)}}if(bi=(Bi=li)&&Bi.box&&Bi.box.length>0,Di=Bi&&Bi.offscreen,zn.useRuntimeCollisionCircles){var Fu=W.text.placedSymbolArray.get(zn.centerJustifiedTextSymbolIndex),yl=o.evaluateSizeForFeature(W.textSizeData,xt,Fu),js=K.get("text-padding");oo=f.collisionIndex.placeCollisionCircles(Ot,Fu,W.lineVertexArray,W.glyphOffsetArray,yl,ue,Se,Ie,s,br,_t.predicate,zn.collisionCircleDiameter,js),bi=Ot||oo.circles.length>0&&!oo.collisionDetected,Di=Di&&oo.offscreen}if(di.iconFeatureIndex&&(so=di.iconFeatureIndex),di.iconBox){var _l=function(da){var rs=yr&&pi?Qa(da,pi.x,pi.y,er,br,f.transform.angle):da;return f.collisionIndex.placeCollisionBox(rs,jt,We,ue,_t.predicate)};gi=Co&&Co.box&&Co.box.length&&di.verticalIconBox?(Ho=_l(di.verticalIconBox)).box.length>0:(Ho=_l(di.iconBox)).box.length>0,Di=Di&&Ho.offscreen}var $s=Pt||zn.numHorizontalGlyphVertices===0&&zn.numVerticalGlyphVertices===0,_o=ft||zn.numIconVertices===0;if($s||_o?_o?$s||(gi=gi&&bi):bi=gi&&bi:gi=bi=gi&&bi,bi&&Bi&&Bi.box&&f.collisionIndex.insertCollisionBox(Bi.box,K.get("text-ignore-placement"),W.bucketInstanceId,Co&&Co.box&&qa?qa:Lo,_t.ID),gi&&Ho&&f.collisionIndex.insertCollisionBox(Ho.box,K.get("icon-ignore-placement"),W.bucketInstanceId,so,_t.ID),oo&&(bi&&f.collisionIndex.insertCollisionCircles(oo.circles,K.get("text-ignore-placement"),W.bucketInstanceId,Lo,_t.ID),s)){var hu=W.bucketInstanceId,Tu=f.collisionCircleArrays[hu];Tu===void 0&&(Tu=f.collisionCircleArrays[hu]=new no);for(var wu=0;wu<oo.circles.length;wu+=4)Tu.circles.push(oo.circles[wu+0]),Tu.circles.push(oo.circles[wu+1]),Tu.circles.push(oo.circles[wu+2]),Tu.circles.push(oo.collisionDetected?1:0)}f.placements[zn.crossTileID]=new Xa(bi||zr,gi||un,Di||W.justReloaded),u[zn.crossTileID]=!0}};if(Cr)for(var Dn=W.getSortedSymbolIndexes(this.transform.angle),$n=Dn.length-1;$n>=0;--$n){var Jn=Dn[$n];qr(W.symbolInstances.get(Jn),W.collisionArrays[Jn])}else for(var ii=a.symbolInstanceStart;ii<a.symbolInstanceEnd;ii++)qr(W.symbolInstances.get(ii),W.collisionArrays[ii]);if(s&&W.bucketInstanceId in this.collisionCircleArrays){var qi=this.collisionCircleArrays[W.bucketInstanceId];o.invert(qi.invProjMatrix,ue),qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}W.justReloaded=!1},Ua.prototype.markUsedJustification=function(a,u,s,f){var T;T=f===o.WritingMode.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(u)];for(var W=0,K=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];W<K.length;W+=1){var ue=K[W];ue>=0&&(a.text.placedSymbolArray.get(ue).crossTileID=T>=0&&ue!==T?0:s.crossTileID)}},Ua.prototype.markUsedOrientation=function(a,u,s){for(var f=u===o.WritingMode.horizontal||u===o.WritingMode.horizontalOnly?u:0,T=u===o.WritingMode.vertical?u:0,W=0,K=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];W<K.length;W+=1)a.text.placedSymbolArray.get(K[W]).placedOrientation=f;s.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=T)},Ua.prototype.commit=function(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,s=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var f=u?u.symbolFadeChange(a):1,T=u?u.opacities:{},W=u?u.variableOffsets:{},K=u?u.placedOrientations:{};for(var ue in this.placements){var Se=this.placements[ue],Ie=T[ue];Ie?(this.opacities[ue]=new ro(Ie,f,Se.text,Se.icon),s=s||Se.text!==Ie.text.placed||Se.icon!==Ie.icon.placed):(this.opacities[ue]=new ro(null,f,Se.text,Se.icon,Se.skipFade),s=s||Se.text||Se.icon)}for(var We in T){var Xe=T[We];if(!this.opacities[We]){var Je=new ro(Xe,f,!1,!1);Je.isHidden()||(this.opacities[We]=Je,s=s||Xe.text.placed||Xe.icon.placed)}}for(var xt in W)this.variableOffsets[xt]||!this.opacities[xt]||this.opacities[xt].isHidden()||(this.variableOffsets[xt]=W[xt]);for(var _t in K)this.placedOrientations[_t]||!this.opacities[_t]||this.opacities[_t].isHidden()||(this.placedOrientations[_t]=K[_t]);s?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)},Ua.prototype.updateLayerOpacities=function(a,u){for(var s={},f=0,T=u;f<T.length;f+=1){var W=T[f],K=W.getBucket(a);K&&W.latestFeatureIndex&&a.id===K.layerIds[0]&&this.updateBucketOpacities(K,s,W.collisionBoxArray)}},Ua.prototype.updateBucketOpacities=function(a,u,s){var f=this;a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();var T=a.layers[0].layout,W=new ro(null,0,!1,!1,!0),K=T.get("text-allow-overlap"),ue=T.get("icon-allow-overlap"),Se=T.get("text-variable-anchor"),Ie=T.get("text-rotation-alignment")==="map",We=T.get("text-pitch-alignment")==="map",Xe=T.get("icon-text-fit")!=="none",Je=new ro(null,0,K&&(ue||!a.hasIconData()||T.get("icon-optional")),ue&&(K||!a.hasTextData()||T.get("text-optional")),!0);!a.collisionArrays&&s&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(s);for(var xt=function(Ot,jt,er){for(var br=0;br<jt/4;br++)Ot.opacityVertexArray.emplaceBack(er)},_t=function(Ot){var jt=a.symbolInstances.get(Ot),er=jt.numHorizontalGlyphVertices,br=jt.numVerticalGlyphVertices,yr=jt.crossTileID,Cr=f.opacities[yr];u[yr]?Cr=W:Cr||(f.opacities[yr]=Cr=Je),u[yr]=!0;var zr=jt.numIconVertices>0,un=f.placedOrientations[jt.crossTileID],qr=un===o.WritingMode.vertical,Dn=un===o.WritingMode.horizontal||un===o.WritingMode.horizontalOnly;if(er>0||br>0){var $n=be(Cr.text);xt(a.text,er,qr?tt:$n),xt(a.text,br,Dn?tt:$n);var Jn=Cr.text.isHidden();[jt.rightJustifiedTextSymbolIndex,jt.centerJustifiedTextSymbolIndex,jt.leftJustifiedTextSymbolIndex].forEach(function(li){li>=0&&(a.text.placedSymbolArray.get(li).hidden=Jn||qr?1:0)}),jt.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(jt.verticalPlacedTextSymbolIndex).hidden=Jn||Dn?1:0);var ii=f.variableOffsets[jt.crossTileID];ii&&f.markUsedJustification(a,ii.anchor,jt,un);var qi=f.placedOrientations[jt.crossTileID];qi&&(f.markUsedJustification(a,"left",jt,qi),f.markUsedOrientation(a,qi,jt))}if(zr){var zn=be(Cr.icon),di=!(Xe&&jt.verticalPlacedIconSymbolIndex&&qr);jt.placedIconSymbolIndex>=0&&(xt(a.icon,jt.numIconVertices,di?zn:tt),a.icon.placedSymbolArray.get(jt.placedIconSymbolIndex).hidden=Cr.icon.isHidden()),jt.verticalPlacedIconSymbolIndex>=0&&(xt(a.icon,jt.numVerticalIconVertices,di?tt:zn),a.icon.placedSymbolArray.get(jt.verticalPlacedIconSymbolIndex).hidden=Cr.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){var Bi=a.collisionArrays[Ot];if(Bi){var bi=new o.Point(0,0);if(Bi.textBox||Bi.verticalTextBox){var gi=!0;if(Se){var Di=f.variableOffsets[yr];Di?(bi=ja(Di.anchor,Di.width,Di.height,Di.textOffset,Di.textBoxScale),Ie&&bi._rotate(We?f.transform.angle:-f.transform.angle)):gi=!1}Bi.textBox&&Ve(a.textCollisionBox.collisionVertexArray,Cr.text.placed,!gi||qr,bi.x,bi.y),Bi.verticalTextBox&&Ve(a.textCollisionBox.collisionVertexArray,Cr.text.placed,!gi||Dn,bi.x,bi.y)}var pi=Boolean(!Dn&&Bi.verticalIconBox);Bi.iconBox&&Ve(a.iconCollisionBox.collisionVertexArray,Cr.icon.placed,pi,Xe?bi.x:0,Xe?bi.y:0),Bi.verticalIconBox&&Ve(a.iconCollisionBox.collisionVertexArray,Cr.icon.placed,!pi,Xe?bi.x:0,Xe?bi.y:0)}}},Pt=0;Pt<a.symbolInstances.length;Pt++)_t(Pt);if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){var ft=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ft.invProjMatrix,a.placementViewportMatrix=ft.viewportMatrix,a.collisionCircleArray=ft.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}},Ua.prototype.symbolFadeChange=function(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ua.prototype.zoomAdjustment=function(a){return Math.max(0,(this.transform.zoom-a)/1.5)},Ua.prototype.hasTransitions=function(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration},Ua.prototype.stillRecent=function(a,u){var s=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*s>a},Ua.prototype.setStale=function(){this.stale=!0};var rt=Math.pow(2,25),wt=Math.pow(2,24),lr=Math.pow(2,17),Zr=Math.pow(2,16),Un=Math.pow(2,9),oi=Math.pow(2,8),te=Math.pow(2,1);function be(a){if(a.opacity===0&&!a.placed)return 0;if(a.opacity===1&&a.placed)return 4294967295;var u=a.placed?1:0,s=Math.floor(127*a.opacity);return s*rt+u*wt+s*lr+u*Zr+s*Un+u*oi+s*te+u}var tt=0,yt=function(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};yt.prototype.continuePlacement=function(a,u,s,f,T){for(var W=this._bucketParts;this._currentTileIndex<a.length;)if(u.getBucketParts(W,f,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,W.sort(function(K,ue){return K.sortKey-ue.sortKey}));this._currentPartIndex<W.length;)if(u.placeLayerBucketPart(W[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,T())return!0;return!1};var Bt=function(a,u,s,f,T,W,K){this.placement=new Ua(a,T,W,K),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=f,this._done=!1};Bt.prototype.isDone=function(){return this._done},Bt.prototype.continuePlacement=function(a,u,s){for(var f=this,T=o.browser.now(),W=function(){var Se=o.browser.now()-T;return!f._forceFullPlacement&&Se>2};this._currentPlacementIndex>=0;){var K=u[a[this._currentPlacementIndex]],ue=this.placement.collisionIndex.transform.zoom;if(K.type==="symbol"&&(!K.minzoom||K.minzoom<=ue)&&(!K.maxzoom||K.maxzoom>ue)){if(this._inProgressLayer||(this._inProgressLayer=new yt(K)),this._inProgressLayer.continuePlacement(s[K.source],this.placement,this._showCollisionBoxes,K,W))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Bt.prototype.commit=function(a){return this.placement.commit(a),this.placement};var qt=512/o.EXTENT/2,Wt=function(a,u,s){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=s;for(var f=0;f<u.length;f++){var T=u.get(f),W=T.key;this.indexedSymbolInstances[W]||(this.indexedSymbolInstances[W]=[]),this.indexedSymbolInstances[W].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,a)})}};Wt.prototype.getScaledCoordinates=function(a,u){var s=qt/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*o.EXTENT+a.anchorX)*s),y:Math.floor((u.canonical.y*o.EXTENT+a.anchorY)*s)}},Wt.prototype.findMatches=function(a,u,s){for(var f=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),T=0;T<a.length;T++){var W=a.get(T);if(!W.crossTileID){var K=this.indexedSymbolInstances[W.key];if(K)for(var ue=this.getScaledCoordinates(W,u),Se=0,Ie=K;Se<Ie.length;Se+=1){var We=Ie[Se];if(Math.abs(We.coord.x-ue.x)<=f&&Math.abs(We.coord.y-ue.y)<=f&&!s[We.crossTileID]){s[We.crossTileID]=!0,W.crossTileID=We.crossTileID;break}}}}};var or=function(){this.maxCrossTileID=0};or.prototype.generate=function(){return++this.maxCrossTileID};var ar=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ar.prototype.handleWrapJump=function(a){var u=Math.round((a-this.lng)/360);if(u!==0)for(var s in this.indexes){var f=this.indexes[s],T={};for(var W in f){var K=f[W];K.tileID=K.tileID.unwrapTo(K.tileID.wrap+u),T[K.tileID.key]=K}this.indexes[s]=T}this.lng=a},ar.prototype.addBucket=function(a,u,s){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(var f=0;f<u.symbolInstances.length;f++)u.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});var T=this.usedCrossTileIDs[a.overscaledZ];for(var W in this.indexes){var K=this.indexes[W];if(Number(W)>a.overscaledZ)for(var ue in K){var Se=K[ue];Se.tileID.isChildOf(a)&&Se.findMatches(u.symbolInstances,a,T)}else{var Ie=K[a.scaledTo(Number(W)).key];Ie&&Ie.findMatches(u.symbolInstances,a,T)}}for(var We=0;We<u.symbolInstances.length;We++){var Xe=u.symbolInstances.get(We);Xe.crossTileID||(Xe.crossTileID=s.generate(),T[Xe.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Wt(a,u.symbolInstances,u.bucketInstanceId),!0},ar.prototype.removeBucketCrossTileIDs=function(a,u){for(var s in u.indexedSymbolInstances)for(var f=0,T=u.indexedSymbolInstances[s];f<T.length;f+=1)delete this.usedCrossTileIDs[a][T[f].crossTileID]},ar.prototype.removeStaleBuckets=function(a){var u=!1;for(var s in this.indexes){var f=this.indexes[s];for(var T in f)a[f[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,f[T]),delete f[T],u=!0)}return u};var kr=function(){this.layerIndexes={},this.crossTileIDs=new or,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};kr.prototype.addLayer=function(a,u,s){var f=this.layerIndexes[a.id];f===void 0&&(f=this.layerIndexes[a.id]=new ar);var T=!1,W={};f.handleWrapJump(s);for(var K=0,ue=u;K<ue.length;K+=1){var Se=ue[K],Ie=Se.getBucket(a);Ie&&a.id===Ie.layerIds[0]&&(Ie.bucketInstanceId||(Ie.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(Se.tileID,Ie,this.crossTileIDs)&&(T=!0),W[Ie.bucketInstanceId]=!0)}return f.removeStaleBuckets(W)&&(T=!0),T},kr.prototype.pruneUnusedLayers=function(a){var u={};for(var s in a.forEach(function(f){u[f]=!0}),this.layerIndexes)u[s]||delete this.layerIndexes[s]};var we=function(a,u){return o.emitValidationErrors(a,u&&u.filter(function(s){return s.identifier!=="source.canvas"}))},je=o.pick(sn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ue=o.pick(sn,["setCenter","setZoom","setBearing","setPitch"]),ut=function(){var a={},u=o.styleSpec.$version;for(var s in o.styleSpec.$root){var f,T=o.styleSpec.$root[s];T.required&&(f=s==="version"?u:T.type==="array"?[]:{})!=null&&(a[s]=f)}return a}(),Xt=function(a){function u(s,f){var T=this;f===void 0&&(f={}),a.call(this),this.map=s,this.dispatcher=new V(gr(),this),this.imageManager=new I,this.imageManager.setEventedParent(this),this.glyphManager=new S(s._requestManager,f.localIdeographFontFamily),this.lineAtlas=new B(256,512),this.crossTileSymbolIndex=new kr,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var W=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(K){W.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:K.pluginStatus,pluginURL:K.pluginURL},function(ue,Se){if(o.triggerPluginCompletionEvent(ue),Se&&Se.every(function(We){return We}))for(var Ie in W.sourceCaches)W.sourceCaches[Ie].reload()})}),this.on("data",function(K){if(K.dataType==="source"&&K.sourceDataType==="metadata"){var ue=T.sourceCaches[K.sourceId];if(ue){var Se=ue.getSource();if(Se&&Se.vectorLayerIds)for(var Ie in T._layers){var We=T._layers[Ie];We.source===Se.id&&T._validateLayer(We)}}}})}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.loadURL=function(s,f){var T=this;f===void 0&&(f={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var W=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,f.accessToken);var K=this.map._requestManager.transformRequest(s,o.ResourceType.Style);this._request=o.getJSON(K,function(ue,Se){T._request=null,ue?T.fire(new o.ErrorEvent(ue)):Se&&T._load(Se,W)})},u.prototype.loadJSON=function(s,f){var T=this;f===void 0&&(f={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){T._request=null,T._load(s,f.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ut,!1)},u.prototype._load=function(s,f){if(!f||!we(this,o.validateStyle(s))){for(var T in this._loaded=!0,this.stylesheet=s,s.sources)this.addSource(T,s.sources[T],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);var W=an(this.stylesheet.layers);this._order=W.map(function(Ie){return Ie.id}),this._layers={},this._serializedLayers={};for(var K=0,ue=W;K<ue.length;K+=1){var Se=ue[K];(Se=o.createStyleLayer(Se)).setEventedParent(this,{layer:{id:Se.id}}),this._layers[Se.id]=Se,this._serializedLayers[Se.id]=Se.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new z(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},u.prototype._loadSprite=function(s){var f=this;this._spriteRequest=function(T,W,K){var ue,Se,Ie,We=o.browser.devicePixelRatio>1?"@2x":"",Xe=o.getJSON(W.transformRequest(W.normalizeSpriteURL(T,We,".json"),o.ResourceType.SpriteJSON),function(_t,Pt){Xe=null,Ie||(Ie=_t,ue=Pt,xt())}),Je=o.getImage(W.transformRequest(W.normalizeSpriteURL(T,We,".png"),o.ResourceType.SpriteImage),function(_t,Pt){Je=null,Ie||(Ie=_t,Se=Pt,xt())});function xt(){if(Ie)K(Ie);else if(ue&&Se){var _t=o.browser.getImageData(Se),Pt={};for(var ft in ue){var Ot=ue[ft],jt=Ot.width,er=Ot.height,br=Ot.x,yr=Ot.y,Cr=Ot.sdf,zr=Ot.pixelRatio,un=Ot.stretchX,qr=Ot.stretchY,Dn=Ot.content,$n=new o.RGBAImage({width:jt,height:er});o.RGBAImage.copy(_t,$n,{x:br,y:yr},{x:0,y:0},{width:jt,height:er}),Pt[ft]={data:$n,pixelRatio:zr,sdf:Cr,stretchX:un,stretchY:qr,content:Dn}}K(null,Pt)}}return{cancel:function(){Xe&&(Xe.cancel(),Xe=null),Je&&(Je.cancel(),Je=null)}}}(s,this.map._requestManager,function(T,W){if(f._spriteRequest=null,T)f.fire(new o.ErrorEvent(T));else if(W)for(var K in W)f.imageManager.addImage(K,W[K]);f.imageManager.setLoaded(!0),f._availableImages=f.imageManager.listImages(),f.dispatcher.broadcast("setImages",f._availableImages),f.fire(new o.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(s){var f=this.sourceCaches[s.source];if(f){var T=s.sourceLayer;if(T){var W=f.getSource();(W.type==="geojson"||W.vectorLayerIds&&W.vectorLayerIds.indexOf(T)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+T+'" does not exist on source "'+W.id+'" as specified by style layer "'+s.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(s){for(var f=[],T=0,W=s;T<W.length;T+=1){var K=this._layers[W[T]];K.type!=="custom"&&f.push(K.serialize())}return f},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(var f in this._layers)if(this._layers[f].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(s){if(this._loaded){var f=this._changed;if(this._changed){var T=Object.keys(this._updatedLayers),W=Object.keys(this._removedLayers);for(var K in(T.length||W.length)&&this._updateWorkerLayers(T,W),this._updatedSources){var ue=this._updatedSources[K];ue==="reload"?this._reloadSource(K):ue==="clear"&&this._clearSource(K)}for(var Se in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Se].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}var Ie={};for(var We in this.sourceCaches){var Xe=this.sourceCaches[We];Ie[We]=Xe.used,Xe.used=!1}for(var Je=0,xt=this._order;Je<xt.length;Je+=1){var _t=this._layers[xt[Je]];_t.recalculate(s,this._availableImages),!_t.isHidden(s.zoom)&&_t.source&&(this.sourceCaches[_t.source].used=!0)}for(var Pt in Ie){var ft=this.sourceCaches[Pt];Ie[Pt]!==ft.used&&ft.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Pt}))}this.light.recalculate(s),this.z=s.zoom,f&&this.fire(new o.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var s=Object.keys(this._changedImages);if(s.length){for(var f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}},u.prototype._updateWorkerLayers=function(s,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:f})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(s){var f=this;if(this._checkLoaded(),we(this,o.validateStyle(s)))return!1;(s=o.clone$1(s)).layers=an(s.layers);var T=function(K,ue){if(!K)return[{command:sn.setStyle,args:[ue]}];var Se=[];try{if(!o.deepEqual(K.version,ue.version))return[{command:sn.setStyle,args:[ue]}];o.deepEqual(K.center,ue.center)||Se.push({command:sn.setCenter,args:[ue.center]}),o.deepEqual(K.zoom,ue.zoom)||Se.push({command:sn.setZoom,args:[ue.zoom]}),o.deepEqual(K.bearing,ue.bearing)||Se.push({command:sn.setBearing,args:[ue.bearing]}),o.deepEqual(K.pitch,ue.pitch)||Se.push({command:sn.setPitch,args:[ue.pitch]}),o.deepEqual(K.sprite,ue.sprite)||Se.push({command:sn.setSprite,args:[ue.sprite]}),o.deepEqual(K.glyphs,ue.glyphs)||Se.push({command:sn.setGlyphs,args:[ue.glyphs]}),o.deepEqual(K.transition,ue.transition)||Se.push({command:sn.setTransition,args:[ue.transition]}),o.deepEqual(K.light,ue.light)||Se.push({command:sn.setLight,args:[ue.light]});var Ie={},We=[];(function(Je,xt,_t,Pt){var ft;for(ft in xt=xt||{},Je=Je||{})Je.hasOwnProperty(ft)&&(xt.hasOwnProperty(ft)||fn(ft,_t,Pt));for(ft in xt)xt.hasOwnProperty(ft)&&(Je.hasOwnProperty(ft)?o.deepEqual(Je[ft],xt[ft])||(Je[ft].type==="geojson"&&xt[ft].type==="geojson"&&Ui(Je,xt,ft)?_t.push({command:sn.setGeoJSONSourceData,args:[ft,xt[ft].data]}):ni(ft,xt,_t,Pt)):Ei(ft,xt,_t))})(K.sources,ue.sources,We,Ie);var Xe=[];K.layers&&K.layers.forEach(function(Je){Ie[Je.source]?Se.push({command:sn.removeLayer,args:[Je.id]}):Xe.push(Je)}),Se=Se.concat(We),function(Je,xt,_t){xt=xt||[];var Pt,ft,Ot,jt,er,br,yr,Cr=(Je=Je||[]).map(Li),zr=xt.map(Li),un=Je.reduce(ui,{}),qr=xt.reduce(ui,{}),Dn=Cr.slice(),$n=Object.create(null);for(Pt=0,ft=0;Pt<Cr.length;Pt++)qr.hasOwnProperty(Ot=Cr[Pt])?ft++:(_t.push({command:sn.removeLayer,args:[Ot]}),Dn.splice(Dn.indexOf(Ot,ft),1));for(Pt=0,ft=0;Pt<zr.length;Pt++)Dn[Dn.length-1-Pt]!==(Ot=zr[zr.length-1-Pt])&&(un.hasOwnProperty(Ot)?(_t.push({command:sn.removeLayer,args:[Ot]}),Dn.splice(Dn.lastIndexOf(Ot,Dn.length-ft),1)):ft++,_t.push({command:sn.addLayer,args:[qr[Ot],br=Dn[Dn.length-Pt]]}),Dn.splice(Dn.length-Pt,0,Ot),$n[Ot]=!0);for(Pt=0;Pt<zr.length;Pt++)if(jt=un[Ot=zr[Pt]],er=qr[Ot],!$n[Ot]&&!o.deepEqual(jt,er))if(o.deepEqual(jt.source,er.source)&&o.deepEqual(jt["source-layer"],er["source-layer"])&&o.deepEqual(jt.type,er.type)){for(yr in mi(jt.layout,er.layout,_t,Ot,null,sn.setLayoutProperty),mi(jt.paint,er.paint,_t,Ot,null,sn.setPaintProperty),o.deepEqual(jt.filter,er.filter)||_t.push({command:sn.setFilter,args:[Ot,er.filter]}),o.deepEqual(jt.minzoom,er.minzoom)&&o.deepEqual(jt.maxzoom,er.maxzoom)||_t.push({command:sn.setLayerZoomRange,args:[Ot,er.minzoom,er.maxzoom]}),jt)jt.hasOwnProperty(yr)&&yr!=="layout"&&yr!=="paint"&&yr!=="filter"&&yr!=="metadata"&&yr!=="minzoom"&&yr!=="maxzoom"&&(yr.indexOf("paint.")===0?mi(jt[yr],er[yr],_t,Ot,yr.slice(6),sn.setPaintProperty):o.deepEqual(jt[yr],er[yr])||_t.push({command:sn.setLayerProperty,args:[Ot,yr,er[yr]]}));for(yr in er)er.hasOwnProperty(yr)&&!jt.hasOwnProperty(yr)&&yr!=="layout"&&yr!=="paint"&&yr!=="filter"&&yr!=="metadata"&&yr!=="minzoom"&&yr!=="maxzoom"&&(yr.indexOf("paint.")===0?mi(jt[yr],er[yr],_t,Ot,yr.slice(6),sn.setPaintProperty):o.deepEqual(jt[yr],er[yr])||_t.push({command:sn.setLayerProperty,args:[Ot,yr,er[yr]]}))}else _t.push({command:sn.removeLayer,args:[Ot]}),br=Dn[Dn.lastIndexOf(Ot)+1],_t.push({command:sn.addLayer,args:[er,br]})}(Xe,ue.layers,Se)}catch(Je){console.warn("Unable to compute style diff:",Je),Se=[{command:sn.setStyle,args:[ue]}]}return Se}(this.serialize(),s).filter(function(K){return!(K.command in Ue)});if(T.length===0)return!1;var W=T.filter(function(K){return!(K.command in je)});if(W.length>0)throw new Error("Unimplemented: "+W.map(function(K){return K.command}).join(", ")+".");return T.forEach(function(K){K.command!=="setTransition"&&f[K.command].apply(f,K.args)}),this.stylesheet=s,!0},u.prototype.addImage=function(s,f){if(this.getImage(s))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(s,f),this._afterImageUpdated(s)},u.prototype.updateImage=function(s,f){this.imageManager.updateImage(s,f)},u.prototype.getImage=function(s){return this.imageManager.getImage(s)},u.prototype.removeImage=function(s){if(!this.getImage(s))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(s),this._afterImageUpdated(s)},u.prototype._afterImageUpdated=function(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(s,f,T){var W=this;if(T===void 0&&(T={}),this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(f).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateStyle.source,"sources."+s,f,null,T))){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);var K=this.sourceCaches[s]=new Et(s,f,this.dispatcher);K.style=this,K.setEventedParent(this,function(){return{isSourceLoaded:W.loaded(),source:K.serialize(),sourceId:s}}),K.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(var f in this._layers)if(this._layers[f].source===s)return this.fire(new o.ErrorEvent(new Error('Source "'+s+'" cannot be removed while layer "'+f+'" is using it.')));var T=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],T.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),T.setEventedParent(null),T.clearTiles(),T.onRemove&&T.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(s,f){this._checkLoaded(),this.sourceCaches[s].getSource().setData(f),this._changed=!0},u.prototype.getSource=function(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()},u.prototype.addLayer=function(s,f,T){T===void 0&&(T={}),this._checkLoaded();var W=s.id;if(this.getLayer(W))this.fire(new o.ErrorEvent(new Error('Layer with id "'+W+'" already exists on this map')));else{var K;if(s.type==="custom"){if(we(this,o.validateCustomStyleLayer(s)))return;K=o.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(W,s.source),s=o.clone$1(s),s=o.extend(s,{source:W})),this._validate(o.validateStyle.layer,"layers."+W,s,{arrayIndex:-1},T))return;K=o.createStyleLayer(s),this._validateLayer(K),K.setEventedParent(this,{layer:{id:W}}),this._serializedLayers[K.id]=K.serialize()}var ue=f?this._order.indexOf(f):this._order.length;if(f&&ue===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.')));else{if(this._order.splice(ue,0,W),this._layerOrderChanged=!0,this._layers[W]=K,this._removedLayers[W]&&K.source&&K.type!=="custom"){var Se=this._removedLayers[W];delete this._removedLayers[W],Se.type!==K.type?this._updatedSources[K.source]="clear":(this._updatedSources[K.source]="reload",this.sourceCaches[K.source].pause())}this._updateLayer(K),K.onAdd&&K.onAdd(this.map)}}},u.prototype.moveLayer=function(s,f){if(this._checkLoaded(),this._changed=!0,this._layers[s]){if(s!==f){var T=this._order.indexOf(s);this._order.splice(T,1);var W=f?this._order.indexOf(f):this._order.length;f&&W===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.'))):(this._order.splice(W,0,s),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(s){this._checkLoaded();var f=this._layers[s];if(f){f.setEventedParent(null);var T=this._order.indexOf(s);this._order.splice(T,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=f,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],f.onRemove&&f.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(s){return this._layers[s]},u.prototype.hasLayer=function(s){return s in this._layers},u.prototype.setLayerZoomRange=function(s,f,T){this._checkLoaded();var W=this.getLayer(s);W?W.minzoom===f&&W.maxzoom===T||(f!=null&&(W.minzoom=f),T!=null&&(W.maxzoom=T),this._updateLayer(W)):this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(s,f,T){T===void 0&&(T={}),this._checkLoaded();var W=this.getLayer(s);if(W){if(!o.deepEqual(W.filter,f))return f==null?(W.filter=void 0,void this._updateLayer(W)):void(this._validate(o.validateStyle.filter,"layers."+W.id+".filter",f,null,T)||(W.filter=o.clone$1(f),this._updateLayer(W)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(s){return o.clone$1(this.getLayer(s).filter)},u.prototype.setLayoutProperty=function(s,f,T,W){W===void 0&&(W={}),this._checkLoaded();var K=this.getLayer(s);K?o.deepEqual(K.getLayoutProperty(f),T)||(K.setLayoutProperty(f,T,W),this._updateLayer(K)):this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(s,f){var T=this.getLayer(s);if(T)return T.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(s,f,T,W){W===void 0&&(W={}),this._checkLoaded();var K=this.getLayer(s);K?o.deepEqual(K.getPaintProperty(f),T)||(K.setPaintProperty(f,T,W)&&this._updateLayer(K),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(s,f){return this.getLayer(s).getPaintProperty(f)},u.prototype.setFeatureState=function(s,f){this._checkLoaded();var T=s.source,W=s.sourceLayer,K=this.sourceCaches[T];if(K!==void 0){var ue=K.getSource().type;ue==="geojson"&&W?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):ue!=="vector"||W?(s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),K.setFeatureState(W,s.id,f)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(s,f){this._checkLoaded();var T=s.source,W=this.sourceCaches[T];if(W!==void 0){var K=W.getSource().type,ue=K==="vector"?s.sourceLayer:void 0;K!=="vector"||ue?f&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):W.removeFeatureState(ue,s.id,f):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(s){this._checkLoaded();var f=s.source,T=s.sourceLayer,W=this.sourceCaches[f];if(W!==void 0){if(W.getSource().type!=="vector"||T)return s.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),W.getFeatureState(T,s.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+f+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(s){return s.serialize()}),layers:this._serializeLayers(this._order)},function(s){return s!==void 0})},u.prototype._updateLayer=function(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(s){for(var f=this,T=function(un){return f._layers[un].type==="fill-extrusion"},W={},K=[],ue=this._order.length-1;ue>=0;ue--){var Se=this._order[ue];if(T(Se)){W[Se]=ue;for(var Ie=0,We=s;Ie<We.length;Ie+=1){var Xe=We[Ie][Se];if(Xe)for(var Je=0,xt=Xe;Je<xt.length;Je+=1)K.push(xt[Je])}}}K.sort(function(un,qr){return qr.intersectionZ-un.intersectionZ});for(var _t=[],Pt=this._order.length-1;Pt>=0;Pt--){var ft=this._order[Pt];if(T(ft))for(var Ot=K.length-1;Ot>=0;Ot--){var jt=K[Ot].feature;if(W[jt.layer.id]<Pt)break;_t.push(jt),K.pop()}else for(var er=0,br=s;er<br.length;er+=1){var yr=br[er][ft];if(yr)for(var Cr=0,zr=yr;Cr<zr.length;Cr+=1)_t.push(zr[Cr].feature)}}return _t},u.prototype.queryRenderedFeatures=function(s,f,T){f&&f.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var W={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var K=0,ue=f.layers;K<ue.length;K+=1){var Se=ue[K],Ie=this._layers[Se];if(!Ie)return this.fire(new o.ErrorEvent(new Error("The layer '"+Se+"' does not exist in the map's style and cannot be queried for features."))),[];W[Ie.source]=!0}}var We=[];for(var Xe in f.availableImages=this._availableImages,this.sourceCaches)f.layers&&!W[Xe]||We.push(pe(this.sourceCaches[Xe],this._layers,this._serializedLayers,s,f,T));return this.placement&&We.push(function(Je,xt,_t,Pt,ft,Ot,jt){for(var er={},br=Ot.queryRenderedSymbols(Pt),yr=[],Cr=0,zr=Object.keys(br).map(Number);Cr<zr.length;Cr+=1)yr.push(jt[zr[Cr]]);yr.sort(Ne);for(var un=function(){var ii=Dn[qr],qi=ii.featureIndex.lookupSymbolFeatures(br[ii.bucketInstanceId],xt,ii.bucketIndex,ii.sourceLayerIndex,ft.filter,ft.layers,ft.availableImages,Je);for(var zn in qi){var di=er[zn]=er[zn]||[],Bi=qi[zn];Bi.sort(function(Di,pi){var li=ii.featureSortOrder;if(li){var Co=li.indexOf(Di.featureIndex);return li.indexOf(pi.featureIndex)-Co}return pi.featureIndex-Di.featureIndex});for(var bi=0,gi=Bi;bi<gi.length;bi+=1)di.push(gi[bi])}},qr=0,Dn=yr;qr<Dn.length;qr+=1)un();var $n=function(ii){er[ii].forEach(function(qi){var zn=qi.feature,di=_t[Je[ii].source].getFeatureState(zn.layer["source-layer"],zn.id);zn.source=zn.layer.source,zn.layer["source-layer"]&&(zn.sourceLayer=zn.layer["source-layer"]),zn.state=di})};for(var Jn in er)$n(Jn);return er}(this._layers,this._serializedLayers,this.sourceCaches,s,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(We)},u.prototype.querySourceFeatures=function(s,f){f&&f.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f);var T=this.sourceCaches[s];return T?function(W,K){for(var ue=W.getRenderableIds().map(function(xt){return W.getTileByID(xt)}),Se=[],Ie={},We=0;We<ue.length;We++){var Xe=ue[We],Je=Xe.tileID.canonical.key;Ie[Je]||(Ie[Je]=!0,Xe.querySourceFeatures(Se,K))}return Se}(T,f):[]},u.prototype.addSourceType=function(s,f,T){return u.getSourceType(s)?T(new Error('A source type called "'+s+'" already exists.')):(u.setSourceType(s,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:f.workerSourceURL},T):T(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(s,f){f===void 0&&(f={}),this._checkLoaded();var T=this.light.getLight(),W=!1;for(var K in s)if(!o.deepEqual(s[K],T[K])){W=!0;break}if(W){var ue={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,f),this.light.updateTransitions(ue)}},u.prototype._validate=function(s,f,T,W,K){return K===void 0&&(K={}),(!K||K.validate!==!1)&&we(this,s.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:T,styleSpec:o.styleSpec},W)))},u.prototype._remove=function(){for(var s in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[s].setEventedParent(null);for(var f in this.sourceCaches)this.sourceCaches[f].clearTiles(),this.sourceCaches[f].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(s){this.sourceCaches[s].clearTiles()},u.prototype._reloadSource=function(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()},u.prototype._updateSources=function(s){for(var f in this.sourceCaches)this.sourceCaches[f].update(s)},u.prototype._generateCollisionBoxes=function(){for(var s in this.sourceCaches)this._reloadSource(s)},u.prototype._updatePlacement=function(s,f,T,W,K){K===void 0&&(K=!1);for(var ue=!1,Se=!1,Ie={},We=0,Xe=this._order;We<Xe.length;We+=1){var Je=this._layers[Xe[We]];if(Je.type==="symbol"){if(!Ie[Je.source]){var xt=this.sourceCaches[Je.source];Ie[Je.source]=xt.getRenderableIds(!0).map(function(jt){return xt.getTileByID(jt)}).sort(function(jt,er){return er.tileID.overscaledZ-jt.tileID.overscaledZ||(jt.tileID.isLessThan(er.tileID)?-1:1)})}var _t=this.crossTileSymbolIndex.addLayer(Je,Ie[Je.source],s.center.lng);ue=ue||_t}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((K=K||this._layerOrderChanged||T===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),s.zoom))&&(this.pauseablePlacement=new Bt(s,this._order,K,f,T,W,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Ie),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),Se=!0),ue&&this.pauseablePlacement.placement.setStale()),Se||ue)for(var Pt=0,ft=this._order;Pt<ft.length;Pt+=1){var Ot=this._layers[ft[Pt]];Ot.type==="symbol"&&this.placement.updateLayerOpacities(Ot,Ie[Ot.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()},u.prototype.getImages=function(s,f,T){this.imageManager.getImages(f.icons,T),this._updateTilesForChangedImages();var W=this.sourceCaches[f.source];W&&W.setDependencies(f.tileID.key,f.type,f.icons)},u.prototype.getGlyphs=function(s,f,T){this.glyphManager.getGlyphs(f.stacks,T)},u.prototype.getResource=function(s,f,T){return o.makeRequest(f,T)},u}(o.Evented);Xt.getSourceType=function(a){return Me[a]},Xt.setSourceType=function(a,u){Me[a]=u},Xt.registerForPluginStateChange=o.registerForPluginStateChange;var Mr=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),bn=Vi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ei=Vi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ci=Vi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xi=Vi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Fa=Vi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),aa=Vi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Oi=Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vs=Vi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Yi=Vi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Y=Vi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),ve=Vi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ne=Vi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Fe=Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),et=Vi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Lt=Vi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Kt=Vi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Gt=Vi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Fr=Vi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Vr=Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Zn=Vi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ri=Vi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ti=Vi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ha=Vi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ua=Vi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ga=Vi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Vi(a,u){var s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=u.match(/attribute ([\w]+) ([\w]+)/g),T=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),W=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),K=W?W.concat(T):T,ue={};return{fragmentSource:a=a.replace(s,function(Se,Ie,We,Xe,Je){return ue[Je]=!0,Ie==="define"?`
#ifndef HAS_UNIFORM_u_`+Je+`
varying `+We+" "+Xe+" "+Je+`;
#else
uniform `+We+" "+Xe+" u_"+Je+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Je+`
    `+We+" "+Xe+" "+Je+" = u_"+Je+`;
#endif
`}),vertexSource:u=u.replace(s,function(Se,Ie,We,Xe,Je){var xt=Xe==="float"?"vec2":"vec4",_t=Je.match(/color/)?"color":xt;return ue[Je]?Ie==="define"?`
#ifndef HAS_UNIFORM_u_`+Je+`
uniform lowp float u_`+Je+`_t;
attribute `+We+" "+xt+" a_"+Je+`;
varying `+We+" "+Xe+" "+Je+`;
#else
uniform `+We+" "+Xe+" u_"+Je+`;
#endif
`:_t==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Je+`
    `+Je+" = a_"+Je+`;
#else
    `+We+" "+Xe+" "+Je+" = u_"+Je+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Je+`
    `+Je+" = unpack_mix_"+_t+"(a_"+Je+", u_"+Je+`_t);
#else
    `+We+" "+Xe+" "+Je+" = u_"+Je+`;
#endif
`:Ie==="define"?`
#ifndef HAS_UNIFORM_u_`+Je+`
uniform lowp float u_`+Je+`_t;
attribute `+We+" "+xt+" a_"+Je+`;
#else
uniform `+We+" "+Xe+" u_"+Je+`;
#endif
`:_t==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Je+`
    `+We+" "+Xe+" "+Je+" = a_"+Je+`;
#else
    `+We+" "+Xe+" "+Je+" = u_"+Je+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Je+`
    `+We+" "+Xe+" "+Je+" = unpack_mix_"+_t+"(a_"+Je+", u_"+Je+`_t);
#else
    `+We+" "+Xe+" "+Je+" = u_"+Je+`;
#endif
`}),staticAttributes:f,staticUniforms:K}}var Cs=Object.freeze({__proto__:null,prelude:bn,background:ei,backgroundPattern:Ci,circle:Xi,clippingMask:Fa,heatmap:aa,heatmapTexture:Oi,collisionBox:vs,collisionCircle:Yi,debug:m,fill:Y,fillOutline:ve,fillOutlinePattern:ne,fillPattern:Fe,fillExtrusion:et,fillExtrusionPattern:Lt,hillshadePrepare:Kt,hillshade:Gt,line:Fr,lineGradient:Vr,linePattern:Zn,lineSDF:Ri,raster:ti,symbolIcon:ha,symbolSDF:ua,symbolTextAndIcon:Ga}),Gs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Qs(a){for(var u=[],s=0;s<a.length;s++)if(a[s]!==null){var f=a[s].split(" ");u.push(f.pop())}return u}Gs.prototype.bind=function(a,u,s,f,T,W,K,ue){this.context=a;for(var Se=this.boundPaintVertexBuffers.length!==f.length,Ie=0;!Se&&Ie<f.length;Ie++)this.boundPaintVertexBuffers[Ie]!==f[Ie]&&(Se=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===s&&!Se&&this.boundIndexBuffer===T&&this.boundVertexOffset===W&&this.boundDynamicVertexBuffer===K&&this.boundDynamicVertexBuffer2===ue?(a.bindVertexArrayOES.set(this.vao),K&&K.bind(),T&&T.dynamicDraw&&T.bind(),ue&&ue.bind()):this.freshBind(u,s,f,T,W,K,ue)},Gs.prototype.freshBind=function(a,u,s,f,T,W,K){var ue,Se=a.numAttributes,Ie=this.context,We=Ie.gl;if(Ie.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Ie.extVertexArrayObject.createVertexArrayOES(),Ie.bindVertexArrayOES.set(this.vao),ue=0,this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=f,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=W,this.boundDynamicVertexBuffer2=K;else{ue=Ie.currentNumAttributes||0;for(var Xe=Se;Xe<ue;Xe++)We.disableVertexAttribArray(Xe)}u.enableAttributes(We,a);for(var Je=0,xt=s;Je<xt.length;Je+=1)xt[Je].enableAttributes(We,a);W&&W.enableAttributes(We,a),K&&K.enableAttributes(We,a),u.bind(),u.setVertexAttribPointers(We,a,T);for(var _t=0,Pt=s;_t<Pt.length;_t+=1){var ft=Pt[_t];ft.bind(),ft.setVertexAttribPointers(We,a,T)}W&&(W.bind(),W.setVertexAttribPointers(We,a,T)),f&&f.bind(),K&&(K.bind(),K.setVertexAttribPointers(We,a,T)),Ie.currentNumAttributes=Se},Gs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var ll=function(a,u,s,f,T,W){var K=a.gl;this.program=K.createProgram();for(var ue=Qs(s.staticAttributes),Se=f?f.getBinderAttributes():[],Ie=ue.concat(Se),We=s.staticUniforms?Qs(s.staticUniforms):[],Xe=f?f.getBinderUniforms():[],Je=[],xt=0,_t=We.concat(Xe);xt<_t.length;xt+=1){var Pt=_t[xt];Je.indexOf(Pt)<0&&Je.push(Pt)}var ft=f?f.defines():[];W&&ft.push("#define OVERDRAW_INSPECTOR;");var Ot=ft.concat(bn.fragmentSource,s.fragmentSource).join(`
`),jt=ft.concat(bn.vertexSource,s.vertexSource).join(`
`),er=K.createShader(K.FRAGMENT_SHADER);if(K.isContextLost())this.failedToCreate=!0;else{K.shaderSource(er,Ot),K.compileShader(er),K.attachShader(this.program,er);var br=K.createShader(K.VERTEX_SHADER);if(K.isContextLost())this.failedToCreate=!0;else{K.shaderSource(br,jt),K.compileShader(br),K.attachShader(this.program,br),this.attributes={};var yr={};this.numAttributes=Ie.length;for(var Cr=0;Cr<this.numAttributes;Cr++)Ie[Cr]&&(K.bindAttribLocation(this.program,Cr,Ie[Cr]),this.attributes[Ie[Cr]]=Cr);K.linkProgram(this.program),K.deleteShader(br),K.deleteShader(er);for(var zr=0;zr<Je.length;zr++){var un=Je[zr];if(un&&!yr[un]){var qr=K.getUniformLocation(this.program,un);qr&&(yr[un]=qr)}}this.fixedUniforms=T(a,yr),this.binderUniforms=f?f.getUniforms(a,yr):[]}}};function Hs(a,u,s){var f=1/ia(s,1,u.transform.tileZoom),T=Math.pow(2,s.tileID.overscaledZ),W=s.tileSize*Math.pow(2,u.transform.tileZoom)/T,K=W*(s.tileID.canonical.x+s.tileID.wrap*T),ue=W*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[f,a.fromScale,a.toScale],u_fade:a.t,u_pixel_coord_upper:[K>>16,ue>>16],u_pixel_coord_lower:[65535&K,65535&ue]}}ll.prototype.draw=function(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe,Je,xt,_t,Pt){var ft,Ot=a.gl;if(!this.failedToCreate){for(var jt in a.program.set(this.program),a.setDepthMode(s),a.setStencilMode(f),a.setColorMode(T),a.setCullFace(W),this.fixedUniforms)this.fixedUniforms[jt].set(K[jt]);xt&&xt.setUniforms(a,this.binderUniforms,Xe,{zoom:Je});for(var er=(ft={},ft[Ot.LINES]=2,ft[Ot.TRIANGLES]=3,ft[Ot.LINE_STRIP]=1,ft)[u],br=0,yr=We.get();br<yr.length;br+=1){var Cr=yr[br],zr=Cr.vaos||(Cr.vaos={});(zr[ue]||(zr[ue]=new Gs)).bind(a,this,Se,xt?xt.getPaintVertexBuffers():[],Ie,Cr.vertexOffset,_t,Pt),Ot.drawElements(u,Cr.primitiveLength*er,Ot.UNSIGNED_SHORT,Cr.primitiveOffset*er*2)}}};var Vu=function(a,u,s,f){var T=u.style.light,W=T.properties.get("position"),K=[W.x,W.y,W.z],ue=o.create$1();T.properties.get("anchor")==="viewport"&&o.fromRotation(ue,-u.transform.angle),o.transformMat3(K,K,ue);var Se=T.properties.get("color");return{u_matrix:a,u_lightpos:K,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+s,u_opacity:f}},ks=function(a,u,s,f,T,W,K){return o.extend(Vu(a,u,s,f),Hs(W,u,K),{u_height_factor:-Math.pow(2,T.overscaledZ)/K.tileSize/8})},Os=function(a){return{u_matrix:a}},Ra=function(a,u,s,f){return o.extend(Os(a),Hs(s,u,f))},cl=function(a,u){return{u_matrix:a,u_world:u}},$l=function(a,u,s,f,T){return o.extend(Ra(a,u,s,f),{u_world:T})},Ts=function(a,u,s,f){var T,W,K=a.transform;if(f.paint.get("circle-pitch-alignment")==="map"){var ue=ia(s,1,K.zoom);T=!0,W=[ue,ue]}else T=!1,W=K.pixelsToGLUnits;return{u_camera_to_center_distance:K.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:a.translatePosMatrix(u.posMatrix,s,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:W}},Zs=function(a,u,s){var f=ia(s,1,u.zoom),T=Math.pow(2,u.zoom-s.tileID.overscaledZ),W=s.tileID.overscaleFactor();return{u_matrix:a,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[u.pixelsToGLUnits[0]/(f*T),u.pixelsToGLUnits[1]/(f*T)],u_overscale_factor:W}},Gu=function(a,u,s){return{u_matrix:a,u_inv_matrix:u,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}},ms=function(a,u,s){return s===void 0&&(s=1),{u_matrix:a,u_color:u,u_overlay:0,u_overlay_scale:s}},Ws=function(a){return{u_matrix:a}},Ou=function(a,u,s,f){return{u_matrix:a,u_extrude_scale:ia(u,1,s),u_intensity:f}},Ys=function(a,u,s){var f=a.transform;return{u_matrix:Jl(a,u,s),u_ratio:1/ia(u,1,f.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Oa=function(a,u,s,f){return o.extend(Ys(a,u,s),{u_image:0,u_image_height:f})},Hu=function(a,u,s,f){var T=a.transform,W=yu(u,T);return{u_matrix:Jl(a,u,s),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ia(u,1,T.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[W,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Dl=function(a,u,s,f,T){var W=a.lineAtlas,K=yu(u,a.transform),ue=s.layout.get("line-cap")==="round",Se=W.getDash(f.from,ue),Ie=W.getDash(f.to,ue),We=Se.width*T.fromScale,Xe=Ie.width*T.toScale;return o.extend(Ys(a,u,s),{u_patternscale_a:[K/We,-Se.height/2],u_patternscale_b:[K/Xe,-Ie.height/2],u_sdfgamma:W.width/(256*Math.min(We,Xe)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Se.y,u_tex_y_b:Ie.y,u_mix:T.t})};function yu(a,u){return 1/ia(a,1,u.tileZoom)}function Jl(a,u,s){return a.translatePosMatrix(u.tileID.posMatrix,u,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}var vc=function(a,u,s,f,T){return{u_matrix:a,u_tl_parent:u,u_scale_parent:s,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(K=T.paint.get("raster-saturation"),K>0?1-1/(1.001-K):-K),u_contrast_factor:(W=T.paint.get("raster-contrast"),W>0?1/(1-W):1+W),u_spin_weights:Ql(T.paint.get("raster-hue-rotate"))};var W,K};function Ql(a){a*=Math.PI/180;var u=Math.sin(a),s=Math.cos(a);return[(2*s+1)/3,(-Math.sqrt(3)*u-s+1)/3,(Math.sqrt(3)*u-s+1)/3]}var Zu,qs=function(a,u,s,f,T,W,K,ue,Se,Ie){var We=T.transform;return{u_is_size_zoom_constant:+(a==="constant"||a==="source"),u_is_size_feature_constant:+(a==="constant"||a==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:We.cameraToCenterDistance,u_pitch:We.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:We.width/We.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:W,u_label_plane_matrix:K,u_coord_matrix:ue,u_is_text:+Se,u_pitch_with_map:+f,u_texsize:Ie,u_texture:0}},eu=function(a,u,s,f,T,W,K,ue,Se,Ie,We){var Xe=T.transform;return o.extend(qs(a,u,s,f,T,W,K,ue,Se,Ie),{u_gamma_scale:f?Math.cos(Xe._pitch)*Xe.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:+We})},Iu=function(a,u,s,f,T,W,K,ue,Se,Ie){return o.extend(eu(a,u,s,f,T,W,K,ue,!0,Se,!0),{u_texsize_icon:Ie,u_texture_icon:1})},tu=function(a,u,s){return{u_matrix:a,u_opacity:u,u_color:s}},Is=function(a,u,s,f,T,W){return o.extend(function(K,ue,Se,Ie){var We=Se.imageManager.getPattern(K.from.toString()),Xe=Se.imageManager.getPattern(K.to.toString()),Je=Se.imageManager.getPixelSize(),xt=Je.width,_t=Je.height,Pt=Math.pow(2,Ie.tileID.overscaledZ),ft=Ie.tileSize*Math.pow(2,Se.transform.tileZoom)/Pt,Ot=ft*(Ie.tileID.canonical.x+Ie.tileID.wrap*Pt),jt=ft*Ie.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:We.tl,u_pattern_br_a:We.br,u_pattern_tl_b:Xe.tl,u_pattern_br_b:Xe.br,u_texsize:[xt,_t],u_mix:ue.t,u_pattern_size_a:We.displaySize,u_pattern_size_b:Xe.displaySize,u_scale_a:ue.fromScale,u_scale_b:ue.toScale,u_tile_units_to_pixels:1/ia(Ie,1,Se.transform.tileZoom),u_pixel_coord_upper:[Ot>>16,jt>>16],u_pixel_coord_lower:[65535&Ot,65535&jt]}}(f,W,s,T),{u_matrix:a,u_opacity:u})},fl={fillExtrusion:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_lightpos:new o.Uniform3f(a,u.u_lightpos),u_lightintensity:new o.Uniform1f(a,u.u_lightintensity),u_lightcolor:new o.Uniform3f(a,u.u_lightcolor),u_vertical_gradient:new o.Uniform1f(a,u.u_vertical_gradient),u_opacity:new o.Uniform1f(a,u.u_opacity)}},fillExtrusionPattern:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_lightpos:new o.Uniform3f(a,u.u_lightpos),u_lightintensity:new o.Uniform1f(a,u.u_lightintensity),u_lightcolor:new o.Uniform3f(a,u.u_lightcolor),u_vertical_gradient:new o.Uniform1f(a,u.u_vertical_gradient),u_height_factor:new o.Uniform1f(a,u.u_height_factor),u_image:new o.Uniform1i(a,u.u_image),u_texsize:new o.Uniform2f(a,u.u_texsize),u_pixel_coord_upper:new o.Uniform2f(a,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(a,u.u_pixel_coord_lower),u_scale:new o.Uniform3f(a,u.u_scale),u_fade:new o.Uniform1f(a,u.u_fade),u_opacity:new o.Uniform1f(a,u.u_opacity)}},fill:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix)}},fillPattern:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_image:new o.Uniform1i(a,u.u_image),u_texsize:new o.Uniform2f(a,u.u_texsize),u_pixel_coord_upper:new o.Uniform2f(a,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(a,u.u_pixel_coord_lower),u_scale:new o.Uniform3f(a,u.u_scale),u_fade:new o.Uniform1f(a,u.u_fade)}},fillOutline:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_world:new o.Uniform2f(a,u.u_world)}},fillOutlinePattern:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_world:new o.Uniform2f(a,u.u_world),u_image:new o.Uniform1i(a,u.u_image),u_texsize:new o.Uniform2f(a,u.u_texsize),u_pixel_coord_upper:new o.Uniform2f(a,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(a,u.u_pixel_coord_lower),u_scale:new o.Uniform3f(a,u.u_scale),u_fade:new o.Uniform1f(a,u.u_fade)}},circle:function(a,u){return{u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(a,u.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(a,u.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(a,u.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(a,u.u_matrix)}},collisionBox:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(a,u.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(a,u.u_extrude_scale),u_overscale_factor:new o.Uniform1f(a,u.u_overscale_factor)}},collisionCircle:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_inv_matrix:new o.UniformMatrix4f(a,u.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(a,u.u_viewport_size)}},debug:function(a,u){return{u_color:new o.UniformColor(a,u.u_color),u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_overlay:new o.Uniform1i(a,u.u_overlay),u_overlay_scale:new o.Uniform1f(a,u.u_overlay_scale)}},clippingMask:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix)}},heatmap:function(a,u){return{u_extrude_scale:new o.Uniform1f(a,u.u_extrude_scale),u_intensity:new o.Uniform1f(a,u.u_intensity),u_matrix:new o.UniformMatrix4f(a,u.u_matrix)}},heatmapTexture:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_world:new o.Uniform2f(a,u.u_world),u_image:new o.Uniform1i(a,u.u_image),u_color_ramp:new o.Uniform1i(a,u.u_color_ramp),u_opacity:new o.Uniform1f(a,u.u_opacity)}},hillshade:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_image:new o.Uniform1i(a,u.u_image),u_latrange:new o.Uniform2f(a,u.u_latrange),u_light:new o.Uniform2f(a,u.u_light),u_shadow:new o.UniformColor(a,u.u_shadow),u_highlight:new o.UniformColor(a,u.u_highlight),u_accent:new o.UniformColor(a,u.u_accent)}},hillshadePrepare:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_image:new o.Uniform1i(a,u.u_image),u_dimension:new o.Uniform2f(a,u.u_dimension),u_zoom:new o.Uniform1f(a,u.u_zoom),u_unpack:new o.Uniform4f(a,u.u_unpack)}},line:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_ratio:new o.Uniform1f(a,u.u_ratio),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(a,u.u_units_to_pixels)}},lineGradient:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_ratio:new o.Uniform1f(a,u.u_ratio),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(a,u.u_units_to_pixels),u_image:new o.Uniform1i(a,u.u_image),u_image_height:new o.Uniform1f(a,u.u_image_height)}},linePattern:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_texsize:new o.Uniform2f(a,u.u_texsize),u_ratio:new o.Uniform1f(a,u.u_ratio),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_image:new o.Uniform1i(a,u.u_image),u_units_to_pixels:new o.Uniform2f(a,u.u_units_to_pixels),u_scale:new o.Uniform3f(a,u.u_scale),u_fade:new o.Uniform1f(a,u.u_fade)}},lineSDF:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_ratio:new o.Uniform1f(a,u.u_ratio),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(a,u.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(a,u.u_patternscale_a),u_patternscale_b:new o.Uniform2f(a,u.u_patternscale_b),u_sdfgamma:new o.Uniform1f(a,u.u_sdfgamma),u_image:new o.Uniform1i(a,u.u_image),u_tex_y_a:new o.Uniform1f(a,u.u_tex_y_a),u_tex_y_b:new o.Uniform1f(a,u.u_tex_y_b),u_mix:new o.Uniform1f(a,u.u_mix)}},raster:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_tl_parent:new o.Uniform2f(a,u.u_tl_parent),u_scale_parent:new o.Uniform1f(a,u.u_scale_parent),u_buffer_scale:new o.Uniform1f(a,u.u_buffer_scale),u_fade_t:new o.Uniform1f(a,u.u_fade_t),u_opacity:new o.Uniform1f(a,u.u_opacity),u_image0:new o.Uniform1i(a,u.u_image0),u_image1:new o.Uniform1i(a,u.u_image1),u_brightness_low:new o.Uniform1f(a,u.u_brightness_low),u_brightness_high:new o.Uniform1f(a,u.u_brightness_high),u_saturation_factor:new o.Uniform1f(a,u.u_saturation_factor),u_contrast_factor:new o.Uniform1f(a,u.u_contrast_factor),u_spin_weights:new o.Uniform3f(a,u.u_spin_weights)}},symbolIcon:function(a,u){return{u_is_size_zoom_constant:new o.Uniform1i(a,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(a,u.u_is_size_feature_constant),u_size_t:new o.Uniform1f(a,u.u_size_t),u_size:new o.Uniform1f(a,u.u_size),u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_pitch:new o.Uniform1f(a,u.u_pitch),u_rotate_symbol:new o.Uniform1i(a,u.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(a,u.u_aspect_ratio),u_fade_change:new o.Uniform1f(a,u.u_fade_change),u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(a,u.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(a,u.u_coord_matrix),u_is_text:new o.Uniform1i(a,u.u_is_text),u_pitch_with_map:new o.Uniform1i(a,u.u_pitch_with_map),u_texsize:new o.Uniform2f(a,u.u_texsize),u_texture:new o.Uniform1i(a,u.u_texture)}},symbolSDF:function(a,u){return{u_is_size_zoom_constant:new o.Uniform1i(a,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(a,u.u_is_size_feature_constant),u_size_t:new o.Uniform1f(a,u.u_size_t),u_size:new o.Uniform1f(a,u.u_size),u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_pitch:new o.Uniform1f(a,u.u_pitch),u_rotate_symbol:new o.Uniform1i(a,u.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(a,u.u_aspect_ratio),u_fade_change:new o.Uniform1f(a,u.u_fade_change),u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(a,u.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(a,u.u_coord_matrix),u_is_text:new o.Uniform1i(a,u.u_is_text),u_pitch_with_map:new o.Uniform1i(a,u.u_pitch_with_map),u_texsize:new o.Uniform2f(a,u.u_texsize),u_texture:new o.Uniform1i(a,u.u_texture),u_gamma_scale:new o.Uniform1f(a,u.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(a,u.u_is_halo)}},symbolTextAndIcon:function(a,u){return{u_is_size_zoom_constant:new o.Uniform1i(a,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(a,u.u_is_size_feature_constant),u_size_t:new o.Uniform1f(a,u.u_size_t),u_size:new o.Uniform1f(a,u.u_size),u_camera_to_center_distance:new o.Uniform1f(a,u.u_camera_to_center_distance),u_pitch:new o.Uniform1f(a,u.u_pitch),u_rotate_symbol:new o.Uniform1i(a,u.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(a,u.u_aspect_ratio),u_fade_change:new o.Uniform1f(a,u.u_fade_change),u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(a,u.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(a,u.u_coord_matrix),u_is_text:new o.Uniform1i(a,u.u_is_text),u_pitch_with_map:new o.Uniform1i(a,u.u_pitch_with_map),u_texsize:new o.Uniform2f(a,u.u_texsize),u_texsize_icon:new o.Uniform2f(a,u.u_texsize_icon),u_texture:new o.Uniform1i(a,u.u_texture),u_texture_icon:new o.Uniform1i(a,u.u_texture_icon),u_gamma_scale:new o.Uniform1f(a,u.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(a,u.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(a,u.u_is_halo)}},background:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_opacity:new o.Uniform1f(a,u.u_opacity),u_color:new o.UniformColor(a,u.u_color)}},backgroundPattern:function(a,u){return{u_matrix:new o.UniformMatrix4f(a,u.u_matrix),u_opacity:new o.Uniform1f(a,u.u_opacity),u_image:new o.Uniform1i(a,u.u_image),u_pattern_tl_a:new o.Uniform2f(a,u.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(a,u.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(a,u.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(a,u.u_pattern_br_b),u_texsize:new o.Uniform2f(a,u.u_texsize),u_mix:new o.Uniform1f(a,u.u_mix),u_pattern_size_a:new o.Uniform2f(a,u.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(a,u.u_pattern_size_b),u_scale_a:new o.Uniform1f(a,u.u_scale_a),u_scale_b:new o.Uniform1f(a,u.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(a,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(a,u.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(a,u.u_tile_units_to_pixels)}}};function ru(a,u,s,f,T,W,K){for(var ue=a.context,Se=ue.gl,Ie=a.useProgram("collisionBox"),We=[],Xe=0,Je=0,xt=0;xt<f.length;xt++){var _t=f[xt],Pt=u.getTile(_t),ft=Pt.getBucket(s);if(ft){var Ot=_t.posMatrix;T[0]===0&&T[1]===0||(Ot=a.translatePosMatrix(_t.posMatrix,Pt,T,W));var jt=K?ft.textCollisionBox:ft.iconCollisionBox,er=ft.collisionCircleArray;if(er.length>0){var br=o.create(),yr=Ot;o.mul(br,ft.placementInvProjMatrix,a.transform.glCoordMatrix),o.mul(br,br,ft.placementViewportMatrix),We.push({circleArray:er,circleOffset:Je,transform:yr,invTransform:br}),Je=Xe+=er.length/4}jt&&Ie.draw(ue,Se.LINES,Ke.disabled,ot.disabled,a.colorModeForRenderPass(),Nt.disabled,Zs(Ot,a.transform,Pt),s.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,null,a.transform.zoom,null,null,jt.collisionVertexBuffer)}}if(K&&We.length){var Cr=a.useProgram("collisionCircle"),zr=new o.StructArrayLayout2f1f2i16;zr.resize(4*Xe),zr._trim();for(var un=0,qr=0,Dn=We;qr<Dn.length;qr+=1)for(var $n=Dn[qr],Jn=0;Jn<$n.circleArray.length/4;Jn++){var ii=4*Jn,qi=$n.circleArray[ii+0],zn=$n.circleArray[ii+1],di=$n.circleArray[ii+2],Bi=$n.circleArray[ii+3];zr.emplace(un++,qi,zn,di,Bi,0),zr.emplace(un++,qi,zn,di,Bi,1),zr.emplace(un++,qi,zn,di,Bi,2),zr.emplace(un++,qi,zn,di,Bi,3)}(!Zu||Zu.length<2*Xe)&&(Zu=function(oo){var Ho=2*oo,Lo=new o.StructArrayLayout3ui6;Lo.resize(Ho),Lo._trim();for(var qa=0;qa<Ho;qa++){var so=6*qa;Lo.uint16[so+0]=4*qa+0,Lo.uint16[so+1]=4*qa+1,Lo.uint16[so+2]=4*qa+2,Lo.uint16[so+3]=4*qa+2,Lo.uint16[so+4]=4*qa+3,Lo.uint16[so+5]=4*qa+0}return Lo}(Xe));for(var bi=ue.createIndexBuffer(Zu,!0),gi=ue.createVertexBuffer(zr,o.collisionCircleLayout.members,!0),Di=0,pi=We;Di<pi.length;Di+=1){var li=pi[Di],Co=Gu(li.transform,li.invTransform,a.transform);Cr.draw(ue,Se.TRIANGLES,Ke.disabled,ot.disabled,a.colorModeForRenderPass(),Nt.disabled,Co,s.id,gi,bi,o.SegmentVector.simpleSegment(0,2*li.circleOffset,li.circleArray.length,li.circleArray.length/2),null,a.transform.zoom,null,null,null)}gi.destroy(),bi.destroy()}}var gs=o.identity(new Float32Array(16));function hl(a,u,s,f,T,W){var K=o.getAnchorAlignment(a),ue=-(K.horizontalAlign-.5)*u,Se=-(K.verticalAlign-.5)*s,Ie=o.evaluateVariableOffset(a,f);return new o.Point((ue/T+Ie[0])*W,(Se/T+Ie[1])*W)}function kl(a,u,s,f,T,W,K,ue,Se,Ie,We){var Xe=a.text.placedSymbolArray,Je=a.text.dynamicLayoutVertexArray,xt=a.icon.dynamicLayoutVertexArray,_t={};Je.clear();for(var Pt=0;Pt<Xe.length;Pt++){var ft=Xe.get(Pt),Ot=ft.hidden||!ft.crossTileID||a.allowVerticalPlacement&&!ft.placedOrientation?null:f[ft.crossTileID];if(Ot){var jt=new o.Point(ft.anchorX,ft.anchorY),er=hi(jt,s?ue:K),br=Ii(W.cameraToCenterDistance,er.signedDistanceFromCamera),yr=T.evaluateSizeForFeature(a.textSizeData,Ie,ft)*br/o.ONE_EM;s&&(yr*=a.tilePixelRatio/Se);for(var Cr=hl(Ot.anchor,Ot.width,Ot.height,Ot.textOffset,Ot.textBoxScale,yr),zr=s?hi(jt.add(Cr),K).point:er.point.add(u?Cr.rotate(-W.angle):Cr),un=a.allowVerticalPlacement&&ft.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,qr=0;qr<ft.numGlyphs;qr++)o.addDynamicAttributes(Je,zr,un);We&&ft.associatedIconIndex>=0&&(_t[ft.associatedIconIndex]={shiftedAnchor:zr,angle:un})}else _a(ft.numGlyphs,Je)}if(We){xt.clear();for(var Dn=a.icon.placedSymbolArray,$n=0;$n<Dn.length;$n++){var Jn=Dn.get($n);if(Jn.hidden)_a(Jn.numGlyphs,xt);else{var ii=_t[$n];if(ii)for(var qi=0;qi<Jn.numGlyphs;qi++)o.addDynamicAttributes(xt,ii.shiftedAnchor,ii.angle);else _a(Jn.numGlyphs,xt)}}a.icon.dynamicLayoutVertexBuffer.updateData(xt)}a.text.dynamicLayoutVertexBuffer.updateData(Je)}function dl(a,u,s){return s.iconsInText&&u?"symbolTextAndIcon":a?"symbolSDF":"symbolIcon"}function nu(a,u,s,f,T,W,K,ue,Se,Ie,We,Xe){for(var Je=a.context,xt=Je.gl,_t=a.transform,Pt=ue==="map",ft=Se==="map",Ot=Pt&&s.layout.get("symbol-placement")!=="point",jt=Pt&&!ft&&!Ot,er=s.layout.get("symbol-sort-key").constantOr(1)!==void 0,br=!1,yr=a.depthModeForSublayer(0,Ke.ReadOnly),Cr=s.layout.get("text-variable-anchor"),zr=[],un=0,qr=f;un<qr.length;un+=1){var Dn=qr[un],$n=u.getTile(Dn),Jn=$n.getBucket(s);if(Jn){var ii=T?Jn.text:Jn.icon;if(ii&&ii.segments.get().length){var qi=ii.programConfigurations.get(s.id),zn=T||Jn.sdfIcons,di=T?Jn.textSizeData:Jn.iconSizeData,Bi=ft||_t.pitch!==0,bi=a.useProgram(dl(zn,T,Jn),qi),gi=o.evaluateSizeForZoom(di,_t.zoom),Di=void 0,pi=[0,0],li=void 0,Co=void 0,oo=null,Ho=void 0;if(T)li=$n.glyphAtlasTexture,Co=xt.LINEAR,Di=$n.glyphAtlasTexture.size,Jn.iconsInText&&(pi=$n.imageAtlasTexture.size,oo=$n.imageAtlasTexture,Ho=Bi||a.options.rotating||a.options.zooming||di.kind==="composite"||di.kind==="camera"?xt.LINEAR:xt.NEAREST);else{var Lo=s.layout.get("icon-size").constantOr(0)!==1||Jn.iconsNeedLinear;li=$n.imageAtlasTexture,Co=zn||a.options.rotating||a.options.zooming||Lo||Bi?xt.LINEAR:xt.NEAREST,Di=$n.imageAtlasTexture.size}var qa=ia($n,1,a.transform.zoom),so=va(Dn.posMatrix,ft,Pt,a.transform,qa),hs=Pi(Dn.posMatrix,ft,Pt,a.transform,qa),ts=Cr&&Jn.hasTextData(),Cu=s.layout.get("icon-text-fit")!=="none"&&ts&&Jn.hasIconData();Ot&&ls(Jn,Dn.posMatrix,a,T,so,hs,ft,Ie);var ds=a.translatePosMatrix(Dn.posMatrix,$n,W,K),zs=Ot||T&&Cr||Cu?gs:so,As=a.translatePosMatrix(hs,$n,W,K,!0),gl=zn&&s.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0,rl={program:bi,buffers:ii,uniformValues:zn?Jn.iconsInText?Iu(di.kind,gi,jt,ft,a,ds,zs,As,Di,pi):eu(di.kind,gi,jt,ft,a,ds,zs,As,T,Di,!0):qs(di.kind,gi,jt,ft,a,ds,zs,As,T,Di),atlasTexture:li,atlasTextureIcon:oo,atlasInterpolation:Co,atlasInterpolationIcon:Ho,isSDF:zn,hasHalo:gl};if(er&&Jn.canOverlap){br=!0;for(var fu=0,Fu=ii.segments.get();fu<Fu.length;fu+=1){var yl=Fu[fu];zr.push({segments:new o.SegmentVector([yl]),sortKey:yl.sortKey,state:rl})}}else zr.push({segments:ii.segments,sortKey:0,state:rl})}}}br&&zr.sort(function(Tu,wu){return Tu.sortKey-wu.sortKey});for(var js=0,_l=zr;js<_l.length;js+=1){var $s=_l[js],_o=$s.state;if(Je.activeTexture.set(xt.TEXTURE0),_o.atlasTexture.bind(_o.atlasInterpolation,xt.CLAMP_TO_EDGE),_o.atlasTextureIcon&&(Je.activeTexture.set(xt.TEXTURE1),_o.atlasTextureIcon&&_o.atlasTextureIcon.bind(_o.atlasInterpolationIcon,xt.CLAMP_TO_EDGE)),_o.isSDF){var hu=_o.uniformValues;_o.hasHalo&&(hu.u_is_halo=1,Ru(_o.buffers,$s.segments,s,a,_o.program,yr,We,Xe,hu)),hu.u_is_halo=0}Ru(_o.buffers,$s.segments,s,a,_o.program,yr,We,Xe,_o.uniformValues)}}function Ru(a,u,s,f,T,W,K,ue,Se){var Ie=f.context;T.draw(Ie,Ie.gl.TRIANGLES,W,K,ue,Nt.disabled,Se,s.id,a.layoutVertexBuffer,a.indexBuffer,u,s.paint,f.transform.zoom,a.programConfigurations.get(s.id),a.dynamicLayoutVertexBuffer,a.opacityVertexBuffer)}function Wu(a,u,s,f,T,W,K){var ue,Se,Ie,We,Xe,Je=a.context.gl,xt=s.paint.get("fill-pattern"),_t=xt&&xt.constantOr(1),Pt=s.getCrossfadeParameters();K?(Se=_t&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ue=Je.LINES):(Se=_t?"fillPattern":"fill",ue=Je.TRIANGLES);for(var ft=0,Ot=f;ft<Ot.length;ft+=1){var jt=Ot[ft],er=u.getTile(jt);if(!_t||er.patternsLoaded()){var br=er.getBucket(s);if(br){var yr=br.programConfigurations.get(s.id),Cr=a.useProgram(Se,yr);_t&&(a.context.activeTexture.set(Je.TEXTURE0),er.imageAtlasTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE),yr.updatePaintBuffers(Pt));var zr=xt.constantOr(null);if(zr&&er.imageAtlas){var un=er.imageAtlas,qr=un.patternPositions[zr.to.toString()],Dn=un.patternPositions[zr.from.toString()];qr&&Dn&&yr.setConstantPatternPositions(qr,Dn)}var $n=a.translatePosMatrix(jt.posMatrix,er,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(K){We=br.indexBuffer2,Xe=br.segments2;var Jn=[Je.drawingBufferWidth,Je.drawingBufferHeight];Ie=Se==="fillOutlinePattern"&&_t?$l($n,a,Pt,er,Jn):cl($n,Jn)}else We=br.indexBuffer,Xe=br.segments,Ie=_t?Ra($n,a,Pt,er):Os($n);Cr.draw(a.context,ue,T,a.stencilModeForClipping(jt),W,Nt.disabled,Ie,s.id,br.layoutVertexBuffer,We,Xe,s.paint,a.transform.zoom,yr)}}}}function pl(a,u,s,f,T,W,K){for(var ue=a.context,Se=ue.gl,Ie=s.paint.get("fill-extrusion-pattern"),We=Ie.constantOr(1),Xe=s.getCrossfadeParameters(),Je=s.paint.get("fill-extrusion-opacity"),xt=0,_t=f;xt<_t.length;xt+=1){var Pt=_t[xt],ft=u.getTile(Pt),Ot=ft.getBucket(s);if(Ot){var jt=Ot.programConfigurations.get(s.id),er=a.useProgram(We?"fillExtrusionPattern":"fillExtrusion",jt);We&&(a.context.activeTexture.set(Se.TEXTURE0),ft.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),jt.updatePaintBuffers(Xe));var br=Ie.constantOr(null);if(br&&ft.imageAtlas){var yr=ft.imageAtlas,Cr=yr.patternPositions[br.to.toString()],zr=yr.patternPositions[br.from.toString()];Cr&&zr&&jt.setConstantPatternPositions(Cr,zr)}var un=a.translatePosMatrix(Pt.posMatrix,ft,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),qr=s.paint.get("fill-extrusion-vertical-gradient"),Dn=We?ks(un,a,qr,Je,Pt,Xe,ft):Vu(un,a,qr,Je);er.draw(ue,ue.gl.TRIANGLES,T,W,K,Nt.backCCW,Dn,s.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,s.paint,a.transform.zoom,jt)}}}function Yu(a,u,s,f,T,W){var K=a.context,ue=K.gl,Se=u.fbo;if(Se){var Ie=a.useProgram("hillshade");K.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,Se.colorAttachment.get());var We=function(Xe,Je,xt){var _t=xt.paint.get("hillshade-shadow-color"),Pt=xt.paint.get("hillshade-highlight-color"),ft=xt.paint.get("hillshade-accent-color"),Ot=xt.paint.get("hillshade-illumination-direction")*(Math.PI/180);xt.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ot-=Xe.transform.angle);var jt,er,br,yr=!Xe.options.moving;return{u_matrix:Xe.transform.calculatePosMatrix(Je.tileID.toUnwrapped(),yr),u_image:0,u_latrange:(jt=Je.tileID,er=Math.pow(2,jt.canonical.z),br=jt.canonical.y,[new o.MercatorCoordinate(0,br/er).toLngLat().lat,new o.MercatorCoordinate(0,(br+1)/er).toLngLat().lat]),u_light:[xt.paint.get("hillshade-exaggeration"),Ot],u_shadow:_t,u_highlight:Pt,u_accent:ft}}(a,u,s);Ie.draw(K,ue.TRIANGLES,f,T,W,Nt.disabled,We,s.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}}function ql(a,u,s,f,T,W){var K=a.context,ue=K.gl,Se=u.dem;if(Se&&Se.data){var Ie=Se.dim,We=Se.stride,Xe=Se.getPixels();if(K.activeTexture.set(ue.TEXTURE1),K.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||a.getTileTexture(We),u.demTexture){var Je=u.demTexture;Je.update(Xe,{premultiply:!1}),Je.bind(ue.NEAREST,ue.CLAMP_TO_EDGE)}else u.demTexture=new o.Texture(K,Xe,ue.RGBA,{premultiply:!1}),u.demTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);K.activeTexture.set(ue.TEXTURE0);var xt=u.fbo;if(!xt){var _t=new o.Texture(K,{width:Ie,height:Ie,data:null},ue.RGBA);_t.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),(xt=u.fbo=K.createFramebuffer(Ie,Ie,!0)).colorAttachment.set(_t.texture)}K.bindFramebuffer.set(xt.framebuffer),K.viewport.set([0,0,Ie,Ie]),a.useProgram("hillshadePrepare").draw(K,ue.TRIANGLES,f,T,W,Nt.disabled,function(Pt,ft){var Ot=ft.stride,jt=o.create();return o.ortho(jt,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(jt,jt,[0,-o.EXTENT,0]),{u_matrix:jt,u_image:1,u_dimension:[Ot,Ot],u_zoom:Pt.overscaledZ,u_unpack:ft.getUnpackVector()}}(u.tileID,Se),s.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Xs(a,u,s,f,T){var W=f.paint.get("raster-fade-duration");if(W>0){var K=o.browser.now(),ue=(K-a.timeAdded)/W,Se=u?(K-u.timeAdded)/W:-1,Ie=s.getSource(),We=T.coveringZoomLevel({tileSize:Ie.tileSize,roundZoom:Ie.roundZoom}),Xe=!u||Math.abs(u.tileID.overscaledZ-We)>Math.abs(a.tileID.overscaledZ-We),Je=Xe&&a.refreshedUponExpiration?1:o.clamp(Xe?ue:1-Se,0,1);return a.refreshedUponExpiration&&ue>=1&&(a.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Je}:{opacity:Je,mix:0}}return{opacity:1,mix:0}}var Xu=new o.Color(1,0,0,1),Ku=new o.Color(0,1,0,1),_u=new o.Color(0,0,1,1),$u=new o.Color(1,0,1,1),iu=new o.Color(0,1,1,1);function vl(a,u,s,f){Lu(a,0,u+s/2,a.transform.width,s,f)}function Ju(a,u,s,f){Lu(a,u-s/2,0,s,a.transform.height,f)}function Lu(a,u,s,f,T,W){var K=a.context,ue=K.gl;ue.enable(ue.SCISSOR_TEST),ue.scissor(u*o.browser.devicePixelRatio,s*o.browser.devicePixelRatio,f*o.browser.devicePixelRatio,T*o.browser.devicePixelRatio),K.clear({color:W}),ue.disable(ue.SCISSOR_TEST)}function ec(a,u,s){var f=a.context,T=f.gl,W=s.posMatrix,K=a.useProgram("debug"),ue=Ke.disabled,Se=ot.disabled,Ie=a.colorModeForRenderPass();f.activeTexture.set(T.TEXTURE0),a.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),K.draw(f,T.LINE_STRIP,ue,Se,Ie,Nt.disabled,ms(W,o.Color.red),"$debug",a.debugBuffer,a.tileBorderIndexBuffer,a.debugSegments);var We=u.getTileByID(s.key).latestRawTileData,Xe=Math.floor((We&&We.byteLength||0)/1024),Je=u.getTile(s).tileSize,xt=512/Math.min(Je,512)*(s.overscaledZ/a.transform.zoom)*.5,_t=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(_t+=" => "+s.overscaledZ),function(Pt,ft){Pt.initDebugOverlayCanvas();var Ot=Pt.debugOverlayCanvas,jt=Pt.context.gl,er=Pt.debugOverlayCanvas.getContext("2d");er.clearRect(0,0,Ot.width,Ot.height),er.shadowColor="white",er.shadowBlur=2,er.lineWidth=1.5,er.strokeStyle="white",er.textBaseline="top",er.font="bold 36px Open Sans, sans-serif",er.fillText(ft,5,5),er.strokeText(ft,5,5),Pt.debugOverlayTexture.update(Ot),Pt.debugOverlayTexture.bind(jt.LINEAR,jt.CLAMP_TO_EDGE)}(a,_t+" "+Xe+"kb"),K.draw(f,T.TRIANGLES,ue,Se,Rt.alphaBlended,Nt.disabled,ms(W,o.Color.transparent,xt),"$debug",a.debugBuffer,a.quadTriangleIndexBuffer,a.debugSegments)}var xu={symbol:function(a,u,s,f,T){if(a.renderPass==="translucent"){var W=ot.disabled,K=a.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(ue,Se,Ie,We,Xe,Je,xt){for(var _t=Se.transform,Pt=Xe==="map",ft=Je==="map",Ot=0,jt=ue;Ot<jt.length;Ot+=1){var er=jt[Ot],br=We.getTile(er),yr=br.getBucket(Ie);if(yr&&yr.text&&yr.text.segments.get().length){var Cr=o.evaluateSizeForZoom(yr.textSizeData,_t.zoom),zr=ia(br,1,Se.transform.zoom),un=va(er.posMatrix,ft,Pt,Se.transform,zr),qr=Ie.layout.get("icon-text-fit")!=="none"&&yr.hasIconData();if(Cr){var Dn=Math.pow(2,_t.zoom-br.tileID.overscaledZ);kl(yr,Pt,ft,xt,o.symbolSize,_t,un,er.posMatrix,Dn,Cr,qr)}}}}(f,a,s,u,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),T),s.paint.get("icon-opacity").constantOr(1)!==0&&nu(a,u,s,f,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),W,K),s.paint.get("text-opacity").constantOr(1)!==0&&nu(a,u,s,f,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),W,K),u.map.showCollisionBoxes&&(ru(a,u,s,f,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),ru(a,u,s,f,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))}},circle:function(a,u,s,f){if(a.renderPass==="translucent"){var T=s.paint.get("circle-opacity"),W=s.paint.get("circle-stroke-width"),K=s.paint.get("circle-stroke-opacity"),ue=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(T.constantOr(1)!==0||W.constantOr(1)!==0&&K.constantOr(1)!==0){for(var Se=a.context,Ie=Se.gl,We=a.depthModeForSublayer(0,Ke.ReadOnly),Xe=ot.disabled,Je=a.colorModeForRenderPass(),xt=[],_t=0;_t<f.length;_t++){var Pt=f[_t],ft=u.getTile(Pt),Ot=ft.getBucket(s);if(Ot){var jt=Ot.programConfigurations.get(s.id),er={programConfiguration:jt,program:a.useProgram("circle",jt),layoutVertexBuffer:Ot.layoutVertexBuffer,indexBuffer:Ot.indexBuffer,uniformValues:Ts(a,Pt,ft,s)};if(ue)for(var br=0,yr=Ot.segments.get();br<yr.length;br+=1){var Cr=yr[br];xt.push({segments:new o.SegmentVector([Cr]),sortKey:Cr.sortKey,state:er})}else xt.push({segments:Ot.segments,sortKey:0,state:er})}}ue&&xt.sort(function($n,Jn){return $n.sortKey-Jn.sortKey});for(var zr=0,un=xt;zr<un.length;zr+=1){var qr=un[zr],Dn=qr.state;Dn.program.draw(Se,Ie.TRIANGLES,We,Xe,Je,Nt.disabled,Dn.uniformValues,s.id,Dn.layoutVertexBuffer,Dn.indexBuffer,qr.segments,s.paint,a.transform.zoom,Dn.programConfiguration)}}}},heatmap:function(a,u,s,f){if(s.paint.get("heatmap-opacity")!==0)if(a.renderPass==="offscreen"){var T=a.context,W=T.gl,K=ot.disabled,ue=new Rt([W.ONE,W.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(xt,_t,Pt){var ft=xt.gl;xt.activeTexture.set(ft.TEXTURE1),xt.viewport.set([0,0,_t.width/4,_t.height/4]);var Ot=Pt.heatmapFbo;if(Ot)ft.bindTexture(ft.TEXTURE_2D,Ot.colorAttachment.get()),xt.bindFramebuffer.set(Ot.framebuffer);else{var jt=ft.createTexture();ft.bindTexture(ft.TEXTURE_2D,jt),ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_WRAP_S,ft.CLAMP_TO_EDGE),ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_WRAP_T,ft.CLAMP_TO_EDGE),ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_MIN_FILTER,ft.LINEAR),ft.texParameteri(ft.TEXTURE_2D,ft.TEXTURE_MAG_FILTER,ft.LINEAR),Ot=Pt.heatmapFbo=xt.createFramebuffer(_t.width/4,_t.height/4,!1),function(er,br,yr,Cr){var zr=er.gl;zr.texImage2D(zr.TEXTURE_2D,0,zr.RGBA,br.width/4,br.height/4,0,zr.RGBA,er.extRenderToTextureHalfFloat?er.extTextureHalfFloat.HALF_FLOAT_OES:zr.UNSIGNED_BYTE,null),Cr.colorAttachment.set(yr)}(xt,_t,jt,Ot)}})(T,a,s),T.clear({color:o.Color.transparent});for(var Se=0;Se<f.length;Se++){var Ie=f[Se];if(!u.hasRenderableParent(Ie)){var We=u.getTile(Ie),Xe=We.getBucket(s);if(Xe){var Je=Xe.programConfigurations.get(s.id);a.useProgram("heatmap",Je).draw(T,W.TRIANGLES,Ke.disabled,K,ue,Nt.disabled,Ou(Ie.posMatrix,We,a.transform.zoom,s.paint.get("heatmap-intensity")),s.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,s.paint,a.transform.zoom,Je)}}}T.viewport.set([0,0,a.width,a.height])}else a.renderPass==="translucent"&&(a.context.setColorMode(a.colorModeForRenderPass()),function(xt,_t){var Pt=xt.context,ft=Pt.gl,Ot=_t.heatmapFbo;if(Ot){Pt.activeTexture.set(ft.TEXTURE0),ft.bindTexture(ft.TEXTURE_2D,Ot.colorAttachment.get()),Pt.activeTexture.set(ft.TEXTURE1);var jt=_t.colorRampTexture;jt||(jt=_t.colorRampTexture=new o.Texture(Pt,_t.colorRamp,ft.RGBA)),jt.bind(ft.LINEAR,ft.CLAMP_TO_EDGE),xt.useProgram("heatmapTexture").draw(Pt,ft.TRIANGLES,Ke.disabled,ot.disabled,xt.colorModeForRenderPass(),Nt.disabled,function(er,br,yr,Cr){var zr=o.create();o.ortho(zr,0,er.width,er.height,0,0,1);var un=er.context.gl;return{u_matrix:zr,u_world:[un.drawingBufferWidth,un.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:br.paint.get("heatmap-opacity")}}(xt,_t),_t.id,xt.viewportBuffer,xt.quadTriangleIndexBuffer,xt.viewportSegments,_t.paint,xt.transform.zoom)}}(a,s))},line:function(a,u,s,f){if(a.renderPass==="translucent"){var T=s.paint.get("line-opacity"),W=s.paint.get("line-width");if(T.constantOr(1)!==0&&W.constantOr(1)!==0)for(var K=a.depthModeForSublayer(0,Ke.ReadOnly),ue=a.colorModeForRenderPass(),Se=s.paint.get("line-dasharray"),Ie=s.paint.get("line-pattern"),We=Ie.constantOr(1),Xe=s.paint.get("line-gradient"),Je=s.getCrossfadeParameters(),xt=We?"linePattern":Se?"lineSDF":Xe?"lineGradient":"line",_t=a.context,Pt=_t.gl,ft=!0,Ot=0,jt=f;Ot<jt.length;Ot+=1){var er=jt[Ot],br=u.getTile(er);if(!We||br.patternsLoaded()){var yr=br.getBucket(s);if(yr){var Cr=yr.programConfigurations.get(s.id),zr=a.context.program.get(),un=a.useProgram(xt,Cr),qr=ft||un.program!==zr,Dn=Ie.constantOr(null);if(Dn&&br.imageAtlas){var $n=br.imageAtlas,Jn=$n.patternPositions[Dn.to.toString()],ii=$n.patternPositions[Dn.from.toString()];Jn&&ii&&Cr.setConstantPatternPositions(Jn,ii)}var qi=We?Hu(a,br,s,Je):Se?Dl(a,br,s,Se,Je):Xe?Oa(a,br,s,yr.lineClipsArray.length):Ys(a,br,s);if(We)_t.activeTexture.set(Pt.TEXTURE0),br.imageAtlasTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),Cr.updatePaintBuffers(Je);else if(Se&&(qr||a.lineAtlas.dirty))_t.activeTexture.set(Pt.TEXTURE0),a.lineAtlas.bind(_t);else if(Xe){var zn=yr.gradients[s.id],di=zn.texture;if(s.gradientVersion!==zn.version){var Bi=256;if(s.stepInterpolant){var bi=u.getSource().maxzoom,gi=er.canonical.z===bi?Math.ceil(1<<a.transform.maxZoom-er.canonical.z):1;Bi=o.clamp(o.nextPowerOfTwo(yr.maxLineLength/o.EXTENT*1024*gi),256,_t.maxTextureSize)}zn.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Bi,image:zn.gradient||void 0,clips:yr.lineClipsArray}),zn.texture?zn.texture.update(zn.gradient):zn.texture=new o.Texture(_t,zn.gradient,Pt.RGBA),zn.version=s.gradientVersion,di=zn.texture}_t.activeTexture.set(Pt.TEXTURE0),di.bind(s.stepInterpolant?Pt.NEAREST:Pt.LINEAR,Pt.CLAMP_TO_EDGE)}un.draw(_t,Pt.TRIANGLES,K,a.stencilModeForClipping(er),ue,Nt.disabled,qi,s.id,yr.layoutVertexBuffer,yr.indexBuffer,yr.segments,s.paint,a.transform.zoom,Cr,yr.layoutVertexBuffer2),ft=!1}}}}},fill:function(a,u,s,f){var T=s.paint.get("fill-color"),W=s.paint.get("fill-opacity");if(W.constantOr(1)!==0){var K=a.colorModeForRenderPass(),ue=s.paint.get("fill-pattern"),Se=a.opaquePassEnabledForLayer()&&!ue.constantOr(1)&&T.constantOr(o.Color.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(a.renderPass===Se){var Ie=a.depthModeForSublayer(1,a.renderPass==="opaque"?Ke.ReadWrite:Ke.ReadOnly);Wu(a,u,s,f,Ie,K,!1)}if(a.renderPass==="translucent"&&s.paint.get("fill-antialias")){var We=a.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Ke.ReadOnly);Wu(a,u,s,f,We,K,!0)}}},"fill-extrusion":function(a,u,s,f){var T=s.paint.get("fill-extrusion-opacity");if(T!==0&&a.renderPass==="translucent"){var W=new Ke(a.context.gl.LEQUAL,Ke.ReadWrite,a.depthRangeFor3D);if(T!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))pl(a,u,s,f,W,ot.disabled,Rt.disabled),pl(a,u,s,f,W,a.stencilModeFor3D(),a.colorModeForRenderPass());else{var K=a.colorModeForRenderPass();pl(a,u,s,f,W,ot.disabled,K)}}},hillshade:function(a,u,s,f){if(a.renderPass==="offscreen"||a.renderPass==="translucent"){for(var T=a.context,W=a.depthModeForSublayer(0,Ke.ReadOnly),K=a.colorModeForRenderPass(),ue=a.renderPass==="translucent"?a.stencilConfigForOverlap(f):[{},f],Se=ue[0],Ie=0,We=ue[1];Ie<We.length;Ie+=1){var Xe=We[Ie],Je=u.getTile(Xe);Je.needsHillshadePrepare&&a.renderPass==="offscreen"?ql(a,Je,s,W,ot.disabled,K):a.renderPass==="translucent"&&Yu(a,Je,s,W,Se[Xe.overscaledZ],K)}T.viewport.set([0,0,a.width,a.height])}},raster:function(a,u,s,f){if(a.renderPass==="translucent"&&s.paint.get("raster-opacity")!==0&&f.length)for(var T=a.context,W=T.gl,K=u.getSource(),ue=a.useProgram("raster"),Se=a.colorModeForRenderPass(),Ie=K instanceof G?[{},f]:a.stencilConfigForOverlap(f),We=Ie[0],Xe=Ie[1],Je=Xe[Xe.length-1].overscaledZ,xt=!a.options.moving,_t=0,Pt=Xe;_t<Pt.length;_t+=1){var ft=Pt[_t],Ot=a.depthModeForSublayer(ft.overscaledZ-Je,s.paint.get("raster-opacity")===1?Ke.ReadWrite:Ke.ReadOnly,W.LESS),jt=u.getTile(ft),er=a.transform.calculatePosMatrix(ft.toUnwrapped(),xt);jt.registerFadeDuration(s.paint.get("raster-fade-duration"));var br=u.findLoadedParent(ft,0),yr=Xs(jt,br,u,s,a.transform),Cr=void 0,zr=void 0,un=s.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;T.activeTexture.set(W.TEXTURE0),jt.texture.bind(un,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(W.TEXTURE1),br?(br.texture.bind(un,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Cr=Math.pow(2,br.tileID.overscaledZ-jt.tileID.overscaledZ),zr=[jt.tileID.canonical.x*Cr%1,jt.tileID.canonical.y*Cr%1]):jt.texture.bind(un,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST);var qr=vc(er,zr||[0,0],Cr||1,yr,s);K instanceof G?ue.draw(T,W.TRIANGLES,Ot,ot.disabled,Se,Nt.disabled,qr,s.id,K.boundsBuffer,a.quadTriangleIndexBuffer,K.boundsSegments):ue.draw(T,W.TRIANGLES,Ot,We[ft.overscaledZ],Se,Nt.disabled,qr,s.id,a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}},background:function(a,u,s){var f=s.paint.get("background-color"),T=s.paint.get("background-opacity");if(T!==0){var W=a.context,K=W.gl,ue=a.transform,Se=ue.tileSize,Ie=s.paint.get("background-pattern");if(!a.isPatternMissing(Ie)){var We=!Ie&&f.a===1&&T===1&&a.opaquePassEnabledForLayer()?"opaque":"translucent";if(a.renderPass===We){var Xe=ot.disabled,Je=a.depthModeForSublayer(0,We==="opaque"?Ke.ReadWrite:Ke.ReadOnly),xt=a.colorModeForRenderPass(),_t=a.useProgram(Ie?"backgroundPattern":"background"),Pt=ue.coveringTiles({tileSize:Se});Ie&&(W.activeTexture.set(K.TEXTURE0),a.imageManager.bind(a.context));for(var ft=s.getCrossfadeParameters(),Ot=0,jt=Pt;Ot<jt.length;Ot+=1){var er=jt[Ot],br=a.transform.calculatePosMatrix(er.toUnwrapped()),yr=Ie?Is(br,T,a,Ie,{tileID:er,tileSize:Se},ft):tu(br,T,f);_t.draw(W,K.TRIANGLES,Je,Xe,xt,Nt.disabled,yr,s.id,a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}}}},debug:function(a,u,s){for(var f=0;f<s.length;f++)ec(a,u,s[f])},custom:function(a,u,s){var f=a.context,T=s.implementation;if(a.renderPass==="offscreen"){var W=T.prerender;W&&(a.setCustomLayerDefaults(),f.setColorMode(a.colorModeForRenderPass()),W.call(T,f.gl,a.transform.customLayerMatrix()),f.setDirty(),a.setBaseState())}else if(a.renderPass==="translucent"){a.setCustomLayerDefaults(),f.setColorMode(a.colorModeForRenderPass()),f.setStencilMode(ot.disabled);var K=T.renderingMode==="3d"?new Ke(a.context.gl.LEQUAL,Ke.ReadWrite,a.depthRangeFor3D):a.depthModeForSublayer(0,Ke.ReadOnly);f.setDepthMode(K),T.render(f.gl,a.transform.customLayerMatrix()),f.setDirty(),a.setBaseState(),f.bindFramebuffer.set(null)}}},Aa=function(a,u){this.context=new Ye(a),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Et.maxUnderzooming+Et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new kr,this.gpuTimers={}};Aa.prototype.resize=function(a,u){if(this.width=a*o.browser.devicePixelRatio,this.height=u*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var s=0,f=this.style._order;s<f.length;s+=1)this.style._layers[f[s]].resize()},Aa.prototype.setup=function(){var a=this.context,u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(u,Mr.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(s,Mr.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var f=new o.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(o.EXTENT,0,o.EXTENT,0),f.emplaceBack(0,o.EXTENT,0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=a.createVertexBuffer(f,ae.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var T=new o.StructArrayLayout2i4;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(T,Mr.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var W=new o.StructArrayLayout1ui2;W.emplaceBack(0),W.emplaceBack(1),W.emplaceBack(3),W.emplaceBack(2),W.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(W);var K=new o.StructArrayLayout3ui6;K.emplaceBack(0,1,2),K.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(K),this.emptyTexture=new o.Texture(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA);var ue=this.context.gl;this.stencilClearMode=new ot({func:ue.ALWAYS,mask:0},0,255,ue.ZERO,ue.ZERO,ue.ZERO)},Aa.prototype.clearStencil=function(){var a=this.context,u=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var s=o.create();o.ortho(s,0,this.width,this.height,0,0,1),o.scale(s,s,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,u.TRIANGLES,Ke.disabled,this.stencilClearMode,Rt.disabled,Nt.disabled,Ws(s),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Aa.prototype._renderTileClippingMasks=function(a,u){if(this.currentStencilSource!==a.source&&a.isTileClipped()&&u&&u.length){this.currentStencilSource=a.source;var s=this.context,f=s.gl;this.nextStencilID+u.length>256&&this.clearStencil(),s.setColorMode(Rt.disabled),s.setDepthMode(Ke.disabled);var T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var W=0,K=u;W<K.length;W+=1){var ue=K[W],Se=this._tileClippingMaskIDs[ue.key]=this.nextStencilID++;T.draw(s,f.TRIANGLES,Ke.disabled,new ot({func:f.ALWAYS,mask:0},Se,255,f.KEEP,f.KEEP,f.REPLACE),Rt.disabled,Nt.disabled,Ws(ue.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Aa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var a=this.nextStencilID++,u=this.context.gl;return new ot({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)},Aa.prototype.stencilModeForClipping=function(a){var u=this.context.gl;return new ot({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)},Aa.prototype.stencilConfigForOverlap=function(a){var u,s=this.context.gl,f=a.sort(function(Se,Ie){return Ie.overscaledZ-Se.overscaledZ}),T=f[f.length-1].overscaledZ,W=f[0].overscaledZ-T+1;if(W>1){this.currentStencilSource=void 0,this.nextStencilID+W>256&&this.clearStencil();for(var K={},ue=0;ue<W;ue++)K[ue+T]=new ot({func:s.GEQUAL,mask:255},ue+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=W,[K,f]}return[(u={},u[T]=ot.disabled,u),f]},Aa.prototype.colorModeForRenderPass=function(){var a=this.context.gl;return this._showOverdrawInspector?new Rt([a.CONSTANT_COLOR,a.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rt.unblended:Rt.alphaBlended},Aa.prototype.depthModeForSublayer=function(a,u,s){if(!this.opaquePassEnabledForLayer())return Ke.disabled;var f=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Ke(s||this.context.gl.LEQUAL,u,[f,f])},Aa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Aa.prototype.render=function(a,u){var s=this;this.style=a,this.options=u,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var f=this.style._order,T=this.style.sourceCaches;for(var W in T){var K=T[W];K.used&&K.prepare(this.context)}var ue,Se,Ie={},We={},Xe={};for(var Je in T){var xt=T[Je];Ie[Je]=xt.getVisibleCoordinates(),We[Je]=Ie[Je].slice().reverse(),Xe[Je]=xt.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var _t=0;_t<f.length;_t++)if(this.style._layers[f[_t]].is3D()){this.opaquePassCutoff=_t;break}this.renderPass="offscreen";for(var Pt=0,ft=f;Pt<ft.length;Pt+=1){var Ot=this.style._layers[ft[Pt]];if(Ot.hasOffscreenPass()&&!Ot.isHidden(this.transform.zoom)){var jt=We[Ot.source];(Ot.type==="custom"||jt.length)&&this.renderLayer(this,T[Ot.source],Ot,jt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){var er=this.style._layers[f[this.currentLayer]],br=T[er.source],yr=Ie[er.source];this._renderTileClippingMasks(er,yr),this.renderLayer(this,br,er,yr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){var Cr=this.style._layers[f[this.currentLayer]],zr=T[Cr.source],un=(Cr.type==="symbol"?Xe:We)[Cr.source];this._renderTileClippingMasks(Cr,Ie[Cr.source]),this.renderLayer(this,zr,Cr,un)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(qr){qr.source&&!qr.isHidden(s.transform.zoom)&&(qr.source!==(Se&&Se.id)&&(Se=s.style.sourceCaches[qr.source]),(!ue||ue.getSource().maxzoom<Se.getSource().maxzoom)&&(ue=Se))}),ue&&xu.debug(this,ue,ue.getVisibleCoordinates())),this.options.showPadding&&function(qr){var Dn=qr.transform.padding;vl(qr,qr.transform.height-(Dn.top||0),3,Xu),vl(qr,Dn.bottom||0,3,Ku),Ju(qr,Dn.left||0,3,_u),Ju(qr,qr.transform.width-(Dn.right||0),3,$u);var $n=qr.transform.centerPoint;(function(Jn,ii,qi,zn){Lu(Jn,ii-1,qi-10,2,20,zn),Lu(Jn,ii-10,qi-1,20,2,zn)})(qr,$n.x,qr.transform.height-$n.y,iu)}(this),this.context.setDefault()},Aa.prototype.renderLayer=function(a,u,s,f){s.isHidden(this.transform.zoom)||(s.type==="background"||s.type==="custom"||f.length)&&(this.id=s.id,this.gpuTimingStart(s),xu[s.type](a,u,s,f,this.style.placement.variableOffsets),this.gpuTimingEnd())},Aa.prototype.gpuTimingStart=function(a){if(this.options.gpuTiming){var u=this.context.extTimerQuery,s=this.gpuTimers[a.id];s||(s=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),s.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,s.query)}},Aa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}},Aa.prototype.collectGpuTimers=function(){var a=this.gpuTimers;return this.gpuTimers={},a},Aa.prototype.queryGpuTimers=function(a){var u={};for(var s in a){var f=a[s],T=this.context.extTimerQuery,W=T.getQueryObjectEXT(f.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(f.query),u[s]=W}return u},Aa.prototype.translatePosMatrix=function(a,u,s,f,T){if(!s[0]&&!s[1])return a;var W=T?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(W){var K=Math.sin(W),ue=Math.cos(W);s=[s[0]*ue-s[1]*K,s[0]*K+s[1]*ue]}var Se=[T?s[0]:ia(u,s[0],this.transform.zoom),T?s[1]:ia(u,s[1],this.transform.zoom),0],Ie=new Float32Array(16);return o.translate(Ie,a,Se),Ie},Aa.prototype.saveTileTexture=function(a){var u=this._tileTextures[a.size[0]];u?u.push(a):this._tileTextures[a.size[0]]=[a]},Aa.prototype.getTileTexture=function(a){var u=this._tileTextures[a];return u&&u.length>0?u.pop():null},Aa.prototype.isPatternMissing=function(a){if(!a)return!1;if(!a.from||!a.to)return!0;var u=this.imageManager.getPattern(a.from.toString()),s=this.imageManager.getPattern(a.to.toString());return!u||!s},Aa.prototype.useProgram=function(a,u){this.cache=this.cache||{};var s=""+a+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[s]||(this.cache[s]=new ll(this.context,a,Cs[a],u,fl[a],this._showOverdrawInspector)),this.cache[s]},Aa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Aa.prototype.setBaseState=function(){var a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)},Aa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Aa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var au=function(a,u){this.points=a,this.planes=u};au.fromInvProjectionMatrix=function(a,u,s){var f=Math.pow(2,s),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(K){return o.transformMat4([],K,a)}).map(function(K){return o.scale$1([],K,1/K[3]/u*f)}),W=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(K){var ue=o.sub([],T[K[0]],T[K[1]]),Se=o.sub([],T[K[2]],T[K[1]]),Ie=o.normalize([],o.cross([],ue,Se)),We=-o.dot(Ie,T[K[1]]);return Ie.concat(We)});return new au(T,W)};var ys=function(a,u){this.min=a,this.max=u,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};ys.prototype.quadrant=function(a){for(var u=[a%2==0,a<2],s=o.clone$2(this.min),f=o.clone$2(this.max),T=0;T<u.length;T++)s[T]=u[T]?this.min[T]:this.center[T],f[T]=u[T]?this.center[T]:this.max[T];return f[2]=this.max[2],new ys(s,f)},ys.prototype.distanceX=function(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]},ys.prototype.distanceY=function(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]},ys.prototype.intersects=function(a){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],s=!0,f=0;f<a.planes.length;f++){for(var T=a.planes[f],W=0,K=0;K<u.length;K++)W+=o.dot$1(T,u[K])>=0;if(W===0)return 0;W!==u.length&&(s=!1)}if(s)return 2;for(var ue=0;ue<3;ue++){for(var Se=Number.MAX_VALUE,Ie=-Number.MAX_VALUE,We=0;We<a.points.length;We++){var Xe=a.points[We][ue]-this.min[ue];Se=Math.min(Se,Xe),Ie=Math.max(Ie,Xe)}if(Ie<0||Se>this.max[ue]-this.min[ue])return 0}return 1};var _s=function(a,u,s,f){if(a===void 0&&(a=0),u===void 0&&(u=0),s===void 0&&(s=0),f===void 0&&(f=0),isNaN(a)||a<0||isNaN(u)||u<0||isNaN(s)||s<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=s,this.right=f};_s.prototype.interpolate=function(a,u,s){return u.top!=null&&a.top!=null&&(this.top=o.number(a.top,u.top,s)),u.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,u.bottom,s)),u.left!=null&&a.left!=null&&(this.left=o.number(a.left,u.left,s)),u.right!=null&&a.right!=null&&(this.right=o.number(a.right,u.right,s)),this},_s.prototype.getCenter=function(a,u){var s=o.clamp((this.left+a-this.right)/2,0,a),f=o.clamp((this.top+u-this.bottom)/2,0,u);return new o.Point(s,f)},_s.prototype.equals=function(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right},_s.prototype.clone=function(){return new _s(this.top,this.bottom,this.left,this.right)},_s.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ji=function(a,u,s,f,T){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=T===void 0||T,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=s==null?0:s,this._maxPitch=f==null?60:f,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _s,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ia={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ji.prototype.clone=function(){var a=new Ji(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a},Ia.minZoom.get=function(){return this._minZoom},Ia.minZoom.set=function(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))},Ia.maxZoom.get=function(){return this._maxZoom},Ia.maxZoom.set=function(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))},Ia.minPitch.get=function(){return this._minPitch},Ia.minPitch.set=function(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))},Ia.maxPitch.get=function(){return this._maxPitch},Ia.maxPitch.set=function(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))},Ia.renderWorldCopies.get=function(){return this._renderWorldCopies},Ia.renderWorldCopies.set=function(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a},Ia.worldSize.get=function(){return this.tileSize*this.scale},Ia.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ia.size.get=function(){return new o.Point(this.width,this.height)},Ia.bearing.get=function(){return-this.angle/Math.PI*180},Ia.bearing.set=function(a){var u=-o.wrap(a,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ia.pitch.get=function(){return this._pitch/Math.PI*180},Ia.pitch.set=function(a){var u=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ia.fov.get=function(){return this._fov/Math.PI*180},Ia.fov.set=function(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())},Ia.zoom.get=function(){return this._zoom},Ia.zoom.set=function(a){var u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ia.center.get=function(){return this._center},Ia.center.set=function(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())},Ia.padding.get=function(){return this._edgeInsets.toJSON()},Ia.padding.set=function(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())},Ia.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ji.prototype.isPaddingEqual=function(a){return this._edgeInsets.equals(a)},Ji.prototype.interpolatePadding=function(a,u,s){this._unmodified=!1,this._edgeInsets.interpolate(a,u,s),this._constrain(),this._calcMatrices()},Ji.prototype.coveringZoomLevel=function(a){var u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)},Ji.prototype.getVisibleUnwrappedCoordinates=function(a){var u=[new o.UnwrappedTileID(0,a)];if(this._renderWorldCopies)for(var s=this.pointCoordinate(new o.Point(0,0)),f=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),W=this.pointCoordinate(new o.Point(0,this.height)),K=Math.floor(Math.min(s.x,f.x,T.x,W.x)),ue=Math.floor(Math.max(s.x,f.x,T.x,W.x)),Se=K-1;Se<=ue+1;Se++)Se!==0&&u.push(new o.UnwrappedTileID(Se,a));return u},Ji.prototype.coveringTiles=function(a){var u=this.coveringZoomLevel(a),s=u;if(a.minzoom!==void 0&&u<a.minzoom)return[];a.maxzoom!==void 0&&u>a.maxzoom&&(u=a.maxzoom);var f=o.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,u),W=[T*f.x,T*f.y,0],K=au.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),ue=a.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(ue=u);var Se=function(qr){return{aabb:new ys([qr*T,0,0],[(qr+1)*T,T,0]),zoom:0,x:0,y:0,wrap:qr,fullyVisible:!1}},Ie=[],We=[],Xe=u,Je=a.reparseOverscaled?s:u;if(this._renderWorldCopies)for(var xt=1;xt<=3;xt++)Ie.push(Se(-xt)),Ie.push(Se(xt));for(Ie.push(Se(0));Ie.length>0;){var _t=Ie.pop(),Pt=_t.x,ft=_t.y,Ot=_t.fullyVisible;if(!Ot){var jt=_t.aabb.intersects(K);if(jt===0)continue;Ot=jt===2}var er=_t.aabb.distanceX(W),br=_t.aabb.distanceY(W),yr=Math.max(Math.abs(er),Math.abs(br));if(_t.zoom===Xe||yr>3+(1<<Xe-_t.zoom)-2&&_t.zoom>=ue)We.push({tileID:new o.OverscaledTileID(_t.zoom===Xe?Je:_t.zoom,_t.wrap,_t.zoom,Pt,ft),distanceSq:o.sqrLen([W[0]-.5-Pt,W[1]-.5-ft])});else for(var Cr=0;Cr<4;Cr++){var zr=(Pt<<1)+Cr%2,un=(ft<<1)+(Cr>>1);Ie.push({aabb:_t.aabb.quadrant(Cr),zoom:_t.zoom+1,x:zr,y:un,wrap:_t.wrap,fullyVisible:Ot})}}return We.sort(function(qr,Dn){return qr.distanceSq-Dn.distanceSq}).map(function(qr){return qr.tileID})},Ji.prototype.resize=function(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()},Ia.unmodified.get=function(){return this._unmodified},Ji.prototype.zoomScale=function(a){return Math.pow(2,a)},Ji.prototype.scaleZoom=function(a){return Math.log(a)/Math.LN2},Ji.prototype.project=function(a){var u=o.clamp(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(a.lng)*this.worldSize,o.mercatorYfromLat(u)*this.worldSize)},Ji.prototype.unproject=function(a){return new o.MercatorCoordinate(a.x/this.worldSize,a.y/this.worldSize).toLngLat()},Ia.point.get=function(){return this.project(this.center)},Ji.prototype.setLocationAtPoint=function(a,u){var s=this.pointCoordinate(u),f=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(a),W=new o.MercatorCoordinate(T.x-(s.x-f.x),T.y-(s.y-f.y));this.center=this.coordinateLocation(W),this._renderWorldCopies&&(this.center=this.center.wrap())},Ji.prototype.locationPoint=function(a){return this.coordinatePoint(this.locationCoordinate(a))},Ji.prototype.pointLocation=function(a){return this.coordinateLocation(this.pointCoordinate(a))},Ji.prototype.locationCoordinate=function(a){return o.MercatorCoordinate.fromLngLat(a)},Ji.prototype.coordinateLocation=function(a){return a.toLngLat()},Ji.prototype.pointCoordinate=function(a){var u=[a.x,a.y,0,1],s=[a.x,a.y,1,1];o.transformMat4(u,u,this.pixelMatrixInverse),o.transformMat4(s,s,this.pixelMatrixInverse);var f=u[3],T=s[3],W=u[1]/f,K=s[1]/T,ue=u[2]/f,Se=s[2]/T,Ie=ue===Se?0:(0-ue)/(Se-ue);return new o.MercatorCoordinate(o.number(u[0]/f,s[0]/T,Ie)/this.worldSize,o.number(W,K,Ie)/this.worldSize)},Ji.prototype.coordinatePoint=function(a){var u=[a.x*this.worldSize,a.y*this.worldSize,0,1];return o.transformMat4(u,u,this.pixelMatrix),new o.Point(u[0]/u[3],u[1]/u[3])},Ji.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},Ji.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ji.prototype.setMaxBounds=function(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ji.prototype.calculatePosMatrix=function(a,u){u===void 0&&(u=!1);var s=a.key,f=u?this._alignedPosMatrixCache:this._posMatrixCache;if(f[s])return f[s];var T=a.canonical,W=this.worldSize/this.zoomScale(T.z),K=T.x+Math.pow(2,T.z)*a.wrap,ue=o.identity(new Float64Array(16));return o.translate(ue,ue,[K*W,T.y*W,0]),o.scale(ue,ue,[W/o.EXTENT,W/o.EXTENT,1]),o.multiply(ue,u?this.alignedProjMatrix:this.projMatrix,ue),f[s]=new Float32Array(ue),f[s]},Ji.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ji.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var a,u,s,f,T=-90,W=90,K=-180,ue=180,Se=this.size,Ie=this._unmodified;if(this.latRange){var We=this.latRange;T=o.mercatorYfromLat(We[1])*this.worldSize,a=(W=o.mercatorYfromLat(We[0])*this.worldSize)-T<Se.y?Se.y/(W-T):0}if(this.lngRange){var Xe=this.lngRange;K=o.mercatorXfromLng(Xe[0])*this.worldSize,u=(ue=o.mercatorXfromLng(Xe[1])*this.worldSize)-K<Se.x?Se.x/(ue-K):0}var Je=this.point,xt=Math.max(u||0,a||0);if(xt)return this.center=this.unproject(new o.Point(u?(ue+K)/2:Je.x,a?(W+T)/2:Je.y)),this.zoom+=this.scaleZoom(xt),this._unmodified=Ie,void(this._constraining=!1);if(this.latRange){var _t=Je.y,Pt=Se.y/2;_t-Pt<T&&(f=T+Pt),_t+Pt>W&&(f=W-Pt)}if(this.lngRange){var ft=Je.x,Ot=Se.x/2;ft-Ot<K&&(s=K+Ot),ft+Ot>ue&&(s=ue-Ot)}s===void 0&&f===void 0||(this.center=this.unproject(new o.Point(s!==void 0?s:Je.x,f!==void 0?f:Je.y))),this._unmodified=Ie,this._constraining=!1}},Ji.prototype._calcMatrices=function(){if(this.height){var a=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,s=this._fov*(.5+a.y/this.height),f=Math.sin(s)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-u-s,.01,Math.PI-.01)),T=this.point,W=T.x,K=T.y,ue=1.01*(Math.cos(Math.PI/2-this._pitch)*f+this.cameraToCenterDistance),Se=this.height/50,Ie=new Float64Array(16);o.perspective(Ie,this._fov,this.width/this.height,Se,ue),Ie[8]=2*-a.x/this.width,Ie[9]=2*a.y/this.height,o.scale(Ie,Ie,[1,-1,1]),o.translate(Ie,Ie,[0,0,-this.cameraToCenterDistance]),o.rotateX(Ie,Ie,this._pitch),o.rotateZ(Ie,Ie,this.angle),o.translate(Ie,Ie,[-W,-K,0]),this.mercatorMatrix=o.scale([],Ie,[this.worldSize,this.worldSize,this.worldSize]),o.scale(Ie,Ie,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Ie,this.invProjMatrix=o.invert([],this.projMatrix);var We=this.width%2/2,Xe=this.height%2/2,Je=Math.cos(this.angle),xt=Math.sin(this.angle),_t=W-Math.round(W)+Je*We+xt*Xe,Pt=K-Math.round(K)+Je*Xe+xt*We,ft=new Float64Array(Ie);if(o.translate(ft,ft,[_t>.5?_t-1:_t,Pt>.5?Pt-1:Pt,0]),this.alignedProjMatrix=ft,Ie=o.create(),o.scale(Ie,Ie,[this.width/2,-this.height/2,1]),o.translate(Ie,Ie,[1,-1,0]),this.labelPlaneMatrix=Ie,Ie=o.create(),o.scale(Ie,Ie,[1,-1,1]),o.translate(Ie,Ie,[-1,-1,0]),o.scale(Ie,Ie,[2/this.width,2/this.height,1]),this.glCoordMatrix=Ie,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Ie=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Ie,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ji.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var a=this.pointCoordinate(new o.Point(0,0)),u=[a.x*this.worldSize,a.y*this.worldSize,0,1];return o.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ji.prototype.getCameraPoint=function(){var a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,a))},Ji.prototype.getCameraQueryGeometry=function(a){var u=this.getCameraPoint();if(a.length===1)return[a[0],u];for(var s=u.x,f=u.y,T=u.x,W=u.y,K=0,ue=a;K<ue.length;K+=1){var Se=ue[K];s=Math.min(s,Se.x),f=Math.min(f,Se.y),T=Math.max(T,Se.x),W=Math.max(W,Se.y)}return[new o.Point(s,f),new o.Point(T,f),new o.Point(T,W),new o.Point(s,W),new o.Point(s,f)]},Object.defineProperties(Ji.prototype,Ia);var qo=function(a){var u,s,f,T;this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),s=!1,f=null,T=function(){f=null,s&&(u(),f=setTimeout(T,300),s=!1)},function(){return s=!0,f||T(),f})};qo.prototype.addTo=function(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},qo.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},qo.prototype.getHashString=function(a){var u=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,f=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,f),W=Math.round(u.lng*T)/T,K=Math.round(u.lat*T)/T,ue=this._map.getBearing(),Se=this._map.getPitch(),Ie="";if(Ie+=a?"/"+W+"/"+K+"/"+s:s+"/"+K+"/"+W,(ue||Se)&&(Ie+="/"+Math.round(10*ue)/10),Se&&(Ie+="/"+Math.round(Se)),this._hashName){var We=this._hashName,Xe=!1,Je=o.window.location.hash.slice(1).split("&").map(function(xt){var _t=xt.split("=")[0];return _t===We?(Xe=!0,_t+"="+Ie):xt}).filter(function(xt){return xt});return Xe||Je.push(We+"="+Ie),"#"+Je.join("&")}return"#"+Ie},qo.prototype._getCurrentHash=function(){var a,u=this,s=o.window.location.hash.replace("#","");return this._hashName?(s.split("&").map(function(f){return f.split("=")}).forEach(function(f){f[0]===u._hashName&&(a=f)}),(a&&a[1]||"").split("/")):s.split("/")},qo.prototype._onHashChange=function(){var a=this._getCurrentHash();if(a.length>=3&&!a.some(function(s){return isNaN(s)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0}return!1},qo.prototype._updateHashUnthrottled=function(){var a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,a)}catch(u){}};var ou={linearity:.3,easing:o.bezier(0,0,.3,1)},Du=o.extend({deceleration:2500,maxSpeed:1400},ou),bu=o.extend({deceleration:20,maxSpeed:1400},ou),mc=o.extend({deceleration:1e3,maxSpeed:360},ou),tc=o.extend({deceleration:1e3,maxSpeed:90},ou),Qu=function(a){this._map=a,this.clear()};function ml(a,u){(!a.duration||a.duration<u.duration)&&(a.duration=u.duration,a.easing=u.easing)}function Fs(a,u,s){var f=s.maxSpeed,T=s.linearity,W=s.deceleration,K=o.clamp(a*T/(u/1e3),-f,f),ue=Math.abs(K)/(W*T);return{easing:s.easing,duration:1e3*ue,amount:K*(ue/2)}}Qu.prototype.clear=function(){this._inertiaBuffer=[]},Qu.prototype.record=function(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:a})},Qu.prototype._drainInertiaBuffer=function(){for(var a=this._inertiaBuffer,u=o.browser.now();a.length>0&&u-a[0].time>160;)a.shift()},Qu.prototype._onMoveEnd=function(a){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},s=0,f=this._inertiaBuffer;s<f.length;s+=1){var T=f[s].settings;u.zoom+=T.zoomDelta||0,u.bearing+=T.bearingDelta||0,u.pitch+=T.pitchDelta||0,T.panDelta&&u.pan._add(T.panDelta),T.around&&(u.around=T.around),T.pinchAround&&(u.pinchAround=T.pinchAround)}var W=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,K={};if(u.pan.mag()){var ue=Fs(u.pan.mag(),W,o.extend({},Du,a||{}));K.offset=u.pan.mult(ue.amount/u.pan.mag()),K.center=this._map.transform.center,ml(K,ue)}if(u.zoom){var Se=Fs(u.zoom,W,bu);K.zoom=this._map.transform.zoom+Se.amount,ml(K,Se)}if(u.bearing){var Ie=Fs(u.bearing,W,mc);K.bearing=this._map.transform.bearing+o.clamp(Ie.amount,-179,179),ml(K,Ie)}if(u.pitch){var We=Fs(u.pitch,W,tc);K.pitch=this._map.transform.pitch+We.amount,ml(K,We)}if(K.zoom||K.bearing){var Xe=u.pinchAround===void 0?u.around:u.pinchAround;K.around=Xe?this._map.unproject(Xe):this._map.getCenter()}return this.clear(),o.extend(K,{noMoveStart:!0})}};var fo=function(a){function u(f,T,W,K){K===void 0&&(K={});var ue=_.mousePos(T.getCanvasContainer(),W),Se=T.unproject(ue);a.call(this,f,o.extend({point:ue,lngLat:Se,originalEvent:W},K)),this._defaultPrevented=!1,this.target=T}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var s={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},s.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,s),u}(o.Event),su=function(a){function u(f,T,W){var K=f==="touchend"?W.changedTouches:W.touches,ue=_.touchPos(T.getCanvasContainer(),K),Se=ue.map(function(Xe){return T.unproject(Xe)}),Ie=ue.reduce(function(Xe,Je,xt,_t){return Xe.add(Je.div(_t.length))},new o.Point(0,0)),We=T.unproject(Ie);a.call(this,f,{points:ue,point:Ie,lngLats:Se,lngLat:We,originalEvent:W}),this._defaultPrevented=!1}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var s={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},s.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,s),u}(o.Event),Fl=function(a){function u(f,T,W){a.call(this,f,{originalEvent:W}),this._defaultPrevented=!1}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var s={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},s.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,s),u}(o.Event),Ka=function(a,u){this._map=a,this._clickTolerance=u.clickTolerance};Ka.prototype.reset=function(){delete this._mousedownPos},Ka.prototype.wheel=function(a){return this._firePreventable(new Fl(a.type,this._map,a))},Ka.prototype.mousedown=function(a,u){return this._mousedownPos=u,this._firePreventable(new fo(a.type,this._map,a))},Ka.prototype.mouseup=function(a){this._map.fire(new fo(a.type,this._map,a))},Ka.prototype.click=function(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new fo(a.type,this._map,a))},Ka.prototype.dblclick=function(a){return this._firePreventable(new fo(a.type,this._map,a))},Ka.prototype.mouseover=function(a){this._map.fire(new fo(a.type,this._map,a))},Ka.prototype.mouseout=function(a){this._map.fire(new fo(a.type,this._map,a))},Ka.prototype.touchstart=function(a){return this._firePreventable(new su(a.type,this._map,a))},Ka.prototype.touchmove=function(a){this._map.fire(new su(a.type,this._map,a))},Ka.prototype.touchend=function(a){this._map.fire(new su(a.type,this._map,a))},Ka.prototype.touchcancel=function(a){this._map.fire(new su(a.type,this._map,a))},Ka.prototype._firePreventable=function(a){if(this._map.fire(a),a.defaultPrevented)return{}},Ka.prototype.isEnabled=function(){return!0},Ka.prototype.isActive=function(){return!1},Ka.prototype.enable=function(){},Ka.prototype.disable=function(){};var Sn=function(a){this._map=a};Sn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Sn.prototype.mousemove=function(a){this._map.fire(new fo(a.type,this._map,a))},Sn.prototype.mousedown=function(){this._delayContextMenu=!0},Sn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Sn.prototype.contextmenu=function(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new fo(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()},Sn.prototype.isEnabled=function(){return!0},Sn.prototype.isActive=function(){return!1},Sn.prototype.enable=function(){},Sn.prototype.disable=function(){};var Io=function(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1};function uu(a,u){for(var s={},f=0;f<a.length;f++)s[a[f].identifier]=u[f];return s}Io.prototype.isEnabled=function(){return!!this._enabled},Io.prototype.isActive=function(){return!!this._active},Io.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Io.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Io.prototype.mousedown=function(a,u){this.isEnabled()&&a.shiftKey&&a.button===0&&(_.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Io.prototype.mousemoveWindow=function(a,u){if(this._active){var s=u;if(!(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)){var f=this._startPos;this._lastPos=s,this._box||(this._box=_.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));var T=Math.min(f.x,s.x),W=Math.max(f.x,s.x),K=Math.min(f.y,s.y),ue=Math.max(f.y,s.y);_.setTransform(this._box,"translate("+T+"px,"+K+"px)"),this._box.style.width=W-T+"px",this._box.style.height=ue-K+"px"}}},Io.prototype.mouseupWindow=function(a,u){var s=this;if(this._active&&a.button===0){var f=this._startPos,T=u;if(this.reset(),_.suppressClick(),f.x!==T.x||f.y!==T.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:function(W){return W.fitScreenCoordinates(f,T,s._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",a)}},Io.prototype.keydown=function(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))},Io.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos},Io.prototype._fireEvent=function(a,u){return this._map.fire(new o.Event(a,{originalEvent:u}))};var cs=function(a){this.reset(),this.numTouches=a.numTouches};cs.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},cs.prototype.touchstart=function(a,u,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),s.length===this.numTouches&&(this.centroid=function(f){for(var T=new o.Point(0,0),W=0,K=f;W<K.length;W+=1)T._add(K[W]);return T.div(f.length)}(u),this.touches=uu(s,u)))},cs.prototype.touchmove=function(a,u,s){if(!this.aborted&&this.centroid){var f=uu(s,u);for(var T in this.touches){var W=f[T];(!W||W.dist(this.touches[T])>30)&&(this.aborted=!0)}}},cs.prototype.touchend=function(a,u,s){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){var f=!this.aborted&&this.centroid;if(this.reset(),f)return f}};var xs=function(a){this.singleTap=new cs(a),this.numTaps=a.numTaps,this.reset()};xs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},xs.prototype.touchstart=function(a,u,s){this.singleTap.touchstart(a,u,s)},xs.prototype.touchmove=function(a,u,s){this.singleTap.touchmove(a,u,s)},xs.prototype.touchend=function(a,u,s){var f=this.singleTap.touchend(a,u,s);if(f){var T=a.timeStamp-this.lastTime<500,W=!this.lastTap||this.lastTap.dist(f)<30;if(T&&W||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}};var jo=function(){this._zoomIn=new xs({numTouches:1,numTaps:2}),this._zoomOut=new xs({numTouches:2,numTaps:1}),this.reset()};jo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},jo.prototype.touchstart=function(a,u,s){this._zoomIn.touchstart(a,u,s),this._zoomOut.touchstart(a,u,s)},jo.prototype.touchmove=function(a,u,s){this._zoomIn.touchmove(a,u,s),this._zoomOut.touchmove(a,u,s)},jo.prototype.touchend=function(a,u,s){var f=this,T=this._zoomIn.touchend(a,u,s),W=this._zoomOut.touchend(a,u,s);return T?(this._active=!0,a.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(K){return K.easeTo({duration:300,zoom:K.getZoom()+1,around:K.unproject(T)},{originalEvent:a})}}):W?(this._active=!0,a.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(K){return K.easeTo({duration:300,zoom:K.getZoom()-1,around:K.unproject(W)},{originalEvent:a})}}):void 0},jo.prototype.touchcancel=function(){this.reset()},jo.prototype.enable=function(){this._enabled=!0},jo.prototype.disable=function(){this._enabled=!1,this.reset()},jo.prototype.isEnabled=function(){return this._enabled},jo.prototype.isActive=function(){return this._active};var qu={0:1,2:2},pn=function(a){this.reset(),this._clickTolerance=a.clickTolerance||1};pn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},pn.prototype._correctButton=function(a,u){return!1},pn.prototype._move=function(a,u){return{}},pn.prototype.mousedown=function(a,u){if(!this._lastPoint){var s=_.mouseButton(a);this._correctButton(a,s)&&(this._lastPoint=u,this._eventButton=s)}},pn.prototype.mousemoveWindow=function(a,u){var s=this._lastPoint;if(s){if(a.preventDefault(),function(f,T){var W=qu[T];return f.buttons===void 0||(f.buttons&W)!==W}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(s)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(s,u)}},pn.prototype.mouseupWindow=function(a){this._lastPoint&&_.mouseButton(a)===this._eventButton&&(this._moved&&_.suppressClick(),this.reset())},pn.prototype.enable=function(){this._enabled=!0},pn.prototype.disable=function(){this._enabled=!1,this.reset()},pn.prototype.isEnabled=function(){return this._enabled},pn.prototype.isActive=function(){return this._active};var Nl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.mousedown=function(s,f){a.prototype.mousedown.call(this,s,f),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(s,f){return f===0&&!s.ctrlKey},u.prototype._move=function(s,f){return{around:f,panDelta:f.sub(s)}},u}(pn),Ns=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._correctButton=function(s,f){return f===0&&s.ctrlKey||f===2},u.prototype._move=function(s,f){var T=.8*(f.x-s.x);if(T)return this._active=!0,{bearingDelta:T}},u.prototype.contextmenu=function(s){s.preventDefault()},u}(pn),io=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._correctButton=function(s,f){return f===0&&s.ctrlKey||f===2},u.prototype._move=function(s,f){var T=-.5*(f.y-s.y);if(T)return this._active=!0,{pitchDelta:T}},u.prototype.contextmenu=function(s){s.preventDefault()},u}(pn),fs=function(a){this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset()};fs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},fs.prototype.touchstart=function(a,u,s){return this._calculateTransform(a,u,s)},fs.prototype.touchmove=function(a,u,s){if(this._active&&!(s.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,u,s)},fs.prototype.touchend=function(a,u,s){this._calculateTransform(a,u,s),this._active&&s.length<this._minTouches&&this.reset()},fs.prototype.touchcancel=function(){this.reset()},fs.prototype._calculateTransform=function(a,u,s){s.length>0&&(this._active=!0);var f=uu(s,u),T=new o.Point(0,0),W=new o.Point(0,0),K=0;for(var ue in f){var Se=f[ue],Ie=this._touches[ue];Ie&&(T._add(Se),W._add(Se.sub(Ie)),K++,f[ue]=Se)}if(this._touches=f,!(K<this._minTouches)&&W.mag()){var We=W.div(K);if(this._sum._add(We),!(this._sum.mag()<this._clickTolerance))return{around:T.div(K),panDelta:We}}},fs.prototype.enable=function(){this._enabled=!0},fs.prototype.disable=function(){this._enabled=!1,this.reset()},fs.prototype.isEnabled=function(){return this._enabled},fs.prototype.isActive=function(){return this._active};var Uo=function(){this.reset()};function Rs(a,u,s){for(var f=0;f<a.length;f++)if(a[f].identifier===s)return u[f]}function Su(a,u){return Math.log(a/u)/Math.LN2}Uo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Uo.prototype._start=function(a){},Uo.prototype._move=function(a,u,s){return{}},Uo.prototype.touchstart=function(a,u,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([u[0],u[1]]))},Uo.prototype.touchmove=function(a,u,s){if(this._firstTwoTouches){a.preventDefault();var f=this._firstTwoTouches,T=f[1],W=Rs(s,u,f[0]),K=Rs(s,u,T);if(W&&K){var ue=this._aroundCenter?null:W.add(K).div(2);return this._move([W,K],ue,a)}}},Uo.prototype.touchend=function(a,u,s){if(this._firstTwoTouches){var f=this._firstTwoTouches,T=f[1],W=Rs(s,u,f[0]),K=Rs(s,u,T);W&&K||(this._active&&_.suppressClick(),this.reset())}},Uo.prototype.touchcancel=function(){this.reset()},Uo.prototype.enable=function(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"},Uo.prototype.disable=function(){this._enabled=!1,this.reset()},Uo.prototype.isEnabled=function(){return this._enabled},Uo.prototype.isActive=function(){return this._active};var es=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.reset=function(){a.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(s){this._startDistance=this._distance=s[0].dist(s[1])},u.prototype._move=function(s,f){var T=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Su(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Su(this._distance,T),pinchAround:f}},u}(Uo);function q(a,u){return 180*a.angleWith(u)/Math.PI}var Oe=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.reset=function(){a.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])},u.prototype._move=function(s,f){var T=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:q(this._vector,T),pinchAround:f}},u.prototype._isBelowThreshold=function(s){this._minDiameter=Math.min(this._minDiameter,s.mag());var f=25/(Math.PI*this._minDiameter)*360,T=q(s,this._startVector);return Math.abs(T)<f},u}(Uo);function vt(a){return Math.abs(a.y)>Math.abs(a.x)}var ht=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.reset=function(){a.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(s){this._lastPoints=s,vt(s[0].sub(s[1]))&&(this._valid=!1)},u.prototype._move=function(s,f,T){var W=s[0].sub(this._lastPoints[0]),K=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(W,K,T.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:(W.y+K.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(s,f,T){if(this._valid!==void 0)return this._valid;var W=s.mag()>=2,K=f.mag()>=2;if(W||K){if(!W||!K)return this._firstMove===void 0&&(this._firstMove=T),T-this._firstMove<100&&void 0;var ue=s.y>0==f.y>0;return vt(s)&&vt(f)&&ue}},u}(Uo),cr={panStep:100,bearingStep:15,pitchStep:10},Qt=function(){var a=cr;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1};function hr(a){return a*(2-a)}Qt.prototype.reset=function(){this._active=!1},Qt.prototype.keydown=function(a){var u=this;if(!(a.altKey||a.ctrlKey||a.metaKey)){var s=0,f=0,T=0,W=0,K=0;switch(a.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:a.shiftKey?f=-1:(a.preventDefault(),W=-1);break;case 39:a.shiftKey?f=1:(a.preventDefault(),W=1);break;case 38:a.shiftKey?T=1:(a.preventDefault(),K=-1);break;case 40:a.shiftKey?T=-1:(a.preventDefault(),K=1);break;default:return}return this._rotationDisabled&&(f=0,T=0),{cameraAnimation:function(ue){var Se=ue.getZoom();ue.easeTo({duration:300,easeId:"keyboardHandler",easing:hr,zoom:s?Math.round(Se)+s*(a.shiftKey?2:1):Se,bearing:ue.getBearing()+f*u._bearingStep,pitch:ue.getPitch()+T*u._pitchStep,offset:[-W*u._panStep,-K*u._panStep],center:ue.getCenter()},{originalEvent:a})}}}},Qt.prototype.enable=function(){this._enabled=!0},Qt.prototype.disable=function(){this._enabled=!1,this.reset()},Qt.prototype.isEnabled=function(){return this._enabled},Qt.prototype.isActive=function(){return this._active},Qt.prototype.disableRotation=function(){this._rotationDisabled=!0},Qt.prototype.enableRotation=function(){this._rotationDisabled=!1};var nr=function(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};nr.prototype.setZoomRate=function(a){this._defaultZoomRate=a},nr.prototype.setWheelZoomRate=function(a){this._wheelZoomRate=a},nr.prototype.isEnabled=function(){return!!this._enabled},nr.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},nr.prototype.isZooming=function(){return!!this._zooming},nr.prototype.enable=function(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&a.around==="center")},nr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},nr.prototype.wheel=function(a){if(this.isEnabled()){var u=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,s=o.browser.now(),f=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(f*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}},nr.prototype._onTimeout=function(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},nr.prototype._start=function(a){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=_.mousePos(this._el,a);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},nr.prototype.renderFrame=function(){var a=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var s=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,f=2/(1+Math.exp(-Math.abs(this._delta*s)));this._delta<0&&f!==0&&(f=1/f);var T=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(T*f))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var W,K=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,ue=this._startZoom,Se=this._easing,Ie=!1;if(this._type==="wheel"&&ue&&Se){var We=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),Xe=Se(We);W=o.number(ue,K,Xe),We<1?this._frameId||(this._frameId=!0):Ie=!0}else W=K,Ie=!0;return this._active=!0,Ie&&(this._active=!1,this._finishTimeout=setTimeout(function(){a._zooming=!1,a._handler._triggerRenderFrame(),delete a._targetZoom,delete a._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Ie,zoomDelta:W-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},nr.prototype._smoothOutEasing=function(a){var u=o.ease;if(this._prevEase){var s=this._prevEase,f=(o.browser.now()-s.start)/s.duration,T=s.easing(f+.01)-s.easing(f),W=.27/Math.sqrt(T*T+1e-4)*.01,K=Math.sqrt(.0729-W*W);u=o.bezier(W,K,.25,1)}return this._prevEase={start:o.browser.now(),duration:a,easing:u},u},nr.prototype.reset=function(){this._active=!1};var Dr=function(a,u){this._clickZoom=a,this._tapZoom=u};Dr.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Dr.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Dr.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Dr.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var An=function(){this.reset()};An.prototype.reset=function(){this._active=!1},An.prototype.dblclick=function(a,u){return a.preventDefault(),{cameraAnimation:function(s){s.easeTo({duration:300,zoom:s.getZoom()+(a.shiftKey?-1:1),around:s.unproject(u)},{originalEvent:a})}}},An.prototype.enable=function(){this._enabled=!0},An.prototype.disable=function(){this._enabled=!1,this.reset()},An.prototype.isEnabled=function(){return this._enabled},An.prototype.isActive=function(){return this._active};var Bn=function(){this._tap=new xs({numTouches:1,numTaps:1}),this.reset()};Bn.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Bn.prototype.touchstart=function(a,u,s){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?s.length>0&&(this._swipePoint=u[0],this._swipeTouch=s[0].identifier):this._tap.touchstart(a,u,s))},Bn.prototype.touchmove=function(a,u,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;var f=u[0],T=f.y-this._swipePoint.y;return this._swipePoint=f,a.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(a,u,s)},Bn.prototype.touchend=function(a,u,s){this._tapTime?this._swipePoint&&s.length===0&&this.reset():this._tap.touchend(a,u,s)&&(this._tapTime=a.timeStamp)},Bn.prototype.touchcancel=function(){this.reset()},Bn.prototype.enable=function(){this._enabled=!0},Bn.prototype.disable=function(){this._enabled=!1,this.reset()},Bn.prototype.isEnabled=function(){return this._enabled},Bn.prototype.isActive=function(){return this._active};var Ln=function(a,u,s){this._el=a,this._mousePan=u,this._touchPan=s};Ln.prototype.enable=function(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ln.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ln.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ln.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Wn=function(a,u,s){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=s};Wn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Wn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Wn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Wn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ri=function(a,u,s,f){this._el=a,this._touchZoom=u,this._touchRotate=s,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0};ri.prototype.enable=function(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ri.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ri.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ri.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ri.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ri.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ta=function(a){return a.zoom||a.drag||a.pitch||a.rotate},Da=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(o.Event);function gn(a){return a.panDelta&&a.panDelta.mag()||a.zoomDelta||a.bearingDelta||a.pitchDelta}var yn=function(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qu(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),o.bindAll(["handleEvent","handleWindowEvent"],this);var s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[o.window,"blur",void 0]];for(var f=0,T=this._listeners;f<T.length;f+=1){var W=T[f],K=W[0];_.addEventListener(K,W[1],K===o.window.document?this.handleWindowEvent:this.handleEvent,W[2])}};yn.prototype.destroy=function(){for(var a=0,u=this._listeners;a<u.length;a+=1){var s=u[a],f=s[0];_.removeEventListener(f,s[1],f===o.window.document?this.handleWindowEvent:this.handleEvent,s[2])}},yn.prototype._addDefaultHandlers=function(a){var u=this._map,s=u.getCanvasContainer();this._add("mapEvent",new Ka(u,a));var f=u.boxZoom=new Io(u,a);this._add("boxZoom",f);var T=new jo,W=new An;u.doubleClickZoom=new Dr(W,T),this._add("tapZoom",T),this._add("clickZoom",W);var K=new Bn;this._add("tapDragZoom",K);var ue=u.touchPitch=new ht;this._add("touchPitch",ue);var Se=new Ns(a),Ie=new io(a);u.dragRotate=new Wn(a,Se,Ie),this._add("mouseRotate",Se,["mousePitch"]),this._add("mousePitch",Ie,["mouseRotate"]);var We=new Nl(a),Xe=new fs(a);u.dragPan=new Ln(s,We,Xe),this._add("mousePan",We),this._add("touchPan",Xe,["touchZoom","touchRotate"]);var Je=new Oe,xt=new es;u.touchZoomRotate=new ri(s,xt,Je,K),this._add("touchRotate",Je,["touchPan","touchZoom"]),this._add("touchZoom",xt,["touchPan","touchRotate"]);var _t=u.scrollZoom=new nr(u,this);this._add("scrollZoom",_t,["mousePan"]);var Pt=u.keyboard=new Qt;this._add("keyboard",Pt),this._add("blockableMapEvent",new Sn(u));for(var ft=0,Ot=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ft<Ot.length;ft+=1){var jt=Ot[ft];a.interactive&&a[jt]&&u[jt].enable(a[jt])}},yn.prototype._add=function(a,u,s){this._handlers.push({handlerName:a,handler:u,allowed:s}),this._handlersById[a]=u},yn.prototype.stop=function(a){if(!this._updatingCamera){for(var u=0,s=this._handlers;u<s.length;u+=1)s[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}},yn.prototype.isActive=function(){for(var a=0,u=this._handlers;a<u.length;a+=1)if(u[a].handler.isActive())return!0;return!1},yn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},yn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},yn.prototype.isMoving=function(){return Boolean(ta(this._eventsInProgress))||this.isZooming()},yn.prototype._blockedByActive=function(a,u,s){for(var f in a)if(f!==s&&(!u||u.indexOf(f)<0))return!0;return!1},yn.prototype.handleWindowEvent=function(a){this.handleEvent(a,a.type+"Window")},yn.prototype._getMapTouches=function(a){for(var u=[],s=0,f=a;s<f.length;s+=1){var T=f[s];this._el.contains(T.target)&&u.push(T)}return u},yn.prototype.handleEvent=function(a,u){if(a.type!=="blur"){this._updatingCamera=!0;for(var s=a.type==="renderFrame"?void 0:a,f={needsRenderFrame:!1},T={},W={},K=a.touches?this._getMapTouches(a.touches):void 0,ue=K?_.touchPos(this._el,K):_.mousePos(this._el,a),Se=0,Ie=this._handlers;Se<Ie.length;Se+=1){var We=Ie[Se],Xe=We.handlerName,Je=We.handler,xt=We.allowed;if(Je.isEnabled()){var _t=void 0;this._blockedByActive(W,xt,Xe)?Je.reset():Je[u||a.type]&&(_t=Je[u||a.type](a,ue,K),this.mergeHandlerResult(f,T,_t,Xe,s),_t&&_t.needsRenderFrame&&this._triggerRenderFrame()),(_t||Je.isActive())&&(W[Xe]=Je)}}var Pt={};for(var ft in this._previousActiveHandlers)W[ft]||(Pt[ft]=s);this._previousActiveHandlers=W,(Object.keys(Pt).length||gn(f))&&(this._changes.push([f,T,Pt]),this._triggerRenderFrame()),(Object.keys(W).length||gn(f))&&this._map._stop(!0),this._updatingCamera=!1;var Ot=f.cameraAnimation;Ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ot(this._map))}else this.stop(!0)},yn.prototype.mergeHandlerResult=function(a,u,s,f,T){if(s){o.extend(a,s);var W={handlerName:f,originalEvent:s.originalEvent||T};s.zoomDelta!==void 0&&(u.zoom=W),s.panDelta!==void 0&&(u.drag=W),s.pitchDelta!==void 0&&(u.pitch=W),s.bearingDelta!==void 0&&(u.rotate=W)}},yn.prototype._applyChanges=function(){for(var a={},u={},s={},f=0,T=this._changes;f<T.length;f+=1){var W=T[f],K=W[0],ue=W[1],Se=W[2];K.panDelta&&(a.panDelta=(a.panDelta||new o.Point(0,0))._add(K.panDelta)),K.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+K.zoomDelta),K.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+K.bearingDelta),K.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+K.pitchDelta),K.around!==void 0&&(a.around=K.around),K.pinchAround!==void 0&&(a.pinchAround=K.pinchAround),K.noInertia&&(a.noInertia=K.noInertia),o.extend(u,ue),o.extend(s,Se)}this._updateMapTransform(a,u,s),this._changes=[]},yn.prototype._updateMapTransform=function(a,u,s){var f=this._map,T=f.transform;if(!gn(a))return this._fireEvents(u,s,!0);var W=a.panDelta,K=a.zoomDelta,ue=a.bearingDelta,Se=a.pitchDelta,Ie=a.around,We=a.pinchAround;We!==void 0&&(Ie=We),f._stop(!0),Ie=Ie||f.transform.centerPoint;var Xe=T.pointLocation(W?Ie.sub(W):Ie);ue&&(T.bearing+=ue),Se&&(T.pitch+=Se),K&&(T.zoom+=K),T.setLocationAtPoint(Xe,Ie),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,s,!0)},yn.prototype._fireEvents=function(a,u,s){var f=this,T=ta(this._eventsInProgress),W=ta(a),K={};for(var ue in a)this._eventsInProgress[ue]||(K[ue+"start"]=a[ue].originalEvent),this._eventsInProgress[ue]=a[ue];for(var Se in!T&&W&&this._fireEvent("movestart",W.originalEvent),K)this._fireEvent(Se,K[Se]);for(var Ie in W&&this._fireEvent("move",W.originalEvent),a)this._fireEvent(Ie,a[Ie].originalEvent);var We,Xe={};for(var Je in this._eventsInProgress){var xt=this._eventsInProgress[Je],_t=xt.handlerName,Pt=xt.originalEvent;this._handlersById[_t].isActive()||(delete this._eventsInProgress[Je],Xe[Je+"end"]=We=u[_t]||Pt)}for(var ft in Xe)this._fireEvent(ft,Xe[ft]);var Ot=ta(this._eventsInProgress);if(s&&(T||W)&&!Ot){this._updatingCamera=!0;var jt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),er=function(br){return br!==0&&-f._bearingSnap<br&&br<f._bearingSnap};jt?(er(jt.bearing||this._map.getBearing())&&(jt.bearing=0),this._map.easeTo(jt,{originalEvent:We})):(this._map.fire(new o.Event("moveend",{originalEvent:We})),er(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},yn.prototype._fireEvent=function(a,u){this._map.fire(new o.Event(a,u?{originalEvent:u}:{}))},yn.prototype._requestFrame=function(){var a=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete a._frameId,a.handleEvent(new Da("renderFrame",{timeStamp:u})),a._applyChanges()})},yn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var yo=function(a){function u(s,f){a.call(this),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=f.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(s,f){return this.jumpTo({center:s},f)},u.prototype.panBy=function(s,f,T){return s=o.Point.convert(s).mult(-1),this.panTo(this.transform.center,o.extend({offset:s},f),T)},u.prototype.panTo=function(s,f,T){return this.easeTo(o.extend({center:s},f),T)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(s,f){return this.jumpTo({zoom:s},f),this},u.prototype.zoomTo=function(s,f,T){return this.easeTo(o.extend({zoom:s},f),T)},u.prototype.zoomIn=function(s,f){return this.zoomTo(this.getZoom()+1,s,f),this},u.prototype.zoomOut=function(s,f){return this.zoomTo(this.getZoom()-1,s,f),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(s,f){return this.jumpTo({bearing:s},f),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(s,f){return this.jumpTo({padding:s},f),this},u.prototype.rotateTo=function(s,f,T){return this.easeTo(o.extend({bearing:s},f),T)},u.prototype.resetNorth=function(s,f){return this.rotateTo(0,o.extend({duration:1e3},s),f),this},u.prototype.resetNorthPitch=function(s,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},s),f),this},u.prototype.snapToNorth=function(s,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,f):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(s,f){return this.jumpTo({pitch:s},f),this},u.prototype.cameraForBounds=function(s,f){s=o.LngLatBounds.convert(s);var T=f&&f.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),T,f)},u.prototype._cameraForBoxAndBearing=function(s,f,T,W){var K={top:0,bottom:0,right:0,left:0};if(typeof(W=o.extend({padding:K,offset:[0,0],maxZoom:this.transform.maxZoom},W)).padding=="number"){var ue=W.padding;W.padding={top:ue,bottom:ue,right:ue,left:ue}}W.padding=o.extend(K,W.padding);var Se=this.transform,Ie=Se.padding,We=Se.project(o.LngLat.convert(s)),Xe=Se.project(o.LngLat.convert(f)),Je=We.rotate(-T*Math.PI/180),xt=Xe.rotate(-T*Math.PI/180),_t=new o.Point(Math.max(Je.x,xt.x),Math.max(Je.y,xt.y)),Pt=new o.Point(Math.min(Je.x,xt.x),Math.min(Je.y,xt.y)),ft=_t.sub(Pt),Ot=(Se.width-(Ie.left+Ie.right+W.padding.left+W.padding.right))/ft.x,jt=(Se.height-(Ie.top+Ie.bottom+W.padding.top+W.padding.bottom))/ft.y;if(!(jt<0||Ot<0)){var er=Math.min(Se.scaleZoom(Se.scale*Math.min(Ot,jt)),W.maxZoom),br=typeof W.offset.x=="number"?new o.Point(W.offset.x,W.offset.y):o.Point.convert(W.offset),yr=new o.Point((W.padding.left-W.padding.right)/2,(W.padding.top-W.padding.bottom)/2).rotate(T*Math.PI/180),Cr=br.add(yr).mult(Se.scale/Se.zoomScale(er));return{center:Se.unproject(We.add(Xe).div(2).sub(Cr)),zoom:er,bearing:T}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(s,f,T){return this._fitInternal(this.cameraForBounds(s,f),f,T)},u.prototype.fitScreenCoordinates=function(s,f,T,W,K){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(s)),this.transform.pointLocation(o.Point.convert(f)),T,W),W,K)},u.prototype._fitInternal=function(s,f,T){return s?(delete(f=o.extend(s,f)).padding,f.linear?this.easeTo(f,T):this.flyTo(f,T)):this},u.prototype.jumpTo=function(s,f){this.stop();var T=this.transform,W=!1,K=!1,ue=!1;return"zoom"in s&&T.zoom!==+s.zoom&&(W=!0,T.zoom=+s.zoom),s.center!==void 0&&(T.center=o.LngLat.convert(s.center)),"bearing"in s&&T.bearing!==+s.bearing&&(K=!0,T.bearing=+s.bearing),"pitch"in s&&T.pitch!==+s.pitch&&(ue=!0,T.pitch=+s.pitch),s.padding==null||T.isPaddingEqual(s.padding)||(T.padding=s.padding),this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),W&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),K&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),ue&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f))},u.prototype.easeTo=function(s,f){var T=this;this._stop(!1,s.easeId),((s=o.extend({offset:[0,0],duration:500,easing:o.ease},s)).animate===!1||!s.essential&&o.browser.prefersReducedMotion)&&(s.duration=0);var W=this.transform,K=this.getZoom(),ue=this.getBearing(),Se=this.getPitch(),Ie=this.getPadding(),We="zoom"in s?+s.zoom:K,Xe="bearing"in s?this._normalizeBearing(s.bearing,ue):ue,Je="pitch"in s?+s.pitch:Se,xt="padding"in s?s.padding:W.padding,_t=o.Point.convert(s.offset),Pt=W.centerPoint.add(_t),ft=W.pointLocation(Pt),Ot=o.LngLat.convert(s.center||ft);this._normalizeCenter(Ot);var jt,er,br=W.project(ft),yr=W.project(Ot).sub(br),Cr=W.zoomScale(We-K);s.around&&(jt=o.LngLat.convert(s.around),er=W.locationPoint(jt));var zr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||We!==K,this._rotating=this._rotating||ue!==Xe,this._pitching=this._pitching||Je!==Se,this._padding=!W.isPaddingEqual(xt),this._easeId=s.easeId,this._prepareEase(f,s.noMoveStart,zr),this._ease(function(un){if(T._zooming&&(W.zoom=o.number(K,We,un)),T._rotating&&(W.bearing=o.number(ue,Xe,un)),T._pitching&&(W.pitch=o.number(Se,Je,un)),T._padding&&(W.interpolatePadding(Ie,xt,un),Pt=W.centerPoint.add(_t)),jt)W.setLocationAtPoint(jt,er);else{var qr=W.zoomScale(W.zoom-K),Dn=We>K?Math.min(2,Cr):Math.max(.5,Cr),$n=Math.pow(Dn,1-un),Jn=W.unproject(br.add(yr.mult(un*$n)).mult(qr));W.setLocationAtPoint(W.renderWorldCopies?Jn.wrap():Jn,Pt)}T._fireMoveEvents(f)},function(un){T._afterEase(f,un)},s),this},u.prototype._prepareEase=function(s,f,T){T===void 0&&(T={}),this._moving=!0,f||T.moving||this.fire(new o.Event("movestart",s)),this._zooming&&!T.zooming&&this.fire(new o.Event("zoomstart",s)),this._rotating&&!T.rotating&&this.fire(new o.Event("rotatestart",s)),this._pitching&&!T.pitching&&this.fire(new o.Event("pitchstart",s))},u.prototype._fireMoveEvents=function(s){this.fire(new o.Event("move",s)),this._zooming&&this.fire(new o.Event("zoom",s)),this._rotating&&this.fire(new o.Event("rotate",s)),this._pitching&&this.fire(new o.Event("pitch",s))},u.prototype._afterEase=function(s,f){if(!this._easeId||!f||this._easeId!==f){delete this._easeId;var T=this._zooming,W=this._rotating,K=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,T&&this.fire(new o.Event("zoomend",s)),W&&this.fire(new o.Event("rotateend",s)),K&&this.fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s))}},u.prototype.flyTo=function(s,f){var T=this;if(!s.essential&&o.browser.prefersReducedMotion){var W=o.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(W,f)}this.stop(),s=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},s);var K=this.transform,ue=this.getZoom(),Se=this.getBearing(),Ie=this.getPitch(),We=this.getPadding(),Xe="zoom"in s?o.clamp(+s.zoom,K.minZoom,K.maxZoom):ue,Je="bearing"in s?this._normalizeBearing(s.bearing,Se):Se,xt="pitch"in s?+s.pitch:Ie,_t="padding"in s?s.padding:K.padding,Pt=K.zoomScale(Xe-ue),ft=o.Point.convert(s.offset),Ot=K.centerPoint.add(ft),jt=K.pointLocation(Ot),er=o.LngLat.convert(s.center||jt);this._normalizeCenter(er);var br=K.project(jt),yr=K.project(er).sub(br),Cr=s.curve,zr=Math.max(K.width,K.height),un=zr/Pt,qr=yr.mag();if("minZoom"in s){var Dn=o.clamp(Math.min(s.minZoom,ue,Xe),K.minZoom,K.maxZoom),$n=zr/K.zoomScale(Dn-ue);Cr=Math.sqrt($n/qr*2)}var Jn=Cr*Cr;function ii(pi){var li=(un*un-zr*zr+(pi?-1:1)*Jn*Jn*qr*qr)/(2*(pi?un:zr)*Jn*qr);return Math.log(Math.sqrt(li*li+1)-li)}function qi(pi){return(Math.exp(pi)-Math.exp(-pi))/2}function zn(pi){return(Math.exp(pi)+Math.exp(-pi))/2}var di=ii(0),Bi=function(pi){return zn(di)/zn(di+Cr*pi)},bi=function(pi){return zr*((zn(di)*(qi(li=di+Cr*pi)/zn(li))-qi(di))/Jn)/qr;var li},gi=(ii(1)-di)/Cr;if(Math.abs(qr)<1e-6||!isFinite(gi)){if(Math.abs(zr-un)<1e-6)return this.easeTo(s,f);var Di=un<zr?-1:1;gi=Math.abs(Math.log(un/zr))/Cr,bi=function(){return 0},Bi=function(pi){return Math.exp(Di*Cr*pi)}}return s.duration="duration"in s?+s.duration:1e3*gi/("screenSpeed"in s?+s.screenSpeed/Cr:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=Se!==Je,this._pitching=xt!==Ie,this._padding=!K.isPaddingEqual(_t),this._prepareEase(f,!1),this._ease(function(pi){var li=pi*gi,Co=1/Bi(li);K.zoom=pi===1?Xe:ue+K.scaleZoom(Co),T._rotating&&(K.bearing=o.number(Se,Je,pi)),T._pitching&&(K.pitch=o.number(Ie,xt,pi)),T._padding&&(K.interpolatePadding(We,_t,pi),Ot=K.centerPoint.add(ft));var oo=pi===1?er:K.unproject(br.add(yr.mult(bi(li))).mult(Co));K.setLocationAtPoint(K.renderWorldCopies?oo.wrap():oo,Ot),T._fireMoveEvents(f)},function(){return T._afterEase(f)},s),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(s,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,f)}if(!s){var W=this.handlers;W&&W.stop(!1)}return this},u.prototype._ease=function(s,f,T){T.animate===!1||T.duration===0?(s(1),f()):(this._easeStart=o.browser.now(),this._easeOptions=T,this._onEaseFrame=s,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var s=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(s,f){s=o.wrap(s,-180,180);var T=Math.abs(s-f);return Math.abs(s-360-f)<T&&(s-=360),Math.abs(s+360-f)<T&&(s+=360),s},u.prototype._normalizeCenter=function(s){var f=this.transform;if(f.renderWorldCopies&&!f.lngRange){var T=s.lng-f.center.lng;s.lng+=T>180?-360:T<-180?360:0}},u}(o.Evented),ga=function(a){a===void 0&&(a={}),this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ga.prototype.getDefaultPosition=function(){return"bottom-right"},ga.prototype.onAdd=function(a){var u=this.options&&this.options.compact;return this._map=a,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=_.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ga.prototype.onRemove=function(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ga.prototype._setElementTitle=function(a,u){var s=this._map._getUIString("AttributionControl."+u);a.title=s,a.setAttribute("aria-label",s)},ga.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ga.prototype._updateEditLink=function(){var a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){var s=u.reduce(function(f,T,W){return T.value&&(f+=T.key+"="+T.value+(W<u.length-1?"&":"")),f},"?");a.href=o.config.FEEDBACK_URL+"/"+s+(this._map._hash?this._map._hash.getHashString(!0):""),a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}},ga.prototype._updateData=function(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ga.prototype._updateAttributions=function(){if(this._map.style){var a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(function(ue){return typeof ue!="string"?"":ue})):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var s=this._map.style.sourceCaches;for(var f in s){var T=s[f];if(T.used){var W=T.getSource();W.attribution&&a.indexOf(W.attribution)<0&&a.push(W.attribution)}}a.sort(function(ue,Se){return ue.length-Se.length});var K=(a=a.filter(function(ue,Se){for(var Ie=Se+1;Ie<a.length;Ie++)if(a[Ie].indexOf(ue)>=0)return!1;return!0})).join(" | ");K!==this._attribHTML&&(this._attribHTML=K,a.length?(this._innerContainer.innerHTML=K,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ga.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Na=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};Na.prototype.onAdd=function(a){this._map=a,this._container=_.create("div","mapboxgl-ctrl");var u=_.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Na.prototype.onRemove=function(){_.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Na.prototype.getDefaultPosition=function(){return"bottom-left"},Na.prototype._updateLogo=function(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Na.prototype._logoRequired=function(){if(this._map.style){var a=this._map.style.sourceCaches;for(var u in a)if(a[u].getSource().mapbox_logo)return!0;return!1}},Na.prototype._updateCompact=function(){var a=this._container.children;if(a.length){var u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var xa=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};xa.prototype.add=function(a){var u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u},xa.prototype.remove=function(a){for(var u=this._currentlyRunning,s=0,f=u?this._queue.concat(u):this._queue;s<f.length;s+=1){var T=f[s];if(T.id===a)return void(T.cancelled=!0)}},xa.prototype.run=function(a){a===void 0&&(a=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var s=0,f=u;s<f.length;s+=1){var T=f[s];if(!T.cancelled&&(T.callback(a),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},xa.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ao={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Mi=o.window.HTMLImageElement,ho=o.window.HTMLElement,Ni=o.window.ImageBitmap,Qi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Gi=function(a){function u(f){var T=this;if((f=o.extend({},Qi,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var W=new Ji(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies);if(a.call(this,W,f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new xa,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},ao,f.locale),this._clickTolerance=f.clickTolerance,this._requestManager=new o.RequestManager(f.transformRequest,f.accessToken),typeof f.container=="string"){if(this._container=o.window.document.getElementById(f.container),!this._container)throw new Error("Container '"+f.container+"' not found.")}else{if(!(f.container instanceof ho))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return T._update(!1)}),this.on("moveend",function(){return T._update(!1)}),this.on("zoom",function(){return T._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yn(this,f),this._hash=f.hash&&new qo(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,o.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new ga({customAttribution:f.customAttribution})),this.addControl(new Na,f.logoPosition),this.on("style.load",function(){T.transform.unmodified&&T.jumpTo(T.style.stylesheet)}),this.on("data",function(K){T._update(K.dataType==="style"),T.fire(new o.Event(K.dataType+"data",K))}),this.on("dataloading",function(K){T.fire(new o.Event(K.dataType+"dataloading",K))})}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var s={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(f,T){if(T===void 0&&(T=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var W=f.onAdd(this);this._controls.push(f);var K=this._controlPositions[T];return T.indexOf("bottom")!==-1?K.insertBefore(W,K.firstChild):K.appendChild(W),this},u.prototype.removeControl=function(f){if(!f||!f.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var T=this._controls.indexOf(f);return T>-1&&this._controls.splice(T,1),f.onRemove(this),this},u.prototype.hasControl=function(f){return this._controls.indexOf(f)>-1},u.prototype.resize=function(f){var T=this._containerDimensions(),W=T[0],K=T[1];this._resizeCanvas(W,K),this.transform.resize(W,K),this.painter.resize(W,K);var ue=!this._moving;return ue&&(this.stop(),this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f))),this.fire(new o.Event("resize",f)),ue&&this.fire(new o.Event("moveend",f)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(f){return this.transform.setMaxBounds(o.LngLatBounds.convert(f)),this._update()},u.prototype.setMinZoom=function(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(f){if((f=f==null?60:f)>60)throw new Error("maxPitch must be less than or equal to 60");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(f){return this.transform.renderWorldCopies=f,this._update()},u.prototype.project=function(f){return this.transform.locationPoint(o.LngLat.convert(f))},u.prototype.unproject=function(f){return this.transform.pointLocation(o.Point.convert(f))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(f,T,W){var K,ue=this;if(f==="mouseenter"||f==="mouseover"){var Se=!1;return{layer:T,listener:W,delegates:{mousemove:function(We){var Xe=ue.getLayer(T)?ue.queryRenderedFeatures(We.point,{layers:[T]}):[];Xe.length?Se||(Se=!0,W.call(ue,new fo(f,ue,We.originalEvent,{features:Xe}))):Se=!1},mouseout:function(){Se=!1}}}}if(f==="mouseleave"||f==="mouseout"){var Ie=!1;return{layer:T,listener:W,delegates:{mousemove:function(We){(ue.getLayer(T)?ue.queryRenderedFeatures(We.point,{layers:[T]}):[]).length?Ie=!0:Ie&&(Ie=!1,W.call(ue,new fo(f,ue,We.originalEvent)))},mouseout:function(We){Ie&&(Ie=!1,W.call(ue,new fo(f,ue,We.originalEvent)))}}}}return{layer:T,listener:W,delegates:(K={},K[f]=function(We){var Xe=ue.getLayer(T)?ue.queryRenderedFeatures(We.point,{layers:[T]}):[];Xe.length&&(We.features=Xe,W.call(ue,We),delete We.features)},K)}},u.prototype.on=function(f,T,W){if(W===void 0)return a.prototype.on.call(this,f,T);var K=this._createDelegatedListener(f,T,W);for(var ue in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(K),K.delegates)this.on(ue,K.delegates[ue]);return this},u.prototype.once=function(f,T,W){if(W===void 0)return a.prototype.once.call(this,f,T);var K=this._createDelegatedListener(f,T,W);for(var ue in K.delegates)this.once(ue,K.delegates[ue]);return this},u.prototype.off=function(f,T,W){var K=this;return W===void 0?a.prototype.off.call(this,f,T):(this._delegatedListeners&&this._delegatedListeners[f]&&function(ue){for(var Se=ue[f],Ie=0;Ie<Se.length;Ie++){var We=Se[Ie];if(We.layer===T&&We.listener===W){for(var Xe in We.delegates)K.off(Xe,We.delegates[Xe]);return Se.splice(Ie,1),K}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(f,T){if(!this.style)return[];var W;if(T!==void 0||f===void 0||f instanceof o.Point||Array.isArray(f)||(T=f,f=void 0),T=T||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof f[0]=="number")W=[o.Point.convert(f)];else{var K=o.Point.convert(f[0]),ue=o.Point.convert(f[1]);W=[K,new o.Point(ue.x,K.y),ue,new o.Point(K.x,ue.y),K]}return this.style.queryRenderedFeatures(W,T,this.transform)},u.prototype.querySourceFeatures=function(f,T){return this.style.querySourceFeatures(f,T)},u.prototype.setStyle=function(f,T){return(T=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},T)).diff!==!1&&T.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,T),this):(this._localIdeographFontFamily=T.localIdeographFontFamily,this._updateStyle(f,T))},u.prototype._getUIString=function(f){var T=this._locale[f];if(T==null)throw new Error("Missing UI string '"+f+"'");return T},u.prototype._updateStyle=function(f,T){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new Xt(this,T||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Xt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(f,T){var W=this;if(typeof f=="string"){var K=this._requestManager.normalizeStyleURL(f),ue=this._requestManager.transformRequest(K,o.ResourceType.Style);o.getJSON(ue,function(Se,Ie){Se?W.fire(new o.ErrorEvent(Se)):Ie&&W._updateDiff(Ie,T)})}else typeof f=="object"&&this._updateDiff(f,T)},u.prototype._updateDiff=function(f,T){try{this.style.setState(f)&&this._update(!0)}catch(W){o.warnOnce("Unable to perform style diff: "+(W.message||W.error||W)+".  Rebuilding the style from scratch."),this._updateStyle(f,T)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(f,T){return this._lazyInitEmptyStyle(),this.style.addSource(f,T),this._update(!0)},u.prototype.isSourceLoaded=function(f){var T=this.style&&this.style.sourceCaches[f];if(T!==void 0)return T.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+f+"'")))},u.prototype.areTilesLoaded=function(){var f=this.style&&this.style.sourceCaches;for(var T in f){var W=f[T]._tiles;for(var K in W){var ue=W[K];if(ue.state!=="loaded"&&ue.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(f,T,W){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,T,W)},u.prototype.removeSource=function(f){return this.style.removeSource(f),this._update(!0)},u.prototype.getSource=function(f){return this.style.getSource(f)},u.prototype.addImage=function(f,T,W){W===void 0&&(W={});var K=W.pixelRatio;K===void 0&&(K=1);var ue=W.sdf;ue===void 0&&(ue=!1);var Se=W.stretchX,Ie=W.stretchY,We=W.content;if(this._lazyInitEmptyStyle(),T instanceof Mi||Ni&&T instanceof Ni){var Xe=o.browser.getImageData(T);this.style.addImage(f,{data:new o.RGBAImage({width:Xe.width,height:Xe.height},Xe.data),pixelRatio:K,stretchX:Se,stretchY:Ie,content:We,sdf:ue,version:0})}else{if(T.width===void 0||T.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Je=T;this.style.addImage(f,{data:new o.RGBAImage({width:T.width,height:T.height},new Uint8Array(T.data)),pixelRatio:K,stretchX:Se,stretchY:Ie,content:We,sdf:ue,version:0,userImage:Je}),Je.onAdd&&Je.onAdd(this,f)}},u.prototype.updateImage=function(f,T){var W=this.style.getImage(f);if(!W)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var K=T instanceof Mi||Ni&&T instanceof Ni?o.browser.getImageData(T):T,ue=K.width,Se=K.height,Ie=K.data;return ue===void 0||Se===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):ue!==W.data.width||Se!==W.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(W.data.replace(Ie,!(T instanceof Mi||Ni&&T instanceof Ni)),void this.style.updateImage(f,W))},u.prototype.hasImage=function(f){return f?!!this.style.getImage(f):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(f){this.style.removeImage(f)},u.prototype.loadImage=function(f,T){o.getImage(this._requestManager.transformRequest(f,o.ResourceType.Image),T)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(f,T){return this._lazyInitEmptyStyle(),this.style.addLayer(f,T),this._update(!0)},u.prototype.moveLayer=function(f,T){return this.style.moveLayer(f,T),this._update(!0)},u.prototype.removeLayer=function(f){return this.style.removeLayer(f),this._update(!0)},u.prototype.getLayer=function(f){return this.style.getLayer(f)},u.prototype.setLayerZoomRange=function(f,T,W){return this.style.setLayerZoomRange(f,T,W),this._update(!0)},u.prototype.setFilter=function(f,T,W){return W===void 0&&(W={}),this.style.setFilter(f,T,W),this._update(!0)},u.prototype.getFilter=function(f){return this.style.getFilter(f)},u.prototype.setPaintProperty=function(f,T,W,K){return K===void 0&&(K={}),this.style.setPaintProperty(f,T,W,K),this._update(!0)},u.prototype.getPaintProperty=function(f,T){return this.style.getPaintProperty(f,T)},u.prototype.setLayoutProperty=function(f,T,W,K){return K===void 0&&(K={}),this.style.setLayoutProperty(f,T,W,K),this._update(!0)},u.prototype.getLayoutProperty=function(f,T){return this.style.getLayoutProperty(f,T)},u.prototype.setLight=function(f,T){return T===void 0&&(T={}),this._lazyInitEmptyStyle(),this.style.setLight(f,T),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(f,T){return this.style.setFeatureState(f,T),this._update()},u.prototype.removeFeatureState=function(f,T){return this.style.removeFeatureState(f,T),this._update()},u.prototype.getFeatureState=function(f){return this.style.getFeatureState(f)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var f=0,T=0;return this._container&&(f=this._container.clientWidth||400,T=this._container.clientHeight||300),[f,T]},u.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=_.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();var T=this._canvasContainer=_.create("div","mapboxgl-canvas-container",f);this._interactive&&T.classList.add("mapboxgl-interactive"),this._canvas=_.create("canvas","mapboxgl-canvas",T),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var W=this._containerDimensions();this._resizeCanvas(W[0],W[1]);var K=this._controlContainer=_.create("div","mapboxgl-control-container",f),ue=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Se){ue[Se]=_.create("div","mapboxgl-ctrl-"+Se,K)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(f,T){var W=o.browser.devicePixelRatio||1;this._canvas.width=W*f,this._canvas.height=W*T,this._canvas.style.width=f+"px",this._canvas.style.height=T+"px"},u.prototype._setupPainter=function(){var f=o.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),T=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);T?(this.painter=new Aa(T,this.transform),o.webpSupported.testSupport(T)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:f}))},u.prototype._contextRestored=function(f){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:f}))},u.prototype._onMapScroll=function(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(f){return this._update(),this._renderTaskQueue.add(f)},u.prototype._cancelRenderFrame=function(f){this._renderTaskQueue.remove(f)},u.prototype._render=function(f){var T,W=this,K=0,ue=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(T=ue.createQueryEXT(),ue.beginQueryEXT(ue.TIME_ELAPSED_EXT,T),K=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),!this._removed){var Se=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Ie=this.transform.zoom,We=o.browser.now();this.style.zoomHistory.update(Ie,We);var Xe=new o.EvaluationParameters(Ie,{now:We,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Je=Xe.crossFadingFactor();Je===1&&Je===this._crossFadingFactor||(Se=!0,this._crossFadingFactor=Je),this.style.update(Xe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||Se)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var xt=o.browser.now()-K;ue.endQueryEXT(ue.TIME_ELAPSED_EXT,T),setTimeout(function(){var ft=ue.getQueryObjectEXT(T,ue.QUERY_RESULT_EXT)/1e6;ue.deleteQueryEXT(T),W.fire(new o.Event("gpu-timing-frame",{cpuTime:xt,gpuTime:ft}))},50)}if(this.listens("gpu-timing-layer")){var _t=this.painter.collectGpuTimers();setTimeout(function(){var ft=W.painter.queryGpuTimers(_t);W.fire(new o.Event("gpu-timing-layer",{layerTimes:ft}))},50)}var Pt=this._sourcesDirty||this._styleDirty||this._placementDirty;return Pt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Pt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var f=0,T=this._controls;f<T.length;f+=1)T[f].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var W=this.painter.context.gl.getExtension("WEBGL_lose_context");W&&W.loseContext(),ba(this._canvasContainer),ba(this._controlContainer),ba(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},u.prototype.triggerRepaint=function(){var f=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(T){f._frame=null,f._render(T)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(f){this._trackResize&&this.resize({originalEvent:f})._update()},s.showTileBoundaries.get=function(){return!!this._showTileBoundaries},s.showTileBoundaries.set=function(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())},s.showPadding.get=function(){return!!this._showPadding},s.showPadding.set=function(f){this._showPadding!==f&&(this._showPadding=f,this._update())},s.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},s.showCollisionBoxes.set=function(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())},s.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},s.showOverdrawInspector.set=function(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())},s.repaint.get=function(){return!!this._repaint},s.repaint.set=function(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())},s.vertices.get=function(){return!!this._vertices},s.vertices.set=function(f){this._vertices=f,this._update()},u.prototype._setCacheLimits=function(f,T){o.setCacheLimits(f,T)},s.version.get=function(){return o.version},Object.defineProperties(u.prototype,s),u}(yo);function ba(a){a.parentNode&&a.parentNode.removeChild(a)}var ka={showCompass:!0,showZoom:!0,visualizePitch:!1},No=function(a){var u=this;this.options=o.extend({},ka,a),this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(s){return s.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(s){return u._map.zoomIn({},{originalEvent:s})}),_.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(s){return u._map.zoomOut({},{originalEvent:s})}),_.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(s){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:s}):u._map.resetNorth({},{originalEvent:s})}),this._compassIcon=_.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};No.prototype._updateZoomButtons=function(){var a=this._map.getZoom(),u=a===this._map.getMaxZoom(),s=a===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())},No.prototype._rotateCompassArrow=function(){var a=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=a},No.prototype.onAdd=function(a){return this._map=a,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ro(this._map,this._compass,this.options.visualizePitch)),this._container},No.prototype.onRemove=function(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},No.prototype._createButton=function(a,u){var s=_.create("button",a,this._container);return s.type="button",s.addEventListener("click",u),s},No.prototype._setButtonTitle=function(a,u){var s=this._map._getUIString("NavigationControl."+u);a.title=s,a.setAttribute("aria-label",s)};var Ro=function(a,u,s){s===void 0&&(s=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Ns({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,s&&(this.mousePitch=new io({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),_.addEventListener(u,"mousedown",this.mousedown),_.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),_.addEventListener(u,"touchmove",this.touchmove),_.addEventListener(u,"touchend",this.touchend),_.addEventListener(u,"touchcancel",this.reset)};function ws(a,u,s){if(a=new o.LngLat(a.lng,a.lat),u){var f=new o.LngLat(a.lng-360,a.lat),T=new o.LngLat(a.lng+360,a.lat),W=s.locationPoint(a).distSqr(u);s.locationPoint(f).distSqr(u)<W?a=f:s.locationPoint(T).distSqr(u)<W&&(a=T)}for(;Math.abs(a.lng-s.center.lng)>180;){var K=s.locationPoint(a);if(K.x>=0&&K.y>=0&&K.x<=s.width&&K.y<=s.height)break;a.lng>s.center.lng?a.lng-=360:a.lng+=360}return a}Ro.prototype.down=function(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),_.disableDrag()},Ro.prototype.move=function(a,u){var s=this.map,f=this.mouseRotate.mousemoveWindow(a,u);if(f&&f.bearingDelta&&s.setBearing(s.getBearing()+f.bearingDelta),this.mousePitch){var T=this.mousePitch.mousemoveWindow(a,u);T&&T.pitchDelta&&s.setPitch(s.getPitch()+T.pitchDelta)}},Ro.prototype.off=function(){var a=this.element;_.removeEventListener(a,"mousedown",this.mousedown),_.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),_.removeEventListener(a,"touchmove",this.touchmove),_.removeEventListener(a,"touchend",this.touchend),_.removeEventListener(a,"touchcancel",this.reset),this.offTemp()},Ro.prototype.offTemp=function(){_.enableDrag(),_.removeEventListener(o.window,"mousemove",this.mousemove),_.removeEventListener(o.window,"mouseup",this.mouseup)},Ro.prototype.mousedown=function(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:function(){return a.preventDefault()}}),_.mousePos(this.element,a)),_.addEventListener(o.window,"mousemove",this.mousemove),_.addEventListener(o.window,"mouseup",this.mouseup)},Ro.prototype.mousemove=function(a){this.move(a,_.mousePos(this.element,a))},Ro.prototype.mouseup=function(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()},Ro.prototype.touchstart=function(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return a.preventDefault()}},this._startPos))},Ro.prototype.touchmove=function(a){a.targetTouches.length!==1?this.reset():(this._lastPos=_.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:function(){return a.preventDefault()}},this._lastPos))},Ro.prototype.touchend=function(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ro.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Vo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bs(a,u,s){var f=a.classList;for(var T in Vo)f.remove("mapboxgl-"+s+"-anchor-"+T);f.add("mapboxgl-"+s+"-anchor-"+u)}var Go,el=function(a){function u(s,f){if(a.call(this),(s instanceof o.window.HTMLElement||f)&&(s=o.extend({element:s},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=o.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div"),this._element.setAttribute("aria-label","Map marker");var T=_.createNS("http://www.w3.org/2000/svg","svg");T.setAttributeNS(null,"display","block"),T.setAttributeNS(null,"height","41px"),T.setAttributeNS(null,"width","27px"),T.setAttributeNS(null,"viewBox","0 0 27 41");var W=_.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"stroke","none"),W.setAttributeNS(null,"stroke-width","1"),W.setAttributeNS(null,"fill","none"),W.setAttributeNS(null,"fill-rule","evenodd");var K=_.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"fill-rule","nonzero");var ue=_.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(3.0, 29.0)"),ue.setAttributeNS(null,"fill","#000000");for(var Se=0,Ie=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Se<Ie.length;Se+=1){var We=Ie[Se],Xe=_.createNS("http://www.w3.org/2000/svg","ellipse");Xe.setAttributeNS(null,"opacity","0.04"),Xe.setAttributeNS(null,"cx","10.5"),Xe.setAttributeNS(null,"cy","5.80029008"),Xe.setAttributeNS(null,"rx",We.rx),Xe.setAttributeNS(null,"ry",We.ry),ue.appendChild(Xe)}var Je=_.createNS("http://www.w3.org/2000/svg","g");Je.setAttributeNS(null,"fill",this._color);var xt=_.createNS("http://www.w3.org/2000/svg","path");xt.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Je.appendChild(xt);var _t=_.createNS("http://www.w3.org/2000/svg","g");_t.setAttributeNS(null,"opacity","0.25"),_t.setAttributeNS(null,"fill","#000000");var Pt=_.createNS("http://www.w3.org/2000/svg","path");Pt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),_t.appendChild(Pt);var ft=_.createNS("http://www.w3.org/2000/svg","g");ft.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ft.setAttributeNS(null,"fill","#FFFFFF");var Ot=_.createNS("http://www.w3.org/2000/svg","g");Ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");var jt=_.createNS("http://www.w3.org/2000/svg","circle");jt.setAttributeNS(null,"fill","#000000"),jt.setAttributeNS(null,"opacity","0.25"),jt.setAttributeNS(null,"cx","5.5"),jt.setAttributeNS(null,"cy","5.5"),jt.setAttributeNS(null,"r","5.4999962");var er=_.createNS("http://www.w3.org/2000/svg","circle");er.setAttributeNS(null,"fill","#FFFFFF"),er.setAttributeNS(null,"cx","5.5"),er.setAttributeNS(null,"cy","5.5"),er.setAttributeNS(null,"r","5.4999962"),Ot.appendChild(jt),Ot.appendChild(er),K.appendChild(ue),K.appendChild(Je),K.appendChild(_t),K.appendChild(ft),K.appendChild(Ot),T.appendChild(K),T.setAttributeNS(null,"height",41*this._scale+"px"),T.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(T),this._offset=o.Point.convert(s&&s.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(br){br.preventDefault()}),this._element.addEventListener("mousedown",function(br){br.preventDefault()}),Bs(this._element,this._anchor,"marker"),this._popup=null}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.addTo=function(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){var f=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(s){var f=s.code,T=s.charCode||s.keyCode;f!=="Space"&&f!=="Enter"&&T!==32&&T!==13||this.togglePopup()},u.prototype._onMapClick=function(s){var f=s.originalEvent.target,T=this._element;this._popup&&(f===T||T.contains(f))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this},u.prototype._update=function(s){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ws(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(f="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T="rotateX("+this._map.getPitch()+"deg)"),s&&s.type!=="moveend"||(this._pos=this._pos.round()),_.setTransform(this._element,Vo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+T+" "+f)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(s){return this._offset=o.Point.convert(s),this._update(),this},u.prototype._onMove=function(s){if(!this._isDragging){var f=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(s){return this._rotation=s||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(s){return this._rotationAlignment=s||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(o.Evented),Bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ku=0,Eu=!1,zl=function(a){function u(s){a.call(this),this.options=o.extend({},Bl,s),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.onAdd=function(s){var f;return this._map=s,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),f=this._setupUI,Go!==void 0?f(Go):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(T){f(Go=T.state!=="denied")}):f(Go=!!o.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ku=0,Eu=!1},u.prototype._isOutOfMapMaxBounds=function(s){var f=this._map.getMaxBounds(),T=s.coords;return f&&(T.longitude<f.getWest()||T.longitude>f.getEast()||T.latitude<f.getSouth()||T.latitude>f.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(s){if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",s)),this._finish()}},u.prototype._updateCamera=function(s){var f=new o.LngLat(s.coords.longitude,s.coords.latitude),T=s.coords.accuracy,W=this._map.getBearing(),K=o.extend({bearing:W},this.options.fitBoundsOptions);this._map.fitBounds(f.toBounds(T),K,{geolocateSource:!0})},u.prototype._updateMarker=function(s){if(s){var f=new o.LngLat(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var s=this._map._container.clientHeight/2,f=this._map.unproject([0,s]),T=this._map.unproject([1,s]),W=f.distanceTo(T),K=Math.ceil(2*this._accuracy/W);this._circleElement.style.width=K+"px",this._circleElement.style.height=K+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(s){if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Eu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",s)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(s){var f=this;if(this._container.addEventListener("contextmenu",function(K){return K.preventDefault()}),this._geolocateButton=_.create("button","mapboxgl-ctrl-geolocate",this._container),_.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",s===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var T=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}else{var W=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=W,this._geolocateButton.setAttribute("aria-label",W)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new el(this._dotElement),this._circleElement=_.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new el({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(K){K.geolocateSource||f._watchState!=="ACTIVE_LOCK"||K.originalEvent&&K.originalEvent.type==="resize"||(f._watchState="BACKGROUND",f._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),f._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),f.fire(new o.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ku--,Eu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var s;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ku>1?(s={maximumAge:6e5,timeout:0},Eu=!0):(s=this.options.positionOptions,Eu=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,s)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(o.Evented),lu={maxWidth:100,unit:"metric"},Ks=function(a){this.options=o.extend({},lu,a),o.bindAll(["_onMove","setUnit"],this)};function tl(a,u,s){var f=s&&s.maxWidth||100,T=a._container.clientHeight/2,W=a.unproject([0,T]),K=a.unproject([f,T]),ue=W.distanceTo(K);if(s&&s.unit==="imperial"){var Se=3.2808*ue;Se>5280?cu(u,f,Se/5280,a._getUIString("ScaleControl.Miles")):cu(u,f,Se,a._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?cu(u,f,ue/1852,a._getUIString("ScaleControl.NauticalMiles")):ue>=1e3?cu(u,f,ue/1e3,a._getUIString("ScaleControl.Kilometers")):cu(u,f,ue,a._getUIString("ScaleControl.Meters"))}function cu(a,u,s,f){var T,W,K,ue=(T=s,(W=Math.pow(10,(""+Math.floor(T)).length-1))*(K=(K=T/W)>=10?10:K>=5?5:K>=3?3:K>=2?2:K>=1?1:function(Se){var Ie=Math.pow(10,Math.ceil(-Math.log(Se)/Math.LN10));return Math.round(Se*Ie)/Ie}(K)));a.style.width=u*(ue/s)+"px",a.innerHTML=ue+"&nbsp;"+f}Ks.prototype.getDefaultPosition=function(){return"bottom-left"},Ks.prototype._onMove=function(){tl(this._map,this._container,this.options)},Ks.prototype.onAdd=function(a){return this._map=a,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",a.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Ks.prototype.onRemove=function(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Ks.prototype.setUnit=function(a){this.options.unit=a,tl(this._map,this._container,this.options)};var Xn=function(a){this._fullscreen=!1,a&&a.container&&(a.container instanceof o.window.HTMLElement?this._container=a.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};Xn.prototype.onAdd=function(a){return this._map=a,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Xn.prototype.onRemove=function(){_.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Xn.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},Xn.prototype._setupUI=function(){var a=this._fullscreenButton=_.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);_.create("span","mapboxgl-ctrl-icon",a).setAttribute("aria-hidden",!0),a.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Xn.prototype._updateTitle=function(){var a=this._getTitle();this._fullscreenButton.setAttribute("aria-label",a),this._fullscreenButton.title=a},Xn.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Xn.prototype._isFullscreen=function(){return this._fullscreen},Xn.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Xn.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var oa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},la=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),_n=function(a){function u(s){a.call(this),this.options=o.extend(Object.create(oa),s),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.addTo=function(s){return this._map&&this.remove(),this._map=s,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(s){return this._lngLat=o.LngLat.convert(s),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(s){return this.setDOMContent(o.window.document.createTextNode(s))},u.prototype.setHTML=function(s){var f,T=o.window.document.createDocumentFragment(),W=o.window.document.createElement("body");for(W.innerHTML=s;f=W.firstChild;)T.appendChild(f);return this.setDOMContent(T)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(s){return this.options.maxWidth=s,this._update(),this},u.prototype.setDOMContent=function(s){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(s),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(s){this._container&&this._container.classList.add(s)},u.prototype.removeClassName=function(s){this._container&&this._container.classList.remove(s)},u.prototype.setOffset=function(s){return this.options.offset=s,this._update(),this},u.prototype.toggleClassName=function(s){if(this._container)return this._container.classList.toggle(s)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=_.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(s){this._update(s.point)},u.prototype._onMouseMove=function(s){this._update(s.point)},u.prototype._onDrag=function(s){this._update(s.point)},u.prototype._update=function(s){var f=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=_.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=_.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Xe){return f._container.classList.add(Xe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ws(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||s)){var T=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat),W=this.options.anchor,K=function Xe(Je){if(Je){if(typeof Je=="number"){var xt=Math.round(Math.sqrt(.5*Math.pow(Je,2)));return{center:new o.Point(0,0),top:new o.Point(0,Je),"top-left":new o.Point(xt,xt),"top-right":new o.Point(-xt,xt),bottom:new o.Point(0,-Je),"bottom-left":new o.Point(xt,-xt),"bottom-right":new o.Point(-xt,-xt),left:new o.Point(Je,0),right:new o.Point(-Je,0)}}if(Je instanceof o.Point||Array.isArray(Je)){var _t=o.Point.convert(Je);return{center:_t,top:_t,"top-left":_t,"top-right":_t,bottom:_t,"bottom-left":_t,"bottom-right":_t,left:_t,right:_t}}return{center:o.Point.convert(Je.center||[0,0]),top:o.Point.convert(Je.top||[0,0]),"top-left":o.Point.convert(Je["top-left"]||[0,0]),"top-right":o.Point.convert(Je["top-right"]||[0,0]),bottom:o.Point.convert(Je.bottom||[0,0]),"bottom-left":o.Point.convert(Je["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(Je["bottom-right"]||[0,0]),left:o.Point.convert(Je.left||[0,0]),right:o.Point.convert(Je.right||[0,0])}}return Xe(new o.Point(0,0))}(this.options.offset);if(!W){var ue,Se=this._container.offsetWidth,Ie=this._container.offsetHeight;ue=T.y+K.bottom.y<Ie?["top"]:T.y>this._map.transform.height-Ie?["bottom"]:[],T.x<Se/2?ue.push("left"):T.x>this._map.transform.width-Se/2&&ue.push("right"),W=ue.length===0?"bottom":ue.join("-")}var We=T.add(K[W]).round();_.setTransform(this._container,Vo[W]+" translate("+We.x+"px,"+We.y+"px)"),Bs(this._container,W,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var s=this._container.querySelector(la);s&&s.focus()}},u.prototype._onClose=function(){this.remove()},u}(o.Evented),Bo={version:o.version,supported:w,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:Gi,NavigationControl:No,GeolocateControl:zl,AttributionControl:ga,ScaleControl:Ks,FullscreenControl:Xn,Popup:_n,Marker:el,Style:Xt,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){gr().acquire(ur)},clearPrewarmedResources:function(){var a=nn;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(ur),nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(a){o.config.ACCESS_TOKEN=a},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(a){o.config.API_URL=a},get workerCount(){return Or.workerCount},set workerCount(a){Or.workerCount=a},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(a){o.config.MAX_PARALLEL_IMAGE_REQUESTS=a},clearStorage:function(a){o.clearTileCache(a)},workerUrl:""};return Bo}),i})},28660:function(Te,c,n){var i=n(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var F;(function(o){(function(w){var _=typeof n.g=="object"?n.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),P=L(o);typeof _.Reflect=="undefined"?_.Reflect=o:P=L(_.Reflect,P),w(P);function L(d,E){return function(g,k){typeof d[g]!="function"&&Object.defineProperty(d,g,{configurable:!0,writable:!0,value:k}),E&&E(g,k)}}})(function(w){var _=Object.prototype.hasOwnProperty,P=typeof Symbol=="function",L=P&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",d=P&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",g={__proto__:[]}instanceof Array,k=!E&&!g,M={create:E?function(){return At(Object.create(null))}:g?function(){return At({__proto__:null})}:function(){return At({})},has:k?function(nt,it){return _.call(nt,it)}:function(nt,it){return it in nt},get:k?function(nt,it){return _.call(nt,it)?nt[it]:void 0}:function(nt,it){return nt[it]}},j=Object.getPrototypeOf(Function),U=typeof i=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",I=!U&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:xe(),O=!U&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Mt(),D=!U&&typeof WeakMap=="function"?WeakMap:Ut(),R=new D;function y(nt,it,pt,Vt){if(pe(pt)){if(!C(nt))throw new TypeError;if(!de(it))throw new TypeError;return oe(nt,it)}else{if(!C(nt))throw new TypeError;if(!he(it))throw new TypeError;if(!he(Vt)&&!pe(Vt)&&!Ne(Vt))throw new TypeError;return Ne(Vt)&&(Vt=void 0),pt=Le(pt),re(nt,it,pt,Vt)}}w("decorate",y);function v(nt,it){function pt(Vt,Er){if(!he(Vt))throw new TypeError;if(!pe(Er)&&!Ae(Er))throw new TypeError;ie(nt,it,Vt,Er)}return pt}w("metadata",v);function h(nt,it,pt,Vt){if(!he(pt))throw new TypeError;return pe(Vt)||(Vt=Le(Vt)),ie(nt,it,pt,Vt)}w("defineMetadata",h);function S(nt,it,pt){if(!he(it))throw new TypeError;return pe(pt)||(pt=Le(pt)),ee(nt,it,pt)}w("hasMetadata",S);function A(nt,it,pt){if(!he(it))throw new TypeError;return pe(pt)||(pt=Le(pt)),H(nt,it,pt)}w("hasOwnMetadata",A);function x(nt,it,pt){if(!he(it))throw new TypeError;return pe(pt)||(pt=Le(pt)),ae(nt,it,pt)}w("getMetadata",x);function z(nt,it,pt){if(!he(it))throw new TypeError;return pe(pt)||(pt=Le(pt)),G(nt,it,pt)}w("getOwnMetadata",z);function B(nt,it){if(!he(nt))throw new TypeError;return pe(it)||(it=Le(it)),le(nt,it)}w("getMetadataKeys",B);function V(nt,it){if(!he(nt))throw new TypeError;return pe(it)||(it=Le(it)),Me(nt,it)}w("getOwnMetadataKeys",V);function Q(nt,it,pt){if(!he(it))throw new TypeError;pe(pt)||(pt=Le(pt));var Vt=Z(it,pt,!1);if(pe(Vt)||!Vt.delete(nt))return!1;if(Vt.size>0)return!0;var Er=R.get(it);return Er.delete(pt),Er.size>0||R.delete(it),!0}w("deleteMetadata",Q);function oe(nt,it){for(var pt=nt.length-1;pt>=0;--pt){var Vt=nt[pt],Er=Vt(it);if(!pe(Er)&&!Ne(Er)){if(!de(Er))throw new TypeError;it=Er}}return it}function re(nt,it,pt,Vt){for(var Er=nt.length-1;Er>=0;--Er){var mr=nt[Er],Br=mr(it,pt,Vt);if(!pe(Br)&&!Ne(Br)){if(!he(Br))throw new TypeError;Vt=Br}}return Vt}function Z(nt,it,pt){var Vt=R.get(nt);if(pe(Vt)){if(!pt)return;Vt=new I,R.set(nt,Vt)}var Er=Vt.get(it);if(pe(Er)){if(!pt)return;Er=new I,Vt.set(it,Er)}return Er}function ee(nt,it,pt){var Vt=H(nt,it,pt);if(Vt)return!0;var Er=st(it);return Ne(Er)?!1:ee(nt,Er,pt)}function H(nt,it,pt){var Vt=Z(it,pt,!1);return pe(Vt)?!1:fe(Vt.has(nt))}function ae(nt,it,pt){var Vt=H(nt,it,pt);if(Vt)return G(nt,it,pt);var Er=st(it);if(!Ne(Er))return ae(nt,Er,pt)}function G(nt,it,pt){var Vt=Z(it,pt,!1);if(!pe(Vt))return Vt.get(nt)}function ie(nt,it,pt,Vt){var Er=Z(pt,Vt,!0);Er.set(nt,it)}function le(nt,it){var pt=Me(nt,it),Vt=st(nt);if(Vt===null)return pt;var Er=le(Vt,it);if(Er.length<=0)return pt;if(pt.length<=0)return Er;for(var mr=new O,Br=[],Ur=0,Ar=pt;Ur<Ar.length;Ur++){var Nn=Ar[Ur],Rn=mr.has(Nn);Rn||(mr.add(Nn),Br.push(Nn))}for(var ci=0,Fi=Er;ci<Fi.length;ci++){var Nn=Fi[ci],Rn=mr.has(Nn);Rn||(mr.add(Nn),Br.push(Nn))}return Br}function Me(nt,it){var pt=[],Vt=Z(nt,it,!1);if(pe(Vt))return pt;for(var Er=Vt.keys(),mr=Ge(Er),Br=0;;){var Ur=ct(mr);if(!Ur)return pt.length=Br,pt;var Ar=$e(Ur);try{pt[Br]=Ar}catch(Nn){try{gt(mr)}finally{throw Nn}}Br++}}function ge(nt){if(nt===null)return 1;switch(typeof nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return nt===null?1:6;default:return 6}}function pe(nt){return nt===void 0}function Ne(nt){return nt===null}function Re(nt){return typeof nt=="symbol"}function he(nt){return typeof nt=="object"?nt!==null:typeof nt=="function"}function se(nt,it){switch(ge(nt)){case 0:return nt;case 1:return nt;case 2:return nt;case 3:return nt;case 4:return nt;case 5:return nt}var pt=it===3?"string":it===5?"number":"default",Vt=De(nt,L);if(Vt!==void 0){var Er=Vt.call(nt,pt);if(he(Er))throw new TypeError;return Er}return J(nt,pt==="default"?"number":pt)}function J(nt,it){if(it==="string"){var pt=nt.toString;if(X(pt)){var Vt=pt.call(nt);if(!he(Vt))return Vt}var Er=nt.valueOf;if(X(Er)){var Vt=Er.call(nt);if(!he(Vt))return Vt}}else{var Er=nt.valueOf;if(X(Er)){var Vt=Er.call(nt);if(!he(Vt))return Vt}var mr=nt.toString;if(X(mr)){var Vt=mr.call(nt);if(!he(Vt))return Vt}}throw new TypeError}function fe(nt){return!!nt}function me(nt){return""+nt}function Le(nt){var it=se(nt,3);return Re(it)?it:me(it)}function C(nt){return Array.isArray?Array.isArray(nt):nt instanceof Object?nt instanceof Array:Object.prototype.toString.call(nt)==="[object Array]"}function X(nt){return typeof nt=="function"}function de(nt){return typeof nt=="function"}function Ae(nt){switch(ge(nt)){case 3:return!0;case 4:return!0;default:return!1}}function De(nt,it){var pt=nt[it];if(pt!=null){if(!X(pt))throw new TypeError;return pt}}function Ge(nt){var it=De(nt,d);if(!X(it))throw new TypeError;var pt=it.call(nt);if(!he(pt))throw new TypeError;return pt}function $e(nt){return nt.value}function ct(nt){var it=nt.next();return it.done?!1:it}function gt(nt){var it=nt.return;it&&it.call(nt)}function st(nt){var it=Object.getPrototypeOf(nt);if(typeof nt!="function"||nt===j||it!==j)return it;var pt=nt.prototype,Vt=pt&&Object.getPrototypeOf(pt);if(Vt==null||Vt===Object.prototype)return it;var Er=Vt.constructor;return typeof Er!="function"||Er===nt?it:Er}function xe(){var nt={},it=[],pt=function(){function Br(Ur,Ar,Nn){this._index=0,this._keys=Ur,this._values=Ar,this._selector=Nn}return Br.prototype["@@iterator"]=function(){return this},Br.prototype[d]=function(){return this},Br.prototype.next=function(){var Ur=this._index;if(Ur>=0&&Ur<this._keys.length){var Ar=this._selector(this._keys[Ur],this._values[Ur]);return Ur+1>=this._keys.length?(this._index=-1,this._keys=it,this._values=it):this._index++,{value:Ar,done:!1}}return{value:void 0,done:!0}},Br.prototype.throw=function(Ur){throw this._index>=0&&(this._index=-1,this._keys=it,this._values=it),Ur},Br.prototype.return=function(Ur){return this._index>=0&&(this._index=-1,this._keys=it,this._values=it),{value:Ur,done:!0}},Br}();return function(){function Br(){this._keys=[],this._values=[],this._cacheKey=nt,this._cacheIndex=-2}return Object.defineProperty(Br.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Br.prototype.has=function(Ur){return this._find(Ur,!1)>=0},Br.prototype.get=function(Ur){var Ar=this._find(Ur,!1);return Ar>=0?this._values[Ar]:void 0},Br.prototype.set=function(Ur,Ar){var Nn=this._find(Ur,!0);return this._values[Nn]=Ar,this},Br.prototype.delete=function(Ur){var Ar=this._find(Ur,!1);if(Ar>=0){for(var Nn=this._keys.length,Rn=Ar+1;Rn<Nn;Rn++)this._keys[Rn-1]=this._keys[Rn],this._values[Rn-1]=this._values[Rn];return this._keys.length--,this._values.length--,Ur===this._cacheKey&&(this._cacheKey=nt,this._cacheIndex=-2),!0}return!1},Br.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=nt,this._cacheIndex=-2},Br.prototype.keys=function(){return new pt(this._keys,this._values,Vt)},Br.prototype.values=function(){return new pt(this._keys,this._values,Er)},Br.prototype.entries=function(){return new pt(this._keys,this._values,mr)},Br.prototype["@@iterator"]=function(){return this.entries()},Br.prototype[d]=function(){return this.entries()},Br.prototype._find=function(Ur,Ar){return this._cacheKey!==Ur&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Ur)),this._cacheIndex<0&&Ar&&(this._cacheIndex=this._keys.length,this._keys.push(Ur),this._values.push(void 0)),this._cacheIndex},Br}();function Vt(Br,Ur){return Br}function Er(Br,Ur){return Ur}function mr(Br,Ur){return[Br,Ur]}}function Mt(){return function(){function nt(){this._map=new I}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),nt.prototype.has=function(it){return this._map.has(it)},nt.prototype.add=function(it){return this._map.set(it,it),this},nt.prototype.delete=function(it){return this._map.delete(it)},nt.prototype.clear=function(){this._map.clear()},nt.prototype.keys=function(){return this._map.keys()},nt.prototype.values=function(){return this._map.values()},nt.prototype.entries=function(){return this._map.entries()},nt.prototype["@@iterator"]=function(){return this.keys()},nt.prototype[d]=function(){return this.keys()},nt}()}function Ut(){var nt=16,it=M.create(),pt=Vt();return function(){function Ar(){this._key=Vt()}return Ar.prototype.has=function(Nn){var Rn=Er(Nn,!1);return Rn!==void 0?M.has(Rn,this._key):!1},Ar.prototype.get=function(Nn){var Rn=Er(Nn,!1);return Rn!==void 0?M.get(Rn,this._key):void 0},Ar.prototype.set=function(Nn,Rn){var ci=Er(Nn,!0);return ci[this._key]=Rn,this},Ar.prototype.delete=function(Nn){var Rn=Er(Nn,!1);return Rn!==void 0?delete Rn[this._key]:!1},Ar.prototype.clear=function(){this._key=Vt()},Ar}();function Vt(){var Ar;do Ar="@@WeakMap@@"+Ur();while(M.has(it,Ar));return it[Ar]=!0,Ar}function Er(Ar,Nn){if(!_.call(Ar,pt)){if(!Nn)return;Object.defineProperty(Ar,pt,{value:M.create()})}return Ar[pt]}function mr(Ar,Nn){for(var Rn=0;Rn<Nn;++Rn)Ar[Rn]=Math.random()*255|0;return Ar}function Br(Ar){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Ar)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Ar)):mr(new Uint8Array(Ar),Ar):mr(new Array(Ar),Ar)}function Ur(){var Ar=Br(nt);Ar[6]=Ar[6]&79|64,Ar[8]=Ar[8]&191|128;for(var Nn="",Rn=0;Rn<nt;++Rn){var ci=Ar[Rn];(Rn===4||Rn===6||Rn===8)&&(Nn+="-"),ci<16&&(Nn+="0"),Nn+=ci.toString(16).toLowerCase()}return Nn}}function At(nt){return nt.__=void 0,delete nt.__,nt}})})(F||(F={}))},69848:function(Te){(function(c,n){Te.exports=n()})(this,function(){"use strict";function c(A,x,z,B,V,Q){if(!(V-B<=z)){var oe=B+V>>1;n(A,x,oe,B,V,Q%2),c(A,x,z,B,oe-1,Q+1),c(A,x,z,oe+1,V,Q+1)}}function n(A,x,z,B,V,Q){for(;V>B;){if(V-B>600){var oe=V-B+1,re=z-B+1,Z=Math.log(oe),ee=.5*Math.exp(2*Z/3),H=.5*Math.sqrt(Z*ee*(oe-ee)/oe)*(re-oe/2<0?-1:1),ae=Math.max(B,Math.floor(z-re*ee/oe+H)),G=Math.min(V,Math.floor(z+(oe-re)*ee/oe+H));n(A,x,z,ae,G,Q)}var ie=x[2*z+Q],le=B,Me=V;for(i(A,x,B,z),x[2*V+Q]>ie&&i(A,x,B,V);le<Me;){for(i(A,x,le,Me),le++,Me--;x[2*le+Q]<ie;)le++;for(;x[2*Me+Q]>ie;)Me--}x[2*B+Q]===ie?i(A,x,B,Me):(Me++,i(A,x,Me,V)),Me<=z&&(B=Me+1),z<=Me&&(V=Me-1)}}function i(A,x,z,B){F(A,z,B),F(x,2*z,2*B),F(x,2*z+1,2*B+1)}function F(A,x,z){var B=A[x];A[x]=A[z],A[z]=B}function o(A,x,z,B,V,Q,oe){for(var re=[0,A.length-1,0],Z=[],ee,H;re.length;){var ae=re.pop(),G=re.pop(),ie=re.pop();if(G-ie<=oe){for(var le=ie;le<=G;le++)ee=x[2*le],H=x[2*le+1],ee>=z&&ee<=V&&H>=B&&H<=Q&&Z.push(A[le]);continue}var Me=Math.floor((ie+G)/2);ee=x[2*Me],H=x[2*Me+1],ee>=z&&ee<=V&&H>=B&&H<=Q&&Z.push(A[Me]);var ge=(ae+1)%2;(ae===0?z<=ee:B<=H)&&(re.push(ie),re.push(Me-1),re.push(ge)),(ae===0?V>=ee:Q>=H)&&(re.push(Me+1),re.push(G),re.push(ge))}return Z}function w(A,x,z,B,V,Q){for(var oe=[0,A.length-1,0],re=[],Z=V*V;oe.length;){var ee=oe.pop(),H=oe.pop(),ae=oe.pop();if(H-ae<=Q){for(var G=ae;G<=H;G++)_(x[2*G],x[2*G+1],z,B)<=Z&&re.push(A[G]);continue}var ie=Math.floor((ae+H)/2),le=x[2*ie],Me=x[2*ie+1];_(le,Me,z,B)<=Z&&re.push(A[ie]);var ge=(ee+1)%2;(ee===0?z-V<=le:B-V<=Me)&&(oe.push(ae),oe.push(ie-1),oe.push(ge)),(ee===0?z+V>=le:B+V>=Me)&&(oe.push(ie+1),oe.push(H),oe.push(ge))}return re}function _(A,x,z,B){var V=A-z,Q=x-B;return V*V+Q*Q}var P=function(A){return A[0]},L=function(A){return A[1]},d=function(x,z,B,V,Q){z===void 0&&(z=P),B===void 0&&(B=L),V===void 0&&(V=64),Q===void 0&&(Q=Float64Array),this.nodeSize=V,this.points=x;for(var oe=x.length<65536?Uint16Array:Uint32Array,re=this.ids=new oe(x.length),Z=this.coords=new Q(x.length*2),ee=0;ee<x.length;ee++)re[ee]=ee,Z[2*ee]=z(x[ee]),Z[2*ee+1]=B(x[ee]);c(re,Z,V,0,re.length-1,0)};d.prototype.range=function(x,z,B,V){return o(this.ids,this.coords,x,z,B,V,this.nodeSize)},d.prototype.within=function(x,z,B){return w(this.ids,this.coords,x,z,B,this.nodeSize)};var E={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(A){return A}},g=Math.fround||function(A){return function(x){return A[0]=+x,A[0]}}(new Float32Array(1)),k=function(x){this.options=v(Object.create(E),x),this.trees=new Array(this.options.maxZoom+1)};k.prototype.load=function(x){var z=this.options,B=z.log,V=z.minZoom,Q=z.maxZoom,oe=z.nodeSize;B&&console.time("total time");var re="prepare "+x.length+" points";B&&console.time(re),this.points=x;for(var Z=[],ee=0;ee<x.length;ee++)!x[ee].geometry||Z.push(j(x[ee],ee));this.trees[Q+1]=new d(Z,h,S,oe,Float32Array),B&&console.timeEnd(re);for(var H=Q;H>=V;H--){var ae=+Date.now();Z=this._cluster(Z,H),this.trees[H]=new d(Z,h,S,oe,Float32Array),B&&console.log("z%d: %d clusters in %dms",H,Z.length,+Date.now()-ae)}return B&&console.timeEnd("total time"),this},k.prototype.getClusters=function(x,z){var B=((x[0]+180)%360+360)%360-180,V=Math.max(-90,Math.min(90,x[1])),Q=x[2]===180?180:((x[2]+180)%360+360)%360-180,oe=Math.max(-90,Math.min(90,x[3]));if(x[2]-x[0]>=360)B=-180,Q=180;else if(B>Q){var re=this.getClusters([B,V,180,oe],z),Z=this.getClusters([-180,V,Q,oe],z);return re.concat(Z)}for(var ee=this.trees[this._limitZoom(z)],H=ee.range(O(B),D(oe),O(Q),D(V)),ae=[],G=0,ie=H;G<ie.length;G+=1){var le=ie[G],Me=ee.points[le];ae.push(Me.numPoints?U(Me):this.points[Me.index])}return ae},k.prototype.getChildren=function(x){var z=this._getOriginId(x),B=this._getOriginZoom(x),V="No cluster with the specified id.",Q=this.trees[B];if(!Q)throw new Error(V);var oe=Q.points[z];if(!oe)throw new Error(V);for(var re=this.options.radius/(this.options.extent*Math.pow(2,B-1)),Z=Q.within(oe.x,oe.y,re),ee=[],H=0,ae=Z;H<ae.length;H+=1){var G=ae[H],ie=Q.points[G];ie.parentId===x&&ee.push(ie.numPoints?U(ie):this.points[ie.index])}if(ee.length===0)throw new Error(V);return ee},k.prototype.getLeaves=function(x,z,B){z=z||10,B=B||0;var V=[];return this._appendLeaves(V,x,z,B,0),V},k.prototype.getTile=function(x,z,B){var V=this.trees[this._limitZoom(x)],Q=Math.pow(2,x),oe=this.options,re=oe.extent,Z=oe.radius,ee=Z/re,H=(B-ee)/Q,ae=(B+1+ee)/Q,G={features:[]};return this._addTileFeatures(V.range((z-ee)/Q,H,(z+1+ee)/Q,ae),V.points,z,B,Q,G),z===0&&this._addTileFeatures(V.range(1-ee/Q,H,1,ae),V.points,Q,B,Q,G),z===Q-1&&this._addTileFeatures(V.range(0,H,ee/Q,ae),V.points,-1,B,Q,G),G.features.length?G:null},k.prototype.getClusterExpansionZoom=function(x){for(var z=this._getOriginZoom(x)-1;z<=this.options.maxZoom;){var B=this.getChildren(x);if(z++,B.length!==1)break;x=B[0].properties.cluster_id}return z},k.prototype._appendLeaves=function(x,z,B,V,Q){for(var oe=this.getChildren(z),re=0,Z=oe;re<Z.length;re+=1){var ee=Z[re],H=ee.properties;if(H&&H.cluster?Q+H.point_count<=V?Q+=H.point_count:Q=this._appendLeaves(x,H.cluster_id,B,V,Q):Q<V?Q++:x.push(ee),x.length===B)break}return Q},k.prototype._addTileFeatures=function(x,z,B,V,Q,oe){for(var re=0,Z=x;re<Z.length;re+=1){var ee=Z[re],H=z[ee],ae=H.numPoints,G=void 0,ie=void 0,le=void 0;if(ae)G=I(H),ie=H.x,le=H.y;else{var Me=this.points[H.index];G=Me.properties,ie=O(Me.geometry.coordinates[0]),le=D(Me.geometry.coordinates[1])}var ge={type:1,geometry:[[Math.round(this.options.extent*(ie*Q-B)),Math.round(this.options.extent*(le*Q-V))]],tags:G},pe=void 0;ae?pe=H.id:this.options.generateId?pe=H.index:this.points[H.index].id&&(pe=this.points[H.index].id),pe!==void 0&&(ge.id=pe),oe.features.push(ge)}},k.prototype._limitZoom=function(x){return Math.max(this.options.minZoom,Math.min(+x,this.options.maxZoom+1))},k.prototype._cluster=function(x,z){for(var B=[],V=this.options,Q=V.radius,oe=V.extent,re=V.reduce,Z=V.minPoints,ee=Q/(oe*Math.pow(2,z)),H=0;H<x.length;H++){var ae=x[H];if(!(ae.zoom<=z)){ae.zoom=z;for(var G=this.trees[z+1],ie=G.within(ae.x,ae.y,ee),le=ae.numPoints||1,Me=le,ge=0,pe=ie;ge<pe.length;ge+=1){var Ne=pe[ge],Re=G.points[Ne];Re.zoom>z&&(Me+=Re.numPoints||1)}if(Me>=Z){for(var he=ae.x*le,se=ae.y*le,J=re&&le>1?this._map(ae,!0):null,fe=(H<<5)+(z+1)+this.points.length,me=0,Le=ie;me<Le.length;me+=1){var C=Le[me],X=G.points[C];if(!(X.zoom<=z)){X.zoom=z;var de=X.numPoints||1;he+=X.x*de,se+=X.y*de,X.parentId=fe,re&&(J||(J=this._map(ae,!0)),re(J,this._map(X)))}}ae.parentId=fe,B.push(M(he/Me,se/Me,fe,Me,J))}else if(B.push(ae),Me>1)for(var Ae=0,De=ie;Ae<De.length;Ae+=1){var Ge=De[Ae],$e=G.points[Ge];$e.zoom<=z||($e.zoom=z,B.push($e))}}}return B},k.prototype._getOriginId=function(x){return x-this.points.length>>5},k.prototype._getOriginZoom=function(x){return(x-this.points.length)%32},k.prototype._map=function(x,z){if(x.numPoints)return z?v({},x.properties):x.properties;var B=this.points[x.index].properties,V=this.options.map(B);return z&&V===B?v({},V):V};function M(A,x,z,B,V){return{x:g(A),y:g(x),zoom:Infinity,id:z,parentId:-1,numPoints:B,properties:V}}function j(A,x){var z=A.geometry.coordinates,B=z[0],V=z[1];return{x:g(O(B)),y:g(D(V)),zoom:Infinity,index:x,parentId:-1}}function U(A){return{type:"Feature",id:A.id,properties:I(A),geometry:{type:"Point",coordinates:[R(A.x),y(A.y)]}}}function I(A){var x=A.numPoints,z=x>=1e4?Math.round(x/1e3)+"k":x>=1e3?Math.round(x/100)/10+"k":x;return v(v({},A.properties),{cluster:!0,cluster_id:A.id,point_count:x,point_count_abbreviated:z})}function O(A){return A/360+.5}function D(A){var x=Math.sin(A*Math.PI/180),z=.5-.25*Math.log((1+x)/(1-x))/Math.PI;return z<0?0:z>1?1:z}function R(A){return(A-.5)*360}function y(A){var x=(180-A*360)*Math.PI/180;return 360*Math.atan(Math.exp(x))/Math.PI-90}function v(A,x){for(var z in x)A[z]=x[z];return A}function h(A){return A.x}function S(A){return A.y}return k})},71884:function(Te,c,n){"use strict";n.r(c),n.d(c,{PerspectiveMercatorViewport:function(){return ge},WebMercatorViewport:function(){return ge},addMetersToLngLat:function(){return re},default:function(){return ge},fitBounds:function(){return Me},flyToViewport:function(){return fe},getDistanceScales:function(){return oe},getFlyToDuration:function(){return me},getMeterZoom:function(){return Q},getProjectionMatrix:function(){return H},getProjectionParameters:function(){return ee},getUncenteredViewMatrix:function(){return Z},getViewMatrix:function(){return Z},lngLatToWorld:function(){return B},normalizeViewportProps:function(){return Re},pixelsToWorld:function(){return G},projectFlat:function(){return B},unprojectFlat:function(){return V},worldToLngLat:function(){return V},worldToPixels:function(){return ae}});var i=n(6610),F=n(5991),o=n(46070),w=n(77608),_=n(10379),P=n(63349),L=n(28481),d=n(98333);function E(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function g(C,X){var de=d.transformMat4([],X,C);return d.scale(de,de,1/de[3]),de}function k(C,X){var de=C%X;return de<0?X+de:de}function M(C,X,de){return de*X+(1-de)*C}var j=n(85975),U=n(31437),I=n(77160);function O(C,X){if(!C)throw new Error(X||"viewport-mercator-project: assertion failed.")}var D=Math.PI,R=D/4,y=D/180,v=180/D,h=512,S=4003e4,A=1.5;function x(C){return Math.pow(2,C)}function z(C){return Math.log2(C)}function B(C,X){var de=(0,L.Z)(C,2),Ae=de[0],De=de[1];O(Number.isFinite(Ae)&&Number.isFinite(X)),O(Number.isFinite(De)&&De>=-90&&De<=90,"invalid latitude"),X*=h;var Ge=Ae*y,$e=De*y,ct=X*(Ge+D)/(2*D),gt=X*(D-Math.log(Math.tan(R+$e*.5)))/(2*D);return[ct,gt]}function V(C,X){var de=(0,L.Z)(C,2),Ae=de[0],De=de[1];X*=h;var Ge=Ae/X*(2*D)-D,$e=2*(Math.atan(Math.exp(D-De/X*(2*D)))-R);return[Ge*v,$e*v]}function Q(C){var X=C.latitude;O(Number.isFinite(X));var de=Math.cos(X*y);return z(S*de)-9}function oe(C){var X=C.latitude,de=C.longitude,Ae=C.zoom,De=C.scale,Ge=C.highPrecision,$e=Ge===void 0?!1:Ge;De=De!==void 0?De:x(Ae),O(Number.isFinite(X)&&Number.isFinite(de)&&Number.isFinite(De));var ct={},gt=h*De,st=Math.cos(X*y),xe=gt/360,Mt=xe/st,Ut=gt/S/st;if(ct.pixelsPerMeter=[Ut,-Ut,Ut],ct.metersPerPixel=[1/Ut,-1/Ut,1/Ut],ct.pixelsPerDegree=[xe,-Mt,Ut],ct.degreesPerPixel=[1/xe,-1/Mt,1/Ut],$e){var At=y*Math.tan(X*y)/st,nt=xe*At/2,it=gt/S*At,pt=it/Mt*Ut;ct.pixelsPerDegree2=[0,-nt,it],ct.pixelsPerMeter2=[pt,0,pt]}return ct}function re(C,X){var de=(0,L.Z)(C,3),Ae=de[0],De=de[1],Ge=de[2],$e=(0,L.Z)(X,3),ct=$e[0],gt=$e[1],st=$e[2],xe=1,Mt=oe({longitude:Ae,latitude:De,scale:xe,highPrecision:!0}),Ut=Mt.pixelsPerMeter,At=Mt.pixelsPerMeter2,nt=B(C,xe);nt[0]+=ct*(Ut[0]+At[0]*gt),nt[1]+=gt*(Ut[1]+At[1]*gt);var it=V(nt,xe),pt=(Ge||0)+(st||0);return Number.isFinite(Ge)||Number.isFinite(st)?[it[0],it[1],pt]:it}function Z(C){var X=C.height,de=C.pitch,Ae=C.bearing,De=C.altitude,Ge=C.center,$e=Ge===void 0?null:Ge,ct=C.flipY,gt=ct===void 0?!1:ct,st=E();return j.translate(st,st,[0,0,-De]),j.scale(st,st,[1,1,1/X]),j.rotateX(st,st,-de*y),j.rotateZ(st,st,Ae*y),gt&&j.scale(st,st,[1,-1,1]),$e&&j.translate(st,st,I.negate([],$e)),st}function ee(C){var X=C.width,de=C.height,Ae=C.altitude,De=Ae===void 0?A:Ae,Ge=C.pitch,$e=Ge===void 0?0:Ge,ct=C.nearZMultiplier,gt=ct===void 0?1:ct,st=C.farZMultiplier,xe=st===void 0?1:st,Mt=$e*y,Ut=Math.atan(.5/De),At=Math.sin(Ut)*De/Math.sin(Math.PI/2-Mt-Ut),nt=Math.cos(Math.PI/2-Mt)*At+De;return{fov:2*Math.atan(de/2/De),aspect:X/de,focalDistance:De,near:gt,far:nt*xe}}function H(C){var X=C.width,de=C.height,Ae=C.pitch,De=C.altitude,Ge=C.nearZMultiplier,$e=C.farZMultiplier,ct=ee({width:X,height:de,altitude:De,pitch:Ae,nearZMultiplier:Ge,farZMultiplier:$e}),gt=ct.fov,st=ct.aspect,xe=ct.near,Mt=ct.far,Ut=j.perspective([],gt,st,xe,Mt);return Ut}function ae(C,X){var de=(0,L.Z)(C,3),Ae=de[0],De=de[1],Ge=de[2],$e=Ge===void 0?0:Ge;return O(Number.isFinite(Ae)&&Number.isFinite(De)&&Number.isFinite($e)),g(X,[Ae,De,$e,1])}function G(C,X){var de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ae=(0,L.Z)(C,3),De=Ae[0],Ge=Ae[1],$e=Ae[2];if(O(Number.isFinite(De)&&Number.isFinite(Ge),"invalid pixel coordinate"),Number.isFinite($e)){var ct=g(X,[De,Ge,$e,1]);return ct}var gt=g(X,[De,Ge,0,1]),st=g(X,[De,Ge,1,1]),xe=gt[2],Mt=st[2],Ut=xe===Mt?0:((de||0)-xe)/(Mt-xe);return U.lerp([],gt,st,Ut)}var ie=E(),le=function(){function C(){var X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},de=X.width,Ae=X.height,De=X.viewMatrix,Ge=De===void 0?ie:De,$e=X.projectionMatrix,ct=$e===void 0?ie:$e;(0,i.Z)(this,C),this.width=de||1,this.height=Ae||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=Ge,this.projectionMatrix=ct;var gt=E();j.multiply(gt,gt,this.projectionMatrix),j.multiply(gt,gt,this.viewMatrix),this.viewProjectionMatrix=gt;var st=E();j.scale(st,st,[this.width/2,-this.height/2,1]),j.translate(st,st,[1,-1,0]),j.multiply(st,st,this.viewProjectionMatrix);var xe=j.invert(E(),st);if(!xe)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=st,this.pixelUnprojectionMatrix=xe,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,F.Z)(C,[{key:"equals",value:function(de){return de instanceof C?de.width===this.width&&de.height===this.height&&j.equals(de.projectionMatrix,this.projectionMatrix)&&j.equals(de.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(de){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},De=Ae.topLeft,Ge=De===void 0?!0:De,$e=this.projectPosition(de),ct=ae($e,this.pixelProjectionMatrix),gt=(0,L.Z)(ct,2),st=gt[0],xe=gt[1],Mt=Ge?xe:this.height-xe;return de.length===2?[st,Mt]:[st,Mt,ct[2]]}},{key:"unproject",value:function(de){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},De=Ae.topLeft,Ge=De===void 0?!0:De,$e=Ae.targetZ,ct=(0,L.Z)(de,3),gt=ct[0],st=ct[1],xe=ct[2],Mt=Ge?st:this.height-st,Ut=$e&&$e*this.pixelsPerMeter,At=G([gt,Mt,xe],this.pixelUnprojectionMatrix,Ut),nt=this.unprojectPosition(At),it=(0,L.Z)(nt,3),pt=it[0],Vt=it[1],Er=it[2];return Number.isFinite(xe)?[pt,Vt,Er]:Number.isFinite($e)?[pt,Vt,$e]:[pt,Vt]}},{key:"projectPosition",value:function(de){var Ae=this.projectFlat(de),De=(0,L.Z)(Ae,2),Ge=De[0],$e=De[1],ct=(de[2]||0)*this.pixelsPerMeter;return[Ge,$e,ct]}},{key:"unprojectPosition",value:function(de){var Ae=this.unprojectFlat(de),De=(0,L.Z)(Ae,2),Ge=De[0],$e=De[1],ct=(de[2]||0)/this.pixelsPerMeter;return[Ge,$e,ct]}},{key:"projectFlat",value:function(de){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return de}},{key:"unprojectFlat",value:function(de){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return de}}]),C}();function Me(C){var X=C.width,de=C.height,Ae=C.bounds,De=C.minExtent,Ge=De===void 0?0:De,$e=C.maxZoom,ct=$e===void 0?24:$e,gt=C.padding,st=gt===void 0?0:gt,xe=C.offset,Mt=xe===void 0?[0,0]:xe,Ut=(0,L.Z)(Ae,2),At=(0,L.Z)(Ut[0],2),nt=At[0],it=At[1],pt=(0,L.Z)(Ut[1],2),Vt=pt[0],Er=pt[1];if(Number.isFinite(st)){var mr=st;st={top:mr,bottom:mr,left:mr,right:mr}}else O(Number.isFinite(st.top)&&Number.isFinite(st.bottom)&&Number.isFinite(st.left)&&Number.isFinite(st.right));var Br=new ge({width:X,height:de,longitude:0,latitude:0,zoom:0}),Ur=Br.project([nt,Er]),Ar=Br.project([Vt,it]),Nn=[Math.max(Math.abs(Ar[0]-Ur[0]),Ge),Math.max(Math.abs(Ar[1]-Ur[1]),Ge)],Rn=[X-st.left-st.right-Math.abs(Mt[0])*2,de-st.top-st.bottom-Math.abs(Mt[1])*2];O(Rn[0]>0&&Rn[1]>0);var ci=Rn[0]/Nn[0],Fi=Rn[1]/Nn[1],ji=(st.right-st.left)/2/ci,Si=(st.bottom-st.top)/2/Fi,xi=[(Ar[0]+Ur[0])/2+ji,(Ar[1]+Ur[1])/2+Si],Ee=Br.unproject(xi),ke=Br.zoom+Math.log2(Math.abs(Math.min(ci,Fi)));return{longitude:Ee[0],latitude:Ee[1],zoom:Math.min(ke,ct)}}var ge=function(C){(0,_.Z)(X,C);function X(){var de,Ae=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},De=Ae.width,Ge=Ae.height,$e=Ae.latitude,ct=$e===void 0?0:$e,gt=Ae.longitude,st=gt===void 0?0:gt,xe=Ae.zoom,Mt=xe===void 0?0:xe,Ut=Ae.pitch,At=Ut===void 0?0:Ut,nt=Ae.bearing,it=nt===void 0?0:nt,pt=Ae.altitude,Vt=pt===void 0?1.5:pt,Er=Ae.nearZMultiplier,mr=Ae.farZMultiplier;(0,i.Z)(this,X),De=De||1,Ge=Ge||1;var Br=x(Mt);Vt=Math.max(.75,Vt);var Ur=B([st,ct],Br);Ur[2]=0;var Ar=H({width:De,height:Ge,pitch:At,bearing:it,altitude:Vt,nearZMultiplier:Er||1/Ge,farZMultiplier:mr||1.01}),Nn=Z({height:Ge,center:Ur,pitch:At,bearing:it,altitude:Vt,flipY:!0});return de=(0,o.Z)(this,(0,w.Z)(X).call(this,{width:De,height:Ge,viewMatrix:Nn,projectionMatrix:Ar})),de.latitude=ct,de.longitude=st,de.zoom=Mt,de.pitch=At,de.bearing=it,de.altitude=Vt,de.scale=Br,de.center=Ur,de.pixelsPerMeter=oe((0,P.Z)((0,P.Z)(de))).pixelsPerMeter[2],Object.freeze((0,P.Z)((0,P.Z)(de))),de}return(0,F.Z)(X,[{key:"projectFlat",value:function(Ae){var De=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return B(Ae,De)}},{key:"unprojectFlat",value:function(Ae){var De=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return V(Ae,De)}},{key:"getMapCenterByLngLatPosition",value:function(Ae){var De=Ae.lngLat,Ge=Ae.pos,$e=G(Ge,this.pixelUnprojectionMatrix),ct=B(De,this.scale),gt=U.add([],ct,U.negate([],$e)),st=U.add([],this.center,gt);return V(st,this.scale)}},{key:"getLocationAtPoint",value:function(Ae){var De=Ae.lngLat,Ge=Ae.pos;return this.getMapCenterByLngLatPosition({lngLat:De,pos:Ge})}},{key:"fitBounds",value:function(Ae){var De=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ge=this.width,$e=this.height,ct=Me(Object.assign({width:Ge,height:$e,bounds:Ae},De)),gt=ct.longitude,st=ct.latitude,xe=ct.zoom;return new X({width:Ge,height:$e,longitude:gt,latitude:st,zoom:xe})}}]),X}(le),pe=85.05113,Ne=-85.05113;function Re(C){var X=C.width,de=C.height,Ae=C.longitude,De=C.latitude,Ge=C.zoom,$e=C.pitch,ct=$e===void 0?0:$e,gt=C.bearing,st=gt===void 0?0:gt;(Ae<-180||Ae>180)&&(Ae=k(Ae+180,360)-180),(st<-180||st>180)&&(st=k(st+180,360)-180);var xe=new ge({width:X,height:de,longitude:Ae,latitude:De,zoom:Ge}),Mt=xe.project([Ae,pe])[1],Ut=xe.project([Ae,Ne])[1],At=0;return Ut-Mt<de&&(Ge+=Math.log2(de/(Ut-Mt)),xe=new ge({width:X,height:de,longitude:Ae,latitude:De,zoom:Ge}),Mt=xe.project([Ae,pe])[1],Ut=xe.project([Ae,Ne])[1]),Mt>0?At=Mt:Ut<de&&(At=Ut-de),At&&(De=xe.unproject([X/2,de/2+At])[1]),{width:X,height:de,longitude:Ae,latitude:De,zoom:Ge,pitch:ct,bearing:st}}var he=.01,se=["longitude","latitude","zoom"],J={curve:1.414,speed:1.2};function fe(C,X,de){var Ae=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},De={},Ge=Le(C,X,Ae),$e=Ge.startZoom,ct=Ge.startCenterXY,gt=Ge.uDelta,st=Ge.w0,xe=Ge.u1,Mt=Ge.S,Ut=Ge.rho,At=Ge.rho2,nt=Ge.r0;if(xe<he){for(var it=0;it<se.length;it++){var pt=se[it],Vt=C[pt],Er=X[pt];De[pt]=M(Vt,Er,de)}return De}var mr=de*Mt,Br=Math.cosh(nt)/Math.cosh(nt+Ut*mr),Ur=st*((Math.cosh(nt)*Math.tanh(nt+Ut*mr)-Math.sinh(nt))/At)/xe,Ar=1/Br,Nn=$e+z(Ar),Rn=U.scale([],gt,Ur);U.add(Rn,Rn,ct),U.scale(Rn,Rn,Ar);var ci=V(Rn,x(Nn));return De.longitude=ci[0],De.latitude=ci[1],De.zoom=Nn,De}function me(C,X){var de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};de=Object.assign({},J,de);var Ae=de,De=Ae.screenSpeed,Ge=Ae.speed,$e=Ae.maxDuration,ct=Le(C,X,de),gt=ct.S,st=ct.rho,xe=1e3*gt,Mt;return Number.isFinite(De)?Mt=xe/(De/st):Mt=xe/Ge,Number.isFinite($e)&&Mt>$e?0:Mt}function Le(C,X,de){de=Object.assign({},J,de);var Ae=de.curve,De=C.zoom,Ge=[C.longitude,C.latitude],$e=x(De),ct=X.zoom,gt=[X.longitude,X.latitude],st=x(ct-De),xe=B(Ge,$e),Mt=B(gt,$e),Ut=U.sub([],Mt,xe),At=Math.max(C.width,C.height),nt=At/st,it=U.length(Ut),pt=Math.max(it,he),Vt=Ae*Ae,Er=(nt*nt-At*At+Vt*Vt*pt*pt)/(2*At*Vt*pt),mr=(nt*nt-At*At-Vt*Vt*pt*pt)/(2*nt*Vt*pt),Br=Math.log(Math.sqrt(Er*Er+1)-Er),Ur=Math.log(Math.sqrt(mr*mr+1)-mr),Ar=(Ur-Br)/Ae;return{startZoom:De,startCenterXY:xe,uDelta:Ut,w0:At,u1:it,S:Ar,rho:Ae,rho2:Vt,r0:Br,r1:Ur}}},75752:function(Te){Te.exports.RADIUS=6378137,Te.exports.FLATTENING=1/298.257223563,Te.exports.POLAR_RADIUS=63567523142e-4}}]);
