<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head>
	<th:block th:include="include :: header('阅读文章列表')" />
</head>
<body>
	<div class="row">
		<div class="btn-group-sm" id="toolbar" role="group">
			<a class="btn btn-success" onclick="$.operate.addFull()">
				<i class="fa fa-plus"></i> 添加
			</a>
			<a class="btn btn-primary btn-edit disabled" onclick="$.operate.editFull()">
				<i class="fa fa-edit"></i> 修改
			</a>
			<a class="btn btn-danger btn-del btn-del disabled" onclick="$.operate.removeAll()">
				<i class="fa fa-remove"></i> 删除
			</a>
		</div>
		<div class="col-sm-12 select-table table-striped box-shadow-none">
			<table id="bootstrap-table" data-mobile-responsive="true"></table>
		</div>
	</div>
    <th:block th:include="include :: footer" />
    <script th:inline="javascript">
		var disables = [[${@dict.getType('sys_normal_disable')}]];
		/*var categorys = [[${@dict.getType('course_category')}]];*/
        var prefix = ctx + "course/article";

        $(function() {
        	var iframe = $("#tab"+[[${id}]]+">iframe", parent.document);
        	var courseId=iframe.attr("data-course"), categoryId=iframe.attr("data-category");
        	$("#bootstrap-table").attr("data-course", courseId).attr("data-category", categoryId)
				.attr("data-type", "article").attr("data-flag", "course");//数据标识
			var queryParams = function(params) {
				return {
					courseId:courseId, categoryId:categoryId,
					pageSize:       params.limit,
					pageNum:        params.offset / params.limit + 1,
					searchValue:    params.search,
					orderByColumn:  params.sort,
					isAsc:          params.order
				};
			};
            var options = {
                url: prefix + "/list",
                createUrl: prefix + "/add/",
                updateUrl: prefix + "/edit/{id}",
                removeUrl: prefix + "/remove/"+courseId+"/"+categoryId,
				exportUrl: prefix + "/export",
                modalName: "阅读文章",
                showPageGo: true,
				showSearch: false,
				queryParams: queryParams,
                columns: [{
		            checkbox: true
		        },
				{
					field : 'articleId', 
					title : '编号',
					visible: false
				},
				/*{
					field : 'classifyId',
					title : '所属分类 ',
					sortable: true,
					formatter: function(value, item, index) {
						return $.table.selectDictLabel(categorys, value);
					}
				},*/
				{
					field : 'articleTitle', 
					title : '标题',
					sortable: true
				},
				{
					field : 'articleContent', 
					title : '内容',
					sortable: true,
					formatter: function(value, item, index) {
						let content = $.common.linkTip(item.articleId, $.common.delHtmlTag(value), '', 60);
						return $(content).removeAttr("data-toggle").prop("outerHTML");//移除tip功能，用title显示
					}
				},
				{
					field : 'articleTime', 
					title : '阅读时间(分钟)',
					sortable: true
				},
				{
					field : 'articleStatus', 
					title : '状态',
					sortable: true,
					formatter: function(value, item, index) {
						return $.table.selectDictLabel(disables, item.articleStatus);
					}
				},
		        {
		            title: '操作',
		            align: 'center',
		            formatter: function(value, row, index) {
		            	var actions = [];
						actions.push('<a class="btn btn-success btn-xs" href="#" onclick="uploadVideo(\'' + row.articleId + '\')"><i class="fa fa-video-camera"></i>音频/视频</a> ');
		            	actions.push('<a class="btn btn-success btn-xs" href="#" onclick="$.operate.editFull(\'' + row.articleId + '\')"><i class="fa fa-edit"></i>编辑</a> ');
                        actions.push('<a class="btn btn-danger btn-xs" href="#" onclick="$.operate.remove(\'' + row.articleId + '\')"><i class="fa fa-remove"></i>删除</a>');
						return actions.join('');
		            }
		        }]
            };
            $.table.init(options);
        });
		var uploadVideo = function(id) {
			var _url = ctx +"course/relation/video/article/"+ id, _width ='800px', _height = ($(window).height()- 20)+'px';
			layer.open({
				type: 2,fix: false, maxmin: true, shade: 0.3,
				area: [_width, _height],
				title: "上传音频或视频文件",
				content: _url,
				btn: ['关闭'],
				shadeClose: true,
				cancel: function(index){
					return true;
				}
			});
		}
    </script>
</body>
</html>