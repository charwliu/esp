<head th:fragment="header">
	<link th:href="@{/ajax/libs/summernote/summernote.css}" rel="stylesheet"/>
	<link th:href="@{/ajax/libs/summernote/summernote-bs3.css}" rel="stylesheet"/>
	<style type="text/css">
		html {overflow-y: auto;}
	</style>
</head>

<div th:fragment="footer(height)">
	<script th:src="@{/ajax/libs/summernote/summernote.min.js}"></script>
	<script th:src="@{/ajax/libs/summernote/summernote-zh-CN.js}"></script>
	<script type="text/javascript">
		var maxSize = 500 * 1024;//500K
		$('.summernote').summernote({
			height : [[${height}]]+'px',
			lang : 'zh-CN',
			placeholder: " ",
			fontSizes: ['10', '12', '14', '15', '16', '17', '18', '19', '20', '24'],
			toolbar: [
				['style', ['style']],
				['font', ['bold', 'italic', 'underline', 'clear']],
				['fontsize', ['fontsize']],
				['fontname', ['fontname']],
				['color', ['color']],
				['para', ['ul', 'ol', 'paragraph']],
				['height', ['height']],
				['table', ['table']],
				['insert', ['link', 'picture']],
				['misc', ['fullscreen', 'undo', 'redo', 'codeview', 'help']]
			],
			callbacks: {
				onImageUpload: function (files) {
					var file = files[0];
					if(file.size > maxSize){
						$.modal.alertWarning("图片大小超过500K，无法上传！");
						return;
					}
					sendFile(files[0], this);
				},
				onFocus: function() {
					$('.label-error', $(this).parent('div')).hide();
				}
			}
		});
		// 上传文件
		function sendFile(file, obj) {
			var data = new FormData();
			data.append("file", file);
			$.ajax({
				type: "POST",
				url: ctx + "common/upload",
				data: data,
				cache: false,
				contentType: false,
				processData: false,
				dataType: 'json',
				success: function(result) {
					if (result.code == web_status.SUCCESS) {
						$(obj).summernote('editor.insertImage', result.url, result.fileName);
					} else {
						$.modal.alertError(result.msg);
					}
				},
				error: function(error) {
					$.modal.alertError("图片上传失败。");
				}
			});
		}
	</script>
</div>

<div th:fragment="form-input">
	<input id="dataFlag" name="dataFlag" type="hidden">
	<input id="courseId" name="courseId" type="hidden">
	<input id="categoryId" name="categoryId" type="hidden">
	<input id="questionType" name="questionType" type="hidden">
	<input id="gradeId" name="gradeId" type="hidden">
	<input id="subjectId" name="subjectId" type="hidden">
</div>

<div th:fragment="form-value">
	<script type="text/javascript">
		$(function(){//设置课程编号和课程内容类型
			var table = $("#bootstrap-table", parent.document);
			var dataFlag = table.attr("data-flag");
			if(dataFlag=="course"||dataFlag=="skill"){//课程内容||技巧课
				$("#courseId").val(table.attr("data-course"));
			}else if(dataFlag=="test" || dataFlag=="game"){//阅读测试||闯关
				$("#gradeId").val(table.attr("data-grade"));
				$("#subjectId").val(table.attr("data-subject"));
			}
			$("#dataFlag").val(dataFlag);
			$("#categoryId").val(table.attr("data-category"));
			$("#questionType").val(table.attr("data-type"));
		});
	</script>
</div>

<div th:fragment="audit-js">
	<script type="text/javascript">
		var course = {
			/*跳转课程内容*/
			goContent:function(courseId, courseName) {
				var url = prefix + '/content/' + courseId;
				createMenuItem(url, courseName);
			},
			/**审核课程内容*/
			audit: function(id, courseName, status) {
				var title = null;
				if(status=="0"){
					status = "1";
					title = "通过“";
				}else{
					status = "0";
					title = "取消“";
				}
				$.modal.confirm("确定"+title+ courseName + "”课程审核吗？", function() {
					var data = {"ids": id, "status": status};
					$.operate.submit(auditUrl, "post", "json", data);
				});
			},
			/**审核多个课程内容*/
			auditAll: function() {
				var rows = $.common.isEmpty($.table._option.uniqueId) ? $.table.selectFirstColumns() : $.table.selectColumns($.table._option.uniqueId);
				if (rows.length == 0) {
					$.modal.alertWarning("请至少选择一条记录");
					return;
				}
				$.modal.confirm("确认要审核通过选中的" + rows.length + "条课程信息吗?", function() {
					var data = { "ids": rows.join(), "status":"1"};
					$.operate.submit(auditUrl, "post", "json", data);
				});
			}
		};
	</script>
</div>

<div th:fragment="relation-js">
	<script type="text/javascript">
		var editRow= function(id, dataType) {//阅读课程编辑
			editData(id, "course/"+dataType);
		};
		var editSkillRow= function(id, dataType) {//技巧课编辑
			editData(id, "skill/"+dataType);
		};
		var editGameRow= function(id, dataType) {//闯关编辑
			editData(id, "game/"+dataType);
		};
		var editData= function(id, dataType) {//编辑题目内容数据行
			if ($.common.isEmpty(id)) {
				var row = $.map($('#bootstrap-table').bootstrapTable('getSelections'), function(row) {
					return row;
				});
				var question = row[0]; id = question.questionId;
				if (id == null || id.length === 0) {
					$.modal.alertWarning("请至少选择一条记录");
					return;
				}
				dataType = "course/"+question.questionType;
			}
			var url = ctx + dataType +"/edit/"+id;
			var modalTitle = "修改"+ $($.table.selectDictLabel(questionType, dataType)).text();
			$.modal.openFull(modalTitle, url);
		};
	</script>
</div>
